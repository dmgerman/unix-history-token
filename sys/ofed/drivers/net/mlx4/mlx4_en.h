begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2007 Mellanox Technologies. All rights reserved.  *  * This software is available to you under a choice of one of two  * licenses.  You may choose to be licensed under the terms of the GNU  * General Public License (GPL) Version 2, available from the file  * COPYING in the main directory of this source tree, or the  * OpenIB.org BSD license below:  *  *     Redistribution and use in source and binary forms, with or  *     without modification, are permitted provided that the following  *     conditions are met:  *  *      - Redistributions of source code must retain the above  *        copyright notice, this list of conditions and the following  *        disclaimer.  *  *      - Redistributions in binary form must reproduce the above  *        copyright notice, this list of conditions and the following  *        disclaimer in the documentation and/or other materials  *        provided with the distribution.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN  * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  * SOFTWARE.  *  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|_MLX4_EN_H_
end_ifndef

begin_define
define|#
directive|define
name|_MLX4_EN_H_
end_define

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_include
include|#
directive|include
file|<linux/types.h>
end_include

begin_include
include|#
directive|include
file|<linux/compiler.h>
end_include

begin_include
include|#
directive|include
file|<linux/list.h>
end_include

begin_include
include|#
directive|include
file|<linux/mutex.h>
end_include

begin_include
include|#
directive|include
file|<linux/netdevice.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/device.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/qp.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/cq.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/srq.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/doorbell.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/cmd.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<netinet/tcp_lro.h>
end_include

begin_include
include|#
directive|include
file|"en_port.h"
end_include

begin_define
define|#
directive|define
name|DRV_NAME
value|"mlx4_en"
end_define

begin_define
define|#
directive|define
name|DRV_VERSION
value|"1.5.2"
end_define

begin_define
define|#
directive|define
name|DRV_RELDATE
value|"July 2010"
end_define

begin_comment
comment|/* XXX */
end_comment

begin_define
define|#
directive|define
name|NETIF_MSG_LINK
value|0x1
end_define

begin_define
define|#
directive|define
name|NETIF_MSG_IFDOWN
value|0x2
end_define

begin_define
define|#
directive|define
name|NETIF_MSG_HW
value|0x4
end_define

begin_define
define|#
directive|define
name|NETIF_MSG_DRV
value|0x8
end_define

begin_define
define|#
directive|define
name|NETIF_MSG_INTR
value|0x10
end_define

begin_define
define|#
directive|define
name|NETIF_MSG_RX_ERR
value|0x20
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MSG_LEVEL
value|(NETIF_MSG_LINK | NETIF_MSG_IFDOWN)
end_define

begin_define
define|#
directive|define
name|en_print
parameter_list|(
name|level
parameter_list|,
name|priv
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|{							\ 	if ((priv)->registered)					\ 		printk(level "%s: %s: " format, DRV_NAME,	\ 			(priv->dev)->if_xname, ## arg);	\ 	else							\ 		printk(level "%s: %s: Port %d: " format,	\ 			DRV_NAME, dev_name(&priv->mdev->pdev->dev), \ 			(priv)->port, ## arg);			\ 	}
end_define

begin_define
define|#
directive|define
name|en_dbg
parameter_list|(
name|mlevel
parameter_list|,
name|priv
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|if (NETIF_MSG_##mlevel& priv->msg_enable) \ 		en_print(KERN_DEBUG, priv, format, ## arg)
end_define

begin_define
define|#
directive|define
name|en_warn
parameter_list|(
name|priv
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|en_print(KERN_WARNING, priv, format, ## arg)
end_define

begin_define
define|#
directive|define
name|en_err
parameter_list|(
name|priv
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|en_print(KERN_ERR, priv, format, ## arg)
end_define

begin_define
define|#
directive|define
name|en_info
parameter_list|(
name|priv
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|en_print(KERN_INFO, priv, format, ## arg)
end_define

begin_define
define|#
directive|define
name|mlx4_err
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|printk(KERN_ERR "%s %s: " format , DRV_NAME ,\ 		dev_name(&mdev->pdev->dev) , ## arg)
end_define

begin_define
define|#
directive|define
name|mlx4_info
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|printk(KERN_INFO "%s %s: " format , DRV_NAME ,\ 		dev_name(&mdev->pdev->dev) , ## arg)
end_define

begin_define
define|#
directive|define
name|mlx4_warn
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|printk(KERN_WARNING "%s %s: " format , DRV_NAME ,\ 		dev_name(&mdev->pdev->dev) , ## arg)
end_define

begin_comment
comment|/*  * Device constants  */
end_comment

begin_define
define|#
directive|define
name|MLX4_EN_PAGE_SHIFT
value|12
end_define

begin_define
define|#
directive|define
name|MLX4_EN_PAGE_SIZE
value|(1<< MLX4_EN_PAGE_SHIFT)
end_define

begin_define
define|#
directive|define
name|MAX_TX_RINGS
value|(MLX4_EN_NUM_HASH_RINGS + 1 + MLX4_EN_NUM_PPP_RINGS)
end_define

begin_define
define|#
directive|define
name|MAX_RX_RINGS
value|16
end_define

begin_define
define|#
directive|define
name|TXBB_SIZE
value|64
end_define

begin_define
define|#
directive|define
name|HEADROOM
value|(2048 / TXBB_SIZE + 1)
end_define

begin_define
define|#
directive|define
name|STAMP_STRIDE
value|64
end_define

begin_define
define|#
directive|define
name|STAMP_DWORDS
value|(STAMP_STRIDE / 4)
end_define

begin_define
define|#
directive|define
name|STAMP_SHIFT
value|31
end_define

begin_define
define|#
directive|define
name|STAMP_VAL
value|0x7fffffff
end_define

begin_define
define|#
directive|define
name|STATS_DELAY
value|(HZ / 4)
end_define

begin_comment
comment|/* Typical TSO descriptor with 16 gather entries is 352 bytes... */
end_comment

begin_define
define|#
directive|define
name|MAX_DESC_SIZE
value|512
end_define

begin_define
define|#
directive|define
name|MAX_DESC_TXBBS
value|(MAX_DESC_SIZE / TXBB_SIZE)
end_define

begin_comment
comment|/*  * OS related constants and tunables  */
end_comment

begin_define
define|#
directive|define
name|MLX4_EN_WATCHDOG_TIMEOUT
value|(15 * HZ)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MAX_LRO_DESCRIPTORS
value|32
end_define

begin_define
define|#
directive|define
name|MLX4_EN_NUM_IPFRAG_SESSIONS
value|16
end_define

begin_comment
comment|/* Receive fragment sizes; we use at most 3 fragments (for 9600 byte MTU  * and 4K allocations) */
end_comment

begin_if
if|#
directive|if
name|MJUMPAGESIZE
operator|==
literal|4096
end_if

begin_enum
enum|enum
block|{
name|FRAG_SZ0
init|=
name|MCLBYTES
block|,
name|FRAG_SZ1
init|=
name|MJUMPAGESIZE
block|,
name|FRAG_SZ2
init|=
name|MJUMPAGESIZE
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|MLX4_EN_MAX_RX_FRAGS
value|3
end_define

begin_elif
elif|#
directive|elif
name|MJUMPAGESIZE
operator|==
literal|8192
end_elif

begin_enum
enum|enum
block|{
name|FRAG_SZ0
init|=
name|MCLBYTES
block|,
name|FRAG_SZ1
init|=
name|MJUMPAGESIZE
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|MLX4_EN_MAX_RX_FRAGS
value|2
end_define

begin_elif
elif|#
directive|elif
name|MJUMPAGESIZE
operator|==
literal|8192
end_elif

begin_else
else|#
directive|else
end_else

begin_error
error|#
directive|error
literal|"Unknown PAGE_SIZE"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Maximum ring sizes */
end_comment

begin_define
define|#
directive|define
name|MLX4_EN_MAX_TX_SIZE
value|8192
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MAX_RX_SIZE
value|8192
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MIN_RX_SIZE
value|(128)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MIN_TX_SIZE
value|(4096 / TXBB_SIZE)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_SMALL_PKT_SIZE
value|64
end_define

begin_define
define|#
directive|define
name|MLX4_EN_TX_HASH_SIZE
value|256
end_define

begin_define
define|#
directive|define
name|MLX4_EN_TX_HASH_MASK
value|(MLX4_EN_TX_HASH_SIZE - 1)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_NUM_HASH_RINGS
value|4
end_define

begin_define
define|#
directive|define
name|MLX4_EN_NUM_PPP_RINGS
value|8
end_define

begin_define
define|#
directive|define
name|MLX4_EN_DEF_TX_RING_SIZE
value|512
end_define

begin_define
define|#
directive|define
name|MLX4_EN_DEF_TX_QUEUE_SIZE
value|4096
end_define

begin_define
define|#
directive|define
name|MLX4_EN_DEF_RX_RING_SIZE
value|1024
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MAX_RX_POLL
value|1024
end_define

begin_comment
comment|/* Target number of bytes to coalesce with interrupt moderation */
end_comment

begin_define
define|#
directive|define
name|MLX4_EN_RX_COAL_TARGET
value|0x20000
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_COAL_TIME
value|0x10
end_define

begin_define
define|#
directive|define
name|MLX4_EN_TX_COAL_PKTS
value|5
end_define

begin_define
define|#
directive|define
name|MLX4_EN_TX_COAL_TIME
value|0x80
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_RATE_LOW
value|400000
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_COAL_TIME_LOW
value|0
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_RATE_HIGH
value|450000
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_COAL_TIME_HIGH
value|128
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_SIZE_THRESH
value|1024
end_define

begin_define
define|#
directive|define
name|MLX4_EN_RX_RATE_THRESH
value|(1000000 / MLX4_EN_RX_COAL_TIME_HIGH)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_SAMPLE_INTERVAL
value|0
end_define

begin_define
define|#
directive|define
name|MLX4_EN_AVG_PKT_SMALL
value|256
end_define

begin_define
define|#
directive|define
name|MLX4_EN_AUTO_CONF
value|0xffff
end_define

begin_define
define|#
directive|define
name|MLX4_EN_DEF_RX_PAUSE
value|1
end_define

begin_define
define|#
directive|define
name|MLX4_EN_DEF_TX_PAUSE
value|1
end_define

begin_comment
comment|/* Interval between sucessive polls in the Tx routine when polling is used    instead of interrupts (in per-core Tx rings) - should be power of 2 */
end_comment

begin_define
define|#
directive|define
name|MLX4_EN_TX_POLL_MODER
value|16
end_define

begin_define
define|#
directive|define
name|MLX4_EN_TX_POLL_TIMEOUT
value|(HZ / 4)
end_define

begin_define
define|#
directive|define
name|ETH_LLC_SNAP_SIZE
value|8
end_define

begin_define
define|#
directive|define
name|SMALL_PACKET_SIZE
value|(MHLEN)
end_define

begin_define
define|#
directive|define
name|HEADER_COPY_SIZE
value|(128)
end_define

begin_define
define|#
directive|define
name|MLX4_LOOPBACK_TEST_PAYLOAD
value|(HEADER_COPY_SIZE - ETHER_HDR_LEN)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MIN_MTU
value|46
end_define

begin_define
define|#
directive|define
name|ETH_BCAST
value|0xffffffffffffULL
end_define

begin_define
define|#
directive|define
name|MLX4_EN_LOOPBACK_RETRIES
value|5
end_define

begin_define
define|#
directive|define
name|MLX4_EN_LOOPBACK_TIMEOUT
value|100
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|MLX4_EN_PERF_STAT
end_ifdef

begin_comment
comment|/* Number of samples to 'average' */
end_comment

begin_define
define|#
directive|define
name|AVG_SIZE
value|128
end_define

begin_define
define|#
directive|define
name|AVG_FACTOR
value|1024
end_define

begin_define
define|#
directive|define
name|NUM_PERF_STATS
value|NUM_PERF_COUNTERS
end_define

begin_define
define|#
directive|define
name|INC_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|)
value|(++(cnt))
end_define

begin_define
define|#
directive|define
name|ADD_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|,
name|add
parameter_list|)
value|((cnt) += (add))
end_define

begin_define
define|#
directive|define
name|AVG_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|,
name|sample
parameter_list|)
define|\
value|((cnt) = ((cnt) * (AVG_SIZE - 1) + (sample) * AVG_FACTOR) / AVG_SIZE)
end_define

begin_define
define|#
directive|define
name|GET_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|)
value|(cnt)
end_define

begin_define
define|#
directive|define
name|GET_AVG_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|)
value|((cnt) / AVG_FACTOR)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|NUM_PERF_STATS
value|0
end_define

begin_define
define|#
directive|define
name|INC_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|)
value|do {} while (0)
end_define

begin_define
define|#
directive|define
name|ADD_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|,
name|add
parameter_list|)
value|do {} while (0)
end_define

begin_define
define|#
directive|define
name|AVG_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|,
name|sample
parameter_list|)
value|do {} while (0)
end_define

begin_define
define|#
directive|define
name|GET_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|)
value|(0)
end_define

begin_define
define|#
directive|define
name|GET_AVG_PERF_COUNTER
parameter_list|(
name|cnt
parameter_list|)
value|(0)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* MLX4_EN_PERF_STAT */
end_comment

begin_comment
comment|/*  * Configurables  */
end_comment

begin_enum
enum|enum
name|cq_type
block|{
name|RX
init|=
literal|0
block|,
name|TX
init|=
literal|1
block|, }
enum|;
end_enum

begin_comment
comment|/*  * Useful macros  */
end_comment

begin_define
define|#
directive|define
name|ROUNDUP_LOG2
parameter_list|(
name|x
parameter_list|)
value|ilog2(roundup_pow_of_two(x))
end_define

begin_define
define|#
directive|define
name|XNOR
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|(!(x) == !(y))
end_define

begin_define
define|#
directive|define
name|ILLEGAL_MAC
parameter_list|(
name|addr
parameter_list|)
value|(addr == 0xffffffffffffULL || addr == 0x0)
end_define

begin_struct
struct|struct
name|mlx4_en_tx_info
block|{
name|struct
name|mbuf
modifier|*
name|mb
decl_stmt|;
name|u32
name|nr_txbb
decl_stmt|;
name|u8
name|nr_segs
decl_stmt|;
name|u8
name|data_offset
decl_stmt|;
name|u8
name|inl
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_EN_BIT_DESC_OWN
value|0x80000000
end_define

begin_define
define|#
directive|define
name|CTRL_SIZE
value|sizeof(struct mlx4_wqe_ctrl_seg)
end_define

begin_define
define|#
directive|define
name|MLX4_EN_MEMTYPE_PAD
value|0x100
end_define

begin_define
define|#
directive|define
name|DS_SIZE
value|sizeof(struct mlx4_wqe_data_seg)
end_define

begin_struct
struct|struct
name|mlx4_en_tx_desc
block|{
name|struct
name|mlx4_wqe_ctrl_seg
name|ctrl
decl_stmt|;
union|union
block|{
name|struct
name|mlx4_wqe_data_seg
name|data
decl_stmt|;
comment|/* at least one data segment */
name|struct
name|mlx4_wqe_lso_seg
name|lso
decl_stmt|;
name|struct
name|mlx4_wqe_inline_seg
name|inl
decl_stmt|;
block|}
union|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_EN_USE_SRQ
value|0x01000000
end_define

begin_struct
struct|struct
name|mlx4_en_tx_ring
block|{
name|spinlock_t
name|tx_lock
decl_stmt|;
name|struct
name|mlx4_hwq_resources
name|wqres
decl_stmt|;
name|u32
name|size
decl_stmt|;
comment|/* number of TXBBs */
name|u32
name|size_mask
decl_stmt|;
name|u16
name|stride
decl_stmt|;
name|u16
name|cqn
decl_stmt|;
comment|/* index of port CQ associated with this ring */
name|u32
name|prod
decl_stmt|;
name|u32
name|cons
decl_stmt|;
name|u32
name|buf_size
decl_stmt|;
name|u32
name|doorbell_qpn
decl_stmt|;
name|void
modifier|*
name|buf
decl_stmt|;
name|u16
name|poll_cnt
decl_stmt|;
name|int
name|blocked
decl_stmt|;
name|struct
name|buf_ring
modifier|*
name|br
decl_stmt|;
name|struct
name|mlx4_en_tx_info
modifier|*
name|tx_info
decl_stmt|;
name|u8
modifier|*
name|bounce_buf
decl_stmt|;
name|u32
name|last_nr_txbb
decl_stmt|;
name|struct
name|mlx4_qp
name|qp
decl_stmt|;
name|struct
name|mlx4_qp_context
name|context
decl_stmt|;
name|int
name|qpn
decl_stmt|;
name|enum
name|mlx4_qp_state
name|qp_state
decl_stmt|;
name|struct
name|mlx4_srq
name|dummy
decl_stmt|;
name|unsigned
name|long
name|bytes
decl_stmt|;
name|unsigned
name|long
name|packets
decl_stmt|;
name|unsigned
name|long
name|errors
decl_stmt|;
name|spinlock_t
name|comp_lock
decl_stmt|;
name|struct
name|mlx4_bf
name|bf
decl_stmt|;
name|bool
name|bf_enabled
decl_stmt|;
name|u64
name|watchdog_time
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_ipfrag
block|{
name|struct
name|mbuf
modifier|*
name|fragments
decl_stmt|;
name|struct
name|mbuf
modifier|*
name|last
decl_stmt|;
name|__be32
name|saddr
decl_stmt|;
name|__be32
name|daddr
decl_stmt|;
name|__be16
name|id
decl_stmt|;
name|u8
name|protocol
decl_stmt|;
name|int
name|total_len
decl_stmt|;
name|u16
name|offset
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_rx_desc
block|{
comment|/* actual number of entries depends on rx ring stride */
name|struct
name|mlx4_wqe_data_seg
name|data
index|[
literal|0
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_rx_ring
block|{
name|struct
name|mlx4_hwq_resources
name|wqres
decl_stmt|;
name|u32
name|size
decl_stmt|;
comment|/* number of Rx descs*/
name|u32
name|actual_size
decl_stmt|;
name|u32
name|size_mask
decl_stmt|;
name|u16
name|stride
decl_stmt|;
name|u16
name|log_stride
decl_stmt|;
name|u16
name|cqn
decl_stmt|;
comment|/* index of port CQ associated with this ring */
name|u32
name|prod
decl_stmt|;
name|u32
name|cons
decl_stmt|;
name|u32
name|buf_size
decl_stmt|;
name|void
modifier|*
name|buf
decl_stmt|;
name|void
modifier|*
name|rx_info
decl_stmt|;
name|unsigned
name|long
name|bytes
decl_stmt|;
name|unsigned
name|long
name|packets
decl_stmt|;
name|unsigned
name|long
name|errors
decl_stmt|;
name|struct
name|lro_ctrl
name|lro
decl_stmt|;
name|struct
name|mlx4_en_ipfrag
name|ipfrag
index|[
name|MLX4_EN_NUM_IPFRAG_SESSIONS
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|int
name|mlx4_en_can_lro
parameter_list|(
name|__be16
name|status
parameter_list|)
block|{
return|return
operator|(
name|status
operator|&
name|cpu_to_be16
argument_list|(
name|MLX4_CQE_STATUS_IPV4
operator||
name|MLX4_CQE_STATUS_IPV4F
operator||
name|MLX4_CQE_STATUS_IPV6
operator||
name|MLX4_CQE_STATUS_IPV4OPT
operator||
name|MLX4_CQE_STATUS_TCP
operator||
name|MLX4_CQE_STATUS_UDP
operator||
name|MLX4_CQE_STATUS_IPOK
argument_list|)
operator|)
operator|==
name|cpu_to_be16
argument_list|(
name|MLX4_CQE_STATUS_IPV4
operator||
name|MLX4_CQE_STATUS_IPOK
operator||
name|MLX4_CQE_STATUS_TCP
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|mlx4_en_cq
block|{
name|struct
name|mlx4_cq
name|mcq
decl_stmt|;
name|struct
name|mlx4_hwq_resources
name|wqres
decl_stmt|;
name|int
name|ring
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|struct
name|net_device
modifier|*
name|dev
decl_stmt|;
comment|/* Per-core Tx cq processing support */
name|struct
name|timer_list
name|timer
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|buf_size
decl_stmt|;
name|unsigned
name|vector
decl_stmt|;
name|enum
name|cq_type
name|is_tx
decl_stmt|;
name|u16
name|moder_time
decl_stmt|;
name|u16
name|moder_cnt
decl_stmt|;
name|struct
name|mlx4_cqe
modifier|*
name|buf
decl_stmt|;
name|struct
name|task
name|cq_task
decl_stmt|;
name|struct
name|taskqueue
modifier|*
name|tq
decl_stmt|;
define|#
directive|define
name|MLX4_EN_OPCODE_ERROR
value|0x1e
name|u32
name|tot_rx
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_port_profile
block|{
name|u32
name|flags
decl_stmt|;
name|u32
name|tx_ring_num
decl_stmt|;
name|u32
name|rx_ring_num
decl_stmt|;
name|u32
name|tx_ring_size
decl_stmt|;
name|u32
name|rx_ring_size
decl_stmt|;
name|u8
name|rx_pause
decl_stmt|;
name|u8
name|tx_pause
decl_stmt|;
name|u32
name|rx_ppp
decl_stmt|;
name|u32
name|tx_ppp
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_profile
block|{
name|int
name|rss_xor
decl_stmt|;
name|int
name|num_lro
decl_stmt|;
name|int
name|ip_reasm
decl_stmt|;
name|int
name|tcp_rss
decl_stmt|;
name|int
name|udp_rss
decl_stmt|;
name|u8
name|rss_mask
decl_stmt|;
name|u32
name|active_ports
decl_stmt|;
name|u32
name|small_pkt_int
decl_stmt|;
name|u8
name|no_reset
decl_stmt|;
name|struct
name|mlx4_en_port_profile
name|prof
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_dev
block|{
name|struct
name|mlx4_dev
modifier|*
name|dev
decl_stmt|;
name|struct
name|pci_dev
modifier|*
name|pdev
decl_stmt|;
name|struct
name|mutex
name|state_lock
decl_stmt|;
name|struct
name|net_device
modifier|*
name|pndev
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|u32
name|port_cnt
decl_stmt|;
name|bool
name|device_up
decl_stmt|;
name|struct
name|mlx4_en_profile
name|profile
decl_stmt|;
name|u32
name|LSO_support
decl_stmt|;
name|struct
name|workqueue_struct
modifier|*
name|workqueue
decl_stmt|;
name|struct
name|device
modifier|*
name|dma_device
decl_stmt|;
name|void
name|__iomem
modifier|*
name|uar_map
decl_stmt|;
name|struct
name|mlx4_uar
name|priv_uar
decl_stmt|;
name|struct
name|mlx4_mr
name|mr
decl_stmt|;
name|u32
name|priv_pdn
decl_stmt|;
name|spinlock_t
name|uar_lock
decl_stmt|;
name|u8
name|mac_removed
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_rss_map
block|{
name|int
name|base_qpn
decl_stmt|;
name|struct
name|mlx4_qp
name|qps
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|enum
name|mlx4_qp_state
name|state
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|struct
name|mlx4_qp
name|indir_qp
decl_stmt|;
name|enum
name|mlx4_qp_state
name|indir_state
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_rss_context
block|{
name|__be32
name|base_qpn
decl_stmt|;
name|__be32
name|default_qpn
decl_stmt|;
name|u16
name|reserved
decl_stmt|;
name|u8
name|hash_fn
decl_stmt|;
name|u8
name|flags
decl_stmt|;
name|__be32
name|rss_key
index|[
literal|10
index|]
decl_stmt|;
name|__be32
name|base_qpn_udp
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_port_state
block|{
name|int
name|link_state
decl_stmt|;
name|int
name|link_speed
decl_stmt|;
name|int
name|transciver
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_pkt_stats
block|{
name|unsigned
name|long
name|broadcast
decl_stmt|;
name|unsigned
name|long
name|rx_prio
index|[
literal|8
index|]
decl_stmt|;
name|unsigned
name|long
name|tx_prio
index|[
literal|8
index|]
decl_stmt|;
define|#
directive|define
name|NUM_PKT_STATS
value|17
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_port_stats
block|{
name|unsigned
name|long
name|tso_packets
decl_stmt|;
name|unsigned
name|long
name|queue_stopped
decl_stmt|;
name|unsigned
name|long
name|wake_queue
decl_stmt|;
name|unsigned
name|long
name|tx_timeout
decl_stmt|;
name|unsigned
name|long
name|rx_alloc_failed
decl_stmt|;
name|unsigned
name|long
name|rx_chksum_good
decl_stmt|;
name|unsigned
name|long
name|rx_chksum_none
decl_stmt|;
name|unsigned
name|long
name|tx_chksum_offload
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_perf_stats
block|{
name|u32
name|tx_poll
decl_stmt|;
name|u64
name|tx_pktsz_avg
decl_stmt|;
name|u32
name|inflight_avg
decl_stmt|;
name|u32
name|tx_coal_avg
decl_stmt|;
name|u32
name|rx_coal_avg
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_frag_info
block|{
name|u16
name|frag_size
decl_stmt|;
name|u16
name|frag_prefix_size
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_tx_hash_entry
block|{
name|u8
name|cnt
decl_stmt|;
name|unsigned
name|int
name|small_pkts
decl_stmt|;
name|unsigned
name|int
name|big_pkts
decl_stmt|;
name|unsigned
name|int
name|ring
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_en_priv
block|{
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
decl_stmt|;
name|struct
name|mlx4_en_port_profile
modifier|*
name|prof
decl_stmt|;
name|struct
name|net_device
modifier|*
name|dev
decl_stmt|;
name|bool
name|vlgrp_modified
decl_stmt|;
name|u32
name|vlan_register
index|[
name|VLAN_FLTR_SIZE
index|]
decl_stmt|;
name|u32
name|vlan_unregister
index|[
name|VLAN_FLTR_SIZE
index|]
decl_stmt|;
name|u32
name|vlans
index|[
name|VLAN_FLTR_SIZE
index|]
decl_stmt|;
name|spinlock_t
name|vlan_lock
decl_stmt|;
name|struct
name|mlx4_en_port_state
name|port_state
decl_stmt|;
name|spinlock_t
name|stats_lock
decl_stmt|;
name|unsigned
name|long
name|last_moder_packets
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|unsigned
name|long
name|last_moder_tx_packets
decl_stmt|;
name|unsigned
name|long
name|last_moder_bytes
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|unsigned
name|long
name|last_moder_jiffies
decl_stmt|;
name|int
name|last_moder_time
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|u16
name|rx_usecs
decl_stmt|;
name|u16
name|rx_frames
decl_stmt|;
name|u16
name|tx_usecs
decl_stmt|;
name|u16
name|tx_frames
decl_stmt|;
name|u32
name|pkt_rate_low
decl_stmt|;
name|u16
name|rx_usecs_low
decl_stmt|;
name|u32
name|pkt_rate_high
decl_stmt|;
name|u16
name|rx_usecs_high
decl_stmt|;
name|u16
name|sample_interval
decl_stmt|;
name|u16
name|adaptive_rx_coal
decl_stmt|;
name|u32
name|msg_enable
decl_stmt|;
name|u32
name|loopback_ok
decl_stmt|;
name|u32
name|validate_loopback
decl_stmt|;
name|struct
name|mlx4_hwq_resources
name|res
decl_stmt|;
name|int
name|link_state
decl_stmt|;
name|int
name|last_link_state
decl_stmt|;
name|bool
name|port_up
decl_stmt|;
name|int
name|port
decl_stmt|;
name|int
name|registered
decl_stmt|;
name|int
name|allocated
decl_stmt|;
name|int
name|rx_csum
decl_stmt|;
name|u64
name|mac
decl_stmt|;
name|int
name|mac_index
decl_stmt|;
name|unsigned
name|max_mtu
decl_stmt|;
name|int
name|base_qpn
decl_stmt|;
name|struct
name|mlx4_en_rss_map
name|rss_map
decl_stmt|;
name|u16
name|tx_prio_map
index|[
literal|8
index|]
decl_stmt|;
name|u32
name|flags
decl_stmt|;
define|#
directive|define
name|MLX4_EN_FLAG_PROMISC
value|0x1
name|u32
name|tx_ring_num
decl_stmt|;
name|u32
name|rx_ring_num
decl_stmt|;
name|u32
name|rx_mb_size
decl_stmt|;
name|struct
name|mlx4_en_frag_info
name|frag_info
index|[
name|MLX4_EN_MAX_RX_FRAGS
index|]
decl_stmt|;
name|u16
name|num_frags
decl_stmt|;
name|u16
name|log_rx_info
decl_stmt|;
name|int
name|ip_reasm
decl_stmt|;
name|bool
name|wol
decl_stmt|;
name|struct
name|mlx4_en_tx_ring
name|tx_ring
index|[
name|MAX_TX_RINGS
index|]
decl_stmt|;
name|struct
name|mlx4_en_rx_ring
name|rx_ring
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|struct
name|mlx4_en_cq
name|tx_cq
index|[
name|MAX_TX_RINGS
index|]
decl_stmt|;
name|struct
name|mlx4_en_cq
name|rx_cq
index|[
name|MAX_RX_RINGS
index|]
decl_stmt|;
name|struct
name|mlx4_en_tx_hash_entry
name|tx_hash
index|[
name|MLX4_EN_TX_HASH_SIZE
index|]
decl_stmt|;
name|struct
name|work_struct
name|mcast_task
decl_stmt|;
name|struct
name|work_struct
name|start_port_task
decl_stmt|;
name|struct
name|work_struct
name|stop_port_task
decl_stmt|;
name|struct
name|work_struct
name|watchdog_task
decl_stmt|;
name|struct
name|work_struct
name|linkstate_task
decl_stmt|;
name|struct
name|delayed_work
name|stats_task
decl_stmt|;
name|struct
name|mlx4_en_perf_stats
name|pstats
decl_stmt|;
name|struct
name|mlx4_en_pkt_stats
name|pkstats
decl_stmt|;
name|struct
name|mlx4_en_port_stats
name|port_stats
decl_stmt|;
name|struct
name|mlx4_en_stat_out_mbox
name|hw_stats
decl_stmt|;
name|struct
name|ifmedia
name|media
decl_stmt|;
name|eventhandler_tag
name|vlan_attach
decl_stmt|;
name|eventhandler_tag
name|vlan_detach
decl_stmt|;
name|struct
name|callout
name|watchdog_timer
decl_stmt|;
specifier|volatile
name|int
name|blocked
decl_stmt|;
name|struct
name|sysctl_oid
modifier|*
name|sysctl
decl_stmt|;
name|struct
name|sysctl_ctx_list
name|conf_ctx
decl_stmt|;
name|struct
name|sysctl_ctx_list
name|stat_ctx
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
name|mlx4_en_wol
block|{
name|MLX4_EN_WOL_MAGIC
init|=
operator|(
literal|1ULL
operator|<<
literal|61
operator|)
block|,
name|MLX4_EN_WOL_ENABLED
init|=
operator|(
literal|1ULL
operator|<<
literal|62
operator|)
block|,
name|MLX4_EN_WOL_DO_MODIFY
init|=
operator|(
literal|1ULL
operator|<<
literal|63
operator|)
block|, }
enum|;
end_enum

begin_function_decl
name|int
name|mlx4_en_transmit
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|,
name|struct
name|mbuf
modifier|*
name|mb
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_qflush
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_rx_frags
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_rx_ring
modifier|*
name|ring
parameter_list|,
name|struct
name|mbuf
modifier|*
name|mb
parameter_list|,
name|struct
name|mlx4_cqe
modifier|*
name|cqe
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_flush_frags
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_rx_ring
modifier|*
name|ring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_destroy_netdev
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_init_netdev
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|int
name|port
parameter_list|,
name|struct
name|mlx4_en_port_profile
modifier|*
name|prof
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_do_start_port
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_do_stop_port
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_free_resources
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_alloc_resources
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_create_cq
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|,
name|int
name|entries
parameter_list|,
name|int
name|ring
parameter_list|,
name|enum
name|cq_type
name|mode
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_destroy_cq
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_activate_cq
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_deactivate_cq
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_set_cq_moder
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_arm_cq
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_poll_tx_cq
parameter_list|(
name|unsigned
name|long
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_tx_irq
parameter_list|(
name|struct
name|mlx4_cq
modifier|*
name|mcq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u16
name|mlx4_en_select_queue
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|,
name|struct
name|mbuf
modifier|*
name|mb
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_create_tx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_tx_ring
modifier|*
name|ring
parameter_list|,
name|u32
name|size
parameter_list|,
name|u16
name|stride
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_destroy_tx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_tx_ring
modifier|*
name|ring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_activate_tx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_tx_ring
modifier|*
name|ring
parameter_list|,
name|int
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_deactivate_tx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_tx_ring
modifier|*
name|ring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_create_rx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_rx_ring
modifier|*
name|ring
parameter_list|,
name|u32
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_destroy_rx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_rx_ring
modifier|*
name|ring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_activate_rx_rings
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_deactivate_rx_ring
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|struct
name|mlx4_en_rx_ring
modifier|*
name|ring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_process_rx_cq
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|,
name|int
name|budget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_process_rx_cq_mb
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_en_cq
modifier|*
name|cq
parameter_list|,
name|int
name|budget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_tx_que
parameter_list|(
name|void
modifier|*
name|context
parameter_list|,
name|int
name|pending
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_rx_que
parameter_list|(
name|void
modifier|*
name|context
parameter_list|,
name|int
name|pending
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_fill_qp_context
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|int
name|size
parameter_list|,
name|int
name|stride
parameter_list|,
name|int
name|is_tx
parameter_list|,
name|int
name|rss
parameter_list|,
name|int
name|qpn
parameter_list|,
name|int
name|cqn
parameter_list|,
name|struct
name|mlx4_qp_context
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_sqp_event
parameter_list|(
name|struct
name|mlx4_qp
modifier|*
name|qp
parameter_list|,
name|enum
name|mlx4_event
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_map_buffer
parameter_list|(
name|struct
name|mlx4_buf
modifier|*
name|buf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_unmap_buffer
parameter_list|(
name|struct
name|mlx4_buf
modifier|*
name|buf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_calc_rx_buf
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_set_prio_map
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|,
name|u16
modifier|*
name|prio_map
parameter_list|,
name|u32
name|ring_num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_config_rss_steer
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_release_rss_steer
parameter_list|(
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_free_tx_buf
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_en_tx_ring
modifier|*
name|ring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_en_rx_irq
parameter_list|(
name|struct
name|mlx4_cq
modifier|*
name|mcq
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|//int mlx4_SET_MCAST_FLTR(struct mlx4_dev *dev, u8 port, u64 mac, u64 clear, u8 mode);
end_comment

begin_function_decl
name|int
name|mlx4_SET_VLAN_FLTR
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u32
modifier|*
name|vlans
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|//int mlx4_SET_PORT_general(struct mlx4_dev *dev, u8 port, int mtu,
end_comment

begin_comment
comment|//			  u8 pptx, u8 pfctx, u8 pprx, u8 pfcrx);
end_comment

begin_comment
comment|//int mlx4_SET_PORT_qpn_calc(struct mlx4_dev *dev, u8 port, u32 base_qpn,
end_comment

begin_comment
comment|//			   u8 promisc);
end_comment

begin_function_decl
name|int
name|mlx4_en_DUMP_ETH_STATS
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u8
name|reset
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_en_QUERY_PORT
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|)
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|MLX4_EN_NUM_SELF_TEST
value|5
end_define

begin_function_decl
name|void
name|mlx4_en_ex_selftest
parameter_list|(
name|struct
name|net_device
modifier|*
name|dev
parameter_list|,
name|u32
modifier|*
name|flags
parameter_list|,
name|u64
modifier|*
name|buf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u64
name|mlx4_en_mac_to_u64
parameter_list|(
name|u8
modifier|*
name|addr
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Globals  */
end_comment

begin_decl_stmt
specifier|extern
specifier|const
name|struct
name|ethtool_ops
name|mlx4_en_ethtool_ops
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

end_unit

