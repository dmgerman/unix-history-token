begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2007 Mellanox Technologies. All rights reserved.  *  * This software is available to you under a choice of one of two  * licenses.  You may choose to be licensed under the terms of the GNU  * General Public License (GPL) Version 2, available from the file  * COPYING in the main directory of this source tree, or the  * OpenIB.org BSD license below:  *  *     Redistribution and use in source and binary forms, with or  *     without modification, are permitted provided that the following  *     conditions are met:  *  *      - Redistributions of source code must retain the above  *        copyright notice, this list of conditions and the following  *        disclaimer.  *  *      - Redistributions in binary form must reproduce the above  *        copyright notice, this list of conditions and the following  *        disclaimer in the documentation and/or other materials  *        provided with the distribution.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN  * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  * SOFTWARE.  *  */
end_comment

begin_include
include|#
directive|include
file|"mlx4_en.h"
end_include

begin_include
include|#
directive|include
file|<linux/if_vlan.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/device.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/cmd.h>
end_include

begin_function
name|int
name|mlx4_SET_MCAST_FLTR
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u64
name|mac
parameter_list|,
name|u64
name|clear
parameter_list|,
name|u8
name|mode
parameter_list|)
block|{
return|return
name|mlx4_cmd
argument_list|(
name|dev
argument_list|,
operator|(
name|mac
operator||
operator|(
name|clear
operator|<<
literal|63
operator|)
operator|)
argument_list|,
name|port
argument_list|,
name|mode
argument_list|,
name|MLX4_CMD_SET_MCAST_FLTR
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|mlx4_SET_VLAN_FLTR
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u32
modifier|*
name|vlans
parameter_list|)
block|{
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|struct
name|mlx4_set_vlan_fltr_mbox
modifier|*
name|filter
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|err
init|=
literal|0
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|filter
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|memset
argument_list|(
name|filter
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
expr|*
name|filter
argument_list|)
expr_stmt|;
if|if
condition|(
name|vlans
condition|)
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
name|VLAN_FLTR_SIZE
operator|-
literal|1
init|;
name|i
operator|<
name|VLAN_FLTR_SIZE
condition|;
name|i
operator|++
operator|,
name|j
operator|--
control|)
name|filter
operator|->
name|entry
index|[
name|j
index|]
operator|=
name|cpu_to_be32
argument_list|(
name|vlans
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd
argument_list|(
name|dev
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|port
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_SET_VLAN_FLTR
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|)
expr_stmt|;
name|mlx4_free_cmd_mailbox
argument_list|(
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|int
name|mlx4_SET_PORT_general
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|mtu
parameter_list|,
name|u8
name|pptx
parameter_list|,
name|u8
name|pfctx
parameter_list|,
name|u8
name|pprx
parameter_list|,
name|u8
name|pfcrx
parameter_list|)
block|{
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|struct
name|mlx4_set_port_general_context
modifier|*
name|context
decl_stmt|;
name|int
name|err
decl_stmt|;
name|u32
name|in_mod
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|context
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|memset
argument_list|(
name|context
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
expr|*
name|context
argument_list|)
expr_stmt|;
name|context
operator|->
name|flags
operator|=
name|SET_PORT_GEN_ALL_VALID
expr_stmt|;
name|context
operator|->
name|mtu
operator|=
name|cpu_to_be16
argument_list|(
name|mtu
argument_list|)
expr_stmt|;
name|context
operator|->
name|pptx
operator|=
operator|(
name|pptx
operator|*
operator|(
operator|!
name|pfctx
operator|)
operator|)
operator|<<
literal|7
expr_stmt|;
name|context
operator|->
name|pfctx
operator|=
name|pfctx
expr_stmt|;
name|context
operator|->
name|pprx
operator|=
operator|(
name|pprx
operator|*
operator|(
operator|!
name|pfcrx
operator|)
operator|)
operator|<<
literal|7
expr_stmt|;
name|context
operator|->
name|pfcrx
operator|=
name|pfcrx
expr_stmt|;
name|in_mod
operator|=
name|MLX4_SET_PORT_GENERAL
operator|<<
literal|8
operator||
name|port
expr_stmt|;
name|err
operator|=
name|mlx4_cmd
argument_list|(
name|dev
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|in_mod
argument_list|,
literal|1
argument_list|,
name|MLX4_CMD_SET_PORT
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|)
expr_stmt|;
name|mlx4_free_cmd_mailbox
argument_list|(
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|int
name|mlx4_SET_PORT_qpn_calc
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u32
name|base_qpn
parameter_list|,
name|u8
name|promisc
parameter_list|)
block|{
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|struct
name|mlx4_set_port_rqp_calc_context
modifier|*
name|context
decl_stmt|;
name|int
name|err
decl_stmt|;
name|u32
name|in_mod
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|context
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|memset
argument_list|(
name|context
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
expr|*
name|context
argument_list|)
expr_stmt|;
name|context
operator|->
name|base_qpn
operator|=
name|cpu_to_be32
argument_list|(
name|base_qpn
argument_list|)
expr_stmt|;
name|context
operator|->
name|promisc
operator|=
name|cpu_to_be32
argument_list|(
name|promisc
operator|<<
name|SET_PORT_PROMISC_EN_SHIFT
operator||
name|base_qpn
argument_list|)
expr_stmt|;
name|context
operator|->
name|mcast
operator|=
name|cpu_to_be32
argument_list|(
operator|(
name|dev
operator|->
name|caps
operator|.
name|mc_promisc_mode
operator|<<
name|SET_PORT_PROMISC_MODE_SHIFT
operator|)
operator||
name|base_qpn
argument_list|)
expr_stmt|;
name|context
operator|->
name|intra_no_vlan
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|no_vlan
operator|=
name|MLX4_NO_VLAN_IDX
expr_stmt|;
name|context
operator|->
name|intra_vlan_miss
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|vlan_miss
operator|=
name|MLX4_VLAN_MISS_IDX
expr_stmt|;
name|in_mod
operator|=
name|MLX4_SET_PORT_RQP_CALC
operator|<<
literal|8
operator||
name|port
expr_stmt|;
name|err
operator|=
name|mlx4_cmd
argument_list|(
name|dev
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|in_mod
argument_list|,
literal|1
argument_list|,
name|MLX4_CMD_SET_PORT
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|)
expr_stmt|;
name|mlx4_free_cmd_mailbox
argument_list|(
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|int
name|mlx4_en_QUERY_PORT
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|)
block|{
name|struct
name|mlx4_en_query_port_context
modifier|*
name|qport_context
decl_stmt|;
name|struct
name|mlx4_en_priv
modifier|*
name|priv
init|=
name|netdev_priv
argument_list|(
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
argument_list|)
decl_stmt|;
name|struct
name|mlx4_en_port_state
modifier|*
name|state
init|=
operator|&
name|priv
operator|->
name|port_state
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|int
name|err
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|memset
argument_list|(
name|mailbox
operator|->
name|buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|qport_context
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|port
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_QUERY_PORT
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|qport_context
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
comment|/* This command is always accessed from Ethtool context 	 * already synchronized, no need in locking */
name|state
operator|->
name|link_state
operator|=
operator|!
operator|!
operator|(
name|qport_context
operator|->
name|link_up
operator|&
name|MLX4_EN_LINK_UP_MASK
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|qport_context
operator|->
name|link_speed
operator|&
name|MLX4_EN_SPEED_MASK
operator|)
operator|==
name|MLX4_EN_1G_SPEED
condition|)
name|state
operator|->
name|link_speed
operator|=
literal|1000
expr_stmt|;
else|else
name|state
operator|->
name|link_speed
operator|=
literal|10000
expr_stmt|;
name|state
operator|->
name|transciver
operator|=
name|qport_context
operator|->
name|transceiver
expr_stmt|;
if|if
condition|(
name|be32_to_cpu
argument_list|(
name|qport_context
operator|->
name|transceiver_code_hi
argument_list|)
operator|&
literal|0x400
condition|)
name|state
operator|->
name|transciver
operator|=
literal|0x80
expr_stmt|;
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|read_iboe_counters
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|index
parameter_list|,
name|u64
name|counters
index|[]
parameter_list|)
block|{
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|int
name|err
decl_stmt|;
name|int
name|mode
decl_stmt|;
name|struct
name|mlx4_counters_ext
modifier|*
name|ext
decl_stmt|;
name|struct
name|mlx4_counters
modifier|*
name|reg
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
operator|-
name|ENOMEM
return|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|index
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_QUERY_IF_STAT
argument_list|,
name|MLX4_CMD_TIME_CLASS_C
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|mode
operator|=
name|be32_to_cpu
argument_list|(
operator|(
operator|(
expr|struct
name|mlx4_counters
operator|*
operator|)
name|mailbox
operator|->
name|buf
operator|)
operator|->
name|counter_mode
argument_list|)
operator|&
literal|0xf
expr_stmt|;
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
literal|0
case|:
name|reg
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|counters
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|reg
operator|->
name|rx_frames
argument_list|)
expr_stmt|;
name|counters
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|reg
operator|->
name|tx_frames
argument_list|)
expr_stmt|;
name|counters
index|[
literal|2
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|reg
operator|->
name|rx_bytes
argument_list|)
expr_stmt|;
name|counters
index|[
literal|3
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|reg
operator|->
name|tx_bytes
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|ext
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|counters
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|ext
operator|->
name|rx_uni_frames
argument_list|)
expr_stmt|;
name|counters
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|ext
operator|->
name|tx_uni_frames
argument_list|)
expr_stmt|;
name|counters
index|[
literal|2
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|ext
operator|->
name|rx_uni_bytes
argument_list|)
expr_stmt|;
name|counters
index|[
literal|3
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|ext
operator|->
name|tx_uni_bytes
argument_list|)
expr_stmt|;
break|break;
default|default:
name|err
operator|=
operator|-
name|EINVAL
expr_stmt|;
block|}
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|int
name|mlx4_en_DUMP_ETH_STATS
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u8
name|reset
parameter_list|)
block|{
name|struct
name|mlx4_en_stat_out_mbox
modifier|*
name|mlx4_en_stats
decl_stmt|;
name|struct
name|net_device
modifier|*
name|dev
decl_stmt|;
name|struct
name|mlx4_en_priv
modifier|*
name|priv
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|u64
name|in_mod
init|=
name|reset
operator|<<
literal|8
operator||
name|port
decl_stmt|;
name|unsigned
name|long
name|oerror
decl_stmt|;
name|unsigned
name|long
name|ierror
decl_stmt|;
name|int
name|err
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|u64
name|counters
index|[
literal|4
index|]
decl_stmt|;
name|dev
operator|=
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
expr_stmt|;
name|priv
operator|=
name|netdev_priv
argument_list|(
name|dev
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|counters
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
name|counters
argument_list|)
expr_stmt|;
name|counter
operator|=
name|mlx4_get_iboe_counter
argument_list|(
name|priv
operator|->
name|mdev
operator|->
name|dev
argument_list|,
name|port
argument_list|)
expr_stmt|;
if|if
condition|(
name|counter
operator|>=
literal|0
condition|)
name|err
operator|=
name|read_iboe_counters
argument_list|(
name|priv
operator|->
name|mdev
operator|->
name|dev
argument_list|,
name|counter
argument_list|,
name|counters
argument_list|)
expr_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|memset
argument_list|(
name|mailbox
operator|->
name|buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|mlx4_en_stats
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|in_mod
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_DUMP_ETH_STATS
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|mlx4_en_stats
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|spin_lock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|oerror
operator|=
name|ierror
operator|=
literal|0
expr_stmt|;
name|dev
operator|->
name|if_ipackets
operator|=
name|counters
index|[
literal|0
index|]
expr_stmt|;
name|dev
operator|->
name|if_ibytes
operator|=
name|counters
index|[
literal|2
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|priv
operator|->
name|rx_ring_num
condition|;
name|i
operator|++
control|)
block|{
name|dev
operator|->
name|if_ipackets
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|.
name|packets
expr_stmt|;
name|dev
operator|->
name|if_ibytes
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|.
name|bytes
expr_stmt|;
name|ierror
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|.
name|errors
expr_stmt|;
block|}
name|dev
operator|->
name|if_opackets
operator|=
name|counters
index|[
literal|1
index|]
expr_stmt|;
name|dev
operator|->
name|if_obytes
operator|=
name|counters
index|[
literal|3
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|priv
operator|->
name|tx_ring_num
condition|;
name|i
operator|++
control|)
block|{
name|dev
operator|->
name|if_opackets
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|.
name|packets
expr_stmt|;
name|dev
operator|->
name|if_obytes
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|.
name|bytes
expr_stmt|;
name|oerror
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|.
name|errors
expr_stmt|;
block|}
name|dev
operator|->
name|if_ierrors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RDROP
argument_list|)
operator|+
name|ierror
expr_stmt|;
name|dev
operator|->
name|if_oerrors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TDROP
argument_list|)
operator|+
name|oerror
expr_stmt|;
name|dev
operator|->
name|if_imcasts
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_novlan
argument_list|)
expr_stmt|;
name|dev
operator|->
name|if_omcasts
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_novlan
argument_list|)
expr_stmt|;
name|dev
operator|->
name|if_collisions
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|broadcast
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|2
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|3
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|4
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|5
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|6
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|7
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_7
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|2
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|3
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|4
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|5
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|6
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|7
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_7
argument_list|)
expr_stmt|;
name|spin_unlock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

end_unit

