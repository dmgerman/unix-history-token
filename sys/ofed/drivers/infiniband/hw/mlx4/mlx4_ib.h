begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2006, 2007 Cisco Systems.  All rights reserved.  * Copyright (c) 2007, 2008 Mellanox Technologies. All rights reserved.  *  * This software is available to you under a choice of one of two  * licenses.  You may choose to be licensed under the terms of the GNU  * General Public License (GPL) Version 2, available from the file  * COPYING in the main directory of this source tree, or the  * OpenIB.org BSD license below:  *  *     Redistribution and use in source and binary forms, with or  *     without modification, are permitted provided that the following  *     conditions are met:  *  *      - Redistributions of source code must retain the above  *        copyright notice, this list of conditions and the following  *        disclaimer.  *  *      - Redistributions in binary form must reproduce the above  *        copyright notice, this list of conditions and the following  *        disclaimer in the documentation and/or other materials  *        provided with the distribution.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN  * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  * SOFTWARE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|MLX4_IB_H
end_ifndef

begin_define
define|#
directive|define
name|MLX4_IB_H
end_define

begin_include
include|#
directive|include
file|<linux/compiler.h>
end_include

begin_include
include|#
directive|include
file|<linux/list.h>
end_include

begin_include
include|#
directive|include
file|<linux/mutex.h>
end_include

begin_include
include|#
directive|include
file|<rdma/ib_verbs.h>
end_include

begin_include
include|#
directive|include
file|<rdma/ib_umem.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/device.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/doorbell.h>
end_include

begin_define
define|#
directive|define
name|MLX4_IB_DRV_NAME
value|"mlx4_ib"
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_MLX4_DEBUG
end_ifdef

begin_decl_stmt
specifier|extern
name|int
name|mlx4_ib_debug_level
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|mlx4_ib_dbg
parameter_list|(
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|do {					\ 		if (mlx4_ib_debug_level) 	\ 			printk(KERN_DEBUG "<" MLX4_IB_DRV_NAME "> %s: " format "\n",\ 			__func__, ## arg);	\ 	} while (0)
end_define

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* CONFIG_MLX4_DEBUG */
end_comment

begin_define
define|#
directive|define
name|mlx4_ib_dbg
parameter_list|(
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
value|do {} while (0)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_MLX4_DEBUG */
end_comment

begin_enum
enum|enum
block|{
name|MLX4_IB_SQ_MIN_WQE_SHIFT
init|=
literal|6
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|MLX4_IB_SQ_HEADROOM
parameter_list|(
name|shift
parameter_list|)
value|((2048>> (shift)) + 1)
end_define

begin_define
define|#
directive|define
name|MLX4_IB_SQ_MAX_SPARE
value|(MLX4_IB_SQ_HEADROOM(MLX4_IB_SQ_MIN_WQE_SHIFT))
end_define

begin_struct
struct|struct
name|mlx4_ib_ucontext
block|{
name|struct
name|ib_ucontext
name|ibucontext
decl_stmt|;
name|struct
name|mlx4_uar
name|uar
decl_stmt|;
name|struct
name|list_head
name|db_page_list
decl_stmt|;
name|struct
name|mutex
name|db_page_mutex
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_pd
block|{
name|struct
name|ib_pd
name|ibpd
decl_stmt|;
name|u32
name|pdn
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_xrcd
block|{
name|struct
name|ib_xrcd
name|ibxrcd
decl_stmt|;
name|u32
name|xrcdn
decl_stmt|;
name|struct
name|ib_pd
modifier|*
name|pd
decl_stmt|;
name|struct
name|ib_cq
modifier|*
name|cq
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_cq_buf
block|{
name|struct
name|mlx4_buf
name|buf
decl_stmt|;
name|struct
name|mlx4_mtt
name|mtt
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_cq_resize
block|{
name|struct
name|mlx4_ib_cq_buf
name|buf
decl_stmt|;
name|int
name|cqe
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_cq
block|{
name|struct
name|ib_cq
name|ibcq
decl_stmt|;
name|struct
name|mlx4_cq
name|mcq
decl_stmt|;
name|struct
name|mlx4_ib_cq_buf
name|buf
decl_stmt|;
name|struct
name|mlx4_ib_cq_resize
modifier|*
name|resize_buf
decl_stmt|;
name|struct
name|mlx4_db
name|db
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|struct
name|mutex
name|resize_mutex
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|resize_umem
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_mr
block|{
name|struct
name|ib_mr
name|ibmr
decl_stmt|;
name|struct
name|mlx4_mr
name|mmr
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_fast_reg_page_list
block|{
name|struct
name|ib_fast_reg_page_list
name|ibfrpl
decl_stmt|;
name|__be64
modifier|*
name|mapped_page_list
decl_stmt|;
name|dma_addr_t
name|map
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_fmr
block|{
name|struct
name|ib_fmr
name|ibfmr
decl_stmt|;
name|struct
name|mlx4_fmr
name|mfmr
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_wq
block|{
name|u64
modifier|*
name|wrid
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|int
name|wqe_cnt
decl_stmt|;
name|int
name|max_post
decl_stmt|;
name|int
name|max_gs
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|wqe_shift
decl_stmt|;
name|unsigned
name|head
decl_stmt|;
name|unsigned
name|tail
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
name|mlx4_ib_qp_flags
block|{
name|MLX4_IB_QP_LSO
init|=
literal|1
operator|<<
literal|0
block|,
name|MLX4_IB_QP_BLOCK_MULTICAST_LOOPBACK
init|=
literal|1
operator|<<
literal|1
block|,
name|MLX4_IB_XRC_RCV
init|=
literal|1
operator|<<
literal|2
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|gid_entry
block|{
name|struct
name|list_head
name|list
decl_stmt|;
name|union
name|ib_gid
name|gid
decl_stmt|;
name|int
name|added
decl_stmt|;
name|u8
name|port
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_qp
block|{
name|struct
name|ib_qp
name|ibqp
decl_stmt|;
name|struct
name|mlx4_qp
name|mqp
decl_stmt|;
name|struct
name|mlx4_buf
name|buf
decl_stmt|;
name|struct
name|mlx4_db
name|db
decl_stmt|;
name|struct
name|mlx4_ib_wq
name|rq
decl_stmt|;
name|u32
name|doorbell_qpn
decl_stmt|;
name|__be32
name|sq_signal_bits
decl_stmt|;
name|unsigned
name|sq_next_wqe
decl_stmt|;
name|int
name|sq_max_wqes_per_wr
decl_stmt|;
name|int
name|sq_spare_wqes
decl_stmt|;
name|struct
name|mlx4_ib_wq
name|sq
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
name|struct
name|mlx4_mtt
name|mtt
decl_stmt|;
name|int
name|buf_size
decl_stmt|;
name|struct
name|mutex
name|mutex
decl_stmt|;
name|u32
name|flags
decl_stmt|;
name|struct
name|list_head
name|xrc_reg_list
decl_stmt|;
name|spinlock_t
name|xrc_reg_list_lock
decl_stmt|;
name|u16
name|xrcdn
decl_stmt|;
name|u8
name|port
decl_stmt|;
name|u8
name|alt_port
decl_stmt|;
name|u8
name|atomic_rd_en
decl_stmt|;
name|u8
name|resp_depth
decl_stmt|;
name|u8
name|sq_no_prefetch
decl_stmt|;
name|u8
name|state
decl_stmt|;
name|int
name|mlx_type
decl_stmt|;
name|struct
name|list_head
name|gid_list
decl_stmt|;
name|int
name|max_inline_data
decl_stmt|;
name|struct
name|mlx4_bf
name|bf
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_srq
block|{
name|struct
name|ib_srq
name|ibsrq
decl_stmt|;
name|struct
name|mlx4_srq
name|msrq
decl_stmt|;
name|struct
name|mlx4_buf
name|buf
decl_stmt|;
name|struct
name|mlx4_db
name|db
decl_stmt|;
name|u64
modifier|*
name|wrid
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|int
name|head
decl_stmt|;
name|int
name|tail
decl_stmt|;
name|u16
name|wqe_ctr
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
name|struct
name|mlx4_mtt
name|mtt
decl_stmt|;
name|struct
name|mutex
name|mutex
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_ah
block|{
name|struct
name|ib_ah
name|ibah
decl_stmt|;
name|union
name|mlx4_ext_av
name|av
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_iboe
block|{
name|spinlock_t
name|lock
decl_stmt|;
name|struct
name|net_device
modifier|*
name|netdevs
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
name|struct
name|notifier_block
name|nb
decl_stmt|;
name|union
name|ib_gid
name|gid_table
index|[
name|MLX4_MAX_PORTS
index|]
index|[
literal|128
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_ib_dev
block|{
name|struct
name|ib_device
name|ib_dev
decl_stmt|;
name|struct
name|mlx4_dev
modifier|*
name|dev
decl_stmt|;
name|int
name|num_ports
decl_stmt|;
name|struct
name|mlx4_uar
name|priv_uar
decl_stmt|;
name|u32
name|priv_pdn
decl_stmt|;
name|MLX4_DECLARE_DOORBELL_LOCK
argument_list|(
name|uar_lock
argument_list|)
expr_stmt|;
name|struct
name|ib_mad_agent
modifier|*
name|send_agent
index|[
name|MLX4_MAX_PORTS
index|]
index|[
literal|2
index|]
decl_stmt|;
name|struct
name|ib_ah
modifier|*
name|sm_ah
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
name|spinlock_t
name|sm_lock
decl_stmt|;
name|struct
name|mutex
name|cap_mask_mutex
decl_stmt|;
name|struct
name|mutex
name|xrc_reg_mutex
decl_stmt|;
name|int
name|ib_active
decl_stmt|;
name|struct
name|mlx4_ib_iboe
name|iboe
decl_stmt|;
name|int
name|counters
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_dev
modifier|*
name|to_mdev
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibdev
argument_list|,
expr|struct
name|mlx4_ib_dev
argument_list|,
name|ib_dev
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_ucontext
modifier|*
name|to_mucontext
parameter_list|(
name|struct
name|ib_ucontext
modifier|*
name|ibucontext
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibucontext
argument_list|,
expr|struct
name|mlx4_ib_ucontext
argument_list|,
name|ibucontext
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_pd
modifier|*
name|to_mpd
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|ibpd
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibpd
argument_list|,
expr|struct
name|mlx4_ib_pd
argument_list|,
name|ibpd
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_xrcd
modifier|*
name|to_mxrcd
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|ibxrcd
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibxrcd
argument_list|,
expr|struct
name|mlx4_ib_xrcd
argument_list|,
name|ibxrcd
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_cq
modifier|*
name|to_mcq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibcq
argument_list|,
expr|struct
name|mlx4_ib_cq
argument_list|,
name|ibcq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_cq
modifier|*
name|to_mibcq
parameter_list|(
name|struct
name|mlx4_cq
modifier|*
name|mcq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|mcq
argument_list|,
expr|struct
name|mlx4_ib_cq
argument_list|,
name|mcq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_mr
modifier|*
name|to_mmr
parameter_list|(
name|struct
name|ib_mr
modifier|*
name|ibmr
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibmr
argument_list|,
expr|struct
name|mlx4_ib_mr
argument_list|,
name|ibmr
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_fast_reg_page_list
modifier|*
name|to_mfrpl
parameter_list|(
name|struct
name|ib_fast_reg_page_list
modifier|*
name|ibfrpl
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibfrpl
argument_list|,
expr|struct
name|mlx4_ib_fast_reg_page_list
argument_list|,
name|ibfrpl
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_fmr
modifier|*
name|to_mfmr
parameter_list|(
name|struct
name|ib_fmr
modifier|*
name|ibfmr
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibfmr
argument_list|,
expr|struct
name|mlx4_ib_fmr
argument_list|,
name|ibfmr
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_qp
modifier|*
name|to_mqp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibqp
argument_list|,
expr|struct
name|mlx4_ib_qp
argument_list|,
name|ibqp
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_qp
modifier|*
name|to_mibqp
parameter_list|(
name|struct
name|mlx4_qp
modifier|*
name|mqp
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|mqp
argument_list|,
expr|struct
name|mlx4_ib_qp
argument_list|,
name|mqp
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_srq
modifier|*
name|to_msrq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibsrq
argument_list|,
expr|struct
name|mlx4_ib_srq
argument_list|,
name|ibsrq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_srq
modifier|*
name|to_mibsrq
parameter_list|(
name|struct
name|mlx4_srq
modifier|*
name|msrq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|msrq
argument_list|,
expr|struct
name|mlx4_ib_srq
argument_list|,
name|msrq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_ib_ah
modifier|*
name|to_mah
parameter_list|(
name|struct
name|ib_ah
modifier|*
name|ibah
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibah
argument_list|,
expr|struct
name|mlx4_ib_ah
argument_list|,
name|ibah
argument_list|)
return|;
block|}
end_function

begin_function_decl
name|int
name|mlx4_ib_db_map_user
parameter_list|(
name|struct
name|mlx4_ib_ucontext
modifier|*
name|context
parameter_list|,
name|unsigned
name|long
name|virt
parameter_list|,
name|struct
name|mlx4_db
modifier|*
name|db
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_ib_db_unmap_user
parameter_list|(
name|struct
name|mlx4_ib_ucontext
modifier|*
name|context
parameter_list|,
name|struct
name|mlx4_db
modifier|*
name|db
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx4_ib_get_dma_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|int
name|acc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_umem_write_mtt
parameter_list|(
name|struct
name|mlx4_ib_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_mtt
modifier|*
name|mtt
parameter_list|,
name|struct
name|ib_umem
modifier|*
name|umem
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx4_ib_reg_user_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|u64
name|start
parameter_list|,
name|u64
name|length
parameter_list|,
name|u64
name|virt_addr
parameter_list|,
name|int
name|access_flags
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_dereg_mr
parameter_list|(
name|struct
name|ib_mr
modifier|*
name|mr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx4_ib_alloc_fast_reg_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|int
name|max_page_list_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_fast_reg_page_list
modifier|*
name|mlx4_ib_alloc_fast_reg_page_list
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|int
name|page_list_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_ib_free_fast_reg_page_list
parameter_list|(
name|struct
name|ib_fast_reg_page_list
modifier|*
name|page_list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_modify_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|cq
parameter_list|,
name|u16
name|cq_count
parameter_list|,
name|u16
name|cq_period
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_resize_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|,
name|int
name|entries
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_cq
modifier|*
name|mlx4_ib_create_cq
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|int
name|entries
parameter_list|,
name|int
name|vector
parameter_list|,
name|struct
name|ib_ucontext
modifier|*
name|context
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_destroy_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_poll_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|,
name|int
name|num_entries
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|wc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_arm_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|cq
parameter_list|,
name|enum
name|ib_cq_notify_flags
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_ib_cq_clean
parameter_list|(
name|struct
name|mlx4_ib_cq
modifier|*
name|cq
parameter_list|,
name|u32
name|qpn
parameter_list|,
name|struct
name|mlx4_ib_srq
modifier|*
name|srq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_ib_cq_clean
parameter_list|(
name|struct
name|mlx4_ib_cq
modifier|*
name|cq
parameter_list|,
name|u32
name|qpn
parameter_list|,
name|struct
name|mlx4_ib_srq
modifier|*
name|srq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_ah
modifier|*
name|mlx4_ib_create_ah
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_ah_attr
modifier|*
name|ah_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_query_ah
parameter_list|(
name|struct
name|ib_ah
modifier|*
name|ibah
parameter_list|,
name|struct
name|ib_ah_attr
modifier|*
name|ah_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_destroy_ah
parameter_list|(
name|struct
name|ib_ah
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_srq
modifier|*
name|mlx4_ib_create_srq
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_srq_init_attr
modifier|*
name|init_attr
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_srq
modifier|*
name|mlx4_ib_create_xrc_srq
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_cq
modifier|*
name|xrc_cq
parameter_list|,
name|struct
name|ib_xrcd
modifier|*
name|xrcd
parameter_list|,
name|struct
name|ib_srq_init_attr
modifier|*
name|init_attr
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_modify_srq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|,
name|struct
name|ib_srq_attr
modifier|*
name|attr
parameter_list|,
name|enum
name|ib_srq_attr_mask
name|attr_mask
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_query_srq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|srq
parameter_list|,
name|struct
name|ib_srq_attr
modifier|*
name|srq_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_destroy_srq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|srq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_ib_free_srq_wqe
parameter_list|(
name|struct
name|mlx4_ib_srq
modifier|*
name|srq
parameter_list|,
name|int
name|wqe_index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_post_srq_recv
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
name|wr
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
modifier|*
name|bad_wr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_qp
modifier|*
name|mlx4_ib_create_qp
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_qp_init_attr
modifier|*
name|init_attr
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_destroy_qp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|qp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_modify_qp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_qp_attr
modifier|*
name|attr
parameter_list|,
name|int
name|attr_mask
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_query_qp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_qp_attr
modifier|*
name|qp_attr
parameter_list|,
name|int
name|qp_attr_mask
parameter_list|,
name|struct
name|ib_qp_init_attr
modifier|*
name|qp_init_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_post_send
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_send_wr
modifier|*
name|wr
parameter_list|,
name|struct
name|ib_send_wr
modifier|*
modifier|*
name|bad_wr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_post_recv
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
name|wr
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
modifier|*
name|bad_wr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_MAD_IFC
parameter_list|(
name|struct
name|mlx4_ib_dev
modifier|*
name|dev
parameter_list|,
name|int
name|ignore_mkey
parameter_list|,
name|int
name|ignore_bkey
parameter_list|,
name|int
name|port
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|in_wc
parameter_list|,
name|struct
name|ib_grh
modifier|*
name|in_grh
parameter_list|,
name|void
modifier|*
name|in_mad
parameter_list|,
name|void
modifier|*
name|response_mad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_process_mad
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|int
name|mad_flags
parameter_list|,
name|u8
name|port_num
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|in_wc
parameter_list|,
name|struct
name|ib_grh
modifier|*
name|in_grh
parameter_list|,
name|struct
name|ib_mad
modifier|*
name|in_mad
parameter_list|,
name|struct
name|ib_mad
modifier|*
name|out_mad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_mad_init
parameter_list|(
name|struct
name|mlx4_ib_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_ib_mad_cleanup
parameter_list|(
name|struct
name|mlx4_ib_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_fmr
modifier|*
name|mlx4_ib_fmr_alloc
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|int
name|mr_access_flags
parameter_list|,
name|struct
name|ib_fmr_attr
modifier|*
name|fmr_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_map_phys_fmr
parameter_list|(
name|struct
name|ib_fmr
modifier|*
name|ibfmr
parameter_list|,
name|u64
modifier|*
name|page_list
parameter_list|,
name|int
name|npages
parameter_list|,
name|u64
name|iova
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_unmap_fmr
parameter_list|(
name|struct
name|list_head
modifier|*
name|fmr_list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_fmr_dealloc
parameter_list|(
name|struct
name|ib_fmr
modifier|*
name|fmr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_create_xrc_rcv_qp
parameter_list|(
name|struct
name|ib_qp_init_attr
modifier|*
name|init_attr
parameter_list|,
name|u32
modifier|*
name|qp_num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_modify_xrc_rcv_qp
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|xrcd
parameter_list|,
name|u32
name|qp_num
parameter_list|,
name|struct
name|ib_qp_attr
modifier|*
name|attr
parameter_list|,
name|int
name|attr_mask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_query_xrc_rcv_qp
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|xrcd
parameter_list|,
name|u32
name|qp_num
parameter_list|,
name|struct
name|ib_qp_attr
modifier|*
name|attr
parameter_list|,
name|int
name|attr_mask
parameter_list|,
name|struct
name|ib_qp_init_attr
modifier|*
name|init_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_reg_xrc_rcv_qp
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|xrcd
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u32
name|qp_num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_unreg_xrc_rcv_qp
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|xrcd
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u32
name|qp_num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ib_resolve_grh
parameter_list|(
name|struct
name|mlx4_ib_dev
modifier|*
name|dev
parameter_list|,
specifier|const
name|struct
name|ib_ah_attr
modifier|*
name|ah_attr
parameter_list|,
name|u8
modifier|*
name|mac
parameter_list|,
name|int
modifier|*
name|is_mcast
parameter_list|,
name|u8
name|port
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
specifier|inline
name|int
name|mlx4_ib_ah_grh_present
parameter_list|(
name|struct
name|mlx4_ib_ah
modifier|*
name|ah
parameter_list|)
block|{
name|u8
name|port
init|=
name|be32_to_cpu
argument_list|(
name|ah
operator|->
name|av
operator|.
name|ib
operator|.
name|port_pd
argument_list|)
operator|>>
literal|24
operator|&
literal|3
decl_stmt|;
if|if
condition|(
name|rdma_port_get_link_layer
argument_list|(
name|ah
operator|->
name|ibah
operator|.
name|device
argument_list|,
name|port
argument_list|)
operator|==
name|IB_LINK_LAYER_ETHERNET
condition|)
return|return
literal|1
return|;
return|return
operator|!
operator|!
operator|(
name|ah
operator|->
name|av
operator|.
name|ib
operator|.
name|g_slid
operator|&
literal|0x80
operator|)
return|;
block|}
end_function

begin_function_decl
name|int
name|mlx4_ib_add_mc
parameter_list|(
name|struct
name|mlx4_ib_dev
modifier|*
name|mdev
parameter_list|,
name|struct
name|mlx4_ib_qp
modifier|*
name|mqp
parameter_list|,
name|union
name|ib_gid
modifier|*
name|gid
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* MLX4_IB_H */
end_comment

end_unit

