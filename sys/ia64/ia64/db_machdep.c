begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2003-2005 Marcel Moolenaar  * Copyright (c) 2000-2001 Doug Rabson  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"opt_xtrace.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/cons.h>
end_include

begin_include
include|#
directive|include
file|<sys/kdb.h>
end_include

begin_include
include|#
directive|include
file|<sys/ktr.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/proc.h>
end_include

begin_include
include|#
directive|include
file|<sys/reboot.h>
end_include

begin_include
include|#
directive|include
file|<sys/smp.h>
end_include

begin_include
include|#
directive|include
file|<sys/stack.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm.h>
end_include

begin_include
include|#
directive|include
file|<machine/db_machdep.h>
end_include

begin_include
include|#
directive|include
file|<machine/frame.h>
end_include

begin_include
include|#
directive|include
file|<machine/kdb.h>
end_include

begin_include
include|#
directive|include
file|<machine/md_var.h>
end_include

begin_include
include|#
directive|include
file|<machine/pcb.h>
end_include

begin_include
include|#
directive|include
file|<machine/setjmp.h>
end_include

begin_include
include|#
directive|include
file|<machine/unwind.h>
end_include

begin_include
include|#
directive|include
file|<machine/vmparam.h>
end_include

begin_include
include|#
directive|include
file|<ddb/ddb.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_access.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_output.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_sym.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_variables.h>
end_include

begin_include
include|#
directive|include
file|<ia64/disasm/disasm.h>
end_include

begin_define
define|#
directive|define
name|TMPL_BITS
value|5
end_define

begin_define
define|#
directive|define
name|TMPL_MASK
value|((1<< TMPL_BITS) - 1)
end_define

begin_define
define|#
directive|define
name|SLOT_BITS
value|41
end_define

begin_define
define|#
directive|define
name|SLOT_COUNT
value|3
end_define

begin_define
define|#
directive|define
name|SLOT_MASK
value|((1ULL<< SLOT_BITS) - 1ULL)
end_define

begin_define
define|#
directive|define
name|SLOT_SHIFT
parameter_list|(
name|i
parameter_list|)
value|(TMPL_BITS+((i)<<3)+(i))
end_define

begin_typedef
typedef|typedef
name|db_expr_t
name|__db_f
parameter_list|(
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|,
name|db_expr_t
parameter_list|)
function_decl|;
end_typedef

begin_decl_stmt
specifier|register
name|uint64_t
name|__db_gp
name|__asm__
argument_list|(
literal|"gp"
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|db_varfcn_t
name|db_frame
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|db_varfcn_t
name|db_getip
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|db_varfcn_t
name|db_getrse
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|DB_OFFSET
parameter_list|(
name|x
parameter_list|)
value|(db_expr_t *)offsetof(struct trapframe, x)
end_define

begin_decl_stmt
name|struct
name|db_variable
name|db_regs
index|[]
init|=
block|{
block|{
literal|"ip"
block|,
name|NULL
block|,
name|db_getip
block|}
block|,
block|{
literal|"cr.ifs"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|cfm
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"cr.ifa"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|ifa
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ar.bspstore"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|bspstore
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ndirty"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|ndirty
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"rp"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|rp
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ar.pfs"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|pfs
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"psr"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|psr
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"cr.isr"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|isr
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"pr"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|pr
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ar.rsc"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|rsc
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ar.rnat"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|rnat
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ar.unat"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|unat
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"ar.fpsr"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|fpsr
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"gp"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|gp
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"sp"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|sp
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"tp"
block|,
name|DB_OFFSET
argument_list|(
name|tf_special
operator|.
name|tp
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"b6"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|br6
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"b7"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|br7
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r2"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr2
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r3"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr3
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r8"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr8
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r9"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr9
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r10"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr10
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r11"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr11
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r14"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr14
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r15"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr15
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r16"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr16
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r17"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr17
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r18"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr18
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r19"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr19
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r20"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr20
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r21"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr21
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r22"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr22
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r23"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr23
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r24"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr24
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r25"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr25
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r26"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr26
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r27"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr27
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r28"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr28
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r29"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr29
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r30"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr30
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r31"
block|,
name|DB_OFFSET
argument_list|(
name|tf_scratch
operator|.
name|gr31
argument_list|)
block|,
name|db_frame
block|}
block|,
block|{
literal|"r32"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|0
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r33"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|1
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r34"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|2
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r35"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|3
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r36"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|4
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r37"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|5
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r38"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|6
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r39"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|7
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r40"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|8
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r41"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|9
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r42"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|10
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r43"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|11
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r44"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|12
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r45"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|13
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r46"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|14
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r47"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|15
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r48"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|16
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r49"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|17
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r50"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|18
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r51"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|19
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r52"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|20
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r53"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|21
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r54"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|22
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r55"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|23
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r56"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|24
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r57"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|25
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r58"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|26
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r59"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|27
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r60"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|28
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r61"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|29
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r62"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|30
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r63"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|31
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r64"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|32
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r65"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|33
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r66"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|34
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r67"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|35
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r68"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|36
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r69"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|37
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r70"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|38
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r71"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|39
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r72"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|40
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r73"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|41
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r74"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|42
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r75"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|43
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r76"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|44
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r77"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|45
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r78"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|46
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r79"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|47
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r80"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|48
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r81"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|49
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r82"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|50
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r83"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|51
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r84"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|52
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r85"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|53
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r86"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|54
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r87"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|55
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r88"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|56
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r89"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|57
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r90"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|58
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r91"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|59
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r92"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|60
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r93"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|61
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r94"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|62
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r95"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|63
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r96"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|64
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r97"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|65
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r98"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|66
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r99"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|67
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r100"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|68
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r101"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|69
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r102"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|70
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r103"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|71
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r104"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|72
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r105"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|73
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r106"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|74
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r107"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|75
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r108"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|76
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r109"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|77
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r110"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|78
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r111"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|79
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r112"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|80
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r113"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|81
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r114"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|82
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r115"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|83
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r116"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|84
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r117"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|85
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r118"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|86
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r119"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|87
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r120"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|88
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r121"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|89
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r122"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|90
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r123"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|91
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r124"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|92
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r125"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|93
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r126"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|94
block|,
name|db_getrse
block|}
block|,
block|{
literal|"r127"
block|,
operator|(
name|db_expr_t
operator|*
operator|)
literal|95
block|,
name|db_getrse
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|db_variable
modifier|*
name|db_eregs
init|=
name|db_regs
operator|+
sizeof|sizeof
argument_list|(
name|db_regs
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|db_regs
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|db_backtrace
parameter_list|(
name|struct
name|thread
modifier|*
name|td
parameter_list|,
name|struct
name|pcb
modifier|*
name|pcb
parameter_list|,
name|int
name|count
parameter_list|)
block|{
name|struct
name|unw_regstate
name|rs
decl_stmt|;
name|struct
name|trapframe
modifier|*
name|tf
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|db_expr_t
name|offset
decl_stmt|;
name|uint64_t
name|bsp
decl_stmt|,
name|cfm
decl_stmt|,
name|ip
decl_stmt|,
name|pfs
decl_stmt|,
name|reg
decl_stmt|,
name|sp
decl_stmt|;
name|c_db_sym_t
name|sym
decl_stmt|;
name|int
name|args
decl_stmt|,
name|error
decl_stmt|,
name|i
decl_stmt|;
name|error
operator|=
name|unw_create_from_pcb
argument_list|(
operator|&
name|rs
argument_list|,
name|pcb
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|error
operator|&&
name|count
operator|--
operator|&&
operator|!
name|db_pager_quit
condition|)
block|{
name|error
operator|=
name|unw_get_cfm
argument_list|(
operator|&
name|rs
argument_list|,
operator|&
name|cfm
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
name|error
operator|=
name|unw_get_bsp
argument_list|(
operator|&
name|rs
argument_list|,
operator|&
name|bsp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
name|error
operator|=
name|unw_get_ip
argument_list|(
operator|&
name|rs
argument_list|,
operator|&
name|ip
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
name|error
operator|=
name|unw_get_sp
argument_list|(
operator|&
name|rs
argument_list|,
operator|&
name|sp
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
break|break;
name|args
operator|=
name|IA64_CFM_SOL
argument_list|(
name|cfm
argument_list|)
expr_stmt|;
if|if
condition|(
name|args
operator|>
literal|8
condition|)
name|args
operator|=
literal|8
expr_stmt|;
name|error
operator|=
name|unw_step
argument_list|(
operator|&
name|rs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
if|if
condition|(
operator|!
name|unw_get_cfm
argument_list|(
operator|&
name|rs
argument_list|,
operator|&
name|pfs
argument_list|)
condition|)
block|{
name|i
operator|=
name|IA64_CFM_SOF
argument_list|(
name|pfs
argument_list|)
operator|-
name|IA64_CFM_SOL
argument_list|(
name|pfs
argument_list|)
expr_stmt|;
if|if
condition|(
name|args
operator|>
name|i
condition|)
name|args
operator|=
name|i
expr_stmt|;
block|}
block|}
name|sym
operator|=
name|db_search_symbol
argument_list|(
name|ip
argument_list|,
name|DB_STGY_ANY
argument_list|,
operator|&
name|offset
argument_list|)
expr_stmt|;
name|db_symbol_values
argument_list|(
name|sym
argument_list|,
operator|&
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s("
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|bsp
operator|>=
name|VM_MAXUSER_ADDRESS
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|args
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|bsp
operator|&
literal|0x1ff
operator|)
operator|==
literal|0x1f8
condition|)
name|bsp
operator|+=
literal|8
expr_stmt|;
name|db_read_bytes
argument_list|(
name|bsp
argument_list|,
sizeof|sizeof
argument_list|(
name|reg
argument_list|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|reg
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
literal|0
condition|)
name|db_printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"0x%lx"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|bsp
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
name|db_printf
argument_list|(
literal|"..."
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|") at "
argument_list|)
expr_stmt|;
name|db_printsym
argument_list|(
name|ip
argument_list|,
name|DB_STGY_PROC
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|!=
name|ERESTART
condition|)
continue|continue;
if|if
condition|(
name|sp
operator|<
name|VM_MAXUSER_ADDRESS
condition|)
break|break;
name|tf
operator|=
operator|(
expr|struct
name|trapframe
operator|*
operator|)
operator|(
name|sp
operator|+
literal|16
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|tf
operator|->
name|tf_flags
operator|&
name|FRAME_SYSCALL
operator|)
operator|!=
literal|0
operator|||
name|tf
operator|->
name|tf_special
operator|.
name|iip
operator|<
name|VM_MAXUSER_ADDRESS
condition|)
break|break;
comment|/* XXX ask if we should unwind across the trapframe. */
name|db_printf
argument_list|(
literal|"--- trapframe at %p\n"
argument_list|,
name|tf
argument_list|)
expr_stmt|;
name|unw_delete
argument_list|(
operator|&
name|rs
argument_list|)
expr_stmt|;
name|error
operator|=
name|unw_create_from_frame
argument_list|(
operator|&
name|rs
argument_list|,
name|tf
argument_list|)
expr_stmt|;
block|}
name|unw_delete
argument_list|(
operator|&
name|rs
argument_list|)
expr_stmt|;
comment|/* 	 * EJUSTRETURN and ERESTART signal the end of a trace and 	 * are not really errors. 	 */
return|return
operator|(
operator|(
name|error
operator|>
literal|0
operator|)
condition|?
name|error
else|:
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|db_bkpt_clear
parameter_list|(
name|db_addr_t
name|addr
parameter_list|,
name|BKPT_INST_TYPE
modifier|*
name|storage
parameter_list|)
block|{
name|BKPT_INST_TYPE
name|tmp
decl_stmt|;
name|db_addr_t
name|loc
decl_stmt|;
name|int
name|slot
decl_stmt|;
name|slot
operator|=
name|addr
operator|&
literal|0xfUL
expr_stmt|;
if|if
condition|(
name|slot
operator|>=
name|SLOT_COUNT
condition|)
return|return;
name|loc
operator|=
operator|(
name|addr
operator|&
operator|~
literal|0xfUL
operator|)
operator|+
operator|(
name|slot
operator|<<
literal|2
operator|)
expr_stmt|;
name|db_read_bytes
argument_list|(
name|loc
argument_list|,
sizeof|sizeof
argument_list|(
name|BKPT_INST_TYPE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|SLOT_MASK
operator|<<
name|SLOT_SHIFT
argument_list|(
name|slot
argument_list|)
operator|)
expr_stmt|;
name|tmp
operator||=
operator|*
name|storage
operator|<<
name|SLOT_SHIFT
argument_list|(
name|slot
argument_list|)
expr_stmt|;
name|db_write_bytes
argument_list|(
name|loc
argument_list|,
sizeof|sizeof
argument_list|(
name|BKPT_INST_TYPE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|db_bkpt_skip
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|kdb_frame
operator|==
name|NULL
condition|)
return|return;
name|kdb_frame
operator|->
name|tf_special
operator|.
name|psr
operator|+=
name|IA64_PSR_RI_1
expr_stmt|;
if|if
condition|(
operator|(
name|kdb_frame
operator|->
name|tf_special
operator|.
name|psr
operator|&
name|IA64_PSR_RI
operator|)
operator|>
name|IA64_PSR_RI_2
condition|)
block|{
name|kdb_frame
operator|->
name|tf_special
operator|.
name|psr
operator|&=
operator|~
name|IA64_PSR_RI
expr_stmt|;
name|kdb_frame
operator|->
name|tf_special
operator|.
name|iip
operator|+=
literal|16
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|db_bkpt_write
parameter_list|(
name|db_addr_t
name|addr
parameter_list|,
name|BKPT_INST_TYPE
modifier|*
name|storage
parameter_list|)
block|{
name|BKPT_INST_TYPE
name|tmp
decl_stmt|;
name|db_addr_t
name|loc
decl_stmt|;
name|int
name|slot
decl_stmt|;
name|slot
operator|=
name|addr
operator|&
literal|0xfUL
expr_stmt|;
if|if
condition|(
name|slot
operator|>=
name|SLOT_COUNT
condition|)
return|return;
name|loc
operator|=
operator|(
name|addr
operator|&
operator|~
literal|0xfUL
operator|)
operator|+
operator|(
name|slot
operator|<<
literal|2
operator|)
expr_stmt|;
name|db_read_bytes
argument_list|(
name|loc
argument_list|,
sizeof|sizeof
argument_list|(
name|BKPT_INST_TYPE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|)
expr_stmt|;
operator|*
name|storage
operator|=
operator|(
name|tmp
operator|>>
name|SLOT_SHIFT
argument_list|(
name|slot
argument_list|)
operator|)
operator|&
name|SLOT_MASK
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|SLOT_MASK
operator|<<
name|SLOT_SHIFT
argument_list|(
name|slot
argument_list|)
operator|)
expr_stmt|;
name|tmp
operator||=
operator|(
literal|0x84000
operator|<<
literal|6
operator|)
operator|<<
name|SLOT_SHIFT
argument_list|(
name|slot
argument_list|)
expr_stmt|;
name|db_write_bytes
argument_list|(
name|loc
argument_list|,
sizeof|sizeof
argument_list|(
name|BKPT_INST_TYPE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|db_addr_t
name|db_disasm
parameter_list|(
name|db_addr_t
name|loc
parameter_list|,
name|boolean_t
name|altfmt
parameter_list|)
block|{
name|char
name|buf
index|[
literal|32
index|]
decl_stmt|;
name|struct
name|asm_bundle
name|bundle
decl_stmt|;
specifier|const
name|struct
name|asm_inst
modifier|*
name|i
decl_stmt|;
specifier|const
name|char
modifier|*
name|tmpl
decl_stmt|;
name|int
name|n
decl_stmt|,
name|slot
decl_stmt|;
name|slot
operator|=
name|loc
operator|&
literal|0xf
expr_stmt|;
name|loc
operator|&=
operator|~
literal|0xful
expr_stmt|;
name|db_read_bytes
argument_list|(
name|loc
argument_list|,
literal|16
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|asm_decode
argument_list|(
operator|(
name|uintptr_t
operator|)
name|buf
argument_list|,
operator|&
name|bundle
argument_list|)
condition|)
block|{
name|i
operator|=
name|bundle
operator|.
name|b_inst
operator|+
name|slot
expr_stmt|;
name|tmpl
operator|=
name|bundle
operator|.
name|b_templ
operator|+
name|slot
expr_stmt|;
if|if
condition|(
operator|*
name|tmpl
operator|==
literal|';'
operator|||
operator|(
name|slot
operator|==
literal|2
operator|&&
name|bundle
operator|.
name|b_templ
index|[
literal|1
index|]
operator|==
literal|';'
operator|)
condition|)
name|tmpl
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|tmpl
operator|==
literal|'L'
operator|||
name|i
operator|->
name|i_op
operator|==
name|ASM_OP_NONE
condition|)
block|{
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
comment|/* Unit + slot. */
name|db_printf
argument_list|(
literal|"[%c%d] "
argument_list|,
operator|*
name|tmpl
argument_list|,
name|slot
argument_list|)
expr_stmt|;
comment|/* Predicate. */
if|if
condition|(
name|i
operator|->
name|i_oper
index|[
literal|0
index|]
operator|.
name|o_value
operator|!=
literal|0
condition|)
block|{
name|asm_operand
argument_list|(
name|i
operator|->
name|i_oper
operator|+
literal|0
argument_list|,
name|buf
argument_list|,
name|loc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"(%s) "
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
else|else
name|db_printf
argument_list|(
literal|"   "
argument_list|)
expr_stmt|;
comment|/* Mnemonic& completers. */
name|asm_mnemonic
argument_list|(
name|i
operator|->
name|i_op
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|i
operator|->
name|i_ncmpltrs
condition|)
block|{
name|asm_completer
argument_list|(
name|i
operator|->
name|i_cmpltr
operator|+
name|n
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
name|db_printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
comment|/* Operands. */
name|n
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|n
operator|<
literal|7
operator|&&
name|i
operator|->
name|i_oper
index|[
name|n
index|]
operator|.
name|o_type
operator|!=
name|ASM_OPER_NONE
condition|)
block|{
if|if
condition|(
name|n
operator|>
literal|1
condition|)
block|{
if|if
condition|(
name|n
operator|==
name|i
operator|->
name|i_srcidx
condition|)
name|db_printf
argument_list|(
literal|"="
argument_list|)
expr_stmt|;
else|else
name|db_printf
argument_list|(
literal|","
argument_list|)
expr_stmt|;
block|}
name|asm_operand
argument_list|(
name|i
operator|->
name|i_oper
operator|+
name|n
argument_list|,
name|buf
argument_list|,
name|loc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|tmpl
index|[
literal|1
index|]
operator|==
literal|';'
condition|)
name|db_printf
argument_list|(
literal|" ;;"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmpl
operator|=
name|NULL
expr_stmt|;
name|slot
operator|=
literal|2
expr_stmt|;
block|}
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|out
label|:
name|slot
operator|++
expr_stmt|;
if|if
condition|(
name|slot
operator|==
literal|1
operator|&&
name|tmpl
index|[
literal|1
index|]
operator|==
literal|'L'
condition|)
name|slot
operator|++
expr_stmt|;
if|if
condition|(
name|slot
operator|>
literal|2
condition|)
name|slot
operator|=
literal|16
expr_stmt|;
return|return
operator|(
name|loc
operator|+
name|slot
operator|)
return|;
block|}
end_function

begin_function
name|int
name|db_fncall_ia64
parameter_list|(
name|db_expr_t
name|addr
parameter_list|,
name|db_expr_t
modifier|*
name|rv
parameter_list|,
name|int
name|nargs
parameter_list|,
name|db_expr_t
name|args
index|[]
parameter_list|)
block|{
name|struct
name|ia64_fdesc
name|fdesc
decl_stmt|;
name|__db_f
modifier|*
name|f
decl_stmt|;
name|f
operator|=
operator|(
name|__db_f
operator|*
operator|)
operator|&
name|fdesc
expr_stmt|;
name|fdesc
operator|.
name|func
operator|=
name|addr
expr_stmt|;
name|fdesc
operator|.
name|gp
operator|=
name|__db_gp
expr_stmt|;
comment|/* XXX doesn't work for modules. */
operator|*
name|rv
operator|=
call|(
modifier|*
name|f
call|)
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
name|args
index|[
literal|1
index|]
argument_list|,
name|args
index|[
literal|2
index|]
argument_list|,
name|args
index|[
literal|3
index|]
argument_list|,
name|args
index|[
literal|4
index|]
argument_list|,
name|args
index|[
literal|5
index|]
argument_list|,
name|args
index|[
literal|6
index|]
argument_list|,
name|args
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|db_frame
parameter_list|(
name|struct
name|db_variable
modifier|*
name|vp
parameter_list|,
name|db_expr_t
modifier|*
name|valuep
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|uint64_t
modifier|*
name|reg
decl_stmt|;
if|if
condition|(
name|kdb_frame
operator|==
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|reg
operator|=
operator|(
name|uint64_t
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|kdb_frame
operator|+
operator|(
name|uintptr_t
operator|)
name|vp
operator|->
name|valuep
operator|)
expr_stmt|;
if|if
condition|(
name|op
operator|==
name|DB_VAR_GET
condition|)
operator|*
name|valuep
operator|=
operator|*
name|reg
expr_stmt|;
else|else
operator|*
name|reg
operator|=
operator|*
name|valuep
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|db_getip
parameter_list|(
name|struct
name|db_variable
modifier|*
name|vp
parameter_list|,
name|db_expr_t
modifier|*
name|valuep
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|u_long
name|iip
decl_stmt|,
name|slot
decl_stmt|;
if|if
condition|(
name|kdb_frame
operator|==
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|op
operator|==
name|DB_VAR_GET
condition|)
block|{
name|iip
operator|=
name|kdb_frame
operator|->
name|tf_special
operator|.
name|iip
expr_stmt|;
name|slot
operator|=
operator|(
name|kdb_frame
operator|->
name|tf_special
operator|.
name|psr
operator|>>
literal|41
operator|)
operator|&
literal|3
expr_stmt|;
operator|*
name|valuep
operator|=
name|iip
operator|+
name|slot
expr_stmt|;
block|}
else|else
block|{
name|iip
operator|=
operator|*
name|valuep
operator|&
operator|~
literal|0xf
expr_stmt|;
name|slot
operator|=
operator|*
name|valuep
operator|&
literal|0xf
expr_stmt|;
if|if
condition|(
name|slot
operator|>
literal|2
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|kdb_frame
operator|->
name|tf_special
operator|.
name|iip
operator|=
name|iip
expr_stmt|;
name|kdb_frame
operator|->
name|tf_special
operator|.
name|psr
operator|&=
operator|~
name|IA64_PSR_RI
expr_stmt|;
name|kdb_frame
operator|->
name|tf_special
operator|.
name|psr
operator||=
name|slot
operator|<<
literal|41
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|db_getrse
parameter_list|(
name|struct
name|db_variable
modifier|*
name|vp
parameter_list|,
name|db_expr_t
modifier|*
name|valuep
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|u_int64_t
modifier|*
name|reg
decl_stmt|;
name|uint64_t
name|bsp
decl_stmt|;
name|int
name|nats
decl_stmt|,
name|regno
decl_stmt|,
name|sof
decl_stmt|;
if|if
condition|(
name|kdb_frame
operator|==
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|regno
operator|=
operator|(
name|int
operator|)
operator|(
name|intptr_t
operator|)
name|valuep
expr_stmt|;
name|bsp
operator|=
name|kdb_frame
operator|->
name|tf_special
operator|.
name|bspstore
operator|+
name|kdb_frame
operator|->
name|tf_special
operator|.
name|ndirty
expr_stmt|;
name|sof
operator|=
call|(
name|int
call|)
argument_list|(
name|kdb_frame
operator|->
name|tf_special
operator|.
name|cfm
operator|&
literal|0x7f
argument_list|)
expr_stmt|;
if|if
condition|(
name|regno
operator|>=
name|sof
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|nats
operator|=
operator|(
name|sof
operator|-
name|regno
operator|+
literal|63
operator|-
operator|(
call|(
name|int
call|)
argument_list|(
name|bsp
operator|>>
literal|3
argument_list|)
operator|&
literal|0x3f
operator|)
operator|)
operator|/
literal|63
expr_stmt|;
name|reg
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
name|bsp
operator|-
operator|(
operator|(
name|sof
operator|-
name|regno
operator|+
name|nats
operator|)
operator|<<
literal|3
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|op
operator|==
name|DB_VAR_GET
condition|)
operator|*
name|valuep
operator|=
operator|*
name|reg
expr_stmt|;
else|else
operator|*
name|reg
operator|=
operator|*
name|valuep
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|int
name|db_md_clr_watchpoint
parameter_list|(
name|db_expr_t
name|addr
parameter_list|,
name|db_expr_t
name|size
parameter_list|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|void
name|db_md_list_watchpoints
parameter_list|()
block|{
return|return;
block|}
end_function

begin_function
name|int
name|db_md_set_watchpoint
parameter_list|(
name|db_expr_t
name|addr
parameter_list|,
name|db_expr_t
name|size
parameter_list|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Read bytes from kernel address space for debugger.  */
end_comment

begin_function
name|int
name|db_read_bytes
parameter_list|(
name|vm_offset_t
name|addr
parameter_list|,
name|size_t
name|size
parameter_list|,
name|char
modifier|*
name|data
parameter_list|)
block|{
name|jmp_buf
name|jb
decl_stmt|;
name|void
modifier|*
name|prev_jb
decl_stmt|;
name|char
modifier|*
name|src
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|prev_jb
operator|=
name|kdb_jmpbuf
argument_list|(
name|jb
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|jb
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
block|{
name|src
operator|=
operator|(
name|char
operator|*
operator|)
name|addr
expr_stmt|;
while|while
condition|(
name|size
operator|--
operator|>
literal|0
condition|)
operator|*
name|data
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|kdb_jmpbuf
argument_list|(
name|prev_jb
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Write bytes to kernel address space for debugger.  */
end_comment

begin_function
name|int
name|db_write_bytes
parameter_list|(
name|vm_offset_t
name|addr
parameter_list|,
name|size_t
name|size
parameter_list|,
name|char
modifier|*
name|data
parameter_list|)
block|{
name|jmp_buf
name|jb
decl_stmt|;
name|void
modifier|*
name|prev_jb
decl_stmt|;
name|size_t
name|cnt
decl_stmt|;
name|char
modifier|*
name|dst
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|prev_jb
operator|=
name|kdb_jmpbuf
argument_list|(
name|jb
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|jb
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
block|{
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
name|addr
expr_stmt|;
name|cnt
operator|=
name|size
expr_stmt|;
while|while
condition|(
name|cnt
operator|--
operator|>
literal|0
condition|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|data
operator|++
expr_stmt|;
name|kdb_cpu_sync_icache
argument_list|(
operator|(
name|void
operator|*
operator|)
name|addr
argument_list|,
name|size
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|kdb_jmpbuf
argument_list|(
name|prev_jb
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|void
name|db_show_mdpcpu
parameter_list|(
name|struct
name|pcpu
modifier|*
name|pc
parameter_list|)
block|{
name|struct
name|pcpu_md
modifier|*
name|md
init|=
operator|&
name|pc
operator|->
name|pc_md
decl_stmt|;
name|db_printf
argument_list|(
literal|"MD: vhpt       = %#lx\n"
argument_list|,
name|md
operator|->
name|vhpt
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"MD: lid        = %#lx\n"
argument_list|,
name|md
operator|->
name|lid
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"MD: clock      = %#lx\n"
argument_list|,
name|md
operator|->
name|clock
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"MD: clock_mode = %u\n"
argument_list|,
name|md
operator|->
name|clock_mode
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"MD: clock_load = %#lx\n"
argument_list|,
name|md
operator|->
name|clock_load
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"MD: stats      = %p\n"
argument_list|,
operator|&
name|md
operator|->
name|stats
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"MD: pmap       = %p\n"
argument_list|,
name|md
operator|->
name|current_pmap
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|db_trace_self
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|pcb
name|pcb
decl_stmt|;
name|savectx
argument_list|(
operator|&
name|pcb
argument_list|)
expr_stmt|;
name|db_backtrace
argument_list|(
name|curthread
argument_list|,
operator|&
name|pcb
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|db_trace_thread
parameter_list|(
name|struct
name|thread
modifier|*
name|td
parameter_list|,
name|int
name|count
parameter_list|)
block|{
name|struct
name|pcb
modifier|*
name|ctx
decl_stmt|;
name|ctx
operator|=
name|kdb_thr_ctx
argument_list|(
name|td
argument_list|)
expr_stmt|;
return|return
operator|(
name|db_backtrace
argument_list|(
name|td
argument_list|,
name|ctx
argument_list|,
name|count
argument_list|)
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|EXCEPTION_TRACING
end_ifdef

begin_decl_stmt
specifier|extern
name|long
name|xtrace
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|long
modifier|*
name|xhead
decl_stmt|;
end_decl_stmt

begin_macro
name|DB_COMMAND
argument_list|(
argument|xtrace
argument_list|,
argument|db_xtrace
argument_list|)
end_macro

begin_block
block|{
name|long
modifier|*
name|p
decl_stmt|;
name|p
operator|=
operator|(
operator|*
name|xhead
operator|==
literal|0
operator|)
condition|?
name|xtrace
else|:
name|xhead
expr_stmt|;
name|db_printf
argument_list|(
literal|"ITC\t\t IVT\t\t  IIP\t\t   IFA\t\t    ISR\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|==
literal|0
condition|)
return|return;
do|do
block|{
name|db_printf
argument_list|(
literal|"%016lx %016lx %016lx %016lx %016lx\n"
argument_list|,
name|p
index|[
literal|0
index|]
argument_list|,
name|p
index|[
literal|1
index|]
argument_list|,
name|p
index|[
literal|2
index|]
argument_list|,
name|p
index|[
literal|3
index|]
argument_list|,
name|p
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|5
expr_stmt|;
if|if
condition|(
name|p
operator|==
operator|(
name|void
operator|*
operator|)
operator|&
name|xhead
condition|)
name|p
operator|=
name|xtrace
expr_stmt|;
block|}
do|while
condition|(
name|p
operator|!=
name|xhead
condition|)
do|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

