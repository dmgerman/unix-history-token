begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2001 Doug Rabson  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_include
include|#
directive|include
file|<machine/unwind.h>
end_include

begin_include
include|#
directive|include
file|<machine/rse.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|UNWIND_DEBUG
end_ifdef

begin_define
define|#
directive|define
name|DPF
parameter_list|(
name|x
parameter_list|)
value|printf x
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|DPF
parameter_list|(
name|x
parameter_list|)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_expr_stmt
name|MALLOC_DEFINE
argument_list|(
name|M_UNWIND
argument_list|,
literal|"Unwind table"
argument_list|,
literal|"Unwind table information"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_struct
struct|struct
name|ia64_unwind_table_entry
block|{
name|u_int64_t
name|ue_start
decl_stmt|;
comment|/* procedure start */
name|u_int64_t
name|ue_end
decl_stmt|;
comment|/* procedure end */
name|u_int64_t
name|ue_info
decl_stmt|;
comment|/* offset to procedure descriptors */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|ia64_unwind_info
block|{
name|u_int64_t
name|ui_length
range|:
literal|32
decl_stmt|;
comment|/* length in 64bit units */
name|u_int64_t
name|ui_flags
range|:
literal|16
decl_stmt|;
name|u_int64_t
name|ui_version
range|:
literal|16
decl_stmt|;
block|}
struct|;
end_struct

begin_expr_stmt
name|LIST_HEAD
argument_list|(
name|ia64_unwind_table_list
argument_list|,
name|ia64_unwind_table
argument_list|)
expr_stmt|;
end_expr_stmt

begin_struct
struct|struct
name|ia64_unwind_table
block|{
name|LIST_ENTRY
argument_list|(
argument|ia64_unwind_table
argument_list|)
name|ut_link
expr_stmt|;
name|u_int64_t
name|ut_base
decl_stmt|;
name|u_int64_t
name|ut_limit
decl_stmt|;
name|struct
name|ia64_unwind_table_entry
modifier|*
name|ut_start
decl_stmt|;
name|struct
name|ia64_unwind_table_entry
modifier|*
name|ut_end
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|unwind_reg
block|{
name|u_int64_t
name|ur_value
decl_stmt|;
comment|/* current value */
name|u_int64_t
modifier|*
name|ur_save
decl_stmt|;
comment|/* save location */
name|int
name|ur_when
decl_stmt|;
comment|/* when the save happened */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|unwind_fpreg
block|{
name|struct
name|ia64_fpreg
name|ur_value
decl_stmt|;
comment|/* current value */
name|struct
name|ia64_fpreg
modifier|*
name|ur_save
decl_stmt|;
comment|/* save location */
name|int
name|ur_when
decl_stmt|;
comment|/* when the save happened */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|ia64_unwind_state
block|{
name|LIST_ENTRY
argument_list|(
argument|ia64_unwind_state
argument_list|)
name|us_link
expr_stmt|;
comment|/* free list */
comment|/* 	 * Current register state and location of saved register state 	 */
struct|struct
name|register_state
block|{
name|struct
name|unwind_reg
name|rs_psp
decl_stmt|;
name|struct
name|unwind_reg
name|rs_pfs
decl_stmt|;
name|struct
name|unwind_reg
name|rs_preds
decl_stmt|;
name|struct
name|unwind_reg
name|rs_unat
decl_stmt|;
name|struct
name|unwind_reg
name|rs_lc
decl_stmt|;
name|struct
name|unwind_reg
name|rs_rnat
decl_stmt|;
name|struct
name|unwind_reg
name|rs_bsp
decl_stmt|;
name|struct
name|unwind_reg
name|rs_bspstore
decl_stmt|;
name|struct
name|unwind_reg
name|rs_fpsr
decl_stmt|;
name|struct
name|unwind_reg
name|rs_priunat
decl_stmt|;
name|struct
name|unwind_reg
name|rs_br
index|[
literal|8
index|]
decl_stmt|;
name|struct
name|unwind_reg
name|rs_gr
index|[
literal|32
index|]
decl_stmt|;
name|struct
name|unwind_fpreg
name|rs_fr
index|[
literal|32
index|]
decl_stmt|;
name|u_int64_t
name|rs_stack_size
decl_stmt|;
block|}
name|us_regs
struct|;
comment|/* 	 * Variables used while parsing unwind records. 	 */
name|u_int64_t
name|us_ip
decl_stmt|;
comment|/* value of IP for this frame */
name|int
name|us_ri
decl_stmt|;
comment|/* RI field from cr.ipsr */
name|u_int64_t
name|us_pc
decl_stmt|;
comment|/* slot offset in procedure */
name|u_int64_t
modifier|*
name|us_bsp
decl_stmt|;
comment|/* backing store for frame */
name|u_int64_t
name|us_cfm
decl_stmt|;
comment|/* CFM value for frame */
name|u_int64_t
modifier|*
name|us_spill
decl_stmt|;
comment|/* spill_base location */
name|int
name|us_spilloff
decl_stmt|;
comment|/* offset into spill area */
name|int
name|us_grmask
decl_stmt|;
comment|/* mask of grs being spilled */
name|int
name|us_frmask
decl_stmt|;
comment|/* mask of frs being spilled */
name|int
name|us_brmask
decl_stmt|;
comment|/* mask of brs being spilled */
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|int
name|ia64_unwind_initialised
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ia64_unwind_table_list
name|ia64_unwind_tables
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MAX_UNWIND_STATES
value|4
end_define

begin_decl_stmt
specifier|static
name|struct
name|ia64_unwind_state
name|ia64_unwind_state_static
index|[
name|MAX_UNWIND_STATES
index|]
decl_stmt|;
end_decl_stmt

begin_expr_stmt
specifier|static
name|LIST_HEAD
argument_list|(
argument|ia64_unwind_state_list
argument_list|,
argument|ia64_unwind_state
argument_list|)
name|ia64_unwind_states
expr_stmt|;
end_expr_stmt

begin_function
name|struct
name|ia64_unwind_table
modifier|*
name|ia64_add_unwind_table
parameter_list|(
name|u_int64_t
modifier|*
name|base
parameter_list|,
name|u_int64_t
modifier|*
name|start
parameter_list|,
name|u_int64_t
modifier|*
name|end
parameter_list|)
block|{
name|struct
name|ia64_unwind_table
modifier|*
name|ut
decl_stmt|;
if|if
condition|(
operator|!
name|ia64_unwind_initialised
condition|)
block|{
name|int
name|i
decl_stmt|;
name|LIST_INIT
argument_list|(
operator|&
name|ia64_unwind_tables
argument_list|)
expr_stmt|;
name|LIST_INIT
argument_list|(
operator|&
name|ia64_unwind_states
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_UNWIND_STATES
condition|;
name|i
operator|++
control|)
block|{
name|LIST_INSERT_HEAD
argument_list|(
operator|&
name|ia64_unwind_states
argument_list|,
operator|&
name|ia64_unwind_state_static
index|[
name|i
index|]
argument_list|,
name|us_link
argument_list|)
expr_stmt|;
block|}
name|ia64_unwind_initialised
operator|=
literal|1
expr_stmt|;
block|}
name|ut
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|ia64_unwind_table
argument_list|)
argument_list|,
name|M_UNWIND
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ut
condition|)
return|return
literal|0
return|;
name|ut
operator|->
name|ut_base
operator|=
operator|(
name|u_int64_t
operator|)
name|base
expr_stmt|;
name|ut
operator|->
name|ut_start
operator|=
operator|(
expr|struct
name|ia64_unwind_table_entry
operator|*
operator|)
name|start
expr_stmt|;
name|ut
operator|->
name|ut_end
operator|=
operator|(
expr|struct
name|ia64_unwind_table_entry
operator|*
operator|)
name|end
expr_stmt|;
name|ut
operator|->
name|ut_limit
operator|=
operator|(
name|u_int64_t
operator|)
name|base
operator|+
name|ut
operator|->
name|ut_end
index|[
operator|-
literal|1
index|]
operator|.
name|ue_end
expr_stmt|;
name|LIST_INSERT_HEAD
argument_list|(
operator|&
name|ia64_unwind_tables
argument_list|,
name|ut
argument_list|,
name|ut_link
argument_list|)
expr_stmt|;
return|return
name|ut
return|;
block|}
end_function

begin_function
name|void
name|ia64_free_unwind_table
parameter_list|(
name|struct
name|ia64_unwind_table
modifier|*
name|ut
parameter_list|)
block|{
name|LIST_REMOVE
argument_list|(
name|ut
argument_list|,
name|ut_link
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ut
argument_list|,
name|M_UNWIND
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ia64_unwind_table
modifier|*
name|find_table
parameter_list|(
name|u_int64_t
name|ip
parameter_list|)
block|{
name|struct
name|ia64_unwind_table
modifier|*
name|ut
decl_stmt|;
name|LIST_FOREACH
argument_list|(
argument|ut
argument_list|,
argument|&ia64_unwind_tables
argument_list|,
argument|ut_link
argument_list|)
block|{
if|if
condition|(
name|ip
operator|>=
name|ut
operator|->
name|ut_base
operator|&&
name|ip
operator|<
name|ut
operator|->
name|ut_limit
condition|)
return|return
name|ut
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ia64_unwind_table_entry
modifier|*
name|find_entry
parameter_list|(
name|struct
name|ia64_unwind_table
modifier|*
name|ut
parameter_list|,
name|u_int64_t
name|ip
parameter_list|)
block|{
name|struct
name|ia64_unwind_table_entry
modifier|*
name|start
decl_stmt|;
name|struct
name|ia64_unwind_table_entry
modifier|*
name|end
decl_stmt|;
name|struct
name|ia64_unwind_table_entry
modifier|*
name|mid
decl_stmt|;
name|ip
operator|-=
name|ut
operator|->
name|ut_base
expr_stmt|;
name|start
operator|=
name|ut
operator|->
name|ut_start
expr_stmt|;
name|end
operator|=
name|ut
operator|->
name|ut_end
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|start
operator|<
name|end
condition|)
block|{
name|mid
operator|=
name|start
operator|+
operator|(
name|end
operator|-
name|start
operator|)
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|ip
operator|<
name|mid
operator|->
name|ue_start
condition|)
block|{
if|if
condition|(
name|end
operator|==
name|mid
condition|)
break|break;
name|end
operator|=
name|mid
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ip
operator|>=
name|mid
operator|->
name|ue_end
condition|)
block|{
if|if
condition|(
name|start
operator|==
name|mid
condition|)
break|break;
name|start
operator|=
name|mid
expr_stmt|;
block|}
else|else
return|return
name|mid
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|struct
name|ia64_unwind_state
modifier|*
name|ia64_create_unwind_state
parameter_list|(
name|struct
name|trapframe
modifier|*
name|framep
parameter_list|)
block|{
name|struct
name|ia64_unwind_state
modifier|*
name|us
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|ia64_unwind_initialised
condition|)
return|return
literal|0
return|;
name|us
operator|=
name|LIST_FIRST
argument_list|(
operator|&
name|ia64_unwind_states
argument_list|)
expr_stmt|;
if|if
condition|(
name|us
condition|)
block|{
name|LIST_REMOVE
argument_list|(
name|us
argument_list|,
name|us_link
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|us
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|ia64_unwind_state
argument_list|)
argument_list|,
name|M_UNWIND
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|us
condition|)
return|return
literal|0
return|;
block|}
name|bzero
argument_list|(
name|us
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|us
argument_list|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_r
index|[
name|FRAME_SP
index|]
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_pfs
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_ar_pfs
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_preds
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_pr
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_unat
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_ar_unat
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_rnat
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_ar_rnat
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_bsp
operator|.
name|ur_value
operator|=
call|(
name|u_int64_t
call|)
argument_list|(
name|framep
operator|->
name|tf_ar_bspstore
operator|+
name|framep
operator|->
name|tf_ndirty
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_bspstore
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_ar_bspstore
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_fpsr
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_ar_fpsr
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
name|i
index|]
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_b
index|[
name|i
index|]
expr_stmt|;
block|}
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|0
index|]
operator|.
name|ur_value
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|i
index|]
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_r
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|6
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|us
operator|->
name|us_regs
operator|.
name|rs_fr
index|[
name|i
index|]
operator|.
name|ur_value
operator|=
name|framep
operator|->
name|tf_f
index|[
name|i
operator|-
literal|6
index|]
expr_stmt|;
block|}
name|us
operator|->
name|us_ip
operator|=
name|framep
operator|->
name|tf_cr_iip
expr_stmt|;
name|us
operator|->
name|us_ri
operator|=
operator|(
name|framep
operator|->
name|tf_cr_ipsr
operator|&
name|IA64_PSR_RI
operator|)
operator|>>
literal|41
expr_stmt|;
name|us
operator|->
name|us_spill
operator|=
operator|(
name|u_int64_t
operator|*
operator|)
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|12
index|]
operator|.
name|ur_value
expr_stmt|;
name|us
operator|->
name|us_cfm
operator|=
name|framep
operator|->
name|tf_cr_ifs
expr_stmt|;
name|us
operator|->
name|us_bsp
operator|=
name|ia64_rse_previous_frame
argument_list|(
operator|(
name|u_int64_t
operator|*
operator|)
name|us
operator|->
name|us_regs
operator|.
name|rs_bsp
operator|.
name|ur_value
argument_list|,
name|us
operator|->
name|us_cfm
operator|&
literal|0x7f
argument_list|)
expr_stmt|;
return|return
name|us
return|;
block|}
end_function

begin_function
name|void
name|ia64_free_unwind_state
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|)
block|{
name|LIST_INSERT_HEAD
argument_list|(
operator|&
name|ia64_unwind_states
argument_list|,
name|us
argument_list|,
name|us_link
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|u_int64_t
name|ia64_unwind_state_get_ip
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|)
block|{
return|return
name|us
operator|->
name|us_ip
operator|+
name|us
operator|->
name|us_ri
return|;
block|}
end_function

begin_function
name|u_int64_t
name|ia64_unwind_state_get_sp
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|)
block|{
return|return
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|12
index|]
operator|.
name|ur_value
return|;
block|}
end_function

begin_function
name|u_int64_t
name|ia64_unwind_state_get_cfm
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|)
block|{
return|return
name|us
operator|->
name|us_cfm
return|;
block|}
end_function

begin_function
name|u_int64_t
modifier|*
name|ia64_unwind_state_get_bsp
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|)
block|{
return|return
name|us
operator|->
name|us_bsp
return|;
block|}
end_function

begin_function
specifier|static
name|u_int64_t
name|read_uleb128
parameter_list|(
name|u_int8_t
modifier|*
modifier|*
name|pp
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|p
init|=
operator|*
name|pp
decl_stmt|;
name|u_int8_t
name|b
decl_stmt|;
name|u_int64_t
name|res
decl_stmt|;
name|res
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|b
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|res
operator|=
operator|(
name|res
operator|<<
literal|7
operator|)
operator||
operator|(
name|b
operator|&
literal|0x7f
operator|)
expr_stmt|;
block|}
do|while
condition|(
name|b
operator|&
operator|(
literal|1
operator|<<
literal|7
operator|)
condition|)
do|;
operator|*
name|pp
operator|=
name|p
expr_stmt|;
return|return
name|res
return|;
block|}
end_function

begin_define
define|#
directive|define
name|PROCESS_WHEN
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|,
name|t
parameter_list|)
define|\
value|do {								\ 	DPF(("register %s was saved at offset %d\n",		\ 	     #reg, t));						\ 	us->us_regs.rs_##reg.ur_when = t;			\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_GR
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|,
name|gr
parameter_list|)
define|\
value|do {								\ 	DPF(("save location for %s at r%d\n", #reg, gr));	\ 	us->us_regs.rs_##reg.ur_save = find_gr(us, gr);		\ } while (0)							\  #define PROCESS_BR(us, reg, br)					\ do {								\ 	DPF(("save location for %s at b%d\n", #reg, br));	\ 	us->us_regs.rs_##reg.ur_save =				\&us->us_regs.rs_br[br].ur_value;		\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_GRMEM
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|)
define|\
value|do {								\ 	DPF(("save location for %s at spill+%d\n",		\ 	     #reg, us->us_spilloff));				\ 	us->us_regs.rs_##reg.ur_save =				\&us->us_spill[us->us_spilloff];			\ 	us->us_spilloff += 8;					\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_FRMEM
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|)
define|\
value|do {								\ 	DPF(("save location for %s at spill+%d\n",		\ 	     #reg, us->us_spilloff));				\ 	us->us_regs.rs_##reg.ur_save =				\ 		(struct ia64_fpreg *)				\&us->us_spill[us->us_spilloff];			\ 	us->us_spilloff += 16;					\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_SPREL
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|,
name|spoff
parameter_list|)
define|\
value|do {								\ 	DPF(("save location for %s at sp+%d\n",			\ 	     #reg, 4*spoff));					\ 	us->us_regs.rs_##reg.ur_save = (u_int64_t *)		\ 		(us->us_regs.rs_gr[12].ur_value + 4*spoff);	\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_SPREL_WHEN
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|,
name|spoff
parameter_list|,
name|t
parameter_list|)
define|\
value|do {								\ 	PROCESS_SPREL(us, reg, spoff);				\ 	PROCESS_WHEN(us, reg, t);				\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_PSPREL
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|,
name|pspoff
parameter_list|)
define|\
value|do {								\ 	DPF(("save location for %s at psp+%d\n",		\ 	     #reg, 16-4*pspoff));				\ 	us->us_regs.rs_##reg.ur_save = (u_int64_t *)		\ 		(us->us_regs.rs_psp.ur_value + 16-4*pspoff);	\ } while (0)
end_define

begin_define
define|#
directive|define
name|PROCESS_PSPREL_WHEN
parameter_list|(
name|us
parameter_list|,
name|reg
parameter_list|,
name|pspoff
parameter_list|,
name|t
parameter_list|)
define|\
value|do {								\ 	PROCESS_PSPREL(us, reg, pspoff);			\ 	PROCESS_WHEN(us, reg, t);				\ } while (0)
end_define

begin_function
specifier|static
name|u_int64_t
modifier|*
name|find_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
if|if
condition|(
name|gr
operator|<
literal|32
condition|)
return|return
operator|&
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|gr
index|]
operator|.
name|ur_value
return|;
else|else
return|return
name|ia64_rse_register_address
argument_list|(
name|us
operator|->
name|us_bsp
argument_list|,
name|gr
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_prologue
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|rlen
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
name|parse_prologue_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|rlen
parameter_list|,
name|int
name|mask
parameter_list|,
name|int
name|grsave
parameter_list|)
block|{
if|if
condition|(
name|mask
operator|&
literal|8
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|grsave
argument_list|)
expr_stmt|;
name|grsave
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
literal|4
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|grsave
argument_list|)
expr_stmt|;
name|grsave
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
literal|2
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|psp
argument_list|,
name|grsave
argument_list|)
expr_stmt|;
name|grsave
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
literal|1
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|grsave
argument_list|)
expr_stmt|;
name|grsave
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|parse_mem_stack_f
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|DPF
argument_list|(
operator|(
literal|"restore value for psp is sp+%d at offset %d\n"
operator|,
literal|16
operator|*
name|size
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_stack_size
operator|=
literal|16
operator|*
name|size
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_mem_stack_v
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|psp
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_psp_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|psp
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_psp_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|psp
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rp_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rp_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rp_br
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|br
parameter_list|)
block|{
name|PROCESS_BR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|br
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rp_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rp_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_pfs_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_pfs_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_pfs_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_pfs_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_preds_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_preds_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_preds_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_preds_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_fr_mem
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|frmask
parameter_list|)
block|{
name|us
operator|->
name|us_frmask
operator|=
name|frmask
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_frgr_mem
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|grmask
parameter_list|,
name|int
name|frmask
parameter_list|)
block|{
name|us
operator|->
name|us_grmask
operator|=
name|grmask
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|1
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|2
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|4
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|8
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_frmask
operator|=
name|frmask
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|1
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|2
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|4
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|8
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|16
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|32
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|17
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|64
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|18
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|128
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|19
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|256
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|20
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|512
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|21
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|1024
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|22
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|2048
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|24
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|4096
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|25
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|8192
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|26
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|16384
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|27
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|32768
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|28
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|65536
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|29
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|131072
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|30
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|frmask
operator|&
literal|262144
condition|)
name|PROCESS_FRMEM
argument_list|(
name|us
argument_list|,
name|fr
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_gr_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|grmask
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|us
operator|->
name|us_grmask
operator|=
name|grmask
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|1
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|4
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|grmask
operator|&
literal|2
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|5
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|grmask
operator|&
literal|4
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|6
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|grmask
operator|&
literal|8
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|7
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|parse_gr_mem
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|grmask
parameter_list|)
block|{
name|us
operator|->
name|us_grmask
operator|=
name|grmask
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|1
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|2
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|4
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|grmask
operator|&
literal|8
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|gr
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_br_mem
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|brmask
parameter_list|)
block|{
name|us
operator|->
name|us_brmask
operator|=
name|brmask
expr_stmt|;
if|if
condition|(
name|brmask
operator|&
literal|1
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|brmask
operator|&
literal|2
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|brmask
operator|&
literal|4
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|brmask
operator|&
literal|8
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|brmask
operator|&
literal|16
condition|)
name|PROCESS_GRMEM
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_br_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|brmask
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|us
operator|->
name|us_brmask
operator|=
name|brmask
expr_stmt|;
if|if
condition|(
name|brmask
operator|&
literal|1
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|1
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|brmask
operator|&
literal|2
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|2
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|brmask
operator|&
literal|4
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|3
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|brmask
operator|&
literal|8
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|4
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|brmask
operator|&
literal|16
condition|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|5
index|]
argument_list|,
name|gr
argument_list|)
expr_stmt|;
name|gr
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_base
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|DPF
argument_list|(
operator|(
literal|"base of spill area at psp+%d\n"
operator|,
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_spill
operator|=
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
operator|.
name|ur_value
operator|+
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_mask
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|u_int8_t
modifier|*
name|imask
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|reg
decl_stmt|;
name|u_int8_t
name|b
decl_stmt|;
specifier|static
name|int
name|frno
index|[]
init|=
block|{
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|16
block|,
literal|17
block|,
literal|18
block|,
literal|19
block|,
literal|20
block|,
literal|21
block|,
literal|22
block|,
literal|23
block|,
literal|24
block|,
literal|25
block|,
literal|26
block|,
literal|27
block|,
literal|28
block|,
literal|29
block|,
literal|30
block|,
literal|31
block|}
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|us
operator|->
name|us_pc
condition|;
name|i
operator|++
control|)
block|{
name|b
operator|=
name|imask
index|[
name|i
operator|/
literal|4
index|]
expr_stmt|;
name|b
operator|=
operator|(
name|b
operator|>>
operator|(
literal|2
operator|*
operator|(
name|i
operator|&
literal|3
operator|)
operator|)
operator|)
operator|&
literal|3
expr_stmt|;
switch|switch
condition|(
name|b
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|reg
operator|=
name|frno
index|[
name|ffs
argument_list|(
name|us
operator|->
name|us_frmask
argument_list|)
operator|-
literal|1
index|]
expr_stmt|;
name|DPF
argument_list|(
operator|(
literal|"restoring fr[%d] at offset %d\n"
operator|,
name|reg
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_fr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|i
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|reg
operator|=
name|ffs
argument_list|(
name|us
operator|->
name|us_grmask
argument_list|)
operator|-
literal|1
operator|+
literal|4
expr_stmt|;
name|DPF
argument_list|(
operator|(
literal|"restoring gr[%d] at offset %d\n"
operator|,
name|reg
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|i
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|reg
operator|=
name|ffs
argument_list|(
name|us
operator|->
name|us_brmask
argument_list|)
operator|-
literal|1
operator|+
literal|1
expr_stmt|;
name|DPF
argument_list|(
operator|(
literal|"restoring br[%d] at offset %d\n"
operator|,
name|reg
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|parse_unat_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|unat
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_unat_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|unat
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_unat_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|unat
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_unat_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|unat
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_lc_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|lc
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_lc_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|lc
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_lc_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|lc
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_lc_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|lc
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_fpsr_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|fpsr
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_fpsr_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|fpsr
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_fpsr_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|fpsr
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_fpsr_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|fpsr
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_priunat_when_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_priunat_when_mem
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_priunat_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_priunat_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_priunat_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bsp_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|bsp
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bsp_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|bsp
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bsp_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|bsp
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bsp_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|bsp
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bspstore_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|bspstore
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bspstore_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|bspstore
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bspstore_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|bspstore
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_bspstore_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|bspstore
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rnat_when
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|)
block|{
name|PROCESS_WHEN
argument_list|(
name|us
argument_list|,
name|rnat
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rnat_gr
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|gr
parameter_list|)
block|{
name|PROCESS_GR
argument_list|(
name|us
argument_list|,
name|rnat
argument_list|,
name|gr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rnat_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|PROCESS_PSPREL
argument_list|(
name|us
argument_list|,
name|rnat
argument_list|,
name|pspoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_rnat_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|PROCESS_SPREL
argument_list|(
name|us
argument_list|,
name|rnat
argument_list|,
name|spoff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_epilogue
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|ecount
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
name|parse_label_state
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|label
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
name|parse_copy_state
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|label
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
name|parse_spill_psprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|reg
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
name|int
name|type
decl_stmt|;
name|type
operator|=
name|reg
operator|>>
literal|5
expr_stmt|;
name|reg
operator|&=
literal|0x1f
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
literal|0
case|:
name|DPF
argument_list|(
operator|(
literal|"save location for gr[%d] at psp+%d at offset %d\n"
operator|,
name|reg
operator|,
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|reg
index|]
operator|.
name|ur_save
operator|=
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
operator|.
name|ur_value
operator|+
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|DPF
argument_list|(
operator|(
literal|"save location for fr[%d] at psp+%d at offset %d\n"
operator|,
name|reg
operator|,
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_fr
index|[
name|reg
index|]
operator|.
name|ur_save
operator|=
operator|(
expr|struct
name|ia64_fpreg
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
operator|.
name|ur_value
operator|+
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_fr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|DPF
argument_list|(
operator|(
literal|"save location for br[%d] at psp+%d at offset %d\n"
operator|,
name|reg
operator|,
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
name|reg
index|]
operator|.
name|ur_save
operator|=
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
operator|.
name|ur_value
operator|+
literal|16
operator|-
literal|4
operator|*
name|pspoff
operator|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|3
case|:
switch|switch
condition|(
name|reg
condition|)
block|{
case|case
literal|0
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|psp
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|bsp
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|bspstore
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|rnat
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|unat
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|fpsr
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|PROCESS_PSPREL_WHEN
argument_list|(
name|us
argument_list|,
name|lc
argument_list|,
name|pspoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_sprel
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|reg
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
name|int
name|type
decl_stmt|;
name|type
operator|=
name|reg
operator|>>
literal|5
expr_stmt|;
name|reg
operator|&=
literal|0x1f
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
literal|0
case|:
name|DPF
argument_list|(
operator|(
literal|"save location for gr[%d] at sp+%d at offset %d\n"
operator|,
name|reg
operator|,
literal|4
operator|*
name|spoff
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|reg
index|]
operator|.
name|ur_save
operator|=
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|12
index|]
operator|.
name|ur_value
operator|+
literal|4
operator|*
name|spoff
operator|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|DPF
argument_list|(
operator|(
literal|"save location for fr[%d] at sp+%d at offset %d\n"
operator|,
name|reg
operator|,
literal|4
operator|*
name|spoff
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_fr
index|[
name|reg
index|]
operator|.
name|ur_save
operator|=
operator|(
expr|struct
name|ia64_fpreg
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|12
index|]
operator|.
name|ur_value
operator|+
literal|4
operator|*
name|spoff
operator|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_fr
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|DPF
argument_list|(
operator|(
literal|"save location for br[%d] at sp+%d at offset %d\n"
operator|,
name|reg
operator|,
literal|4
operator|*
name|spoff
operator|,
name|t
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
name|reg
index|]
operator|.
name|ur_save
operator|=
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|12
index|]
operator|.
name|ur_value
operator|+
literal|4
operator|*
name|spoff
operator|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
name|reg
index|]
operator|.
name|ur_when
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|3
case|:
switch|switch
condition|(
name|reg
condition|)
block|{
case|case
literal|0
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|preds
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|psp
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|priunat
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|br
index|[
literal|0
index|]
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|bsp
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|bspstore
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|rnat
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|unat
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|fpsr
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|pfs
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|PROCESS_SPREL_WHEN
argument_list|(
name|us
argument_list|,
name|lc
argument_list|,
name|spoff
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_reg
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|reg
parameter_list|,
name|int
name|treg
parameter_list|)
block|{
comment|/* not done yet  */
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_psprel_p
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|qp
parameter_list|,
name|int
name|reg
parameter_list|,
name|int
name|pspoff
parameter_list|)
block|{
comment|/* not done yet  */
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_sprel_p
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|qp
parameter_list|,
name|int
name|reg
parameter_list|,
name|int
name|spoff
parameter_list|)
block|{
comment|/* not done yet  */
block|}
end_function

begin_function
specifier|static
name|void
name|parse_spill_reg_p
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|,
name|int
name|t
parameter_list|,
name|int
name|qp
parameter_list|,
name|int
name|reg
parameter_list|,
name|int
name|treg
parameter_list|)
block|{
comment|/* not done yet  */
block|}
end_function

begin_function
specifier|static
name|void
name|unwind_region
parameter_list|(
name|struct
name|register_state
modifier|*
name|regs
parameter_list|,
name|int
name|pc
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
define|#
directive|define
name|RESTORE
parameter_list|(
name|x
parameter_list|)
define|\
value|do {								\ 		if (regs->rs_##x.ur_save				\&& pc> regs->rs_##x.ur_when) {			\ 			DPF(("restoring %s\n", #x));			\ 			regs->rs_##x.ur_value = *regs->rs_##x.ur_save;	\ 		}							\ 		regs->rs_##x.ur_save = 0;				\ 		regs->rs_##x.ur_when = 0;				\ 	} while (0)
define|#
directive|define
name|RESTORE_INDEX
parameter_list|(
name|x
parameter_list|,
name|i
parameter_list|)
define|\
value|do {								\ 		if (regs->rs_##x[i].ur_save				\&& pc> regs->rs_##x[i].ur_when) {			\ 			DPF(("restoring %s[%d]\n", #x, i));		\ 			regs->rs_##x[i].ur_value =			\ 				*regs->rs_##x[i].ur_save;		\ 		}							\ 		regs->rs_##x[i].ur_save = 0;				\ 		regs->rs_##x[i].ur_when = 0;				\ 	} while (0)
if|if
condition|(
name|regs
operator|->
name|rs_stack_size
condition|)
block|{
name|DPF
argument_list|(
operator|(
literal|"restoring psp\n"
operator|)
argument_list|)
expr_stmt|;
name|regs
operator|->
name|rs_psp
operator|.
name|ur_value
operator|=
name|regs
operator|->
name|rs_gr
index|[
literal|12
index|]
operator|.
name|ur_value
operator|+
name|regs
operator|->
name|rs_stack_size
expr_stmt|;
name|regs
operator|->
name|rs_stack_size
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|RESTORE
argument_list|(
name|psp
argument_list|)
expr_stmt|;
block|}
name|RESTORE
argument_list|(
name|pfs
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|preds
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|unat
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|lc
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|rnat
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|bsp
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|bspstore
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|fpsr
argument_list|)
expr_stmt|;
name|RESTORE
argument_list|(
name|priunat
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|RESTORE_INDEX
argument_list|(
name|br
argument_list|,
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
name|RESTORE_INDEX
argument_list|(
name|gr
argument_list|,
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
name|RESTORE_INDEX
argument_list|(
name|fr
argument_list|,
name|i
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|RESTORE
block|}
end_function

begin_function
name|int
name|ia64_unwind_state_previous_frame
parameter_list|(
name|struct
name|ia64_unwind_state
modifier|*
name|us
parameter_list|)
block|{
name|struct
name|ia64_unwind_table
modifier|*
name|ut
decl_stmt|;
name|struct
name|ia64_unwind_table_entry
modifier|*
name|ute
decl_stmt|;
name|struct
name|ia64_unwind_info
modifier|*
name|ui
decl_stmt|;
name|u_int8_t
modifier|*
name|p
decl_stmt|;
name|u_int8_t
modifier|*
name|end
decl_stmt|;
name|int
name|region
init|=
literal|0
decl_stmt|;
comment|/* 0 for prologue, 1 for body */
name|int
name|rlen
init|=
literal|0
decl_stmt|;
comment|/* 	 * Find the entry which describes this procedure. 	 */
name|ut
operator|=
name|find_table
argument_list|(
name|us
operator|->
name|us_ip
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ut
condition|)
return|return
name|ENOENT
return|;
name|ute
operator|=
name|find_entry
argument_list|(
name|ut
argument_list|,
name|us
operator|->
name|us_ip
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ute
condition|)
block|{
comment|/* 		 * If there is no entry for this procedure, we assumes 		 * its a leaf (i.e. rp and ar.pfs is enough to restore 		 * the previous frame. 		 */
goto|goto
name|noentry
goto|;
block|}
comment|/* 	 * Calculate 'pc' as the number of instructions from the start 	 * of the procedure. 	 */
name|us
operator|->
name|us_pc
operator|=
operator|(
operator|(
name|us
operator|->
name|us_ip
operator|-
operator|(
name|ute
operator|->
name|ue_start
operator|+
name|ut
operator|->
name|ut_base
operator|)
operator|)
operator|/
literal|16
operator|)
operator|*
literal|3
operator|+
name|us
operator|->
name|us_ri
expr_stmt|;
comment|/* 	 * Process unwind records until we find the record which 	 * contains the pc. 	 */
name|ui
operator|=
operator|(
expr|struct
name|ia64_unwind_info
operator|*
operator|)
operator|(
name|ute
operator|->
name|ue_info
operator|+
name|ut
operator|->
name|ut_base
operator|)
expr_stmt|;
name|p
operator|=
operator|(
name|u_int8_t
operator|*
operator|)
name|ui
operator|+
literal|8
expr_stmt|;
name|end
operator|=
name|p
operator|+
literal|8
operator|*
name|ui
operator|->
name|ui_length
expr_stmt|;
while|while
condition|(
name|us
operator|->
name|us_pc
operator|>
literal|0
operator|&&
name|p
operator|<
name|end
condition|)
block|{
name|u_int8_t
name|b
init|=
operator|*
name|p
decl_stmt|;
comment|/* 		 * Is this a header or a region descriptor? 		 */
if|if
condition|(
operator|(
name|b
operator|>>
literal|7
operator|)
operator|==
literal|0
condition|)
block|{
comment|/* 			 * Header. 			 * 			 * Complete processing of previous region (if 			 * any) by restoring the appropriate registers 			 * and ajust pc to be relative to next region. 			 */
name|unwind_region
argument_list|(
operator|&
name|us
operator|->
name|us_regs
argument_list|,
name|us
operator|->
name|us_pc
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_pc
operator|-=
name|rlen
expr_stmt|;
if|if
condition|(
name|us
operator|->
name|us_pc
operator|<=
literal|0
condition|)
break|break;
if|if
condition|(
operator|(
name|b
operator|>>
literal|6
operator|)
operator|==
literal|0
condition|)
block|{
comment|/* R1 */
name|region
operator|=
operator|(
name|b
operator|>>
literal|5
operator|)
operator|&
literal|1
expr_stmt|;
name|rlen
operator|=
name|b
operator|&
literal|0x1f
expr_stmt|;
name|parse_prologue
argument_list|(
name|us
argument_list|,
name|rlen
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|3
operator|)
operator|==
literal|8
condition|)
block|{
comment|/* R2 */
name|int
name|mask
decl_stmt|,
name|grsave
decl_stmt|;
name|mask
operator|=
operator|(
operator|(
name|b
operator|&
literal|7
operator|)
operator|<<
literal|1
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|>>
literal|7
operator|)
expr_stmt|;
name|grsave
operator|=
name|p
index|[
literal|1
index|]
operator|&
literal|0x7f
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
name|rlen
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_prologue_gr
argument_list|(
name|us
argument_list|,
name|rlen
argument_list|,
name|mask
argument_list|,
name|grsave
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|2
operator|)
operator|==
literal|24
condition|)
block|{
comment|/* R3 */
name|region
operator|=
name|b
operator|&
literal|3
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
name|rlen
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_prologue
argument_list|(
name|us
argument_list|,
name|rlen
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|region
operator|==
literal|0
condition|)
block|{
comment|/* 				 * Prologue 				 */
if|if
condition|(
operator|(
name|b
operator|>>
literal|5
operator|)
operator|==
literal|4
condition|)
block|{
comment|/* P1 */
name|parse_br_mem
argument_list|(
name|us
argument_list|,
name|b
operator|&
literal|0x1f
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|4
operator|)
operator|==
literal|10
condition|)
block|{
comment|/* P2 - br_gr */
name|parse_br_gr
argument_list|(
name|us
argument_list|,
operator|(
operator|(
operator|(
name|b
operator|&
literal|0xf
operator|)
operator|<<
literal|1
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|>>
literal|7
operator|)
operator|)
argument_list|,
name|p
index|[
literal|1
index|]
operator|&
literal|0x7f
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|3
operator|)
operator|==
literal|22
condition|)
block|{
comment|/* P3 */
name|int
name|which
decl_stmt|,
name|r
decl_stmt|;
name|which
operator|=
operator|(
operator|(
name|b
operator|&
literal|7
operator|)
operator|<<
literal|1
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|>>
literal|7
operator|)
expr_stmt|;
name|r
operator|=
name|p
index|[
literal|1
index|]
operator|&
literal|0x7f
expr_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
literal|0
case|:
name|parse_psp_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|parse_rp_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|parse_pfs_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|parse_preds_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|parse_unat_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|parse_lc_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|parse_rp_br
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|parse_rnat_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|parse_bsp_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|parse_bspstore_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|parse_fpsr_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
case|case
literal|11
case|:
name|parse_priunat_gr
argument_list|(
name|us
argument_list|,
name|r
argument_list|)
expr_stmt|;
break|break;
block|}
name|p
operator|+=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|184
condition|)
block|{
comment|/* P4 */
name|parse_spill_mask
argument_list|(
name|us
argument_list|,
name|p
operator|+
literal|1
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|1
operator|+
operator|(
name|rlen
operator|+
literal|3
operator|)
operator|/
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|185
condition|)
block|{
comment|/* P5 - frgr_mem */
name|parse_frgr_mem
argument_list|(
name|us
argument_list|,
name|p
index|[
literal|1
index|]
operator|>>
literal|4
argument_list|,
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|&
literal|0xf
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|5
operator|)
operator|==
literal|6
condition|)
block|{
comment|/* P6 */
if|if
condition|(
name|b
operator|&
literal|0x10
condition|)
name|parse_gr_mem
argument_list|(
name|us
argument_list|,
name|b
operator|&
literal|0xf
argument_list|)
expr_stmt|;
else|else
name|parse_fr_mem
argument_list|(
name|us
argument_list|,
name|b
operator|&
literal|0xf
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|4
operator|)
operator|==
literal|14
condition|)
block|{
comment|/* P7 */
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|p
operator|++
expr_stmt|;
name|x
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|b
operator|&
literal|0xf
condition|)
block|{
case|case
literal|0
case|:
name|y
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_mem_stack_f
argument_list|(
name|us
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|parse_mem_stack_v
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|parse_spill_base
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|parse_psp_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|parse_rp_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|parse_rp_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|parse_pfs_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|parse_pfs_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|parse_preds_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|parse_preds_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|parse_lc_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|11
case|:
name|parse_lc_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|12
case|:
name|parse_unat_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|13
case|:
name|parse_unat_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|14
case|:
name|parse_fpsr_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|15
case|:
name|parse_fpsr_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|240
condition|)
block|{
comment|/* P8 */
name|int
name|which
init|=
name|p
index|[
literal|1
index|]
decl_stmt|;
name|int
name|x
decl_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
name|x
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
literal|1
case|:
name|parse_rp_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|parse_pfs_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|parse_preds_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|parse_lc_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|parse_unat_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|parse_fpsr_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|parse_bsp_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|parse_bsp_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|parse_bsp_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|parse_bspstore_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|11
case|:
name|parse_bspstore_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|12
case|:
name|parse_bspstore_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|13
case|:
name|parse_rnat_when
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|14
case|:
name|parse_rnat_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|15
case|:
name|parse_rnat_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|parse_priunat_when_gr
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|17
case|:
name|parse_priunat_psprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|18
case|:
name|parse_priunat_sprel
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|19
case|:
name|parse_priunat_when_mem
argument_list|(
name|us
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|241
condition|)
block|{
comment|/* P9 */
name|parse_gr_gr
argument_list|(
name|us
argument_list|,
name|p
index|[
literal|1
index|]
argument_list|,
name|p
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|255
condition|)
block|{
comment|/* P10 (ignored) */
name|p
operator|+=
literal|3
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
name|b
operator|>>
literal|6
operator|)
operator|==
literal|2
condition|)
block|{
comment|/* B1 */
if|if
condition|(
operator|(
name|b
operator|&
operator|(
literal|1
operator|<<
literal|5
operator|)
operator|)
operator|==
literal|0
condition|)
name|parse_label_state
argument_list|(
name|us
argument_list|,
name|b
operator|&
literal|0x1f
argument_list|)
expr_stmt|;
else|else
name|parse_copy_state
argument_list|(
name|us
argument_list|,
name|b
operator|&
literal|0x1f
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|5
operator|)
operator|==
literal|6
condition|)
block|{
comment|/* B2 */
name|int
name|ecount
init|=
name|b
operator|&
literal|0x1f
decl_stmt|;
name|int
name|t
decl_stmt|;
name|p
operator|++
expr_stmt|;
name|t
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_epilogue
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|ecount
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|224
condition|)
block|{
comment|/* B3 */
name|int
name|t
decl_stmt|,
name|ecount
decl_stmt|;
name|p
operator|++
expr_stmt|;
name|t
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|ecount
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_epilogue
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|ecount
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|4
operator|)
operator|==
literal|15
condition|)
block|{
comment|/* B4 */
name|int
name|label
decl_stmt|;
name|p
operator|++
expr_stmt|;
name|label
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|b
operator|&
operator|(
literal|1
operator|<<
literal|3
operator|)
operator|)
operator|==
literal|0
condition|)
name|parse_label_state
argument_list|(
name|us
argument_list|,
name|label
argument_list|)
expr_stmt|;
else|else
name|parse_copy_state
argument_list|(
name|us
argument_list|,
name|label
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 			 * X records can appear in both prologue and 			 * body. 			 */
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|249
condition|)
block|{
comment|/* X1 */
name|int
name|r
decl_stmt|,
name|reg
decl_stmt|,
name|t
decl_stmt|,
name|off
decl_stmt|;
name|r
operator|=
operator|(
name|p
index|[
literal|1
index|]
operator|>>
literal|7
operator|)
operator|&
literal|1
expr_stmt|;
name|reg
operator|=
name|p
index|[
literal|1
index|]
operator|&
literal|0x7f
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
name|t
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|off
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|==
literal|0
condition|)
name|parse_spill_psprel
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|reg
argument_list|,
name|off
argument_list|)
expr_stmt|;
else|else
name|parse_spill_sprel
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|reg
argument_list|,
name|off
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|250
condition|)
block|{
comment|/* X2 */
name|int
name|reg
decl_stmt|,
name|treg
decl_stmt|,
name|t
decl_stmt|;
name|reg
operator|=
name|p
index|[
literal|1
index|]
operator|&
literal|0x7f
expr_stmt|;
name|treg
operator|=
name|p
index|[
literal|2
index|]
operator||
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|&
literal|0x80
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
name|p
operator|+=
literal|3
expr_stmt|;
name|t
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_spill_reg
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|reg
argument_list|,
name|treg
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|251
condition|)
block|{
comment|/* X3 */
name|int
name|r
decl_stmt|,
name|qp
decl_stmt|,
name|reg
decl_stmt|,
name|t
decl_stmt|,
name|off
decl_stmt|;
name|r
operator|=
operator|(
name|p
index|[
literal|1
index|]
operator|>>
literal|7
operator|)
operator|&
literal|1
expr_stmt|;
name|qp
operator|=
name|p
index|[
literal|1
index|]
operator|&
literal|0x3f
expr_stmt|;
name|reg
operator|=
name|p
index|[
literal|2
index|]
expr_stmt|;
name|p
operator|+=
literal|3
expr_stmt|;
name|t
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|off
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|==
literal|0
condition|)
name|parse_spill_psprel_p
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|qp
argument_list|,
name|reg
argument_list|,
name|off
argument_list|)
expr_stmt|;
else|else
name|parse_spill_sprel_p
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|qp
argument_list|,
name|reg
argument_list|,
name|off
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|b
operator|>>
literal|0
operator|)
operator|==
literal|252
condition|)
block|{
comment|/* X4 */
name|int
name|qp
decl_stmt|,
name|reg
decl_stmt|,
name|treg
decl_stmt|,
name|t
decl_stmt|;
name|qp
operator|=
name|p
index|[
literal|1
index|]
operator|&
literal|0x3f
expr_stmt|;
name|reg
operator|=
name|p
index|[
literal|2
index|]
operator|&
literal|0x7f
expr_stmt|;
name|treg
operator|=
name|p
index|[
literal|3
index|]
operator||
operator|(
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|0x80
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
name|t
operator|=
name|read_uleb128
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|parse_spill_reg_p
argument_list|(
name|us
argument_list|,
name|t
argument_list|,
name|qp
argument_list|,
name|reg
argument_list|,
name|treg
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|noentry
label|:
comment|/* 	 * Now that we have worked out suitable values for rp, ar.pfs 	 * and sp, we can shift state to the previous function. If we 	 * haven't managed to figure out a new value for ip, then we 	 * assume that the unwinding didn't work and return an error. 	 */
if|if
condition|(
name|us
operator|->
name|us_ip
operator|==
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
literal|0
index|]
operator|.
name|ur_value
condition|)
return|return
name|EINVAL
return|;
name|us
operator|->
name|us_ip
operator|=
name|us
operator|->
name|us_regs
operator|.
name|rs_br
index|[
literal|0
index|]
operator|.
name|ur_value
expr_stmt|;
name|us
operator|->
name|us_ri
operator|=
literal|0
expr_stmt|;
name|us
operator|->
name|us_cfm
operator|=
name|us
operator|->
name|us_regs
operator|.
name|rs_pfs
operator|.
name|ur_value
expr_stmt|;
name|DPF
argument_list|(
operator|(
literal|"new cfm is 0x%lx\n"
operator|,
name|us
operator|->
name|us_cfm
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_bsp
operator|=
name|ia64_rse_previous_frame
argument_list|(
name|us
operator|->
name|us_bsp
argument_list|,
operator|(
name|us
operator|->
name|us_cfm
operator|>>
literal|7
operator|)
operator|&
literal|0x7f
argument_list|)
expr_stmt|;
name|DPF
argument_list|(
operator|(
literal|"new bsp is %p\n"
operator|,
name|us
operator|->
name|us_bsp
operator|)
argument_list|)
expr_stmt|;
name|us
operator|->
name|us_regs
operator|.
name|rs_gr
index|[
literal|12
index|]
operator|=
name|us
operator|->
name|us_regs
operator|.
name|rs_psp
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

