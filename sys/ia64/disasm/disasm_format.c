begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2000-2003 Marcel Moolenaar  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<ia64/disasm/disasm_int.h>
end_include

begin_include
include|#
directive|include
file|<ia64/disasm/disasm.h>
end_include

begin_comment
comment|/*  * Mnemonics (keep in sync with enum asm_op).  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|asm_mnemonics
index|[]
init|=
block|{
name|NULL
block|,
literal|"add"
block|,
literal|"addl"
block|,
literal|"addp4"
block|,
literal|"adds"
block|,
literal|"alloc"
block|,
literal|"and"
block|,
literal|"andcm"
block|,
literal|"br"
block|,
literal|"break"
block|,
literal|"brl"
block|,
literal|"brp"
block|,
literal|"bsw"
block|,
literal|"chk"
block|,
literal|"clrrrb"
block|,
literal|"cmp"
block|,
literal|"cmp4"
block|,
literal|"cmp8xchg16"
block|,
literal|"cmpxchg1"
block|,
literal|"cmpxchg2"
block|,
literal|"cmpxchg4"
block|,
literal|"cmpxchg8"
block|,
literal|"cover"
block|,
literal|"czx1"
block|,
literal|"czx2"
block|,
literal|"dep"
block|,
literal|"epc"
block|,
literal|"extr"
block|,
literal|"famax"
block|,
literal|"famin"
block|,
literal|"fand"
block|,
literal|"fandcm"
block|,
literal|"fc"
block|,
literal|"fchkf"
block|,
literal|"fclass"
block|,
literal|"fclrf"
block|,
literal|"fcmp"
block|,
literal|"fcvt"
block|,
literal|"fetchadd4"
block|,
literal|"fetchadd8"
block|,
literal|"flushrs"
block|,
literal|"fma"
block|,
literal|"fmax"
block|,
literal|"fmerge"
block|,
literal|"fmin"
block|,
literal|"fmix"
block|,
literal|"fms"
block|,
literal|"fnma"
block|,
literal|"for"
block|,
literal|"fpack"
block|,
literal|"fpamax"
block|,
literal|"fpamin"
block|,
literal|"fpcmp"
block|,
literal|"fpcvt"
block|,
literal|"fpma"
block|,
literal|"fpmax"
block|,
literal|"fpmerge"
block|,
literal|"fpmin"
block|,
literal|"fpms"
block|,
literal|"fpnma"
block|,
literal|"fprcpa"
block|,
literal|"fprsqrta"
block|,
literal|"frcpa"
block|,
literal|"frsqrta"
block|,
literal|"fselect"
block|,
literal|"fsetc"
block|,
literal|"fswap"
block|,
literal|"fsxt"
block|,
literal|"fwb"
block|,
literal|"fxor"
block|,
literal|"getf"
block|,
literal|"invala"
block|,
literal|"itc"
block|,
literal|"itr"
block|,
literal|"ld1"
block|,
literal|"ld16"
block|,
literal|"ld2"
block|,
literal|"ld4"
block|,
literal|"ld8"
block|,
literal|"ldf"
block|,
literal|"ldf8"
block|,
literal|"ldfd"
block|,
literal|"ldfe"
block|,
literal|"ldfp8"
block|,
literal|"ldfpd"
block|,
literal|"ldfps"
block|,
literal|"ldfs"
block|,
literal|"lfetch"
block|,
literal|"loadrs"
block|,
literal|"mf"
block|,
literal|"mix1"
block|,
literal|"mix2"
block|,
literal|"mix4"
block|,
literal|"mov"
block|,
literal|"movl"
block|,
literal|"mux1"
block|,
literal|"mux2"
block|,
literal|"nop"
block|,
literal|"or"
block|,
literal|"pack2"
block|,
literal|"pack4"
block|,
literal|"padd1"
block|,
literal|"padd2"
block|,
literal|"padd4"
block|,
literal|"pavg1"
block|,
literal|"pavg2"
block|,
literal|"pavgsub1"
block|,
literal|"pavgsub2"
block|,
literal|"pcmp1"
block|,
literal|"pcmp2"
block|,
literal|"pcmp4"
block|,
literal|"pmax1"
block|,
literal|"pmax2"
block|,
literal|"pmin1"
block|,
literal|"pmin2"
block|,
literal|"pmpy2"
block|,
literal|"pmpyshr2"
block|,
literal|"popcnt"
block|,
literal|"probe"
block|,
literal|"psad1"
block|,
literal|"pshl2"
block|,
literal|"pshl4"
block|,
literal|"pshladd2"
block|,
literal|"pshr2"
block|,
literal|"pshr4"
block|,
literal|"pshradd2"
block|,
literal|"psub1"
block|,
literal|"psub2"
block|,
literal|"psub4"
block|,
literal|"ptc"
block|,
literal|"ptr"
block|,
literal|"rfi"
block|,
literal|"rsm"
block|,
literal|"rum"
block|,
literal|"setf"
block|,
literal|"shl"
block|,
literal|"shladd"
block|,
literal|"shladdp4"
block|,
literal|"shr"
block|,
literal|"shrp"
block|,
literal|"srlz"
block|,
literal|"ssm"
block|,
literal|"st1"
block|,
literal|"st16"
block|,
literal|"st2"
block|,
literal|"st4"
block|,
literal|"st8"
block|,
literal|"stf"
block|,
literal|"stf8"
block|,
literal|"stfd"
block|,
literal|"stfe"
block|,
literal|"stfs"
block|,
literal|"sub"
block|,
literal|"sum"
block|,
literal|"sxt1"
block|,
literal|"sxt2"
block|,
literal|"sxt4"
block|,
literal|"sync"
block|,
literal|"tak"
block|,
literal|"tbit"
block|,
literal|"thash"
block|,
literal|"tnat"
block|,
literal|"tpa"
block|,
literal|"ttag"
block|,
literal|"unpack1"
block|,
literal|"unpack2"
block|,
literal|"unpack4"
block|,
literal|"xchg1"
block|,
literal|"xchg2"
block|,
literal|"xchg4"
block|,
literal|"xchg8"
block|,
literal|"xma"
block|,
literal|"xor"
block|,
literal|"zxt1"
block|,
literal|"zxt2"
block|,
literal|"zxt4"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Completers (keep in sync with enum asm_cmpltr_type).  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|asm_completers
index|[]
init|=
block|{
literal|""
block|,
literal|".0"
block|,
literal|".1"
block|,
literal|".a"
block|,
literal|".acq"
block|,
literal|".and"
block|,
literal|".b"
block|,
literal|".bias"
block|,
literal|".c.clr"
block|,
literal|".c.clr.acq"
block|,
literal|".c.nc"
block|,
literal|".call"
block|,
literal|".cexit"
block|,
literal|".cloop"
block|,
literal|".clr"
block|,
literal|".ctop"
block|,
literal|".d"
block|,
literal|".dc.dc"
block|,
literal|".dc.nt"
block|,
literal|".dpnt"
block|,
literal|".dptk"
block|,
literal|".e"
block|,
literal|".eq"
block|,
literal|".excl"
block|,
literal|".exit"
block|,
literal|".exp"
block|,
literal|".f"
block|,
literal|".fault"
block|,
literal|".few"
block|,
literal|".fill"
block|,
literal|".fx"
block|,
literal|".fxu"
block|,
literal|".g"
block|,
literal|".ga"
block|,
literal|".ge"
block|,
literal|".gt"
block|,
literal|".h"
block|,
literal|".hu"
block|,
literal|".i"
block|,
literal|".ia"
block|,
literal|".imp"
block|,
literal|".l"
block|,
literal|".le"
block|,
literal|".loop"
block|,
literal|".lr"
block|,
literal|".lt"
block|,
literal|".ltu"
block|,
literal|".m"
block|,
literal|".many"
block|,
literal|".nc"
block|,
literal|".ne"
block|,
literal|".neq"
block|,
literal|".nl"
block|,
literal|".nle"
block|,
literal|".nlt"
block|,
literal|".nm"
block|,
literal|".nr"
block|,
literal|".ns"
block|,
literal|".nt.dc"
block|,
literal|".nt.nt"
block|,
literal|".nt.tk"
block|,
literal|".nt1"
block|,
literal|".nt2"
block|,
literal|".nta"
block|,
literal|".nz"
block|,
literal|".or"
block|,
literal|".or.andcm"
block|,
literal|".ord"
block|,
literal|".pr"
block|,
literal|".r"
block|,
literal|".raz"
block|,
literal|".rel"
block|,
literal|".ret"
block|,
literal|".rw"
block|,
literal|".s"
block|,
literal|".s0"
block|,
literal|".s1"
block|,
literal|".s2"
block|,
literal|".s3"
block|,
literal|".sa"
block|,
literal|".se"
block|,
literal|".sig"
block|,
literal|".spill"
block|,
literal|".spnt"
block|,
literal|".sptk"
block|,
literal|".sss"
block|,
literal|".tk.dc"
block|,
literal|".tk.nt"
block|,
literal|".tk.tk"
block|,
literal|".trunc"
block|,
literal|".u"
block|,
literal|".unc"
block|,
literal|".unord"
block|,
literal|".uss"
block|,
literal|".uus"
block|,
literal|".uuu"
block|,
literal|".w"
block|,
literal|".wexit"
block|,
literal|".wtop"
block|,
literal|".x"
block|,
literal|".xf"
block|,
literal|".z"
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|asm_completer
parameter_list|(
specifier|const
name|struct
name|asm_cmpltr
modifier|*
name|c
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
name|asm_completers
index|[
name|c
operator|->
name|c_type
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|asm_mnemonic
parameter_list|(
name|enum
name|asm_op
name|op
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
name|asm_mnemonics
index|[
operator|(
name|op
operator|<
name|ASM_OP_INTERNAL_OPCODES
operator|)
condition|?
name|op
else|:
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|asm_operand
parameter_list|(
specifier|const
name|struct
name|asm_oper
modifier|*
name|o
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|uint64_t
name|ip
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|n
decl_stmt|;
name|n
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
name|o
operator|->
name|o_type
condition|)
block|{
case|case
name|ASM_OPER_AREG
case|:
switch|switch
condition|(
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
condition|)
block|{
case|case
name|AR_K0
case|:
name|n
operator|=
literal|"k0"
expr_stmt|;
break|break;
case|case
name|AR_K1
case|:
name|n
operator|=
literal|"k1"
expr_stmt|;
break|break;
case|case
name|AR_K2
case|:
name|n
operator|=
literal|"k2"
expr_stmt|;
break|break;
case|case
name|AR_K3
case|:
name|n
operator|=
literal|"k3"
expr_stmt|;
break|break;
case|case
name|AR_K4
case|:
name|n
operator|=
literal|"k4"
expr_stmt|;
break|break;
case|case
name|AR_K5
case|:
name|n
operator|=
literal|"k5"
expr_stmt|;
break|break;
case|case
name|AR_K6
case|:
name|n
operator|=
literal|"k6"
expr_stmt|;
break|break;
case|case
name|AR_K7
case|:
name|n
operator|=
literal|"k7"
expr_stmt|;
break|break;
case|case
name|AR_RSC
case|:
name|n
operator|=
literal|"rsc"
expr_stmt|;
break|break;
case|case
name|AR_BSP
case|:
name|n
operator|=
literal|"bsp"
expr_stmt|;
break|break;
case|case
name|AR_BSPSTORE
case|:
name|n
operator|=
literal|"bspstore"
expr_stmt|;
break|break;
case|case
name|AR_RNAT
case|:
name|n
operator|=
literal|"rnat"
expr_stmt|;
break|break;
case|case
name|AR_FCR
case|:
name|n
operator|=
literal|"fcr"
expr_stmt|;
break|break;
case|case
name|AR_EFLAG
case|:
name|n
operator|=
literal|"eflag"
expr_stmt|;
break|break;
case|case
name|AR_CSD
case|:
name|n
operator|=
literal|"csd"
expr_stmt|;
break|break;
case|case
name|AR_SSD
case|:
name|n
operator|=
literal|"ssd"
expr_stmt|;
break|break;
case|case
name|AR_CFLG
case|:
name|n
operator|=
literal|"cflg"
expr_stmt|;
break|break;
case|case
name|AR_FSR
case|:
name|n
operator|=
literal|"fsr"
expr_stmt|;
break|break;
case|case
name|AR_FIR
case|:
name|n
operator|=
literal|"fir"
expr_stmt|;
break|break;
case|case
name|AR_FDR
case|:
name|n
operator|=
literal|"fdr"
expr_stmt|;
break|break;
case|case
name|AR_CCV
case|:
name|n
operator|=
literal|"ccv"
expr_stmt|;
break|break;
case|case
name|AR_UNAT
case|:
name|n
operator|=
literal|"unat"
expr_stmt|;
break|break;
case|case
name|AR_FPSR
case|:
name|n
operator|=
literal|"fpsr"
expr_stmt|;
break|break;
case|case
name|AR_ITC
case|:
name|n
operator|=
literal|"itc"
expr_stmt|;
break|break;
case|case
name|AR_PFS
case|:
name|n
operator|=
literal|"pfs"
expr_stmt|;
break|break;
case|case
name|AR_LC
case|:
name|n
operator|=
literal|"lc"
expr_stmt|;
break|break;
case|case
name|AR_EC
case|:
name|n
operator|=
literal|"ec"
expr_stmt|;
break|break;
default|default:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"ar%d"
argument_list|,
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
return|return;
block|}
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"ar.%s"
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_BREG
case|:
if|if
condition|(
name|o
operator|->
name|o_value
operator|!=
literal|0
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"b%d"
argument_list|,
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"rp"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_CPUID
case|:
name|n
operator|=
literal|"cpuid"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_CREG
case|:
switch|switch
condition|(
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
condition|)
block|{
case|case
name|CR_DCR
case|:
name|n
operator|=
literal|"dcr"
expr_stmt|;
break|break;
case|case
name|CR_ITM
case|:
name|n
operator|=
literal|"itm"
expr_stmt|;
break|break;
case|case
name|CR_IVA
case|:
name|n
operator|=
literal|"iva"
expr_stmt|;
break|break;
case|case
name|CR_PTA
case|:
name|n
operator|=
literal|"pta"
expr_stmt|;
break|break;
case|case
name|CR_IPSR
case|:
name|n
operator|=
literal|"ipsr"
expr_stmt|;
break|break;
case|case
name|CR_ISR
case|:
name|n
operator|=
literal|"isr"
expr_stmt|;
break|break;
case|case
name|CR_IIP
case|:
name|n
operator|=
literal|"iip"
expr_stmt|;
break|break;
case|case
name|CR_IFA
case|:
name|n
operator|=
literal|"ifa"
expr_stmt|;
break|break;
case|case
name|CR_ITIR
case|:
name|n
operator|=
literal|"itir"
expr_stmt|;
break|break;
case|case
name|CR_IIPA
case|:
name|n
operator|=
literal|"iipa"
expr_stmt|;
break|break;
case|case
name|CR_IFS
case|:
name|n
operator|=
literal|"ifs"
expr_stmt|;
break|break;
case|case
name|CR_IIM
case|:
name|n
operator|=
literal|"iim"
expr_stmt|;
break|break;
case|case
name|CR_IHA
case|:
name|n
operator|=
literal|"iha"
expr_stmt|;
break|break;
case|case
name|CR_LID
case|:
name|n
operator|=
literal|"lid"
expr_stmt|;
break|break;
case|case
name|CR_IVR
case|:
name|n
operator|=
literal|"ivr"
expr_stmt|;
break|break;
case|case
name|CR_TPR
case|:
name|n
operator|=
literal|"tpr"
expr_stmt|;
break|break;
case|case
name|CR_EOI
case|:
name|n
operator|=
literal|"eoi"
expr_stmt|;
break|break;
case|case
name|CR_IRR0
case|:
name|n
operator|=
literal|"irr0"
expr_stmt|;
break|break;
case|case
name|CR_IRR1
case|:
name|n
operator|=
literal|"irr1"
expr_stmt|;
break|break;
case|case
name|CR_IRR2
case|:
name|n
operator|=
literal|"irr2"
expr_stmt|;
break|break;
case|case
name|CR_IRR3
case|:
name|n
operator|=
literal|"irr3"
expr_stmt|;
break|break;
case|case
name|CR_ITV
case|:
name|n
operator|=
literal|"itv"
expr_stmt|;
break|break;
case|case
name|CR_PMV
case|:
name|n
operator|=
literal|"pmv"
expr_stmt|;
break|break;
case|case
name|CR_CMCV
case|:
name|n
operator|=
literal|"cmcv"
expr_stmt|;
break|break;
case|case
name|CR_LRR0
case|:
name|n
operator|=
literal|"lrr0"
expr_stmt|;
break|break;
case|case
name|CR_LRR1
case|:
name|n
operator|=
literal|"lrr1"
expr_stmt|;
break|break;
default|default:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"cr%d"
argument_list|,
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
return|return;
block|}
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"cr.%s"
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_DBR
case|:
name|n
operator|=
literal|"dbr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_DISP
case|:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%lx"
argument_list|,
name|ip
operator|+
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_DTR
case|:
name|n
operator|=
literal|"dtr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_FREG
case|:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"f%d"
argument_list|,
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_GREG
case|:
break|break;
case|case
name|ASM_OPER_IBR
case|:
name|n
operator|=
literal|"ibr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_IMM
case|:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"0x%lx"
argument_list|,
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_IP
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"ip"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_ITR
case|:
name|n
operator|=
literal|"itr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_MEM
case|:
name|n
operator|=
literal|""
expr_stmt|;
break|break;
case|case
name|ASM_OPER_MSR
case|:
name|n
operator|=
literal|"msr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_PKR
case|:
name|n
operator|=
literal|"pkr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_PMC
case|:
name|n
operator|=
literal|"pmc"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_PMD
case|:
name|n
operator|=
literal|"pmd"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_PR
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"pr"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_PR_ROT
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"pr.rot"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_PREG
case|:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"p%d"
argument_list|,
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_PSR
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"psr"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_PSR_L
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"psr.l"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_PSR_UM
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"psr.um"
argument_list|)
expr_stmt|;
return|return;
case|case
name|ASM_OPER_RR
case|:
name|n
operator|=
literal|"rr"
expr_stmt|;
break|break;
case|case
name|ASM_OPER_NONE
case|:
name|KASSERT
argument_list|(
literal|0
argument_list|,
operator|(
literal|"foo"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|n
operator|!=
name|NULL
condition|)
name|buf
operator|+=
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s["
argument_list|,
name|n
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
condition|)
block|{
case|case
literal|1
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"gp"
argument_list|)
expr_stmt|;
name|buf
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|12
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"sp"
argument_list|)
expr_stmt|;
name|buf
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|13
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"tp"
argument_list|)
expr_stmt|;
name|buf
operator|+=
literal|2
expr_stmt|;
break|break;
default|default:
name|buf
operator|+=
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"r%d"
argument_list|,
operator|(
name|int
operator|)
name|o
operator|->
name|o_value
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|n
operator|!=
name|NULL
condition|)
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"]"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|asm_print_bundle
parameter_list|(
specifier|const
name|struct
name|asm_bundle
modifier|*
name|b
parameter_list|,
name|uint64_t
name|ip
parameter_list|)
block|{
name|asm_print_inst
argument_list|(
name|b
argument_list|,
literal|0
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|asm_print_inst
argument_list|(
name|b
argument_list|,
literal|1
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|asm_print_inst
argument_list|(
name|b
argument_list|,
literal|2
argument_list|,
name|ip
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|asm_print_inst
parameter_list|(
specifier|const
name|struct
name|asm_bundle
modifier|*
name|b
parameter_list|,
name|int
name|slot
parameter_list|,
name|uint64_t
name|ip
parameter_list|)
block|{
name|char
name|buf
index|[
literal|32
index|]
decl_stmt|;
specifier|const
name|struct
name|asm_inst
modifier|*
name|i
decl_stmt|;
specifier|const
name|char
modifier|*
name|tmpl
decl_stmt|;
name|int
name|n
decl_stmt|,
name|w
decl_stmt|;
name|tmpl
operator|=
name|b
operator|->
name|b_templ
operator|+
name|slot
expr_stmt|;
if|if
condition|(
operator|*
name|tmpl
operator|==
literal|';'
operator|||
operator|(
name|slot
operator|==
literal|2
operator|&&
name|b
operator|->
name|b_templ
index|[
literal|1
index|]
operator|==
literal|';'
operator|)
condition|)
name|tmpl
operator|++
expr_stmt|;
name|i
operator|=
name|b
operator|->
name|b_inst
operator|+
name|slot
expr_stmt|;
if|if
condition|(
operator|*
name|tmpl
operator|==
literal|'L'
operator|||
name|i
operator|->
name|i_op
operator|==
name|ASM_OP_NONE
condition|)
return|return;
comment|/* Address + slot. */
name|printf
argument_list|(
literal|"%lx[%c] "
argument_list|,
name|ip
operator|+
name|slot
argument_list|,
operator|*
name|tmpl
argument_list|)
expr_stmt|;
comment|/* Predicate. */
if|if
condition|(
name|i
operator|->
name|i_oper
index|[
literal|0
index|]
operator|.
name|o_value
operator|!=
literal|0
condition|)
block|{
name|asm_operand
argument_list|(
name|i
operator|->
name|i_oper
operator|+
literal|0
argument_list|,
name|buf
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|w
operator|=
name|printf
argument_list|(
literal|"(%s)"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
else|else
name|w
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|w
operator|++
operator|<
literal|8
condition|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
comment|/* Mnemonic& completers. */
name|asm_mnemonic
argument_list|(
name|i
operator|->
name|i_op
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|w
operator|=
name|printf
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|i
operator|->
name|i_ncmpltrs
condition|)
block|{
name|asm_completer
argument_list|(
name|i
operator|->
name|i_cmpltr
operator|+
name|n
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|w
operator|+=
name|printf
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|w
operator|++
operator|<
literal|15
condition|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
comment|/* Operands. */
name|n
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|n
operator|<
literal|7
operator|&&
name|i
operator|->
name|i_oper
index|[
name|n
index|]
operator|.
name|o_type
operator|!=
name|ASM_OPER_NONE
condition|)
block|{
if|if
condition|(
name|n
operator|>
literal|1
condition|)
block|{
if|if
condition|(
name|n
operator|==
name|i
operator|->
name|i_srcidx
condition|)
name|printf
argument_list|(
literal|" = "
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
block|}
name|asm_operand
argument_list|(
name|i
operator|->
name|i_oper
operator|+
name|n
argument_list|,
name|buf
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

