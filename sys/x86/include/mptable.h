begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1996, by Steve Passe  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. The name of the developer may NOT be used to endorse or promote products  *    derived from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__MACHINE_MPTABLE_H__
end_ifndef

begin_define
define|#
directive|define
name|__MACHINE_MPTABLE_H__
end_define

begin_enum
enum|enum
name|busTypes
block|{
name|NOBUS
init|=
literal|0
block|,
name|CBUS
init|=
literal|1
block|,
name|CBUSII
init|=
literal|2
block|,
name|EISA
init|=
literal|3
block|,
name|ISA
init|=
literal|6
block|,
name|MCA
init|=
literal|9
block|,
name|PCI
init|=
literal|13
block|,
name|XPRESS
init|=
literal|18
block|,
name|MAX_BUSTYPE
init|=
literal|18
block|,
name|UNKNOWN_BUSTYPE
init|=
literal|0xff
block|}
enum|;
end_enum

begin_comment
comment|/* MP Floating Pointer Structure */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|MPFPS
block|{
name|uint8_t
name|signature
index|[
literal|4
index|]
decl_stmt|;
name|uint32_t
name|pap
decl_stmt|;
name|uint8_t
name|length
decl_stmt|;
name|uint8_t
name|spec_rev
decl_stmt|;
name|uint8_t
name|checksum
decl_stmt|;
name|uint8_t
name|config_type
decl_stmt|;
name|uint8_t
name|mpfb2
decl_stmt|;
name|uint8_t
name|mpfb3
decl_stmt|;
name|uint8_t
name|mpfb4
decl_stmt|;
name|uint8_t
name|mpfb5
decl_stmt|;
block|}
name|__packed
modifier|*
name|mpfps_t
typedef|;
end_typedef

begin_define
define|#
directive|define
name|MPFB2_IMCR_PRESENT
value|0x80
end_define

begin_define
define|#
directive|define
name|MPFB2_MUL_CLK_SRCS
value|0x40
end_define

begin_comment
comment|/* MP Configuration Table Header */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|MPCTH
block|{
name|uint8_t
name|signature
index|[
literal|4
index|]
decl_stmt|;
name|uint16_t
name|base_table_length
decl_stmt|;
name|uint8_t
name|spec_rev
decl_stmt|;
name|uint8_t
name|checksum
decl_stmt|;
name|uint8_t
name|oem_id
index|[
literal|8
index|]
decl_stmt|;
name|uint8_t
name|product_id
index|[
literal|12
index|]
decl_stmt|;
name|uint32_t
name|oem_table_pointer
decl_stmt|;
name|uint16_t
name|oem_table_size
decl_stmt|;
name|uint16_t
name|entry_count
decl_stmt|;
name|uint32_t
name|apic_address
decl_stmt|;
name|uint16_t
name|extended_table_length
decl_stmt|;
name|uint8_t
name|extended_table_checksum
decl_stmt|;
name|uint8_t
name|reserved
decl_stmt|;
block|}
name|__packed
modifier|*
name|mpcth_t
typedef|;
end_typedef

begin_comment
comment|/* Base table entries */
end_comment

begin_define
define|#
directive|define
name|MPCT_ENTRY_PROCESSOR
value|0
end_define

begin_define
define|#
directive|define
name|MPCT_ENTRY_BUS
value|1
end_define

begin_define
define|#
directive|define
name|MPCT_ENTRY_IOAPIC
value|2
end_define

begin_define
define|#
directive|define
name|MPCT_ENTRY_INT
value|3
end_define

begin_define
define|#
directive|define
name|MPCT_ENTRY_LOCAL_INT
value|4
end_define

begin_typedef
typedef|typedef
struct|struct
name|PROCENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|apic_id
decl_stmt|;
name|uint8_t
name|apic_version
decl_stmt|;
name|uint8_t
name|cpu_flags
decl_stmt|;
name|uint32_t
name|cpu_signature
decl_stmt|;
name|uint32_t
name|feature_flags
decl_stmt|;
name|uint32_t
name|reserved1
decl_stmt|;
name|uint32_t
name|reserved2
decl_stmt|;
block|}
name|__packed
modifier|*
name|proc_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|PROCENTRY_FLAG_EN
value|0x01
end_define

begin_define
define|#
directive|define
name|PROCENTRY_FLAG_BP
value|0x02
end_define

begin_typedef
typedef|typedef
struct|struct
name|BUSENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|bus_id
decl_stmt|;
name|uint8_t
name|bus_type
index|[
literal|6
index|]
decl_stmt|;
block|}
name|__packed
modifier|*
name|bus_entry_ptr
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|IOAPICENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|apic_id
decl_stmt|;
name|uint8_t
name|apic_version
decl_stmt|;
name|uint8_t
name|apic_flags
decl_stmt|;
name|uint32_t
name|apic_address
decl_stmt|;
block|}
name|__packed
modifier|*
name|io_apic_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|IOAPICENTRY_FLAG_EN
value|0x01
end_define

begin_typedef
typedef|typedef
struct|struct
name|INTENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|int_type
decl_stmt|;
name|uint16_t
name|int_flags
decl_stmt|;
name|uint8_t
name|src_bus_id
decl_stmt|;
name|uint8_t
name|src_bus_irq
decl_stmt|;
name|uint8_t
name|dst_apic_id
decl_stmt|;
name|uint8_t
name|dst_apic_int
decl_stmt|;
block|}
name|__packed
modifier|*
name|int_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|INTENTRY_TYPE_INT
value|0
end_define

begin_define
define|#
directive|define
name|INTENTRY_TYPE_NMI
value|1
end_define

begin_define
define|#
directive|define
name|INTENTRY_TYPE_SMI
value|2
end_define

begin_define
define|#
directive|define
name|INTENTRY_TYPE_EXTINT
value|3
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_POLARITY
value|0x3
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_POLARITY_CONFORM
value|0x0
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_POLARITY_ACTIVEHI
value|0x1
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_POLARITY_ACTIVELO
value|0x3
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_TRIGGER
value|0xc
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_TRIGGER_CONFORM
value|0x0
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_TRIGGER_EDGE
value|0x4
end_define

begin_define
define|#
directive|define
name|INTENTRY_FLAGS_TRIGGER_LEVEL
value|0xc
end_define

begin_comment
comment|/* Extended table entries */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|EXTENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|length
decl_stmt|;
block|}
name|__packed
modifier|*
name|ext_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|MPCT_EXTENTRY_SAS
value|0x80
end_define

begin_define
define|#
directive|define
name|MPCT_EXTENTRY_BHD
value|0x81
end_define

begin_define
define|#
directive|define
name|MPCT_EXTENTRY_CBASM
value|0x82
end_define

begin_typedef
typedef|typedef
struct|struct
name|SASENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|length
decl_stmt|;
name|uint8_t
name|bus_id
decl_stmt|;
name|uint8_t
name|address_type
decl_stmt|;
name|uint64_t
name|address_base
decl_stmt|;
name|uint64_t
name|address_length
decl_stmt|;
block|}
name|__packed
modifier|*
name|sas_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|SASENTRY_TYPE_IO
value|0
end_define

begin_define
define|#
directive|define
name|SASENTRY_TYPE_MEMORY
value|1
end_define

begin_define
define|#
directive|define
name|SASENTRY_TYPE_PREFETCH
value|2
end_define

begin_typedef
typedef|typedef
struct|struct
name|BHDENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|length
decl_stmt|;
name|uint8_t
name|bus_id
decl_stmt|;
name|uint8_t
name|bus_info
decl_stmt|;
name|uint8_t
name|parent_bus
decl_stmt|;
name|uint8_t
name|reserved
index|[
literal|3
index|]
decl_stmt|;
block|}
name|__packed
modifier|*
name|bhd_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|BHDENTRY_INFO_SUBTRACTIVE_DECODE
value|0x1
end_define

begin_typedef
typedef|typedef
struct|struct
name|CBASMENTRY
block|{
name|uint8_t
name|type
decl_stmt|;
name|uint8_t
name|length
decl_stmt|;
name|uint8_t
name|bus_id
decl_stmt|;
name|uint8_t
name|address_mod
decl_stmt|;
name|uint32_t
name|predefined_range
decl_stmt|;
block|}
name|__packed
modifier|*
name|cbasm_entry_ptr
typedef|;
end_typedef

begin_define
define|#
directive|define
name|CBASMENTRY_ADDRESS_MOD_ADD
value|0x0
end_define

begin_define
define|#
directive|define
name|CBASMENTRY_ADDRESS_MOD_SUBTRACT
value|0x1
end_define

begin_define
define|#
directive|define
name|CBASMENTRY_RANGE_ISA_IO
value|0
end_define

begin_define
define|#
directive|define
name|CBASMENTRY_RANGE_VGA_IO
value|1
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|_KERNEL
end_ifdef

begin_struct
struct|struct
name|mptable_hostb_softc
block|{
ifdef|#
directive|ifdef
name|NEW_PCIB
name|struct
name|pcib_host_resources
name|sc_host_res
decl_stmt|;
name|int
name|sc_decodes_vga_io
decl_stmt|;
name|int
name|sc_decodes_isa_io
decl_stmt|;
endif|#
directive|endif
block|}
struct|;
end_struct

begin_ifdef
ifdef|#
directive|ifdef
name|NEW_PCIB
end_ifdef

begin_function_decl
name|void
name|mptable_pci_host_res_init
parameter_list|(
name|device_t
name|pcib
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
name|int
name|mptable_pci_probe_table
parameter_list|(
name|int
name|bus
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mptable_pci_route_interrupt
parameter_list|(
name|device_t
name|pcib
parameter_list|,
name|device_t
name|dev
parameter_list|,
name|int
name|pin
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !__MACHINE_MPTABLE_H__ */
end_comment

end_unit

