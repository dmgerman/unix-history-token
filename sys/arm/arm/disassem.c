begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$NetBSD: disassem.c,v 1.14 2003/03/27 16:58:36 mycroft Exp $	*/
end_comment

begin_comment
comment|/*-  * Copyright (c) 1996 Mark Brinicombe.  * Copyright (c) 1996 Brini.  *  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by Brini.  * 4. The name of the company nor the name of the author may be used to  *    endorse or promote products derived from this software without specific  *    prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY BRINI ``AS IS'' AND ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL BRINI OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * RiscBSD kernel project  *  * db_disasm.c  *  * Kernel disassembler  *  * Created      : 10/02/96  *  * Structured after the sparc/sparc/db_disasm.c by David S. Miller&  * Paul Kranenburg  *  * This code is not complete. Not all instructions are disassembled.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<machine/disassem.h>
end_include

begin_include
include|#
directive|include
file|<machine/armreg.h>
end_include

begin_include
include|#
directive|include
file|<machine/acle-compat.h>
end_include

begin_include
include|#
directive|include
file|<ddb/ddb.h>
end_include

begin_comment
comment|/*  * General instruction format  *  *	insn[cc][mod]	[operands]  *  * Those fields with an uppercase format code indicate that the field  * follows directly after the instruction before the separator i.e.  * they modify the instruction rather than just being an operand to  * the instruction. The only exception is the writeback flag which  * follows a operand.  *  *  * 2 - print Operand 2 of a data processing instruction  * d - destination register (bits 12-15)  * n - n register (bits 16-19)  * s - s register (bits 8-11)  * o - indirect register rn (bits 16-19) (used by swap)  * m - m register (bits 0-3)  * a - address operand of ldr/str instruction  * l - register list for ldm/stm instruction  * f - 1st fp operand (register) (bits 12-14)  * g - 2nd fp operand (register) (bits 16-18)  * h - 3rd fp operand (register/immediate) (bits 0-4)  * b - branch address  * t - thumb branch address (bits 24, 0-23)  * k - breakpoint comment (bits 0-3, 8-19)  * X - block transfer type  * Y - block transfer type (r13 base)  * c - comment field bits(0-23)  * p - saved or current status register  * F - PSR transfer fields  * D - destination-is-r15 (P) flag on TST, TEQ, CMP, CMN  * L - co-processor transfer size  * S - set status flag  * P - fp precision  * Q - fp precision (for ldf/stf)  * R - fp rounding  * v - co-processor data transfer registers + addressing mode  * W - writeback flag  * x - instruction in hex  * # - co-processor number  * y - co-processor data processing registers  * z - co-processor register transfer registers  */
end_comment

begin_struct
struct|struct
name|arm32_insn
block|{
name|u_int
name|mask
decl_stmt|;
name|u_int
name|pattern
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|format
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|arm32_insn
name|arm32_i
index|[]
init|=
block|{
block|{
literal|0x0fffffff
block|,
literal|0x0ff00000
block|,
literal|"imb"
block|,
literal|"c"
block|}
block|,
comment|/* Before swi */
block|{
literal|0x0fffffff
block|,
literal|0x0ff00001
block|,
literal|"imbrange"
block|,
literal|"c"
block|}
block|,
comment|/* Before swi */
block|{
literal|0x0f000000
block|,
literal|0x0f000000
block|,
literal|"swi"
block|,
literal|"c"
block|}
block|,
block|{
literal|0xfe000000
block|,
literal|0xfa000000
block|,
literal|"blx"
block|,
literal|"t"
block|}
block|,
comment|/* Before b and bl */
block|{
literal|0x0f000000
block|,
literal|0x0a000000
block|,
literal|"b"
block|,
literal|"b"
block|}
block|,
block|{
literal|0x0f000000
block|,
literal|0x0b000000
block|,
literal|"bl"
block|,
literal|"b"
block|}
block|,
block|{
literal|0x0fe000f0
block|,
literal|0x00000090
block|,
literal|"mul"
block|,
literal|"Snms"
block|}
block|,
block|{
literal|0x0fe000f0
block|,
literal|0x00200090
block|,
literal|"mla"
block|,
literal|"Snmsd"
block|}
block|,
block|{
literal|0x0fe000f0
block|,
literal|0x00800090
block|,
literal|"umull"
block|,
literal|"Sdnms"
block|}
block|,
block|{
literal|0x0fe000f0
block|,
literal|0x00c00090
block|,
literal|"smull"
block|,
literal|"Sdnms"
block|}
block|,
block|{
literal|0x0fe000f0
block|,
literal|0x00a00090
block|,
literal|"umlal"
block|,
literal|"Sdnms"
block|}
block|,
block|{
literal|0x0fe000f0
block|,
literal|0x00e00090
block|,
literal|"smlal"
block|,
literal|"Sdnms"
block|}
block|,
block|{
literal|0x0d700000
block|,
literal|0x04200000
block|,
literal|"strt"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0d700000
block|,
literal|0x04300000
block|,
literal|"ldrt"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0d700000
block|,
literal|0x04600000
block|,
literal|"strbt"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0d700000
block|,
literal|0x04700000
block|,
literal|"ldrbt"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0c500000
block|,
literal|0x04000000
block|,
literal|"str"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0c500000
block|,
literal|0x04100000
block|,
literal|"ldr"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0c500000
block|,
literal|0x04400000
block|,
literal|"strb"
block|,
literal|"daW"
block|}
block|,
block|{
literal|0x0c500000
block|,
literal|0x04500000
block|,
literal|"ldrb"
block|,
literal|"daW"
block|}
block|,
if|#
directive|if
name|__ARM_ARCH
operator|>=
literal|6
block|{
literal|0xffffffff
block|,
literal|0xf57ff01f
block|,
literal|"clrex"
block|,
literal|"c"
block|}
block|,
block|{
literal|0x0ff00ff0
block|,
literal|0x01800f90
block|,
literal|"strex"
block|,
literal|"dmo"
block|}
block|,
block|{
literal|0x0ff00fff
block|,
literal|0x01900f9f
block|,
literal|"ldrex"
block|,
literal|"do"
block|}
block|,
block|{
literal|0x0ff00ff0
block|,
literal|0x01a00f90
block|,
literal|"strexd"
block|,
literal|"dmo"
block|}
block|,
block|{
literal|0x0ff00fff
block|,
literal|0x01b00f9f
block|,
literal|"ldrexd"
block|,
literal|"do"
block|}
block|,
block|{
literal|0x0ff00ff0
block|,
literal|0x01c00f90
block|,
literal|"strexb"
block|,
literal|"dmo"
block|}
block|,
block|{
literal|0x0ff00fff
block|,
literal|0x01d00f9f
block|,
literal|"ldrexb"
block|,
literal|"do"
block|}
block|,
block|{
literal|0x0ff00ff0
block|,
literal|0x01e00f90
block|,
literal|"strexh"
block|,
literal|"dmo"
block|}
block|,
block|{
literal|0x0ff00fff
block|,
literal|0x01f00f9f
block|,
literal|"ldrexh"
block|,
literal|"do"
block|}
block|,
endif|#
directive|endif
block|{
literal|0x0e1f0000
block|,
literal|0x080d0000
block|,
literal|"stm"
block|,
literal|"YnWl"
block|}
block|,
comment|/* separate out r13 base */
block|{
literal|0x0e1f0000
block|,
literal|0x081d0000
block|,
literal|"ldm"
block|,
literal|"YnWl"
block|}
block|,
comment|/* separate out r13 base */
block|{
literal|0x0e100000
block|,
literal|0x08000000
block|,
literal|"stm"
block|,
literal|"XnWl"
block|}
block|,
block|{
literal|0x0e100000
block|,
literal|0x08100000
block|,
literal|"ldm"
block|,
literal|"XnWl"
block|}
block|,
block|{
literal|0x0e1000f0
block|,
literal|0x00100090
block|,
literal|"ldrb"
block|,
literal|"de"
block|}
block|,
block|{
literal|0x0e1000f0
block|,
literal|0x00000090
block|,
literal|"strb"
block|,
literal|"de"
block|}
block|,
block|{
literal|0x0e1000f0
block|,
literal|0x001000d0
block|,
literal|"ldrsb"
block|,
literal|"de"
block|}
block|,
block|{
literal|0x0e1000f0
block|,
literal|0x001000b0
block|,
literal|"ldrh"
block|,
literal|"de"
block|}
block|,
block|{
literal|0x0e1000f0
block|,
literal|0x000000b0
block|,
literal|"strh"
block|,
literal|"de"
block|}
block|,
block|{
literal|0x0e1000f0
block|,
literal|0x001000f0
block|,
literal|"ldrsh"
block|,
literal|"de"
block|}
block|,
block|{
literal|0x0f200090
block|,
literal|0x00200090
block|,
literal|"und"
block|,
literal|"x"
block|}
block|,
comment|/* Before data processing */
block|{
literal|0x0e1000d0
block|,
literal|0x000000d0
block|,
literal|"und"
block|,
literal|"x"
block|}
block|,
comment|/* Before data processing */
block|{
literal|0x0ff00ff0
block|,
literal|0x01000090
block|,
literal|"swp"
block|,
literal|"dmo"
block|}
block|,
block|{
literal|0x0ff00ff0
block|,
literal|0x01400090
block|,
literal|"swpb"
block|,
literal|"dmo"
block|}
block|,
block|{
literal|0x0fbf0fff
block|,
literal|0x010f0000
block|,
literal|"mrs"
block|,
literal|"dp"
block|}
block|,
comment|/* Before data processing */
block|{
literal|0x0fb0fff0
block|,
literal|0x0120f000
block|,
literal|"msr"
block|,
literal|"pFm"
block|}
block|,
comment|/* Before data processing */
block|{
literal|0x0fb0f000
block|,
literal|0x0320f000
block|,
literal|"msr"
block|,
literal|"pF2"
block|}
block|,
comment|/* Before data processing */
block|{
literal|0x0ffffff0
block|,
literal|0x012fff10
block|,
literal|"bx"
block|,
literal|"m"
block|}
block|,
block|{
literal|0x0fff0ff0
block|,
literal|0x016f0f10
block|,
literal|"clz"
block|,
literal|"dm"
block|}
block|,
block|{
literal|0x0ffffff0
block|,
literal|0x012fff30
block|,
literal|"blx"
block|,
literal|"m"
block|}
block|,
block|{
literal|0xfff000f0
block|,
literal|0xe1200070
block|,
literal|"bkpt"
block|,
literal|"k"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00000000
block|,
literal|"and"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00200000
block|,
literal|"eor"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00400000
block|,
literal|"sub"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00600000
block|,
literal|"rsb"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00800000
block|,
literal|"add"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00a00000
block|,
literal|"adc"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00c00000
block|,
literal|"sbc"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x00e00000
block|,
literal|"rsc"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0df00000
block|,
literal|0x01100000
block|,
literal|"tst"
block|,
literal|"Dn2"
block|}
block|,
block|{
literal|0x0df00000
block|,
literal|0x01300000
block|,
literal|"teq"
block|,
literal|"Dn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x01400000
block|,
literal|"cmp"
block|,
literal|"Dn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x01600000
block|,
literal|"cmn"
block|,
literal|"Dn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x01800000
block|,
literal|"orr"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x01a00000
block|,
literal|"mov"
block|,
literal|"Sd2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x01c00000
block|,
literal|"bic"
block|,
literal|"Sdn2"
block|}
block|,
block|{
literal|0x0de00000
block|,
literal|0x01e00000
block|,
literal|"mvn"
block|,
literal|"Sd2"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e000100
block|,
literal|"adf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e100100
block|,
literal|"muf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e200100
block|,
literal|"suf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e300100
block|,
literal|"rsf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e400100
block|,
literal|"dvf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e500100
block|,
literal|"rdf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e600100
block|,
literal|"pow"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e700100
block|,
literal|"rpw"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e800100
block|,
literal|"rmf"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e900100
block|,
literal|"fml"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0ea00100
block|,
literal|"fdv"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0eb00100
block|,
literal|"frd"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0ec00100
block|,
literal|"pol"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0f008f10
block|,
literal|0x0e000100
block|,
literal|"fpbop"
block|,
literal|"PRfgh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e008100
block|,
literal|"mvf"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e108100
block|,
literal|"mnf"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e208100
block|,
literal|"abs"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e308100
block|,
literal|"rnd"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e408100
block|,
literal|"sqt"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e508100
block|,
literal|"log"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e608100
block|,
literal|"lgn"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e708100
block|,
literal|"exp"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e808100
block|,
literal|"sin"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0e908100
block|,
literal|"cos"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0ea08100
block|,
literal|"tan"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0eb08100
block|,
literal|"asn"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0ec08100
block|,
literal|"acs"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0ff08f10
block|,
literal|0x0ed08100
block|,
literal|"atn"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0f008f10
block|,
literal|0x0e008100
block|,
literal|"fpuop"
block|,
literal|"PRfh"
block|}
block|,
block|{
literal|0x0e100f00
block|,
literal|0x0c000100
block|,
literal|"stf"
block|,
literal|"QLv"
block|}
block|,
block|{
literal|0x0e100f00
block|,
literal|0x0c100100
block|,
literal|"ldf"
block|,
literal|"QLv"
block|}
block|,
block|{
literal|0x0ff00f10
block|,
literal|0x0e000110
block|,
literal|"flt"
block|,
literal|"PRgd"
block|}
block|,
block|{
literal|0x0ff00f10
block|,
literal|0x0e100110
block|,
literal|"fix"
block|,
literal|"PRdh"
block|}
block|,
block|{
literal|0x0ff00f10
block|,
literal|0x0e200110
block|,
literal|"wfs"
block|,
literal|"d"
block|}
block|,
block|{
literal|0x0ff00f10
block|,
literal|0x0e300110
block|,
literal|"rfs"
block|,
literal|"d"
block|}
block|,
block|{
literal|0x0ff00f10
block|,
literal|0x0e400110
block|,
literal|"wfc"
block|,
literal|"d"
block|}
block|,
block|{
literal|0x0ff00f10
block|,
literal|0x0e500110
block|,
literal|"rfc"
block|,
literal|"d"
block|}
block|,
block|{
literal|0x0ff0ff10
block|,
literal|0x0e90f110
block|,
literal|"cmf"
block|,
literal|"PRgh"
block|}
block|,
block|{
literal|0x0ff0ff10
block|,
literal|0x0eb0f110
block|,
literal|"cnf"
block|,
literal|"PRgh"
block|}
block|,
block|{
literal|0x0ff0ff10
block|,
literal|0x0ed0f110
block|,
literal|"cmfe"
block|,
literal|"PRgh"
block|}
block|,
block|{
literal|0x0ff0ff10
block|,
literal|0x0ef0f110
block|,
literal|"cnfe"
block|,
literal|"PRgh"
block|}
block|,
block|{
literal|0xff100010
block|,
literal|0xfe000010
block|,
literal|"mcr2"
block|,
literal|"#z"
block|}
block|,
block|{
literal|0x0f100010
block|,
literal|0x0e000010
block|,
literal|"mcr"
block|,
literal|"#z"
block|}
block|,
block|{
literal|0xff100010
block|,
literal|0xfe100010
block|,
literal|"mrc2"
block|,
literal|"#z"
block|}
block|,
block|{
literal|0x0f100010
block|,
literal|0x0e100010
block|,
literal|"mrc"
block|,
literal|"#z"
block|}
block|,
block|{
literal|0xff000010
block|,
literal|0xfe000000
block|,
literal|"cdp2"
block|,
literal|"#y"
block|}
block|,
block|{
literal|0x0f000010
block|,
literal|0x0e000000
block|,
literal|"cdp"
block|,
literal|"#y"
block|}
block|,
block|{
literal|0xfe100090
block|,
literal|0xfc100000
block|,
literal|"ldc2"
block|,
literal|"L#v"
block|}
block|,
block|{
literal|0x0e100090
block|,
literal|0x0c100000
block|,
literal|"ldc"
block|,
literal|"L#v"
block|}
block|,
block|{
literal|0xfe100090
block|,
literal|0xfc000000
block|,
literal|"stc2"
block|,
literal|"L#v"
block|}
block|,
block|{
literal|0x0e100090
block|,
literal|0x0c000000
block|,
literal|"stc"
block|,
literal|"L#v"
block|}
block|,
block|{
literal|0x00000000
block|,
literal|0x00000000
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|arm32_insn_conditions
index|[]
index|[
literal|4
index|]
init|=
block|{
literal|"eq"
block|,
literal|"ne"
block|,
literal|"cs"
block|,
literal|"cc"
block|,
literal|"mi"
block|,
literal|"pl"
block|,
literal|"vs"
block|,
literal|"vc"
block|,
literal|"hi"
block|,
literal|"ls"
block|,
literal|"ge"
block|,
literal|"lt"
block|,
literal|"gt"
block|,
literal|"le"
block|,
literal|""
block|,
literal|"nv"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|insn_block_transfers
index|[]
index|[
literal|4
index|]
init|=
block|{
literal|"da"
block|,
literal|"ia"
block|,
literal|"db"
block|,
literal|"ib"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|insn_stack_block_transfers
index|[]
index|[
literal|4
index|]
init|=
block|{
literal|"ed"
block|,
literal|"ea"
block|,
literal|"fd"
block|,
literal|"fa"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|op_shifts
index|[]
index|[
literal|4
index|]
init|=
block|{
literal|"lsl"
block|,
literal|"lsr"
block|,
literal|"asr"
block|,
literal|"ror"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|insn_fpa_rounding
index|[]
index|[
literal|2
index|]
init|=
block|{
literal|""
block|,
literal|"p"
block|,
literal|"m"
block|,
literal|"z"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|insn_fpa_precision
index|[]
index|[
literal|2
index|]
init|=
block|{
literal|"s"
block|,
literal|"d"
block|,
literal|"e"
block|,
literal|"p"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
specifier|const
name|insn_fpaconstants
index|[]
index|[
literal|8
index|]
init|=
block|{
literal|"0.0"
block|,
literal|"1.0"
block|,
literal|"2.0"
block|,
literal|"3.0"
block|,
literal|"4.0"
block|,
literal|"5.0"
block|,
literal|"0.5"
block|,
literal|"10.0"
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|insn_condition
parameter_list|(
name|x
parameter_list|)
value|arm32_insn_conditions[(x>> 28)& 0x0f]
end_define

begin_define
define|#
directive|define
name|insn_blktrans
parameter_list|(
name|x
parameter_list|)
value|insn_block_transfers[(x>> 23)& 3]
end_define

begin_define
define|#
directive|define
name|insn_stkblktrans
parameter_list|(
name|x
parameter_list|)
value|insn_stack_block_transfers[(x>> 23)& 3]
end_define

begin_define
define|#
directive|define
name|op2_shift
parameter_list|(
name|x
parameter_list|)
value|op_shifts[(x>> 5)& 3]
end_define

begin_define
define|#
directive|define
name|insn_fparnd
parameter_list|(
name|x
parameter_list|)
value|insn_fpa_rounding[(x>> 5)& 0x03]
end_define

begin_define
define|#
directive|define
name|insn_fpaprec
parameter_list|(
name|x
parameter_list|)
value|insn_fpa_precision[(((x>> 18)& 2)|(x>> 7))& 1]
end_define

begin_define
define|#
directive|define
name|insn_fpaprect
parameter_list|(
name|x
parameter_list|)
value|insn_fpa_precision[(((x>> 21)& 2)|(x>> 15))& 1]
end_define

begin_define
define|#
directive|define
name|insn_fpaimm
parameter_list|(
name|x
parameter_list|)
value|insn_fpaconstants[x& 0x07]
end_define

begin_comment
comment|/* Local prototypes */
end_comment

begin_function_decl
specifier|static
name|void
name|disasm_register_shift
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|disasm_print_reglist
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|disasm_insn_ldrstr
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|,
name|u_int
name|loc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|disasm_insn_ldrhstrh
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|,
name|u_int
name|loc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|disasm_insn_ldcstc
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|,
name|u_int
name|loc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|u_int
name|disassemble_readword
parameter_list|(
name|u_int
name|address
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|disassemble_printaddr
parameter_list|(
name|u_int
name|address
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|vm_offset_t
name|disasm
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|vm_offset_t
name|loc
parameter_list|,
name|int
name|altfmt
parameter_list|)
block|{
name|struct
name|arm32_insn
modifier|*
name|i_ptr
init|=
operator|(
expr|struct
name|arm32_insn
operator|*
operator|)
operator|&
name|arm32_i
decl_stmt|;
name|u_int
name|insn
decl_stmt|;
name|int
name|matchp
decl_stmt|;
name|int
name|branch
decl_stmt|;
name|char
modifier|*
name|f_ptr
decl_stmt|;
name|int
name|fmt
decl_stmt|;
name|fmt
operator|=
literal|0
expr_stmt|;
name|matchp
operator|=
literal|0
expr_stmt|;
name|insn
operator|=
name|di
operator|->
name|di_readword
argument_list|(
name|loc
argument_list|)
expr_stmt|;
comment|/*	di->di_printf("loc=%08x insn=%08x : ", loc, insn);*/
while|while
condition|(
name|i_ptr
operator|->
name|name
condition|)
block|{
if|if
condition|(
operator|(
name|insn
operator|&
name|i_ptr
operator|->
name|mask
operator|)
operator|==
name|i_ptr
operator|->
name|pattern
condition|)
block|{
name|matchp
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|i_ptr
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|matchp
condition|)
block|{
name|di
operator|->
name|di_printf
argument_list|(
literal|"und%s\t%08x\n"
argument_list|,
name|insn_condition
argument_list|(
name|insn
argument_list|)
argument_list|,
name|insn
argument_list|)
expr_stmt|;
return|return
operator|(
name|loc
operator|+
name|INSN_SIZE
operator|)
return|;
block|}
comment|/* If instruction forces condition code, don't print it. */
if|if
condition|(
operator|(
name|i_ptr
operator|->
name|mask
operator|&
literal|0xf0000000
operator|)
operator|==
literal|0xf0000000
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s"
argument_list|,
name|i_ptr
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s%s"
argument_list|,
name|i_ptr
operator|->
name|name
argument_list|,
name|insn_condition
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
name|f_ptr
operator|=
name|i_ptr
operator|->
name|format
expr_stmt|;
comment|/* Insert tab if there are no instruction modifiers */
if|if
condition|(
operator|*
operator|(
name|f_ptr
operator|)
operator|<
literal|'A'
operator|||
operator|*
operator|(
name|f_ptr
operator|)
operator|>
literal|'Z'
condition|)
block|{
operator|++
name|fmt
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|f_ptr
condition|)
block|{
switch|switch
condition|(
operator|*
name|f_ptr
condition|)
block|{
comment|/* 2 - print Operand 2 of a data processing instruction */
case|case
literal|'2'
case|:
if|if
condition|(
name|insn
operator|&
literal|0x02000000
condition|)
block|{
name|int
name|rotate
init|=
operator|(
operator|(
name|insn
operator|>>
literal|7
operator|)
operator|&
literal|0x1e
operator|)
decl_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"#0x%08x"
argument_list|,
operator|(
name|insn
operator|&
literal|0xff
operator|)
operator|<<
operator|(
literal|32
operator|-
name|rotate
operator|)
operator||
operator|(
name|insn
operator|&
literal|0xff
operator|)
operator|>>
name|rotate
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|disasm_register_shift
argument_list|(
name|di
argument_list|,
name|insn
argument_list|)
expr_stmt|;
block|}
break|break;
comment|/* d - destination register (bits 12-15) */
case|case
literal|'d'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* D - insert 'p' if Rd is R15 */
case|case
literal|'D'
case|:
if|if
condition|(
operator|(
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|0x0f
operator|)
operator|==
literal|15
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"p"
argument_list|)
expr_stmt|;
break|break;
comment|/* n - n register (bits 16-19) */
case|case
literal|'n'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* s - s register (bits 8-11) */
case|case
literal|'s'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|8
operator|)
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* o - indirect register rn (bits 16-19) (used by swap) */
case|case
literal|'o'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"[r%d]"
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* m - m register (bits 0-4) */
case|case
literal|'m'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|0
operator|)
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* a - address operand of ldr/str instruction */
case|case
literal|'a'
case|:
name|disasm_insn_ldrstr
argument_list|(
name|di
argument_list|,
name|insn
argument_list|,
name|loc
argument_list|)
expr_stmt|;
break|break;
comment|/* e - address operand of ldrh/strh instruction */
case|case
literal|'e'
case|:
name|disasm_insn_ldrhstrh
argument_list|(
name|di
argument_list|,
name|insn
argument_list|,
name|loc
argument_list|)
expr_stmt|;
break|break;
comment|/* l - register list for ldm/stm instruction */
case|case
literal|'l'
case|:
name|disasm_print_reglist
argument_list|(
name|di
argument_list|,
name|insn
argument_list|)
expr_stmt|;
break|break;
comment|/* f - 1st fp operand (register) (bits 12-14) */
case|case
literal|'f'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"f%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|7
argument_list|)
expr_stmt|;
break|break;
comment|/* g - 2nd fp operand (register) (bits 16-18) */
case|case
literal|'g'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"f%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|7
argument_list|)
expr_stmt|;
break|break;
comment|/* h - 3rd fp operand (register/immediate) (bits 0-4) */
case|case
literal|'h'
case|:
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|3
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"#%s"
argument_list|,
name|insn_fpaimm
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"f%d"
argument_list|,
name|insn
operator|&
literal|7
argument_list|)
expr_stmt|;
break|break;
comment|/* b - branch address */
case|case
literal|'b'
case|:
name|branch
operator|=
operator|(
operator|(
name|insn
operator|<<
literal|2
operator|)
operator|&
literal|0x03ffffff
operator|)
expr_stmt|;
if|if
condition|(
name|branch
operator|&
literal|0x02000000
condition|)
name|branch
operator||=
literal|0xfc000000
expr_stmt|;
name|di
operator|->
name|di_printaddr
argument_list|(
name|loc
operator|+
literal|8
operator|+
name|branch
argument_list|)
expr_stmt|;
break|break;
comment|/* t - blx address */
case|case
literal|'t'
case|:
name|branch
operator|=
operator|(
operator|(
name|insn
operator|<<
literal|2
operator|)
operator|&
literal|0x03ffffff
operator|)
operator||
operator|(
name|insn
operator|>>
literal|23
operator|&
literal|0x00000002
operator|)
expr_stmt|;
if|if
condition|(
name|branch
operator|&
literal|0x02000000
condition|)
name|branch
operator||=
literal|0xfc000000
expr_stmt|;
name|di
operator|->
name|di_printaddr
argument_list|(
name|loc
operator|+
literal|8
operator|+
name|branch
argument_list|)
expr_stmt|;
break|break;
comment|/* X - block transfer type */
case|case
literal|'X'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s"
argument_list|,
name|insn_blktrans
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
break|break;
comment|/* Y - block transfer type (r13 base) */
case|case
literal|'Y'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s"
argument_list|,
name|insn_stkblktrans
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
break|break;
comment|/* c - comment field bits(0-23) */
case|case
literal|'c'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"0x%08x"
argument_list|,
operator|(
name|insn
operator|&
literal|0x00ffffff
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* k - breakpoint comment (bits 0-3, 8-19) */
case|case
literal|'k'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"0x%04x"
argument_list|,
operator|(
name|insn
operator|&
literal|0x000fff00
operator|)
operator|>>
literal|4
operator||
operator|(
name|insn
operator|&
literal|0x0000000f
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* p - saved or current status register */
case|case
literal|'p'
case|:
if|if
condition|(
name|insn
operator|&
literal|0x00400000
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"spsr"
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"cpsr"
argument_list|)
expr_stmt|;
break|break;
comment|/* F - PSR transfer fields */
case|case
literal|'F'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"_"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|16
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"c"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|17
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"x"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|18
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"s"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|19
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"f"
argument_list|)
expr_stmt|;
break|break;
comment|/* B - byte transfer flag */
case|case
literal|'B'
case|:
if|if
condition|(
name|insn
operator|&
literal|0x00400000
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"b"
argument_list|)
expr_stmt|;
break|break;
comment|/* L - co-processor transfer size */
case|case
literal|'L'
case|:
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|22
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"l"
argument_list|)
expr_stmt|;
break|break;
comment|/* S - set status flag */
case|case
literal|'S'
case|:
if|if
condition|(
name|insn
operator|&
literal|0x00100000
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"s"
argument_list|)
expr_stmt|;
break|break;
comment|/* P - fp precision */
case|case
literal|'P'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s"
argument_list|,
name|insn_fpaprec
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
break|break;
comment|/* Q - fp precision (for ldf/stf) */
case|case
literal|'Q'
case|:
break|break;
comment|/* R - fp rounding */
case|case
literal|'R'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s"
argument_list|,
name|insn_fparnd
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
break|break;
comment|/* W - writeback flag */
case|case
literal|'W'
case|:
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|21
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"!"
argument_list|)
expr_stmt|;
break|break;
comment|/* # - co-processor number */
case|case
literal|'#'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"p%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|8
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
break|break;
comment|/* v - co-processor data transfer registers+addressing mode */
case|case
literal|'v'
case|:
name|disasm_insn_ldcstc
argument_list|(
name|di
argument_list|,
name|insn
argument_list|,
name|loc
argument_list|)
expr_stmt|;
break|break;
comment|/* x - instruction in hex */
case|case
literal|'x'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"0x%08x"
argument_list|,
name|insn
argument_list|)
expr_stmt|;
break|break;
comment|/* y - co-processor data processing registers */
case|case
literal|'y'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"%d, "
argument_list|,
operator|(
name|insn
operator|>>
literal|20
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"c%d, c%d, c%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|0x0f
argument_list|,
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
argument_list|,
name|insn
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|", %d"
argument_list|,
operator|(
name|insn
operator|>>
literal|5
operator|)
operator|&
literal|0x07
argument_list|)
expr_stmt|;
break|break;
comment|/* z - co-processor register transfer registers */
case|case
literal|'z'
case|:
name|di
operator|->
name|di_printf
argument_list|(
literal|"%d, "
argument_list|,
operator|(
name|insn
operator|>>
literal|21
operator|)
operator|&
literal|0x07
argument_list|)
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d, c%d, c%d, %d"
argument_list|,
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|0x0f
argument_list|,
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
argument_list|,
name|insn
operator|&
literal|0x0f
argument_list|,
operator|(
name|insn
operator|>>
literal|5
operator|)
operator|&
literal|0x07
argument_list|)
expr_stmt|;
comment|/*			if (((insn>> 5)& 0x07) != 0) 				di->di_printf(", %d", (insn>> 5)& 0x07);*/
break|break;
default|default:
name|di
operator|->
name|di_printf
argument_list|(
literal|"[%c - unknown]"
argument_list|,
operator|*
name|f_ptr
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|*
operator|(
name|f_ptr
operator|+
literal|1
operator|)
operator|>=
literal|'A'
operator|&&
operator|*
operator|(
name|f_ptr
operator|+
literal|1
operator|)
operator|<=
literal|'Z'
condition|)
operator|++
name|f_ptr
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
operator|(
operator|++
name|f_ptr
operator|)
condition|)
block|{
operator|++
name|fmt
expr_stmt|;
if|if
condition|(
name|fmt
operator|==
literal|1
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
block|}
block|}
empty_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|loc
operator|+
name|INSN_SIZE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|disasm_register_shift
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|)
block|{
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
operator|(
name|insn
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x00000ff0
operator|)
operator|==
literal|0
condition|)
empty_stmt|;
elseif|else
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x00000ff0
operator|)
operator|==
literal|0x00000060
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|", rrx"
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|insn
operator|&
literal|0x10
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|", %s r%d"
argument_list|,
name|op2_shift
argument_list|(
name|insn
argument_list|)
argument_list|,
operator|(
name|insn
operator|>>
literal|8
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|", %s #%d"
argument_list|,
name|op2_shift
argument_list|(
name|insn
argument_list|)
argument_list|,
operator|(
name|insn
operator|>>
literal|7
operator|)
operator|&
literal|0x1f
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|disasm_print_reglist
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|)
block|{
name|int
name|loop
decl_stmt|;
name|int
name|start
decl_stmt|;
name|int
name|comma
decl_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"{"
argument_list|)
expr_stmt|;
name|start
operator|=
operator|-
literal|1
expr_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|loop
operator|=
literal|0
init|;
name|loop
operator|<
literal|17
condition|;
operator|++
name|loop
control|)
block|{
if|if
condition|(
name|start
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|loop
operator|==
literal|16
operator|||
operator|!
operator|(
name|insn
operator|&
operator|(
literal|1
operator|<<
name|loop
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|comma
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
else|else
name|comma
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|start
operator|==
name|loop
operator|-
literal|1
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
name|start
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d-r%d"
argument_list|,
name|start
argument_list|,
name|loop
operator|-
literal|1
argument_list|)
expr_stmt|;
name|start
operator|=
operator|-
literal|1
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
name|loop
operator|)
condition|)
name|start
operator|=
name|loop
expr_stmt|;
block|}
block|}
name|di
operator|->
name|di_printf
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|22
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"^"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|disasm_insn_ldrstr
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|,
name|u_int
name|loc
parameter_list|)
block|{
name|int
name|offset
decl_stmt|;
name|offset
operator|=
name|insn
operator|&
literal|0xfff
expr_stmt|;
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x032f0000
operator|)
operator|==
literal|0x010f0000
condition|)
block|{
comment|/* rA = pc, immediate index */
if|if
condition|(
name|insn
operator|&
literal|0x00800000
condition|)
name|loc
operator|+=
name|offset
expr_stmt|;
else|else
name|loc
operator|-=
name|offset
expr_stmt|;
name|di
operator|->
name|di_printaddr
argument_list|(
name|loc
operator|+
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|di
operator|->
name|di_printf
argument_list|(
literal|"[r%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x03000fff
operator|)
operator|!=
literal|0x01000000
condition|)
block|{
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s, "
argument_list|,
operator|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|24
operator|)
operator|)
condition|?
literal|""
else|:
literal|"]"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|insn
operator|&
literal|0x00800000
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|25
operator|)
condition|)
name|disasm_register_shift
argument_list|(
name|di
argument_list|,
name|insn
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"#0x%03x"
argument_list|,
name|offset
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|24
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|disasm_insn_ldrhstrh
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|,
name|u_int
name|loc
parameter_list|)
block|{
name|int
name|offset
decl_stmt|;
name|offset
operator|=
operator|(
operator|(
name|insn
operator|&
literal|0xf00
operator|)
operator|>>
literal|4
operator|)
operator||
operator|(
name|insn
operator|&
literal|0xf
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x004f0000
operator|)
operator|==
literal|0x004f0000
condition|)
block|{
comment|/* rA = pc, immediate index */
if|if
condition|(
name|insn
operator|&
literal|0x00800000
condition|)
name|loc
operator|+=
name|offset
expr_stmt|;
else|else
name|loc
operator|-=
name|offset
expr_stmt|;
name|di
operator|->
name|di_printaddr
argument_list|(
name|loc
operator|+
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|di
operator|->
name|di_printf
argument_list|(
literal|"[r%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x01400f0f
operator|)
operator|!=
literal|0x01400000
condition|)
block|{
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s, "
argument_list|,
operator|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|24
operator|)
operator|)
condition|?
literal|""
else|:
literal|"]"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|insn
operator|&
literal|0x00800000
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|22
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"#0x%02x"
argument_list|,
name|offset
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"r%d"
argument_list|,
operator|(
name|insn
operator|&
literal|0x0f
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|24
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|disasm_insn_ldcstc
parameter_list|(
specifier|const
name|disasm_interface_t
modifier|*
name|di
parameter_list|,
name|u_int
name|insn
parameter_list|,
name|u_int
name|loc
parameter_list|)
block|{
if|if
condition|(
operator|(
operator|(
name|insn
operator|>>
literal|8
operator|)
operator|&
literal|0xf
operator|)
operator|==
literal|1
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"f%d, "
argument_list|,
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|0x07
argument_list|)
expr_stmt|;
else|else
name|di
operator|->
name|di_printf
argument_list|(
literal|"c%d, "
argument_list|,
operator|(
name|insn
operator|>>
literal|12
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"[r%d"
argument_list|,
operator|(
name|insn
operator|>>
literal|16
operator|)
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"%s, "
argument_list|,
operator|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|24
operator|)
operator|)
condition|?
literal|""
else|:
literal|"]"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|23
operator|)
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|di
operator|->
name|di_printf
argument_list|(
literal|"#0x%03x"
argument_list|,
operator|(
name|insn
operator|&
literal|0xff
operator|)
operator|<<
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|24
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
if|if
condition|(
name|insn
operator|&
operator|(
literal|1
operator|<<
literal|21
operator|)
condition|)
name|di
operator|->
name|di_printf
argument_list|(
literal|"!"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|u_int
name|disassemble_readword
parameter_list|(
name|u_int
name|address
parameter_list|)
block|{
return|return
operator|(
operator|*
operator|(
operator|(
name|u_int
operator|*
operator|)
name|address
operator|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|disassemble_printaddr
parameter_list|(
name|u_int
name|address
parameter_list|)
block|{
name|printf
argument_list|(
literal|"0x%08x"
argument_list|,
name|address
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|disasm_interface_t
name|disassemble_di
init|=
block|{
name|disassemble_readword
block|,
name|disassemble_printaddr
block|,
name|db_printf
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|disassemble
parameter_list|(
name|u_int
name|address
parameter_list|)
block|{
operator|(
name|void
operator|)
name|disasm
argument_list|(
operator|&
name|disassemble_di
argument_list|,
name|address
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* End of disassem.c */
end_comment

end_unit

