begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2003-2012 Broadcom Corporation  * All Rights Reserved  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in  *    the documentation and/or other materials provided with the  *    distribution.  *   * THIS SOFTWARE IS PROVIDED BY BROADCOM ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL BROADCOM OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR  * BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN  * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/module.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/lock.h>
end_include

begin_include
include|#
directive|include
file|<sys/mutex.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<sys/uio.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/md_var.h>
end_include

begin_include
include|#
directive|include
file|<machine/cpuregs.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm.h>
end_include

begin_include
include|#
directive|include
file|<vm/pmap.h>
end_include

begin_include
include|#
directive|include
file|<opencrypto/cryptodev.h>
end_include

begin_include
include|#
directive|include
file|<mips/nlm/hal/haldefs.h>
end_include

begin_include
include|#
directive|include
file|<mips/nlm/hal/cop2.h>
end_include

begin_include
include|#
directive|include
file|<mips/nlm/hal/fmn.h>
end_include

begin_include
include|#
directive|include
file|<mips/nlm/hal/mips-extns.h>
end_include

begin_include
include|#
directive|include
file|<mips/nlm/hal/nlmsaelib.h>
end_include

begin_include
include|#
directive|include
file|<mips/nlm/dev/sec/nlmseclib.h>
end_include

begin_function
specifier|static
name|int
name|nlm_crypto_complete_sec_request
parameter_list|(
name|struct
name|xlp_sec_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
name|unsigned
name|int
name|fbvc
decl_stmt|;
name|struct
name|nlm_fmn_msg
name|m
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|fbvc
operator|=
name|nlm_cpuid
argument_list|()
operator|/
name|CMS_MAX_VCPU_VC
expr_stmt|;
name|m
operator|.
name|msg
index|[
literal|0
index|]
operator|=
name|m
operator|.
name|msg
index|[
literal|1
index|]
operator|=
name|m
operator|.
name|msg
index|[
literal|2
index|]
operator|=
name|m
operator|.
name|msg
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|m
operator|.
name|msg
index|[
literal|0
index|]
operator|=
name|nlm_crypto_form_pkt_fmn_entry0
argument_list|(
name|fbvc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|cmd
operator|->
name|ctrlp
operator|->
name|cipherkeylen
argument_list|,
name|vtophys
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|)
argument_list|)
expr_stmt|;
name|m
operator|.
name|msg
index|[
literal|1
index|]
operator|=
name|nlm_crypto_form_pkt_fmn_entry1
argument_list|(
literal|0
argument_list|,
name|cmd
operator|->
name|ctrlp
operator|->
name|hashkeylen
argument_list|,
name|NLM_CRYPTO_PKT_DESC_SIZE
argument_list|(
name|cmd
operator|->
name|nsegs
argument_list|)
argument_list|,
name|vtophys
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Software scratch pad */
name|m
operator|.
name|msg
index|[
literal|2
index|]
operator|=
operator|(
name|uintptr_t
operator|)
name|cmd
expr_stmt|;
name|sc
operator|->
name|sec_msgsz
operator|=
literal|3
expr_stmt|;
comment|/* Send the message to sec/rsa engine vc */
name|ret
operator|=
name|nlm_fmn_msgsend
argument_list|(
name|sc
operator|->
name|sec_vc_start
argument_list|,
name|sc
operator|->
name|sec_msgsz
argument_list|,
name|FMN_SWCODE_CRYPTO
argument_list|,
operator|&
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
block|{
ifdef|#
directive|ifdef
name|NLM_SEC_DEBUG
name|printf
argument_list|(
literal|"%s: msgsnd failed (%x)\n"
argument_list|,
name|__func__
argument_list|,
name|ret
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
operator|(
name|ERESTART
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|nlm_crypto_form_srcdst_segs
parameter_list|(
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
name|unsigned
name|int
name|srcseg
init|=
literal|0
decl_stmt|,
name|dstseg
init|=
literal|0
decl_stmt|;
name|struct
name|cryptodesc
modifier|*
name|cipdesc
init|=
name|NULL
decl_stmt|;
name|struct
name|cryptop
modifier|*
name|crp
init|=
name|NULL
decl_stmt|;
name|crp
operator|=
name|cmd
operator|->
name|crp
expr_stmt|;
name|cipdesc
operator|=
name|cmd
operator|->
name|enccrd
expr_stmt|;
if|if
condition|(
name|cipdesc
operator|!=
name|NULL
condition|)
block|{
comment|/* IV is given as ONE segment to avoid copy */
if|if
condition|(
name|cipdesc
operator|->
name|crd_flags
operator|&
name|CRD_F_IV_EXPLICIT
condition|)
block|{
name|srcseg
operator|=
name|nlm_crypto_fill_src_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|srcseg
argument_list|,
name|cmd
operator|->
name|iv
argument_list|,
name|cmd
operator|->
name|ivlen
argument_list|)
expr_stmt|;
name|dstseg
operator|=
name|nlm_crypto_fill_dst_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|dstseg
argument_list|,
name|cmd
operator|->
name|iv
argument_list|,
name|cmd
operator|->
name|ivlen
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|crp
operator|->
name|crp_flags
operator|&
name|CRYPTO_F_IMBUF
condition|)
block|{
name|struct
name|mbuf
modifier|*
name|m
init|=
name|NULL
decl_stmt|;
name|m
operator|=
operator|(
expr|struct
name|mbuf
operator|*
operator|)
name|crp
operator|->
name|crp_buf
expr_stmt|;
while|while
condition|(
name|m
operator|!=
name|NULL
condition|)
block|{
name|srcseg
operator|=
name|nlm_crypto_fill_src_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|srcseg
argument_list|,
name|mtod
argument_list|(
name|m
argument_list|,
name|caddr_t
argument_list|)
argument_list|,
name|m
operator|->
name|m_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|cipdesc
operator|!=
name|NULL
condition|)
block|{
name|dstseg
operator|=
name|nlm_crypto_fill_dst_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|dstseg
argument_list|,
name|mtod
argument_list|(
name|m
argument_list|,
name|caddr_t
argument_list|)
argument_list|,
name|m
operator|->
name|m_len
argument_list|)
expr_stmt|;
block|}
name|m
operator|=
name|m
operator|->
name|m_next
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|crp
operator|->
name|crp_flags
operator|&
name|CRYPTO_F_IOV
condition|)
block|{
name|struct
name|uio
modifier|*
name|uio
init|=
name|NULL
decl_stmt|;
name|struct
name|iovec
modifier|*
name|iov
init|=
name|NULL
decl_stmt|;
name|int
name|iol
init|=
literal|0
decl_stmt|;
name|uio
operator|=
operator|(
expr|struct
name|uio
operator|*
operator|)
name|crp
operator|->
name|crp_buf
expr_stmt|;
name|iov
operator|=
operator|(
expr|struct
name|iovec
operator|*
operator|)
name|uio
operator|->
name|uio_iov
expr_stmt|;
name|iol
operator|=
name|uio
operator|->
name|uio_iovcnt
expr_stmt|;
while|while
condition|(
name|iol
operator|>
literal|0
condition|)
block|{
name|srcseg
operator|=
name|nlm_crypto_fill_src_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|srcseg
argument_list|,
operator|(
name|caddr_t
operator|)
name|iov
operator|->
name|iov_base
argument_list|,
name|iov
operator|->
name|iov_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|cipdesc
operator|!=
name|NULL
condition|)
block|{
name|dstseg
operator|=
name|nlm_crypto_fill_dst_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|dstseg
argument_list|,
operator|(
name|caddr_t
operator|)
name|iov
operator|->
name|iov_base
argument_list|,
name|iov
operator|->
name|iov_len
argument_list|)
expr_stmt|;
block|}
name|iov
operator|++
expr_stmt|;
name|iol
operator|--
expr_stmt|;
block|}
block|}
else|else
block|{
name|srcseg
operator|=
name|nlm_crypto_fill_src_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|srcseg
argument_list|,
operator|(
operator|(
name|caddr_t
operator|)
name|crp
operator|->
name|crp_buf
operator|)
argument_list|,
name|crp
operator|->
name|crp_ilen
argument_list|)
expr_stmt|;
if|if
condition|(
name|cipdesc
operator|!=
name|NULL
condition|)
block|{
name|dstseg
operator|=
name|nlm_crypto_fill_dst_seg
argument_list|(
name|cmd
operator|->
name|paramp
argument_list|,
name|dstseg
argument_list|,
operator|(
operator|(
name|caddr_t
operator|)
name|crp
operator|->
name|crp_buf
operator|)
argument_list|,
name|crp
operator|->
name|crp_ilen
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|nlm_crypto_do_cipher
parameter_list|(
name|struct
name|xlp_sec_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
name|struct
name|cryptodesc
modifier|*
name|cipdesc
init|=
name|NULL
decl_stmt|;
name|unsigned
name|char
modifier|*
name|cipkey
init|=
name|NULL
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|cipdesc
operator|=
name|cmd
operator|->
name|enccrd
expr_stmt|;
name|cipkey
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|cipdesc
operator|->
name|crd_key
expr_stmt|;
if|if
condition|(
name|cmd
operator|->
name|cipheralg
operator|==
name|NLM_CIPHER_3DES
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|cipdesc
operator|->
name|crd_flags
operator|&
name|CRD_F_ENCRYPT
operator|)
condition|)
block|{
name|uint64_t
modifier|*
name|k
decl_stmt|,
modifier|*
name|tkey
decl_stmt|;
name|k
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|cipdesc
operator|->
name|crd_key
expr_stmt|;
name|tkey
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|cmd
operator|->
name|des3key
expr_stmt|;
name|tkey
index|[
literal|2
index|]
operator|=
name|k
index|[
literal|0
index|]
expr_stmt|;
name|tkey
index|[
literal|1
index|]
operator|=
name|k
index|[
literal|1
index|]
expr_stmt|;
name|tkey
index|[
literal|0
index|]
operator|=
name|k
index|[
literal|2
index|]
expr_stmt|;
name|cipkey
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|tkey
expr_stmt|;
block|}
block|}
name|nlm_crypto_fill_pkt_ctrl
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|,
literal|0
argument_list|,
name|NLM_HASH_BYPASS
argument_list|,
literal|0
argument_list|,
name|cmd
operator|->
name|cipheralg
argument_list|,
name|cmd
operator|->
name|ciphermode
argument_list|,
name|cipkey
argument_list|,
operator|(
name|cipdesc
operator|->
name|crd_klen
operator|>>
literal|3
operator|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|nlm_crypto_fill_cipher_pkt_param
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|,
name|cmd
operator|->
name|paramp
argument_list|,
operator|(
name|cipdesc
operator|->
name|crd_flags
operator|&
name|CRD_F_ENCRYPT
operator|)
condition|?
literal|1
else|:
literal|0
argument_list|,
name|cmd
operator|->
name|ivoff
argument_list|,
name|cmd
operator|->
name|ivlen
argument_list|,
name|cmd
operator|->
name|cipheroff
argument_list|,
name|cmd
operator|->
name|cipherlen
argument_list|)
expr_stmt|;
name|nlm_crypto_form_srcdst_segs
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|ret
operator|=
name|nlm_crypto_complete_sec_request
argument_list|(
name|sc
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|nlm_crypto_do_digest
parameter_list|(
name|struct
name|xlp_sec_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
name|struct
name|cryptodesc
modifier|*
name|digdesc
init|=
name|NULL
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|digdesc
operator|=
name|cmd
operator|->
name|maccrd
expr_stmt|;
name|nlm_crypto_fill_pkt_ctrl
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|,
operator|(
name|digdesc
operator|->
name|crd_klen
operator|)
condition|?
literal|1
else|:
literal|0
argument_list|,
name|cmd
operator|->
name|hashalg
argument_list|,
name|cmd
operator|->
name|hashmode
argument_list|,
name|NLM_CIPHER_BYPASS
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|digdesc
operator|->
name|crd_key
argument_list|,
name|digdesc
operator|->
name|crd_klen
operator|>>
literal|3
argument_list|)
expr_stmt|;
name|nlm_crypto_fill_auth_pkt_param
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|,
name|cmd
operator|->
name|paramp
argument_list|,
name|cmd
operator|->
name|hashoff
argument_list|,
name|cmd
operator|->
name|hashlen
argument_list|,
name|cmd
operator|->
name|hmacpad
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|cmd
operator|->
name|hashdest
argument_list|)
expr_stmt|;
name|nlm_crypto_form_srcdst_segs
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|ret
operator|=
name|nlm_crypto_complete_sec_request
argument_list|(
name|sc
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|nlm_crypto_do_cipher_digest
parameter_list|(
name|struct
name|xlp_sec_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
name|struct
name|cryptodesc
modifier|*
name|cipdesc
init|=
name|NULL
decl_stmt|,
modifier|*
name|digdesc
init|=
name|NULL
decl_stmt|;
name|unsigned
name|char
modifier|*
name|cipkey
init|=
name|NULL
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|cipdesc
operator|=
name|cmd
operator|->
name|enccrd
expr_stmt|;
name|digdesc
operator|=
name|cmd
operator|->
name|maccrd
expr_stmt|;
name|cipkey
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|cipdesc
operator|->
name|crd_key
expr_stmt|;
if|if
condition|(
name|cmd
operator|->
name|cipheralg
operator|==
name|NLM_CIPHER_3DES
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|cipdesc
operator|->
name|crd_flags
operator|&
name|CRD_F_ENCRYPT
operator|)
condition|)
block|{
name|uint64_t
modifier|*
name|k
decl_stmt|,
modifier|*
name|tkey
decl_stmt|;
name|k
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|cipdesc
operator|->
name|crd_key
expr_stmt|;
name|tkey
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|cmd
operator|->
name|des3key
expr_stmt|;
name|tkey
index|[
literal|2
index|]
operator|=
name|k
index|[
literal|0
index|]
expr_stmt|;
name|tkey
index|[
literal|1
index|]
operator|=
name|k
index|[
literal|1
index|]
expr_stmt|;
name|tkey
index|[
literal|0
index|]
operator|=
name|k
index|[
literal|2
index|]
expr_stmt|;
name|cipkey
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|tkey
expr_stmt|;
block|}
block|}
name|nlm_crypto_fill_pkt_ctrl
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|,
operator|(
name|digdesc
operator|->
name|crd_klen
operator|)
condition|?
literal|1
else|:
literal|0
argument_list|,
name|cmd
operator|->
name|hashalg
argument_list|,
name|cmd
operator|->
name|hashmode
argument_list|,
name|cmd
operator|->
name|cipheralg
argument_list|,
name|cmd
operator|->
name|ciphermode
argument_list|,
name|cipkey
argument_list|,
operator|(
name|cipdesc
operator|->
name|crd_klen
operator|>>
literal|3
operator|)
argument_list|,
name|digdesc
operator|->
name|crd_key
argument_list|,
operator|(
name|digdesc
operator|->
name|crd_klen
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|nlm_crypto_fill_cipher_auth_pkt_param
argument_list|(
name|cmd
operator|->
name|ctrlp
argument_list|,
name|cmd
operator|->
name|paramp
argument_list|,
operator|(
name|cipdesc
operator|->
name|crd_flags
operator|&
name|CRD_F_ENCRYPT
operator|)
condition|?
literal|1
else|:
literal|0
argument_list|,
name|cmd
operator|->
name|hashsrc
argument_list|,
name|cmd
operator|->
name|ivoff
argument_list|,
name|cmd
operator|->
name|ivlen
argument_list|,
name|cmd
operator|->
name|hashoff
argument_list|,
name|cmd
operator|->
name|hashlen
argument_list|,
name|cmd
operator|->
name|hmacpad
argument_list|,
name|cmd
operator|->
name|cipheroff
argument_list|,
name|cmd
operator|->
name|cipherlen
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|cmd
operator|->
name|hashdest
argument_list|)
expr_stmt|;
name|nlm_crypto_form_srcdst_segs
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|ret
operator|=
name|nlm_crypto_complete_sec_request
argument_list|(
name|sc
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|nlm_get_digest_param
parameter_list|(
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
switch|switch
condition|(
name|cmd
operator|->
name|maccrd
operator|->
name|crd_alg
condition|)
block|{
case|case
name|CRYPTO_MD5
case|:
name|cmd
operator|->
name|hashalg
operator|=
name|NLM_HASH_MD5
expr_stmt|;
name|cmd
operator|->
name|hashmode
operator|=
name|NLM_HASH_MODE_SHA1
expr_stmt|;
break|break;
case|case
name|CRYPTO_SHA1
case|:
name|cmd
operator|->
name|hashalg
operator|=
name|NLM_HASH_SHA
expr_stmt|;
name|cmd
operator|->
name|hashmode
operator|=
name|NLM_HASH_MODE_SHA1
expr_stmt|;
break|break;
case|case
name|CRYPTO_MD5_HMAC
case|:
name|cmd
operator|->
name|hashalg
operator|=
name|NLM_HASH_MD5
expr_stmt|;
name|cmd
operator|->
name|hashmode
operator|=
name|NLM_HASH_MODE_SHA1
expr_stmt|;
break|break;
case|case
name|CRYPTO_SHA1_HMAC
case|:
name|cmd
operator|->
name|hashalg
operator|=
name|NLM_HASH_SHA
expr_stmt|;
name|cmd
operator|->
name|hashmode
operator|=
name|NLM_HASH_MODE_SHA1
expr_stmt|;
break|break;
default|default:
comment|/* Not supported */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|nlm_get_cipher_param
parameter_list|(
name|struct
name|xlp_sec_command
modifier|*
name|cmd
parameter_list|)
block|{
switch|switch
condition|(
name|cmd
operator|->
name|enccrd
operator|->
name|crd_alg
condition|)
block|{
case|case
name|CRYPTO_DES_CBC
case|:
name|cmd
operator|->
name|cipheralg
operator|=
name|NLM_CIPHER_DES
expr_stmt|;
name|cmd
operator|->
name|ciphermode
operator|=
name|NLM_CIPHER_MODE_CBC
expr_stmt|;
name|cmd
operator|->
name|ivlen
operator|=
name|XLP_SEC_DES_IV_LENGTH
expr_stmt|;
break|break;
case|case
name|CRYPTO_3DES_CBC
case|:
name|cmd
operator|->
name|cipheralg
operator|=
name|NLM_CIPHER_3DES
expr_stmt|;
name|cmd
operator|->
name|ciphermode
operator|=
name|NLM_CIPHER_MODE_CBC
expr_stmt|;
name|cmd
operator|->
name|ivlen
operator|=
name|XLP_SEC_DES_IV_LENGTH
expr_stmt|;
break|break;
case|case
name|CRYPTO_AES_CBC
case|:
name|cmd
operator|->
name|cipheralg
operator|=
name|NLM_CIPHER_AES128
expr_stmt|;
name|cmd
operator|->
name|ciphermode
operator|=
name|NLM_CIPHER_MODE_CBC
expr_stmt|;
name|cmd
operator|->
name|ivlen
operator|=
name|XLP_SEC_AES_IV_LENGTH
expr_stmt|;
break|break;
case|case
name|CRYPTO_ARC4
case|:
name|cmd
operator|->
name|cipheralg
operator|=
name|NLM_CIPHER_ARC4
expr_stmt|;
name|cmd
operator|->
name|ciphermode
operator|=
name|NLM_CIPHER_MODE_ECB
expr_stmt|;
name|cmd
operator|->
name|ivlen
operator|=
name|XLP_SEC_ARC4_IV_LENGTH
expr_stmt|;
break|break;
default|default:
comment|/* Not supported */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

