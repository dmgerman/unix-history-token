begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2000-2003 Silicon Graphics, Inc.  All Rights Reserved.  *  * This program is free software; you can redistribute it and/or modify it  * under the terms of version 2 of the GNU General Public License as  * published by the Free Software Foundation.  *  * This program is distributed in the hope that it would be useful, but  * WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  *  * Further, this software is distributed without any warranty that it is  * free of the rightful claim of any third person regarding infringement  * or the like.  Any license provided herein, whether implied or  * otherwise, applies only to this software file.  Patent licenses, if  * any, provided herein do not apply to combinations of this program with  * other software, or any other product whatsoever.  *  * You should have received a copy of the GNU General Public License along  * with this program; if not, write the Free Software Foundation, Inc., 59  * Temple Place - Suite 330, Boston MA 02111-1307, USA.  *  * Contact information: Silicon Graphics, Inc., 1600 Amphitheatre Pkwy,  * Mountain View, CA  94043, or:  *  * http://www.sgi.com  *  * For further information regarding this notice, see:  *  * http://oss.sgi.com/projects/GenInfo/SGIGPLNoticeExplan/  */
end_comment

begin_comment
comment|/*  * xfs_dir2_trace.c  * Tracing for xfs v2 directories.  */
end_comment

begin_include
include|#
directive|include
file|"xfs.h"
end_include

begin_include
include|#
directive|include
file|"xfs_types.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inum.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bmap_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_attr_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dinode.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inode.h"
end_include

begin_include
include|#
directive|include
file|"xfs_da_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_trace.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
end_ifdef

begin_decl_stmt
name|ktrace_t
modifier|*
name|xfs_dir2_trace_buf
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Enter something in the trace buffers.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_dir2_trace_enter
parameter_list|(
name|xfs_inode_t
modifier|*
name|dp
parameter_list|,
name|int
name|type
parameter_list|,
name|char
modifier|*
name|where
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|int
name|namelen
parameter_list|,
name|void
modifier|*
name|a0
parameter_list|,
name|void
modifier|*
name|a1
parameter_list|,
name|void
modifier|*
name|a2
parameter_list|,
name|void
modifier|*
name|a3
parameter_list|,
name|void
modifier|*
name|a4
parameter_list|,
name|void
modifier|*
name|a5
parameter_list|,
name|void
modifier|*
name|a6
parameter_list|,
name|void
modifier|*
name|a7
parameter_list|)
block|{
name|void
modifier|*
name|n
index|[
literal|5
index|]
decl_stmt|;
name|ASSERT
argument_list|(
name|xfs_dir2_trace_buf
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|dp
operator|->
name|i_dir_trace
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
condition|)
name|memcpy
argument_list|(
name|n
argument_list|,
name|name
argument_list|,
name|min
argument_list|(
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|n
argument_list|)
argument_list|,
name|namelen
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|memset
argument_list|(
operator|(
name|char
operator|*
operator|)
name|n
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|n
argument_list|)
argument_list|)
expr_stmt|;
name|ktrace_enter
argument_list|(
name|xfs_dir2_trace_buf
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|type
argument_list|,
operator|(
name|void
operator|*
operator|)
name|where
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a0
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a1
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a2
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a3
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a4
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a5
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a6
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a7
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|0
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|1
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|2
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|3
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|ktrace_enter
argument_list|(
name|dp
operator|->
name|i_dir_trace
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|type
argument_list|,
operator|(
name|void
operator|*
operator|)
name|where
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a0
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a1
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a2
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a3
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a4
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a5
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a6
argument_list|,
operator|(
name|void
operator|*
operator|)
name|a7
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|0
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|1
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|2
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|3
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|n
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|)
block|{
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_b
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|bp
parameter_list|)
block|{
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_B
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|bp
condition|?
name|bp
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_bb
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|lbp
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|dbp
parameter_list|)
block|{
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_BB
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|lbp
condition|?
name|lbp
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|dbp
condition|?
name|dbp
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_bibii
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|bs
parameter_list|,
name|int
name|ss
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|bd
parameter_list|,
name|int
name|sd
parameter_list|,
name|int
name|c
parameter_list|)
block|{
name|xfs_buf_t
modifier|*
name|bpbs
init|=
name|bs
condition|?
name|bs
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
decl_stmt|;
name|xfs_buf_t
modifier|*
name|bpbd
init|=
name|bd
condition|?
name|bd
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
decl_stmt|;
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_BIBII
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bpbs
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|ss
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bpbd
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|sd
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|c
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_db
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|xfs_dir2_db_t
name|db
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|bp
parameter_list|)
block|{
name|xfs_buf_t
modifier|*
name|dbp
init|=
name|bp
condition|?
name|bp
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
decl_stmt|;
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_DB
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|db
argument_list|,
operator|(
name|void
operator|*
operator|)
name|dbp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_i
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|xfs_ino_t
name|i
parameter_list|)
block|{
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_I
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|i
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|i
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_s
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|int
name|s
parameter_list|)
block|{
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_S
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_dir2_trace_args_sb
parameter_list|(
name|char
modifier|*
name|where
parameter_list|,
name|xfs_da_args_t
modifier|*
name|args
parameter_list|,
name|int
name|s
parameter_list|,
name|xfs_dabuf_t
modifier|*
name|bp
parameter_list|)
block|{
name|xfs_buf_t
modifier|*
name|dbp
init|=
name|bp
condition|?
name|bp
operator|->
name|bps
index|[
literal|0
index|]
else|:
name|NULL
decl_stmt|;
name|xfs_dir2_trace_enter
argument_list|(
name|args
operator|->
name|dp
argument_list|,
name|XFS_DIR2_KTRACE_ARGS_SB
argument_list|,
name|where
argument_list|,
operator|(
name|char
operator|*
operator|)
name|args
operator|->
name|name
argument_list|,
operator|(
name|int
operator|)
name|args
operator|->
name|namelen
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|hashval
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|>>
literal|32
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|args
operator|->
name|inumber
operator|&
literal|0xFFFFFFFF
argument_list|)
operator|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|dp
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
operator|->
name|trans
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|args
operator|->
name|justcheck
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|long
operator|)
name|s
argument_list|,
operator|(
name|void
operator|*
operator|)
name|dbp
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* XFS_DIR2_TRACE */
end_comment

end_unit

