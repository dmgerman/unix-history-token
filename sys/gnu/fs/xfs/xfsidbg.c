begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2000-2005 Silicon Graphics, Inc.  * All Rights Reserved.  *  * This program is free software; you can redistribute it and/or  * modify it under the terms of the GNU General Public License as  * published by the Free Software Foundation.  *  * This program is distributed in the hope that it would be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write the Free Software Foundation,  * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA  */
end_comment

begin_include
include|#
directive|include
file|"xfs.h"
end_include

begin_include
include|#
directive|include
file|"xfs_fs.h"
end_include

begin_include
include|#
directive|include
file|"xfs_types.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bit.h"
end_include

begin_include
include|#
directive|include
file|"xfs_log.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inum.h"
end_include

begin_include
include|#
directive|include
file|"xfs_trans.h"
end_include

begin_include
include|#
directive|include
file|"xfs_sb.h"
end_include

begin_include
include|#
directive|include
file|"xfs_ag.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dmapi.h"
end_include

begin_include
include|#
directive|include
file|"xfs_mount.h"
end_include

begin_include
include|#
directive|include
file|"xfs_alloc.h"
end_include

begin_include
include|#
directive|include
file|"xfs_da_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_alloc_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bmap_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_ialloc_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_attr_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dinode.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inode.h"
end_include

begin_include
include|#
directive|include
file|"xfs_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_buf_item.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inode_item.h"
end_include

begin_include
include|#
directive|include
file|"xfs_extfree_item.h"
end_include

begin_include
include|#
directive|include
file|"xfs_rw.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bmap.h"
end_include

begin_include
include|#
directive|include
file|"xfs_attr.h"
end_include

begin_include
include|#
directive|include
file|"xfs_attr_leaf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir_leaf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_data.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_leaf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_block.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_node.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_trace.h"
end_include

begin_include
include|#
directive|include
file|"xfs_log_priv.h"
end_include

begin_include
include|#
directive|include
file|"xfs_log_recover.h"
end_include

begin_include
include|#
directive|include
file|"xfs_quota.h"
end_include

begin_include
include|#
directive|include
file|"quota/xfs_qm.h"
end_include

begin_include
include|#
directive|include
file|"xfs_iomap.h"
end_include

begin_include
include|#
directive|include
file|<support/kdb.h>
end_include

begin_define
define|#
directive|define
name|qprintf
value|kdb_printf
end_define

begin_comment
comment|/*  * Command table functions. (tracing)  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xalatrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xalbtrace
parameter_list|(
name|xfs_agblock_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xalgtrace
parameter_list|(
name|xfs_agnumber_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xalmtrace
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xalttrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ATTR_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xattrtrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BLI_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xblitrace
parameter_list|(
name|xfs_buf_log_item_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbmatrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbmitrace
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbmstrace
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbxatrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbxitrace
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbxstrace
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ILOCK_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xilock_trace
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xailock_trace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdirtrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdir2atrace
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdir2itrace
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xiclogtrace
parameter_list|(
name|xlog_in_core_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlog_granttrace
parameter_list|(
name|xlog_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DQUOT_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_dqtrace
parameter_list|(
name|xfs_dquot_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Command table functions.  */
end_comment

begin_function_decl
specifier|static
name|void
name|xfsidbg_xagf
parameter_list|(
name|xfs_agf_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xagi
parameter_list|(
name|xfs_agi_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xaildump
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xalloc
parameter_list|(
name|xfs_alloc_arg_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xattrcontext
parameter_list|(
name|xfs_attr_list_context_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xattrleaf
parameter_list|(
name|xfs_attr_leafblock_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xattrsf
parameter_list|(
name|xfs_attr_shortform_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbirec
parameter_list|(
name|xfs_bmbt_irec_t
modifier|*
name|r
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbmalla
parameter_list|(
name|xfs_bmalloca_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbrec
parameter_list|(
name|xfs_bmbt_rec_64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbroot
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbroota
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbtcur
parameter_list|(
name|xfs_btree_cur_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbuf
parameter_list|(
name|xfs_buf_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xbuf_real
parameter_list|(
name|xfs_buf_t
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xarg
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xchksum
parameter_list|(
name|uint
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xchash
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xchashlist
parameter_list|(
name|xfs_chashlist_t
modifier|*
name|chl
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdaargs
parameter_list|(
name|xfs_da_args_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdabuf
parameter_list|(
name|xfs_dabuf_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdanode
parameter_list|(
name|xfs_da_intnode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdastate
parameter_list|(
name|xfs_da_state_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdirleaf
parameter_list|(
name|xfs_dir_leafblock_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdirsf
parameter_list|(
name|xfs_dir_shortform_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdir2free
parameter_list|(
name|xfs_dir2_free_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xdir2sf
parameter_list|(
name|xfs_dir2_sf_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xexlist
parameter_list|(
name|xfs_inode_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xflist
parameter_list|(
name|xfs_bmap_free_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xhelp
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xiclog
parameter_list|(
name|xlog_in_core_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xiclogall
parameter_list|(
name|xlog_in_core_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xiclogcb
parameter_list|(
name|xlog_in_core_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xihash
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xinodes
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_delayed_blocks
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xinodes_quiesce
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlog
parameter_list|(
name|xlog_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlog_ritem
parameter_list|(
name|xlog_recover_item_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlog_rtrans
parameter_list|(
name|xlog_recover_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlog_rtrans_entire
parameter_list|(
name|xlog_recover_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlog_tic
parameter_list|(
name|xlog_ticket_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xlogitem
parameter_list|(
name|xfs_log_item_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xmount
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xnode
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xcore
parameter_list|(
name|xfs_iocore_t
modifier|*
name|io
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xperag
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_diskdq
parameter_list|(
name|xfs_disk_dquot_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_dqattached_inos
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_dquot
parameter_list|(
name|xfs_dquot_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_mplist
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_qinfo
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_tpdqinfo
parameter_list|(
name|xfs_trans_t
modifier|*
name|tp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xsb
parameter_list|(
name|xfs_sb_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xsb_convert
parameter_list|(
name|xfs_sb_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xtp
parameter_list|(
name|xfs_trans_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xtrans_res
parameter_list|(
name|xfs_mount_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_XFS_QUOTA
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_htab
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_freelist_print
parameter_list|(
name|xfs_frlist_t
modifier|*
name|qlist
parameter_list|,
name|char
modifier|*
name|title
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfsidbg_xqm_freelist
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfs_convert_extent
parameter_list|(
name|xfs_bmbt_rec_32_t
modifier|*
parameter_list|,
name|xfs_dfiloff_t
modifier|*
parameter_list|,
name|xfs_dfsbno_t
modifier|*
parameter_list|,
name|xfs_dfilblks_t
modifier|*
parameter_list|,
name|int
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Prototypes for static functions.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_function_decl
specifier|static
name|int
name|xfs_alloc_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ATTR_TRACE
end_ifdef

begin_function_decl
specifier|static
name|int
name|xfs_attr_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_function_decl
specifier|static
name|int
name|xfs_bmap_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_function_decl
specifier|static
name|int
name|xfs_bmbt_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR_TRACE
end_ifdef

begin_function_decl
specifier|static
name|int
name|xfs_dir_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
end_ifdef

begin_function_decl
specifier|static
name|int
name|xfs_dir2_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
end_ifdef

begin_function_decl
specifier|static
name|void
name|xfs_bunmap_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_rw_enter_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_page_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|xfs_rw_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
specifier|static
name|void
name|xfs_broot
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|,
name|xfs_ifork_t
modifier|*
name|f
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_btalloc
parameter_list|(
name|xfs_alloc_block_t
modifier|*
name|bt
parameter_list|,
name|int
name|bsz
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_btbmap
parameter_list|(
name|xfs_bmbt_block_t
modifier|*
name|bt
parameter_list|,
name|int
name|bsz
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_btino
parameter_list|(
name|xfs_inobt_block_t
modifier|*
name|bt
parameter_list|,
name|int
name|bsz
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_buf_item_print
parameter_list|(
name|xfs_buf_log_item_t
modifier|*
name|blip
parameter_list|,
name|int
name|summary
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_dastate_path
parameter_list|(
name|xfs_da_state_path_t
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_dir2data
parameter_list|(
name|void
modifier|*
name|addr
parameter_list|,
name|int
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_dir2leaf
parameter_list|(
name|xfs_dir2_leaf_t
modifier|*
name|leaf
parameter_list|,
name|int
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_dquot_item_print
parameter_list|(
name|xfs_dq_logitem_t
modifier|*
name|lip
parameter_list|,
name|int
name|summary
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_efd_item_print
parameter_list|(
name|xfs_efd_log_item_t
modifier|*
name|efdp
parameter_list|,
name|int
name|summary
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_efi_item_print
parameter_list|(
name|xfs_efi_log_item_t
modifier|*
name|efip
parameter_list|,
name|int
name|summary
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|xfs_fmtformat
parameter_list|(
name|xfs_dinode_fmt_t
name|f
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|xfs_fmtfsblock
parameter_list|(
name|xfs_fsblock_t
name|bno
parameter_list|,
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|xfs_fmtino
parameter_list|(
name|xfs_ino_t
name|ino
parameter_list|,
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|xfs_fmtlsn
parameter_list|(
name|xfs_lsn_t
modifier|*
name|lsnp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|xfs_fmtmode
parameter_list|(
name|int
name|m
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|xfs_fmtsize
parameter_list|(
name|size_t
name|i
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|xfs_fmtuuid
parameter_list|(
name|uuid_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_inode_item_print
parameter_list|(
name|xfs_inode_log_item_t
modifier|*
name|ilip
parameter_list|,
name|int
name|summary
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_inodebuf
parameter_list|(
name|xfs_buf_t
modifier|*
name|bp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_prdinode_core
parameter_list|(
name|xfs_dinode_core_t
modifier|*
name|dip
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_qoff_item_print
parameter_list|(
name|xfs_qoff_logitem_t
modifier|*
name|lip
parameter_list|,
name|int
name|summary
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_xexlist_fork
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|,
name|int
name|whichfork
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xfs_xnode_fork
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|xfs_ifork_t
modifier|*
name|f
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* kdb wrappers */
end_comment

begin_function
specifier|static
name|int
name|kdbm_xfs_xagf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xagf
argument_list|(
operator|(
name|xfs_agf_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xagi
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xagi
argument_list|(
operator|(
name|xfs_agi_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xaildump
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xaildump
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xalatrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xalatrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xalbtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xalbtrace
argument_list|(
operator|(
name|xfs_agblock_t
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xalgtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xalgtrace
argument_list|(
operator|(
name|xfs_agnumber_t
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ATTR_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xattrtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xattrtrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BLI_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xblitrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xblitrace
argument_list|(
operator|(
name|xfs_buf_log_item_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xbmatrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbmatrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbmitrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbmitrace
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbmstrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbmstrace
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbxatrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbxatrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbxitrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbxitrace
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbxstrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbxstrace
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xdir2atrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdir2atrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdir2itrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdir2itrace
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xdirtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdirtrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xiclogtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xiclogtrace
argument_list|(
operator|(
name|xlog_in_core_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ILOCK_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xilock_trace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xilock_trace
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xailock_trace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xailock_trace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xlog_granttrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlog_granttrace
argument_list|(
operator|(
name|xlog_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DQUOT_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_dqtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_dqtrace
argument_list|(
operator|(
name|xfs_dquot_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xrwtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|ip
operator|=
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
expr_stmt|;
if|if
condition|(
name|ip
operator|->
name|i_rwtrace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The inode trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|qprintf
argument_list|(
literal|"i_rwtrace = 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_rwtrace
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|ip
operator|->
name|i_rwtrace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_rw_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|ip
operator|->
name|i_rwtrace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|kdbm_xfs_xalloc
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xalloc
argument_list|(
operator|(
name|xfs_alloc_arg_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xalmtrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xalmtrace
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xalttrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xalttrace
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* XFS_ALLOC_TRACE */
end_comment

begin_function
specifier|static
name|int
name|kdbm_xfs_xattrcontext
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xattrcontext
argument_list|(
operator|(
name|xfs_attr_list_context_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xattrleaf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xattrleaf
argument_list|(
operator|(
name|xfs_attr_leafblock_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xattrsf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xattrsf
argument_list|(
operator|(
name|xfs_attr_shortform_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbirec
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbirec
argument_list|(
operator|(
name|xfs_bmbt_irec_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbmalla
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbmalla
argument_list|(
operator|(
name|xfs_bmalloca_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbrec
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbrec
argument_list|(
operator|(
name|xfs_bmbt_rec_64_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbroot
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbroot
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbroota
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbroota
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbtcur
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbtcur
argument_list|(
operator|(
name|xfs_btree_cur_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xbuf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xbuf
argument_list|(
operator|(
name|xfs_buf_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xarg
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xarg
argument_list|(
operator|(
name|int
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xchksum
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xchksum
argument_list|(
operator|(
name|uint
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xchash
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xchash
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xchashlist
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xchashlist
argument_list|(
operator|(
name|xfs_chashlist_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdaargs
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdaargs
argument_list|(
operator|(
name|xfs_da_args_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdabuf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdabuf
argument_list|(
operator|(
name|xfs_dabuf_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdanode
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdanode
argument_list|(
operator|(
name|xfs_da_intnode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdastate
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdastate
argument_list|(
operator|(
name|xfs_da_state_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdirleaf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdirleaf
argument_list|(
operator|(
name|xfs_dir_leafblock_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdirsf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdirsf
argument_list|(
operator|(
name|xfs_dir_shortform_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdir2free
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdir2free
argument_list|(
operator|(
name|xfs_dir2_free_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xdir2sf
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xdir2sf
argument_list|(
operator|(
name|xfs_dir2_sf_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xexlist
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xexlist
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xflist
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xflist
argument_list|(
operator|(
name|xfs_bmap_free_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xhelp
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
if|if
condition|(
name|argc
operator|!=
literal|0
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|xfsidbg_xhelp
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xiclog
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xiclog
argument_list|(
operator|(
name|xlog_in_core_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xiclogall
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xiclogall
argument_list|(
operator|(
name|xlog_in_core_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xiclogcb
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xiclogcb
argument_list|(
operator|(
name|xlog_in_core_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xihash
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xihash
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xinodes
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xinodes
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_delayed_blocks
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_delayed_blocks
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xinodes_quiesce
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xinodes_quiesce
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xlog
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlog
argument_list|(
operator|(
name|xlog_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xlog_ritem
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlog_ritem
argument_list|(
operator|(
name|xlog_recover_item_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xlog_rtrans
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlog_rtrans
argument_list|(
operator|(
name|xlog_recover_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xlog_rtrans_entire
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlog_rtrans_entire
argument_list|(
operator|(
name|xlog_recover_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xlog_tic
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlog_tic
argument_list|(
operator|(
name|xlog_ticket_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xlogitem
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xlogitem
argument_list|(
operator|(
name|xfs_log_item_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xmount
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xmount
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xnode
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xnode
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xcore
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xcore
argument_list|(
operator|(
name|xfs_iocore_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xperag
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xperag
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_diskdq
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_diskdq
argument_list|(
operator|(
name|xfs_disk_dquot_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_dqattached_inos
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_dqattached_inos
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_dquot
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_dquot
argument_list|(
operator|(
name|xfs_dquot_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_XFS_QUOTA
end_ifdef

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
if|if
condition|(
name|argc
operator|!=
literal|0
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|xfsidbg_xqm
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_freelist
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
if|if
condition|(
name|argc
operator|!=
literal|0
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|xfsidbg_xqm_freelist
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_htab
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
if|if
condition|(
name|argc
operator|!=
literal|0
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|xfsidbg_xqm_htab
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_mplist
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_mplist
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_qinfo
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_qinfo
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xqm_tpdqinfo
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xqm_tpdqinfo
argument_list|(
operator|(
name|xfs_trans_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xsb
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|unsigned
name|long
name|convert
init|=
literal|0
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
operator|&&
name|argc
operator|!=
literal|2
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
block|{
comment|/* extra argument - conversion flag */
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|convert
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
block|}
if|if
condition|(
name|convert
condition|)
name|xfsidbg_xsb_convert
argument_list|(
operator|(
name|xfs_sb_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
else|else
name|xfsidbg_xsb
argument_list|(
operator|(
name|xfs_sb_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xtp
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xtp
argument_list|(
operator|(
name|xfs_trans_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_xfs_xtrans_res
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|xfsidbg_xtrans_res
argument_list|(
operator|(
name|xfs_mount_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Vnode descriptor dump.  * This table is a string version of all the flags defined in vnode.h.  */
end_comment

begin_decl_stmt
name|char
modifier|*
name|tab_vflags
index|[]
init|=
block|{
comment|/* local only flags */
literal|"VINACT"
block|,
comment|/*	 0x01 */
literal|"VRECLM"
block|,
comment|/*	 0x02 */
literal|"VWAIT"
block|,
comment|/*	 0x04 */
literal|"VMODIFIED"
block|,
comment|/*	 0x08 */
literal|"INVALID0x10"
block|,
comment|/*	 0x10 */
literal|"INVALID0x20"
block|,
comment|/*	 0x20 */
literal|"INVALID0x40"
block|,
comment|/*	 0x40 */
literal|"INVALID0x80"
block|,
comment|/*	 0x80 */
literal|"INVALID0x100"
block|,
comment|/*	0x100 */
literal|"INVALID0x200"
block|,
comment|/*	0x200 */
literal|"INVALID0x400"
block|,
comment|/*	0x400 */
literal|"INVALID0x800"
block|,
comment|/*	0x800 */
literal|"INVALID0x1000"
block|,
comment|/*     0x1000 */
literal|"INVALID0x2000"
block|,
comment|/*     0x2000 */
literal|"INVALID0x4000"
block|,
comment|/*     0x4000 */
literal|"INVALID0x8000"
block|,
comment|/*     0x8000 */
literal|"INVALID0x10000"
block|,
comment|/*    0x10000 */
literal|"INVALID0x20000"
block|,
comment|/*    0x20000 */
literal|"INVALID0x40000"
block|,
comment|/*    0x40000 */
literal|"INVALID0x80000"
block|,
comment|/*    0x80000 */
literal|"VROOT"
block|,
comment|/*   0x100000 */
literal|"INVALID0x200000"
block|,
comment|/*   0x200000 */
literal|"INVALID00x400000"
block|,
comment|/*   0x400000 */
literal|"INVALID0x800000"
block|,
comment|/*   0x800000 */
literal|"INVALID0x1000000"
block|,
comment|/*  0x1000000 */
literal|"INVALID0x2000000"
block|,
comment|/*  0x2000000 */
literal|"VSHARE"
block|,
comment|/*  0x4000000 */
literal|"INVALID0x8000000"
block|,
comment|/*  0x8000000 */
literal|"VENF_LOCKING"
block|,
comment|/* 0x10000000 */
literal|"VOPLOCK"
block|,
comment|/* 0x20000000 */
literal|"VPURGE"
block|,
comment|/* 0x40000000 */
literal|"INVALID0x80000000"
block|,
comment|/* 0x80000000 */
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|printflags
parameter_list|(
specifier|register
name|uint64_t
name|flags
parameter_list|,
specifier|register
name|char
modifier|*
modifier|*
name|strings
parameter_list|,
specifier|register
name|char
modifier|*
name|name
parameter_list|)
block|{
specifier|register
name|uint64_t
name|mask
init|=
literal|1
decl_stmt|;
if|if
condition|(
name|name
condition|)
name|kdb_printf
argument_list|(
literal|"%s 0x%llx<"
argument_list|,
name|name
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|flags
argument_list|)
expr_stmt|;
while|while
condition|(
name|flags
operator|!=
literal|0
operator|&&
operator|*
name|strings
condition|)
block|{
if|if
condition|(
name|mask
operator|&
name|flags
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"%s "
argument_list|,
operator|*
name|strings
argument_list|)
expr_stmt|;
name|flags
operator|&=
operator|~
name|mask
expr_stmt|;
block|}
name|mask
operator|<<=
literal|1
expr_stmt|;
name|strings
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|name
condition|)
name|kdb_printf
argument_list|(
literal|"> "
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|printbhv
parameter_list|(
name|bhv_desc_t
modifier|*
name|bdp
parameter_list|)
block|{
name|int
name|maxbhv
init|=
literal|20
decl_stmt|;
comment|/* if you get 20 bhvs you're in trouble already */
name|kdb_symtab_t
name|symtab
decl_stmt|;
if|if
condition|(
name|bdp
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"NULL bhv\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"bhv at 0x%p\n"
argument_list|,
name|bdp
argument_list|)
expr_stmt|;
while|while
condition|(
name|bdp
operator|&&
name|maxbhv
operator|--
condition|)
block|{
if|if
condition|(
name|kdbnearsym
argument_list|(
operator|(
name|unsigned
name|long
operator|)
name|bdp
operator|->
name|bd_ops
argument_list|,
operator|&
name|symtab
argument_list|)
condition|)
name|kdb_printf
argument_list|(
literal|"  ops %s"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"  ops %s/0x%p"
argument_list|,
literal|"???"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bdp
operator|->
name|bd_ops
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" vobj 0x%p pdata 0x%p next 0x%p\n"
argument_list|,
name|bdp
operator|->
name|bd_vobj
argument_list|,
name|bdp
operator|->
name|bd_pdata
argument_list|,
name|bdp
operator|->
name|bd_next
argument_list|)
expr_stmt|;
name|bdp
operator|=
name|bdp
operator|->
name|bd_next
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printvnode
parameter_list|(
name|xfs_vnode_t
modifier|*
name|vp
parameter_list|,
name|unsigned
name|long
name|addr
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"vnode: 0x%lx\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" v_bh 0x%p\n"
argument_list|,
operator|&
name|vp
operator|->
name|v_bh
argument_list|)
expr_stmt|;
name|printbhv
argument_list|(
name|vp
operator|->
name|v_fbhv
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psunsigned_t
operator|)
name|vp
operator|->
name|v_flag
argument_list|,
name|tab_vflags
argument_list|,
literal|"flag ="
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_VNODE_TRACE
name|kdb_printf
argument_list|(
literal|"   v_trace 0x%p\n"
argument_list|,
name|vp
operator|->
name|v_trace
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* XFS_VNODE_TRACE */
name|kdb_printf
argument_list|(
literal|"   v_vfsp 0x%p v_number 0x%llx\n"
argument_list|,
name|vp
operator|->
name|v_vfsp
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|vp
operator|->
name|v_number
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_vnode
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
name|xfs_vnode_t
name|vp
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|vp
argument_list|,
name|addr
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
name|printvnode
argument_list|(
operator|&
name|vp
argument_list|,
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_vfs
parameter_list|(
name|xfs_vfs_t
modifier|*
name|vfs
parameter_list|,
name|unsigned
name|long
name|addr
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"vfsp at 0x%lx"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" vfs_flag 0x%x\n"
argument_list|,
name|vfs
operator|->
name|vfs_flag
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" vfs_mp 0x%p"
argument_list|,
name|vfs
operator|->
name|vfs_mp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" vfs_bh 0x%p\n"
argument_list|,
operator|&
name|vfs
operator|->
name|vfs_bh
argument_list|)
expr_stmt|;
name|printbhv
argument_list|(
name|vfs
operator|->
name|vfs_fbhv
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_bhv
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
name|bhv_desc_t
modifier|*
name|bh
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|bh
operator|=
operator|(
name|bhv_desc_t
operator|*
operator|)
name|addr
expr_stmt|;
name|printbhv
argument_list|(
name|bh
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_vfs
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
name|xfs_vfs_t
name|vfs
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|vfs
argument_list|,
name|addr
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
name|print_vfs
argument_list|(
operator|&
name|vfs
argument_list|,
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_VNODE_TRACE
end_ifdef

begin_comment
comment|/*  * Print a vnode trace entry.  */
end_comment

begin_function
specifier|static
name|int
name|vn_trace_pr_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|char
name|funcname
index|[
literal|128
index|]
decl_stmt|;
name|kdb_symtab_t
name|symtab
decl_stmt|;
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|==
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|kdbnearsym
argument_list|(
operator|(
name|unsigned
name|int
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|&
name|symtab
argument_list|)
condition|)
block|{
name|unsigned
name|long
name|offval
decl_stmt|;
name|offval
operator|=
operator|(
name|unsigned
name|int
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
operator|-
name|symtab
operator|.
name|sym_start
expr_stmt|;
if|if
condition|(
name|offval
condition|)
name|sprintf
argument_list|(
name|funcname
argument_list|,
literal|"%s+0x%lx"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|,
name|offval
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|funcname
argument_list|,
literal|"%s"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|)
expr_stmt|;
block|}
else|else
name|funcname
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
switch|switch
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|VNODE_KTRACE_ENTRY
case|:
name|kdb_printf
argument_list|(
literal|"entry to %s i_count = %d"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|VNODE_KTRACE_EXIT
case|:
name|kdb_printf
argument_list|(
literal|"exit from %s i_count = %d"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|VNODE_KTRACE_HOLD
case|:
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
operator|!=
literal|1
condition|)
name|kdb_printf
argument_list|(
literal|"hold @%s:%d(%s) i_count %d => %d "
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|funcname
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
operator|-
literal|1
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"get @%s:%d(%s) i_count = %d"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|funcname
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|VNODE_KTRACE_REF
case|:
name|kdb_printf
argument_list|(
literal|"ref @%s:%d(%s) i_count = %d"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|funcname
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|VNODE_KTRACE_RELE
case|:
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
operator|!=
literal|1
condition|)
name|kdb_printf
argument_list|(
literal|"rele @%s:%d(%s) i_count %d => %d "
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|funcname
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
operator|-
literal|1
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"free @%s:%d(%s) i_count = %d"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|funcname
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"unknown vntrace record\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  cpu = %d pid = %d "
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|pid_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
name|tab_vflags
argument_list|,
literal|"flag ="
argument_list|)
expr_stmt|;
if|if
condition|(
name|kdbnearsym
argument_list|(
operator|(
name|unsigned
name|int
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|&
name|symtab
argument_list|)
condition|)
block|{
name|unsigned
name|long
name|offval
decl_stmt|;
name|offval
operator|=
operator|(
name|unsigned
name|int
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
operator|-
name|symtab
operator|.
name|sym_start
expr_stmt|;
if|if
condition|(
name|offval
condition|)
name|kdb_printf
argument_list|(
literal|"  ra = %s+0x%lx"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|,
name|offval
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"  ra = %s"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|)
expr_stmt|;
block|}
else|else
name|kdb_printf
argument_list|(
literal|"  ra = ?? 0x%p"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Print out the trace buffer attached to the given vnode.  */
end_comment

begin_function
specifier|static
name|int
name|kdbm_vntrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|int
name|diag
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|;
name|xfs_vnode_t
modifier|*
name|vp
decl_stmt|;
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|vp
operator|=
operator|(
name|xfs_vnode_t
operator|*
operator|)
name|addr
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|v_trace
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"The vnode trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|kdb_printf
argument_list|(
literal|"vntrace vp 0x%p\n"
argument_list|,
name|vp
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|vp
operator|->
name|v_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|vn_trace_pr_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|vp
operator|->
name|v_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Print out the trace buffer attached to the given vnode.  */
end_comment

begin_function
specifier|static
name|int
name|kdbm_vntraceaddr
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|int
name|diag
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|;
name|struct
name|ktrace
modifier|*
name|kt
decl_stmt|;
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|kt
operator|=
operator|(
expr|struct
name|ktrace
operator|*
operator|)
name|addr
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"vntraceaddr kt 0x%p\n"
argument_list|,
name|kt
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|kt
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|vn_trace_pr_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|kt
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* XFS_VNODE_TRACE */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__linux__
end_ifdef

begin_function
specifier|static
name|void
name|printinode
parameter_list|(
name|struct
name|inode
modifier|*
name|ip
parameter_list|)
block|{
name|unsigned
name|long
name|addr
decl_stmt|;
if|if
condition|(
name|ip
operator|==
name|NULL
condition|)
return|return;
name|kdb_printf
argument_list|(
literal|" i_ino = %lu i_count = %u i_size %Ld\n"
argument_list|,
name|ip
operator|->
name|i_ino
argument_list|,
name|atomic_read
argument_list|(
operator|&
name|ip
operator|->
name|i_count
argument_list|)
argument_list|,
name|ip
operator|->
name|i_size
argument_list|)
expr_stmt|;
if|#
directive|if
name|LINUX_VERSION_CODE
operator|<
name|KERNEL_VERSION
argument_list|(
literal|2
operator|,
literal|6
operator|,
literal|0
argument_list|)
name|kdb_printf
argument_list|(
literal|" i_mode = 0x%x  i_nlink = %d  i_rdev = 0x%x i_state = 0x%lx\n"
argument_list|,
name|ip
operator|->
name|i_mode
argument_list|,
name|ip
operator|->
name|i_nlink
argument_list|,
name|kdev_t_to_nr
argument_list|(
name|ip
operator|->
name|i_rdev
argument_list|)
argument_list|,
name|ip
operator|->
name|i_state
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" i_hash.nxt = 0x%p i_hash.pprv = 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_hash
operator|.
name|next
argument_list|,
name|ip
operator|->
name|i_hash
operator|.
name|prev
argument_list|)
expr_stmt|;
else|#
directive|else
name|kdb_printf
argument_list|(
literal|" i_mode = 0x%x  i_nlink = %d  i_rdev = 0x%x i_state = 0x%lx\n"
argument_list|,
name|ip
operator|->
name|i_mode
argument_list|,
name|ip
operator|->
name|i_nlink
argument_list|,
name|ip
operator|->
name|i_rdev
argument_list|,
name|ip
operator|->
name|i_state
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" i_hash.nxt = 0x%p i_hash.pprv = 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_hash
operator|.
name|next
argument_list|,
name|ip
operator|->
name|i_hash
operator|.
name|pprev
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|kdb_printf
argument_list|(
literal|" i_list.nxt = 0x%p i_list.prv = 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_list
operator|.
name|next
argument_list|,
name|ip
operator|->
name|i_list
operator|.
name|prev
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" i_dentry.nxt = 0x%p i_dentry.prv = 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_dentry
operator|.
name|next
argument_list|,
name|ip
operator|->
name|i_dentry
operator|.
name|prev
argument_list|)
expr_stmt|;
name|addr
operator|=
operator|(
name|unsigned
name|long
operator|)
name|ip
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" i_sb = 0x%p i_op = 0x%p i_data = 0x%lx nrpages = %lu\n"
argument_list|,
name|ip
operator|->
name|i_sb
argument_list|,
name|ip
operator|->
name|i_op
argument_list|,
name|addr
operator|+
name|offsetof
argument_list|(
expr|struct
name|inode
argument_list|,
name|i_data
argument_list|)
argument_list|,
name|ip
operator|->
name|i_data
operator|.
name|nrpages
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  vnode ptr 0x%p\n"
argument_list|,
name|vn_from_inode
argument_list|(
name|ip
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|kdbm_vn
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|int
name|diag
decl_stmt|;
name|int
name|nextarg
init|=
literal|1
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|;
ifdef|#
directive|ifdef
name|__linux__
name|struct
name|inode
modifier|*
name|ip
decl_stmt|;
endif|#
directive|endif
name|xfs_vnode_t
name|vp
decl_stmt|;
ifdef|#
directive|ifdef
name|XFS_VNODE_TRACE
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
endif|#
directive|endif
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|vp
argument_list|,
name|addr
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
ifdef|#
directive|ifdef
name|__linux__
name|ip
operator|=
name|vn_to_inode
argument_list|(
operator|(
name|vnode_t
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"--> Inode @ 0x%p\n"
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|printinode
argument_list|(
name|ip
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|kdb_printf
argument_list|(
literal|"--> Vnode @ 0x%lx\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|printvnode
argument_list|(
operator|&
name|vp
argument_list|,
name|addr
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_VNODE_TRACE
name|kdb_printf
argument_list|(
literal|"--> Vntrace @ 0x%lx/0x%p\n"
argument_list|,
name|addr
argument_list|,
name|vp
operator|.
name|v_trace
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|.
name|v_trace
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|vp
operator|.
name|v_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|vn_trace_pr_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|vp
operator|.
name|v_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* XFS_VNODE_TRACE */
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|__linux__
end_ifdef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|bp_flag_vals
index|[]
init|=
block|{
comment|/*  0 */
literal|"READ"
block|,
literal|"WRITE"
block|,
literal|"MAPPED"
block|,
literal|"PARTIAL"
block|,
literal|"ASYNC"
block|,
comment|/*  5 */
literal|"NONE"
block|,
literal|"DELWRI"
block|,
literal|"STALE"
block|,
literal|"FS_MANAGED"
block|,
literal|"FS_DATAIOD"
block|,
comment|/* 10 */
literal|"FORCEIO"
block|,
literal|"FLUSH"
block|,
literal|"READ_AHEAD"
block|,
literal|"DIRECTIO"
block|,
literal|"LOCK"
block|,
comment|/* 15 */
literal|"TRYLOCK"
block|,
literal|"DONT_BLOCK"
block|,
literal|"PAGE_CACHE"
block|,
literal|"KMEM_ALLOC"
block|,
literal|"RUN_QUEUES"
block|,
comment|/* 20 */
literal|"PRIVATE_BH"
block|,
literal|"DELWRI_Q"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|char
modifier|*
name|iomap_flag_vals
index|[]
init|=
block|{
literal|"EOF"
block|,
literal|"HOLE"
block|,
literal|"DELAY"
block|,
literal|"INVALID0x08"
block|,
literal|"INVALID0x10"
block|,
literal|"UNWRITTEN"
block|,
literal|"NEW"
block|,
literal|"INVALID0x80"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|char
modifier|*
name|map_flags
parameter_list|(
name|unsigned
name|long
name|flags
parameter_list|,
name|char
modifier|*
name|mapping
index|[]
parameter_list|)
block|{
specifier|static
name|char
name|buffer
index|[
literal|256
index|]
decl_stmt|;
name|int
name|index
decl_stmt|;
name|int
name|offset
init|=
literal|12
decl_stmt|;
name|buffer
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|index
operator|=
literal|0
init|;
name|flags
operator|&&
name|mapping
index|[
name|index
index|]
condition|;
name|flags
operator|>>=
literal|1
operator|,
name|index
operator|++
control|)
block|{
if|if
condition|(
name|flags
operator|&
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|offset
operator|+
name|strlen
argument_list|(
name|mapping
index|[
name|index
index|]
argument_list|)
operator|+
literal|1
operator|)
operator|>=
literal|80
condition|)
block|{
name|strcat
argument_list|(
name|buffer
argument_list|,
literal|"\n	    "
argument_list|)
expr_stmt|;
name|offset
operator|=
literal|12
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset
operator|>
literal|12
condition|)
block|{
name|strcat
argument_list|(
name|buffer
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|offset
operator|++
expr_stmt|;
block|}
name|strcat
argument_list|(
name|buffer
argument_list|,
name|mapping
index|[
name|index
index|]
argument_list|)
expr_stmt|;
name|offset
operator|+=
name|strlen
argument_list|(
name|mapping
index|[
name|index
index|]
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|buffer
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|__linux__
end_ifdef

begin_function
specifier|static
name|char
modifier|*
name|bp_flags
parameter_list|(
name|xfs_buf_flags_t
name|bp_flag
parameter_list|)
block|{
return|return
operator|(
name|map_flags
argument_list|(
operator|(
name|unsigned
name|long
operator|)
name|bp_flag
argument_list|,
name|bp_flag_vals
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_bp_flags
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|flags
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|diag
operator|=
name|kdbgetularg
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|kdb_printf
argument_list|(
literal|"bp flags 0x%lx = %s\n"
argument_list|,
name|flags
argument_list|,
name|bp_flags
argument_list|(
name|flags
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_xfs_buf
parameter_list|(
name|xfs_buf_t
modifier|*
name|bp
parameter_list|,
name|unsigned
name|long
name|addr
parameter_list|)
block|{
name|unsigned
name|long
name|age
init|=
operator|(
name|xfs_buf_age_centisecs
operator|*
name|HZ
operator|)
operator|/
literal|100
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xfs_buf_t at 0x%lx\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_flags %s\n"
argument_list|,
name|bp_flags
argument_list|(
name|bp
operator|->
name|b_flags
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_target 0x%p b_hold %d b_next 0x%p b_prev 0x%p\n"
argument_list|,
name|bp
operator|->
name|b_target
argument_list|,
name|bp
operator|->
name|b_hold
operator|.
name|counter
argument_list|,
name|list_entry
argument_list|(
name|bp
operator|->
name|b_list
operator|.
name|next
argument_list|,
name|xfs_buf_t
argument_list|,
name|b_list
argument_list|)
argument_list|,
name|list_entry
argument_list|(
name|bp
operator|->
name|b_list
operator|.
name|prev
argument_list|,
name|xfs_buf_t
argument_list|,
name|b_list
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_hash 0x%p b_hash_next 0x%p b_hash_prev 0x%p\n"
argument_list|,
name|bp
operator|->
name|b_hash
argument_list|,
name|list_entry
argument_list|(
name|bp
operator|->
name|b_hash_list
operator|.
name|next
argument_list|,
name|xfs_buf_t
argument_list|,
name|b_hash_list
argument_list|)
argument_list|,
name|list_entry
argument_list|(
name|bp
operator|->
name|b_hash_list
operator|.
name|prev
argument_list|,
name|xfs_buf_t
argument_list|,
name|b_hash_list
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_file_offset 0x%llx b_buffer_length 0x%llx b_addr 0x%p\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|bp
operator|->
name|b_file_offset
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|bp
operator|->
name|b_buffer_length
argument_list|,
name|bp
operator|->
name|b_addr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_bn 0x%llx b_count_desired 0x%lx b_locked %d\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|bp
operator|->
name|b_bn
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|bp
operator|->
name|b_count_desired
argument_list|,
operator|(
name|int
operator|)
name|bp
operator|->
name|b_locked
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_queuetime %ld (now=%ld/age=%ld) b_io_remaining %d\n"
argument_list|,
name|bp
operator|->
name|b_queuetime
argument_list|,
name|jiffies
argument_list|,
name|bp
operator|->
name|b_queuetime
operator|+
name|age
argument_list|,
name|bp
operator|->
name|b_io_remaining
operator|.
name|counter
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_page_count %u b_offset 0x%x b_pages 0x%p b_error %u\n"
argument_list|,
name|bp
operator|->
name|b_page_count
argument_list|,
name|bp
operator|->
name|b_offset
argument_list|,
name|bp
operator|->
name|b_pages
argument_list|,
name|bp
operator|->
name|b_error
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  b_iodonesema (%d,%d) b_sema (%d,%d) b_pincount (%d)\n"
argument_list|,
name|bp
operator|->
name|b_iodonesema
operator|.
name|count
operator|.
name|counter
argument_list|,
name|bp
operator|->
name|b_iodonesema
operator|.
name|sleepers
argument_list|,
name|bp
operator|->
name|b_sema
operator|.
name|count
operator|.
name|counter
argument_list|,
name|bp
operator|->
name|b_sema
operator|.
name|sleepers
argument_list|,
name|bp
operator|->
name|b_pin_count
operator|.
name|counter
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_BUF_LOCK_TRACKING
name|kdb_printf
argument_list|(
literal|"  last holder %d\n"
argument_list|,
name|bp
operator|->
name|b_last_holder
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|bp
operator|->
name|b_fspriv
operator|||
name|bp
operator|->
name|b_fspriv2
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"  b_fspriv 0x%p b_fspriv2 0x%p\n"
argument_list|,
name|bp
operator|->
name|b_fspriv
argument_list|,
name|bp
operator|->
name|b_fspriv2
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_bp
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|xfs_buf_t
name|bp
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|nextarg
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|nextarg
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
operator|)
operator|||
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|bp
argument_list|,
name|addr
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
name|print_xfs_buf
argument_list|(
operator|&
name|bp
argument_list|,
name|addr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_bpdelay
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUG
specifier|extern
name|struct
name|list_head
name|xfs_buftarg_list
decl_stmt|;
name|struct
name|list_head
modifier|*
name|curr
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|xfs_buftarg_t
modifier|*
name|tp
decl_stmt|,
modifier|*
name|n
decl_stmt|;
name|xfs_buf_t
name|bp
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|,
name|verbose
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|,
name|count
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
if|if
condition|(
name|argc
operator|==
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|diag
operator|=
name|kdbgetularg
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|verbose
argument_list|)
operator|)
condition|)
block|{
return|return
name|diag
return|;
block|}
block|}
if|if
condition|(
operator|!
name|verbose
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"index bp       pin   queuetime\n"
argument_list|)
expr_stmt|;
block|}
name|list_for_each_entry_safe
argument_list|(
argument|tp
argument_list|,
argument|n
argument_list|,
argument|&xfs_buftarg_list
argument_list|,
argument|bt_list
argument_list|)
block|{
name|list_for_each_safe
argument_list|(
argument|curr
argument_list|,
argument|next
argument_list|,
argument|&tp->bt_delwrite_queue
argument_list|)
block|{
name|addr
operator|=
operator|(
name|unsigned
name|long
operator|)
name|list_entry
argument_list|(
name|curr
argument_list|,
name|xfs_buf_t
argument_list|,
name|b_list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|bp
argument_list|,
name|addr
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
if|if
condition|(
name|verbose
condition|)
block|{
name|print_xfs_buf
argument_list|(
operator|&
name|bp
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"%4d  0x%lx   %d   %ld\n"
argument_list|,
name|count
operator|++
argument_list|,
name|addr
argument_list|,
name|bp
operator|.
name|b_pin_count
operator|.
name|counter
argument_list|,
name|bp
operator|.
name|b_queuetime
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|#
directive|else
name|kdb_printf
argument_list|(
literal|"bt_delwrite_queue inaccessible (non-debug)\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|kdbm_iomap
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|xfs_iomap_t
name|iomap
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|nextarg
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|nextarg
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|iomap
argument_list|,
name|addr
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
name|kdb_printf
argument_list|(
literal|"iomap_t at 0x%lx\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  bn 0x%llx offset 0x%Lx delta 0x%lx bsize 0x%llx\n"
argument_list|,
operator|(
name|long
name|long
operator|)
name|iomap
operator|.
name|iomap_bn
argument_list|,
name|iomap
operator|.
name|iomap_offset
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|iomap
operator|.
name|iomap_delta
argument_list|,
operator|(
name|long
name|long
operator|)
name|iomap
operator|.
name|iomap_bsize
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  iomap_flags %s\n"
argument_list|,
name|map_flags
argument_list|(
name|iomap
operator|.
name|iomap_flags
argument_list|,
name|iomap_flag_vals
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_i2vnode
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|struct
name|vnode
name|vp
decl_stmt|;
name|struct
name|inode
modifier|*
name|ip
decl_stmt|;
name|unsigned
name|long
name|addr
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|nextarg
decl_stmt|;
name|int
name|diag
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
name|nextarg
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
name|ip
operator|=
operator|(
expr|struct
name|inode
operator|*
operator|)
name|addr
expr_stmt|;
if|if
condition|(
operator|(
name|diag
operator|=
name|kdb_getarea
argument_list|(
name|vp
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|vn_from_inode
argument_list|(
name|ip
argument_list|)
argument_list|)
operator|)
condition|)
return|return
name|diag
return|;
name|kdb_printf
argument_list|(
literal|"--> Inode @ 0x%p\n"
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|printinode
argument_list|(
name|ip
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"--> Vnode @ 0x%p\n"
argument_list|,
name|vn_from_inode
argument_list|(
name|ip
argument_list|)
argument_list|)
expr_stmt|;
name|printvnode
argument_list|(
operator|&
name|vp
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|vn_from_inode
argument_list|(
name|ip
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BUF_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|xfs_buf_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|unsigned
name|long
name|long
name|daddr
decl_stmt|;
name|daddr
operator|=
operator|(
operator|(
name|unsigned
name|long
name|long
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
operator|<<
literal|32
operator|)
operator||
operator|(
operator|(
name|unsigned
name|long
name|long
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
operator|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"bp 0x%p [%s] (hold %lu lock %ld) data 0x%p"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|kdb_symbol_print
argument_list|(
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
name|NULL
argument_list|,
name|KDB_SP_SPACEB
operator||
name|KDB_SP_PAREN
operator||
name|KDB_SP_NEWLINE
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"    offset 0x%llx size 0x%lx task 0x%p\n"
argument_list|,
name|daddr
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"    flags: %s\n"
argument_list|,
name|bp_flags
argument_list|(
operator|(
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_bptrace_offset
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|long
name|mask
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|got_offset
init|=
literal|0
decl_stmt|,
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|;
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|argc
operator|>
literal|2
condition|)
return|return
name|KDB_ARGCOUNT
return|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
block|{
name|diag
operator|=
name|kdbgetularg
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|offset
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
name|got_offset
operator|=
literal|1
expr_stmt|;
comment|/* allows tracing offset zero */
block|}
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
name|diag
operator|=
name|kdbgetularg
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|mask
argument_list|)
expr_stmt|;
comment|/* sign extent mask */
if|if
condition|(
name|diag
condition|)
return|return
name|diag
return|;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_buf_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
do|do
block|{
name|unsigned
name|long
name|long
name|daddr
decl_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
break|break;
name|daddr
operator|=
operator|(
operator|(
name|unsigned
name|long
name|long
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
operator|<<
literal|32
operator|)
operator||
operator|(
operator|(
name|unsigned
name|long
name|long
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
operator|)
expr_stmt|;
if|if
condition|(
name|got_offset
operator|&&
operator|(
operator|(
name|daddr
operator|&
operator|~
name|mask
operator|)
operator|!=
name|offset
operator|)
condition|)
continue|continue;
if|if
condition|(
name|xfs_buf_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_buf_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
do|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|kdbm_bptrace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|pt_regs
modifier|*
name|regs
parameter_list|)
block|{
name|unsigned
name|long
name|addr
init|=
literal|0
decl_stmt|;
name|int
name|diag
decl_stmt|,
name|nextarg
decl_stmt|;
name|long
name|offset
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|event_match
init|=
name|NULL
decl_stmt|;
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
return|return
name|KDB_ARGCOUNT
return|;
if|if
condition|(
name|argc
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|isupper
argument_list|(
name|argv
index|[
literal|1
index|]
index|[
literal|0
index|]
argument_list|)
operator|||
name|islower
argument_list|(
name|argv
index|[
literal|1
index|]
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|event_match
operator|=
operator|(
name|char
operator|*
operator|)
name|argv
index|[
literal|1
index|]
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"event match on \"%s\"\n"
argument_list|,
name|event_match
argument_list|)
expr_stmt|;
name|argc
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|nextarg
operator|=
literal|1
expr_stmt|;
name|diag
operator|=
name|kdbgetaddrarg
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|nextarg
argument_list|,
operator|&
name|addr
argument_list|,
operator|&
name|offset
argument_list|,
name|NULL
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|diag
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"non-numeric arg: %s\n"
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
name|diag
return|;
block|}
block|}
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_buf_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
do|do
block|{
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
break|break;
if|if
condition|(
name|addr
operator|&&
operator|(
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|!=
operator|(
name|void
operator|*
operator|)
name|addr
operator|)
condition|)
continue|continue;
if|if
condition|(
name|event_match
operator|&&
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|event_match
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|xfs_buf_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_buf_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
do|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_struct
struct|struct
name|xif
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|int
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
parameter_list|,
name|struct
name|pt_regs
modifier|*
parameter_list|)
function_decl|;
name|char
modifier|*
name|args
decl_stmt|;
name|char
modifier|*
name|help
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|xif
name|xfsidbg_funcs
index|[]
init|=
block|{
block|{
literal|"bhv"
block|,
name|kdbm_bhv
block|,
literal|"<bhv>"
block|,
literal|"Dump bhv chain"
block|}
block|,
block|{
literal|"vn"
block|,
name|kdbm_vn
block|,
literal|"<vnode>"
block|,
literal|"Dump inode/vnode/trace"
block|}
block|,
block|{
literal|"vnode"
block|,
name|kdbm_vnode
block|,
literal|"<vnode>"
block|,
literal|"Dump vnode"
block|}
block|,
block|{
literal|"vfs"
block|,
name|kdbm_vfs
block|,
literal|"<vfs>"
block|,
literal|"Dump vfs"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_VNODE_TRACE
block|{
literal|"vntrace"
block|,
name|kdbm_vntrace
block|,
literal|"<vntrace>"
block|,
literal|"Dump vnode Trace"
block|}
block|,
block|{
literal|"vntraceaddr"
block|,
name|kdbm_vntraceaddr
block|,
literal|"<vntrace>"
block|,
literal|"Dump vnode Trace by Address"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xagf"
block|,
name|kdbm_xfs_xagf
block|,
literal|"<agf>"
block|,
literal|"Dump XFS allocation group freespace"
block|}
block|,
block|{
literal|"xagi"
block|,
name|kdbm_xfs_xagi
block|,
literal|"<agi>"
block|,
literal|"Dump XFS allocation group inode"
block|}
block|,
block|{
literal|"xail"
block|,
name|kdbm_xfs_xaildump
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS AIL for a mountpoint"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
block|{
literal|"xalatrc"
block|,
name|kdbm_xfs_xalatrace
block|,
literal|"<count>"
block|,
literal|"Dump XFS alloc count trace"
block|}
block|,
block|{
literal|"xalbtrc"
block|,
name|kdbm_xfs_xalbtrace
block|,
literal|"<xfs_agblock_t>"
block|,
literal|"Dump XFS alloc block trace"
block|}
block|,
block|{
literal|"xalgtrc"
block|,
name|kdbm_xfs_xalgtrace
block|,
literal|"<xfs_agnumber_t>"
block|,
literal|"Dump XFS alloc alloc-group trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xalloc"
block|,
name|kdbm_xfs_xalloc
block|,
literal|"<xfs_alloc_arg_t>"
block|,
literal|"Dump XFS allocation args structure"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
block|{
literal|"xalmtrc"
block|,
name|kdbm_xfs_xalmtrace
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS alloc mount-point trace"
block|}
block|,
block|{
literal|"xalttrc"
block|,
name|kdbm_xfs_xalttrace
block|,
literal|"<tag>"
block|,
literal|"Dump XFS alloc trace by tag number"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xarg"
block|,
name|kdbm_xfs_xarg
block|,
literal|"<value>"
block|,
literal|"Input XFS argument for next function"
block|}
block|,
block|{
literal|"xattrcx"
block|,
name|kdbm_xfs_xattrcontext
block|,
literal|"<xfs_attr_list_context_t>"
block|,
literal|"Dump XFS attr_list context struct"
block|}
block|,
block|{
literal|"xattrlf"
block|,
name|kdbm_xfs_xattrleaf
block|,
literal|"<xfs_attr_leafblock_t>"
block|,
literal|"Dump XFS attribute leaf block"
block|}
block|,
block|{
literal|"xattrsf"
block|,
name|kdbm_xfs_xattrsf
block|,
literal|"<xfs_attr_shortform_t>"
block|,
literal|"Dump XFS attribute shortform"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_ATTR_TRACE
block|{
literal|"xattrtr"
block|,
name|kdbm_xfs_xattrtrace
block|,
literal|"<count>"
block|,
literal|"Dump XFS attribute attr_list() trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xbirec"
block|,
name|kdbm_xfs_xbirec
block|,
literal|"<xfs_bmbt_irec_t"
block|,
literal|"Dump XFS bmap incore record"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_BLI_TRACE
block|{
literal|"xblitrc"
block|,
name|kdbm_xfs_xblitrace
block|,
literal|"<xfs_buf_log_item_t>"
block|,
literal|"Dump XFS buf log item trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xbmalla"
block|,
name|kdbm_xfs_xbmalla
block|,
literal|"<xfs_bmalloca_t>"
block|,
literal|"Dump XFS bmalloc args structure"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
block|{
literal|"xbmatrc"
block|,
name|kdbm_xfs_xbmatrace
block|,
literal|"<count>"
block|,
literal|"Dump XFS bmap btree count trace"
block|}
block|,
block|{
literal|"xbmitrc"
block|,
name|kdbm_xfs_xbmitrace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap btree per-inode trace"
block|}
block|,
block|{
literal|"xbmstrc"
block|,
name|kdbm_xfs_xbmstrace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap btree inode trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xbrec"
block|,
name|kdbm_xfs_xbrec
block|,
literal|"<xfs_bmbt_rec_64_t>"
block|,
literal|"Dump XFS bmap record"
block|}
block|,
block|{
literal|"xbroot"
block|,
name|kdbm_xfs_xbroot
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap btree root (data)"
block|}
block|,
block|{
literal|"xbroota"
block|,
name|kdbm_xfs_xbroota
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap btree root (attr)"
block|}
block|,
block|{
literal|"xbtcur"
block|,
name|kdbm_xfs_xbtcur
block|,
literal|"<xfs_btree_cur_t>"
block|,
literal|"Dump XFS btree cursor"
block|}
block|,
block|{
literal|"xbuf"
block|,
name|kdbm_xfs_xbuf
block|,
literal|"<xfs_buf_t>"
block|,
literal|"Dump XFS data from a buffer"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
block|{
literal|"xbxatrc"
block|,
name|kdbm_xfs_xbxatrace
block|,
literal|"<count>"
block|,
literal|"Dump XFS bmap extent count trace"
block|}
block|,
block|{
literal|"xbxitrc"
block|,
name|kdbm_xfs_xbxitrace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap extent per-inode trace"
block|}
block|,
block|{
literal|"xbxstrc"
block|,
name|kdbm_xfs_xbxstrace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap extent inode trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xchash"
block|,
name|kdbm_xfs_xchash
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS cluster hash"
block|}
block|,
block|{
literal|"xchlist"
block|,
name|kdbm_xfs_xchashlist
block|,
literal|"<xfs_chashlist_t>"
block|,
literal|"Dump XFS cluster hash list"
block|}
block|,
block|{
literal|"xchksum"
block|,
name|kdbm_xfs_xchksum
block|,
literal|"<addr>"
block|,
literal|"Dump chksum"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
block|{
literal|"xd2atrc"
block|,
name|kdbm_xfs_xdir2atrace
block|,
literal|"<count>"
block|,
literal|"Dump XFS directory v2 count trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xd2free"
block|,
name|kdbm_xfs_xdir2free
block|,
literal|"<xfs_dir2_free_t>"
block|,
literal|"Dump XFS directory v2 freemap"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
block|{
literal|"xd2itrc"
block|,
name|kdbm_xfs_xdir2itrace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS directory v2 per-inode trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xdaargs"
block|,
name|kdbm_xfs_xdaargs
block|,
literal|"<xfs_da_args_t>"
block|,
literal|"Dump XFS dir/attr args structure"
block|}
block|,
block|{
literal|"xdabuf"
block|,
name|kdbm_xfs_xdabuf
block|,
literal|"<xfs_dabuf_t>"
block|,
literal|"Dump XFS dir/attr buf structure"
block|}
block|,
block|{
literal|"xdanode"
block|,
name|kdbm_xfs_xdanode
block|,
literal|"<xfs_da_intnode_t>"
block|,
literal|"Dump XFS dir/attr node block"
block|}
block|,
block|{
literal|"xdastat"
block|,
name|kdbm_xfs_xdastate
block|,
literal|"<xfs_da_state_t>"
block|,
literal|"Dump XFS dir/attr state_blk struct"
block|}
block|,
block|{
literal|"xdelay"
block|,
name|kdbm_xfs_delayed_blocks
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump delayed block totals"
block|}
block|,
block|{
literal|"xdirlf"
block|,
name|kdbm_xfs_xdirleaf
block|,
literal|"<xfs_dir_leafblock_t>"
block|,
literal|"Dump XFS directory leaf block"
block|}
block|,
block|{
literal|"xdirsf"
block|,
name|kdbm_xfs_xdirsf
block|,
literal|"<xfs_dir_shortform_t>"
block|,
literal|"Dump XFS directory shortform"
block|}
block|,
block|{
literal|"xdir2sf"
block|,
name|kdbm_xfs_xdir2sf
block|,
literal|"<xfs_dir2_sf_t>"
block|,
literal|"Dump XFS directory v2 shortform"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_DIR_TRACE
block|{
literal|"xdirtrc"
block|,
name|kdbm_xfs_xdirtrace
block|,
literal|"<count>"
block|,
literal|"Dump XFS directory getdents() trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xdiskdq"
block|,
name|kdbm_xfs_xqm_diskdq
block|,
literal|"<xfs_disk_dquot_t>"
block|,
literal|"Dump XFS ondisk dquot (quota) struct"
block|}
block|,
block|{
literal|"xdqatt"
block|,
name|kdbm_xfs_xqm_dqattached_inos
block|,
literal|"<xfs_mount_t>"
block|,
literal|"All incore inodes with dquots"
block|}
block|,
block|{
literal|"xdqinfo"
block|,
name|kdbm_xfs_xqm_tpdqinfo
block|,
literal|"<xfs_trans_t>"
block|,
literal|"Dump dqinfo structure of a trans"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_DQUOT_TRACE
block|{
literal|"xdqtrace"
block|,
name|kdbm_xfs_xqm_dqtrace
block|,
literal|"<xfs_dquot_t>"
block|,
literal|"Dump trace of a given dquot"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xdquot"
block|,
name|kdbm_xfs_xqm_dquot
block|,
literal|"<xfs_dquot_t>"
block|,
literal|"Dump XFS dquot (quota) structure"
block|}
block|,
block|{
literal|"xexlist"
block|,
name|kdbm_xfs_xexlist
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS bmap extents in inode"
block|}
block|,
block|{
literal|"xflist"
block|,
name|kdbm_xfs_xflist
block|,
literal|"<xfs_bmap_free_t>"
block|,
literal|"Dump XFS to-be-freed extent records"
block|}
block|,
block|{
literal|"xhelp"
block|,
name|kdbm_xfs_xhelp
block|,
literal|""
block|,
literal|"Print idbg-xfs help"
block|}
block|,
block|{
literal|"xicall"
block|,
name|kdbm_xfs_xiclogall
block|,
literal|"<xlog_in_core_t>"
block|,
literal|"Dump All XFS in-core logs"
block|}
block|,
block|{
literal|"xiclog"
block|,
name|kdbm_xfs_xiclog
block|,
literal|"<xlog_in_core_t>"
block|,
literal|"Dump XFS in-core log"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
block|{
literal|"xictrc"
block|,
name|kdbm_xfs_xiclogtrace
block|,
literal|"<xlog_in_core_t>"
block|,
literal|"Dump XFS in-core log trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xihash"
block|,
name|kdbm_xfs_xihash
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS inode hash statistics"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_ILOCK_TRACE
block|{
literal|"xilocktrc"
block|,
name|kdbm_xfs_xilock_trace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS ilock trace"
block|}
block|,
block|{
literal|"xailcktrc"
block|,
name|kdbm_xfs_xailock_trace
block|,
literal|"<count>"
block|,
literal|"Dump XFS global ilock trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xinodes"
block|,
name|kdbm_xfs_xinodes
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS inodes per mount"
block|}
block|,
block|{
literal|"xquiesce"
block|,
name|kdbm_xfs_xinodes_quiesce
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump non-quiesced XFS inodes per mount"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
block|{
literal|"xl_grtr"
block|,
name|kdbm_xfs_xlog_granttrace
block|,
literal|"<xlog_t>"
block|,
literal|"Dump XFS log grant trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xl_rcit"
block|,
name|kdbm_xfs_xlog_ritem
block|,
literal|"<xlog_recover_item_t>"
block|,
literal|"Dump XFS recovery item"
block|}
block|,
block|{
literal|"xl_rctr"
block|,
name|kdbm_xfs_xlog_rtrans
block|,
literal|"<xlog_recover_t>"
block|,
literal|"Dump XFS recovery transaction"
block|}
block|,
block|{
literal|"xl_rctr2"
block|,
name|kdbm_xfs_xlog_rtrans_entire
block|,
literal|"<xlog_recover_t>"
block|,
literal|"Dump entire recovery transaction"
block|}
block|,
block|{
literal|"xl_tic"
block|,
name|kdbm_xfs_xlog_tic
block|,
literal|"<xlog_ticket_t>"
block|,
literal|"Dump XFS log ticket"
block|}
block|,
block|{
literal|"xlog"
block|,
name|kdbm_xfs_xlog
block|,
literal|"<xlog_t>"
block|,
literal|"Dump XFS log"
block|}
block|,
block|{
literal|"xlogcb"
block|,
name|kdbm_xfs_xiclogcb
block|,
literal|"<xlog_in_core_t>"
block|,
literal|"Dump XFS in-core log callbacks"
block|}
block|,
block|{
literal|"xlogitm"
block|,
name|kdbm_xfs_xlogitem
block|,
literal|"<xfs_log_item_t>"
block|,
literal|"Dump XFS log item structure"
block|}
block|,
block|{
literal|"xmount"
block|,
name|kdbm_xfs_xmount
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS mount structure"
block|}
block|,
block|{
literal|"xnode"
block|,
name|kdbm_xfs_xnode
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS inode"
block|}
block|,
block|{
literal|"xiocore"
block|,
name|kdbm_xfs_xcore
block|,
literal|"<xfs_iocore_t>"
block|,
literal|"Dump XFS iocore"
block|}
block|,
block|{
literal|"xperag"
block|,
name|kdbm_xfs_xperag
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS per-allocation group data"
block|}
block|,
block|{
literal|"xqinfo"
block|,
name|kdbm_xfs_xqm_qinfo
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump mount->m_quotainfo structure"
block|}
block|,
ifdef|#
directive|ifdef
name|CONFIG_XFS_QUOTA
block|{
literal|"xqm"
block|,
name|kdbm_xfs_xqm
block|,
literal|""
block|,
literal|"Dump XFS quota manager structure"
block|}
block|,
block|{
literal|"xqmfree"
block|,
name|kdbm_xfs_xqm_freelist
block|,
literal|""
block|,
literal|"Dump XFS global freelist of dquots"
block|}
block|,
block|{
literal|"xqmhtab"
block|,
name|kdbm_xfs_xqm_htab
block|,
literal|""
block|,
literal|"Dump XFS hashtable of dquots"
block|}
block|,
endif|#
directive|endif
comment|/* CONFIG_XFS_QUOTA */
block|{
literal|"xqmplist"
block|,
name|kdbm_xfs_xqm_mplist
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS all dquots of a f/s"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
block|{
literal|"xrwtrc"
block|,
name|kdbm_xfs_xrwtrace
block|,
literal|"<xfs_inode_t>"
block|,
literal|"Dump XFS inode read/write trace"
block|}
block|,
endif|#
directive|endif
block|{
literal|"xsb"
block|,
name|kdbm_xfs_xsb
block|,
literal|"<xfs_sb_t><cnv>"
block|,
literal|"Dump XFS superblock"
block|}
block|,
block|{
literal|"xtp"
block|,
name|kdbm_xfs_xtp
block|,
literal|"<xfs_trans_t>"
block|,
literal|"Dump XFS transaction structure"
block|}
block|,
block|{
literal|"xtrres"
block|,
name|kdbm_xfs_xtrans_res
block|,
literal|"<xfs_mount_t>"
block|,
literal|"Dump XFS reservation values"
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xif
name|xfsbuf_funcs
index|[]
init|=
block|{
block|{
literal|"bp"
block|,
name|kdbm_bp
block|,
literal|"<vaddr>"
block|,
literal|"Display xfs_buf_t"
block|}
block|,
block|{
literal|"bpflags"
block|,
name|kdbm_bp_flags
block|,
literal|"<flags>"
block|,
literal|"Display xfs_buf flags"
block|}
block|,
block|{
literal|"xiomap"
block|,
name|kdbm_iomap
block|,
literal|"<xfs_iomap_t *>"
block|,
literal|"Display IOmap"
block|}
block|,
block|{
literal|"i2vnode"
block|,
name|kdbm_i2vnode
block|,
literal|"<inode *>"
block|,
literal|"Display Vnode"
block|}
block|,
block|{
literal|"bpdelay"
block|,
name|kdbm_bpdelay
block|,
literal|"0|1"
block|,
literal|"Display delwri buffers"
block|}
block|,
ifdef|#
directive|ifdef
name|XFS_BUF_TRACE
block|{
literal|"bptrace"
block|,
name|kdbm_bptrace
block|,
literal|"<vaddr>|<count>"
block|,
literal|"xfs_buf_t trace"
block|}
block|,
block|{
literal|"bpoffset"
block|,
name|kdbm_bptrace_offset
block|,
literal|"<daddr> [<mask>]"
block|,
literal|"xfs_buf_t trace"
block|}
block|,
endif|#
directive|endif
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|xfsidbg_init
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|xif
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|xfsidbg_funcs
init|;
name|p
operator|->
name|name
condition|;
name|p
operator|++
control|)
name|kdb_register
argument_list|(
name|p
operator|->
name|name
argument_list|,
name|p
operator|->
name|func
argument_list|,
name|p
operator|->
name|args
argument_list|,
name|p
operator|->
name|help
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|xfsbuf_funcs
init|;
name|p
operator|->
name|name
condition|;
name|p
operator|++
control|)
name|kdb_register
argument_list|(
name|p
operator|->
name|name
argument_list|,
name|p
operator|->
name|func
argument_list|,
name|p
operator|->
name|args
argument_list|,
name|p
operator|->
name|help
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_exit
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|xif
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|xfsidbg_funcs
init|;
name|p
operator|->
name|name
condition|;
name|p
operator|++
control|)
name|kdb_unregister
argument_list|(
name|p
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|xfsbuf_funcs
init|;
name|p
operator|->
name|name
condition|;
name|p
operator|++
control|)
name|kdb_unregister
argument_list|(
name|p
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Argument to xfs_alloc routines, for allocation type.  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|xfs_alloctype
index|[]
init|=
block|{
literal|"any_ag"
block|,
literal|"first_ag"
block|,
literal|"start_ag"
block|,
literal|"this_ag"
block|,
literal|"start_bno"
block|,
literal|"near_bno"
block|,
literal|"this_bno"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Static functions.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_comment
comment|/*  * Print xfs alloc trace buffer entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_alloc_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|modagf_flags
index|[]
init|=
block|{
literal|"magicnum"
block|,
literal|"versionnum"
block|,
literal|"seqno"
block|,
literal|"length"
block|,
literal|"roots"
block|,
literal|"levels"
block|,
literal|"flfirst"
block|,
literal|"fllast"
block|,
literal|"flcount"
block|,
literal|"freeblks"
block|,
literal|"longest"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&
literal|0xffff
operator|)
operator|==
literal|0
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&
literal|0xffffL
condition|)
block|{
case|case
name|XFS_ALLOC_KTRACE_ALLOC
case|:
name|kdb_printf
argument_list|(
literal|"alloc %s[%s %ld] mp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
condition|?
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
else|:
literal|""
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"agno %ld agbno %ld minlen %ld maxlen %ld mod %ld prod %ld minleft %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"total %ld alignment %ld len %ld type %s otype %s\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
name|xfs_alloctype
index|[
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
operator|)
operator|>>
literal|16
index|]
argument_list|,
name|xfs_alloctype
index|[
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
operator|)
operator|&
literal|0xffff
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"wasdel %d wasfromfl %d isfl %d userdata %d\n"
argument_list|,
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
operator|&
operator|(
literal|1
operator|<<
literal|3
operator|)
operator|)
operator|!=
literal|0
argument_list|,
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
operator|&
operator|(
literal|1
operator|<<
literal|2
operator|)
operator|)
operator|!=
literal|0
argument_list|,
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
operator|&
operator|(
literal|1
operator|<<
literal|1
operator|)
operator|)
operator|!=
literal|0
argument_list|,
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
operator|&
operator|(
literal|1
operator|<<
literal|0
operator|)
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ALLOC_KTRACE_FREE
case|:
name|kdb_printf
argument_list|(
literal|"free %s[%s %ld] mp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
condition|?
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
else|:
literal|""
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"agno %ld agbno %ld len %ld isfl %d\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|!=
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ALLOC_KTRACE_MODAGF
case|:
name|kdb_printf
argument_list|(
literal|"modagf %s[%s %ld] mp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
condition|?
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
else|:
literal|""
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
name|modagf_flags
argument_list|,
literal|"modified"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"seqno %lu length %lu roots b %lu c %lu\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"levels b %lu c %lu flfirst %lu fllast %lu flcount %lu\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"freeblks %lu longest %lu\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ALLOC_KTRACE_UNBUSY
case|:
name|kdb_printf
argument_list|(
literal|"unbusy %s [%s %ld] mp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
condition|?
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
else|:
literal|""
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"      agno %lu slot %lu tp 0x%p\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|xfs_trans_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ALLOC_KTRACE_BUSY
case|:
name|kdb_printf
argument_list|(
literal|"busy %s [%s %ld] mp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
condition|?
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
else|:
literal|""
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"      agno %lu agbno %lu len %lu slot %lu tp 0x%p\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|xfs_trans_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ALLOC_KTRACE_BUSYSEARCH
case|:
name|kdb_printf
argument_list|(
literal|"busy-search %s [%s %ld] mp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
condition|?
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
else|:
literal|""
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"      agno %ld agbno %ld len %ld slot %ld tp 0x%p\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|xfs_trans_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"unknown alloc trace record\n"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* XFS_ALLOC_TRACE */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ATTR_TRACE
end_ifdef

begin_comment
comment|/*  * Print an attribute trace buffer entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_attr_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|attr_arg_flags
index|[]
init|=
block|{
literal|"DONTFOLLOW"
block|,
comment|/* 0x0001 */
literal|"ROOT"
block|,
comment|/* 0x0002 */
literal|"TRUSTED"
block|,
comment|/* 0x0004 */
literal|"SECURE"
block|,
comment|/* 0x0008 */
literal|"CREATE"
block|,
comment|/* 0x0010 */
literal|"REPLACE"
block|,
comment|/* 0x0020 */
literal|"?"
block|,
comment|/* 0x0040 */
literal|"?"
block|,
comment|/* 0x0080 */
literal|"SYSTEM"
block|,
comment|/* 0x0100 */
literal|"?"
block|,
comment|/* 0x0200 */
literal|"?"
block|,
comment|/* 0x0400 */
literal|"?"
block|,
comment|/* 0x0800 */
literal|"KERNOTIME"
block|,
comment|/* 0x1000 */
literal|"KERNOVAL"
block|,
comment|/* 0x2000 */
literal|"KERNAMELS"
block|,
comment|/* 0x4000 */
literal|"KERNFULLS"
block|,
comment|/* 0x8000 */
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
return|return
literal|0
return|;
name|qprintf
argument_list|(
literal|"-- %s: cursor h/b/o 0x%lx/0x%lx/%lu, dupcnt %lu, dp 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"   alist 0x%p, size %lu, count %lu, firstu %lu, Llen %lu"
argument_list|,
operator|(
name|attrlist_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
call|(
name|__psunsigned_t
call|)
argument_list|(
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|)
argument_list|,
name|attr_arg_flags
argument_list|,
literal|", flags"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|XFS_ATTR_KTRACE_L_C
case|:
break|break;
case|case
name|XFS_ATTR_KTRACE_L_CN
case|:
name|qprintf
argument_list|(
literal|"   node: count %lu, 1st hash 0x%lx, last hash 0x%lx\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ATTR_KTRACE_L_CB
case|:
name|qprintf
argument_list|(
literal|"   btree: hash 0x%lx, blkno 0x%lx\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ATTR_KTRACE_L_CL
case|:
name|qprintf
argument_list|(
literal|"   leaf: count %ld, 1st hash 0x%lx, last hash 0x%lx\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qprintf
argument_list|(
literal|"   unknown attr trace record format\n"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* XFS_ATTR_TRACE */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_comment
comment|/*  * Print xfs bmap extent trace buffer entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_bmap_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|xfs_dfsbno_t
name|b
decl_stmt|;
name|xfs_dfilblks_t
name|c
decl_stmt|;
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
name|xfs_ino_t
name|ino
decl_stmt|;
name|xfs_dfiloff_t
name|o
decl_stmt|;
name|int
name|flag
decl_stmt|;
name|int
name|opcode
decl_stmt|;
specifier|static
name|char
modifier|*
name|ops
index|[]
init|=
block|{
literal|"del"
block|,
literal|"ins"
block|,
literal|"pre"
block|,
literal|"post"
block|}
decl_stmt|;
name|xfs_bmbt_rec_32_t
name|r
decl_stmt|;
name|int
name|whichfork
decl_stmt|;
name|opcode
operator|=
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|)
operator|&
literal|0xffff
expr_stmt|;
if|if
condition|(
name|opcode
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|whichfork
operator|=
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|)
operator|>>
literal|16
expr_stmt|;
name|ip
operator|=
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
expr_stmt|;
name|ino
operator|=
operator|(
operator|(
name|xfs_ino_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
operator|<<
literal|32
operator|)
operator||
operator|(
operator|(
name|xfs_ino_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"%s %s:%s ip %p ino %s %cf\n"
argument_list|,
name|ops
index|[
name|opcode
operator|-
literal|1
index|]
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|ip
argument_list|,
name|xfs_fmtino
argument_list|(
name|ino
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|,
literal|"da"
index|[
name|whichfork
index|]
argument_list|)
expr_stmt|;
name|r
operator|.
name|l0
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
expr_stmt|;
name|r
operator|.
name|l1
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
expr_stmt|;
name|r
operator|.
name|l2
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
expr_stmt|;
name|r
operator|.
name|l3
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
expr_stmt|;
name|xfs_convert_extent
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|o
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|flag
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|" idx %ld offset %lld block %s"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
name|o
argument_list|,
name|xfs_fmtfsblock
argument_list|(
operator|(
name|xfs_fsblock_t
operator|)
name|b
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|" count %lld flag %d\n"
argument_list|,
name|c
argument_list|,
name|flag
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
operator|!=
literal|2
condition|)
return|return
literal|1
return|;
name|r
operator|.
name|l0
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
expr_stmt|;
name|r
operator|.
name|l1
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
expr_stmt|;
name|r
operator|.
name|l2
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
expr_stmt|;
name|r
operator|.
name|l3
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
expr_stmt|;
name|xfs_convert_extent
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|o
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|flag
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|" offset %lld block %s"
argument_list|,
name|o
argument_list|,
name|xfs_fmtfsblock
argument_list|(
operator|(
name|xfs_fsblock_t
operator|)
name|b
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|" count %lld flag %d\n"
argument_list|,
name|c
argument_list|,
name|flag
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Print xfs bmap btree trace buffer entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_bmbt_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|int
name|line
decl_stmt|;
name|xfs_bmbt_rec_32_t
name|r
decl_stmt|;
name|xfs_bmbt_irec_t
name|s
decl_stmt|;
name|int
name|type
decl_stmt|;
name|int
name|whichfork
decl_stmt|;
name|type
operator|=
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&
literal|0xff
expr_stmt|;
if|if
condition|(
name|type
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|whichfork
operator|=
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|line
operator|=
operator|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|>>
literal|16
operator|)
operator|&
literal|0xffff
expr_stmt|;
name|qprintf
argument_list|(
literal|"%s[%s@%d] ip 0x%p %cf cur 0x%p\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|line
argument_list|,
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
literal|"da"
index|[
name|whichfork
index|]
argument_list|,
operator|(
name|xfs_btree_cur_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|XFS_BMBT_KTRACE_ARGBI
case|:
name|qprintf
argument_list|(
literal|" buf 0x%p i %ld\n"
argument_list|,
operator|(
name|xfs_buf_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_ARGBII
case|:
name|qprintf
argument_list|(
literal|" buf 0x%p i0 %ld i1 %ld\n"
argument_list|,
operator|(
name|xfs_buf_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_ARGFFFI
case|:
name|qprintf
argument_list|(
literal|" o 0x%x%08x b 0x%x%08x i 0x%x%08x j %ld\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_ARGI
case|:
name|qprintf
argument_list|(
literal|" i 0x%lx\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_ARGIFK
case|:
name|qprintf
argument_list|(
literal|" i 0x%lx f 0x%x%08x o 0x%x%08x\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_ARGIFR
case|:
name|qprintf
argument_list|(
literal|" i 0x%lx f 0x%x%08x "
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|s
operator|.
name|br_startoff
operator|=
call|(
name|xfs_fileoff_t
call|)
argument_list|(
operator|(
operator|(
name|xfs_dfiloff_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
operator|<<
literal|32
operator|)
operator||
operator|(
name|xfs_dfiloff_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
name|s
operator|.
name|br_startblock
operator|=
call|(
name|xfs_fsblock_t
call|)
argument_list|(
operator|(
operator|(
name|xfs_dfsbno_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
operator|<<
literal|32
operator|)
operator||
operator|(
name|xfs_dfsbno_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|s
operator|.
name|br_blockcount
operator|=
call|(
name|xfs_filblks_t
call|)
argument_list|(
operator|(
operator|(
name|xfs_dfilblks_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
operator|<<
literal|32
operator|)
operator||
operator|(
name|xfs_dfilblks_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|xfsidbg_xbirec
argument_list|(
operator|&
name|s
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_ARGIK
case|:
name|qprintf
argument_list|(
literal|" i 0x%lx o 0x%x%08x\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BMBT_KTRACE_CUR
case|:
name|qprintf
argument_list|(
literal|" nlevels %ld flags %ld allocated %ld "
argument_list|,
operator|(
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
operator|>>
literal|24
operator|)
operator|&
literal|0xff
argument_list|,
operator|(
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|r
operator|.
name|l0
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
expr_stmt|;
name|r
operator|.
name|l1
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
expr_stmt|;
name|r
operator|.
name|l2
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
expr_stmt|;
name|r
operator|.
name|l3
operator|=
operator|(
name|xfs_bmbt_rec_base_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
expr_stmt|;
name|xfsidbg_xbrec
argument_list|(
operator|(
name|xfs_bmbt_rec_64_t
operator|*
operator|)
operator|&
name|r
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|" bufs 0x%p 0x%p 0x%p 0x%p "
argument_list|,
operator|(
name|xfs_buf_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|xfs_buf_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|xfs_buf_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|,
operator|(
name|xfs_buf_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"ptrs %ld %ld %ld %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
operator|&
literal|0xffff
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
operator|>>
literal|16
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qprintf
argument_list|(
literal|"unknown bmbt trace record\n"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print an xfs in-inode bmap btree root.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_broot
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|,
name|xfs_ifork_t
modifier|*
name|f
parameter_list|)
block|{
name|xfs_bmbt_block_t
modifier|*
name|broot
decl_stmt|;
name|int
name|format
decl_stmt|;
name|int
name|i
decl_stmt|;
name|xfs_bmbt_key_t
modifier|*
name|kp
decl_stmt|;
name|xfs_bmbt_ptr_t
modifier|*
name|pp
decl_stmt|;
name|format
operator|=
name|f
operator|==
operator|&
name|ip
operator|->
name|i_df
condition|?
name|ip
operator|->
name|i_d
operator|.
name|di_format
else|:
name|ip
operator|->
name|i_d
operator|.
name|di_aformat
expr_stmt|;
if|if
condition|(
operator|(
name|f
operator|->
name|if_flags
operator|&
name|XFS_IFBROOT
operator|)
operator|==
literal|0
operator|||
name|format
operator|!=
name|XFS_DINODE_FMT_BTREE
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"inode 0x%p not btree format\n"
argument_list|,
name|ip
argument_list|)
expr_stmt|;
return|return;
block|}
name|broot
operator|=
name|f
operator|->
name|if_broot
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"block @0x%p magic %x level %d numrecs %d\n"
argument_list|,
name|broot
argument_list|,
name|be32_to_cpu
argument_list|(
name|broot
operator|->
name|bb_magic
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|broot
operator|->
name|bb_level
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|broot
operator|->
name|bb_numrecs
argument_list|)
argument_list|)
expr_stmt|;
name|kp
operator|=
name|XFS_BMAP_BROOT_KEY_ADDR
argument_list|(
name|broot
argument_list|,
literal|1
argument_list|,
name|f
operator|->
name|if_broot_bytes
argument_list|)
expr_stmt|;
name|pp
operator|=
name|XFS_BMAP_BROOT_PTR_ADDR
argument_list|(
name|broot
argument_list|,
literal|1
argument_list|,
name|f
operator|->
name|if_broot_bytes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|broot
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"\t%d: startoff %Ld ptr %Lx %s\n"
argument_list|,
name|i
argument_list|,
name|INT_GET
argument_list|(
name|kp
index|[
name|i
operator|-
literal|1
index|]
operator|.
name|br_startoff
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|pp
index|[
name|i
operator|-
literal|1
index|]
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|INT_GET
argument_list|(
name|pp
index|[
name|i
operator|-
literal|1
index|]
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print allocation btree block.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_btalloc
parameter_list|(
name|xfs_alloc_block_t
modifier|*
name|bt
parameter_list|,
name|int
name|bsz
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"magic 0x%x level %d numrecs %d leftsib 0x%x rightsib 0x%x\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_magic
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_level
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_leftsib
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_rightsib
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bt
operator|->
name|bb_level
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|xfs_alloc_rec_t
modifier|*
name|r
decl_stmt|;
name|r
operator|=
name|XFS_BTREE_REC_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_alloc
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rec %d startblock 0x%x blockcount %d\n"
argument_list|,
name|i
argument_list|,
name|be32_to_cpu
argument_list|(
name|r
operator|->
name|ar_startblock
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|r
operator|->
name|ar_blockcount
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|mxr
decl_stmt|;
name|mxr
operator|=
name|XFS_BTREE_BLOCK_MAXRECS
argument_list|(
name|bsz
argument_list|,
name|xfs_alloc
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|xfs_alloc_key_t
modifier|*
name|k
decl_stmt|;
name|xfs_alloc_ptr_t
modifier|*
name|p
decl_stmt|;
name|k
operator|=
name|XFS_BTREE_KEY_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_alloc
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
name|mxr
argument_list|)
expr_stmt|;
name|p
operator|=
name|XFS_BTREE_PTR_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_alloc
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
name|mxr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"key %d startblock 0x%x blockcount %d ptr 0x%x\n"
argument_list|,
name|i
argument_list|,
name|be32_to_cpu
argument_list|(
name|k
operator|->
name|ar_startblock
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|k
operator|->
name|ar_blockcount
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
operator|*
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print a bmap btree block.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_btbmap
parameter_list|(
name|xfs_bmbt_block_t
modifier|*
name|bt
parameter_list|,
name|int
name|bsz
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"magic 0x%x level %d numrecs %d leftsib %Lx rightsib %Lx\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_magic
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_level
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
argument_list|,
name|be64_to_cpu
argument_list|(
name|bt
operator|->
name|bb_leftsib
argument_list|)
argument_list|,
name|be64_to_cpu
argument_list|(
name|bt
operator|->
name|bb_rightsib
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bt
operator|->
name|bb_level
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|xfs_bmbt_rec_t
modifier|*
name|r
decl_stmt|;
name|xfs_bmbt_irec_t
name|irec
decl_stmt|;
name|r
operator|=
operator|(
name|xfs_bmbt_rec_t
operator|*
operator|)
name|XFS_BTREE_REC_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_bmbt
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|xfs_bmbt_disk_get_all
argument_list|(
operator|(
name|xfs_bmbt_rec_t
operator|*
operator|)
name|r
argument_list|,
operator|&
name|irec
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rec %d startoff %Ld startblock %Lx blockcount %Ld flag %d\n"
argument_list|,
name|i
argument_list|,
name|irec
operator|.
name|br_startoff
argument_list|,
operator|(
name|__uint64_t
operator|)
name|irec
operator|.
name|br_startblock
argument_list|,
name|irec
operator|.
name|br_blockcount
argument_list|,
name|irec
operator|.
name|br_state
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|mxr
decl_stmt|;
name|mxr
operator|=
name|XFS_BTREE_BLOCK_MAXRECS
argument_list|(
name|bsz
argument_list|,
name|xfs_bmbt
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|xfs_bmbt_key_t
modifier|*
name|k
decl_stmt|;
name|xfs_bmbt_ptr_t
modifier|*
name|p
decl_stmt|;
name|k
operator|=
name|XFS_BTREE_KEY_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_bmbt
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
name|mxr
argument_list|)
expr_stmt|;
name|p
operator|=
name|XFS_BTREE_PTR_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_bmbt
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
name|mxr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"key %d startoff %Ld "
argument_list|,
name|i
argument_list|,
name|INT_GET
argument_list|(
name|k
operator|->
name|br_startoff
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ptr %Lx\n"
argument_list|,
name|INT_GET
argument_list|(
operator|*
name|p
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print an inode btree block.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_btino
parameter_list|(
name|xfs_inobt_block_t
modifier|*
name|bt
parameter_list|,
name|int
name|bsz
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"magic 0x%x level %d numrecs %d leftsib 0x%x rightsib 0x%x\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_magic
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_level
argument_list|)
argument_list|,
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_leftsib
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|bt
operator|->
name|bb_rightsib
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bt
operator|->
name|bb_level
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|xfs_inobt_rec_t
modifier|*
name|r
decl_stmt|;
name|r
operator|=
name|XFS_BTREE_REC_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_inobt
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rec %d startino 0x%x freecount %d, free %Lx\n"
argument_list|,
name|i
argument_list|,
name|INT_GET
argument_list|(
name|r
operator|->
name|ir_startino
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|r
operator|->
name|ir_freecount
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|r
operator|->
name|ir_free
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|mxr
decl_stmt|;
name|mxr
operator|=
name|XFS_BTREE_BLOCK_MAXRECS
argument_list|(
name|bsz
argument_list|,
name|xfs_inobt
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|be16_to_cpu
argument_list|(
name|bt
operator|->
name|bb_numrecs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|xfs_inobt_key_t
modifier|*
name|k
decl_stmt|;
name|xfs_inobt_ptr_t
modifier|*
name|p
decl_stmt|;
name|k
operator|=
name|XFS_BTREE_KEY_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_inobt
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
name|mxr
argument_list|)
expr_stmt|;
name|p
operator|=
name|XFS_BTREE_PTR_ADDR
argument_list|(
name|bsz
argument_list|,
name|xfs_inobt
argument_list|,
name|bt
argument_list|,
name|i
argument_list|,
name|mxr
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"key %d startino 0x%x ptr 0x%x\n"
argument_list|,
name|i
argument_list|,
name|INT_GET
argument_list|(
name|k
operator|->
name|ir_startino
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
operator|*
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print a buf log item.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_buf_item_print
parameter_list|(
name|xfs_buf_log_item_t
modifier|*
name|blip
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|bli_flags
index|[]
init|=
block|{
literal|"hold"
block|,
comment|/* 0x1 */
literal|"dirty"
block|,
comment|/* 0x2 */
literal|"stale"
block|,
comment|/* 0x4 */
literal|"logged"
block|,
comment|/* 0x8 */
literal|"ialloc"
block|,
comment|/* 0x10 */
literal|"inode_stale"
block|,
comment|/* 0x20 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|blf_flags
index|[]
init|=
block|{
literal|"inode"
block|,
comment|/* 0x1 */
literal|"cancel"
block|,
comment|/* 0x2 */
name|NULL
block|}
decl_stmt|;
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p blkno 0x%Lx "
argument_list|,
name|blip
operator|->
name|bli_buf
argument_list|,
name|blip
operator|->
name|bli_format
operator|.
name|blf_blkno
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|blip
operator|->
name|bli_flags
argument_list|,
name|bli_flags
argument_list|,
literal|"flags:"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n   "
argument_list|)
expr_stmt|;
name|xfsidbg_xbuf_real
argument_list|(
name|blip
operator|->
name|bli_buf
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"buf 0x%p recur %d refcount %d flags:"
argument_list|,
name|blip
operator|->
name|bli_buf
argument_list|,
name|blip
operator|->
name|bli_recur
argument_list|,
name|atomic_read
argument_list|(
operator|&
name|blip
operator|->
name|bli_refcount
argument_list|)
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|blip
operator|->
name|bli_flags
argument_list|,
name|bli_flags
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"size %d blkno 0x%Lx len 0x%x map size %d map 0x%p\n"
argument_list|,
name|blip
operator|->
name|bli_format
operator|.
name|blf_size
argument_list|,
name|blip
operator|->
name|bli_format
operator|.
name|blf_blkno
argument_list|,
operator|(
name|uint
operator|)
name|blip
operator|->
name|bli_format
operator|.
name|blf_len
argument_list|,
name|blip
operator|->
name|bli_format
operator|.
name|blf_map_size
argument_list|,
operator|&
operator|(
name|blip
operator|->
name|bli_format
operator|.
name|blf_data_map
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"blf flags: "
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|uint
operator|)
name|blip
operator|->
name|bli_format
operator|.
name|blf_flags
argument_list|,
name|blf_flags
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_TRANS_DEBUG
name|kdb_printf
argument_list|(
literal|"orig 0x%x logged 0x%x"
argument_list|,
name|blip
operator|->
name|bli_orig
argument_list|,
name|blip
operator|->
name|bli_logged
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_comment
comment|/*  * Convert an external extent descriptor to internal form.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_convert_extent
parameter_list|(
name|xfs_bmbt_rec_32_t
modifier|*
name|rp
parameter_list|,
name|xfs_dfiloff_t
modifier|*
name|op
parameter_list|,
name|xfs_dfsbno_t
modifier|*
name|sp
parameter_list|,
name|xfs_dfilblks_t
modifier|*
name|cp
parameter_list|,
name|int
modifier|*
name|fp
parameter_list|)
block|{
name|xfs_dfiloff_t
name|o
decl_stmt|;
name|xfs_dfsbno_t
name|s
decl_stmt|;
name|xfs_dfilblks_t
name|c
decl_stmt|;
name|int
name|flag
decl_stmt|;
name|flag
operator|=
operator|(
operator|(
operator|(
name|xfs_dfiloff_t
operator|)
name|rp
operator|->
name|l0
operator|)
operator|>>
literal|31
operator|)
operator|&
literal|1
expr_stmt|;
name|o
operator|=
operator|(
operator|(
operator|(
operator|(
name|xfs_dfiloff_t
operator|)
name|rp
operator|->
name|l0
operator|)
operator|&
literal|0x7fffffff
operator|)
operator|<<
literal|23
operator|)
operator||
operator|(
operator|(
operator|(
name|xfs_dfiloff_t
operator|)
name|rp
operator|->
name|l1
operator|)
operator|>>
literal|9
operator|)
expr_stmt|;
name|s
operator|=
operator|(
operator|(
call|(
name|xfs_dfsbno_t
call|)
argument_list|(
name|rp
operator|->
name|l1
operator|&
literal|0x000001ff
argument_list|)
operator|)
operator|<<
literal|43
operator|)
operator||
operator|(
operator|(
operator|(
name|xfs_dfsbno_t
operator|)
name|rp
operator|->
name|l2
operator|)
operator|<<
literal|11
operator|)
operator||
operator|(
operator|(
operator|(
name|xfs_dfsbno_t
operator|)
name|rp
operator|->
name|l3
operator|)
operator|>>
literal|21
operator|)
expr_stmt|;
name|c
operator|=
call|(
name|xfs_dfilblks_t
call|)
argument_list|(
name|rp
operator|->
name|l3
operator|&
literal|0x001fffff
argument_list|)
expr_stmt|;
operator|*
name|op
operator|=
name|o
expr_stmt|;
operator|*
name|sp
operator|=
name|s
expr_stmt|;
operator|*
name|cp
operator|=
name|c
expr_stmt|;
operator|*
name|fp
operator|=
name|flag
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
end_ifdef

begin_comment
comment|/*  * Print itrunc entry trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_ctrunc_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|qprintf
argument_list|(
literal|"ip 0x%p cpu %ld\n"
argument_list|,
operator|(
name|xfs_inode_t
operator|*
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print an xfs_da_state_path structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_dastate_path
parameter_list|(
name|xfs_da_state_path_t
modifier|*
name|p
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"active %d\n"
argument_list|,
name|p
operator|->
name|active
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XFS_DA_NODE_MAXDEPTH
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|" blk %d bp 0x%p blkno 0x%x"
argument_list|,
name|i
argument_list|,
name|p
operator|->
name|blk
index|[
name|i
index|]
operator|.
name|bp
argument_list|,
name|p
operator|->
name|blk
index|[
name|i
index|]
operator|.
name|blkno
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" index %d hashval 0x%x "
argument_list|,
name|p
operator|->
name|blk
index|[
name|i
index|]
operator|.
name|index
argument_list|,
operator|(
name|uint_t
operator|)
name|p
operator|->
name|blk
index|[
name|i
index|]
operator|.
name|hashval
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|p
operator|->
name|blk
index|[
name|i
index|]
operator|.
name|magic
condition|)
block|{
case|case
name|XFS_DA_NODE_MAGIC
case|:
name|kdb_printf
argument_list|(
literal|"NODE\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR_LEAF_MAGIC
case|:
name|kdb_printf
argument_list|(
literal|"DIR\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ATTR_LEAF_MAGIC
case|:
name|kdb_printf
argument_list|(
literal|"ATTR\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_LEAFN_MAGIC
case|:
name|kdb_printf
argument_list|(
literal|"DIR2\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"type ?\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR_TRACE
end_ifdef

begin_comment
comment|/*  * Print a xfs directory trace buffer entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_dir_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|xfs_mount_t
modifier|*
name|mp
decl_stmt|;
name|__uint32_t
name|hash
decl_stmt|;
name|xfs_off_t
name|cookie
decl_stmt|;
if|if
condition|(
operator|!
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|||
operator|!
name|ktep
operator|->
name|val
index|[
literal|1
index|]
condition|)
return|return
literal|0
return|;
name|mp
operator|=
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
expr_stmt|;
name|cookie
operator|=
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
expr_stmt|;
name|cookie
operator|<<=
literal|32
expr_stmt|;
name|cookie
operator||=
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
expr_stmt|;
name|qprintf
argument_list|(
literal|"%s -- dp=0x%p b/e/h=%ld/%ld/0x%08lx resid=0x%lx "
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|long
operator|)
name|XFS_DA_COOKIE_BNO
argument_list|(
name|mp
argument_list|,
name|cookie
argument_list|)
argument_list|,
operator|(
name|long
operator|)
name|XFS_DA_COOKIE_ENTRY
argument_list|(
name|mp
argument_list|,
name|cookie
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|XFS_DA_COOKIE_HASH
argument_list|(
name|mp
argument_list|,
name|cookie
argument_list|)
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|XFS_DIR_KTRACE_G_DU
case|:
break|break;
case|case
name|XFS_DIR_KTRACE_G_DUB
case|:
name|qprintf
argument_list|(
literal|"bno=%ld"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR_KTRACE_G_DUN
case|:
name|qprintf
argument_list|(
literal|"forw=%ld, cnt=%ld, 0x%08lx - 0x%08lx"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR_KTRACE_G_DUL
case|:
name|qprintf
argument_list|(
literal|"forw=%ld, cnt=%ld, 0x%08lx - 0x%08lx"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR_KTRACE_G_DUE
case|:
name|qprintf
argument_list|(
literal|"entry hashval 0x%08lx"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR_KTRACE_G_DUC
case|:
name|cookie
operator|=
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
expr_stmt|;
name|cookie
operator|<<=
literal|32
expr_stmt|;
name|cookie
operator||=
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
expr_stmt|;
name|hash
operator|=
name|XFS_DA_COOKIE_HASH
argument_list|(
name|mp
argument_list|,
name|cookie
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"b/e/h=%ld/%ld/0x%08x"
argument_list|,
operator|(
name|long
operator|)
name|XFS_DA_COOKIE_BNO
argument_list|(
name|mp
argument_list|,
name|cookie
argument_list|)
argument_list|,
operator|(
name|long
operator|)
name|XFS_DA_COOKIE_ENTRY
argument_list|(
name|mp
argument_list|,
name|cookie
argument_list|)
argument_list|,
name|hash
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qprintf
argument_list|(
literal|"unknown dir trace record format"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
end_ifdef

begin_comment
comment|/*  * Print a xfs v2 directory trace buffer entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_dir2_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|char
modifier|*
name|cp
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|len
decl_stmt|;
if|if
condition|(
operator|!
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
return|return
literal|0
return|;
name|cp
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|ktep
operator|->
name|val
index|[
literal|10
index|]
expr_stmt|;
name|qprintf
argument_list|(
literal|"%s: '"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|len
operator|=
name|min
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|__psint_t
operator|)
sizeof|sizeof
argument_list|(
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
operator|*
literal|6
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|qprintf
argument_list|(
literal|"%c"
argument_list|,
name|cp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"'(%ld)"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|!=
name|XFS_DIR2_KTRACE_ARGS_BIBII
condition|)
name|qprintf
argument_list|(
literal|" hashval 0x%llx inumber %lld dp 0x%p tp 0x%p check %d"
argument_list|,
operator|(
name|__uint64_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|__int64_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|int
operator|)
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|__psunsigned_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|XFS_DIR2_KTRACE_ARGS
case|:
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_B
case|:
name|qprintf
argument_list|(
literal|" bp 0x%p"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_BB
case|:
name|qprintf
argument_list|(
literal|" lbp 0x%p dbp 0x%p"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_BIBII
case|:
name|qprintf
argument_list|(
literal|" dp 0x%p tp 0x%p srcbp 0x%p srci %d dstbp 0x%p dsti %d count %d"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|int
operator|)
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|int
operator|)
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|int
operator|)
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_DB
case|:
name|qprintf
argument_list|(
literal|" db 0x%x bp 0x%p"
argument_list|,
operator|(
name|xfs_dir2_db_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_I
case|:
name|qprintf
argument_list|(
literal|" i 0x%lx"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_S
case|:
name|qprintf
argument_list|(
literal|" s 0x%x"
argument_list|,
operator|(
name|int
operator|)
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIR2_KTRACE_ARGS_SB
case|:
name|qprintf
argument_list|(
literal|" s 0x%x bp 0x%p"
argument_list|,
operator|(
name|int
operator|)
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qprintf
argument_list|(
literal|"unknown dirv2 trace record format"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print an efd log item.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_efd_item_print
parameter_list|(
name|xfs_efd_log_item_t
modifier|*
name|efdp
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|xfs_extent_t
modifier|*
name|ep
decl_stmt|;
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Extent Free Done: ID 0x%Lx nextents %d (at 0x%p)\n"
argument_list|,
name|efdp
operator|->
name|efd_format
operator|.
name|efd_efi_id
argument_list|,
name|efdp
operator|->
name|efd_format
operator|.
name|efd_nextents
argument_list|,
name|efdp
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"size %d nextents %d next extent %d efip 0x%p\n"
argument_list|,
name|efdp
operator|->
name|efd_format
operator|.
name|efd_size
argument_list|,
name|efdp
operator|->
name|efd_format
operator|.
name|efd_nextents
argument_list|,
name|efdp
operator|->
name|efd_next_extent
argument_list|,
name|efdp
operator|->
name|efd_efip
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"efi_id 0x%Lx\n"
argument_list|,
name|efdp
operator|->
name|efd_format
operator|.
name|efd_efi_id
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"efd extents:\n"
argument_list|)
expr_stmt|;
name|ep
operator|=
operator|&
operator|(
name|efdp
operator|->
name|efd_format
operator|.
name|efd_extents
index|[
literal|0
index|]
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|efdp
operator|->
name|efd_next_extent
condition|;
name|i
operator|++
operator|,
name|ep
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"    block %Lx len %d\n"
argument_list|,
name|ep
operator|->
name|ext_start
argument_list|,
name|ep
operator|->
name|ext_len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print an efi log item.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_efi_item_print
parameter_list|(
name|xfs_efi_log_item_t
modifier|*
name|efip
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|xfs_extent_t
modifier|*
name|ep
decl_stmt|;
specifier|static
name|char
modifier|*
name|efi_flags
index|[]
init|=
block|{
literal|"recovered"
block|,
comment|/* 0x1 */
literal|"committed"
block|,
comment|/* 0x2 */
literal|"cancelled"
block|,
comment|/* 0x4 */
name|NULL
block|, 		}
decl_stmt|;
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Extent Free Intention: ID 0x%Lx nextents %d (at 0x%p)\n"
argument_list|,
name|efip
operator|->
name|efi_format
operator|.
name|efi_id
argument_list|,
name|efip
operator|->
name|efi_format
operator|.
name|efi_nextents
argument_list|,
name|efip
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"size %d nextents %d next extent %d\n"
argument_list|,
name|efip
operator|->
name|efi_format
operator|.
name|efi_size
argument_list|,
name|efip
operator|->
name|efi_format
operator|.
name|efi_nextents
argument_list|,
name|efip
operator|->
name|efi_next_extent
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"id %Lx"
argument_list|,
name|efip
operator|->
name|efi_format
operator|.
name|efi_id
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|efip
operator|->
name|efi_flags
argument_list|,
name|efi_flags
argument_list|,
literal|"flags :"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"efi extents:\n"
argument_list|)
expr_stmt|;
name|ep
operator|=
operator|&
operator|(
name|efip
operator|->
name|efi_format
operator|.
name|efi_extents
index|[
literal|0
index|]
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|efip
operator|->
name|efi_next_extent
condition|;
name|i
operator|++
operator|,
name|ep
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"    block %Lx len %d\n"
argument_list|,
name|ep
operator|->
name|ext_start
argument_list|,
name|ep
operator|->
name|ext_len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Format inode "format" into a static buffer& return it.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xfs_fmtformat
parameter_list|(
name|xfs_dinode_fmt_t
name|f
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|t
index|[]
init|=
block|{
literal|"dev"
block|,
literal|"local"
block|,
literal|"extents"
block|,
literal|"btree"
block|,
literal|"uuid"
block|}
decl_stmt|;
return|return
name|t
index|[
name|f
index|]
return|;
block|}
end_function

begin_comment
comment|/*  * Format fsblock number into a static buffer& return it.  */
end_comment

begin_function
name|char
modifier|*
name|xfs_fmtfsblock
parameter_list|(
name|xfs_fsblock_t
name|bno
parameter_list|,
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
specifier|static
name|char
name|rval
index|[
literal|50
index|]
decl_stmt|;
if|if
condition|(
name|bno
operator|==
name|NULLFSBLOCK
condition|)
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"NULLFSBLOCK"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ISNULLSTARTBLOCK
argument_list|(
name|bno
argument_list|)
condition|)
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"NULLSTARTBLOCK(%Ld)"
argument_list|,
name|STARTBLOCKVAL
argument_list|(
name|bno
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|mp
condition|)
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"%Ld[%x:%x]"
argument_list|,
operator|(
name|xfs_dfsbno_t
operator|)
name|bno
argument_list|,
name|XFS_FSB_TO_AGNO
argument_list|(
name|mp
argument_list|,
name|bno
argument_list|)
argument_list|,
name|XFS_FSB_TO_AGBNO
argument_list|(
name|mp
argument_list|,
name|bno
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"%Ld"
argument_list|,
operator|(
name|xfs_dfsbno_t
operator|)
name|bno
argument_list|)
expr_stmt|;
return|return
name|rval
return|;
block|}
end_function

begin_comment
comment|/*  * Format inode number into a static buffer& return it.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xfs_fmtino
parameter_list|(
name|xfs_ino_t
name|ino
parameter_list|,
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
specifier|static
name|char
name|rval
index|[
literal|50
index|]
decl_stmt|;
if|if
condition|(
name|mp
condition|)
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"%llu[%x:%x:%x]"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|,
name|XFS_INO_TO_AGNO
argument_list|(
name|mp
argument_list|,
name|ino
argument_list|)
argument_list|,
name|XFS_INO_TO_AGBNO
argument_list|(
name|mp
argument_list|,
name|ino
argument_list|)
argument_list|,
name|XFS_INO_TO_OFFSET
argument_list|(
name|mp
argument_list|,
name|ino
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"%llu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|)
expr_stmt|;
return|return
name|rval
return|;
block|}
end_function

begin_comment
comment|/*  * Format an lsn for printing into a static buffer& return it.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xfs_fmtlsn
parameter_list|(
name|xfs_lsn_t
modifier|*
name|lsnp
parameter_list|)
block|{
name|uint
modifier|*
name|wordp
decl_stmt|;
name|uint
modifier|*
name|word2p
decl_stmt|;
specifier|static
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
name|wordp
operator|=
operator|(
name|uint
operator|*
operator|)
name|lsnp
expr_stmt|;
name|word2p
operator|=
name|wordp
operator|++
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"[%u:%u]"
argument_list|,
operator|*
name|wordp
argument_list|,
operator|*
name|word2p
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
end_function

begin_comment
comment|/*  * Format file mode into a static buffer& return it.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xfs_fmtmode
parameter_list|(
name|int
name|m
parameter_list|)
block|{
specifier|static
name|char
name|rval
index|[
literal|16
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"%c%c%c%c%c%c%c%c%c%c%c%c%c"
argument_list|,
literal|"?fc?dxb?r?l?S?m?"
index|[
operator|(
name|m
operator|&
name|S_IFMT
operator|)
operator|>>
literal|12
index|]
argument_list|,
name|m
operator|&
name|S_ISUID
condition|?
literal|'u'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_ISGID
condition|?
literal|'g'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_ISVTX
condition|?
literal|'v'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IRUSR
condition|?
literal|'r'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IWUSR
condition|?
literal|'w'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IXUSR
condition|?
literal|'x'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IRGRP
condition|?
literal|'r'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IWGRP
condition|?
literal|'w'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IXGRP
condition|?
literal|'x'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IROTH
condition|?
literal|'r'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IWOTH
condition|?
literal|'w'
else|:
literal|'-'
argument_list|,
name|m
operator|&
name|S_IXOTH
condition|?
literal|'x'
else|:
literal|'-'
argument_list|)
expr_stmt|;
return|return
name|rval
return|;
block|}
end_function

begin_comment
comment|/*  * Format a size into a static buffer& return it.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xfs_fmtsize
parameter_list|(
name|size_t
name|i
parameter_list|)
block|{
specifier|static
name|char
name|rval
index|[
literal|20
index|]
decl_stmt|;
comment|/* size_t is 32 bits in 32-bit kernel, 64 bits in 64-bit kernel */
name|sprintf
argument_list|(
name|rval
argument_list|,
literal|"0x%lx"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|i
argument_list|)
expr_stmt|;
return|return
name|rval
return|;
block|}
end_function

begin_comment
comment|/*  * Format a uuid into a static buffer& return it.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xfs_fmtuuid
parameter_list|(
name|uuid_t
modifier|*
name|uu
parameter_list|)
block|{
specifier|static
name|char
name|rval
index|[
literal|40
index|]
decl_stmt|;
name|char
modifier|*
name|o
init|=
name|rval
decl_stmt|;
name|char
modifier|*
name|i
init|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|uu
decl_stmt|;
name|int
name|b
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|16
condition|;
name|b
operator|++
control|)
block|{
name|o
operator|+=
name|sprintf
argument_list|(
name|o
argument_list|,
literal|"%02x"
argument_list|,
operator|*
name|i
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
operator|==
literal|3
operator|||
name|b
operator|==
literal|5
operator|||
name|b
operator|==
literal|7
operator|||
name|b
operator|==
literal|9
condition|)
operator|*
name|o
operator|++
operator|=
literal|'-'
expr_stmt|;
block|}
operator|*
name|o
operator|=
literal|'\0'
expr_stmt|;
return|return
name|rval
return|;
block|}
end_function

begin_comment
comment|/*  * Print an inode log item.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_inode_item_print
parameter_list|(
name|xfs_inode_log_item_t
modifier|*
name|ilip
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|ili_flags
index|[]
init|=
block|{
literal|"hold"
block|,
comment|/* 0x1 */
literal|"iolock excl"
block|,
comment|/* 0x2 */
literal|"iolock shrd"
block|,
comment|/* 0x4 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|ilf_fields
index|[]
init|=
block|{
literal|"core"
block|,
comment|/* 0x001 */
literal|"ddata"
block|,
comment|/* 0x002 */
literal|"dexts"
block|,
comment|/* 0x004 */
literal|"dbroot"
block|,
comment|/* 0x008 */
literal|"dev"
block|,
comment|/* 0x010 */
literal|"uuid"
block|,
comment|/* 0x020 */
literal|"adata"
block|,
comment|/* 0x040 */
literal|"aext"
block|,
comment|/* 0x080 */
literal|"abroot"
block|,
comment|/* 0x100 */
name|NULL
block|}
decl_stmt|;
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"inode 0x%p logged %d "
argument_list|,
name|ilip
operator|->
name|ili_inode
argument_list|,
name|ilip
operator|->
name|ili_logged
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|ilip
operator|->
name|ili_flags
argument_list|,
name|ili_flags
argument_list|,
literal|"flags:"
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_fields
argument_list|,
name|ilf_fields
argument_list|,
literal|"format:"
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|ilip
operator|->
name|ili_last_fields
argument_list|,
name|ilf_fields
argument_list|,
literal|"lastfield:"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"inode 0x%p ino 0x%llu pushbuf %d logged %d flags: "
argument_list|,
name|ilip
operator|->
name|ili_inode
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_ino
argument_list|,
name|ilip
operator|->
name|ili_pushbuf_flag
argument_list|,
name|ilip
operator|->
name|ili_logged
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|ilip
operator|->
name|ili_flags
argument_list|,
name|ili_flags
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ilock recur %d iolock recur %d ext buf 0x%p\n"
argument_list|,
name|ilip
operator|->
name|ili_ilock_recur
argument_list|,
name|ilip
operator|->
name|ili_iolock_recur
argument_list|,
name|ilip
operator|->
name|ili_extents_buf
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_TRANS_DEBUG
name|kdb_printf
argument_list|(
literal|"root bytes %d root orig 0x%x\n"
argument_list|,
name|ilip
operator|->
name|ili_root_size
argument_list|,
name|ilip
operator|->
name|ili_orig_root
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|kdb_printf
argument_list|(
literal|"size %d "
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_size
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_fields
argument_list|,
name|ilf_fields
argument_list|,
literal|"fields:"
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|ilip
operator|->
name|ili_last_fields
argument_list|,
name|ilf_fields
argument_list|,
literal|" last fields: "
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" flush lsn %s last lsn %s\n"
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
operator|(
name|ilip
operator|->
name|ili_flush_lsn
operator|)
argument_list|)
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
operator|(
name|ilip
operator|->
name|ili_last_lsn
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dsize %d, asize %d, rdev 0x%x\n"
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_dsize
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_asize
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_u
operator|.
name|ilfu_rdev
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"blkno 0x%Lx len 0x%x boffset 0x%x\n"
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_blkno
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_len
argument_list|,
name|ilip
operator|->
name|ili_format
operator|.
name|ilf_boffset
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a dquot log item.  */
end_comment

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|xfs_dquot_item_print
parameter_list|(
name|xfs_dq_logitem_t
modifier|*
name|lip
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"dquot 0x%p\n"
argument_list|,
name|lip
operator|->
name|qli_dquot
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a quotaoff log item.  */
end_comment

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|xfs_qoff_item_print
parameter_list|(
name|xfs_qoff_logitem_t
modifier|*
name|lip
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"start qoff item 0x%p flags 0x%x\n"
argument_list|,
name|lip
operator|->
name|qql_start_lip
argument_list|,
name|lip
operator|->
name|qql_format
operator|.
name|qf_flags
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print buffer full of inodes.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_inodebuf
parameter_list|(
name|xfs_buf_t
modifier|*
name|bp
parameter_list|)
block|{
name|xfs_dinode_t
modifier|*
name|di
decl_stmt|;
name|xfs_dinode_core_t
name|dic
decl_stmt|;
name|int
name|n
decl_stmt|,
name|i
decl_stmt|;
name|n
operator|=
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
operator|>>
literal|8
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
block|{
name|di
operator|=
operator|(
name|xfs_dinode_t
operator|*
operator|)
name|xfs_buf_offset
argument_list|(
name|bp
argument_list|,
name|i
operator|*
literal|256
argument_list|)
expr_stmt|;
name|xfs_xlate_dinode_core
argument_list|(
operator|(
name|xfs_caddr_t
operator|)
operator|&
name|di
operator|->
name|di_core
argument_list|,
operator|&
name|dic
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|xfs_prdinode_core
argument_list|(
operator|&
name|dic
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"next_unlinked 0x%x u@0x%p\n"
argument_list|,
name|INT_GET
argument_list|(
name|di
operator|->
name|di_next_unlinked
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
operator|&
name|di
operator|->
name|di_u
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
end_ifdef

begin_comment
comment|/*  * Print iomap entry trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_iomap_enter_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|qprintf
argument_list|(
literal|"ip 0x%p size 0x%x%x offset 0x%x%x count 0x%x\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"io new size 0x%x%x pid=%d\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print iomap map trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_iomap_map_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|bmapi_flags
index|[]
init|=
block|{
literal|"read"
block|,
comment|/* BMAPI_READ */
literal|"write"
block|,
comment|/* BMAPI_WRITE */
literal|"allocate"
block|,
comment|/* BMAPI_ALLOCATE */
literal|"unwritten"
block|,
comment|/* BMAPI_UNWRITTEN */
literal|"ignstate"
block|,
comment|/* BMAPI_IGNSTATE */
literal|"direct"
block|,
comment|/* BMAPI_DIRECT */
literal|"mmap"
block|,
comment|/* BMAPI_MMAP */
literal|"sync"
block|,
comment|/* BMAPI_SYNC */
literal|"trylock"
block|,
comment|/* BMAPI_TRYLOCK */
literal|"device"
block|,
comment|/* BMAPI_DEVICE */
name|NULL
block|}
decl_stmt|;
name|qprintf
argument_list|(
literal|"ip 0x%p size 0x%x%x offset 0x%x%x count 0x%x\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
name|bmapi_flags
argument_list|,
literal|"bmapi flags"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"iomap off 0x%x%x delta 0x%x bsize 0x%x bno 0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"imap off 0x%x count 0x%x block 0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print itrunc entry trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_itrunc_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|qprintf
argument_list|(
literal|"ip 0x%p size 0x%x%x flag %ld new size 0x%x%x\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"toss start 0x%x%x toss finish 0x%x%x cpu id %ld pid %d\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print bunmap entry trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_bunmap_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|bunmapi_flags
index|[]
init|=
block|{
literal|"write"
block|,
comment|/* 0x01 */
literal|"delay"
block|,
comment|/* 0x02 */
literal|"entire"
block|,
comment|/* 0x04 */
literal|"metadata"
block|,
comment|/* 0x08 */
literal|"exact"
block|,
comment|/* 0x10 */
literal|"attrfork"
block|,
comment|/* 0x20 */
literal|"async"
block|,
comment|/* 0x40 */
literal|"rsvblocks"
block|,
comment|/* 0x80 */
name|NULL
block|}
decl_stmt|;
name|qprintf
argument_list|(
literal|"ip 0x%p size 0x%x%x bno 0x%x%x len 0x%x cpu id %ld\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"ra 0x%p pid %d "
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
name|bunmapi_flags
argument_list|,
literal|"flags"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print inval_cached_pages entry trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_inval_cached_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|qprintf
argument_list|(
literal|"ip 0x%p offset 0x%x%x len 0x%x%x first 0x%x%x last 0x%x%x pid %d\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print disk inode core.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_prdinode_core
parameter_list|(
name|xfs_dinode_core_t
modifier|*
name|dip
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|diflags
index|[]
init|=
block|{
literal|"realtime"
block|,
comment|/* XFS_DIFLAG_REALTIME */
literal|"prealloc"
block|,
comment|/* XFS_DIFLAG_PREALLOC */
literal|"newrtbm"
block|,
comment|/* XFS_DIFLAG_NEWRTBM */
literal|"immutable"
block|,
comment|/* XFS_DIFLAG_IMMUTABLE */
literal|"append"
block|,
comment|/* XFS_DIFLAG_APPEND */
literal|"sync"
block|,
comment|/* XFS_DIFLAG_SYNC */
literal|"noatime"
block|,
comment|/* XFS_DIFLAG_NOATIME */
literal|"nodump"
block|,
comment|/* XFS_DIFLAG_NODUMP */
literal|"rtinherit"
block|,
comment|/* XFS_DIFLAG_RTINHERIT */
literal|"projinherit"
block|,
comment|/* XFS_DIFLAG_PROJINHERIT */
literal|"nosymlinks"
block|,
comment|/* XFS_DIFLAG_NOSYMLINKS */
literal|"extsize"
block|,
comment|/* XFS_DIFLAG_EXTSIZE */
literal|"extszinherit"
block|,
comment|/* XFS_DIFLAG_EXTSZINHERIT */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"magic 0x%x mode 0%o (%s) version 0x%x format 0x%x (%s)\n"
argument_list|,
name|dip
operator|->
name|di_magic
argument_list|,
name|dip
operator|->
name|di_mode
argument_list|,
name|xfs_fmtmode
argument_list|(
name|dip
operator|->
name|di_mode
argument_list|)
argument_list|,
name|dip
operator|->
name|di_version
argument_list|,
name|dip
operator|->
name|di_format
argument_list|,
name|xfs_fmtformat
argument_list|(
operator|(
name|xfs_dinode_fmt_t
operator|)
name|dip
operator|->
name|di_format
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"nlink %d uid %d gid %d projid %d flushiter %u\n"
argument_list|,
name|dip
operator|->
name|di_nlink
argument_list|,
name|dip
operator|->
name|di_uid
argument_list|,
name|dip
operator|->
name|di_gid
argument_list|,
operator|(
name|uint
operator|)
name|dip
operator|->
name|di_projid
argument_list|,
operator|(
name|uint
operator|)
name|dip
operator|->
name|di_flushiter
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"atime %u:%u mtime %ud:%u ctime %u:%u\n"
argument_list|,
name|dip
operator|->
name|di_atime
operator|.
name|t_sec
argument_list|,
name|dip
operator|->
name|di_atime
operator|.
name|t_nsec
argument_list|,
name|dip
operator|->
name|di_mtime
operator|.
name|t_sec
argument_list|,
name|dip
operator|->
name|di_mtime
operator|.
name|t_nsec
argument_list|,
name|dip
operator|->
name|di_ctime
operator|.
name|t_sec
argument_list|,
name|dip
operator|->
name|di_ctime
operator|.
name|t_nsec
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"size %Ld "
argument_list|,
name|dip
operator|->
name|di_size
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"nblocks %Ld extsize 0x%x nextents 0x%x anextents 0x%x\n"
argument_list|,
name|dip
operator|->
name|di_nblocks
argument_list|,
name|dip
operator|->
name|di_extsize
argument_list|,
name|dip
operator|->
name|di_nextents
argument_list|,
name|dip
operator|->
name|di_anextents
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"forkoff %d aformat 0x%x (%s) dmevmask 0x%x dmstate 0x%x "
argument_list|,
name|dip
operator|->
name|di_forkoff
argument_list|,
name|dip
operator|->
name|di_aformat
argument_list|,
name|xfs_fmtformat
argument_list|(
operator|(
name|xfs_dinode_fmt_t
operator|)
name|dip
operator|->
name|di_aformat
argument_list|)
argument_list|,
name|dip
operator|->
name|di_dmevmask
argument_list|,
name|dip
operator|->
name|di_dmstate
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|dip
operator|->
name|di_flags
argument_list|,
name|diflags
argument_list|,
literal|"flags"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"gen 0x%x\n"
argument_list|,
name|dip
operator|->
name|di_gen
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
end_ifdef

begin_comment
comment|/*  * Print read/write entry trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_rw_enter_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|qprintf
argument_list|(
literal|"ip 0x%p size 0x%x%x ptr 0x%p size %lu\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"io offset 0x%x%x ioflags 0x%x new size 0x%x%x pid %d\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print page write/release trace.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_page_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
name|qprintf
argument_list|(
literal|"ip 0x%p inode 0x%p page 0x%p\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"mask 0x%x di_size 0x%x%x isize 0x%x%x offset 0x%x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"delalloc %d unmapped %d unwritten %d pid %d\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print read/write trace entry.  */
end_comment

begin_function
specifier|static
name|int
name|xfs_rw_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
switch|switch
condition|(
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|XFS_READ_ENTER
case|:
name|qprintf
argument_list|(
literal|"READ ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_rw_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_WRITE_ENTER
case|:
name|qprintf
argument_list|(
literal|"WRITE ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_rw_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_SENDFILE_ENTER
case|:
name|qprintf
argument_list|(
literal|"SENDFILE ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_rw_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_READ_ENTER
case|:
name|qprintf
argument_list|(
literal|"IOMAP READ ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_WRITE_ENTER
case|:
name|qprintf
argument_list|(
literal|"IOMAP WRITE ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_WRITE_NOSPACE
case|:
name|qprintf
argument_list|(
literal|"IOMAP WRITE NOSPACE:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_READ_MAP
case|:
name|qprintf
argument_list|(
literal|"IOMAP READ MAP:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_map_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_WRITE_MAP
case|:
name|qprintf
argument_list|(
literal|"IOMAP WRITE MAP:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_map_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ITRUNC_START
case|:
name|qprintf
argument_list|(
literal|"ITRUNC START:\n"
argument_list|)
expr_stmt|;
name|xfs_itrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ITRUNC_FINISH1
case|:
name|qprintf
argument_list|(
literal|"ITRUNC FINISH1:\n"
argument_list|)
expr_stmt|;
name|xfs_itrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_ITRUNC_FINISH2
case|:
name|qprintf
argument_list|(
literal|"ITRUNC FINISH2:\n"
argument_list|)
expr_stmt|;
name|xfs_itrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_CTRUNC1
case|:
name|qprintf
argument_list|(
literal|"CTRUNC1:\n"
argument_list|)
expr_stmt|;
name|xfs_ctrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_CTRUNC2
case|:
name|qprintf
argument_list|(
literal|"CTRUNC2:\n"
argument_list|)
expr_stmt|;
name|xfs_ctrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_CTRUNC3
case|:
name|qprintf
argument_list|(
literal|"CTRUNC3:\n"
argument_list|)
expr_stmt|;
name|xfs_ctrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_CTRUNC4
case|:
name|qprintf
argument_list|(
literal|"CTRUNC4:\n"
argument_list|)
expr_stmt|;
name|xfs_ctrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_CTRUNC5
case|:
name|qprintf
argument_list|(
literal|"CTRUNC5:\n"
argument_list|)
expr_stmt|;
name|xfs_ctrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_CTRUNC6
case|:
name|qprintf
argument_list|(
literal|"CTRUNC6:\n"
argument_list|)
expr_stmt|;
name|xfs_ctrunc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_BUNMAP
case|:
name|qprintf
argument_list|(
literal|"BUNMAP:\n"
argument_list|)
expr_stmt|;
name|xfs_bunmap_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_INVAL_CACHED
case|:
name|qprintf
argument_list|(
literal|"INVAL CACHED:\n"
argument_list|)
expr_stmt|;
name|xfs_inval_cached_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIORD_ENTER
case|:
name|qprintf
argument_list|(
literal|"DIORD ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_rw_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_DIOWR_ENTER
case|:
name|qprintf
argument_list|(
literal|"DIOWR ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_rw_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_WRITEPAGE_ENTER
case|:
name|qprintf
argument_list|(
literal|"PAGE WRITE:\n"
argument_list|)
expr_stmt|;
name|xfs_page_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_RELEASEPAGE_ENTER
case|:
name|qprintf
argument_list|(
literal|"PAGE RELEASE:\n"
argument_list|)
expr_stmt|;
name|xfs_page_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_INVALIDPAGE_ENTER
case|:
name|qprintf
argument_list|(
literal|"PAGE INVALIDATE:\n"
argument_list|)
expr_stmt|;
name|xfs_page_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_ALLOC_ENTER
case|:
name|qprintf
argument_list|(
literal|"ALLOC ENTER:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_ALLOC_MAP
case|:
name|qprintf
argument_list|(
literal|"ALLOC MAP:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_map_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_IOMAP_UNWRITTEN
case|:
name|qprintf
argument_list|(
literal|"UNWRITTEN:\n"
argument_list|)
expr_stmt|;
name|xfs_iomap_enter_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qprintf
argument_list|(
literal|"UNKNOWN RW TRACE\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print xfs extent records for a fork.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_xexlist_fork
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|,
name|int
name|whichfork
parameter_list|)
block|{
name|int
name|nextents
decl_stmt|,
name|i
decl_stmt|;
name|xfs_ifork_t
modifier|*
name|ifp
decl_stmt|;
name|xfs_bmbt_irec_t
name|irec
decl_stmt|;
name|ifp
operator|=
name|XFS_IFORK_PTR
argument_list|(
name|ip
argument_list|,
name|whichfork
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifp
operator|->
name|if_flags
operator|&
name|XFS_IFEXTENTS
condition|)
block|{
name|nextents
operator|=
name|ifp
operator|->
name|if_bytes
operator|/
operator|(
name|uint
operator|)
sizeof|sizeof
argument_list|(
name|xfs_bmbt_rec_t
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"inode 0x%p %cf extents 0x%p nextents 0x%x\n"
argument_list|,
name|ip
argument_list|,
literal|"da"
index|[
name|whichfork
index|]
argument_list|,
name|xfs_iext_get_ext
argument_list|(
name|ifp
argument_list|,
literal|0
argument_list|)
argument_list|,
name|nextents
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nextents
condition|;
name|i
operator|++
control|)
block|{
name|xfs_bmbt_get_all
argument_list|(
name|xfs_iext_get_ext
argument_list|(
name|ifp
argument_list|,
name|i
argument_list|)
argument_list|,
operator|&
name|irec
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"%d: startoff %Ld startblock %s blockcount %Ld flag %d\n"
argument_list|,
name|i
argument_list|,
name|irec
operator|.
name|br_startoff
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|irec
operator|.
name|br_startblock
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|,
name|irec
operator|.
name|br_blockcount
argument_list|,
name|irec
operator|.
name|br_state
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|xfs_xnode_fork
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|xfs_ifork_t
modifier|*
name|f
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|tab_flags
index|[]
init|=
block|{
literal|"inline"
block|,
comment|/* XFS_IFINLINE */
literal|"extents"
block|,
comment|/* XFS_IFEXTENTS */
literal|"broot"
block|,
comment|/* XFS_IFBROOT */
name|NULL
block|}
decl_stmt|;
name|int
modifier|*
name|p
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"%s fork"
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|" empty\n"
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" bytes %s "
argument_list|,
name|xfs_fmtsize
argument_list|(
name|f
operator|->
name|if_bytes
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"real_bytes %s lastex 0x%x u1:%s 0x%p\n"
argument_list|,
name|xfs_fmtsize
argument_list|(
name|f
operator|->
name|if_real_bytes
argument_list|)
argument_list|,
name|f
operator|->
name|if_lastex
argument_list|,
name|f
operator|->
name|if_flags
operator|&
name|XFS_IFINLINE
condition|?
literal|"data"
else|:
literal|"extents"
argument_list|,
name|f
operator|->
name|if_flags
operator|&
name|XFS_IFINLINE
condition|?
name|f
operator|->
name|if_u1
operator|.
name|if_data
else|:
operator|(
name|char
operator|*
operator|)
name|f
operator|->
name|if_u1
operator|.
name|if_extents
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" broot 0x%p broot_bytes %s ext_max %d "
argument_list|,
name|f
operator|->
name|if_broot
argument_list|,
name|xfs_fmtsize
argument_list|(
name|f
operator|->
name|if_broot_bytes
argument_list|)
argument_list|,
name|f
operator|->
name|if_ext_max
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|f
operator|->
name|if_flags
argument_list|,
name|tab_flags
argument_list|,
literal|"flags"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" u2"
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
operator|(
name|int
operator|*
operator|)
operator|&
name|f
operator|->
name|if_u2
init|;
name|p
operator|<
operator|(
name|int
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|f
operator|->
name|if_u2
operator|+
name|XFS_INLINE_DATA
operator|)
condition|;
name|p
operator|++
control|)
name|kdb_printf
argument_list|(
literal|" 0x%x"
argument_list|,
operator|*
name|p
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Command-level xfs-idbg functions.  */
end_comment

begin_comment
comment|/*  * Print xfs allocation group freespace header.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xagf
parameter_list|(
name|xfs_agf_t
modifier|*
name|agf
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"magicnum 0x%x versionnum 0x%x seqno 0x%x length 0x%x\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_magicnum
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_versionnum
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_seqno
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_length
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"roots b 0x%x c 0x%x levels b %d c %d\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_roots
index|[
name|XFS_BTNUM_BNO
index|]
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_roots
index|[
name|XFS_BTNUM_CNT
index|]
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_levels
index|[
name|XFS_BTNUM_BNO
index|]
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_levels
index|[
name|XFS_BTNUM_CNT
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"flfirst %d fllast %d flcount %d freeblks %d longest %d\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_flfirst
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_fllast
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_flcount
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_freeblks
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_longest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print xfs allocation group inode header.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xagi
parameter_list|(
name|xfs_agi_t
modifier|*
name|agi
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"magicnum 0x%x versionnum 0x%x seqno 0x%x length 0x%x\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_magicnum
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_versionnum
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_seqno
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_length
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"count 0x%x root 0x%x level 0x%x\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_count
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_root
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_level
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"freecount 0x%x newino 0x%x dirino 0x%x\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_freecount
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_newino
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_dirino
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"unlinked buckets\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XFS_AGI_UNLINKED_BUCKETS
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"0x%08x "
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_unlinked
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the last "count" entries in the allocation trace buffer.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xalatrace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_alloc_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs alloc trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_alloc_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_alloc_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out all the entries in the alloc trace buf corresponding  * to the given block number.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xalbtrace
parameter_list|(
name|xfs_agblock_t
name|bno
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|xfs_alloc_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs alloc trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
switch|switch
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|XFS_ALLOC_KTRACE_ALLOC
case|:
case|case
name|XFS_ALLOC_KTRACE_FREE
case|:
if|if
condition|(
name|bno
operator|>=
call|(
name|xfs_agblock_t
call|)
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|)
operator|&&
name|bno
operator|<
call|(
name|xfs_agblock_t
call|)
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|)
operator|+
call|(
name|xfs_extlen_t
call|)
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|xfs_alloc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out all the entries in the alloc trace buf corresponding  * to the given allocation group.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xalgtrace
parameter_list|(
name|xfs_agnumber_t
name|agno
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|xfs_alloc_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs alloc trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&&
operator|(
call|(
name|xfs_agnumber_t
call|)
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
operator|)
operator|==
name|agno
condition|)
block|{
operator|(
name|void
operator|)
name|xfs_alloc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print an allocation argument structure for XFS.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xalloc
parameter_list|(
name|xfs_alloc_arg_t
modifier|*
name|args
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"tp 0x%p mp 0x%p agbp 0x%p pag 0x%p fsbno %s\n"
argument_list|,
name|args
operator|->
name|tp
argument_list|,
name|args
operator|->
name|mp
argument_list|,
name|args
operator|->
name|agbp
argument_list|,
name|args
operator|->
name|pag
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|args
operator|->
name|fsbno
argument_list|,
name|args
operator|->
name|mp
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"agno 0x%x agbno 0x%x minlen 0x%x maxlen 0x%x mod 0x%x\n"
argument_list|,
name|args
operator|->
name|agno
argument_list|,
name|args
operator|->
name|agbno
argument_list|,
name|args
operator|->
name|minlen
argument_list|,
name|args
operator|->
name|maxlen
argument_list|,
name|args
operator|->
name|mod
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"prod 0x%x minleft 0x%x total 0x%x alignment 0x%x\n"
argument_list|,
name|args
operator|->
name|prod
argument_list|,
name|args
operator|->
name|minleft
argument_list|,
name|args
operator|->
name|total
argument_list|,
name|args
operator|->
name|alignment
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"minalignslop 0x%x len 0x%x type %s otype %s wasdel %d\n"
argument_list|,
name|args
operator|->
name|minalignslop
argument_list|,
name|args
operator|->
name|len
argument_list|,
name|xfs_alloctype
index|[
name|args
operator|->
name|type
index|]
argument_list|,
name|xfs_alloctype
index|[
name|args
operator|->
name|otype
index|]
argument_list|,
name|args
operator|->
name|wasdel
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"wasfromfl %d isfl %d userdata %d\n"
argument_list|,
name|args
operator|->
name|wasfromfl
argument_list|,
name|args
operator|->
name|isfl
argument_list|,
name|args
operator|->
name|userdata
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ALLOC_TRACE
end_ifdef

begin_comment
comment|/*  * Print out all the entries in the alloc trace buf corresponding  * to the given mount point.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xalmtrace
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|xfs_alloc_trace_buf
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"The xfs alloc trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&&
operator|(
name|xfs_mount_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
operator|==
name|mp
condition|)
block|{
operator|(
name|void
operator|)
name|xfs_alloc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out all the entries in the alloc trace buf corresponding  * to the given entry type.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xalttrace
parameter_list|(
name|int
name|tag
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|xfs_alloc_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs alloc trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&&
operator|(
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&
literal|0xffffL
operator|)
operator|==
operator|(
name|long
operator|)
name|tag
condition|)
block|{
operator|(
name|void
operator|)
name|xfs_alloc_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_alloc_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|int
name|xargument
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Set xtra argument, used by xchksum.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xarg
parameter_list|(
name|int
name|xarg
parameter_list|)
block|{
if|if
condition|(
name|xarg
operator|==
operator|-
literal|1
condition|)
name|qprintf
argument_list|(
literal|"xargument: %d\n"
argument_list|,
name|xargument
argument_list|)
expr_stmt|;
else|else
name|xargument
operator|=
name|xarg
expr_stmt|;
block|}
end_function

begin_comment
comment|/* xfsidbg_xarg */
end_comment

begin_comment
comment|/*  * Print an attr_list() context structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xattrcontext
parameter_list|(
name|xfs_attr_list_context_t
modifier|*
name|context
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|attr_arg_flags
index|[]
init|=
block|{
literal|"DONTFOLLOW"
block|,
comment|/* 0x0001 */
literal|"?"
block|,
comment|/* 0x0002 */
literal|"?"
block|,
comment|/* 0x0004 */
literal|"?"
block|,
comment|/* 0x0008 */
literal|"CREATE"
block|,
comment|/* 0x0010 */
literal|"?"
block|,
comment|/* 0x0020 */
literal|"?"
block|,
comment|/* 0x0040 */
literal|"?"
block|,
comment|/* 0x0080 */
literal|"?"
block|,
comment|/* 0x0100 */
literal|"?"
block|,
comment|/* 0x0200 */
literal|"?"
block|,
comment|/* 0x0400 */
literal|"?"
block|,
comment|/* 0x0800 */
literal|"KERNOTIME"
block|,
comment|/* 0x1000 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"dp 0x%p, dupcnt %d, resynch %d"
argument_list|,
name|context
operator|->
name|dp
argument_list|,
name|context
operator|->
name|dupcnt
argument_list|,
name|context
operator|->
name|resynch
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psunsigned_t
operator|)
name|context
operator|->
name|flags
argument_list|,
name|attr_arg_flags
argument_list|,
literal|", flags"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\ncursor h/b/o 0x%x/0x%x/%d -- p/p/i 0x%x/0x%x/0x%x\n"
argument_list|,
name|context
operator|->
name|cursor
operator|->
name|hashval
argument_list|,
name|context
operator|->
name|cursor
operator|->
name|blkno
argument_list|,
name|context
operator|->
name|cursor
operator|->
name|offset
argument_list|,
name|context
operator|->
name|cursor
operator|->
name|pad1
argument_list|,
name|context
operator|->
name|cursor
operator|->
name|pad2
argument_list|,
name|context
operator|->
name|cursor
operator|->
name|initted
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"alist 0x%p, bufsize 0x%x, count %d, firstu 0x%x\n"
argument_list|,
name|context
operator|->
name|alist
argument_list|,
name|context
operator|->
name|bufsize
argument_list|,
name|context
operator|->
name|count
argument_list|,
name|context
operator|->
name|firstu
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print attribute leaf block.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xattrleaf
parameter_list|(
name|xfs_attr_leafblock_t
modifier|*
name|leaf
parameter_list|)
block|{
name|xfs_attr_leaf_hdr_t
modifier|*
name|h
decl_stmt|;
name|xfs_da_blkinfo_t
modifier|*
name|i
decl_stmt|;
name|xfs_attr_leaf_map_t
modifier|*
name|m
decl_stmt|;
name|xfs_attr_leaf_entry_t
modifier|*
name|e
decl_stmt|;
name|xfs_attr_leaf_name_local_t
modifier|*
name|l
decl_stmt|;
name|xfs_attr_leaf_name_remote_t
modifier|*
name|r
decl_stmt|;
name|int
name|j
decl_stmt|,
name|k
decl_stmt|;
name|h
operator|=
operator|&
name|leaf
operator|->
name|hdr
expr_stmt|;
name|i
operator|=
operator|&
name|h
operator|->
name|info
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr info forw 0x%x back 0x%x magic 0x%x\n"
argument_list|,
name|i
operator|->
name|forw
argument_list|,
name|i
operator|->
name|back
argument_list|,
name|i
operator|->
name|magic
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr count %d usedbytes %d firstused %d holes %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|usedbytes
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|firstused
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|h
operator|->
name|holes
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|m
operator|=
name|h
operator|->
name|freemap
init|;
name|j
operator|<
name|XFS_ATTR_LEAF_MAPSIZE
condition|;
name|j
operator|++
operator|,
name|m
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"hdr freemap %d base %d size %d\n"
argument_list|,
name|j
argument_list|,
name|INT_GET
argument_list|(
name|m
operator|->
name|base
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|m
operator|->
name|size
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|e
operator|=
name|leaf
operator|->
name|entries
init|;
name|j
operator|<
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|j
operator|++
operator|,
name|e
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"[%2d] hash 0x%x nameidx %d flags 0x%x"
argument_list|,
name|j
argument_list|,
name|INT_GET
argument_list|(
name|e
operator|->
name|hashval
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|e
operator|->
name|nameidx
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|e
operator|->
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|flags
operator|&
name|XFS_ATTR_LOCAL
condition|)
name|kdb_printf
argument_list|(
literal|"LOCAL "
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|flags
operator|&
name|XFS_ATTR_ROOT
condition|)
name|kdb_printf
argument_list|(
literal|"ROOT "
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|flags
operator|&
name|XFS_ATTR_SECURE
condition|)
name|kdb_printf
argument_list|(
literal|"SECURE "
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|flags
operator|&
name|XFS_ATTR_INCOMPLETE
condition|)
name|kdb_printf
argument_list|(
literal|"INCOMPLETE "
argument_list|)
expr_stmt|;
name|k
operator|=
operator|~
operator|(
name|XFS_ATTR_LOCAL
operator||
name|XFS_ATTR_ROOT
operator||
name|XFS_ATTR_SECURE
operator||
name|XFS_ATTR_INCOMPLETE
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|e
operator|->
name|flags
operator|&
name|k
operator|)
operator|!=
literal|0
condition|)
name|kdb_printf
argument_list|(
literal|"0x%x"
argument_list|,
name|e
operator|->
name|flags
operator|&
name|k
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|">\n     name \""
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|flags
operator|&
name|XFS_ATTR_LOCAL
condition|)
block|{
name|l
operator|=
name|XFS_ATTR_LEAF_NAME_LOCAL
argument_list|(
name|leaf
argument_list|,
name|j
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|l
operator|->
name|namelen
condition|;
name|k
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|l
operator|->
name|nameval
index|[
name|k
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"(%d) value \""
argument_list|,
name|l
operator|->
name|namelen
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
operator|(
name|k
operator|<
name|INT_GET
argument_list|(
name|l
operator|->
name|valuelen
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|)
operator|&&
operator|(
name|k
operator|<
literal|32
operator|)
condition|;
name|k
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|l
operator|->
name|nameval
index|[
name|l
operator|->
name|namelen
operator|+
name|k
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|==
literal|32
condition|)
name|kdb_printf
argument_list|(
literal|"..."
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"(%d)\n"
argument_list|,
name|INT_GET
argument_list|(
name|l
operator|->
name|valuelen
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|r
operator|=
name|XFS_ATTR_LEAF_NAME_REMOTE
argument_list|(
name|leaf
argument_list|,
name|j
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|r
operator|->
name|namelen
condition|;
name|k
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|r
operator|->
name|name
index|[
name|k
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"(%d) value blk 0x%x len %d\n"
argument_list|,
name|r
operator|->
name|namelen
argument_list|,
name|INT_GET
argument_list|(
name|r
operator|->
name|valueblk
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|r
operator|->
name|valuelen
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print a shortform attribute list.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xattrsf
parameter_list|(
name|xfs_attr_shortform_t
modifier|*
name|s
parameter_list|)
block|{
name|xfs_attr_sf_hdr_t
modifier|*
name|sfh
decl_stmt|;
name|xfs_attr_sf_entry_t
modifier|*
name|sfe
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|sfh
operator|=
operator|&
name|s
operator|->
name|hdr
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr count %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|sfh
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|sfe
operator|=
name|s
operator|->
name|list
init|;
name|i
operator|<
name|INT_GET
argument_list|(
name|sfh
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"entry %d namelen %d name \""
argument_list|,
name|i
argument_list|,
name|sfe
operator|->
name|namelen
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|sfe
operator|->
name|namelen
condition|;
name|j
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|sfe
operator|->
name|nameval
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\" valuelen %d value \""
argument_list|,
name|INT_GET
argument_list|(
name|sfe
operator|->
name|valuelen
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
operator|(
name|j
operator|<
name|INT_GET
argument_list|(
name|sfe
operator|->
name|valuelen
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|)
operator|&&
operator|(
name|j
operator|<
literal|32
operator|)
condition|;
name|j
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|sfe
operator|->
name|nameval
index|[
name|sfe
operator|->
name|namelen
operator|+
name|j
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
literal|32
condition|)
name|kdb_printf
argument_list|(
literal|"..."
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
name|sfe
operator|=
name|XFS_ATTR_SF_NEXTENTRY
argument_list|(
name|sfe
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ATTR_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the last "count" entries in the attribute trace buffer.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xattrtrace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_attr_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs attribute trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_attr_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_attr_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_attr_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
name|xfs_attr_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_attr_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print xfs bmap internal record  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbirec
parameter_list|(
name|xfs_bmbt_irec_t
modifier|*
name|r
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"startoff %Ld startblock %Lx blockcount %Ld state %Ld\n"
argument_list|,
operator|(
name|__uint64_t
operator|)
name|r
operator|->
name|br_startoff
argument_list|,
operator|(
name|__uint64_t
operator|)
name|r
operator|->
name|br_startblock
argument_list|,
operator|(
name|__uint64_t
operator|)
name|r
operator|->
name|br_blockcount
argument_list|,
operator|(
name|__uint64_t
operator|)
name|r
operator|->
name|br_state
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BLI_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the buf log item trace for the given buf log item.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xblitrace
parameter_list|(
name|xfs_buf_log_item_t
modifier|*
name|bip
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|uint64_t
name|flags
decl_stmt|;
specifier|static
name|char
modifier|*
name|xbli_flags
index|[]
init|=
block|{
literal|"hold"
block|,
comment|/* 0x01 */
literal|"dirty"
block|,
comment|/* 0x02 */
literal|"stale"
block|,
comment|/* 0x04 */
literal|"logged"
block|,
comment|/* 0x08 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|xli_flags
index|[]
init|=
block|{
literal|"in ail"
block|,
comment|/* 0x1 */
name|NULL
block|}
decl_stmt|;
if|if
condition|(
name|bip
operator|->
name|bli_trace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The bli trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|bip
operator|->
name|bli_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"%s bp 0x%p flags "
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
call|(
name|__psint_t
call|)
argument_list|(
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|xbli_flags
argument_list|,
literal|"xbli"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"recur %ld refcount %ld blkno 0x%lx bcount 0x%lx\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|flags
operator|=
operator|(
operator|(
operator|(
name|uint64_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|<<
literal|32
operator|)
operator|&
literal|0xFFFFFFFF00000000ULL
operator|)
operator||
operator|(
operator|(
operator|(
name|uint64_t
operator|)
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
operator|)
operator|&
literal|0x00000000FFFFFFFFULL
operator|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"bp flags "
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|flags
argument_list|,
name|bp_flag_vals
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"fspriv 0x%p fspriv2 0x%p pincount %ld iodone 0x%p\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"lockval %ld lid 0x%lx log item flags "
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
call|(
name|__psint_t
call|)
argument_list|(
name|ktep
operator|->
name|val
index|[
literal|15
index|]
argument_list|)
argument_list|,
name|xli_flags
argument_list|,
literal|"xli"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|bip
operator|->
name|bli_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print a bmap alloc argument structure for XFS.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbmalla
parameter_list|(
name|xfs_bmalloca_t
modifier|*
name|a
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"tp 0x%p ip 0x%p eof %d prevp 0x%p\n"
argument_list|,
name|a
operator|->
name|tp
argument_list|,
name|a
operator|->
name|ip
argument_list|,
name|a
operator|->
name|eof
argument_list|,
name|a
operator|->
name|prevp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"gotp 0x%p firstblock %s alen %d total %d\n"
argument_list|,
name|a
operator|->
name|gotp
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|a
operator|->
name|firstblock
argument_list|,
name|a
operator|->
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|,
name|a
operator|->
name|alen
argument_list|,
name|a
operator|->
name|total
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"off %s wasdel %d userdata %d minlen %d\n"
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|a
operator|->
name|off
argument_list|,
name|a
operator|->
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|,
name|a
operator|->
name|wasdel
argument_list|,
name|a
operator|->
name|userdata
argument_list|,
name|a
operator|->
name|minlen
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"minleft %d low %d rval %s aeof %d conv %d\n"
argument_list|,
name|a
operator|->
name|minleft
argument_list|,
name|a
operator|->
name|low
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|a
operator|->
name|rval
argument_list|,
name|a
operator|->
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|,
name|a
operator|->
name|aeof
argument_list|,
name|a
operator|->
name|conv
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the last "count" entries in the bmap btree trace buffer.  * The "a" is for "all" inodes.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbmatrace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_bmbt_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs bmap btree trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_bmbt_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_bmbt_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_bmbt_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_bmbt_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_bmbt_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out the bmap btree trace buffer attached to the given inode.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbmitrace
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|ip
operator|->
name|i_btrace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The inode trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|ip
operator|->
name|i_btrace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_bmbt_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|ip
operator|->
name|i_btrace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out all the entries in the bmap btree trace buf corresponding  * to the given inode.  The "s" is for "single" inode.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbmstrace
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|xfs_bmbt_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs bmap btree trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_bmbt_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|xfs_inode_t
operator|*
operator|)
operator|(
name|ktep
operator|->
name|val
index|[
literal|2
index|]
operator|)
operator|==
name|ip
condition|)
block|{
if|if
condition|(
name|xfs_bmbt_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_bmbt_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print xfs bmap record  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbrec
parameter_list|(
name|xfs_bmbt_rec_64_t
modifier|*
name|r
parameter_list|)
block|{
name|xfs_bmbt_irec_t
name|irec
decl_stmt|;
name|xfs_bmbt_get_all
argument_list|(
operator|(
name|xfs_bmbt_rec_t
operator|*
operator|)
name|r
argument_list|,
operator|&
name|irec
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"startoff %Ld startblock %Lx blockcount %Ld flag %d\n"
argument_list|,
name|irec
operator|.
name|br_startoff
argument_list|,
operator|(
name|__uint64_t
operator|)
name|irec
operator|.
name|br_startblock
argument_list|,
name|irec
operator|.
name|br_blockcount
argument_list|,
name|irec
operator|.
name|br_state
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an xfs in-inode bmap btree root (data fork).  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbroot
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|xfs_broot
argument_list|(
name|ip
argument_list|,
operator|&
name|ip
operator|->
name|i_df
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an xfs in-inode bmap btree root (attribute fork).  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbroota
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
if|if
condition|(
name|ip
operator|->
name|i_afp
condition|)
name|xfs_broot
argument_list|(
name|ip
argument_list|,
name|ip
operator|->
name|i_afp
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print xfs btree cursor.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbtcur
parameter_list|(
name|xfs_btree_cur_t
modifier|*
name|c
parameter_list|)
block|{
name|int
name|l
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"tp 0x%p mp 0x%p\n"
argument_list|,
name|c
operator|->
name|bc_tp
argument_list|,
name|c
operator|->
name|bc_mp
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_BMAP
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"rec.b "
argument_list|)
expr_stmt|;
name|xfsidbg_xbirec
argument_list|(
operator|&
name|c
operator|->
name|bc_rec
operator|.
name|b
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_INO
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"rec.i startino 0x%x freecount 0x%x free %Lx\n"
argument_list|,
name|c
operator|->
name|bc_rec
operator|.
name|i
operator|.
name|ir_startino
argument_list|,
name|c
operator|->
name|bc_rec
operator|.
name|i
operator|.
name|ir_freecount
argument_list|,
name|c
operator|->
name|bc_rec
operator|.
name|i
operator|.
name|ir_free
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"rec.a startblock 0x%x blockcount 0x%x\n"
argument_list|,
name|c
operator|->
name|bc_rec
operator|.
name|a
operator|.
name|ar_startblock
argument_list|,
name|c
operator|->
name|bc_rec
operator|.
name|a
operator|.
name|ar_blockcount
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"bufs"
argument_list|)
expr_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|c
operator|->
name|bc_nlevels
condition|;
name|l
operator|++
control|)
name|kdb_printf
argument_list|(
literal|" 0x%p"
argument_list|,
name|c
operator|->
name|bc_bufs
index|[
name|l
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ptrs"
argument_list|)
expr_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|c
operator|->
name|bc_nlevels
condition|;
name|l
operator|++
control|)
name|kdb_printf
argument_list|(
literal|" 0x%x"
argument_list|,
name|c
operator|->
name|bc_ptrs
index|[
name|l
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  ra"
argument_list|)
expr_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|c
operator|->
name|bc_nlevels
condition|;
name|l
operator|++
control|)
name|kdb_printf
argument_list|(
literal|" %d"
argument_list|,
name|c
operator|->
name|bc_ra
index|[
name|l
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"nlevels %d btnum %s blocklog %d\n"
argument_list|,
name|c
operator|->
name|bc_nlevels
argument_list|,
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_BNO
condition|?
literal|"bno"
else|:
operator|(
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_CNT
condition|?
literal|"cnt"
else|:
operator|(
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_BMAP
condition|?
literal|"bmap"
else|:
literal|"ino"
operator|)
operator|)
argument_list|,
name|c
operator|->
name|bc_blocklog
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_BMAP
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"private forksize 0x%x whichfork %d ip 0x%p flags %d\n"
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|forksize
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|whichfork
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|ip
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|flags
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"private firstblock %s flist 0x%p allocated 0x%x\n"
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|firstblock
argument_list|,
name|c
operator|->
name|bc_mp
argument_list|)
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|flist
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|b
operator|.
name|allocated
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|->
name|bc_btnum
operator|==
name|XFS_BTNUM_INO
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"private agbp 0x%p agno 0x%x\n"
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|i
operator|.
name|agbp
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|i
operator|.
name|agno
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"private agbp 0x%p agno 0x%x\n"
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|a
operator|.
name|agbp
argument_list|,
name|c
operator|->
name|bc_private
operator|.
name|a
operator|.
name|agno
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Figure out what kind of xfs block the buffer contains,  * and invoke a print routine.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbuf
parameter_list|(
name|xfs_buf_t
modifier|*
name|bp
parameter_list|)
block|{
name|xfsidbg_xbuf_real
argument_list|(
name|bp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Figure out what kind of xfs block the buffer contains,  * and invoke a print routine (if asked to).  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbuf_real
parameter_list|(
name|xfs_buf_t
modifier|*
name|bp
parameter_list|,
name|int
name|summary
parameter_list|)
block|{
name|void
modifier|*
name|d
decl_stmt|;
name|xfs_agf_t
modifier|*
name|agf
decl_stmt|;
name|xfs_agi_t
modifier|*
name|agi
decl_stmt|;
name|xfs_sb_t
modifier|*
name|sb
decl_stmt|;
name|xfs_alloc_block_t
modifier|*
name|bta
decl_stmt|;
name|xfs_bmbt_block_t
modifier|*
name|btb
decl_stmt|;
name|xfs_inobt_block_t
modifier|*
name|bti
decl_stmt|;
name|xfs_attr_leafblock_t
modifier|*
name|aleaf
decl_stmt|;
name|xfs_dir_leafblock_t
modifier|*
name|dleaf
decl_stmt|;
name|xfs_da_intnode_t
modifier|*
name|node
decl_stmt|;
name|xfs_dinode_t
modifier|*
name|di
decl_stmt|;
name|xfs_disk_dquot_t
modifier|*
name|dqb
decl_stmt|;
name|xfs_dir2_block_t
modifier|*
name|d2block
decl_stmt|;
name|xfs_dir2_data_t
modifier|*
name|d2data
decl_stmt|;
name|xfs_dir2_leaf_t
modifier|*
name|d2leaf
decl_stmt|;
name|xfs_dir2_free_t
modifier|*
name|d2free
decl_stmt|;
name|d
operator|=
name|XFS_BUF_PTR
argument_list|(
name|bp
argument_list|)
expr_stmt|;
if|if
condition|(
name|be32_to_cpu
argument_list|(
operator|(
name|agf
operator|=
name|d
operator|)
operator|->
name|agf_magicnum
argument_list|)
operator|==
name|XFS_AGF_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"freespace hdr for AG %d (at 0x%p)\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agf
operator|->
name|agf_seqno
argument_list|)
argument_list|,
name|agf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p agf 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|agf
argument_list|)
expr_stmt|;
name|xfsidbg_xagf
argument_list|(
name|agf
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|be32_to_cpu
argument_list|(
operator|(
name|agi
operator|=
name|d
operator|)
operator|->
name|agi_magicnum
argument_list|)
operator|==
name|XFS_AGI_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Inode hdr for AG %d (at 0x%p)\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|agi
operator|->
name|agi_seqno
argument_list|)
argument_list|,
name|agi
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p agi 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|agi
argument_list|)
expr_stmt|;
name|xfsidbg_xagi
argument_list|(
name|agi
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|be32_to_cpu
argument_list|(
operator|(
name|bta
operator|=
name|d
operator|)
operator|->
name|bb_magic
argument_list|)
operator|==
name|XFS_ABTB_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Alloc BNO Btree blk, level %d (at 0x%p)\n"
argument_list|,
name|be16_to_cpu
argument_list|(
name|bta
operator|->
name|bb_level
argument_list|)
argument_list|,
name|bta
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p abtbno 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|bta
argument_list|)
expr_stmt|;
name|xfs_btalloc
argument_list|(
name|bta
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|be32_to_cpu
argument_list|(
operator|(
name|bta
operator|=
name|d
operator|)
operator|->
name|bb_magic
argument_list|)
operator|==
name|XFS_ABTC_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Alloc COUNT Btree blk, level %d (at 0x%p)\n"
argument_list|,
name|be16_to_cpu
argument_list|(
name|bta
operator|->
name|bb_level
argument_list|)
argument_list|,
name|bta
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p abtcnt 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|bta
argument_list|)
expr_stmt|;
name|xfs_btalloc
argument_list|(
name|bta
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|be32_to_cpu
argument_list|(
operator|(
name|btb
operator|=
name|d
operator|)
operator|->
name|bb_magic
argument_list|)
operator|==
name|XFS_BMAP_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Bmap Btree blk, level %d (at 0x%p)\n"
argument_list|,
name|be16_to_cpu
argument_list|(
name|btb
operator|->
name|bb_level
argument_list|)
argument_list|,
name|btb
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p bmapbt 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|btb
argument_list|)
expr_stmt|;
name|xfs_btbmap
argument_list|(
name|btb
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|be32_to_cpu
argument_list|(
operator|(
name|bti
operator|=
name|d
operator|)
operator|->
name|bb_magic
argument_list|)
operator|==
name|XFS_IBT_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Inode Btree blk, level %d (at 0x%p)\n"
argument_list|,
name|be16_to_cpu
argument_list|(
name|bti
operator|->
name|bb_level
argument_list|)
argument_list|,
name|bti
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p inobt 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|bti
argument_list|)
expr_stmt|;
name|xfs_btino
argument_list|(
name|bti
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|aleaf
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|info
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_ATTR_LEAF_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Attr Leaf, 1st hash 0x%x (at 0x%p)\n"
argument_list|,
name|INT_GET
argument_list|(
name|aleaf
operator|->
name|entries
index|[
literal|0
index|]
operator|.
name|hashval
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|aleaf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p attr leaf 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|aleaf
argument_list|)
expr_stmt|;
name|xfsidbg_xattrleaf
argument_list|(
name|aleaf
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|dleaf
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|info
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR_LEAF_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir Leaf, 1st hash 0x%x (at 0x%p)\n"
argument_list|,
name|dleaf
operator|->
name|entries
index|[
literal|0
index|]
operator|.
name|hashval
argument_list|,
name|dleaf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir leaf 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|dleaf
argument_list|)
expr_stmt|;
name|xfsidbg_xdirleaf
argument_list|(
name|dleaf
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|node
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|info
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DA_NODE_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir/Attr Node, level %d, 1st hash 0x%x (at 0x%p)\n"
argument_list|,
name|node
operator|->
name|hdr
operator|.
name|level
argument_list|,
name|node
operator|->
name|btree
index|[
literal|0
index|]
operator|.
name|hashval
argument_list|,
name|node
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir/attr node 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|node
argument_list|)
expr_stmt|;
name|xfsidbg_xdanode
argument_list|(
name|node
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|di
operator|=
name|d
operator|)
operator|->
name|di_core
operator|.
name|di_magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DINODE_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Disk Inode (at 0x%p)\n"
argument_list|,
name|di
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dinode 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|di
argument_list|)
expr_stmt|;
name|xfs_inodebuf
argument_list|(
name|bp
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|sb
operator|=
name|d
operator|)
operator|->
name|sb_magicnum
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_SB_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Superblock (at 0x%p)\n"
argument_list|,
name|sb
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p sb 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|sb
argument_list|)
expr_stmt|;
comment|/* SB in a buffer - we need to convert */
name|xfsidbg_xsb_convert
argument_list|(
name|sb
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|dqb
operator|=
name|d
operator|)
operator|->
name|d_magic
operator|==
name|cpu_to_be16
argument_list|(
name|XFS_DQUOT_MAGIC
argument_list|)
condition|)
block|{
define|#
directive|define
name|XFSIDBG_DQTYPESTR
parameter_list|(
name|d
parameter_list|)
define|\
value|(((d)->d_flags& XFS_DQ_USER) ? "USR" : \ 	(((d)->d_flags& XFS_DQ_GROUP) ? "GRP" : \ 	(((d)->d_flags& XFS_DQ_PROJ) ? "PRJ" : "???")))
name|kdb_printf
argument_list|(
literal|"Quota blk starting ID [%d], type %s at 0x%p\n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|dqb
operator|->
name|d_id
argument_list|)
argument_list|,
name|XFSIDBG_DQTYPESTR
argument_list|(
name|dqb
argument_list|)
argument_list|,
name|dqb
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|d2block
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_BLOCK_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir2 block (at 0x%p)\n"
argument_list|,
name|d2block
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir2 block 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|d2block
argument_list|)
expr_stmt|;
name|xfs_dir2data
argument_list|(
operator|(
name|void
operator|*
operator|)
name|d2block
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|d2data
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_DATA_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir2 data (at 0x%p)\n"
argument_list|,
name|d2data
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir2 data 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|d2data
argument_list|)
expr_stmt|;
name|xfs_dir2data
argument_list|(
operator|(
name|void
operator|*
operator|)
name|d2data
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|d2leaf
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|info
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_LEAF1_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir2 leaf(1) (at 0x%p)\n"
argument_list|,
name|d2leaf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir2 leaf 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|d2leaf
argument_list|)
expr_stmt|;
name|xfs_dir2leaf
argument_list|(
name|d2leaf
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
name|d2leaf
operator|->
name|hdr
operator|.
name|info
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_LEAFN_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir2 leaf(n) (at 0x%p)\n"
argument_list|,
name|d2leaf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir2 leaf 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|d2leaf
argument_list|)
expr_stmt|;
name|xfs_dir2leaf
argument_list|(
name|d2leaf
argument_list|,
name|XFS_BUF_COUNT
argument_list|(
name|bp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|INT_GET
argument_list|(
operator|(
name|d2free
operator|=
name|d
operator|)
operator|->
name|hdr
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_FREE_MAGIC
condition|)
block|{
if|if
condition|(
name|summary
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Dir2 free (at 0x%p)\n"
argument_list|,
name|d2free
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p dir2 free 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|d2free
argument_list|)
expr_stmt|;
name|xfsidbg_xdir2free
argument_list|(
name|d2free
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"buf 0x%p unknown 0x%p\n"
argument_list|,
name|bp
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the last "count" entries in the bmap extent trace buffer.  * The "a" is for "all" inodes.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbxatrace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_bmap_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs bmap extent trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_bmap_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_bmap_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_bmap_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_bmap_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_bmap_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out the bmap extent trace buffer attached to the given inode.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbxitrace
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|ip
operator|->
name|i_xtrace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The inode trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|ip
operator|->
name|i_xtrace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_bmap_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|ip
operator|->
name|i_xtrace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out all the entries in the bmap extent trace buf corresponding  * to the given inode.  The "s" is for "single" inode.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xbxstrace
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|xfs_bmap_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs bmap extent trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_bmap_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|xfs_inode_t
operator|*
operator|)
operator|(
name|ktep
operator|->
name|val
index|[
literal|3
index|]
operator|)
operator|==
name|ip
condition|)
block|{
if|if
condition|(
name|xfs_bmap_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_bmap_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_ILOCK_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the ilock trace buffer attached to the given inode.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xilock_trace_entry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|xiflags
index|[]
init|=
block|{
literal|"IOLOCK_EXCL"
block|,
literal|"IOLOCK_SHAR"
block|,
literal|"ILOCK_EXCL"
block|,
literal|"ILOCK_SHAR"
block|,
literal|"IUNLK_NONOT"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&&
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|==
literal|0
condition|)
block|{
name|printflags
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|xiflags
argument_list|,
literal|"Flags "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|1
condition|)
name|qprintf
argument_list|(
literal|"LOCK\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|2
condition|)
name|qprintf
argument_list|(
literal|"LOCK SHARED\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|3
condition|)
name|qprintf
argument_list|(
literal|"UNLOCK\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"ip 0x%p %llx %ld\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
call|(
name|unsigned
name|long
name|long
call|)
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|)
operator|->
name|i_ino
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"raddr 0x%p\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  Pid %ld, cpu %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"-----------------------\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|==
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|1
condition|)
name|qprintf
argument_list|(
literal|"FlushLOCK "
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|2
condition|)
name|qprintf
argument_list|(
literal|"FlushTRYLOCK %ld "
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|3
condition|)
name|qprintf
argument_list|(
literal|"FlushUNLOCK "
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|4
condition|)
name|qprintf
argument_list|(
literal|"FlushInode 0x%p"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|5
condition|)
name|qprintf
argument_list|(
literal|"FlushInodeInt "
argument_list|)
expr_stmt|;
else|else
name|qprintf
argument_list|(
literal|"FlushUNKNOWN "
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"ip 0x%p ino %llx @ %ld\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
call|(
name|unsigned
name|long
name|long
call|)
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|)
operator|->
name|i_ino
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"raddr 0x%p\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  Pid %ld, cpu %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"-----------------------\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xilock_trace
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|xiflags
index|[]
init|=
block|{
literal|"IOLOCK_EXCL"
block|,
literal|"IOLOCK_SHAR"
block|,
literal|"ILOCK_EXCL"
block|,
literal|"ILOCK_SHAR"
block|,
literal|"IUNLK_NONOT"
block|,
name|NULL
block|}
decl_stmt|;
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|ip
operator|->
name|i_lock_trace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The inode ilock trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|ip
operator|->
name|i_lock_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|&&
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|==
literal|0
condition|)
block|{
name|printflags
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
name|xiflags
argument_list|,
literal|"Flags "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|1
condition|)
name|qprintf
argument_list|(
literal|"LOCK\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|2
condition|)
name|qprintf
argument_list|(
literal|"LOCK SHARED\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|3
condition|)
name|qprintf
argument_list|(
literal|"UNLOCK\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"ip 0x%p %lld %ld\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
call|(
name|unsigned
name|long
name|long
call|)
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|)
operator|->
name|i_ino
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"raddr 0x%p\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  Pid %ld, cpu %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"-----------------------\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
operator|==
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|1
condition|)
name|qprintf
argument_list|(
literal|"LOCK "
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|2
condition|)
name|qprintf
argument_list|(
literal|"TRYLOCK %ld "
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
operator|==
literal|3
condition|)
name|qprintf
argument_list|(
literal|"UNLOCK "
argument_list|)
expr_stmt|;
else|else
name|qprintf
argument_list|(
literal|"UNKNOWN "
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"ip 0x%p %lld %ld\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
call|(
name|unsigned
name|long
name|long
call|)
argument_list|(
operator|(
name|xfs_inode_t
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|)
operator|->
name|i_ino
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"raddr 0x%p\n"
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  Pid %ld, cpu %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"-----------------------\n"
argument_list|)
expr_stmt|;
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|ip
operator|->
name|i_lock_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out the last "count" entries in the inode lock trace buffer.  * The "a" is for "all" entries.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xailock_trace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_ilock_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs inode lock trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_ilock_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_ilock_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_ilock_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
name|xfsidbg_xilock_trace_entry
argument_list|(
name|ktep
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_ilock_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Compute& print buffer's checksum.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xchksum
parameter_list|(
name|uint
modifier|*
name|addr
parameter_list|)
block|{
name|uint
name|i
decl_stmt|,
name|chksum
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|__psint_t
operator|)
name|addr
operator|)
operator|==
operator|(
operator|(
name|__psint_t
operator|)
operator|-
literal|1
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"USAGE xchksum<address>\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"       length is set with xarg\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|xargument
condition|;
name|i
operator|++
control|)
block|{
name|chksum
operator|^=
operator|*
name|addr
expr_stmt|;
name|addr
operator|++
expr_stmt|;
block|}
name|qprintf
argument_list|(
literal|"chksum (0x%x)  length (%d)\n"
argument_list|,
name|chksum
argument_list|,
name|xargument
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* xfsidbg_xchksum */
end_comment

begin_comment
comment|/*  * Print an xfs_da_args structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdaargs
parameter_list|(
name|xfs_da_args_t
modifier|*
name|n
parameter_list|)
block|{
name|char
modifier|*
name|ch
decl_stmt|;
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|" name \""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
operator|->
name|namelen
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|n
operator|->
name|name
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\"(%d) value "
argument_list|,
name|n
operator|->
name|namelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|value
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"\""
argument_list|)
expr_stmt|;
name|ch
operator|=
name|n
operator|->
name|value
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|n
operator|->
name|valuelen
operator|)
operator|&&
operator|(
name|i
operator|<
literal|32
operator|)
condition|;
name|ch
operator|++
operator|,
name|i
operator|++
control|)
block|{
switch|switch
condition|(
operator|*
name|ch
condition|)
block|{
case|case
literal|'\n'
case|:
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'\b'
case|:
name|kdb_printf
argument_list|(
literal|"\b"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'\t'
case|:
name|kdb_printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
name|ch
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
literal|32
condition|)
name|kdb_printf
argument_list|(
literal|"..."
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"(%d)\n"
argument_list|,
name|n
operator|->
name|valuelen
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"(NULL)(%d)\n"
argument_list|,
name|n
operator|->
name|valuelen
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|" hashval 0x%x whichfork %d flags<"
argument_list|,
operator|(
name|uint_t
operator|)
name|n
operator|->
name|hashval
argument_list|,
name|n
operator|->
name|whichfork
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|ATTR_ROOT
condition|)
name|kdb_printf
argument_list|(
literal|"ROOT "
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|ATTR_SECURE
condition|)
name|kdb_printf
argument_list|(
literal|"SECURE "
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|ATTR_CREATE
condition|)
name|kdb_printf
argument_list|(
literal|"CREATE "
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|ATTR_REPLACE
condition|)
name|kdb_printf
argument_list|(
literal|"REPLACE "
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|XFS_ATTR_INCOMPLETE
condition|)
name|kdb_printf
argument_list|(
literal|"INCOMPLETE "
argument_list|)
expr_stmt|;
name|i
operator|=
operator|~
operator|(
name|ATTR_ROOT
operator||
name|ATTR_SECURE
operator||
name|ATTR_CREATE
operator||
name|ATTR_REPLACE
operator||
name|XFS_ATTR_INCOMPLETE
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|->
name|flags
operator|&
name|i
operator|)
operator|!=
literal|0
condition|)
name|kdb_printf
argument_list|(
literal|"0x%x"
argument_list|,
name|n
operator|->
name|flags
operator|&
name|i
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|">\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" rename %d justcheck %d addname %d oknoent %d\n"
argument_list|,
name|n
operator|->
name|rename
argument_list|,
name|n
operator|->
name|justcheck
argument_list|,
name|n
operator|->
name|addname
argument_list|,
name|n
operator|->
name|oknoent
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" leaf: blkno %d index %d rmtblkno %d rmtblkcnt %d\n"
argument_list|,
name|n
operator|->
name|blkno
argument_list|,
name|n
operator|->
name|index
argument_list|,
name|n
operator|->
name|rmtblkno
argument_list|,
name|n
operator|->
name|rmtblkcnt
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" leaf2: blkno %d index %d rmtblkno %d rmtblkcnt %d\n"
argument_list|,
name|n
operator|->
name|blkno2
argument_list|,
name|n
operator|->
name|index2
argument_list|,
name|n
operator|->
name|rmtblkno2
argument_list|,
name|n
operator|->
name|rmtblkcnt2
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" inumber %llu dp 0x%p firstblock 0x%p flist 0x%p\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|n
operator|->
name|inumber
argument_list|,
name|n
operator|->
name|dp
argument_list|,
name|n
operator|->
name|firstblock
argument_list|,
name|n
operator|->
name|flist
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" trans 0x%p total %d\n"
argument_list|,
name|n
operator|->
name|trans
argument_list|,
name|n
operator|->
name|total
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a da buffer structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdabuf
parameter_list|(
name|xfs_dabuf_t
modifier|*
name|dabuf
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"nbuf %d dirty %d bbcount %d data 0x%p bps"
argument_list|,
name|dabuf
operator|->
name|nbuf
argument_list|,
name|dabuf
operator|->
name|dirty
argument_list|,
name|dabuf
operator|->
name|bbcount
argument_list|,
name|dabuf
operator|->
name|data
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dabuf
operator|->
name|nbuf
condition|;
name|i
operator|++
control|)
name|kdb_printf
argument_list|(
literal|" %d:0x%p"
argument_list|,
name|i
argument_list|,
name|dabuf
operator|->
name|bps
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_DABUF_DEBUG
name|kdb_printf
argument_list|(
literal|" ra 0x%x prev 0x%x next 0x%x dev 0x%x blkno 0x%x\n"
argument_list|,
name|dabuf
operator|->
name|ra
argument_list|,
name|dabuf
operator|->
name|prev
argument_list|,
name|dabuf
operator|->
name|next
argument_list|,
name|dabuf
operator|->
name|dev
argument_list|,
name|dabuf
operator|->
name|blkno
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/*  * Print a directory/attribute internal node block.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdanode
parameter_list|(
name|xfs_da_intnode_t
modifier|*
name|node
parameter_list|)
block|{
name|xfs_da_node_hdr_t
modifier|*
name|h
decl_stmt|;
name|xfs_da_blkinfo_t
modifier|*
name|i
decl_stmt|;
name|xfs_da_node_entry_t
modifier|*
name|e
decl_stmt|;
name|int
name|j
decl_stmt|;
name|h
operator|=
operator|&
name|node
operator|->
name|hdr
expr_stmt|;
name|i
operator|=
operator|&
name|h
operator|->
name|info
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr info forw 0x%x back 0x%x magic 0x%x\n"
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|forw
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|back
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr count %d level %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|level
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|e
operator|=
name|node
operator|->
name|btree
init|;
name|j
operator|<
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|j
operator|++
operator|,
name|e
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"btree %d hashval 0x%x before 0x%x\n"
argument_list|,
name|j
argument_list|,
operator|(
name|uint_t
operator|)
name|INT_GET
argument_list|(
name|e
operator|->
name|hashval
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|e
operator|->
name|before
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print an xfs_da_state_blk structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdastate
parameter_list|(
name|xfs_da_state_t
modifier|*
name|s
parameter_list|)
block|{
name|xfs_da_state_blk_t
modifier|*
name|eblk
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"args 0x%p mp 0x%p blocksize %u node_ents %u inleaf %u\n"
argument_list|,
name|s
operator|->
name|args
argument_list|,
name|s
operator|->
name|mp
argument_list|,
name|s
operator|->
name|blocksize
argument_list|,
name|s
operator|->
name|node_ents
argument_list|,
name|s
operator|->
name|inleaf
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|->
name|args
condition|)
name|xfsidbg_xdaargs
argument_list|(
name|s
operator|->
name|args
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"path:  "
argument_list|)
expr_stmt|;
name|xfs_dastate_path
argument_list|(
operator|&
name|s
operator|->
name|path
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"altpath:  "
argument_list|)
expr_stmt|;
name|xfs_dastate_path
argument_list|(
operator|&
name|s
operator|->
name|altpath
argument_list|)
expr_stmt|;
name|eblk
operator|=
operator|&
name|s
operator|->
name|extrablk
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"extra: valid %d, after %d\n"
argument_list|,
name|s
operator|->
name|extravalid
argument_list|,
name|s
operator|->
name|extraafter
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" bp 0x%p blkno 0x%x "
argument_list|,
name|eblk
operator|->
name|bp
argument_list|,
name|eblk
operator|->
name|blkno
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"index %d hashval 0x%x\n"
argument_list|,
name|eblk
operator|->
name|index
argument_list|,
operator|(
name|uint_t
operator|)
name|eblk
operator|->
name|hashval
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a directory leaf block.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdirleaf
parameter_list|(
name|xfs_dir_leafblock_t
modifier|*
name|leaf
parameter_list|)
block|{
name|xfs_dir_leaf_hdr_t
modifier|*
name|h
decl_stmt|;
name|xfs_da_blkinfo_t
modifier|*
name|i
decl_stmt|;
name|xfs_dir_leaf_map_t
modifier|*
name|m
decl_stmt|;
name|xfs_dir_leaf_entry_t
modifier|*
name|e
decl_stmt|;
name|xfs_dir_leaf_name_t
modifier|*
name|n
decl_stmt|;
name|int
name|j
decl_stmt|,
name|k
decl_stmt|;
name|xfs_ino_t
name|ino
decl_stmt|;
name|h
operator|=
operator|&
name|leaf
operator|->
name|hdr
expr_stmt|;
name|i
operator|=
operator|&
name|h
operator|->
name|info
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr info forw 0x%x back 0x%x magic 0x%x\n"
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|forw
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|back
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr count %d namebytes %d firstused %d holes %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|namebytes
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|firstused
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|h
operator|->
name|holes
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|m
operator|=
name|h
operator|->
name|freemap
init|;
name|j
operator|<
name|XFS_DIR_LEAF_MAPSIZE
condition|;
name|j
operator|++
operator|,
name|m
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"hdr freemap %d base %d size %d\n"
argument_list|,
name|j
argument_list|,
name|INT_GET
argument_list|(
name|m
operator|->
name|base
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|m
operator|->
name|size
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|e
operator|=
name|leaf
operator|->
name|entries
init|;
name|j
operator|<
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|j
operator|++
operator|,
name|e
operator|++
control|)
block|{
name|n
operator|=
name|XFS_DIR_LEAF_NAMESTRUCT
argument_list|(
name|leaf
argument_list|,
name|INT_GET
argument_list|(
name|e
operator|->
name|nameidx
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|XFS_DIR_SF_GET_DIRINO
argument_list|(
operator|&
name|n
operator|->
name|inumber
argument_list|,
operator|&
name|ino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"leaf %d hashval 0x%x nameidx %d inumber %llu "
argument_list|,
name|j
argument_list|,
operator|(
name|uint_t
operator|)
name|INT_GET
argument_list|(
name|e
operator|->
name|hashval
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|e
operator|->
name|nameidx
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"namelen %d name \""
argument_list|,
name|e
operator|->
name|namelen
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|e
operator|->
name|namelen
condition|;
name|k
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|n
operator|->
name|name
index|[
name|k
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print a directory v2 data block, single or multiple.  */
end_comment

begin_function
specifier|static
name|void
name|xfs_dir2data
parameter_list|(
name|void
modifier|*
name|addr
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|xfs_dir2_data_t
modifier|*
name|db
decl_stmt|;
name|xfs_dir2_block_t
modifier|*
name|bb
decl_stmt|;
name|xfs_dir2_data_hdr_t
modifier|*
name|h
decl_stmt|;
name|xfs_dir2_data_free_t
modifier|*
name|m
decl_stmt|;
name|xfs_dir2_data_entry_t
modifier|*
name|e
decl_stmt|;
name|xfs_dir2_data_unused_t
modifier|*
name|u
decl_stmt|;
name|xfs_dir2_leaf_entry_t
modifier|*
name|l
init|=
name|NULL
decl_stmt|;
name|int
name|j
decl_stmt|,
name|k
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|char
modifier|*
name|t
decl_stmt|;
name|xfs_dir2_block_tail_t
modifier|*
name|tail
init|=
name|NULL
decl_stmt|;
name|db
operator|=
operator|(
name|xfs_dir2_data_t
operator|*
operator|)
name|addr
expr_stmt|;
name|bb
operator|=
operator|(
name|xfs_dir2_block_t
operator|*
operator|)
name|addr
expr_stmt|;
name|h
operator|=
operator|&
name|db
operator|->
name|hdr
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr magic 0x%x (%s)\nhdr bestfree"
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_DATA_MAGIC
condition|?
literal|"DATA"
else|:
operator|(
name|INT_GET
argument_list|(
name|h
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_BLOCK_MAGIC
condition|?
literal|"BLOCK"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|m
operator|=
name|h
operator|->
name|bestfree
init|;
name|j
operator|<
name|XFS_DIR2_DATA_FD_COUNT
condition|;
name|j
operator|++
operator|,
name|m
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|" %d: 0x%x@0x%x"
argument_list|,
name|j
argument_list|,
name|INT_GET
argument_list|(
name|m
operator|->
name|length
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|m
operator|->
name|offset
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|INT_GET
argument_list|(
name|h
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_DATA_MAGIC
condition|)
name|t
operator|=
operator|(
name|char
operator|*
operator|)
name|db
operator|+
name|size
expr_stmt|;
else|else
block|{
comment|/* XFS_DIR2_BLOCK_TAIL_P */
name|tail
operator|=
operator|(
name|xfs_dir2_block_tail_t
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|bb
operator|+
name|size
operator|-
sizeof|sizeof
argument_list|(
name|xfs_dir2_block_tail_t
argument_list|)
operator|)
expr_stmt|;
name|l
operator|=
name|XFS_DIR2_BLOCK_LEAF_P
argument_list|(
name|tail
argument_list|)
expr_stmt|;
name|t
operator|=
operator|(
name|char
operator|*
operator|)
name|l
expr_stmt|;
block|}
for|for
control|(
name|p
operator|=
operator|(
name|char
operator|*
operator|)
operator|(
name|h
operator|+
literal|1
operator|)
init|;
name|p
operator|<
name|t
condition|;
control|)
block|{
name|u
operator|=
operator|(
name|xfs_dir2_data_unused_t
operator|*
operator|)
name|p
expr_stmt|;
if|if
condition|(
name|u
operator|->
name|freetag
operator|==
name|XFS_DIR2_DATA_FREE_TAG
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"0x%lx unused freetag 0x%x length 0x%x tag 0x%x\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|p
operator|-
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|u
operator|->
name|freetag
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|u
operator|->
name|length
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
operator|*
name|XFS_DIR2_DATA_UNUSED_TAG_P
argument_list|(
name|u
argument_list|)
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|+=
name|INT_GET
argument_list|(
name|u
operator|->
name|length
argument_list|,
name|ARCH_CONVERT
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|e
operator|=
operator|(
name|xfs_dir2_data_entry_t
operator|*
operator|)
name|p
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"0x%lx entry inumber %llu namelen %d name \""
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|p
operator|-
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|INT_GET
argument_list|(
name|e
operator|->
name|inumber
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|e
operator|->
name|namelen
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|e
operator|->
name|namelen
condition|;
name|k
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|e
operator|->
name|name
index|[
name|k
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\" tag 0x%x\n"
argument_list|,
name|INT_GET
argument_list|(
operator|*
name|XFS_DIR2_DATA_ENTRY_TAG_P
argument_list|(
name|e
argument_list|)
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|+=
name|XFS_DIR2_DATA_ENTSIZE
argument_list|(
name|e
operator|->
name|namelen
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|INT_GET
argument_list|(
name|h
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_DATA_MAGIC
condition|)
return|return;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INT_GET
argument_list|(
name|tail
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|j
operator|++
operator|,
name|l
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"0x%lx leaf %d hashval 0x%x address 0x%x (byte 0x%x)\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
name|char
operator|*
operator|)
name|l
operator|-
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|)
argument_list|,
name|j
argument_list|,
operator|(
name|uint_t
operator|)
name|INT_GET
argument_list|(
name|l
operator|->
name|hashval
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|l
operator|->
name|address
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
comment|/* XFS_DIR2_DATAPTR_TO_BYTE */
name|INT_GET
argument_list|(
name|l
operator|->
name|address
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|<<
name|XFS_DIR2_DATA_ALIGN_LOG
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"0x%lx tail count %d\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tail
operator|-
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|tail
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfs_dir2leaf
parameter_list|(
name|xfs_dir2_leaf_t
modifier|*
name|leaf
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|xfs_dir2_leaf_hdr_t
modifier|*
name|h
decl_stmt|;
name|xfs_da_blkinfo_t
modifier|*
name|i
decl_stmt|;
name|xfs_dir2_leaf_entry_t
modifier|*
name|e
decl_stmt|;
name|xfs_dir2_data_off_t
modifier|*
name|b
decl_stmt|;
name|xfs_dir2_leaf_tail_t
modifier|*
name|t
decl_stmt|;
name|int
name|j
decl_stmt|;
name|h
operator|=
operator|&
name|leaf
operator|->
name|hdr
expr_stmt|;
name|i
operator|=
operator|&
name|h
operator|->
name|info
expr_stmt|;
name|e
operator|=
name|leaf
operator|->
name|ents
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr info forw 0x%x back 0x%x magic 0x%x\n"
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|forw
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|back
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|i
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr count %d stale %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|h
operator|->
name|stale
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INT_GET
argument_list|(
name|h
operator|->
name|count
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|j
operator|++
operator|,
name|e
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"0x%lx ent %d hashval 0x%x address 0x%x (byte 0x%x)\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
name|char
operator|*
operator|)
name|e
operator|-
operator|(
name|char
operator|*
operator|)
name|leaf
argument_list|)
argument_list|,
name|j
argument_list|,
operator|(
name|uint_t
operator|)
name|INT_GET
argument_list|(
name|e
operator|->
name|hashval
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|e
operator|->
name|address
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
comment|/* XFS_DIR2_DATAPTR_TO_BYTE */
name|INT_GET
argument_list|(
name|e
operator|->
name|address
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|<<
name|XFS_DIR2_DATA_ALIGN_LOG
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|INT_GET
argument_list|(
name|i
operator|->
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
operator|==
name|XFS_DIR2_LEAFN_MAGIC
condition|)
return|return;
comment|/* XFS_DIR2_LEAF_TAIL_P */
name|t
operator|=
operator|(
name|xfs_dir2_leaf_tail_t
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|leaf
operator|+
name|size
operator|-
sizeof|sizeof
argument_list|(
operator|*
name|t
argument_list|)
operator|)
expr_stmt|;
name|b
operator|=
name|XFS_DIR2_LEAF_BESTS_P
argument_list|(
name|t
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INT_GET
argument_list|(
name|t
operator|->
name|bestcount
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|j
operator|++
operator|,
name|b
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"0x%lx best %d 0x%x\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
name|char
operator|*
operator|)
name|b
operator|-
operator|(
name|char
operator|*
operator|)
name|leaf
argument_list|)
argument_list|,
name|j
argument_list|,
name|INT_GET
argument_list|(
operator|*
name|b
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"tail bestcount %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|t
operator|->
name|bestcount
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a shortform directory.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdirsf
parameter_list|(
name|xfs_dir_shortform_t
modifier|*
name|s
parameter_list|)
block|{
name|xfs_dir_sf_hdr_t
modifier|*
name|sfh
decl_stmt|;
name|xfs_dir_sf_entry_t
modifier|*
name|sfe
decl_stmt|;
name|xfs_ino_t
name|ino
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|sfh
operator|=
operator|&
name|s
operator|->
name|hdr
expr_stmt|;
name|XFS_DIR_SF_GET_DIRINO
argument_list|(
operator|&
name|sfh
operator|->
name|parent
argument_list|,
operator|&
name|ino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr parent %llu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" count %d\n"
argument_list|,
name|sfh
operator|->
name|count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|sfe
operator|=
name|s
operator|->
name|list
init|;
name|i
operator|<
name|sfh
operator|->
name|count
condition|;
name|i
operator|++
control|)
block|{
name|XFS_DIR_SF_GET_DIRINO
argument_list|(
operator|&
name|sfe
operator|->
name|inumber
argument_list|,
operator|&
name|ino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"entry %d inumber %llu"
argument_list|,
name|i
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" namelen %d name \""
argument_list|,
name|sfe
operator|->
name|namelen
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|sfe
operator|->
name|namelen
condition|;
name|j
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|sfe
operator|->
name|name
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
name|sfe
operator|=
name|XFS_DIR_SF_NEXTENTRY
argument_list|(
name|sfe
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print a shortform v2 directory.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdir2sf
parameter_list|(
name|xfs_dir2_sf_t
modifier|*
name|s
parameter_list|)
block|{
name|xfs_dir2_sf_hdr_t
modifier|*
name|sfh
decl_stmt|;
name|xfs_dir2_sf_entry_t
modifier|*
name|sfe
decl_stmt|;
name|xfs_ino_t
name|ino
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|sfh
operator|=
operator|&
name|s
operator|->
name|hdr
expr_stmt|;
name|ino
operator|=
name|XFS_DIR2_SF_GET_INUMBER
argument_list|(
name|s
argument_list|,
operator|&
name|sfh
operator|->
name|parent
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr count %d i8count %d parent %llu\n"
argument_list|,
name|sfh
operator|->
name|count
argument_list|,
name|sfh
operator|->
name|i8count
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|sfe
operator|=
name|XFS_DIR2_SF_FIRSTENTRY
argument_list|(
name|s
argument_list|)
init|;
name|i
operator|<
name|sfh
operator|->
name|count
condition|;
name|i
operator|++
control|)
block|{
name|ino
operator|=
name|XFS_DIR2_SF_GET_INUMBER
argument_list|(
name|s
argument_list|,
name|XFS_DIR2_SF_INUMBERP
argument_list|(
name|sfe
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"entry %d inumber %llu offset 0x%x namelen %d name \""
argument_list|,
name|i
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ino
argument_list|,
name|XFS_DIR2_SF_GET_OFFSET
argument_list|(
name|sfe
argument_list|)
argument_list|,
name|sfe
operator|->
name|namelen
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|sfe
operator|->
name|namelen
condition|;
name|j
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%c"
argument_list|,
name|sfe
operator|->
name|name
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
name|sfe
operator|=
name|XFS_DIR2_SF_NEXTENTRY
argument_list|(
name|s
argument_list|,
name|sfe
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print a node-form v2 directory freemap block.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdir2free
parameter_list|(
name|xfs_dir2_free_t
modifier|*
name|f
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"hdr magic 0x%x firstdb %d nvalid %d nused %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|f
operator|->
name|hdr
operator|.
name|magic
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|f
operator|->
name|hdr
operator|.
name|firstdb
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|f
operator|->
name|hdr
operator|.
name|nvalid
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|f
operator|->
name|hdr
operator|.
name|nused
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INT_GET
argument_list|(
name|f
operator|->
name|hdr
operator|.
name|nvalid
argument_list|,
name|ARCH_CONVERT
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"entry %d db %d count %d\n"
argument_list|,
name|i
argument_list|,
name|i
operator|+
name|INT_GET
argument_list|(
name|f
operator|->
name|hdr
operator|.
name|firstdb
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|f
operator|->
name|bests
index|[
name|i
index|]
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the last "count" entries in the directory trace buffer.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdirtrace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_dir_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs directory trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_dir_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_dir_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_dir_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_dir_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_dir_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
end_ifdef

begin_comment
comment|/*  * Print out the last "count" entries in the directory v2 trace buffer.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdir2atrace
parameter_list|(
name|int
name|count
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|int
name|nentries
decl_stmt|;
name|int
name|skip_entries
decl_stmt|;
if|if
condition|(
name|xfs_dir2_trace_buf
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs dirv2 trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nentries
operator|=
name|ktrace_nentries
argument_list|(
name|xfs_dir2_trace_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
operator|-
literal|1
condition|)
block|{
name|count
operator|=
name|nentries
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|count
operator|<=
literal|0
operator|)
operator|||
operator|(
name|count
operator|>
name|nentries
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Invalid count.  There are %d entries.\n"
argument_list|,
name|nentries
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|xfs_dir2_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
name|nentries
condition|)
block|{
comment|/* 		 * Skip the total minus the number to look at minus one 		 * for the entry returned by ktrace_first(). 		 */
name|skip_entries
operator|=
name|nentries
operator|-
name|count
operator|-
literal|1
expr_stmt|;
name|ktep
operator|=
name|ktrace_skip
argument_list|(
name|xfs_dir2_trace_buf
argument_list|,
name|skip_entries
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
if|if
condition|(
name|ktep
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"Skipped them all\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_dir2_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|xfs_dir2_trace_buf
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out the directory v2 trace buffer attached to the given inode.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xdir2itrace
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|ip
operator|->
name|i_dir_trace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The inode trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|ip
operator|->
name|i_dir_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfs_dir2_trace_entry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|ip
operator|->
name|i_dir_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print xfs extent records.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xexlist
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|xfs_xexlist_fork
argument_list|(
name|ip
argument_list|,
name|XFS_DATA_FORK
argument_list|)
expr_stmt|;
if|if
condition|(
name|XFS_IFORK_Q
argument_list|(
name|ip
argument_list|)
condition|)
name|xfs_xexlist_fork
argument_list|(
name|ip
argument_list|,
name|XFS_ATTR_FORK
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an xfs free-extent records.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xflist
parameter_list|(
name|xfs_bmap_free_t
modifier|*
name|flist
parameter_list|)
block|{
name|xfs_bmap_free_item_t
modifier|*
name|item
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"flist@0x%p: first 0x%p count %d low %d\n"
argument_list|,
name|flist
argument_list|,
name|flist
operator|->
name|xbf_first
argument_list|,
name|flist
operator|->
name|xbf_count
argument_list|,
name|flist
operator|->
name|xbf_low
argument_list|)
expr_stmt|;
for|for
control|(
name|item
operator|=
name|flist
operator|->
name|xbf_first
init|;
name|item
condition|;
name|item
operator|=
name|item
operator|->
name|xbfi_next
control|)
block|{
name|kdb_printf
argument_list|(
literal|"item@0x%p: startblock %Lx blockcount %d"
argument_list|,
name|item
argument_list|,
operator|(
name|xfs_dfsbno_t
operator|)
name|item
operator|->
name|xbfi_startblock
argument_list|,
name|item
operator|->
name|xbfi_blockcount
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out the help messages for these functions.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xhelp
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|xif
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|xfsidbg_funcs
init|;
name|p
operator|->
name|name
condition|;
name|p
operator|++
control|)
name|kdb_printf
argument_list|(
literal|"%-16s %s %s\n"
argument_list|,
name|p
operator|->
name|name
argument_list|,
name|p
operator|->
name|args
argument_list|,
name|p
operator|->
name|help
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print out an XFS in-core log structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xiclog
parameter_list|(
name|xlog_in_core_t
modifier|*
name|iclog
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
specifier|static
name|char
modifier|*
name|ic_flags
index|[]
init|=
block|{
literal|"ACTIVE"
block|,
comment|/* 0x0001 */
literal|"WANT_SYNC"
block|,
comment|/* 0x0002 */
literal|"SYNCING"
block|,
comment|/* 0X0004 */
literal|"DONE_SYNC"
block|,
comment|/* 0X0008 */
literal|"DO_CALLBACK"
block|,
comment|/* 0X0010 */
literal|"CALLBACK"
block|,
comment|/* 0X0020 */
literal|"DIRTY"
block|,
comment|/* 0X0040 */
literal|"IOERROR"
block|,
comment|/* 0X0080 */
literal|"NOTUSED"
block|,
comment|/* 0X8000 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xlog_in_core/header at 0x%p/0x%p\n"
argument_list|,
name|iclog
argument_list|,
name|iclog
operator|->
name|hic_data
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"magicno: %x  cycle: %d  version: %d  lsn: 0x%Lx\n"
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_magicno
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_cycle
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_version
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_lsn
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"tail_lsn: 0x%Lx  len: %d  prev_block: %d  num_ops: %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_tail_lsn
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_len
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_prev_block
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_num_logops
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"cycle_data: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|iclog
operator|->
name|ic_size
operator|>>
name|BBSHIFT
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"%x  "
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_cycle_data
index|[
name|i
index|]
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"size: %d\n"
argument_list|,
name|INT_GET
argument_list|(
name|iclog
operator|->
name|ic_header
operator|.
name|h_size
argument_list|,
name|ARCH_CONVERT
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"--------------------------------------------------\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"data: 0x%p&forcesema: 0x%p  next: 0x%p bp: 0x%p\n"
argument_list|,
name|iclog
operator|->
name|ic_datap
argument_list|,
operator|&
name|iclog
operator|->
name|ic_forcesema
argument_list|,
name|iclog
operator|->
name|ic_next
argument_list|,
name|iclog
operator|->
name|ic_bp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"log: 0x%p  callb: 0x%p  callb_tail: 0x%p\n"
argument_list|,
name|iclog
operator|->
name|ic_log
argument_list|,
name|iclog
operator|->
name|ic_callback
argument_list|,
name|iclog
operator|->
name|ic_callback_tail
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"size: %d (OFFSET: %d) trace: 0x%p refcnt: %d bwritecnt: %d"
argument_list|,
name|iclog
operator|->
name|ic_size
argument_list|,
name|iclog
operator|->
name|ic_offset
argument_list|,
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
name|iclog
operator|->
name|ic_trace
argument_list|,
else|#
directive|else
name|NULL
argument_list|,
endif|#
directive|endif
name|iclog
operator|->
name|ic_refcnt
argument_list|,
name|iclog
operator|->
name|ic_bwritecnt
argument_list|)
expr_stmt|;
if|if
condition|(
name|iclog
operator|->
name|ic_state
operator|&
name|XLOG_STATE_ALL
condition|)
name|printflags
argument_list|(
name|iclog
operator|->
name|ic_state
argument_list|,
name|ic_flags
argument_list|,
literal|" state:"
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|" state: INVALID 0x%x"
argument_list|,
name|iclog
operator|->
name|ic_state
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* xfsidbg_xiclog */
end_comment

begin_comment
comment|/*  * Print all incore logs.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xiclogall
parameter_list|(
name|xlog_in_core_t
modifier|*
name|iclog
parameter_list|)
block|{
name|xlog_in_core_t
modifier|*
name|first_iclog
init|=
name|iclog
decl_stmt|;
do|do
block|{
name|xfsidbg_xiclog
argument_list|(
name|iclog
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"=================================================\n"
argument_list|)
expr_stmt|;
name|iclog
operator|=
name|iclog
operator|->
name|ic_next
expr_stmt|;
block|}
do|while
condition|(
name|iclog
operator|!=
name|first_iclog
condition|)
do|;
block|}
end_function

begin_comment
comment|/* xfsidbg_xiclogall */
end_comment

begin_comment
comment|/*  * Print out the callback structures attached to an iclog.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xiclogcb
parameter_list|(
name|xlog_in_core_t
modifier|*
name|iclog
parameter_list|)
block|{
name|xfs_log_callback_t
modifier|*
name|cb
decl_stmt|;
name|kdb_symtab_t
name|symtab
decl_stmt|;
for|for
control|(
name|cb
operator|=
name|iclog
operator|->
name|ic_callback
init|;
name|cb
operator|!=
name|NULL
condition|;
name|cb
operator|=
name|cb
operator|->
name|cb_next
control|)
block|{
if|if
condition|(
name|kdbnearsym
argument_list|(
operator|(
name|unsigned
name|long
operator|)
name|cb
operator|->
name|cb_func
argument_list|,
operator|&
name|symtab
argument_list|)
condition|)
block|{
name|unsigned
name|long
name|offval
decl_stmt|;
name|offval
operator|=
operator|(
name|unsigned
name|long
operator|)
name|cb
operator|->
name|cb_func
operator|-
name|symtab
operator|.
name|sym_start
expr_stmt|;
if|if
condition|(
name|offval
condition|)
name|kdb_printf
argument_list|(
literal|"func = %s+0x%lx"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|,
name|offval
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"func = %s"
argument_list|,
name|symtab
operator|.
name|sym_name
argument_list|)
expr_stmt|;
block|}
else|else
name|kdb_printf
argument_list|(
literal|"func = ?? 0x%p"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|cb
operator|->
name|cb_func
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" arg 0x%p next 0x%p\n"
argument_list|,
name|cb
operator|->
name|cb_arg
argument_list|,
name|cb
operator|->
name|cb_next
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
end_ifdef

begin_comment
comment|/*  * Print trace from incore log.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xiclogtrace
parameter_list|(
name|xlog_in_core_t
modifier|*
name|iclog
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|ktrace_t
modifier|*
name|kt
init|=
name|iclog
operator|->
name|ic_trace
decl_stmt|;
name|qprintf
argument_list|(
literal|"iclog->ic_trace 0x%p\n"
argument_list|,
name|kt
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|kt
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
switch|switch
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|XLOG_TRACE_GRAB_FLUSH
case|:
block|{
name|qprintf
argument_list|(
literal|"grabbing semaphore\n"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|XLOG_TRACE_REL_FLUSH
case|:
block|{
name|qprintf
argument_list|(
literal|"releasing semaphore\n"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|XLOG_TRACE_SLEEP_FLUSH
case|:
block|{
name|qprintf
argument_list|(
literal|"sleeping on semaphore\n"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|XLOG_TRACE_WAKE_FLUSH
case|:
block|{
name|qprintf
argument_list|(
literal|"waking up on semaphore\n"
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{ 		    }
block|}
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|kt
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* xfsidbg_xiclogtrace */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print all of the inodes attached to the given mount structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xinodes
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xfs_mount at 0x%p\n"
argument_list|,
name|mp
argument_list|)
expr_stmt|;
name|ip
operator|=
name|mp
operator|->
name|m_inodes
expr_stmt|;
if|if
condition|(
name|ip
operator|!=
name|NULL
condition|)
block|{
do|do
block|{
if|if
condition|(
name|ip
operator|->
name|i_mount
operator|==
name|NULL
condition|)
block|{
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
continue|continue;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|xfsidbg_xnode
argument_list|(
name|ip
argument_list|)
expr_stmt|;
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
block|}
do|while
condition|(
name|ip
operator|!=
name|mp
operator|->
name|m_inodes
condition|)
do|;
block|}
name|kdb_printf
argument_list|(
literal|"\nEnd of Inodes\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_delayed_blocks
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
name|unsigned
name|int
name|total
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|icount
init|=
literal|0
decl_stmt|;
name|ip
operator|=
name|mp
operator|->
name|m_inodes
expr_stmt|;
if|if
condition|(
name|ip
operator|!=
name|NULL
condition|)
block|{
do|do
block|{
if|if
condition|(
name|ip
operator|->
name|i_mount
operator|==
name|NULL
condition|)
block|{
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|ip
operator|->
name|i_delayed_blks
condition|)
block|{
name|total
operator|+=
name|ip
operator|->
name|i_delayed_blks
expr_stmt|;
name|icount
operator|++
expr_stmt|;
block|}
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
block|}
do|while
condition|(
name|ip
operator|!=
name|mp
operator|->
name|m_inodes
condition|)
do|;
block|}
name|kdb_printf
argument_list|(
literal|"delayed blocks total: %d in %d inodes\n"
argument_list|,
name|total
argument_list|,
name|icount
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xinodes_quiesce
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xfs_mount at 0x%p\n"
argument_list|,
name|mp
argument_list|)
expr_stmt|;
name|ip
operator|=
name|mp
operator|->
name|m_inodes
expr_stmt|;
if|if
condition|(
name|ip
operator|!=
name|NULL
condition|)
block|{
do|do
block|{
if|if
condition|(
name|ip
operator|->
name|i_mount
operator|==
name|NULL
condition|)
block|{
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|!
operator|(
name|ip
operator|->
name|i_flags
operator|&
name|XFS_IQUIESCE
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"ip 0x%p not quiesced\n"
argument_list|,
name|ip
argument_list|)
expr_stmt|;
block|}
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
block|}
do|while
condition|(
name|ip
operator|!=
name|mp
operator|->
name|m_inodes
condition|)
do|;
block|}
name|kdb_printf
argument_list|(
literal|"\nEnd of Inodes\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|xfsidbg_get_cstate
parameter_list|(
name|int
name|state
parameter_list|)
block|{
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|XLOG_STATE_COVER_IDLE
case|:
return|return
operator|(
literal|"idle"
operator|)
return|;
case|case
name|XLOG_STATE_COVER_NEED
case|:
return|return
operator|(
literal|"need"
operator|)
return|;
case|case
name|XLOG_STATE_COVER_DONE
case|:
return|return
operator|(
literal|"done"
operator|)
return|;
case|case
name|XLOG_STATE_COVER_NEED2
case|:
return|return
operator|(
literal|"need2"
operator|)
return|;
case|case
name|XLOG_STATE_COVER_DONE2
case|:
return|return
operator|(
literal|"done2"
operator|)
return|;
default|default:
return|return
operator|(
literal|"unknown"
operator|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out an XFS log structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog
parameter_list|(
name|xlog_t
modifier|*
name|log
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|t_flags
index|[]
init|=
block|{
literal|"CHKSUM_MISMATCH"
block|,
comment|/* 0x01 */
literal|"ACTIVE_RECOVERY"
block|,
comment|/* 0x02 */
literal|"RECOVERY_NEEDED"
block|,
comment|/* 0x04 */
literal|"IO_ERROR"
block|,
comment|/* 0x08 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xlog at 0x%p\n"
argument_list|,
name|log
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"&flushsm: 0x%p  flushcnt: %d tic_cnt: %d	 tic_tcnt: %d  \n"
argument_list|,
operator|&
name|log
operator|->
name|l_flushsema
argument_list|,
name|log
operator|->
name|l_flushcnt
argument_list|,
name|log
operator|->
name|l_ticket_cnt
argument_list|,
name|log
operator|->
name|l_ticket_tcnt
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"freelist: 0x%p  tail: 0x%p	ICLOG: 0x%p  \n"
argument_list|,
name|log
operator|->
name|l_freelist
argument_list|,
name|log
operator|->
name|l_tail
argument_list|,
name|log
operator|->
name|l_iclog
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"&icloglock: 0x%p  tail_lsn: %s  last_sync_lsn: %s \n"
argument_list|,
operator|&
name|log
operator|->
name|l_icloglock
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
name|log
operator|->
name|l_tail_lsn
argument_list|)
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
name|log
operator|->
name|l_last_sync_lsn
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"mp: 0x%p  xbuf: 0x%p  l_covered_state: %s \n"
argument_list|,
name|log
operator|->
name|l_mp
argument_list|,
name|log
operator|->
name|l_xbuf
argument_list|,
name|xfsidbg_get_cstate
argument_list|(
name|log
operator|->
name|l_covered_state
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"flags: "
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|log
operator|->
name|l_flags
argument_list|,
name|t_flags
argument_list|,
literal|"log"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  logBBstart: %lld logsize: %d logBBsize: %d\n"
argument_list|,
operator|(
name|long
name|long
operator|)
name|log
operator|->
name|l_logBBstart
argument_list|,
name|log
operator|->
name|l_logsize
argument_list|,
name|log
operator|->
name|l_logBBsize
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"curr_cycle: %d  prev_cycle: %d  curr_block: %d  prev_block: %d\n"
argument_list|,
name|log
operator|->
name|l_curr_cycle
argument_list|,
name|log
operator|->
name|l_prev_cycle
argument_list|,
name|log
operator|->
name|l_curr_block
argument_list|,
name|log
operator|->
name|l_prev_block
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"iclog_bak: 0x%p  iclog_size: 0x%x (%d)  num iclogs: %d\n"
argument_list|,
name|log
operator|->
name|l_iclog_bak
argument_list|,
name|log
operator|->
name|l_iclog_size
argument_list|,
name|log
operator|->
name|l_iclog_size
argument_list|,
name|log
operator|->
name|l_iclog_bufs
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"l_iclog_hsize %d l_iclog_heads %d\n"
argument_list|,
name|log
operator|->
name|l_iclog_hsize
argument_list|,
name|log
operator|->
name|l_iclog_heads
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"l_sectbb_log %u l_sectbb_mask %u\n"
argument_list|,
name|log
operator|->
name|l_sectbb_log
argument_list|,
name|log
operator|->
name|l_sectbb_mask
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"&grant_lock: 0x%p  resHeadQ: 0x%p  wrHeadQ: 0x%p\n"
argument_list|,
operator|&
name|log
operator|->
name|l_grant_lock
argument_list|,
name|log
operator|->
name|l_reserve_headq
argument_list|,
name|log
operator|->
name|l_write_headq
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"GResCycle: %d  GResBytes: %d  GWrCycle: %d  GWrBytes: %d\n"
argument_list|,
name|log
operator|->
name|l_grant_reserve_cycle
argument_list|,
name|log
operator|->
name|l_grant_reserve_bytes
argument_list|,
name|log
operator|->
name|l_grant_write_cycle
argument_list|,
name|log
operator|->
name|l_grant_write_bytes
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"GResBlocks: %d GResRemain: %d  GWrBlocks: %d GWrRemain: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|BTOBBT
argument_list|(
name|log
operator|->
name|l_grant_reserve_bytes
argument_list|)
argument_list|,
name|log
operator|->
name|l_grant_reserve_bytes
operator|%
name|BBSIZE
argument_list|,
operator|(
name|int
operator|)
name|BTOBBT
argument_list|(
name|log
operator|->
name|l_grant_write_bytes
argument_list|)
argument_list|,
name|log
operator|->
name|l_grant_write_bytes
operator|%
name|BBSIZE
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
name|qprintf
argument_list|(
literal|"trace: 0x%p  grant_trace: use xlog value\n"
argument_list|,
name|log
operator|->
name|l_trace
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* xfsidbg_xlog */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_print_trans_type
parameter_list|(
name|unsigned
name|int
name|t_type
parameter_list|)
block|{
switch|switch
condition|(
name|t_type
condition|)
block|{
case|case
name|XFS_TRANS_SETATTR_NOT_SIZE
case|:
name|kdb_printf
argument_list|(
literal|"SETATTR_NOT_SIZE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_SETATTR_SIZE
case|:
name|kdb_printf
argument_list|(
literal|"SETATTR_SIZE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_INACTIVE
case|:
name|kdb_printf
argument_list|(
literal|"INACTIVE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_CREATE
case|:
name|kdb_printf
argument_list|(
literal|"CREATE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_CREATE_TRUNC
case|:
name|kdb_printf
argument_list|(
literal|"CREATE_TRUNC"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_TRUNCATE_FILE
case|:
name|kdb_printf
argument_list|(
literal|"TRUNCATE_FILE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_REMOVE
case|:
name|kdb_printf
argument_list|(
literal|"REMOVE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_LINK
case|:
name|kdb_printf
argument_list|(
literal|"LINK"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_RENAME
case|:
name|kdb_printf
argument_list|(
literal|"RENAME"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_MKDIR
case|:
name|kdb_printf
argument_list|(
literal|"MKDIR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_RMDIR
case|:
name|kdb_printf
argument_list|(
literal|"RMDIR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_SYMLINK
case|:
name|kdb_printf
argument_list|(
literal|"SYMLINK"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_SET_DMATTRS
case|:
name|kdb_printf
argument_list|(
literal|"SET_DMATTRS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_GROWFS
case|:
name|kdb_printf
argument_list|(
literal|"GROWFS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_STRAT_WRITE
case|:
name|kdb_printf
argument_list|(
literal|"STRAT_WRITE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_DIOSTRAT
case|:
name|kdb_printf
argument_list|(
literal|"DIOSTRAT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_WRITE_SYNC
case|:
name|kdb_printf
argument_list|(
literal|"WRITE_SYNC"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_WRITEID
case|:
name|kdb_printf
argument_list|(
literal|"WRITEID"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_ADDAFORK
case|:
name|kdb_printf
argument_list|(
literal|"ADDAFORK"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_ATTRINVAL
case|:
name|kdb_printf
argument_list|(
literal|"ATTRINVAL"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_ATRUNCATE
case|:
name|kdb_printf
argument_list|(
literal|"ATRUNCATE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_ATTR_SET
case|:
name|kdb_printf
argument_list|(
literal|"ATTR_SET"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_ATTR_RM
case|:
name|kdb_printf
argument_list|(
literal|"ATTR_RM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_ATTR_FLAG
case|:
name|kdb_printf
argument_list|(
literal|"ATTR_FLAG"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_CLEAR_AGI_BUCKET
case|:
name|kdb_printf
argument_list|(
literal|"CLEAR_AGI_BUCKET"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_SBCHANGE
case|:
name|kdb_printf
argument_list|(
literal|"QM_SBCHANGE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_QUOTAOFF
case|:
name|kdb_printf
argument_list|(
literal|"QM_QUOTAOFF"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_DQALLOC
case|:
name|kdb_printf
argument_list|(
literal|"QM_DQALLOC"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_SETQLIM
case|:
name|kdb_printf
argument_list|(
literal|"QM_SETQLIM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_DQCLUSTER
case|:
name|kdb_printf
argument_list|(
literal|"QM_DQCLUSTER"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_QINOCREATE
case|:
name|kdb_printf
argument_list|(
literal|"QM_QINOCREATE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_QM_QUOTAOFF_END
case|:
name|kdb_printf
argument_list|(
literal|"QM_QOFF_END"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_SB_UNIT
case|:
name|kdb_printf
argument_list|(
literal|"SB_UNIT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_FSYNC_TS
case|:
name|kdb_printf
argument_list|(
literal|"FSYNC_TS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_GROWFSRT_ALLOC
case|:
name|kdb_printf
argument_list|(
literal|"GROWFSRT_ALLOC"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_GROWFSRT_ZERO
case|:
name|kdb_printf
argument_list|(
literal|"GROWFSRT_ZERO"
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_TRANS_GROWFSRT_FREE
case|:
name|kdb_printf
argument_list|(
literal|"GROWFSRT_FREE"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"unknown(0x%x)"
argument_list|,
name|t_type
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_LOG_TRACE
end_ifdef

begin_comment
comment|/*  * Print grant trace for a log.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog_granttrace
parameter_list|(
name|xlog_t
modifier|*
name|log
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
name|ktrace_t
modifier|*
name|kt
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|cnts
decl_stmt|,
name|t_ocnt
decl_stmt|,
name|t_cnt
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|__psint_t
operator|)
name|log
operator|)
operator|==
operator|(
operator|(
name|__psint_t
operator|)
operator|-
literal|1
operator|)
condition|)
block|{
name|qprintf
argument_list|(
literal|"Usage: xl_grtr<log>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|kt
operator|=
name|log
operator|->
name|l_grant_trace
operator|)
condition|)
name|qprintf
argument_list|(
literal|"log->l_grant_trace 0x%p\n"
argument_list|,
name|kt
argument_list|)
expr_stmt|;
else|else
block|{
name|qprintf
argument_list|(
literal|"log->l_grant_trace is empty!\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|kt
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
comment|/* split cnts into two parts: cnt and ocnt */
name|cnts
operator|=
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
expr_stmt|;
name|t_ocnt
operator|=
literal|0xff
operator|&
name|cnts
expr_stmt|;
name|t_cnt
operator|=
name|cnts
operator|>>
literal|8
expr_stmt|;
name|qprintf
argument_list|(
literal|"%d: %s ["
argument_list|,
name|i
operator|++
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|xfsidbg_print_trans_type
argument_list|(
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"]\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  t_ocnt = %lu, t_cnt = %lu, t_curr_res = %lu, "
literal|"t_unit_res = %lu\n"
argument_list|,
name|t_ocnt
argument_list|,
name|t_cnt
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|14
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  tic:0x%p resQ:0x%p wrQ:0x%p "
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|0
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|,
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  GrResC:%ld GrResB:%ld GrWrC:%ld GrWrB:%ld \n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"  HeadC:%ld HeadB:%ld TailC:%ld TailB:%ld\n"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|kt
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* xfsidbg_xlog_granttrace */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print out an XFS recovery transaction  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog_ritem
parameter_list|(
name|xlog_recover_item_t
modifier|*
name|item
parameter_list|)
block|{
name|int
name|i
init|=
name|XLOG_MAX_REGIONS_IN_ITEM
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"(xlog_recover_item 0x%p) "
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"next: 0x%p prev: 0x%p type: %d cnt: %d ttl: %d\n"
argument_list|,
name|item
operator|->
name|ri_next
argument_list|,
name|item
operator|->
name|ri_prev
argument_list|,
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
argument_list|,
name|item
operator|->
name|ri_cnt
argument_list|,
name|item
operator|->
name|ri_total
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
if|if
condition|(
operator|!
name|item
operator|->
name|ri_buf
index|[
name|XLOG_MAX_REGIONS_IN_ITEM
operator|-
name|i
index|]
operator|.
name|i_addr
condition|)
break|break;
name|kdb_printf
argument_list|(
literal|"a: 0x%p l: %d "
argument_list|,
name|item
operator|->
name|ri_buf
index|[
name|XLOG_MAX_REGIONS_IN_ITEM
operator|-
name|i
index|]
operator|.
name|i_addr
argument_list|,
name|item
operator|->
name|ri_buf
index|[
name|XLOG_MAX_REGIONS_IN_ITEM
operator|-
name|i
index|]
operator|.
name|i_len
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* xfsidbg_xlog_ritem */
end_comment

begin_comment
comment|/*  * Print out an XFS recovery transaction  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog_rtrans
parameter_list|(
name|xlog_recover_t
modifier|*
name|trans
parameter_list|)
block|{
name|xlog_recover_item_t
modifier|*
name|rip
decl_stmt|,
modifier|*
name|first_rip
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"(xlog_recover 0x%p) "
argument_list|,
name|trans
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"tid: %x type: %d items: %d ttid: 0x%x  "
argument_list|,
name|trans
operator|->
name|r_log_tid
argument_list|,
name|trans
operator|->
name|r_theader
operator|.
name|th_type
argument_list|,
name|trans
operator|->
name|r_theader
operator|.
name|th_num_items
argument_list|,
name|trans
operator|->
name|r_theader
operator|.
name|th_tid
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"itemq: 0x%p\n"
argument_list|,
name|trans
operator|->
name|r_itemq
argument_list|)
expr_stmt|;
if|if
condition|(
name|trans
operator|->
name|r_itemq
condition|)
block|{
name|rip
operator|=
name|first_rip
operator|=
name|trans
operator|->
name|r_itemq
expr_stmt|;
do|do
block|{
name|kdb_printf
argument_list|(
literal|"(recovery item: 0x%p) "
argument_list|,
name|rip
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"type: %d cnt: %d total: %d\n"
argument_list|,
name|ITEM_TYPE
argument_list|(
name|rip
argument_list|)
argument_list|,
name|rip
operator|->
name|ri_cnt
argument_list|,
name|rip
operator|->
name|ri_total
argument_list|)
expr_stmt|;
name|rip
operator|=
name|rip
operator|->
name|ri_next
expr_stmt|;
block|}
do|while
condition|(
name|rip
operator|!=
name|first_rip
condition|)
do|;
block|}
block|}
end_function

begin_comment
comment|/* xfsidbg_xlog_rtrans */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog_buf_logitem
parameter_list|(
name|xlog_recover_item_t
modifier|*
name|item
parameter_list|)
block|{
name|xfs_buf_log_format_t
modifier|*
name|buf_f
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|bit
decl_stmt|;
name|int
name|nbits
decl_stmt|;
name|unsigned
name|int
modifier|*
name|data_map
decl_stmt|;
name|unsigned
name|int
name|map_size
decl_stmt|;
name|int
name|size
decl_stmt|;
name|buf_f
operator|=
operator|(
name|xfs_buf_log_format_t
operator|*
operator|)
name|item
operator|->
name|ri_buf
index|[
literal|0
index|]
operator|.
name|i_addr
expr_stmt|;
if|if
condition|(
name|buf_f
operator|->
name|blf_flags
operator|&
name|XFS_BLI_INODE_BUF
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"\tINODE BUF<blkno=0x%Lx, len=0x%x>\n"
argument_list|,
name|buf_f
operator|->
name|blf_blkno
argument_list|,
name|buf_f
operator|->
name|blf_len
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|buf_f
operator|->
name|blf_flags
operator|&
operator|(
name|XFS_BLI_UDQUOT_BUF
operator||
name|XFS_BLI_PDQUOT_BUF
operator||
name|XFS_BLI_GDQUOT_BUF
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"\tDQUOT BUF<blkno=0x%Lx, len=0x%x>\n"
argument_list|,
name|buf_f
operator|->
name|blf_blkno
argument_list|,
name|buf_f
operator|->
name|blf_len
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|data_map
operator|=
name|buf_f
operator|->
name|blf_data_map
expr_stmt|;
name|map_size
operator|=
name|buf_f
operator|->
name|blf_map_size
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\tREG BUF<blkno=0x%Lx, len=0x%x map 0x%p size %d>\n"
argument_list|,
name|buf_f
operator|->
name|blf_blkno
argument_list|,
name|buf_f
operator|->
name|blf_len
argument_list|,
name|data_map
argument_list|,
name|map_size
argument_list|)
expr_stmt|;
name|bit
operator|=
literal|0
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
comment|/* 0 is the buf format structure */
while|while
condition|(
literal|1
condition|)
block|{
name|bit
operator|=
name|xfs_next_bit
argument_list|(
name|data_map
argument_list|,
name|map_size
argument_list|,
name|bit
argument_list|)
expr_stmt|;
if|if
condition|(
name|bit
operator|==
operator|-
literal|1
condition|)
break|break;
name|nbits
operator|=
name|xfs_contig_bits
argument_list|(
name|data_map
argument_list|,
name|map_size
argument_list|,
name|bit
argument_list|)
expr_stmt|;
name|size
operator|=
operator|(
operator|(
name|uint
operator|)
name|bit
operator|<<
name|XFS_BLI_SHIFT
operator|)
operator|+
operator|(
name|nbits
operator|<<
name|XFS_BLI_SHIFT
operator|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\t\tlogbuf.i_addr 0x%p, size 0x%x\n"
argument_list|,
name|item
operator|->
name|ri_buf
index|[
name|i
index|]
operator|.
name|i_addr
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\t\t\t\""
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
operator|&&
name|j
operator|<
name|size
condition|;
name|j
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"%02x"
argument_list|,
operator|(
operator|(
name|char
operator|*
operator|)
name|item
operator|->
name|ri_buf
index|[
name|i
index|]
operator|.
name|i_addr
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"...\"\n"
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
name|bit
operator|+=
name|nbits
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print out an ENTIRE XFS recovery transaction  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog_rtrans_entire
parameter_list|(
name|xlog_recover_t
modifier|*
name|trans
parameter_list|)
block|{
name|xlog_recover_item_t
modifier|*
name|item
decl_stmt|,
modifier|*
name|first_rip
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"(Recovering Xact 0x%p) "
argument_list|,
name|trans
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"tid: %x type: %d nitems: %d ttid: 0x%x  "
argument_list|,
name|trans
operator|->
name|r_log_tid
argument_list|,
name|trans
operator|->
name|r_theader
operator|.
name|th_type
argument_list|,
name|trans
operator|->
name|r_theader
operator|.
name|th_num_items
argument_list|,
name|trans
operator|->
name|r_theader
operator|.
name|th_tid
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"itemq: 0x%p\n"
argument_list|,
name|trans
operator|->
name|r_itemq
argument_list|)
expr_stmt|;
if|if
condition|(
name|trans
operator|->
name|r_itemq
condition|)
block|{
name|item
operator|=
name|first_rip
operator|=
name|trans
operator|->
name|r_itemq
expr_stmt|;
do|do
block|{
comment|/* 			   kdb_printf("(recovery item: 0x%x) ", item); 			   kdb_printf("type: %d cnt: %d total: %d\n", 				   item->ri_type, item->ri_cnt, item->ri_total); 				   */
if|if
condition|(
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_BUF
operator|)
operator|||
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_6_1_BUF
operator|)
operator|||
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_5_3_BUF
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"BUF:"
argument_list|)
expr_stmt|;
name|xfsidbg_xlog_buf_logitem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_INODE
operator|)
operator|||
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_6_1_INODE
operator|)
operator|||
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_5_3_INODE
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"INODE:\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_EFI
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"EFI:\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_EFD
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"EFD:\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_DQUOT
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"DQUOT:\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
operator|==
name|XFS_LI_QUOTAOFF
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"QUOTAOFF:\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|kdb_printf
argument_list|(
literal|"UNKNOWN LOGITEM 0x%x\n"
argument_list|,
name|ITEM_TYPE
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|item
operator|=
name|item
operator|->
name|ri_next
expr_stmt|;
block|}
do|while
condition|(
name|item
operator|!=
name|first_rip
condition|)
do|;
block|}
block|}
end_function

begin_comment
comment|/* xfsidbg_xlog_rtrans */
end_comment

begin_comment
comment|/*  * Print out an XFS ticket structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlog_tic
parameter_list|(
name|xlog_ticket_t
modifier|*
name|tic
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|t_flags
index|[]
init|=
block|{
literal|"INIT"
block|,
comment|/* 0x1 */
literal|"PERM_RES"
block|,
comment|/* 0x2 */
literal|"IN_Q"
block|,
comment|/* 0x4 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xlog_ticket at 0x%p\n"
argument_list|,
name|tic
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"next: 0x%p  prev: 0x%p  tid: 0x%x  \n"
argument_list|,
name|tic
operator|->
name|t_next
argument_list|,
name|tic
operator|->
name|t_prev
argument_list|,
name|tic
operator|->
name|t_tid
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"curr_res: %d  unit_res: %d  ocnt: %d  cnt: %d\n"
argument_list|,
name|tic
operator|->
name|t_curr_res
argument_list|,
name|tic
operator|->
name|t_unit_res
argument_list|,
operator|(
name|int
operator|)
name|tic
operator|->
name|t_ocnt
argument_list|,
operator|(
name|int
operator|)
name|tic
operator|->
name|t_cnt
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"clientid: %c  \n"
argument_list|,
name|tic
operator|->
name|t_clientid
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|tic
operator|->
name|t_flags
argument_list|,
name|t_flags
argument_list|,
literal|"ticket"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"trans type: "
argument_list|)
expr_stmt|;
name|xfsidbg_print_trans_type
argument_list|(
name|tic
operator|->
name|t_trans_type
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* xfsidbg_xlog_tic */
end_comment

begin_comment
comment|/*  * Print out a single log item.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xlogitem
parameter_list|(
name|xfs_log_item_t
modifier|*
name|lip
parameter_list|)
block|{
name|xfs_log_item_t
modifier|*
name|bio_lip
decl_stmt|;
specifier|static
name|char
modifier|*
name|lid_type
index|[]
init|=
block|{
literal|"???"
block|,
comment|/* 0 */
literal|"5-3-buf"
block|,
comment|/* 1 */
literal|"5-3-inode"
block|,
comment|/* 2 */
literal|"efi"
block|,
comment|/* 3 */
literal|"efd"
block|,
comment|/* 4 */
literal|"iunlink"
block|,
comment|/* 5 */
literal|"6-1-inode"
block|,
comment|/* 6 */
literal|"6-1-buf"
block|,
comment|/* 7 */
literal|"inode"
block|,
comment|/* 8 */
literal|"buf"
block|,
comment|/* 9 */
literal|"dquot"
block|,
comment|/* 10 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|li_flags
index|[]
init|=
block|{
literal|"in ail"
block|,
comment|/* 0x1 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"type %s mountp 0x%p flags "
argument_list|,
name|lid_type
index|[
name|lip
operator|->
name|li_type
operator|-
name|XFS_LI_5_3_BUF
operator|+
literal|1
index|]
argument_list|,
name|lip
operator|->
name|li_mountp
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
call|(
name|uint
call|)
argument_list|(
name|lip
operator|->
name|li_flags
argument_list|)
argument_list|,
name|li_flags
argument_list|,
literal|"log"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ail forw 0x%p ail back 0x%p lsn %s\ndesc %p ops 0x%p"
argument_list|,
name|lip
operator|->
name|li_ail
operator|.
name|ail_forw
argument_list|,
name|lip
operator|->
name|li_ail
operator|.
name|ail_back
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
operator|(
name|lip
operator|->
name|li_lsn
operator|)
argument_list|)
argument_list|,
name|lip
operator|->
name|li_desc
argument_list|,
name|lip
operator|->
name|li_ops
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" iodonefunc&0x%p\n"
argument_list|,
name|lip
operator|->
name|li_cb
argument_list|)
expr_stmt|;
if|if
condition|(
name|lip
operator|->
name|li_type
operator|==
name|XFS_LI_BUF
condition|)
block|{
name|bio_lip
operator|=
name|lip
operator|->
name|li_bio_list
expr_stmt|;
if|if
condition|(
name|bio_lip
operator|!=
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"iodone list:\n"
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|bio_lip
operator|!=
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"item 0x%p func 0x%p\n"
argument_list|,
name|bio_lip
argument_list|,
name|bio_lip
operator|->
name|li_cb
argument_list|)
expr_stmt|;
name|bio_lip
operator|=
name|bio_lip
operator|->
name|li_bio_list
expr_stmt|;
block|}
block|}
switch|switch
condition|(
name|lip
operator|->
name|li_type
condition|)
block|{
case|case
name|XFS_LI_BUF
case|:
name|xfs_buf_item_print
argument_list|(
operator|(
name|xfs_buf_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_INODE
case|:
name|xfs_inode_item_print
argument_list|(
operator|(
name|xfs_inode_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_EFI
case|:
name|xfs_efi_item_print
argument_list|(
operator|(
name|xfs_efi_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_EFD
case|:
name|xfs_efd_item_print
argument_list|(
operator|(
name|xfs_efd_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_DQUOT
case|:
name|xfs_dquot_item_print
argument_list|(
operator|(
name|xfs_dq_logitem_t
operator|*
operator|)
name|lip
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_QUOTAOFF
case|:
name|xfs_qoff_item_print
argument_list|(
operator|(
name|xfs_qoff_logitem_t
operator|*
operator|)
name|lip
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"Unknown item type %d\n"
argument_list|,
name|lip
operator|->
name|li_type
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*  * Print out a summary of the AIL hanging off of a mount struct.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xaildump
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_log_item_t
modifier|*
name|lip
decl_stmt|;
specifier|static
name|char
modifier|*
name|lid_type
index|[]
init|=
block|{
literal|"???"
block|,
comment|/* 0 */
literal|"5-3-buf"
block|,
comment|/* 1 */
literal|"5-3-inode"
block|,
comment|/* 2 */
literal|"efi"
block|,
comment|/* 3 */
literal|"efd"
block|,
comment|/* 4 */
literal|"iunlink"
block|,
comment|/* 5 */
literal|"6-1-inode"
block|,
comment|/* 6 */
literal|"6-1-buf"
block|,
comment|/* 7 */
literal|"inode"
block|,
comment|/* 8 */
literal|"buf"
block|,
comment|/* 9 */
literal|"dquot"
block|,
comment|/* 10 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|li_flags
index|[]
init|=
block|{
literal|"in ail"
block|,
comment|/* 0x1 */
name|NULL
block|}
decl_stmt|;
name|int
name|count
decl_stmt|;
if|if
condition|(
operator|(
name|mp
operator|->
name|m_ail
operator|.
name|ail_forw
operator|==
name|NULL
operator|)
operator|||
operator|(
name|mp
operator|->
name|m_ail
operator|.
name|ail_forw
operator|==
operator|(
name|xfs_log_item_t
operator|*
operator|)
operator|&
name|mp
operator|->
name|m_ail
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"AIL is empty\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"AIL for mp 0x%p, oldest first\n"
argument_list|,
name|mp
argument_list|)
expr_stmt|;
name|lip
operator|=
operator|(
name|xfs_log_item_t
operator|*
operator|)
name|mp
operator|->
name|m_ail
operator|.
name|ail_forw
expr_stmt|;
for|for
control|(
name|count
operator|=
literal|0
init|;
name|lip
condition|;
name|count
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"[%d] type %s "
argument_list|,
name|count
argument_list|,
name|lid_type
index|[
name|lip
operator|->
name|li_type
operator|-
name|XFS_LI_5_3_BUF
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
call|(
name|uint
call|)
argument_list|(
name|lip
operator|->
name|li_flags
argument_list|)
argument_list|,
name|li_flags
argument_list|,
literal|"flags:"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"  lsn %s\n   "
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
operator|(
name|lip
operator|->
name|li_lsn
operator|)
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lip
operator|->
name|li_type
condition|)
block|{
case|case
name|XFS_LI_BUF
case|:
name|xfs_buf_item_print
argument_list|(
operator|(
name|xfs_buf_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_INODE
case|:
name|xfs_inode_item_print
argument_list|(
operator|(
name|xfs_inode_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_EFI
case|:
name|xfs_efi_item_print
argument_list|(
operator|(
name|xfs_efi_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_EFD
case|:
name|xfs_efd_item_print
argument_list|(
operator|(
name|xfs_efd_log_item_t
operator|*
operator|)
name|lip
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_DQUOT
case|:
name|xfs_dquot_item_print
argument_list|(
operator|(
name|xfs_dq_logitem_t
operator|*
operator|)
name|lip
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|XFS_LI_QUOTAOFF
case|:
name|xfs_qoff_item_print
argument_list|(
operator|(
name|xfs_qoff_logitem_t
operator|*
operator|)
name|lip
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
default|default:
name|kdb_printf
argument_list|(
literal|"Unknown item type %d\n"
argument_list|,
name|lip
operator|->
name|li_type
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|lip
operator|->
name|li_ail
operator|.
name|ail_forw
operator|==
operator|(
name|xfs_log_item_t
operator|*
operator|)
operator|&
name|mp
operator|->
name|m_ail
condition|)
block|{
name|lip
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|lip
operator|=
name|lip
operator|->
name|li_ail
operator|.
name|ail_forw
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print xfs mount structure.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xmount
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|xmount_flags
index|[]
init|=
block|{
literal|"WSYNC"
block|,
comment|/* 0x0001 */
literal|"INO64"
block|,
comment|/* 0x0002 */
literal|"UNUSED_4"
block|,
comment|/* 0x0004 */
literal|"UNUSED_8"
block|,
comment|/* 0x0008 */
literal|"FSSHUTDOWN"
block|,
comment|/* 0x0010 */
literal|"NOATIME"
block|,
comment|/* 0x0020 */
literal|"RETERR"
block|,
comment|/* 0x0040 */
literal|"NOALIGN"
block|,
comment|/* 0x0080 */
literal|"ATTR2"
block|,
comment|/* 0x0100 */
literal|"UNUSED_200"
block|,
comment|/* 0x0200 */
literal|"NORECOVERY"
block|,
comment|/* 0x0400 */
literal|"SHARED"
block|,
comment|/* 0x0800 */
literal|"DFLT_IOSIZE"
block|,
comment|/* 0x1000 */
literal|"OSYNCISOSYNC"
block|,
comment|/* 0x2000 */
literal|"32BITINODES"
block|,
comment|/* 0x4000 */
literal|"32BITINOOPT"
block|,
comment|/* 0x8000 */
literal|"NOUUID"
block|,
comment|/* 0x10000 */
literal|"BARRIER"
block|,
comment|/* 0x20000 */
literal|"IDELETE"
block|,
comment|/* 0x40000 */
literal|"SWALLOC"
block|,
comment|/* 0x80000 */
literal|"IHASHSIZE"
block|,
comment|/* 0x100000 */
literal|"DIRSYNC"
block|,
comment|/* 0x200000 */
literal|"COMPAT_IOSIZE"
block|,
comment|/* 0x400000 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|quota_flags
index|[]
init|=
block|{
literal|"UQ"
block|,
comment|/* 0x0001 */
literal|"UQE"
block|,
comment|/* 0x0002 */
literal|"UQCHKD"
block|,
comment|/* 0x0004 */
literal|"PQ"
block|,
comment|/* 0x0008 */
literal|"GQE"
block|,
comment|/* 0x0010 */
literal|"GQCHKD"
block|,
comment|/* 0x0020 */
literal|"GQ"
block|,
comment|/* 0x0040 */
literal|"UQACTV"
block|,
comment|/* 0x0080 */
literal|"GQACTV"
block|,
comment|/* 0x0100 */
literal|"QMAYBE"
block|,
comment|/* 0x0200 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"xfs_mount at 0x%p\n"
argument_list|,
name|mp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"vfsp 0x%p tid 0x%x ail_lock 0x%p&ail 0x%p\n"
argument_list|,
name|XFS_MTOVFS
argument_list|(
name|mp
argument_list|)
argument_list|,
name|mp
operator|->
name|m_tid
argument_list|,
operator|&
name|mp
operator|->
name|m_ail_lock
argument_list|,
operator|&
name|mp
operator|->
name|m_ail
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ail_gen 0x%x&sb 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_ail_gen
argument_list|,
operator|&
name|mp
operator|->
name|m_sb
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"sb_lock 0x%p sb_bp 0x%p dev 0x%s logdev 0x%s rtdev 0x%s\n"
argument_list|,
operator|&
name|mp
operator|->
name|m_sb_lock
argument_list|,
name|mp
operator|->
name|m_sb_bp
argument_list|,
name|mp
operator|->
name|m_ddev_targp
condition|?
name|devtoname
argument_list|(
name|mp
operator|->
name|m_ddev_targp
operator|->
name|dev
argument_list|)
else|:
literal|0
argument_list|,
name|mp
operator|->
name|m_logdev_targp
condition|?
name|devtoname
argument_list|(
name|mp
operator|->
name|m_logdev_targp
operator|->
name|dev
argument_list|)
else|:
literal|0
argument_list|,
name|mp
operator|->
name|m_rtdev_targp
condition|?
name|devtoname
argument_list|(
name|mp
operator|->
name|m_rtdev_targp
operator|->
name|dev
argument_list|)
else|:
literal|0
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"bsize %d agfrotor %d xfs_rotorstep %d agirotor %d\n"
argument_list|,
name|mp
operator|->
name|m_bsize
argument_list|,
name|mp
operator|->
name|m_agfrotor
argument_list|,
name|xfs_rotorstep
argument_list|,
name|mp
operator|->
name|m_agirotor
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ihash 0x%p ihsize %d\n"
argument_list|,
name|mp
operator|->
name|m_ihash
argument_list|,
name|mp
operator|->
name|m_ihsize
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"inodes 0x%p ilock 0x%p ireclaims 0x%x\n"
argument_list|,
name|mp
operator|->
name|m_inodes
argument_list|,
operator|&
name|mp
operator|->
name|m_ilock
argument_list|,
name|mp
operator|->
name|m_ireclaims
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"readio_log 0x%x readio_blocks 0x%x "
argument_list|,
name|mp
operator|->
name|m_readio_log
argument_list|,
name|mp
operator|->
name|m_readio_blocks
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"writeio_log 0x%x writeio_blocks 0x%x\n"
argument_list|,
name|mp
operator|->
name|m_writeio_log
argument_list|,
name|mp
operator|->
name|m_writeio_blocks
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"logbufs %d logbsize %d LOG 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_logbufs
argument_list|,
name|mp
operator|->
name|m_logbsize
argument_list|,
name|mp
operator|->
name|m_log
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rsumlevels 0x%x rsumsize 0x%x rbmip 0x%p rsumip 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_rsumlevels
argument_list|,
name|mp
operator|->
name|m_rsumsize
argument_list|,
name|mp
operator|->
name|m_rbmip
argument_list|,
name|mp
operator|->
name|m_rsumip
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rootip 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_rootip
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dircook_elog %d blkbit_log %d blkbb_log %d agno_log %d\n"
argument_list|,
name|mp
operator|->
name|m_dircook_elog
argument_list|,
name|mp
operator|->
name|m_blkbit_log
argument_list|,
name|mp
operator|->
name|m_blkbb_log
argument_list|,
name|mp
operator|->
name|m_agno_log
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"agino_log %d nreadaheads %d inode cluster size %d\n"
argument_list|,
name|mp
operator|->
name|m_agino_log
argument_list|,
name|mp
operator|->
name|m_nreadaheads
argument_list|,
name|mp
operator|->
name|m_inode_cluster_size
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"blockmask 0x%x blockwsize 0x%x blockwmask 0x%x\n"
argument_list|,
name|mp
operator|->
name|m_blockmask
argument_list|,
name|mp
operator|->
name|m_blockwsize
argument_list|,
name|mp
operator|->
name|m_blockwmask
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"alloc_mxr[lf,nd] %d %d alloc_mnr[lf,nd] %d %d\n"
argument_list|,
name|mp
operator|->
name|m_alloc_mxr
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_alloc_mxr
index|[
literal|1
index|]
argument_list|,
name|mp
operator|->
name|m_alloc_mnr
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_alloc_mnr
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"bmap_dmxr[lfnr,ndnr] %d %d bmap_dmnr[lfnr,ndnr] %d %d\n"
argument_list|,
name|mp
operator|->
name|m_bmap_dmxr
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_bmap_dmxr
index|[
literal|1
index|]
argument_list|,
name|mp
operator|->
name|m_bmap_dmnr
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_bmap_dmnr
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"inobt_mxr[lf,nd] %d %d inobt_mnr[lf,nd] %d %d\n"
argument_list|,
name|mp
operator|->
name|m_inobt_mxr
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_inobt_mxr
index|[
literal|1
index|]
argument_list|,
name|mp
operator|->
name|m_inobt_mnr
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_inobt_mnr
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ag_maxlevels %d bm_maxlevels[d,a] %d %d in_maxlevels %d\n"
argument_list|,
name|mp
operator|->
name|m_ag_maxlevels
argument_list|,
name|mp
operator|->
name|m_bm_maxlevels
index|[
literal|0
index|]
argument_list|,
name|mp
operator|->
name|m_bm_maxlevels
index|[
literal|1
index|]
argument_list|,
name|mp
operator|->
name|m_in_maxlevels
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"perag 0x%p&peraglock 0x%p&growlock 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_perag
argument_list|,
operator|&
name|mp
operator|->
name|m_peraglock
argument_list|,
operator|&
name|mp
operator|->
name|m_growlock
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|mp
operator|->
name|m_flags
argument_list|,
name|xmount_flags
argument_list|,
literal|"flags"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ialloc_inos %d ialloc_blks %d litino %d\n"
argument_list|,
name|mp
operator|->
name|m_ialloc_inos
argument_list|,
name|mp
operator|->
name|m_ialloc_blks
argument_list|,
name|mp
operator|->
name|m_litino
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dir_node_ents %u attr_node_ents %u\n"
argument_list|,
name|mp
operator|->
name|m_dir_node_ents
argument_list|,
name|mp
operator|->
name|m_attr_node_ents
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"attroffset %d maxicount %Ld inoalign_mask %d\n"
argument_list|,
name|mp
operator|->
name|m_attroffset
argument_list|,
name|mp
operator|->
name|m_maxicount
argument_list|,
name|mp
operator|->
name|m_inoalign_mask
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"resblks %Ld resblks_avail %Ld\n"
argument_list|,
name|mp
operator|->
name|m_resblks
argument_list|,
name|mp
operator|->
name|m_resblks_avail
argument_list|)
expr_stmt|;
if|#
directive|if
name|XFS_BIG_INUMS
name|kdb_printf
argument_list|(
literal|" inoadd %llx\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|mp
operator|->
name|m_inoadd
argument_list|)
expr_stmt|;
else|#
directive|else
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|mp
operator|->
name|m_quotainfo
condition|)
name|kdb_printf
argument_list|(
literal|"quotainfo 0x%p (uqip = 0x%p, gqip = 0x%p)\n"
argument_list|,
name|mp
operator|->
name|m_quotainfo
argument_list|,
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_uquotaip
argument_list|,
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_gquotaip
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"quotainfo NULL\n"
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|mp
operator|->
name|m_qflags
argument_list|,
name|quota_flags
argument_list|,
literal|"quotaflags"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dalign %d swidth %d sinoalign %d attr_magicpct %d dir_magicpct %d\n"
argument_list|,
name|mp
operator|->
name|m_dalign
argument_list|,
name|mp
operator|->
name|m_swidth
argument_list|,
name|mp
operator|->
name|m_sinoalign
argument_list|,
name|mp
operator|->
name|m_attr_magicpct
argument_list|,
name|mp
operator|->
name|m_dir_magicpct
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"mk_sharedro %d inode_quiesce %d sectbb_log %d\n"
argument_list|,
name|mp
operator|->
name|m_mk_sharedro
argument_list|,
name|mp
operator|->
name|m_inode_quiesce
argument_list|,
name|mp
operator|->
name|m_sectbb_log
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dirversion %d dirblkfsbs %d&dirops 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_dirversion
argument_list|,
name|mp
operator|->
name|m_dirblkfsbs
argument_list|,
operator|&
name|mp
operator|->
name|m_dirops
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dirblksize %d dirdatablk 0x%Lx dirleafblk 0x%Lx dirfreeblk 0x%Lx\n"
argument_list|,
name|mp
operator|->
name|m_dirblksize
argument_list|,
operator|(
name|xfs_dfiloff_t
operator|)
name|mp
operator|->
name|m_dirdatablk
argument_list|,
operator|(
name|xfs_dfiloff_t
operator|)
name|mp
operator|->
name|m_dirleafblk
argument_list|,
operator|(
name|xfs_dfiloff_t
operator|)
name|mp
operator|->
name|m_dirfreeblk
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"chsize %d chash 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_chsize
argument_list|,
name|mp
operator|->
name|m_chash
argument_list|)
expr_stmt|;
if|if
condition|(
name|mp
operator|->
name|m_fsname
operator|!=
name|NULL
condition|)
name|kdb_printf
argument_list|(
literal|"mountpoint \"%s\"\n"
argument_list|,
name|mp
operator|->
name|m_fsname
argument_list|)
expr_stmt|;
else|else
name|kdb_printf
argument_list|(
literal|"No name!!!\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xihash
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_ihash_t
modifier|*
name|ih
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|int
name|total
decl_stmt|;
name|int
name|numzeros
decl_stmt|;
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
name|int
modifier|*
name|hist
decl_stmt|;
name|int
name|hist_bytes
init|=
name|mp
operator|->
name|m_ihsize
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
decl_stmt|;
name|int
name|hist2
index|[
literal|21
index|]
decl_stmt|;
name|hist
operator|=
operator|(
name|int
operator|*
operator|)
name|kmem_alloc
argument_list|(
name|hist_bytes
argument_list|,
name|KM_SLEEP
argument_list|)
expr_stmt|;
if|if
condition|(
name|hist
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"xfsidbg_xihash: kmalloc(%d) failed!\n"
argument_list|,
name|hist_bytes
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|mp
operator|->
name|m_ihsize
condition|;
name|i
operator|++
control|)
block|{
name|ih
operator|=
name|mp
operator|->
name|m_ihash
operator|+
name|i
expr_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|ip
operator|=
name|ih
operator|->
name|ih_next
init|;
name|ip
operator|!=
name|NULL
condition|;
name|ip
operator|=
name|ip
operator|->
name|i_next
control|)
name|j
operator|++
expr_stmt|;
name|hist
index|[
name|i
index|]
operator|=
name|j
expr_stmt|;
block|}
name|numzeros
operator|=
name|total
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|21
condition|;
name|i
operator|++
control|)
name|hist2
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|mp
operator|->
name|m_ihsize
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"%d "
argument_list|,
name|hist
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|total
operator|+=
name|hist
index|[
name|i
index|]
expr_stmt|;
name|numzeros
operator|+=
name|hist
index|[
name|i
index|]
operator|==
literal|0
condition|?
literal|1
else|:
literal|0
expr_stmt|;
if|if
condition|(
name|hist
index|[
name|i
index|]
operator|>
literal|20
condition|)
name|j
operator|=
literal|20
expr_stmt|;
else|else
name|j
operator|=
name|hist
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|j
operator|<=
literal|20
operator|)
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"xfsidbg_xihash: (j> 20)/%d @ line # %d\n"
argument_list|,
name|j
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return;
block|}
name|hist2
index|[
name|j
index|]
operator|++
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"total inodes = %d, average length = %d, adjusted average = %d \n"
argument_list|,
name|total
argument_list|,
name|total
operator|/
name|mp
operator|->
name|m_ihsize
argument_list|,
name|total
operator|/
operator|(
name|mp
operator|->
name|m_ihsize
operator|-
name|numzeros
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|21
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"%d - %d , "
argument_list|,
name|i
argument_list|,
name|hist2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kmem_free
argument_list|(
name|hist
argument_list|,
name|hist_bytes
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Command to print xfs inodes: kp xnode<addr>  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xnode
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|tab_flags
index|[]
init|=
block|{
literal|"grio"
block|,
comment|/* XFS_IGRIO */
literal|"uiosize"
block|,
comment|/* XFS_IUIOSZ */
literal|"quiesce"
block|,
comment|/* XFS_IQUIESCE */
literal|"reclaim"
block|,
comment|/* XFS_IRECLAIM */
literal|"stale"
block|,
comment|/* XFS_ISTALE */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"hash 0x%p next 0x%p prevp 0x%p mount 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_hash
argument_list|,
name|ip
operator|->
name|i_next
argument_list|,
name|ip
operator|->
name|i_prevp
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"mnext 0x%p mprev 0x%p vnode 0x%p \n"
argument_list|,
name|ip
operator|->
name|i_mnext
argument_list|,
name|ip
operator|->
name|i_mprev
argument_list|,
name|XFS_ITOV_NULL
argument_list|(
name|ip
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dev %s ino %s\n"
argument_list|,
name|devtoname
argument_list|(
name|ip
operator|->
name|i_mount
operator|->
name|m_dev
argument_list|)
argument_list|,
name|xfs_fmtino
argument_list|(
name|ip
operator|->
name|i_ino
argument_list|,
name|ip
operator|->
name|i_mount
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"blkno 0x%llx len 0x%x boffset 0x%x\n"
argument_list|,
operator|(
name|long
name|long
operator|)
name|ip
operator|->
name|i_blkno
argument_list|,
name|ip
operator|->
name|i_len
argument_list|,
name|ip
operator|->
name|i_boffset
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"transp 0x%p&itemp 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_transp
argument_list|,
name|ip
operator|->
name|i_itemp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"&lock 0x%p&iolock 0x%p "
argument_list|,
operator|&
name|ip
operator|->
name|i_lock
argument_list|,
operator|&
name|ip
operator|->
name|i_iolock
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"&flock 0x%p (%d) pincount 0x%x\n"
argument_list|,
operator|&
name|ip
operator|->
name|i_flock
argument_list|,
name|valusema
argument_list|(
operator|&
name|ip
operator|->
name|i_flock
argument_list|)
argument_list|,
name|xfs_ipincount
argument_list|(
name|ip
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"udquotp 0x%p gdquotp 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_udquot
argument_list|,
name|ip
operator|->
name|i_gdquot
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"new_size %Ld\n"
argument_list|,
name|ip
operator|->
name|i_iocore
operator|.
name|io_new_size
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|int
operator|)
name|ip
operator|->
name|i_flags
argument_list|,
name|tab_flags
argument_list|,
literal|"flags"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"update_core %d update size %d\n"
argument_list|,
call|(
name|int
call|)
argument_list|(
name|ip
operator|->
name|i_update_core
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|ip
operator|->
name|i_update_size
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"gen 0x%x delayed blks %d"
argument_list|,
name|ip
operator|->
name|i_gen
argument_list|,
name|ip
operator|->
name|i_delayed_blks
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_BMAP_TRACE
name|qprintf
argument_list|(
literal|" bmap_trace 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_xtrace
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|XFS_BMBT_TRACE
name|qprintf
argument_list|(
literal|" bmbt trace 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_btrace
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|XFS_RW_TRACE
name|qprintf
argument_list|(
literal|" rw trace 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_rwtrace
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|XFS_ILOCK_TRACE
name|qprintf
argument_list|(
literal|" ilock trace 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_lock_trace
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|XFS_DIR2_TRACE
name|qprintf
argument_list|(
literal|" dir trace 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_dir_trace
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"chash 0x%p cnext 0x%p cprev 0x%p\n"
argument_list|,
name|ip
operator|->
name|i_chash
argument_list|,
name|ip
operator|->
name|i_cnext
argument_list|,
name|ip
operator|->
name|i_cprev
argument_list|)
expr_stmt|;
name|xfs_xnode_fork
argument_list|(
literal|"data"
argument_list|,
operator|&
name|ip
operator|->
name|i_df
argument_list|)
expr_stmt|;
name|xfs_xnode_fork
argument_list|(
literal|"attr"
argument_list|,
name|ip
operator|->
name|i_afp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|xfs_prdinode_core
argument_list|(
operator|&
name|ip
operator|->
name|i_d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xcore
parameter_list|(
name|xfs_iocore_t
modifier|*
name|io
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"io_obj 0x%p io_flags 0x%x io_mount 0x%p\n"
argument_list|,
name|io
operator|->
name|io_obj
argument_list|,
name|io
operator|->
name|io_flags
argument_list|,
name|io
operator|->
name|io_mount
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"new_size %Lx\n"
argument_list|,
name|io
operator|->
name|io_new_size
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Command to print xfs inode cluster hash table: kp xchash<addr>  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xchash
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|xfs_chash_t
modifier|*
name|ch
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"m_chash 0x%p size %d\n"
argument_list|,
name|mp
operator|->
name|m_chash
argument_list|,
name|mp
operator|->
name|m_chsize
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|mp
operator|->
name|m_chsize
condition|;
name|i
operator|++
control|)
block|{
name|ch
operator|=
name|mp
operator|->
name|m_chash
operator|+
name|i
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"[%3d] ch 0x%p chashlist 0x%p\n"
argument_list|,
name|i
argument_list|,
name|ch
argument_list|,
name|ch
operator|->
name|ch_list
argument_list|)
expr_stmt|;
name|xfsidbg_xchashlist
argument_list|(
name|ch
operator|->
name|ch_list
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Command to print xfs inode cluster hash list: kp xchashlist<addr>  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xchashlist
parameter_list|(
name|xfs_chashlist_t
modifier|*
name|chl
parameter_list|)
block|{
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
while|while
condition|(
name|chl
operator|!=
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"hashlist inode 0x%p blkno %lld buf 0x%p"
argument_list|,
name|chl
operator|->
name|chl_ip
argument_list|,
operator|(
name|long
name|long
operator|)
name|chl
operator|->
name|chl_blkno
argument_list|,
name|chl
operator|->
name|chl_buf
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* print inodes on chashlist */
name|ip
operator|=
name|chl
operator|->
name|chl_ip
expr_stmt|;
do|do
block|{
name|kdb_printf
argument_list|(
literal|"0x%p "
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|ip
operator|=
name|ip
operator|->
name|i_cnext
expr_stmt|;
block|}
do|while
condition|(
name|ip
operator|!=
name|chl
operator|->
name|chl_ip
condition|)
do|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|chl
operator|=
name|chl
operator|->
name|chl_next
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print xfs per-ag data structures for filesystem.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xperag
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_agnumber_t
name|agno
decl_stmt|;
name|xfs_perag_t
modifier|*
name|pag
decl_stmt|;
name|int
name|busy
decl_stmt|;
name|pag
operator|=
name|mp
operator|->
name|m_perag
expr_stmt|;
for|for
control|(
name|agno
operator|=
literal|0
init|;
name|agno
operator|<
name|mp
operator|->
name|m_sb
operator|.
name|sb_agcount
condition|;
name|agno
operator|++
operator|,
name|pag
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"ag %d f_init %d i_init %d\n"
argument_list|,
name|agno
argument_list|,
name|pag
operator|->
name|pagf_init
argument_list|,
name|pag
operator|->
name|pagi_init
argument_list|)
expr_stmt|;
if|if
condition|(
name|pag
operator|->
name|pagf_init
condition|)
name|kdb_printf
argument_list|(
literal|"    f_levels[b,c] %d,%d f_flcount %d f_freeblks %d f_longest %d\n"
literal|"    f__metadata %d\n"
argument_list|,
name|pag
operator|->
name|pagf_levels
index|[
name|XFS_BTNUM_BNOi
index|]
argument_list|,
name|pag
operator|->
name|pagf_levels
index|[
name|XFS_BTNUM_CNTi
index|]
argument_list|,
name|pag
operator|->
name|pagf_flcount
argument_list|,
name|pag
operator|->
name|pagf_freeblks
argument_list|,
name|pag
operator|->
name|pagf_longest
argument_list|,
name|pag
operator|->
name|pagf_metadata
argument_list|)
expr_stmt|;
if|if
condition|(
name|pag
operator|->
name|pagi_init
condition|)
name|kdb_printf
argument_list|(
literal|"    i_freecount %d i_inodeok %d\n"
argument_list|,
name|pag
operator|->
name|pagi_freecount
argument_list|,
name|pag
operator|->
name|pagi_inodeok
argument_list|)
expr_stmt|;
if|if
condition|(
name|pag
operator|->
name|pagf_init
condition|)
block|{
for|for
control|(
name|busy
operator|=
literal|0
init|;
name|busy
operator|<
name|XFS_PAGB_NUM_SLOTS
condition|;
name|busy
operator|++
control|)
block|{
if|if
condition|(
name|pag
operator|->
name|pagb_list
index|[
name|busy
index|]
operator|.
name|busy_length
operator|!=
literal|0
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"	 %04d: start %d length %d tp 0x%p\n"
argument_list|,
name|busy
argument_list|,
name|pag
operator|->
name|pagb_list
index|[
name|busy
index|]
operator|.
name|busy_start
argument_list|,
name|pag
operator|->
name|pagb_list
index|[
name|busy
index|]
operator|.
name|busy_length
argument_list|,
name|pag
operator|->
name|pagb_list
index|[
name|busy
index|]
operator|.
name|busy_tp
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_XFS_QUOTA
end_ifdef

begin_function
specifier|static
name|void
name|xfsidbg_xqm
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|xfs_Gqm
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"NULL XQM!!\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"usrhtab 0x%p grphtab 0x%p  ndqfree 0x%x  hashmask 0x%x\n"
argument_list|,
name|xfs_Gqm
operator|->
name|qm_usr_dqhtable
argument_list|,
name|xfs_Gqm
operator|->
name|qm_grp_dqhtable
argument_list|,
name|xfs_Gqm
operator|->
name|qm_dqfreelist
operator|.
name|qh_nelems
argument_list|,
name|xfs_Gqm
operator|->
name|qm_dqhashmask
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"&freelist 0x%p, totaldquots 0x%x nrefs 0x%x\n"
argument_list|,
operator|&
name|xfs_Gqm
operator|->
name|qm_dqfreelist
argument_list|,
name|atomic_read
argument_list|(
operator|&
name|xfs_Gqm
operator|->
name|qm_totaldquots
argument_list|)
argument_list|,
name|xfs_Gqm
operator|->
name|qm_nrefs
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|xfsidbg_xqm_diskdq
parameter_list|(
name|xfs_disk_dquot_t
modifier|*
name|d
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"magic 0x%x\tversion 0x%x\tID 0x%x (%d)\t\n"
argument_list|,
name|be16_to_cpu
argument_list|(
name|d
operator|->
name|d_magic
argument_list|)
argument_list|,
name|d
operator|->
name|d_version
argument_list|,
name|be32_to_cpu
argument_list|(
name|d
operator|->
name|d_id
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|d
operator|->
name|d_id
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"bhard 0x%llx\tbsoft 0x%llx\tihard 0x%llx\tisoft 0x%llx\n"
argument_list|,
name|be64_to_cpu
argument_list|(
name|d
operator|->
name|d_blk_hardlimit
argument_list|)
argument_list|,
name|be64_to_cpu
argument_list|(
name|d
operator|->
name|d_blk_softlimit
argument_list|)
argument_list|,
name|be64_to_cpu
argument_list|(
name|d
operator|->
name|d_ino_hardlimit
argument_list|)
argument_list|,
name|be64_to_cpu
argument_list|(
name|d
operator|->
name|d_ino_softlimit
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"bcount 0x%llx icount 0x%llx\n"
argument_list|,
name|be64_to_cpu
argument_list|(
name|d
operator|->
name|d_bcount
argument_list|)
argument_list|,
name|be64_to_cpu
argument_list|(
name|d
operator|->
name|d_icount
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"btimer 0x%x itimer 0x%x \n"
argument_list|,
name|be32_to_cpu
argument_list|(
name|d
operator|->
name|d_btimer
argument_list|)
argument_list|,
name|be32_to_cpu
argument_list|(
name|d
operator|->
name|d_itimer
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
modifier|*
name|xdq_flags
index|[]
init|=
block|{
literal|"USER"
block|,
comment|/* XFS_DQ_USER */
literal|"PROJ"
block|,
comment|/* XFS_DQ_PROJ */
literal|"GROUP"
block|,
comment|/* XFS_DQ_GROUP */
literal|"FLKD"
block|,
comment|/* XFS_DQ_FLOCKED */
literal|"DIRTY"
block|,
comment|/* XFS_DQ_DIRTY */
literal|"WANT"
block|,
comment|/* XFS_DQ_WANT */
literal|"INACT"
block|,
comment|/* XFS_DQ_INACTIVE */
literal|"MARKER"
block|,
comment|/* XFS_DQ_MARKER */
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|xfsidbg_xqm_dquot
parameter_list|(
name|xfs_dquot_t
modifier|*
name|dqp
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"mount 0x%p hash 0x%p gdquotp 0x%p HL_next 0x%p HL_prevp 0x%p\n"
argument_list|,
name|dqp
operator|->
name|q_mount
argument_list|,
name|dqp
operator|->
name|q_hash
argument_list|,
name|dqp
operator|->
name|q_gdquot
argument_list|,
name|dqp
operator|->
name|HL_NEXT
argument_list|,
name|dqp
operator|->
name|HL_PREVP
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"MPL_next 0x%p MPL_prevp 0x%p FL_next 0x%p FL_prev 0x%p\n"
argument_list|,
name|dqp
operator|->
name|MPL_NEXT
argument_list|,
name|dqp
operator|->
name|MPL_PREVP
argument_list|,
name|dqp
operator|->
name|dq_flnext
argument_list|,
name|dqp
operator|->
name|dq_flprev
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"nrefs 0x%x blkno 0x%llx boffset 0x%x "
argument_list|,
name|dqp
operator|->
name|q_nrefs
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|dqp
operator|->
name|q_blkno
argument_list|,
name|dqp
operator|->
name|q_bufoffset
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|dqp
operator|->
name|dq_flags
argument_list|,
name|xdq_flags
argument_list|,
literal|"flags:"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"res_bcount %llu res_icount %llu res_rtbcount %llu\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|dqp
operator|->
name|q_res_bcount
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|dqp
operator|->
name|q_res_icount
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|dqp
operator|->
name|q_res_rtbcount
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"qlock 0x%p  flock 0x%p (%s) pincount 0x%x\n"
argument_list|,
operator|&
name|dqp
operator|->
name|q_qlock
argument_list|,
operator|&
name|dqp
operator|->
name|q_flock
argument_list|,
operator|(
name|valusema
argument_list|(
operator|&
name|dqp
operator|->
name|q_flock
argument_list|)
operator|<=
literal|0
operator|)
condition|?
literal|"LCK"
else|:
literal|"UNLKD"
argument_list|,
name|dqp
operator|->
name|q_pincount
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XFS_DQUOT_TRACE
name|qprintf
argument_list|(
literal|"dqtrace 0x%p\n"
argument_list|,
name|dqp
operator|->
name|q_trace
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|kdb_printf
argument_list|(
literal|"disk-dquot 0x%p\n"
argument_list|,
operator|&
name|dqp
operator|->
name|q_core
argument_list|)
expr_stmt|;
name|xfsidbg_xqm_diskdq
argument_list|(
operator|&
name|dqp
operator|->
name|q_core
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|XQMIDBG_LIST_PRINT
parameter_list|(
name|l
parameter_list|,
name|NXT
parameter_list|)
define|\
value|{ \ 	  xfs_dquot_t	*dqp;\ 	  int i = 0; \ 	  kdb_printf("[#%d dquots]\n", (int) (l)->qh_nelems); \ 	  for (dqp = (l)->qh_next; dqp != NULL; dqp = dqp->NXT) {\ 	   kdb_printf( \ 	      "\t%d. [0x%p] \"%d (%s)\"\t blks = %d, inos = %d refs = %d\n", \ 			 ++i, dqp, (int) be32_to_cpu(dqp->q_core.d_id), \ 			 DQFLAGTO_TYPESTR(dqp),      \ 			 (int) be64_to_cpu(dqp->q_core.d_bcount), \ 			 (int) be64_to_cpu(dqp->q_core.d_icount), \ 			 (int) dqp->q_nrefs); }\ 	  kdb_printf("\n"); \ }
end_define

begin_function
specifier|static
name|void
name|xfsidbg_xqm_dqattached_inos
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_inode_t
modifier|*
name|ip
decl_stmt|;
name|int
name|n
init|=
literal|0
decl_stmt|;
name|ip
operator|=
name|mp
operator|->
name|m_inodes
expr_stmt|;
do|do
block|{
if|if
condition|(
name|ip
operator|->
name|i_mount
operator|==
name|NULL
condition|)
block|{
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|ip
operator|->
name|i_udquot
operator|||
name|ip
operator|->
name|i_gdquot
condition|)
block|{
name|n
operator|++
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"inode = 0x%p, ino %d: udq 0x%p, gdq 0x%p\n"
argument_list|,
name|ip
argument_list|,
operator|(
name|int
operator|)
name|ip
operator|->
name|i_ino
argument_list|,
name|ip
operator|->
name|i_udquot
argument_list|,
name|ip
operator|->
name|i_gdquot
argument_list|)
expr_stmt|;
block|}
name|ip
operator|=
name|ip
operator|->
name|i_mnext
expr_stmt|;
block|}
do|while
condition|(
name|ip
operator|!=
name|mp
operator|->
name|m_inodes
condition|)
do|;
name|kdb_printf
argument_list|(
literal|"\nNumber of inodes with dquots attached: %d\n"
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_XFS_QUOTA
end_ifdef

begin_function
specifier|static
name|void
name|xfsidbg_xqm_freelist_print
parameter_list|(
name|xfs_frlist_t
modifier|*
name|qlist
parameter_list|,
name|char
modifier|*
name|title
parameter_list|)
block|{
name|xfs_dquot_t
modifier|*
name|dq
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"%s (#%d)\n"
argument_list|,
name|title
argument_list|,
operator|(
name|int
operator|)
name|qlist
operator|->
name|qh_nelems
argument_list|)
expr_stmt|;
name|FOREACH_DQUOT_IN_FREELIST
argument_list|(
argument|dq
argument_list|,
argument|qlist
argument_list|)
block|{
name|kdb_printf
argument_list|(
literal|"\t%d.\t\"%d (%s:0x%p)\"\t bcnt = %d, icnt = %d "
literal|"refs = %d\n"
argument_list|,
operator|++
name|i
argument_list|,
operator|(
name|int
operator|)
name|be32_to_cpu
argument_list|(
name|dq
operator|->
name|q_core
operator|.
name|d_id
argument_list|)
argument_list|,
name|DQFLAGTO_TYPESTR
argument_list|(
name|dq
argument_list|)
argument_list|,
name|dq
argument_list|,
operator|(
name|int
operator|)
name|be64_to_cpu
argument_list|(
name|dq
operator|->
name|q_core
operator|.
name|d_bcount
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|be64_to_cpu
argument_list|(
name|dq
operator|->
name|q_core
operator|.
name|d_icount
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|dq
operator|->
name|q_nrefs
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xqm_freelist
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|xfs_Gqm
condition|)
block|{
name|xfsidbg_xqm_freelist_print
argument_list|(
operator|&
operator|(
name|xfs_Gqm
operator|->
name|qm_dqfreelist
operator|)
argument_list|,
literal|"Freelist"
argument_list|)
expr_stmt|;
block|}
else|else
name|kdb_printf
argument_list|(
literal|"NULL XQM!!\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xqm_htab
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|xfs_dqhash_t
modifier|*
name|h
decl_stmt|;
if|if
condition|(
name|xfs_Gqm
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"NULL XQM!!\n"
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|xfs_Gqm
operator|->
name|qm_dqhashmask
condition|;
name|i
operator|++
control|)
block|{
name|h
operator|=
operator|&
name|xfs_Gqm
operator|->
name|qm_usr_dqhtable
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|h
operator|->
name|qh_next
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"USR %d: "
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|XQMIDBG_LIST_PRINT
argument_list|(
name|h
argument_list|,
name|HL_NEXT
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|xfs_Gqm
operator|->
name|qm_dqhashmask
condition|;
name|i
operator|++
control|)
block|{
name|h
operator|=
operator|&
name|xfs_Gqm
operator|->
name|qm_grp_dqhtable
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|h
operator|->
name|qh_next
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"GRP/PRJ %d: "
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|XQMIDBG_LIST_PRINT
argument_list|(
name|h
argument_list|,
name|HL_NEXT
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XFS_DQUOT_TRACE
end_ifdef

begin_function
specifier|static
name|int
name|xfsidbg_xqm_pr_dqentry
parameter_list|(
name|ktrace_entry_t
modifier|*
name|ktep
parameter_list|)
block|{
if|if
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
operator|==
literal|0
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|0
index|]
condition|)
block|{
case|case
name|DQUOT_KTRACE_ENTRY
case|:
name|qprintf
argument_list|(
literal|"[%ld] %s\t"
argument_list|,
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|12
index|]
argument_list|,
comment|/* pid */
operator|(
name|char
operator|*
operator|)
name|ktep
operator|->
name|val
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
operator|(
name|__psint_t
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
name|xdq_flags
argument_list|,
literal|"flgs "
argument_list|)
expr_stmt|;
name|qprintf
argument_list|(
literal|"\nnrefs = %u, "
literal|"flags = 0x%x, "
literal|"id = %d, "
literal|"res_bc = 0x%x\n"
literal|"bcnt = 0x%x [0x%x | 0x%x], "
literal|"icnt = 0x%x [0x%x | 0x%x]\n"
literal|"@ %ld\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|2
index|]
argument_list|,
comment|/* nrefs */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|3
index|]
argument_list|,
comment|/* flags */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|11
index|]
argument_list|,
comment|/* ID */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|4
index|]
argument_list|,
comment|/* res_bc */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|5
index|]
argument_list|,
comment|/* bcnt */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|8
index|]
argument_list|,
comment|/* bsoft */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|7
index|]
argument_list|,
comment|/* bhard */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|6
index|]
argument_list|,
comment|/* icnt */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|10
index|]
argument_list|,
comment|/* isoft */
operator|(
name|unsigned
name|int
operator|)
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|9
index|]
argument_list|,
comment|/* ihard */
operator|(
name|long
operator|)
name|ktep
operator|->
name|val
index|[
literal|13
index|]
comment|/* time */
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qprintf
argument_list|(
literal|"unknown dqtrace record\n"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|void
name|xfsidbg_xqm_dqtrace
parameter_list|(
name|xfs_dquot_t
modifier|*
name|dqp
parameter_list|)
block|{
name|ktrace_entry_t
modifier|*
name|ktep
decl_stmt|;
name|ktrace_snap_t
name|kts
decl_stmt|;
if|if
condition|(
name|dqp
operator|->
name|q_trace
operator|==
name|NULL
condition|)
block|{
name|qprintf
argument_list|(
literal|"The xfs dquot trace buffer is not initialized\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|qprintf
argument_list|(
literal|"xdqtrace dquot 0x%p\n"
argument_list|,
name|dqp
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_first
argument_list|(
name|dqp
operator|->
name|q_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
while|while
condition|(
name|ktep
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|xfsidbg_xqm_pr_dqentry
argument_list|(
name|ktep
argument_list|)
condition|)
name|qprintf
argument_list|(
literal|"---------------------------------\n"
argument_list|)
expr_stmt|;
name|ktep
operator|=
name|ktrace_next
argument_list|(
name|dqp
operator|->
name|q_trace
argument_list|,
operator|&
name|kts
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|xfsidbg_xqm_mplist
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
if|if
condition|(
name|mp
operator|->
name|m_quotainfo
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"NULL quotainfo\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|XQMIDBG_LIST_PRINT
argument_list|(
operator|&
operator|(
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_dqlist
operator|)
argument_list|,
name|MPL_NEXT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xqm_qinfo
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
if|if
condition|(
name|mp
operator|==
name|NULL
operator|||
name|mp
operator|->
name|m_quotainfo
operator|==
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"NULL quotainfo\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|kdb_printf
argument_list|(
literal|"uqip 0x%p, gqip 0x%p,&pinlock 0x%p&dqlist 0x%p\n"
argument_list|,
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_uquotaip
argument_list|,
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_gquotaip
argument_list|,
operator|&
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_pinlock
argument_list|,
operator|&
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_dqlist
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"btmlimit 0x%x, itmlimit 0x%x, RTbtmlim 0x%x\n"
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_btimelimit
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_itimelimit
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_rtbtimelimit
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"bwarnlim 0x%x, iwarnlim 0x%x, RTbwarnlim 0x%x\n"
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_bwarnlimit
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_iwarnlimit
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_rtbwarnlimit
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"nreclaims %d,&qofflock 0x%p, chunklen 0x%x, dqperchunk 0x%x\n"
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_dqreclaims
argument_list|,
operator|&
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_quotaofflock
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_dqchunklen
argument_list|,
operator|(
name|int
operator|)
name|mp
operator|->
name|m_quotainfo
operator|->
name|qi_dqperchunk
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xqm_tpdqinfo
parameter_list|(
name|xfs_trans_t
modifier|*
name|tp
parameter_list|)
block|{
name|xfs_dqtrx_t
modifier|*
name|qa
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"dqinfo 0x%p\n"
argument_list|,
name|tp
operator|->
name|t_dqinfo
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tp
operator|->
name|t_dqinfo
condition|)
return|return;
name|kdb_printf
argument_list|(
literal|"USR: \n"
argument_list|)
expr_stmt|;
name|qa
operator|=
name|tp
operator|->
name|t_dqinfo
operator|->
name|dqa_usrdquots
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|2
condition|;
name|j
operator|++
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XFS_QM_TRANS_MAXDQS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|qa
index|[
name|i
index|]
operator|.
name|qt_dquot
operator|==
name|NULL
condition|)
break|break;
name|q
operator|=
operator|&
name|qa
index|[
name|i
index|]
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\"%d\"[0x%p]: bres %d, bres-used %d, bdelta %d, del-delta %d, icnt-delta %d\n"
argument_list|,
operator|(
name|int
operator|)
name|be32_to_cpu
argument_list|(
name|q
operator|->
name|qt_dquot
operator|->
name|q_core
operator|.
name|d_id
argument_list|)
argument_list|,
name|q
operator|->
name|qt_dquot
argument_list|,
operator|(
name|int
operator|)
name|q
operator|->
name|qt_blk_res
argument_list|,
operator|(
name|int
operator|)
name|q
operator|->
name|qt_blk_res_used
argument_list|,
operator|(
name|int
operator|)
name|q
operator|->
name|qt_bcount_delta
argument_list|,
operator|(
name|int
operator|)
name|q
operator|->
name|qt_delbcnt_delta
argument_list|,
operator|(
name|int
operator|)
name|q
operator|->
name|qt_icount_delta
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|j
operator|==
literal|0
condition|)
block|{
name|qa
operator|=
name|tp
operator|->
name|t_dqinfo
operator|->
name|dqa_grpdquots
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"GRP/PRJ: \n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Print xfs superblock.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xsb
parameter_list|(
name|xfs_sb_t
modifier|*
name|sbp
parameter_list|)
block|{
name|kdb_printf
argument_list|(
literal|"magicnum 0x%x blocksize 0x%x dblocks %Ld rblocks %Ld\n"
argument_list|,
name|sbp
operator|->
name|sb_magicnum
argument_list|,
name|sbp
operator|->
name|sb_blocksize
argument_list|,
name|sbp
operator|->
name|sb_dblocks
argument_list|,
name|sbp
operator|->
name|sb_rblocks
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rextents %Ld uuid %s logstart %s\n"
argument_list|,
name|sbp
operator|->
name|sb_rextents
argument_list|,
name|xfs_fmtuuid
argument_list|(
operator|&
name|sbp
operator|->
name|sb_uuid
argument_list|)
argument_list|,
name|xfs_fmtfsblock
argument_list|(
name|sbp
operator|->
name|sb_logstart
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rootino %s "
argument_list|,
name|xfs_fmtino
argument_list|(
name|sbp
operator|->
name|sb_rootino
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rbmino %s "
argument_list|,
name|xfs_fmtino
argument_list|(
name|sbp
operator|->
name|sb_rbmino
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rsumino %s\n"
argument_list|,
name|xfs_fmtino
argument_list|(
name|sbp
operator|->
name|sb_rsumino
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rextsize 0x%x agblocks 0x%x agcount 0x%x rbmblocks 0x%x\n"
argument_list|,
name|sbp
operator|->
name|sb_rextsize
argument_list|,
name|sbp
operator|->
name|sb_agblocks
argument_list|,
name|sbp
operator|->
name|sb_agcount
argument_list|,
name|sbp
operator|->
name|sb_rbmblocks
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"logblocks 0x%x versionnum 0x%x sectsize 0x%x inodesize 0x%x\n"
argument_list|,
name|sbp
operator|->
name|sb_logblocks
argument_list|,
name|sbp
operator|->
name|sb_versionnum
argument_list|,
name|sbp
operator|->
name|sb_sectsize
argument_list|,
name|sbp
operator|->
name|sb_inodesize
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"inopblock 0x%x blocklog 0x%x sectlog 0x%x inodelog 0x%x\n"
argument_list|,
name|sbp
operator|->
name|sb_inopblock
argument_list|,
name|sbp
operator|->
name|sb_blocklog
argument_list|,
name|sbp
operator|->
name|sb_sectlog
argument_list|,
name|sbp
operator|->
name|sb_inodelog
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"inopblog %d agblklog %d rextslog %d inprogress %d imax_pct %d\n"
argument_list|,
name|sbp
operator|->
name|sb_inopblog
argument_list|,
name|sbp
operator|->
name|sb_agblklog
argument_list|,
name|sbp
operator|->
name|sb_rextslog
argument_list|,
name|sbp
operator|->
name|sb_inprogress
argument_list|,
name|sbp
operator|->
name|sb_imax_pct
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"icount %Lx ifree %Lx fdblocks %Lx frextents %Lx\n"
argument_list|,
name|sbp
operator|->
name|sb_icount
argument_list|,
name|sbp
operator|->
name|sb_ifree
argument_list|,
name|sbp
operator|->
name|sb_fdblocks
argument_list|,
name|sbp
operator|->
name|sb_frextents
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"uquotino %s "
argument_list|,
name|xfs_fmtino
argument_list|(
name|sbp
operator|->
name|sb_uquotino
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"gquotino %s "
argument_list|,
name|xfs_fmtino
argument_list|(
name|sbp
operator|->
name|sb_gquotino
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"qflags 0x%x flags 0x%x shared_vn %d inoaligmt %d\n"
argument_list|,
name|sbp
operator|->
name|sb_qflags
argument_list|,
name|sbp
operator|->
name|sb_flags
argument_list|,
name|sbp
operator|->
name|sb_shared_vn
argument_list|,
name|sbp
operator|->
name|sb_inoalignmt
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"unit %d width %d dirblklog %d\n"
argument_list|,
name|sbp
operator|->
name|sb_unit
argument_list|,
name|sbp
operator|->
name|sb_width
argument_list|,
name|sbp
operator|->
name|sb_dirblklog
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"log sunit %d\n"
argument_list|,
name|sbp
operator|->
name|sb_logsunit
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xsb_convert
parameter_list|(
name|xfs_sb_t
modifier|*
name|sbp
parameter_list|)
block|{
name|xfs_sb_t
name|sb
decl_stmt|;
name|xfs_xlatesb
argument_list|(
name|sbp
argument_list|,
operator|&
name|sb
argument_list|,
literal|1
argument_list|,
name|XFS_SB_ALL_BITS
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"<converted>\n"
argument_list|)
expr_stmt|;
name|xfsidbg_xsb
argument_list|(
operator|&
name|sb
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print out an XFS transaction structure.  Print summaries for  * each of the items.  */
end_comment

begin_function
specifier|static
name|void
name|xfsidbg_xtp
parameter_list|(
name|xfs_trans_t
modifier|*
name|tp
parameter_list|)
block|{
name|xfs_log_item_chunk_t
modifier|*
name|licp
decl_stmt|;
name|xfs_log_item_desc_t
modifier|*
name|lidp
decl_stmt|;
name|xfs_log_busy_chunk_t
modifier|*
name|lbcp
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|chunk
decl_stmt|;
specifier|static
name|char
modifier|*
name|xtp_flags
index|[]
init|=
block|{
literal|"dirty"
block|,
comment|/* 0x1 */
literal|"sb_dirty"
block|,
comment|/* 0x2 */
literal|"perm_log_res"
block|,
comment|/* 0x4 */
literal|"sync"
block|,
comment|/* 0x08 */
literal|"dq_dirty"
block|,
comment|/* 0x10 */
name|NULL
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|lid_flags
index|[]
init|=
block|{
literal|"dirty"
block|,
comment|/* 0x1 */
literal|"pinned"
block|,
comment|/* 0x2 */
literal|"sync unlock"
block|,
comment|/* 0x4 */
literal|"buf stale"
block|,
comment|/* 0x8 */
name|NULL
block|}
decl_stmt|;
name|kdb_printf
argument_list|(
literal|"tp 0x%p type "
argument_list|,
name|tp
argument_list|)
expr_stmt|;
name|xfsidbg_print_trans_type
argument_list|(
name|tp
operator|->
name|t_type
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|" mount 0x%p\n"
argument_list|,
name|tp
operator|->
name|t_mountp
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"flags "
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|tp
operator|->
name|t_flags
argument_list|,
name|xtp_flags
argument_list|,
literal|"xtp"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"callback 0x%p forw 0x%p back 0x%p\n"
argument_list|,
operator|&
name|tp
operator|->
name|t_logcb
argument_list|,
name|tp
operator|->
name|t_forw
argument_list|,
name|tp
operator|->
name|t_back
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"log res %d block res %d block res used %d\n"
argument_list|,
name|tp
operator|->
name|t_log_res
argument_list|,
name|tp
operator|->
name|t_blk_res
argument_list|,
name|tp
operator|->
name|t_blk_res_used
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rt res %d rt res used %d\n"
argument_list|,
name|tp
operator|->
name|t_rtx_res
argument_list|,
name|tp
operator|->
name|t_rtx_res_used
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ticket 0x%lx lsn %s commit_lsn %s\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|tp
operator|->
name|t_ticket
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
name|tp
operator|->
name|t_lsn
argument_list|)
argument_list|,
name|xfs_fmtlsn
argument_list|(
operator|&
name|tp
operator|->
name|t_commit_lsn
argument_list|)
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"callback 0x%p callarg 0x%p\n"
argument_list|,
name|tp
operator|->
name|t_callback
argument_list|,
name|tp
operator|->
name|t_callarg
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"icount delta %ld ifree delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_icount_delta
argument_list|,
name|tp
operator|->
name|t_ifree_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"blocks delta %ld res blocks delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_fdblocks_delta
argument_list|,
name|tp
operator|->
name|t_res_fdblocks_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rt delta %ld res rt delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_frextents_delta
argument_list|,
name|tp
operator|->
name|t_res_frextents_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ag freeblks delta %ld ag flist delta %ld ag btree delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_ag_freeblks_delta
argument_list|,
name|tp
operator|->
name|t_ag_flist_delta
argument_list|,
name|tp
operator|->
name|t_ag_btree_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dblocks delta %ld agcount delta %ld imaxpct delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_dblocks_delta
argument_list|,
name|tp
operator|->
name|t_agcount_delta
argument_list|,
name|tp
operator|->
name|t_imaxpct_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rextsize delta %ld rbmblocks delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_rextsize_delta
argument_list|,
name|tp
operator|->
name|t_rbmblocks_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"rblocks delta %ld rextents delta %ld rextslog delta %ld\n"
argument_list|,
name|tp
operator|->
name|t_rblocks_delta
argument_list|,
name|tp
operator|->
name|t_rextents_delta
argument_list|,
name|tp
operator|->
name|t_rextslog_delta
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"dqinfo 0x%p\n"
argument_list|,
name|tp
operator|->
name|t_dqinfo
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"log items:\n"
argument_list|)
expr_stmt|;
name|licp
operator|=
operator|&
name|tp
operator|->
name|t_items
expr_stmt|;
name|chunk
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|licp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|XFS_LIC_ARE_ALL_FREE
argument_list|(
name|licp
argument_list|)
condition|)
block|{
name|licp
operator|=
name|licp
operator|->
name|lic_next
expr_stmt|;
name|chunk
operator|++
expr_stmt|;
continue|continue;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|licp
operator|->
name|lic_unused
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|XFS_LIC_ISFREE
argument_list|(
name|licp
argument_list|,
name|i
argument_list|)
condition|)
block|{
continue|continue;
block|}
name|lidp
operator|=
name|XFS_LIC_SLOT
argument_list|(
name|licp
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"chunk %d index %d item 0x%p size %d\n"
argument_list|,
name|chunk
argument_list|,
name|i
argument_list|,
name|lidp
operator|->
name|lid_item
argument_list|,
name|lidp
operator|->
name|lid_size
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"flags "
argument_list|)
expr_stmt|;
name|printflags
argument_list|(
name|lidp
operator|->
name|lid_flags
argument_list|,
name|lid_flags
argument_list|,
literal|"lic"
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|xfsidbg_xlogitem
argument_list|(
name|lidp
operator|->
name|lid_item
argument_list|)
expr_stmt|;
block|}
name|chunk
operator|++
expr_stmt|;
name|licp
operator|=
name|licp
operator|->
name|lic_next
expr_stmt|;
block|}
name|kdb_printf
argument_list|(
literal|"log busy free %d, list:\n"
argument_list|,
name|tp
operator|->
name|t_busy_free
argument_list|)
expr_stmt|;
name|lbcp
operator|=
operator|&
name|tp
operator|->
name|t_busy
expr_stmt|;
name|chunk
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|lbcp
operator|!=
name|NULL
condition|)
block|{
name|kdb_printf
argument_list|(
literal|"Chunk %d at 0x%p next 0x%p free 0x%08x unused %d\n"
argument_list|,
name|chunk
argument_list|,
name|lbcp
argument_list|,
name|lbcp
operator|->
name|lbc_next
argument_list|,
name|lbcp
operator|->
name|lbc_free
argument_list|,
name|lbcp
operator|->
name|lbc_unused
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XFS_LBC_NUM_SLOTS
condition|;
name|i
operator|++
control|)
block|{
name|kdb_printf
argument_list|(
literal|"  %02d: ag %d idx %d\n"
argument_list|,
name|i
argument_list|,
name|lbcp
operator|->
name|lbc_busy
index|[
name|i
index|]
operator|.
name|lbc_ag
argument_list|,
name|lbcp
operator|->
name|lbc_busy
index|[
name|i
index|]
operator|.
name|lbc_idx
argument_list|)
expr_stmt|;
block|}
name|lbcp
operator|=
name|lbcp
operator|->
name|lbc_next
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|xfsidbg_xtrans_res
parameter_list|(
name|xfs_mount_t
modifier|*
name|mp
parameter_list|)
block|{
name|xfs_trans_reservations_t
modifier|*
name|xtrp
decl_stmt|;
name|xtrp
operator|=
operator|&
name|mp
operator|->
name|m_reservations
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"write: %d\ttruncate: %d\trename: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_write
argument_list|,
name|xtrp
operator|->
name|tr_itruncate
argument_list|,
name|xtrp
operator|->
name|tr_rename
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"link: %d\tremove: %d\tsymlink: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_link
argument_list|,
name|xtrp
operator|->
name|tr_remove
argument_list|,
name|xtrp
operator|->
name|tr_symlink
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"create: %d\tmkdir: %d\tifree: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_create
argument_list|,
name|xtrp
operator|->
name|tr_mkdir
argument_list|,
name|xtrp
operator|->
name|tr_ifree
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"ichange: %d\tgrowdata: %d\tswrite: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_ichange
argument_list|,
name|xtrp
operator|->
name|tr_growdata
argument_list|,
name|xtrp
operator|->
name|tr_swrite
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"addafork: %d\twriteid: %d\tattrinval: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_addafork
argument_list|,
name|xtrp
operator|->
name|tr_writeid
argument_list|,
name|xtrp
operator|->
name|tr_attrinval
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"attrset: %d\tattrrm: %d\tclearagi: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_attrset
argument_list|,
name|xtrp
operator|->
name|tr_attrrm
argument_list|,
name|xtrp
operator|->
name|tr_clearagi
argument_list|)
expr_stmt|;
name|kdb_printf
argument_list|(
literal|"growrtalloc: %d\tgrowrtzero: %d\tgrowrtfree: %d\n"
argument_list|,
name|xtrp
operator|->
name|tr_growrtalloc
argument_list|,
name|xtrp
operator|->
name|tr_growrtzero
argument_list|,
name|xtrp
operator|->
name|tr_growrtfree
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

