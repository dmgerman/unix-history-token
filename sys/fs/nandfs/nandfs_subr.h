begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2010-2012 Semihalf  * Copyright (c) 2008, 2009 Reinoud Zandijk  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *  * From: NetBSD: nilfs_subr.h,v 1.1 2009/07/18 16:31:42 reinoud  *  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|_FS_NANDFS_NANDFS_SUBR_H_
end_ifndef

begin_define
define|#
directive|define
name|_FS_NANDFS_NANDFS_SUBR_H_
end_define

begin_struct_decl
struct_decl|struct
name|nandfs_mdt
struct_decl|;
end_struct_decl

begin_struct
struct|struct
name|nandfs_alloc_request
block|{
name|uint64_t
name|entrynum
decl_stmt|;
name|struct
name|buf
modifier|*
name|bp_desc
decl_stmt|;
name|struct
name|buf
modifier|*
name|bp_bitmap
decl_stmt|;
name|struct
name|buf
modifier|*
name|bp_entry
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Segment creation */
end_comment

begin_function_decl
name|void
name|nandfs_wakeup_wait_sync
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_segment_constructor
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_sync_file
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Basic calculators */
end_comment

begin_function_decl
name|uint64_t
name|nandfs_get_segnum_of_block
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_get_segment_range
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_calc_mdt_consts
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Log reading / volume helpers */
end_comment

begin_function_decl
name|int
name|nandfs_search_super_root
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Reading */
end_comment

begin_function_decl
name|int
name|nandfs_dev_bread
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bread
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bread_meta
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bdestroy
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bcreate
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bcreate_meta
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bread_create
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* vtop operations */
end_comment

begin_function_decl
name|int
name|nandfs_vtop
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|,
name|nandfs_daddr_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Node action implementators */
end_comment

begin_function_decl
name|int
name|nandfs_vinit
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_node
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|struct
name|nandfs_node
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_node_raw
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|struct
name|nandfs_inode
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_dispose_node
parameter_list|(
name|struct
name|nandfs_node
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_itimes
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_lookup_name_in_dir
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|uint64_t
modifier|*
parameter_list|,
name|int
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_create_node
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|struct
name|vnode
modifier|*
modifier|*
parameter_list|,
name|struct
name|vattr
modifier|*
parameter_list|,
name|struct
name|componentname
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_delete_node
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_chsize
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|u_quad_t
parameter_list|,
name|struct
name|ucred
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_dir_detach
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|componentname
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_dir_attach
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|vattr
modifier|*
parameter_list|,
name|struct
name|componentname
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_dirty_buf
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_dirty_buf_meta
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_fs_full
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_undirty_buf_fsdev
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|buf
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_undirty_buf
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_clear_buf
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_buf_set
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_buf_clear
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_buf_check
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_find_free_entry
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_alloc_request
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_find_entry
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_alloc_request
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_alloc_entry
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|struct
name|nandfs_alloc_request
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_abort_entry
parameter_list|(
name|struct
name|nandfs_alloc_request
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_free_entry
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|struct
name|nandfs_alloc_request
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_entry_block
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_alloc_request
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Inode management. */
end_comment

begin_function_decl
name|int
name|nandfs_node_create
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
modifier|*
parameter_list|,
name|uint16_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_node_destroy
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_node_update
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_node_entry
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|struct
name|nandfs_inode
modifier|*
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|struct
name|buf
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_mdt_trans_blk
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|,
name|nandfs_lbn_t
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* vblock management */
end_comment

begin_function_decl
name|void
name|nandfs_mdt_trans
parameter_list|(
name|struct
name|nandfs_mdt
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|nandfs_lbn_t
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_vblock_alloc
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_vblock_end
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_vblock_assign
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|,
name|nandfs_lbn_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_vblock_free
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Checkpoint management */
end_comment

begin_function_decl
name|int
name|nandfs_get_checkpoint
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_set_checkpoint
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|struct
name|nandfs_inode
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Segment management */
end_comment

begin_function_decl
name|int
name|nandfs_alloc_segment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_update_segment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_free_segment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_clear_segment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_touch_segment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_markgc_segment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bmap_insert_block
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|struct
name|buf
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bmap_update_block
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|buf
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bmap_update_dat
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|,
name|struct
name|buf
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bmap_dirty_blocks
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|buf
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bmap_truncate_mapping
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|nandfs_lbn_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_bmap_lookup
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|,
name|nandfs_daddr_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* dirent */
end_comment

begin_function_decl
name|int
name|nandfs_add_dirent
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|long
parameter_list|,
name|uint8_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_remove_dirent
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|componentname
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_update_dirent
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_init_dir
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_update_parent_dir
parameter_list|(
name|struct
name|vnode
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_vblk_set
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|nandfs_daddr_t
name|nandfs_vblk_get
parameter_list|(
name|struct
name|buf
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_inode_init
parameter_list|(
name|struct
name|nandfs_inode
modifier|*
parameter_list|,
name|uint16_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_inode_destroy
parameter_list|(
name|struct
name|nandfs_inode
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* ioctl */
end_comment

begin_function_decl
name|int
name|nandfs_get_seg_stat
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_seg_stat
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_chng_cpmode
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_cpmode
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_cpinfo_ioctl
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_argv
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_delete_cp
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|uint64_t
name|start
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_make_snap
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_delete_snap
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_cpstat
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|struct
name|nandfs_cpstat
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_segment_info_ioctl
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_argv
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_dat_vinfo_ioctl
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_argv
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_dat_bdescs_ioctl
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_argv
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_fsinfo
parameter_list|(
name|struct
name|nandfsmount
modifier|*
parameter_list|,
name|struct
name|nandfs_fsinfo
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_cpinfo
parameter_list|(
name|struct
name|nandfs_node
modifier|*
parameter_list|,
name|uint64_t
parameter_list|,
name|uint16_t
parameter_list|,
name|struct
name|nandfs_cpinfo
modifier|*
parameter_list|,
name|uint32_t
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|nandfs_lbn_t
name|nandfs_get_maxfilesize
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_write_superblock
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|int
name|nandfs_sync_interval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|nandfs_max_dirty_segs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|nandfs_cps_between_sblocks
decl_stmt|;
end_decl_stmt

begin_function_decl
name|struct
name|buf
modifier|*
name|nandfs_geteblk
parameter_list|(
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_dirty_bufs_increment
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|nandfs_dirty_bufs_decrement
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_start_cleaner
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_stop_cleaner
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_segsum_valid
parameter_list|(
name|struct
name|nandfs_segment_summary
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_load_segsum
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_daddr_t
parameter_list|,
name|struct
name|nandfs_segment_summary
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_segment_info
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_suinfo
modifier|*
parameter_list|,
name|uint32_t
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_segment_info_filter
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_suinfo
modifier|*
parameter_list|,
name|uint32_t
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|,
name|uint32_t
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_dat_vinfo
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_vinfo
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|nandfs_get_dat_bdescs
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|struct
name|nandfs_bdesc
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|NANDFS_VBLK_ASSIGNED
value|1
end_define

begin_define
define|#
directive|define
name|NANDFS_IS_INDIRECT
parameter_list|(
name|bp
parameter_list|)
value|((bp)->b_lblkno< 0)
end_define

begin_function_decl
name|int
name|nandfs_erase
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|off_t
parameter_list|,
name|size_t
parameter_list|)
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|NANDFS_VOP_ISLOCKED
parameter_list|(
name|vp
parameter_list|)
value|nandfs_vop_islocked((vp))
end_define

begin_function_decl
name|int
name|nandfs_vop_islocked
parameter_list|(
name|struct
name|vnode
modifier|*
name|vp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|nandfs_daddr_t
name|nandfs_block_to_dblock
parameter_list|(
name|struct
name|nandfs_device
modifier|*
parameter_list|,
name|nandfs_lbn_t
parameter_list|)
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|DEBUG_MODE
end_define

begin_if
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_MODE
argument_list|)
end_if

begin_define
define|#
directive|define
name|nandfs_error
value|panic
end_define

begin_define
define|#
directive|define
name|nandfs_warning
value|printf
end_define

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|TEST_MODE
argument_list|)
end_elif

begin_define
define|#
directive|define
name|nandfs_error
value|printf
end_define

begin_define
define|#
directive|define
name|nandfs_warning
value|printf
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|nandfs_error
parameter_list|(
modifier|...
parameter_list|)
end_define

begin_define
define|#
directive|define
name|nandfs_warning
parameter_list|(
modifier|...
parameter_list|)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !_FS_NANDFS_NANDFS_SUBR_H_ */
end_comment

end_unit

