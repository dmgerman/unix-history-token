begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1989, 1993  *	The Regents of the University of California.  All rights reserved.  *  * This code is derived from software contributed to Berkeley by  * Rick Macklem at The University of Guelph.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 4. Neither the name of the University nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*  * Socket operations for use by the nfs server.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|APPLEKEXT
end_ifndef

begin_include
include|#
directive|include
file|<fs/nfs/nfsport.h>
end_include

begin_decl_stmt
specifier|extern
name|struct
name|nfsstats
name|newnfsstats
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|nfsrvfh
name|nfs_pubfh
decl_stmt|,
name|nfs_rootfh
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|nfs_pubfhset
decl_stmt|,
name|nfs_rootfhset
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|nfsv4lock
name|nfsv4rootfs_lock
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|nfsrv_stablefirst
name|nfsrv_stablefirst
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|nfsclienthashhead
name|nfsclienthash
index|[
name|NFSCLIENTHASHSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|nfsrc_floodlevel
decl_stmt|,
name|nfsrc_tcpsavedreplies
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NFSV4ROOTLOCKMUTEX
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NFSSTATESPINLOCK
expr_stmt|;
end_expr_stmt

begin_function_decl
name|int
function_decl|(
modifier|*
name|nfsrv3_procs0
index|[
name|NFS_V3NPROCS
index|]
function_decl|)
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
parameter_list|,
name|int
parameter_list|,
name|vnode_t
parameter_list|,
name|NFSPROC_T
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|)
init|=
block|{
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
init|struct
name|nfsrv_descript
operator|*
operator|,
function_decl|int
operator|,
function_decl|vnode_t
operator|,
function_decl|NFSPROC_T *
operator|,
function_decl|struct nfsexstuff *
end_function_decl

begin_expr_stmt
unit|))
literal|0
operator|,
name|nfsrvd_getattr
operator|,
name|nfsrvd_setattr
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_access
operator|,
name|nfsrvd_readlink
operator|,
name|nfsrvd_read
operator|,
name|nfsrvd_write
operator|,
name|nfsrvd_create
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_remove
operator|,
name|nfsrvd_remove
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_readdir
operator|,
name|nfsrvd_readdirplus
operator|,
name|nfsrvd_statfs
operator|,
name|nfsrvd_fsinfo
operator|,
name|nfsrvd_pathconf
operator|,
name|nfsrvd_commit
operator|,
end_expr_stmt

begin_function_decl
unit|};
name|int
function_decl|(
modifier|*
name|nfsrv3_procs1
index|[
name|NFS_V3NPROCS
index|]
function_decl|)
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
parameter_list|,
name|int
parameter_list|,
name|vnode_t
parameter_list|,
name|vnode_t
modifier|*
parameter_list|,
name|fhandle_t
modifier|*
parameter_list|,
name|NFSPROC_T
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|)
init|=
block|{
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
init|struct
name|nfsrv_descript
operator|*
operator|,
function_decl|int
operator|,
function_decl|vnode_t
operator|,
function_decl|vnode_t *
operator|,
function_decl|fhandle_t *
operator|,
function_decl|NFSPROC_T *
operator|,
function_decl|struct nfsexstuff *
end_function_decl

begin_expr_stmt
unit|))
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_lookup
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_mkdir
operator|,
name|nfsrvd_symlink
operator|,
name|nfsrvd_mknod
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
end_expr_stmt

begin_function_decl
unit|};
name|int
function_decl|(
modifier|*
name|nfsrv3_procs2
index|[
name|NFS_V3NPROCS
index|]
function_decl|)
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
parameter_list|,
name|int
parameter_list|,
name|vnode_t
parameter_list|,
name|vnode_t
parameter_list|,
name|NFSPROC_T
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|)
init|=
block|{
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
init|struct
name|nfsrv_descript
operator|*
operator|,
function_decl|int
operator|,
function_decl|vnode_t
operator|,
function_decl|vnode_t
operator|,
function_decl|NFSPROC_T *
operator|,
function_decl|struct nfsexstuff *
operator|,
function_decl|struct nfsexstuff *
end_function_decl

begin_expr_stmt
unit|))
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_rename
operator|,
name|nfsrvd_link
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
end_expr_stmt

begin_function_decl
unit|};
name|int
function_decl|(
modifier|*
name|nfsrv4_ops0
index|[
name|NFSV4OP_NOPS
index|]
function_decl|)
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
parameter_list|,
name|int
parameter_list|,
name|vnode_t
parameter_list|,
name|NFSPROC_T
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|)
init|=
block|{
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
init|struct
name|nfsrv_descript
operator|*
operator|,
function_decl|int
operator|,
function_decl|vnode_t
operator|,
function_decl|NFSPROC_T *
operator|,
function_decl|struct nfsexstuff *
end_function_decl

begin_expr_stmt
unit|))
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_access
operator|,
name|nfsrvd_close
operator|,
name|nfsrvd_commit
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_delegpurge
operator|,
name|nfsrvd_delegreturn
operator|,
name|nfsrvd_getattr
operator|,
name|nfsrvd_getfh
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_lock
operator|,
name|nfsrvd_lockt
operator|,
name|nfsrvd_locku
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_verify
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_openconfirm
operator|,
name|nfsrvd_opendowngrade
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_read
operator|,
name|nfsrvd_readdirplus
operator|,
name|nfsrvd_readlink
operator|,
name|nfsrvd_remove
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_renew
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_secinfo
operator|,
name|nfsrvd_setattr
operator|,
name|nfsrvd_setclientid
operator|,
name|nfsrvd_setclientidcfrm
operator|,
name|nfsrvd_verify
operator|,
name|nfsrvd_write
operator|,
name|nfsrvd_releaselckown
operator|,
end_expr_stmt

begin_function_decl
unit|};
name|int
function_decl|(
modifier|*
name|nfsrv4_ops1
index|[
name|NFSV4OP_NOPS
index|]
function_decl|)
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
parameter_list|,
name|int
parameter_list|,
name|vnode_t
parameter_list|,
name|vnode_t
modifier|*
parameter_list|,
name|fhandle_t
modifier|*
parameter_list|,
name|NFSPROC_T
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|)
init|=
block|{
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
init|struct
name|nfsrv_descript
operator|*
operator|,
function_decl|int
operator|,
function_decl|vnode_t
operator|,
function_decl|vnode_t *
operator|,
function_decl|fhandle_t *
operator|,
function_decl|NFSPROC_T *
operator|,
function_decl|struct nfsexstuff *
end_function_decl

begin_expr_stmt
unit|))
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_mknod
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_lookup
operator|,
name|nfsrvd_lookup
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_open
operator|,
name|nfsrvd_openattr
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
operator|*
argument_list|,
name|fhandle_t
operator|*
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
end_expr_stmt

begin_function_decl
unit|};
name|int
function_decl|(
modifier|*
name|nfsrv4_ops2
index|[
name|NFSV4OP_NOPS
index|]
function_decl|)
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
parameter_list|,
name|int
parameter_list|,
name|vnode_t
parameter_list|,
name|vnode_t
parameter_list|,
name|NFSPROC_T
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|,
name|struct
name|nfsexstuff
modifier|*
parameter_list|)
init|=
block|{
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
init|struct
name|nfsrv_descript
operator|*
operator|,
function_decl|int
operator|,
function_decl|vnode_t
operator|,
function_decl|vnode_t
operator|,
function_decl|NFSPROC_T *
operator|,
function_decl|struct nfsexstuff *
operator|,
function_decl|struct nfsexstuff *
end_function_decl

begin_expr_stmt
unit|))
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_link
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
name|nfsrvd_rename
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
expr|struct
name|nfsrv_descript
operator|*
argument_list|,
name|int
argument_list|,
name|vnode_t
argument_list|,
name|vnode_t
argument_list|,
name|NFSPROC_T
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|,
expr|struct
name|nfsexstuff
operator|*
argument_list|)
operator|)
literal|0
operator|,
end_expr_stmt

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_comment
comment|/* !APPLEKEXT */
end_comment

begin_comment
comment|/*  * Static array that defines which nfs rpc's are nonidempotent  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|nfsrv_nonidempotent
index|[
name|NFS_V3NPROCS
index|]
init|=
block|{
name|FALSE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * This static array indicates whether or not the RPC modifies the  * file system.  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|nfs_writerpc
index|[
name|NFS_NPROCS
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* local functions */
end_comment

begin_function_decl
specifier|static
name|void
name|nfsrvd_compound
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
name|nd
parameter_list|,
name|int
name|isdgram
parameter_list|,
name|NFSPROC_T
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * This static array indicates which server procedures require the extra  * arguments to return the current file handle for V2, 3.  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|nfs_retfh
index|[
name|NFS_V3NPROCS
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|2
block|,
literal|2
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|nfsv4_opflag
name|nfsv4_opflag
index|[
name|NFSV4OP_NOPS
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|nfsv3to4op
index|[
name|NFS_V3NPROCS
index|]
init|=
block|{
name|NFSPROC_NULL
block|,
name|NFSV4OP_GETATTR
block|,
name|NFSV4OP_SETATTR
block|,
name|NFSV4OP_LOOKUP
block|,
name|NFSV4OP_ACCESS
block|,
name|NFSV4OP_READLINK
block|,
name|NFSV4OP_READ
block|,
name|NFSV4OP_WRITE
block|,
name|NFSV4OP_V3CREATE
block|,
name|NFSV4OP_MKDIR
block|,
name|NFSV4OP_SYMLINK
block|,
name|NFSV4OP_MKNOD
block|,
name|NFSV4OP_REMOVE
block|,
name|NFSV4OP_RMDIR
block|,
name|NFSV4OP_RENAME
block|,
name|NFSV4OP_LINK
block|,
name|NFSV4OP_READDIR
block|,
name|NFSV4OP_READDIRPLUS
block|,
name|NFSV4OP_FSSTAT
block|,
name|NFSV4OP_FSINFO
block|,
name|NFSV4OP_PATHCONF
block|,
name|NFSV4OP_COMMIT
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Do an RPC. Basically, get the file handles translated to vnode pointers  * and then call the appropriate server routine. The server routines are  * split into groups, based on whether they use a file handle or file  * handle plus name or ...  * The NFS V4 Compound RPC is performed separately by nfsrvd_compound().  */
end_comment

begin_function
name|APPLESTATIC
name|void
name|nfsrvd_dorpc
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
name|nd
parameter_list|,
name|int
name|isdgram
parameter_list|,
name|NFSPROC_T
modifier|*
name|p
parameter_list|)
block|{
name|int
name|error
init|=
literal|0
decl_stmt|,
name|lktype
decl_stmt|;
name|vnode_t
name|vp
decl_stmt|;
name|mount_t
name|mp
init|=
name|NULL
decl_stmt|;
name|struct
name|nfsrvfh
name|fh
decl_stmt|;
name|struct
name|nfsexstuff
name|nes
decl_stmt|;
comment|/* 	 * Get a locked vnode for the first file handle 	 */
if|if
condition|(
operator|!
operator|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_NFSV4
operator|)
condition|)
block|{
name|KASSERT
argument_list|(
name|nd
operator|->
name|nd_repstat
operator|==
literal|0
argument_list|,
operator|(
literal|"nfsrvd_dorpc"
operator|)
argument_list|)
expr_stmt|;
comment|/* 		 * For NFSv3, if the malloc/mget allocation is near limits, 		 * return NFSERR_DELAY. 		 */
if|if
condition|(
operator|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_NFSV3
operator|)
operator|&&
name|nfsrv_mallocmget_limit
argument_list|()
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_DELAY
expr_stmt|;
name|vp
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|error
operator|=
name|nfsrv_mtofh
argument_list|(
name|nd
argument_list|,
operator|&
name|fh
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
if|if
condition|(
name|error
operator|!=
name|EBADRPC
condition|)
name|printf
argument_list|(
literal|"nfs dorpc err1=%d\n"
argument_list|,
name|error
argument_list|)
expr_stmt|;
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_GARBAGE
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|nd
operator|->
name|nd_procnum
operator|==
name|NFSPROC_READ
operator|||
name|nd
operator|->
name|nd_procnum
operator|==
name|NFSPROC_READDIR
operator|||
name|nd
operator|->
name|nd_procnum
operator|==
name|NFSPROC_READLINK
operator|||
name|nd
operator|->
name|nd_procnum
operator|==
name|NFSPROC_GETATTR
operator|||
name|nd
operator|->
name|nd_procnum
operator|==
name|NFSPROC_ACCESS
condition|)
name|lktype
operator|=
name|LK_SHARED
expr_stmt|;
else|else
name|lktype
operator|=
name|LK_EXCLUSIVE
expr_stmt|;
if|if
condition|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_PUBLOOKUP
condition|)
name|nfsd_fhtovp
argument_list|(
name|nd
argument_list|,
operator|&
name|nfs_pubfh
argument_list|,
name|lktype
argument_list|,
operator|&
name|vp
argument_list|,
operator|&
name|nes
argument_list|,
operator|&
name|mp
argument_list|,
name|nfs_writerpc
index|[
name|nd
operator|->
name|nd_procnum
index|]
argument_list|,
name|p
argument_list|)
expr_stmt|;
else|else
name|nfsd_fhtovp
argument_list|(
name|nd
argument_list|,
operator|&
name|fh
argument_list|,
name|lktype
argument_list|,
operator|&
name|vp
argument_list|,
operator|&
name|nes
argument_list|,
operator|&
name|mp
argument_list|,
name|nfs_writerpc
index|[
name|nd
operator|->
name|nd_procnum
index|]
argument_list|,
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_PROGNOTV4
condition|)
return|return;
block|}
block|}
comment|/* 	 * For V2 and 3, set the ND_SAVEREPLY flag for the recent request 	 * cache, as required. 	 * For V4, nfsrvd_compound() does this. 	 */
if|if
condition|(
operator|!
operator|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_NFSV4
operator|)
operator|&&
name|nfsrv_nonidempotent
index|[
name|nd
operator|->
name|nd_procnum
index|]
condition|)
name|nd
operator|->
name|nd_flag
operator||=
name|ND_SAVEREPLY
expr_stmt|;
name|nfsrvd_rephead
argument_list|(
name|nd
argument_list|)
expr_stmt|;
comment|/* 	 * If nd_repstat is non-zero, just fill in the reply status 	 * to complete the RPC reply for V2. Otherwise, you must do 	 * the RPC. 	 */
if|if
condition|(
name|nd
operator|->
name|nd_repstat
operator|&&
operator|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_NFSV2
operator|)
condition|)
block|{
operator|*
name|nd
operator|->
name|nd_errp
operator|=
name|nfsd_errmap
argument_list|(
name|nd
argument_list|)
expr_stmt|;
name|NFSINCRGLOBAL
argument_list|(
name|newnfsstats
operator|.
name|srvrpccnt
index|[
name|nfsv3to4op
index|[
name|nd
operator|->
name|nd_procnum
index|]
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|mp
operator|!=
name|NULL
operator|&&
name|nfs_writerpc
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|!=
literal|0
condition|)
name|vn_finished_write
argument_list|(
name|mp
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* 	 * Now the procedure can be performed. For V4, nfsrvd_compound() 	 * works through the sub-rpcs, otherwise just call the procedure. 	 * The procedures are in three groups with different arguments. 	 * The group is indicated by the value in nfs_retfh[]. 	 */
if|if
condition|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_NFSV4
condition|)
block|{
name|nfsrvd_compound
argument_list|(
name|nd
argument_list|,
name|isdgram
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|nfs_retfh
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|vp
condition|)
name|NFSVOPUNLOCK
argument_list|(
name|vp
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv3_procs1
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|vp
operator|,
name|NULL
operator|,
operator|(
name|fhandle_t
operator|*
operator|)
name|fh
operator|.
name|nfsrvfh_data
operator|,
name|p
operator|,
operator|&
name|nes
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|nfs_retfh
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|==
literal|2
condition|)
block|{
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv3_procs2
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|vp
operator|,
name|NULL
operator|,
name|p
operator|,
operator|&
name|nes
operator|,
name|NULL
operator|)
expr_stmt|;
block|}
else|else
block|{
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv3_procs0
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|vp
operator|,
name|p
operator|,
operator|&
name|nes
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|mp
operator|!=
name|NULL
operator|&&
name|nfs_writerpc
index|[
name|nd
operator|->
name|nd_procnum
index|]
operator|!=
literal|0
condition|)
name|vn_finished_write
argument_list|(
name|mp
argument_list|)
expr_stmt|;
name|NFSINCRGLOBAL
argument_list|(
name|newnfsstats
operator|.
name|srvrpccnt
index|[
name|nfsv3to4op
index|[
name|nd
operator|->
name|nd_procnum
index|]
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|error
condition|)
block|{
if|if
condition|(
name|error
operator|!=
name|EBADRPC
condition|)
name|printf
argument_list|(
literal|"nfs dorpc err2=%d\n"
argument_list|,
name|error
argument_list|)
expr_stmt|;
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_GARBAGE
expr_stmt|;
block|}
operator|*
name|nd
operator|->
name|nd_errp
operator|=
name|nfsd_errmap
argument_list|(
name|nd
argument_list|)
expr_stmt|;
comment|/* 	 * Don't cache certain reply status values. 	 */
if|if
condition|(
name|nd
operator|->
name|nd_repstat
operator|&&
operator|(
name|nd
operator|->
name|nd_flag
operator|&
name|ND_SAVEREPLY
operator|)
operator|&&
operator|(
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_GARBAGE
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_BADXDR
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_MOVED
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_DELAY
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_BADSEQID
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_RESOURCE
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_SERVERFAULT
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_STALECLIENTID
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_STALESTATEID
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_OLDSTATEID
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_BADSTATEID
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_GRACE
operator|||
name|nd
operator|->
name|nd_repstat
operator|==
name|NFSERR_NOGRACE
operator|)
condition|)
name|nd
operator|->
name|nd_flag
operator|&=
operator|~
name|ND_SAVEREPLY
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Breaks down a compound RPC request and calls the server routines for  * the subprocedures.  * Some suboperations are performed directly here to simplify file handle<-->  * vnode pointer handling.  */
end_comment

begin_function
specifier|static
name|void
name|nfsrvd_compound
parameter_list|(
name|struct
name|nfsrv_descript
modifier|*
name|nd
parameter_list|,
name|int
name|isdgram
parameter_list|,
name|NFSPROC_T
modifier|*
name|p
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|op
decl_stmt|;
name|u_int32_t
modifier|*
name|tl
decl_stmt|;
name|struct
name|nfsclient
modifier|*
name|clp
decl_stmt|,
modifier|*
name|nclp
decl_stmt|;
name|int
name|numops
decl_stmt|,
name|taglen
init|=
operator|-
literal|1
decl_stmt|,
name|error
init|=
literal|0
decl_stmt|,
name|igotlock
decl_stmt|;
name|u_int32_t
name|minorvers
decl_stmt|,
name|retops
init|=
literal|0
decl_stmt|,
modifier|*
name|retopsp
init|=
name|NULL
decl_stmt|,
modifier|*
name|repp
decl_stmt|;
name|u_char
name|tag
index|[
name|NFSV4_SMALLSTR
operator|+
literal|1
index|]
decl_stmt|,
modifier|*
name|tagstr
decl_stmt|;
name|vnode_t
name|vp
decl_stmt|,
name|nvp
decl_stmt|,
name|savevp
decl_stmt|;
name|struct
name|nfsrvfh
name|fh
decl_stmt|;
name|mount_t
name|new_mp
decl_stmt|,
name|temp_mp
init|=
name|NULL
decl_stmt|;
name|struct
name|ucred
modifier|*
name|credanon
decl_stmt|;
name|struct
name|nfsexstuff
name|nes
decl_stmt|,
name|vpnes
decl_stmt|,
name|savevpnes
decl_stmt|;
name|fsid_t
name|cur_fsid
decl_stmt|,
name|save_fsid
decl_stmt|;
specifier|static
name|u_int64_t
name|compref
init|=
literal|0
decl_stmt|;
name|NFSVNO_EXINIT
argument_list|(
operator|&
name|vpnes
argument_list|)
expr_stmt|;
name|NFSVNO_EXINIT
argument_list|(
operator|&
name|savevpnes
argument_list|)
expr_stmt|;
comment|/* 	 * Put the seq# of the current compound RPC in nfsrv_descript. 	 * (This is used by nfsrv_checkgetattr(), to see if the write 	 *  delegation was created by the same compound RPC as the one 	 *  with that Getattr in it.) 	 * Don't worry about the 64bit number wrapping around. It ain't 	 * gonna happen before this server gets shut down/rebooted. 	 */
name|nd
operator|->
name|nd_compref
operator|=
name|compref
operator|++
expr_stmt|;
comment|/* 	 * Check for and optionally get a lock on the root. This lock means that 	 * no nfsd will be fiddling with the V4 file system and state stuff. It 	 * is required when the V4 root is being changed, the stable storage 	 * restart file is being updated, or callbacks are being done. 	 * When any of the nfsd are processing an NFSv4 compound RPC, they must 	 * either hold a reference count (nfs_usecnt) or the lock. When 	 * nfsrv_unlock() is called to release the lock, it can optionally 	 * also get a reference count, which saves the need for a call to 	 * nfsrv_getref() after nfsrv_unlock(). 	 */
comment|/* 	 * First, check to see if we need to wait for an update lock. 	 */
name|igotlock
operator|=
literal|0
expr_stmt|;
name|NFSLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
if|if
condition|(
name|nfsrv_stablefirst
operator|.
name|nsf_flags
operator|&
name|NFSNSF_NEEDLOCK
condition|)
name|igotlock
operator|=
name|nfsv4_lock
argument_list|(
operator|&
name|nfsv4rootfs_lock
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
name|NFSV4ROOTLOCKMUTEXPTR
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
else|else
name|igotlock
operator|=
name|nfsv4_lock
argument_list|(
operator|&
name|nfsv4rootfs_lock
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NFSV4ROOTLOCKMUTEXPTR
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|NFSUNLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
if|if
condition|(
name|igotlock
condition|)
block|{
comment|/* 		 * If I got the lock, I can update the stable storage file. 		 * Done when the grace period is over or a client has long 		 * since expired. 		 */
name|nfsrv_stablefirst
operator|.
name|nsf_flags
operator|&=
operator|~
name|NFSNSF_NEEDLOCK
expr_stmt|;
if|if
condition|(
operator|(
name|nfsrv_stablefirst
operator|.
name|nsf_flags
operator|&
operator|(
name|NFSNSF_GRACEOVER
operator||
name|NFSNSF_UPDATEDONE
operator|)
operator|)
operator|==
name|NFSNSF_GRACEOVER
condition|)
name|nfsrv_updatestable
argument_list|(
name|p
argument_list|)
expr_stmt|;
comment|/* 		 * If at least one client has long since expired, search 		 * the client list for them, write a REVOKE record on the 		 * stable storage file and then remove them from the client 		 * list. 		 */
if|if
condition|(
name|nfsrv_stablefirst
operator|.
name|nsf_flags
operator|&
name|NFSNSF_EXPIREDCLIENT
condition|)
block|{
name|nfsrv_stablefirst
operator|.
name|nsf_flags
operator|&=
operator|~
name|NFSNSF_EXPIREDCLIENT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NFSCLIENTHASHSIZE
condition|;
name|i
operator|++
control|)
block|{
name|LIST_FOREACH_SAFE
argument_list|(
argument|clp
argument_list|,
argument|&nfsclienthash[i]
argument_list|,
argument|lc_hash
argument_list|,
argument|nclp
argument_list|)
block|{
if|if
condition|(
name|clp
operator|->
name|lc_flags
operator|&
name|LCL_EXPIREIT
condition|)
block|{
if|if
condition|(
operator|!
name|LIST_EMPTY
argument_list|(
operator|&
name|clp
operator|->
name|lc_open
argument_list|)
operator|||
operator|!
name|LIST_EMPTY
argument_list|(
operator|&
name|clp
operator|->
name|lc_deleg
argument_list|)
condition|)
name|nfsrv_writestable
argument_list|(
name|clp
operator|->
name|lc_id
argument_list|,
name|clp
operator|->
name|lc_idlen
argument_list|,
name|NFSNST_REVOKE
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|nfsrv_cleanclient
argument_list|(
name|clp
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|nfsrv_freedeleglist
argument_list|(
operator|&
name|clp
operator|->
name|lc_deleg
argument_list|)
expr_stmt|;
name|nfsrv_freedeleglist
argument_list|(
operator|&
name|clp
operator|->
name|lc_olddeleg
argument_list|)
expr_stmt|;
name|LIST_REMOVE
argument_list|(
name|clp
argument_list|,
name|lc_hash
argument_list|)
expr_stmt|;
name|nfsrv_zapclient
argument_list|(
name|clp
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
name|NFSLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
name|nfsv4_unlock
argument_list|(
operator|&
name|nfsv4rootfs_lock
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|NFSUNLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
block|}
else|else
block|{
comment|/* 		 * If we didn't get the lock, we need to get a refcnt, 		 * which also checks for and waits for the lock. 		 */
name|NFSLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
name|nfsv4_getref
argument_list|(
operator|&
name|nfsv4rootfs_lock
argument_list|,
name|NULL
argument_list|,
name|NFSV4ROOTLOCKMUTEXPTR
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|NFSUNLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
block|}
comment|/* 	 * If flagged, search for open owners that haven't had any opens 	 * for a long time. 	 */
if|if
condition|(
name|nfsrv_stablefirst
operator|.
name|nsf_flags
operator|&
name|NFSNSF_NOOPENS
condition|)
block|{
name|nfsrv_throwawayopens
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
name|savevp
operator|=
name|vp
operator|=
name|NULL
expr_stmt|;
name|save_fsid
operator|.
name|val
index|[
literal|0
index|]
operator|=
name|save_fsid
operator|.
name|val
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|cur_fsid
operator|.
name|val
index|[
literal|0
index|]
operator|=
name|cur_fsid
operator|.
name|val
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|NFSM_DISSECT
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
name|taglen
operator|=
name|fxdr_unsigned
argument_list|(
name|int
argument_list|,
operator|*
name|tl
argument_list|)
expr_stmt|;
if|if
condition|(
name|taglen
operator|<
literal|0
condition|)
block|{
name|error
operator|=
name|EBADRPC
expr_stmt|;
goto|goto
name|nfsmout
goto|;
block|}
if|if
condition|(
name|taglen
operator|<=
name|NFSV4_SMALLSTR
condition|)
name|tagstr
operator|=
name|tag
expr_stmt|;
else|else
name|tagstr
operator|=
name|malloc
argument_list|(
name|taglen
operator|+
literal|1
argument_list|,
name|M_TEMP
argument_list|,
name|M_WAITOK
argument_list|)
expr_stmt|;
name|error
operator|=
name|nfsrv_mtostr
argument_list|(
name|nd
argument_list|,
name|tagstr
argument_list|,
name|taglen
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
if|if
condition|(
name|taglen
operator|>
name|NFSV4_SMALLSTR
condition|)
name|free
argument_list|(
name|tagstr
argument_list|,
name|M_TEMP
argument_list|)
expr_stmt|;
name|taglen
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|nfsmout
goto|;
block|}
operator|(
name|void
operator|)
name|nfsm_strtom
argument_list|(
name|nd
argument_list|,
name|tag
argument_list|,
name|taglen
argument_list|)
expr_stmt|;
if|if
condition|(
name|taglen
operator|>
name|NFSV4_SMALLSTR
condition|)
block|{
name|free
argument_list|(
name|tagstr
argument_list|,
name|M_TEMP
argument_list|)
expr_stmt|;
block|}
name|NFSM_BUILD
argument_list|(
name|retopsp
argument_list|,
name|u_int32_t
operator|*
argument_list|,
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
name|NFSM_DISSECT
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
literal|2
operator|*
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
name|minorvers
operator|=
name|fxdr_unsigned
argument_list|(
name|u_int32_t
argument_list|,
operator|*
name|tl
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|minorvers
operator|!=
name|NFSV4_MINORVERSION
condition|)
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_MINORVERMISMATCH
expr_stmt|;
if|if
condition|(
name|nd
operator|->
name|nd_repstat
condition|)
name|numops
operator|=
literal|0
expr_stmt|;
else|else
name|numops
operator|=
name|fxdr_unsigned
argument_list|(
name|int
argument_list|,
operator|*
name|tl
argument_list|)
expr_stmt|;
comment|/* 	 * Loop around doing the sub ops. 	 * vp - is an unlocked vnode pointer for the CFH 	 * savevp - is an unlocked vnode pointer for the SAVEDFH 	 * (at some future date, it might turn out to be more appropriate 	 *  to keep the file handles instead of vnode pointers?) 	 * savevpnes and vpnes - are the export flags for the above. 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numops
condition|;
name|i
operator|++
control|)
block|{
name|NFSM_DISSECT
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
name|NFSM_BUILD
argument_list|(
name|repp
argument_list|,
name|u_int32_t
operator|*
argument_list|,
literal|2
operator|*
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
operator|*
name|repp
operator|=
operator|*
name|tl
expr_stmt|;
name|op
operator|=
name|fxdr_unsigned
argument_list|(
name|int
argument_list|,
operator|*
name|tl
argument_list|)
expr_stmt|;
if|if
condition|(
name|op
operator|<
name|NFSV4OP_ACCESS
operator|||
name|op
operator|>=
name|NFSV4OP_NOPS
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_OPILLEGAL
expr_stmt|;
operator|*
name|repp
operator|++
operator|=
name|txdr_unsigned
argument_list|(
name|NFSV4OP_OPILLEGAL
argument_list|)
expr_stmt|;
operator|*
name|repp
operator|=
name|nfsd_errmap
argument_list|(
name|nd
argument_list|)
expr_stmt|;
name|retops
operator|++
expr_stmt|;
break|break;
block|}
else|else
block|{
name|repp
operator|++
expr_stmt|;
block|}
comment|/* 		 * Check for a referral on the current FH and, if so, return 		 * NFSERR_MOVED for all ops that allow it, except Getattr. 		 */
if|if
condition|(
name|vp
operator|!=
name|NULL
operator|&&
name|op
operator|!=
name|NFSV4OP_GETATTR
operator|&&
name|nfsv4root_getreferral
argument_list|(
name|vp
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|!=
name|NULL
operator|&&
name|nfsrv_errmoved
argument_list|(
name|op
argument_list|)
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_MOVED
expr_stmt|;
operator|*
name|repp
operator|=
name|nfsd_errmap
argument_list|(
name|nd
argument_list|)
expr_stmt|;
name|retops
operator|++
expr_stmt|;
break|break;
block|}
name|nd
operator|->
name|nd_procnum
operator|=
name|op
expr_stmt|;
comment|/* 		 * If over flood level, reply NFSERR_RESOURCE, if at the first 		 * Op. (Since a client recovery from NFSERR_RESOURCE can get 		 * really nasty for certain Op sequences, I'll play it safe 		 * and only return the error at the beginning.) The cache 		 * will still function over flood level, but uses lots of 		 * mbufs.) 		 * If nfsrv_mallocmget_limit() returns True, the system is near 		 * to its limit for memory that malloc()/mget() can allocate. 		 */
if|if
condition|(
name|i
operator|==
literal|0
operator|&&
name|nd
operator|->
name|nd_rp
operator|->
name|rc_refcnt
operator|==
literal|0
operator|&&
operator|(
name|nfsrv_mallocmget_limit
argument_list|()
operator|||
name|nfsrc_tcpsavedreplies
operator|>
name|nfsrc_floodlevel
operator|)
condition|)
block|{
if|if
condition|(
name|nfsrc_tcpsavedreplies
operator|>
name|nfsrc_floodlevel
condition|)
block|{
name|printf
argument_list|(
literal|"nfsd server cache flooded, try to"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" increase nfsrc_floodlevel\n"
argument_list|)
expr_stmt|;
block|}
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_RESOURCE
expr_stmt|;
operator|*
name|repp
operator|=
name|nfsd_errmap
argument_list|(
name|nd
argument_list|)
expr_stmt|;
if|if
condition|(
name|op
operator|==
name|NFSV4OP_SETATTR
condition|)
block|{
comment|/* 				 * Setattr replies require a bitmap. 				 * even for errors like these. 				 */
name|NFSM_BUILD
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
operator|*
name|tl
operator|=
literal|0
expr_stmt|;
block|}
name|retops
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|savereply
condition|)
name|nd
operator|->
name|nd_flag
operator||=
name|ND_SAVEREPLY
expr_stmt|;
name|NFSINCRGLOBAL
argument_list|(
name|newnfsstats
operator|.
name|srvrpccnt
index|[
name|nd
operator|->
name|nd_procnum
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|NFSV4OP_PUTFH
case|:
name|error
operator|=
name|nfsrv_mtofh
argument_list|(
name|nd
argument_list|,
operator|&
name|fh
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
goto|goto
name|nfsmout
goto|;
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
name|nfsd_fhtovp
argument_list|(
name|nd
argument_list|,
operator|&
name|fh
argument_list|,
name|LK_SHARED
argument_list|,
operator|&
name|nvp
argument_list|,
operator|&
name|nes
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
comment|/* For now, allow this for non-export FHs */
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
block|{
if|if
condition|(
name|vp
condition|)
name|vrele
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vp
operator|=
name|nvp
expr_stmt|;
name|cur_fsid
operator|=
name|vp
operator|->
name|v_mount
operator|->
name|mnt_stat
operator|.
name|f_fsid
expr_stmt|;
name|VOP_UNLOCK
argument_list|(
name|vp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vpnes
operator|=
name|nes
expr_stmt|;
block|}
break|break;
case|case
name|NFSV4OP_PUTPUBFH
case|:
if|if
condition|(
name|nfs_pubfhset
condition|)
name|nfsd_fhtovp
argument_list|(
name|nd
argument_list|,
operator|&
name|nfs_pubfh
argument_list|,
name|LK_SHARED
argument_list|,
operator|&
name|nvp
argument_list|,
operator|&
name|nes
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
else|else
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
block|{
if|if
condition|(
name|vp
condition|)
name|vrele
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vp
operator|=
name|nvp
expr_stmt|;
name|cur_fsid
operator|=
name|vp
operator|->
name|v_mount
operator|->
name|mnt_stat
operator|.
name|f_fsid
expr_stmt|;
name|VOP_UNLOCK
argument_list|(
name|vp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vpnes
operator|=
name|nes
expr_stmt|;
block|}
break|break;
case|case
name|NFSV4OP_PUTROOTFH
case|:
if|if
condition|(
name|nfs_rootfhset
condition|)
block|{
name|nfsd_fhtovp
argument_list|(
name|nd
argument_list|,
operator|&
name|nfs_rootfh
argument_list|,
name|LK_SHARED
argument_list|,
operator|&
name|nvp
argument_list|,
operator|&
name|nes
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
block|{
if|if
condition|(
name|vp
condition|)
name|vrele
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vp
operator|=
name|nvp
expr_stmt|;
name|cur_fsid
operator|=
name|vp
operator|->
name|v_mount
operator|->
name|mnt_stat
operator|.
name|f_fsid
expr_stmt|;
name|VOP_UNLOCK
argument_list|(
name|vp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vpnes
operator|=
name|nes
expr_stmt|;
block|}
block|}
else|else
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
break|break;
case|case
name|NFSV4OP_SAVEFH
case|:
if|if
condition|(
name|vp
operator|&&
name|NFSVNO_EXPORTED
argument_list|(
operator|&
name|vpnes
argument_list|)
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
literal|0
expr_stmt|;
comment|/* If vp == savevp, a no-op */
if|if
condition|(
name|vp
operator|!=
name|savevp
condition|)
block|{
if|if
condition|(
name|savevp
condition|)
name|vrele
argument_list|(
name|savevp
argument_list|)
expr_stmt|;
name|VREF
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|savevp
operator|=
name|vp
expr_stmt|;
name|savevpnes
operator|=
name|vpnes
expr_stmt|;
name|save_fsid
operator|=
name|cur_fsid
expr_stmt|;
block|}
block|}
else|else
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
block|}
break|break;
case|case
name|NFSV4OP_RESTOREFH
case|:
if|if
condition|(
name|savevp
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
literal|0
expr_stmt|;
comment|/* If vp == savevp, a no-op */
if|if
condition|(
name|vp
operator|!=
name|savevp
condition|)
block|{
name|VREF
argument_list|(
name|savevp
argument_list|)
expr_stmt|;
name|vrele
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vp
operator|=
name|savevp
expr_stmt|;
name|vpnes
operator|=
name|savevpnes
expr_stmt|;
name|cur_fsid
operator|=
name|save_fsid
expr_stmt|;
block|}
block|}
else|else
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_RESTOREFH
expr_stmt|;
block|}
break|break;
default|default:
comment|/* 		     * Allow a Lookup, Getattr, GetFH, Secinfo on an 		     * non-exported directory if 		     * nfs_rootfhset. Do I need to allow any other Ops? 		     * (You can only have a non-exported vpnes if 		     *  nfs_rootfhset is true. See nfsd_fhtovp()) 		     * Allow AUTH_SYS to be used for file systems 		     * exported GSS only for certain Ops, to allow 		     * clients to do mounts more easily. 		     */
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|needscfh
operator|&&
name|vp
condition|)
block|{
if|if
condition|(
operator|!
name|NFSVNO_EXPORTED
argument_list|(
operator|&
name|vpnes
argument_list|)
operator|&&
name|op
operator|!=
name|NFSV4OP_LOOKUP
operator|&&
name|op
operator|!=
name|NFSV4OP_GETATTR
operator|&&
name|op
operator|!=
name|NFSV4OP_GETFH
operator|&&
name|op
operator|!=
name|NFSV4OP_SECINFO
condition|)
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
elseif|else
if|if
condition|(
name|nfsvno_testexp
argument_list|(
name|nd
argument_list|,
operator|&
name|vpnes
argument_list|)
operator|&&
name|op
operator|!=
name|NFSV4OP_LOOKUP
operator|&&
name|op
operator|!=
name|NFSV4OP_GETFH
operator|&&
name|op
operator|!=
name|NFSV4OP_GETATTR
operator|&&
name|op
operator|!=
name|NFSV4OP_SECINFO
condition|)
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_WRONGSEC
expr_stmt|;
if|if
condition|(
name|nd
operator|->
name|nd_repstat
condition|)
block|{
if|if
condition|(
name|op
operator|==
name|NFSV4OP_SETATTR
condition|)
block|{
comment|/* 				     * Setattr reply requires a bitmap 				     * even for errors like these. 				     */
name|NFSM_BUILD
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
operator|*
name|tl
operator|=
literal|0
expr_stmt|;
block|}
break|break;
block|}
block|}
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|retfh
operator|==
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|vp
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
break|break;
block|}
name|VREF
argument_list|(
name|vp
argument_list|)
expr_stmt|;
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|modifyfs
condition|)
name|vn_start_write
argument_list|(
name|vp
argument_list|,
operator|&
name|temp_mp
argument_list|,
name|V_WAIT
argument_list|)
expr_stmt|;
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv4_ops1
index|[
name|op
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|vp
operator|,
operator|&
name|nvp
operator|,
operator|(
name|fhandle_t
operator|*
operator|)
name|fh
operator|.
name|nfsrvfh_data
operator|,
name|p
operator|,
operator|&
name|vpnes
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
operator|&&
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
block|{
if|if
condition|(
name|op
operator|==
name|NFSV4OP_LOOKUP
operator|||
name|op
operator|==
name|NFSV4OP_LOOKUPP
condition|)
block|{
name|new_mp
operator|=
name|nvp
operator|->
name|v_mount
expr_stmt|;
if|if
condition|(
name|cur_fsid
operator|.
name|val
index|[
literal|0
index|]
operator|!=
name|new_mp
operator|->
name|mnt_stat
operator|.
name|f_fsid
operator|.
name|val
index|[
literal|0
index|]
operator|||
name|cur_fsid
operator|.
name|val
index|[
literal|1
index|]
operator|!=
name|new_mp
operator|->
name|mnt_stat
operator|.
name|f_fsid
operator|.
name|val
index|[
literal|1
index|]
condition|)
block|{
comment|/* crossed a server mount point */
name|nd
operator|->
name|nd_repstat
operator|=
name|nfsvno_checkexp
argument_list|(
name|new_mp
argument_list|,
name|nd
operator|->
name|nd_nam
argument_list|,
operator|&
name|nes
argument_list|,
operator|&
name|credanon
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
name|nd
operator|->
name|nd_repstat
operator|=
name|nfsd_excred
argument_list|(
name|nd
argument_list|,
operator|&
name|nes
argument_list|,
name|credanon
argument_list|)
expr_stmt|;
if|if
condition|(
name|credanon
operator|!=
name|NULL
condition|)
name|crfree
argument_list|(
name|credanon
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
block|{
name|vpnes
operator|=
name|nes
expr_stmt|;
name|cur_fsid
operator|=
name|new_mp
operator|->
name|mnt_stat
operator|.
name|f_fsid
expr_stmt|;
block|}
block|}
comment|/* Lookup ops return a locked vnode */
name|VOP_UNLOCK
argument_list|(
name|nvp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|nd
operator|->
name|nd_repstat
condition|)
block|{
name|vrele
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vp
operator|=
name|nvp
expr_stmt|;
block|}
else|else
name|vrele
argument_list|(
name|nvp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|modifyfs
condition|)
name|vn_finished_write
argument_list|(
name|temp_mp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|retfh
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|vp
operator|==
name|NULL
operator|||
name|savevp
operator|==
name|NULL
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
name|cur_fsid
operator|.
name|val
index|[
literal|0
index|]
operator|!=
name|save_fsid
operator|.
name|val
index|[
literal|0
index|]
operator|||
name|cur_fsid
operator|.
name|val
index|[
literal|1
index|]
operator|!=
name|save_fsid
operator|.
name|val
index|[
literal|1
index|]
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_XDEV
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|modifyfs
condition|)
name|vn_start_write
argument_list|(
name|savevp
argument_list|,
operator|&
name|temp_mp
argument_list|,
name|V_WAIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|vn_lock
argument_list|(
name|savevp
argument_list|,
name|LK_EXCLUSIVE
argument_list|)
operator|==
literal|0
condition|)
block|{
name|VREF
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|VREF
argument_list|(
name|savevp
argument_list|)
expr_stmt|;
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv4_ops2
index|[
name|op
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|savevp
operator|,
name|vp
operator|,
name|p
operator|,
operator|&
name|savevpnes
operator|,
operator|&
name|vpnes
operator|)
expr_stmt|;
block|}
else|else
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_PERM
expr_stmt|;
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|modifyfs
condition|)
name|vn_finished_write
argument_list|(
name|temp_mp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|retfh
operator|!=
literal|0
condition|)
name|panic
argument_list|(
literal|"nfsrvd_compound"
argument_list|)
expr_stmt|;
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|needscfh
condition|)
block|{
if|if
condition|(
name|vp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|modifyfs
condition|)
name|vn_start_write
argument_list|(
name|vp
argument_list|,
operator|&
name|temp_mp
argument_list|,
name|V_WAIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|vn_lock
argument_list|(
name|vp
argument_list|,
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|lktype
argument_list|)
operator|==
literal|0
condition|)
name|VREF
argument_list|(
name|vp
argument_list|)
expr_stmt|;
else|else
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_PERM
expr_stmt|;
block|}
else|else
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_NOFILEHANDLE
expr_stmt|;
if|if
condition|(
name|op
operator|==
name|NFSV4OP_SETATTR
condition|)
block|{
comment|/* 						 * Setattr reply requires a 						 * bitmap even for errors like 						 * these. 						 */
name|NFSM_BUILD
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
operator|*
name|tl
operator|=
literal|0
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|nd
operator|->
name|nd_repstat
operator|==
literal|0
condition|)
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv4_ops0
index|[
name|op
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|vp
operator|,
name|p
operator|,
operator|&
name|vpnes
operator|)
expr_stmt|;
if|if
condition|(
name|nfsv4_opflag
index|[
name|op
index|]
operator|.
name|modifyfs
condition|)
name|vn_finished_write
argument_list|(
name|temp_mp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|error
operator|=
operator|(
operator|*
operator|(
name|nfsrv4_ops0
index|[
name|op
index|]
operator|)
operator|)
operator|(
name|nd
operator|,
name|isdgram
operator|,
name|NULL
operator|,
name|p
operator|,
operator|&
name|vpnes
operator|)
expr_stmt|;
block|}
block|}
block|}
empty_stmt|;
if|if
condition|(
name|error
condition|)
block|{
if|if
condition|(
name|error
operator|==
name|EBADRPC
operator|||
name|error
operator|==
name|NFSERR_BADXDR
condition|)
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_BADXDR
expr_stmt|;
block|}
else|else
block|{
name|nd
operator|->
name|nd_repstat
operator|=
name|error
expr_stmt|;
name|printf
argument_list|(
literal|"nfsv4 comperr0=%d\n"
argument_list|,
name|error
argument_list|)
expr_stmt|;
block|}
name|error
operator|=
literal|0
expr_stmt|;
block|}
name|retops
operator|++
expr_stmt|;
if|if
condition|(
name|nd
operator|->
name|nd_repstat
condition|)
block|{
operator|*
name|repp
operator|=
name|nfsd_errmap
argument_list|(
name|nd
argument_list|)
expr_stmt|;
break|break;
block|}
else|else
block|{
operator|*
name|repp
operator|=
literal|0
expr_stmt|;
comment|/* NFS4_OK */
block|}
block|}
name|nfsmout
label|:
if|if
condition|(
name|error
condition|)
block|{
if|if
condition|(
name|error
operator|==
name|EBADRPC
operator|||
name|error
operator|==
name|NFSERR_BADXDR
condition|)
name|nd
operator|->
name|nd_repstat
operator|=
name|NFSERR_BADXDR
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"nfsv4 comperr1=%d\n"
argument_list|,
name|error
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|taglen
operator|==
operator|-
literal|1
condition|)
block|{
name|NFSM_BUILD
argument_list|(
name|tl
argument_list|,
name|u_int32_t
operator|*
argument_list|,
literal|2
operator|*
name|NFSX_UNSIGNED
argument_list|)
expr_stmt|;
operator|*
name|tl
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|tl
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|retopsp
operator|=
name|txdr_unsigned
argument_list|(
name|retops
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vp
condition|)
name|vrele
argument_list|(
name|vp
argument_list|)
expr_stmt|;
if|if
condition|(
name|savevp
condition|)
name|vrele
argument_list|(
name|savevp
argument_list|)
expr_stmt|;
name|NFSLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
name|nfsv4_relref
argument_list|(
operator|&
name|nfsv4rootfs_lock
argument_list|)
expr_stmt|;
name|NFSUNLOCKV4ROOTMUTEX
argument_list|()
expr_stmt|;
block|}
end_function

end_unit

