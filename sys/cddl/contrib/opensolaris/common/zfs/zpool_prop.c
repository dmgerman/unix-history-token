begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * CDDL HEADER START  *  * The contents of this file are subject to the terms of the  * Common Development and Distribution License (the "License").  * You may not use this file except in compliance with the License.  *  * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE  * or http://www.opensolaris.org/os/licensing.  * See the License for the specific language governing permissions  * and limitations under the License.  *  * When distributing Covered Code, include this CDDL HEADER in each  * file and include the License file at usr/src/OPENSOLARIS.LICENSE.  * If applicable, add the following below this CDDL HEADER, with the  * fields enclosed by brackets "[]" replaced with your own identifying  * information: Portions Copyright [yyyy] [name of copyright owner]  *  * CDDL HEADER END  */
end_comment

begin_comment
comment|/*  * Copyright (c) 2007, 2010, Oracle and/or its affiliates. All rights reserved.  * Copyright 2011 Nexenta Systems, Inc. All rights reserved.  * Copyright (c) 2012, 2014 by Delphix. All rights reserved.  */
end_comment

begin_include
include|#
directive|include
file|<sys/zio.h>
end_include

begin_include
include|#
directive|include
file|<sys/spa.h>
end_include

begin_include
include|#
directive|include
file|<sys/zfs_acl.h>
end_include

begin_include
include|#
directive|include
file|<sys/zfs_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/fs/zfs.h>
end_include

begin_include
include|#
directive|include
file|"zfs_prop.h"
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|_KERNEL
argument_list|)
end_if

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|zprop_desc_t
name|zpool_prop_table
index|[
name|ZPOOL_NUM_PROPS
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|zprop_desc_t
modifier|*
name|zpool_prop_get_table
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
operator|)
return|;
block|}
end_function

begin_function
name|void
name|zpool_prop_init
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|zprop_index_t
name|boolean_table
index|[]
init|=
block|{
block|{
literal|"off"
block|,
literal|0
block|}
block|,
block|{
literal|"on"
block|,
literal|1
block|}
block|,
block|{
name|NULL
block|}
block|}
decl_stmt|;
specifier|static
name|zprop_index_t
name|failuremode_table
index|[]
init|=
block|{
block|{
literal|"wait"
block|,
name|ZIO_FAILURE_MODE_WAIT
block|}
block|,
block|{
literal|"continue"
block|,
name|ZIO_FAILURE_MODE_CONTINUE
block|}
block|,
block|{
literal|"panic"
block|,
name|ZIO_FAILURE_MODE_PANIC
block|}
block|,
block|{
name|NULL
block|}
block|}
decl_stmt|;
comment|/* string properties */
name|zprop_register_string
argument_list|(
name|ZPOOL_PROP_ALTROOT
argument_list|,
literal|"altroot"
argument_list|,
name|NULL
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<path>"
argument_list|,
literal|"ALTROOT"
argument_list|)
expr_stmt|;
name|zprop_register_string
argument_list|(
name|ZPOOL_PROP_BOOTFS
argument_list|,
literal|"bootfs"
argument_list|,
name|NULL
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<filesystem>"
argument_list|,
literal|"BOOTFS"
argument_list|)
expr_stmt|;
name|zprop_register_string
argument_list|(
name|ZPOOL_PROP_CACHEFILE
argument_list|,
literal|"cachefile"
argument_list|,
name|NULL
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<file> | none"
argument_list|,
literal|"CACHEFILE"
argument_list|)
expr_stmt|;
name|zprop_register_string
argument_list|(
name|ZPOOL_PROP_COMMENT
argument_list|,
literal|"comment"
argument_list|,
name|NULL
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<comment-string>"
argument_list|,
literal|"COMMENT"
argument_list|)
expr_stmt|;
comment|/* readonly number properties */
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_SIZE
argument_list|,
literal|"size"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"SIZE"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_FREE
argument_list|,
literal|"free"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"FREE"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_FREEING
argument_list|,
literal|"freeing"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"FREEING"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_LEAKED
argument_list|,
literal|"leaked"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"LEAKED"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_ALLOCATED
argument_list|,
literal|"allocated"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"ALLOC"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_EXPANDSZ
argument_list|,
literal|"expandsize"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"EXPANDSZ"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_FRAGMENTATION
argument_list|,
literal|"fragmentation"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<percent>"
argument_list|,
literal|"FRAG"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_CAPACITY
argument_list|,
literal|"capacity"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<size>"
argument_list|,
literal|"CAP"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_GUID
argument_list|,
literal|"guid"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<guid>"
argument_list|,
literal|"GUID"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_HEALTH
argument_list|,
literal|"health"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<state>"
argument_list|,
literal|"HEALTH"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_DEDUPRATIO
argument_list|,
literal|"dedupratio"
argument_list|,
literal|0
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<1.00x or higher if deduped>"
argument_list|,
literal|"DEDUP"
argument_list|)
expr_stmt|;
comment|/* default number properties */
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_VERSION
argument_list|,
literal|"version"
argument_list|,
name|SPA_VERSION
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<version>"
argument_list|,
literal|"VERSION"
argument_list|)
expr_stmt|;
name|zprop_register_number
argument_list|(
name|ZPOOL_PROP_DEDUPDITTO
argument_list|,
literal|"dedupditto"
argument_list|,
literal|0
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"<threshold (min 100)>"
argument_list|,
literal|"DEDUPDITTO"
argument_list|)
expr_stmt|;
comment|/* default index (boolean) properties */
name|zprop_register_index
argument_list|(
name|ZPOOL_PROP_DELEGATION
argument_list|,
literal|"delegation"
argument_list|,
literal|1
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"on | off"
argument_list|,
literal|"DELEGATION"
argument_list|,
name|boolean_table
argument_list|)
expr_stmt|;
name|zprop_register_index
argument_list|(
name|ZPOOL_PROP_AUTOREPLACE
argument_list|,
literal|"autoreplace"
argument_list|,
literal|0
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"on | off"
argument_list|,
literal|"REPLACE"
argument_list|,
name|boolean_table
argument_list|)
expr_stmt|;
name|zprop_register_index
argument_list|(
name|ZPOOL_PROP_LISTSNAPS
argument_list|,
literal|"listsnapshots"
argument_list|,
literal|0
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"on | off"
argument_list|,
literal|"LISTSNAPS"
argument_list|,
name|boolean_table
argument_list|)
expr_stmt|;
name|zprop_register_index
argument_list|(
name|ZPOOL_PROP_AUTOEXPAND
argument_list|,
literal|"autoexpand"
argument_list|,
literal|0
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"on | off"
argument_list|,
literal|"EXPAND"
argument_list|,
name|boolean_table
argument_list|)
expr_stmt|;
name|zprop_register_index
argument_list|(
name|ZPOOL_PROP_READONLY
argument_list|,
literal|"readonly"
argument_list|,
literal|0
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"on | off"
argument_list|,
literal|"RDONLY"
argument_list|,
name|boolean_table
argument_list|)
expr_stmt|;
comment|/* default index properties */
name|zprop_register_index
argument_list|(
name|ZPOOL_PROP_FAILUREMODE
argument_list|,
literal|"failmode"
argument_list|,
name|ZIO_FAILURE_MODE_WAIT
argument_list|,
name|PROP_DEFAULT
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"wait | continue | panic"
argument_list|,
literal|"FAILMODE"
argument_list|,
name|failuremode_table
argument_list|)
expr_stmt|;
comment|/* hidden properties */
name|zprop_register_hidden
argument_list|(
name|ZPOOL_PROP_NAME
argument_list|,
literal|"name"
argument_list|,
name|PROP_TYPE_STRING
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"NAME"
argument_list|)
expr_stmt|;
name|zprop_register_hidden
argument_list|(
name|ZPOOL_PROP_MAXBLOCKSIZE
argument_list|,
literal|"maxblocksize"
argument_list|,
name|PROP_TYPE_NUMBER
argument_list|,
name|PROP_READONLY
argument_list|,
name|ZFS_TYPE_POOL
argument_list|,
literal|"MAXBLOCKSIZE"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Given a property name and its type, returns the corresponding property ID.  */
end_comment

begin_function
name|zpool_prop_t
name|zpool_name_to_prop
parameter_list|(
specifier|const
name|char
modifier|*
name|propname
parameter_list|)
block|{
return|return
operator|(
name|zprop_name_to_prop
argument_list|(
name|propname
argument_list|,
name|ZFS_TYPE_POOL
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Given a pool property ID, returns the corresponding name.  * Assuming the pool propety ID is valid.  */
end_comment

begin_function
specifier|const
name|char
modifier|*
name|zpool_prop_to_name
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_name
operator|)
return|;
block|}
end_function

begin_function
name|zprop_type_t
name|zpool_prop_get_type
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_proptype
operator|)
return|;
block|}
end_function

begin_function
name|boolean_t
name|zpool_prop_readonly
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_attr
operator|==
name|PROP_READONLY
operator|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|zpool_prop_default_string
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_strdefault
operator|)
return|;
block|}
end_function

begin_function
name|uint64_t
name|zpool_prop_default_numeric
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_numdefault
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Returns true if this is a valid feature@ property.  */
end_comment

begin_function
name|boolean_t
name|zpool_prop_feature
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|prefix
init|=
literal|"feature@"
decl_stmt|;
return|return
operator|(
name|strncmp
argument_list|(
name|name
argument_list|,
name|prefix
argument_list|,
name|strlen
argument_list|(
name|prefix
argument_list|)
argument_list|)
operator|==
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Returns true if this is a valid unsupported@ property.  */
end_comment

begin_function
name|boolean_t
name|zpool_prop_unsupported
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|prefix
init|=
literal|"unsupported@"
decl_stmt|;
return|return
operator|(
name|strncmp
argument_list|(
name|name
argument_list|,
name|prefix
argument_list|,
name|strlen
argument_list|(
name|prefix
argument_list|)
argument_list|)
operator|==
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|zpool_prop_string_to_index
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|,
name|uint64_t
modifier|*
name|index
parameter_list|)
block|{
return|return
operator|(
name|zprop_string_to_index
argument_list|(
name|prop
argument_list|,
name|string
argument_list|,
name|index
argument_list|,
name|ZFS_TYPE_POOL
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|zpool_prop_index_to_string
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|,
name|uint64_t
name|index
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|string
parameter_list|)
block|{
return|return
operator|(
name|zprop_index_to_string
argument_list|(
name|prop
argument_list|,
name|index
argument_list|,
name|string
argument_list|,
name|ZFS_TYPE_POOL
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|uint64_t
name|zpool_prop_random_value
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|,
name|uint64_t
name|seed
parameter_list|)
block|{
return|return
operator|(
name|zprop_random_value
argument_list|(
name|prop
argument_list|,
name|seed
argument_list|,
name|ZFS_TYPE_POOL
argument_list|)
operator|)
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|_KERNEL
end_ifndef

begin_function
specifier|const
name|char
modifier|*
name|zpool_prop_values
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_values
operator|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|zpool_prop_column_name
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_colname
operator|)
return|;
block|}
end_function

begin_function
name|boolean_t
name|zpool_prop_align_right
parameter_list|(
name|zpool_prop_t
name|prop
parameter_list|)
block|{
return|return
operator|(
name|zpool_prop_table
index|[
name|prop
index|]
operator|.
name|pd_rightalign
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

