begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2007 Robert N. M. Watson  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * Debugger routines relating to sockets, protocols, etc, for use in DDB.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"opt_ddb.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/domain.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/protosw.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/socketvar.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|DDB
end_ifdef

begin_include
include|#
directive|include
file|<ddb/ddb.h>
end_include

begin_function
specifier|static
name|void
name|db_print_sotype
parameter_list|(
name|short
name|so_type
parameter_list|)
block|{
switch|switch
condition|(
name|so_type
condition|)
block|{
case|case
name|SOCK_STREAM
case|:
name|db_printf
argument_list|(
literal|"SOCK_STREAM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SOCK_DGRAM
case|:
name|db_printf
argument_list|(
literal|"SOCK_DGRAM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SOCK_RAW
case|:
name|db_printf
argument_list|(
literal|"SOCK_RAW"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SOCK_RDM
case|:
name|db_printf
argument_list|(
literal|"SOCK_RDM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SOCK_SEQPACKET
case|:
name|db_printf
argument_list|(
literal|"SOCK_SEQPACKET"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|db_printf
argument_list|(
literal|"unknown"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_sooptions
parameter_list|(
name|short
name|so_options
parameter_list|)
block|{
name|int
name|comma
decl_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|so_options
operator|&
name|SO_DEBUG
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_DEBUG"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_ACCEPTCONN
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_ACCEPTCONN"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_REUSEADDR
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_REUSEADDR"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_KEEPALIVE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_KEEPALIVE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_DONTROUTE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_DONTROUTE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_BROADCAST
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_BROADCAST"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_USELOOPBACK
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_USELOOPBACK"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_LINGER
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_LINGER"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_OOBINLINE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_OOBINLINE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_REUSEPORT
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_REUSEPORT"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_TIMESTAMP
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_TIMESTAMP"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_NOSIGPIPE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_NOSIGPIPE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_ACCEPTFILTER
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_ACCEPTFILTER"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_options
operator|&
name|SO_BINTIME
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSO_BINTIME"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_sostate
parameter_list|(
name|short
name|so_state
parameter_list|)
block|{
name|int
name|comma
decl_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|so_state
operator|&
name|SS_NOFDREF
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_FDREF"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_state
operator|&
name|SS_ISCONNECTED
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_ISCONNECTED"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_state
operator|&
name|SS_ISCONNECTING
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_ISCONNECTING"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_state
operator|&
name|SS_ISDISCONNECTING
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_ISDISCONNECTING"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_state
operator|&
name|SS_NBIO
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_NBIO"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_state
operator|&
name|SS_ASYNC
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_ASYNC"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_state
operator|&
name|SS_ISCONFIRMING
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_ISCONFIRMING"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|so_state
operator|&
name|SS_PROTOREF
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_PROTOREF"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_soqstate
parameter_list|(
name|int
name|so_qstate
parameter_list|)
block|{
name|int
name|comma
decl_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|so_qstate
operator|&
name|SQ_INCOMP
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSQ_INCOMP"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|so_qstate
operator|&
name|SQ_COMP
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSQ_COMP"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_sbstate
parameter_list|(
name|short
name|sb_state
parameter_list|)
block|{
name|int
name|comma
decl_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sb_state
operator|&
name|SBS_CANTSENDMORE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_CANTSENDMORE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_state
operator|&
name|SBS_CANTRCVMORE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_CANTRCVMORE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_state
operator|&
name|SBS_RCVATMARK
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSS_RCVATMARK"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_indent
parameter_list|(
name|int
name|indent
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|indent
condition|;
name|i
operator|++
control|)
name|db_printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_domain
parameter_list|(
name|struct
name|domain
modifier|*
name|d
parameter_list|,
specifier|const
name|char
modifier|*
name|domainname
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s at %p\n"
argument_list|,
name|domainname
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|indent
operator|+=
literal|2
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_family: %d   "
argument_list|,
name|d
operator|->
name|dom_family
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_name: %s\n"
argument_list|,
name|d
operator|->
name|dom_name
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_init: %p   "
argument_list|,
name|d
operator|->
name|dom_init
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_externalize: %p   "
argument_list|,
name|d
operator|->
name|dom_externalize
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_dispose: %p\n"
argument_list|,
name|d
operator|->
name|dom_dispose
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_protosw: %p   "
argument_list|,
name|d
operator|->
name|dom_protosw
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_next: %p\n"
argument_list|,
name|d
operator|->
name|dom_next
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_rtattach: %p   "
argument_list|,
name|d
operator|->
name|dom_rtattach
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_rtoffset: %d   "
argument_list|,
name|d
operator|->
name|dom_rtoffset
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_maxrtkey: %d\n"
argument_list|,
name|d
operator|->
name|dom_maxrtkey
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_ifattach: %p   "
argument_list|,
name|d
operator|->
name|dom_ifattach
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dom_ifdetach: %p\n"
argument_list|,
name|d
operator|->
name|dom_ifdetach
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_prflags
parameter_list|(
name|short
name|pr_flags
parameter_list|)
block|{
name|int
name|comma
decl_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pr_flags
operator|&
name|PR_ATOMIC
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_ATOMIC"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pr_flags
operator|&
name|PR_ADDR
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_ADDR"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pr_flags
operator|&
name|PR_CONNREQUIRED
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_CONNREQUIRED"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pr_flags
operator|&
name|PR_WANTRCVD
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_WANTRCVD"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pr_flags
operator|&
name|PR_RIGHTS
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_RIGHTS"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pr_flags
operator|&
name|PR_IMPLOPCL
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_IMPLOPCL"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pr_flags
operator|&
name|PR_LASTHDR
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sPR_LASTHDR"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_protosw
parameter_list|(
name|struct
name|protosw
modifier|*
name|pr
parameter_list|,
specifier|const
name|char
modifier|*
name|prname
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s at %p\n"
argument_list|,
name|prname
argument_list|,
name|pr
argument_list|)
expr_stmt|;
name|indent
operator|+=
literal|2
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_type: %d   "
argument_list|,
name|pr
operator|->
name|pr_type
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_domain: %p\n"
argument_list|,
name|pr
operator|->
name|pr_domain
argument_list|)
expr_stmt|;
if|if
condition|(
name|pr
operator|->
name|pr_domain
operator|!=
name|NULL
condition|)
name|db_print_domain
argument_list|(
name|pr
operator|->
name|pr_domain
argument_list|,
literal|"pr_domain"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_protocol: %d\n"
argument_list|,
name|pr
operator|->
name|pr_protocol
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_flags: %d ("
argument_list|,
name|pr
operator|->
name|pr_flags
argument_list|)
expr_stmt|;
name|db_print_prflags
argument_list|(
name|pr
operator|->
name|pr_flags
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_input: %p   "
argument_list|,
name|pr
operator|->
name|pr_input
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_output: %p   "
argument_list|,
name|pr
operator|->
name|pr_output
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_ctlinput: %p\n"
argument_list|,
name|pr
operator|->
name|pr_ctlinput
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_ctloutput: %p   "
argument_list|,
name|pr
operator|->
name|pr_ctloutput
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_ousrreq: %p   "
argument_list|,
name|pr
operator|->
name|pr_ousrreq
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_init: %p\n"
argument_list|,
name|pr
operator|->
name|pr_init
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_fasttimo: %p   "
argument_list|,
name|pr
operator|->
name|pr_fasttimo
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_slowtimo: %p   "
argument_list|,
name|pr
operator|->
name|pr_slowtimo
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_drain: %p\n"
argument_list|,
name|pr
operator|->
name|pr_drain
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"pr_ousrreq: %p\n"
argument_list|,
name|pr
operator|->
name|pr_ousrreq
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_sbflags
parameter_list|(
name|short
name|sb_flags
parameter_list|)
block|{
name|int
name|comma
decl_stmt|;
name|comma
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sb_flags
operator|&
name|SB_LOCK
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_LOCK"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_WANT
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_WANT"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_WAIT
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_WAIT"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_SEL
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_SEL"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_ASYNC
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_ASYNC"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_UPCALL
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_UPCALL"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_NOINTR
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_NOINTR"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_AIO
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_AIO"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_KNOTE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_KNOTE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|sb_flags
operator|&
name|SB_AUTOSIZE
condition|)
block|{
name|db_printf
argument_list|(
literal|"%sSB_AUTOSIZE"
argument_list|,
name|comma
condition|?
literal|", "
else|:
literal|""
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_sockbuf
parameter_list|(
name|struct
name|sockbuf
modifier|*
name|sb
parameter_list|,
specifier|const
name|char
modifier|*
name|sockbufname
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s at %p\n"
argument_list|,
name|sockbufname
argument_list|,
name|sb
argument_list|)
expr_stmt|;
name|indent
operator|+=
literal|2
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_state: 0x%x ("
argument_list|,
name|sb
operator|->
name|sb_state
argument_list|)
expr_stmt|;
name|db_print_sbstate
argument_list|(
name|sb
operator|->
name|sb_state
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_mb: %p   "
argument_list|,
name|sb
operator|->
name|sb_mb
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_mbtail: %p   "
argument_list|,
name|sb
operator|->
name|sb_mbtail
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_lastrecord: %p\n"
argument_list|,
name|sb
operator|->
name|sb_lastrecord
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_cc: %d   "
argument_list|,
name|sb
operator|->
name|sb_cc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_hiwat: %d   "
argument_list|,
name|sb
operator|->
name|sb_hiwat
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_mbcnt: %d   "
argument_list|,
name|sb
operator|->
name|sb_mbcnt
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_mbmax: %d\n"
argument_list|,
name|sb
operator|->
name|sb_mbmax
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_ctl: %d   "
argument_list|,
name|sb
operator|->
name|sb_ctl
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_lowat: %d   "
argument_list|,
name|sb
operator|->
name|sb_lowat
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_timeo: %d\n"
argument_list|,
name|sb
operator|->
name|sb_timeo
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"sb_flags: 0x%x ("
argument_list|,
name|sb
operator|->
name|sb_flags
argument_list|)
expr_stmt|;
name|db_print_sbflags
argument_list|(
name|sb
operator|->
name|sb_flags
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|db_print_socket
parameter_list|(
name|struct
name|socket
modifier|*
name|so
parameter_list|,
specifier|const
name|char
modifier|*
name|socketname
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s at %p\n"
argument_list|,
name|socketname
argument_list|,
name|so
argument_list|)
expr_stmt|;
name|indent
operator|+=
literal|2
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_count: %d   "
argument_list|,
name|so
operator|->
name|so_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_type: %d ("
argument_list|,
name|so
operator|->
name|so_type
argument_list|)
expr_stmt|;
name|db_print_sotype
argument_list|(
name|so
operator|->
name|so_type
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_options: 0x%x ("
argument_list|,
name|so
operator|->
name|so_options
argument_list|)
expr_stmt|;
name|db_print_sooptions
argument_list|(
name|so
operator|->
name|so_options
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_linger: %d   "
argument_list|,
name|so
operator|->
name|so_linger
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_state: 0x%x ("
argument_list|,
name|so
operator|->
name|so_state
argument_list|)
expr_stmt|;
name|db_print_sostate
argument_list|(
name|so
operator|->
name|so_state
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_qstate: 0x%x ("
argument_list|,
name|so
operator|->
name|so_qstate
argument_list|)
expr_stmt|;
name|db_print_soqstate
argument_list|(
name|so
operator|->
name|so_qstate
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|")   "
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_pcb: %p   "
argument_list|,
name|so
operator|->
name|so_pcb
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_proto: %p\n"
argument_list|,
name|so
operator|->
name|so_proto
argument_list|)
expr_stmt|;
if|if
condition|(
name|so
operator|->
name|so_proto
operator|!=
name|NULL
condition|)
name|db_print_protosw
argument_list|(
name|so
operator|->
name|so_proto
argument_list|,
literal|"so_proto"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_head: %p   "
argument_list|,
name|so
operator|->
name|so_head
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_incomp first: %p   "
argument_list|,
name|TAILQ_FIRST
argument_list|(
operator|&
name|so
operator|->
name|so_incomp
argument_list|)
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_comp first: %p\n"
argument_list|,
name|TAILQ_FIRST
argument_list|(
operator|&
name|so
operator|->
name|so_comp
argument_list|)
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
comment|/* so_list skipped */
name|db_printf
argument_list|(
literal|"so_qlen: %d   "
argument_list|,
name|so
operator|->
name|so_qlen
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_incqlen: %d   "
argument_list|,
name|so
operator|->
name|so_incqlen
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_qlimit: %d   "
argument_list|,
name|so
operator|->
name|so_qlimit
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_timeo: %d   "
argument_list|,
name|so
operator|->
name|so_timeo
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_error: %d\n"
argument_list|,
name|so
operator|->
name|so_error
argument_list|)
expr_stmt|;
name|db_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_sigio: %p   "
argument_list|,
name|so
operator|->
name|so_sigio
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_oobmark: %lu   "
argument_list|,
name|so
operator|->
name|so_oobmark
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"so_aiojobq first: %p\n"
argument_list|,
name|TAILQ_FIRST
argument_list|(
operator|&
name|so
operator|->
name|so_aiojobq
argument_list|)
argument_list|)
expr_stmt|;
name|db_print_sockbuf
argument_list|(
operator|&
name|so
operator|->
name|so_rcv
argument_list|,
literal|"so_rcv"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|db_print_sockbuf
argument_list|(
operator|&
name|so
operator|->
name|so_snd
argument_list|,
literal|"so_snd"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|socket
argument_list|,
argument|db_show_socket
argument_list|)
end_macro

begin_block
block|{
name|struct
name|socket
modifier|*
name|so
decl_stmt|;
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show socket<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|so
operator|=
operator|(
expr|struct
name|socket
operator|*
operator|)
name|addr
expr_stmt|;
name|db_print_socket
argument_list|(
name|so
argument_list|,
literal|"socket"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|sockbuf
argument_list|,
argument|db_show_sockbuf
argument_list|)
end_macro

begin_block
block|{
name|struct
name|sockbuf
modifier|*
name|sb
decl_stmt|;
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show sockbuf<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|sb
operator|=
operator|(
expr|struct
name|sockbuf
operator|*
operator|)
name|addr
expr_stmt|;
name|db_print_sockbuf
argument_list|(
name|sb
argument_list|,
literal|"sockbuf"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|protosw
argument_list|,
argument|db_show_protosw
argument_list|)
end_macro

begin_block
block|{
name|struct
name|protosw
modifier|*
name|pr
decl_stmt|;
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show protosw<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pr
operator|=
operator|(
expr|struct
name|protosw
operator|*
operator|)
name|addr
expr_stmt|;
name|db_print_protosw
argument_list|(
name|pr
argument_list|,
literal|"protosw"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|domain
argument_list|,
argument|db_show_domain
argument_list|)
end_macro

begin_block
block|{
name|struct
name|domain
modifier|*
name|d
decl_stmt|;
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show protosw<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|d
operator|=
operator|(
expr|struct
name|domain
operator|*
operator|)
name|addr
expr_stmt|;
name|db_print_domain
argument_list|(
name|d
argument_list|,
literal|"domain"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

