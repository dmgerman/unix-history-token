begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1997, 2002 Hellmuth Michaelis. All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  *---------------------------------------------------------------------------  *  *	i4b_l2fsm.c - layer 2 FSM  *	-------------------------  *  * $FreeBSD$  *  *      last edit-date: [Sat Mar  9 16:14:07 2002]  *  *---------------------------------------------------------------------------*/
end_comment

begin_include
include|#
directive|include
file|"i4bq921.h"
end_include

begin_if
if|#
directive|if
name|NI4BQ921
operator|>
literal|0
end_if

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<machine/i4b_debug.h>
end_include

begin_include
include|#
directive|include
file|<machine/i4b_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<i4b/include/i4b_global.h>
end_include

begin_include
include|#
directive|include
file|<i4b/include/i4b_l2l3.h>
end_include

begin_include
include|#
directive|include
file|<i4b/include/i4b_mbuf.h>
end_include

begin_include
include|#
directive|include
file|<i4b/layer2/i4b_l2.h>
end_include

begin_include
include|#
directive|include
file|<i4b/layer2/i4b_l2fsm.h>
end_include

begin_decl_stmt
name|l2_softc_t
name|l2_softc
index|[
name|MAXL1UNITS
index|]
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
name|DO_I4B_DEBUG
end_if

begin_decl_stmt
specifier|static
name|char
modifier|*
name|l2state_text
index|[
name|N_STATES
index|]
init|=
block|{
literal|"ST_TEI_UNAS"
block|,
literal|"ST_ASG_AW_TEI"
block|,
literal|"ST_EST_AW_TEI"
block|,
literal|"ST_TEI_ASGD"
block|,
literal|"ST_AW_EST"
block|,
literal|"ST_AW_REL"
block|,
literal|"ST_MULTIFR"
block|,
literal|"ST_TIMREC"
block|,
literal|"ST_SUBSET"
block|,
literal|"Illegal State"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|l2event_text
index|[
name|N_EVENTS
index|]
init|=
block|{
literal|"EV_DLESTRQ"
block|,
literal|"EV_DLUDTRQ"
block|,
literal|"EV_MDASGRQ"
block|,
literal|"EV_MDERRRS"
block|,
literal|"EV_PSDEACT"
block|,
literal|"EV_MDREMRQ"
block|,
literal|"EV_RXSABME"
block|,
literal|"EV_RXDISC"
block|,
literal|"EV_RXUA"
block|,
literal|"EV_RXDM"
block|,
literal|"EV_T200EXP"
block|,
literal|"EV_DLDATRQ"
block|,
literal|"EV_DLRELRQ"
block|,
literal|"EV_T203EXP"
block|,
literal|"EV_OWNBUSY"
block|,
literal|"EV_OWNRDY"
block|,
literal|"EV_RXRR"
block|,
literal|"EV_RXREJ"
block|,
literal|"EV_RXRNR"
block|,
literal|"EV_RXFRMR"
block|,
literal|"Illegal Event"
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|void
name|F_TU01
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TU03
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TA03
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TA04
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TA05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TE03
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TE04
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TE05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T01
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T06
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T07
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T08
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T09
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T10
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_T13
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE01
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE06
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE07
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE08
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE09
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE10
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE11
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AE12
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR06
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR07
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR08
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR09
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR10
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_AR11
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF01
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF06
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF07
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF08
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF09
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF10
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF11
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF12
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF13
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF14
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF15
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF16
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF17
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF18
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF19
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_MF20
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR01
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR05
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR06
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR07
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR08
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR09
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR10
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR11
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR12
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR13
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR15
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR16
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR17
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR18
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR19
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_TR20
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_ILL
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|F_NCNA
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM illegal state default action  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_ILL
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_ERR
argument_list|,
literal|"FSM function F_ILL executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM No change, No action  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_NCNA
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_NCNA executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	layer 2 state transition table  *---------------------------------------------------------------------------*/
end_comment

begin_struct
struct|struct
name|l2state_tab
block|{
name|void
argument_list|(
argument|*func
argument_list|)
name|__P
argument_list|(
operator|(
name|l2_softc_t
operator|*
operator|)
argument_list|)
expr_stmt|;
comment|/* function to execute */
name|int
name|newstate
decl_stmt|;
comment|/* next state */
block|}
name|l2state_tab
index|[
name|N_EVENTS
index|]
index|[
name|N_STATES
index|]
init|=
block|{
comment|/* STATE:	ST_TEI_UNAS,			ST_ASG_AW_TEI,			ST_EST_AW_TEI,			ST_TEI_ASGD,		ST_AW_EST,		ST_AW_REL,		ST_MULTIFR,		ST_TIMREC,		ST_SUBSET,		ILLEGAL STATE	*/
comment|/* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
comment|/*EV_DLESTRQ*/
block|{
block|{
name|F_TU01
block|,
name|ST_EST_AW_TEI
block|}
block|,
block|{
name|F_NCNA
block|,
name|ST_EST_AW_TEI
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T01
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_AE01
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF01
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_TR01
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_DLUDTRQ*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_MDASGRQ*/
block|{
block|{
name|F_TU03
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_TA03
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_TE03
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_MDERRRS*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_TA04
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_TE04
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_PSDEACT*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_TA05
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_TE05
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_T05
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_AE05
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_AR05
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_MF05
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_TR05
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_MDREMRQ*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T06
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_AE06
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_AR06
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_MF06
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_TR06
block|,
name|ST_TEI_UNAS
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXSABME*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T07
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_AE07
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_AR07
block|,
name|ST_AW_REL
block|}
block|,
block|{
name|F_MF07
block|,
name|ST_MULTIFR
block|}
block|,
block|{
name|F_TR07
block|,
name|ST_MULTIFR
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXDISC */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T08
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_AE08
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_AR08
block|,
name|ST_AW_REL
block|}
block|,
block|{
name|F_MF08
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_TR08
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXUA   */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T09
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_AE09
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_AR09
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_MF09
block|,
name|ST_MULTIFR
block|}
block|,
block|{
name|F_TR09
block|,
name|ST_TIMREC
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXDM   */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T10
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_AE10
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_AR10
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_MF10
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_TR10
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_T200EXP*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_AE11
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_AR11
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_MF11
block|,
name|ST_TIMREC
block|}
block|,
block|{
name|F_TR11
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_DLDATRQ*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_AE12
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF12
block|,
name|ST_MULTIFR
block|}
block|,
block|{
name|F_TR12
block|,
name|ST_TIMREC
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_DLRELRQ*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_T13
block|,
name|ST_TEI_ASGD
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF13
block|,
name|ST_AW_REL
block|}
block|,
block|{
name|F_TR13
block|,
name|ST_AW_REL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_T203EXP*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF14
block|,
name|ST_TIMREC
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_OWNBUSY*/
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF15
block|,
name|ST_MULTIFR
block|}
block|,
block|{
name|F_TR15
block|,
name|ST_TIMREC
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_OWNRDY */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF16
block|,
name|ST_MULTIFR
block|}
block|,
block|{
name|F_TR16
block|,
name|ST_TIMREC
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXRR   */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF17
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_TR17
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXREJ  */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF18
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_TR18
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXRNR  */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF19
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_TR19
block|,
name|ST_SUBSET
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_RXFRMR */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_MF20
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_TR20
block|,
name|ST_AW_EST
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|,
comment|/*EV_ILL    */
block|{
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|,
block|{
name|F_ILL
block|,
name|ST_ILL
block|}
block|}
block|}
struct|;
end_struct

begin_comment
comment|/*---------------------------------------------------------------------------*  *	event handler, executes function and sets new state  *---------------------------------------------------------------------------*/
end_comment

begin_function
name|void
name|i4b_next_l2state
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|,
name|int
name|event
parameter_list|)
block|{
name|int
name|currstate
decl_stmt|,
name|newstate
decl_stmt|;
name|int
function_decl|(
modifier|*
name|savpostfsmfunc
function_decl|)
parameter_list|(
name|int
parameter_list|)
init|=
name|NULL
function_decl|;
comment|/* check event number */
if|if
condition|(
name|event
operator|>
name|N_EVENTS
condition|)
name|panic
argument_list|(
literal|"i4b_l2fsm.c: event> N_EVENTS\n"
argument_list|)
expr_stmt|;
comment|/* get current state and check it */
if|if
condition|(
operator|(
name|currstate
operator|=
name|l2sc
operator|->
name|Q921_state
operator|)
operator|>
name|N_STATES
condition|)
comment|/* failsafe */
name|panic
argument_list|(
literal|"i4b_l2fsm.c: currstate> N_STATES\n"
argument_list|)
expr_stmt|;
comment|/* get new state and check it */
if|if
condition|(
operator|(
name|newstate
operator|=
name|l2state_tab
index|[
name|event
index|]
index|[
name|currstate
index|]
operator|.
name|newstate
operator|)
operator|>
name|N_STATES
condition|)
name|panic
argument_list|(
literal|"i4b_l2fsm.c: newstate> N_STATES\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|newstate
operator|!=
name|ST_SUBSET
condition|)
block|{
comment|/* state function does NOT set new state */
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM event [%s]: [%s/%d => %s/%d]"
argument_list|,
name|l2event_text
index|[
name|event
index|]
argument_list|,
name|l2state_text
index|[
name|currstate
index|]
argument_list|,
name|currstate
argument_list|,
name|l2state_text
index|[
name|newstate
index|]
argument_list|,
name|newstate
argument_list|)
expr_stmt|;
block|}
comment|/* execute state transition function */
operator|(
operator|*
name|l2state_tab
index|[
name|event
index|]
index|[
name|currstate
index|]
operator|.
name|func
operator|)
operator|(
name|l2sc
operator|)
expr_stmt|;
if|if
condition|(
name|newstate
operator|==
name|ST_SUBSET
condition|)
block|{
comment|/* state function DOES set new state */
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM S-event [%s]: [%s => %s]"
argument_list|,
name|l2event_text
index|[
name|event
index|]
argument_list|,
name|l2state_text
index|[
name|currstate
index|]
argument_list|,
name|l2state_text
index|[
name|l2sc
operator|->
name|Q921_state
index|]
argument_list|)
expr_stmt|;
block|}
comment|/* check for illegal new state */
if|if
condition|(
name|newstate
operator|==
name|ST_ILL
condition|)
block|{
name|newstate
operator|=
name|currstate
expr_stmt|;
name|NDBGL2
argument_list|(
name|L2_F_ERR
argument_list|,
literal|"FSM illegal state, state = %s, event = %s!"
argument_list|,
name|l2state_text
index|[
name|currstate
index|]
argument_list|,
name|l2event_text
index|[
name|event
index|]
argument_list|)
expr_stmt|;
block|}
comment|/* check if state machine function has to set new state */
if|if
condition|(
name|newstate
operator|!=
name|ST_SUBSET
condition|)
name|l2sc
operator|->
name|Q921_state
operator|=
name|newstate
expr_stmt|;
comment|/* no, we set new state */
if|if
condition|(
name|l2sc
operator|->
name|postfsmfunc
operator|!=
name|NULL
condition|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM executing postfsmfunc!"
argument_list|)
expr_stmt|;
comment|/* try to avoid an endless loop */
name|savpostfsmfunc
operator|=
name|l2sc
operator|->
name|postfsmfunc
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|NULL
expr_stmt|;
call|(
modifier|*
name|savpostfsmfunc
call|)
argument_list|(
name|l2sc
operator|->
name|postfsmarg
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_if
if|#
directive|if
name|DO_I4B_DEBUG
end_if

begin_comment
comment|/*---------------------------------------------------------------------------*  *	return pointer to current state description  *---------------------------------------------------------------------------*/
end_comment

begin_function
name|char
modifier|*
name|i4b_print_l2state
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
return|return
operator|(
operator|(
name|char
operator|*
operator|)
name|l2state_text
index|[
name|l2sc
operator|->
name|Q921_state
index|]
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_UNAS event dl establish request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TU01
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TU01 executing"
argument_list|)
expr_stmt|;
name|i4b_mdl_assign_ind
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_UNAS event mdl assign request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TU03
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TU03 executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_ASG_AW_TEI event mdl assign request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TA03
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TA03 executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_ASG_AW_TEI event mdl error response  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TA04
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TA04 executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_ASG_AW_TEI event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TA05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TA05 executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_EST_AW_TEI event mdl assign request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TE03
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TE03 executing"
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_EST_AW_TEI event mdl error response  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TE04
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TE04 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_EST_AW_TEI event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TE05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TE05 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event dl establish request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T01
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T01 executing"
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T05 executing"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event mdl remove request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T06
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T06 executing"
argument_list|)
expr_stmt|;
comment|/*XXX*/
name|i4b_mdl_assign_ind
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event rx'd SABME  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T07
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T07 executing"
argument_list|)
expr_stmt|;
comment|/* XXX */
ifdef|#
directive|ifdef
name|NOTDEF
if|if
condition|(
name|NOT
name|able
name|to
name|establish
condition|)
block|{
name|i4b_tx_dm
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
return|return;
block|}
endif|#
directive|endif
name|i4b_clear_exception_conditions
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_ACTIVE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|vs
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|va
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|vr
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Est_Ind_A
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event rx'd DISC  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T08
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T08 executing"
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_IDLE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event rx'd UA  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T09
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T09 executing"
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_T09"
argument_list|,
name|MDL_ERR_C
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_T09"
argument_list|,
name|MDL_ERR_D
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event rx'd DM  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T10
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T10 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
block|{
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|NOTDEF
if|if
condition|(
name|NOT
name|able_to_etablish
condition|)
block|{
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
return|return;
block|}
endif|#
directive|endif
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|1
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TEI_ASGD event dl release request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_T13
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_T13 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Cnf_A
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event dl establish request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE01
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE01 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE05 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event mdl remove request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE06
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE06 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
comment|/*XXX*/
name|i4b_mdl_assign_ind
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event rx'd SABME  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE07
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE07 executing"
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_ACTIVE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event rx'd DISC  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE08
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE08 executing"
argument_list|)
expr_stmt|;
name|i4b_tx_dm
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event rx'd UA  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE09
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE09 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|0
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_AE09"
argument_list|,
name|MDL_ERR_D
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|l3initiated
condition|)
block|{
name|l2sc
operator|->
name|l3initiated
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|vr
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Est_Cnf_A
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|vs
operator|!=
name|l2sc
operator|->
name|va
condition|)
block|{
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Est_Ind_A
expr_stmt|;
block|}
block|}
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_ACTIVE
argument_list|)
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|vs
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|va
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event rx'd DM  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE10
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE10 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|0
condition|)
block|{
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
else|else
block|{
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event T200 expiry  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE11
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE11 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|RC
operator|>=
name|N200
condition|)
block|{
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_AE11"
argument_list|,
name|MDL_ERR_G
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
block|}
else|else
block|{
name|l2sc
operator|->
name|RC
operator|++
expr_stmt|;
name|i4b_tx_sabme
argument_list|(
name|l2sc
argument_list|,
name|P1
argument_list|)
expr_stmt|;
name|i4b_T200_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_EST event dl data request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AE12
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AE12 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|l3initiated
operator|==
literal|0
condition|)
block|{
name|i4b_i_frame_queued_up
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR05 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Cnf_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event mdl remove request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR06
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR06 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Cnf_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
comment|/*XXX*/
name|i4b_mdl_assign_ind
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event rx'd SABME  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR07
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR07 executing"
argument_list|)
expr_stmt|;
name|i4b_tx_dm
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event rx'd DISC  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR08
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR08 executing"
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_IDLE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event rx'd UA  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR09
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR09 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
block|{
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Cnf_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
block|}
else|else
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_AR09"
argument_list|,
name|MDL_ERR_D
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_REL
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event rx'd DM  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR10
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR10 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
block|{
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Cnf_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
block|}
else|else
block|{
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_REL
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_AW_REL event T200 expiry  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_AR11
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_AR11 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|RC
operator|>=
name|N200
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_AR11"
argument_list|,
name|MDL_ERR_H
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Cnf_A
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TEI_ASGD
expr_stmt|;
block|}
else|else
block|{
name|l2sc
operator|->
name|RC
operator|++
expr_stmt|;
name|i4b_tx_disc
argument_list|(
name|l2sc
argument_list|,
name|P1
argument_list|)
expr_stmt|;
name|i4b_T200_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_REL
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event dl establish request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF01
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF01 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF05 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event mdl remove request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF06
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF06 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
comment|/*XXX*/
name|i4b_mdl_assign_ind
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd SABME  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF07
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF07 executing"
argument_list|)
expr_stmt|;
name|i4b_clear_exception_conditions
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_ACTIVE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF07"
argument_list|,
name|MDL_ERR_F
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|vs
operator|!=
name|l2sc
operator|->
name|va
condition|)
block|{
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Est_Ind_A
expr_stmt|;
block|}
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|vs
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|va
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|vr
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd DISC  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF08
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF08 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_IDLE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd UA  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF09
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF09 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF09"
argument_list|,
name|MDL_ERR_C
argument_list|)
expr_stmt|;
else|else
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF09"
argument_list|,
name|MDL_ERR_D
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd DM  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF10
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF10 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF10"
argument_list|,
name|MDL_ERR_B
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
block|}
else|else
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF10"
argument_list|,
name|MDL_ERR_E
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event T200 expiry  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF11
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF11 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|RC
operator|=
literal|0
expr_stmt|;
name|i4b_transmit_enquire
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|RC
operator|++
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event dl data request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF12
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF12 executing"
argument_list|)
expr_stmt|;
name|i4b_i_frame_queued_up
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event dl release request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF13
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF13 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|RC
operator|=
literal|0
expr_stmt|;
name|i4b_tx_disc
argument_list|(
name|l2sc
argument_list|,
name|P1
argument_list|)
expr_stmt|;
name|i4b_T203_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T200_restart
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event T203 expiry  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF14
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF14 executing"
argument_list|)
expr_stmt|;
name|i4b_transmit_enquire
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|RC
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event set own rx busy  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF15
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF15 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|own_busy
operator|==
literal|0
condition|)
block|{
name|l2sc
operator|->
name|own_busy
operator|=
literal|1
expr_stmt|;
name|i4b_tx_rnr_response
argument_list|(
name|l2sc
argument_list|,
name|F0
argument_list|)
expr_stmt|;
comment|/* wrong in Q.921 03/93 p 64 */
name|l2sc
operator|->
name|ack_pend
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event clear own rx busy  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF16
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF16 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|own_busy
operator|!=
literal|0
condition|)
block|{
name|l2sc
operator|->
name|own_busy
operator|=
literal|0
expr_stmt|;
name|i4b_tx_rr_response
argument_list|(
name|l2sc
argument_list|,
name|F0
argument_list|)
expr_stmt|;
comment|/* wrong in Q.921 03/93 p 64 */
name|l2sc
operator|->
name|ack_pend
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd RR  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF17
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF17 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|peer_busy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_CR
operator|==
name|CR_CMD_FROM_NT
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_enquiry_response
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF17"
argument_list|,
name|MDL_ERR_A
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_NR
operator|==
name|l2sc
operator|->
name|vs
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_restart
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|l2sc
operator|->
name|rxd_NR
operator|!=
name|l2sc
operator|->
name|va
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T200_restart
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd REJ  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF18
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF18 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|peer_busy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_CR
operator|==
name|CR_CMD_FROM_NT
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_enquiry_response
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF18"
argument_list|,
name|MDL_ERR_A
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_invoke_retransmission
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_NR
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd RNR  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF19
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF19 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|peer_busy
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_CR
operator|==
name|CR_CMD_FROM_NT
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_enquiry_response
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF19"
argument_list|,
name|MDL_ERR_A
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T203_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T200_restart
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_MULTIFR event rx'd FRMR  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_MF20
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_MF20 executing"
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_MF20"
argument_list|,
name|MDL_ERR_K
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event dl establish request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR01
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR01 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event persistent deactivation  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR05
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR05 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event mdl remove request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR06
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR06 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
comment|/*XXX*/
name|i4b_mdl_assign_ind
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd SABME  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR07
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR07 executing"
argument_list|)
expr_stmt|;
name|i4b_clear_exception_conditions
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_ACTIVE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR07"
argument_list|,
name|MDL_ERR_F
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|vs
operator|!=
name|l2sc
operator|->
name|va
condition|)
block|{
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Est_Ind_A
expr_stmt|;
block|}
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|vs
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|va
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|vr
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd DISC  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR08
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR08 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|MDL_Status_Ind
argument_list|(
name|l2sc
operator|->
name|unit
argument_list|,
name|STI_L2STAT
argument_list|,
name|LAYER_IDLE
argument_list|)
expr_stmt|;
name|i4b_tx_ua
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_PF
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|postfsmarg
operator|=
name|l2sc
operator|->
name|unit
expr_stmt|;
name|l2sc
operator|->
name|postfsmfunc
operator|=
name|DL_Rel_Ind_A
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd UA  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR09
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR09 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR09"
argument_list|,
name|MDL_ERR_C
argument_list|)
expr_stmt|;
else|else
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR09"
argument_list|,
name|MDL_ERR_D
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd DM  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR10
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR10 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR10"
argument_list|,
name|MDL_ERR_B
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR10"
argument_list|,
name|MDL_ERR_E
argument_list|)
expr_stmt|;
block|}
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event T200 expiry  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR11
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR11 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|RC
operator|>=
name|N200
condition|)
block|{
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR11"
argument_list|,
name|MDL_ERR_I
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|0
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
else|else
block|{
name|i4b_transmit_enquire
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|RC
operator|++
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TIMREC
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event dl data request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR12
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR12 executing"
argument_list|)
expr_stmt|;
name|i4b_i_frame_queued_up
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event dl release request  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR13
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR13 executing"
argument_list|)
expr_stmt|;
name|i4b_Dcleanifq
argument_list|(
operator|&
name|l2sc
operator|->
name|i_queue
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|RC
operator|=
literal|0
expr_stmt|;
name|i4b_tx_disc
argument_list|(
name|l2sc
argument_list|,
name|P1
argument_list|)
expr_stmt|;
name|i4b_T200_restart
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event set own rx busy  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR15
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR15 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|own_busy
operator|==
literal|0
condition|)
block|{
name|l2sc
operator|->
name|own_busy
operator|=
literal|1
expr_stmt|;
name|i4b_tx_rnr_response
argument_list|(
name|l2sc
argument_list|,
name|F0
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|ack_pend
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event clear own rx busy  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR16
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR16 executing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|own_busy
operator|!=
literal|0
condition|)
block|{
name|l2sc
operator|->
name|own_busy
operator|=
literal|0
expr_stmt|;
name|i4b_tx_rr_response
argument_list|(
name|l2sc
argument_list|,
name|F0
argument_list|)
expr_stmt|;
comment|/* this is wrong	 */
comment|/* in Q.921 03/93 p 74 ! */
name|l2sc
operator|->
name|ack_pend
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd RR  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR17
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR17 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|peer_busy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_CR
operator|==
name|CR_CMD_FROM_NT
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_enquiry_response
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_invoke_retransmission
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_NR
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
return|return;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
return|return;
block|}
block|}
block|}
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TIMREC
expr_stmt|;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event   *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR18
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR18 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|peer_busy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_CR
operator|==
name|CR_CMD_FROM_NT
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_enquiry_response
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T200_stop
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_T203_start
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_invoke_retransmission
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_NR
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
return|return;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
return|return;
block|}
block|}
block|}
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TIMREC
expr_stmt|;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd RNR  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR19
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR19 executing"
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|peer_busy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|l2sc
operator|->
name|rxd_CR
operator|==
name|CR_CMD_FROM_NT
condition|)
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
name|i4b_enquiry_response
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l2sc
operator|->
name|rxd_PF
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|i4b_T200_restart
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|i4b_invoke_retransmission
argument_list|(
name|l2sc
argument_list|,
name|l2sc
operator|->
name|rxd_NR
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_MULTIFR
expr_stmt|;
return|return;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
return|return;
block|}
block|}
block|}
if|if
condition|(
name|i4b_l2_nr_ok
argument_list|(
name|l2sc
operator|->
name|rxd_NR
argument_list|,
name|l2sc
operator|->
name|va
argument_list|,
name|l2sc
operator|->
name|vs
argument_list|)
condition|)
block|{
name|l2sc
operator|->
name|va
operator|=
name|l2sc
operator|->
name|rxd_NR
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_TIMREC
expr_stmt|;
block|}
else|else
block|{
name|i4b_nr_error_recovery
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|Q921_state
operator|=
name|ST_AW_EST
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	FSM state ST_TIMREC event rx'd FRMR  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|F_TR20
parameter_list|(
name|l2_softc_t
modifier|*
name|l2sc
parameter_list|)
block|{
name|NDBGL2
argument_list|(
name|L2_F_MSG
argument_list|,
literal|"FSM function F_TR20 executing"
argument_list|)
expr_stmt|;
name|i4b_mdl_error_ind
argument_list|(
name|l2sc
argument_list|,
literal|"F_TR20"
argument_list|,
name|MDL_ERR_K
argument_list|)
expr_stmt|;
name|i4b_establish_data_link
argument_list|(
name|l2sc
argument_list|)
expr_stmt|;
name|l2sc
operator|->
name|l3initiated
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* NI4BQ921> 0 */
end_comment

end_unit

