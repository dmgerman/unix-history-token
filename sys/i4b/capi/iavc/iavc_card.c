begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2001 Cubical Solutions Ltd. All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * capi/iavc/iavc_card.c  *		The AVM ISDN controllers' card specific support routines.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|"iavc.h"
end_include

begin_include
include|#
directive|include
file|"i4bcapi.h"
end_include

begin_include
include|#
directive|include
file|"pci.h"
end_include

begin_if
if|#
directive|if
operator|(
name|NIAVC
operator|>
literal|0
operator|)
operator|&&
operator|(
name|NI4BCAPI
operator|>
literal|0
operator|)
end_if

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<machine/clock.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/resource.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<sys/rman.h>
end_include

begin_include
include|#
directive|include
file|<machine/i4b_debug.h>
end_include

begin_include
include|#
directive|include
file|<machine/i4b_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<machine/i4b_trace.h>
end_include

begin_include
include|#
directive|include
file|<i4b/include/i4b_global.h>
end_include

begin_include
include|#
directive|include
file|<i4b/include/i4b_l3l4.h>
end_include

begin_include
include|#
directive|include
file|<i4b/include/i4b_mbuf.h>
end_include

begin_include
include|#
directive|include
file|<i4b/capi/capi.h>
end_include

begin_include
include|#
directive|include
file|<i4b/capi/iavc/iavc.h>
end_include

begin_comment
comment|/* //  AVM B1 (active BRI, PIO mode) */
end_comment

begin_function
name|int
name|b1_detect
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
if|if
condition|(
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|)
operator|&
literal|0xfc
operator|)
operator|||
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
name|B1_OUTSTAT
argument_list|)
operator|&
literal|0xfc
operator|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|,
literal|0x02
argument_list|)
expr_stmt|;
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_OUTSTAT
argument_list|,
literal|0x02
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|)
operator|&
literal|0xfe
operator|)
operator|!=
literal|2
operator|||
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
name|B1_OUTSTAT
argument_list|)
operator|&
literal|0xfe
operator|)
operator|!=
literal|2
condition|)
return|return
operator|(
literal|2
operator|)
return|;
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_OUTSTAT
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|)
operator|&
literal|0xfe
operator|)
operator|||
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
name|B1_OUTSTAT
argument_list|)
operator|&
literal|0xfe
operator|)
condition|)
return|return
operator|(
literal|3
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
comment|/* found */
block|}
end_function

begin_function
name|void
name|b1_disable_irq
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|b1_reset
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_RESET
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|55
operator|*
literal|2
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_RESET
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|55
operator|*
literal|2
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|b1io_outp
argument_list|(
name|sc
argument_list|,
name|B1_RESET
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|55
operator|*
literal|2
operator|*
literal|1000
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* //  Newer PCI-based B1's, and T1's, supports DMA */
end_comment

begin_function
name|int
name|b1dma_detect
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|10
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0x0f000000
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|10
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|42
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_RXLEN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_TXLEN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_csr
operator|=
literal|0
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_INTCSR
argument_list|,
name|sc
operator|->
name|sc_csr
argument_list|)
expr_stmt|;
if|if
condition|(
name|AMCC_READ
argument_list|(
name|sc
argument_list|,
name|AMCC_INTCSR
argument_list|)
operator|!=
literal|0
condition|)
return|return
literal|1
return|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_RXPTR
argument_list|,
literal|0xffffffff
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_TXPTR
argument_list|,
literal|0xffffffff
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|AMCC_READ
argument_list|(
name|sc
argument_list|,
name|AMCC_RXPTR
argument_list|)
operator|!=
literal|0xfffffffc
operator|)
operator|||
operator|(
name|AMCC_READ
argument_list|(
name|sc
argument_list|,
name|AMCC_TXPTR
argument_list|)
operator|!=
literal|0xfffffffc
operator|)
condition|)
return|return
literal|2
return|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_RXPTR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_TXPTR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|AMCC_READ
argument_list|(
name|sc
argument_list|,
name|AMCC_RXPTR
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|AMCC_READ
argument_list|(
name|sc
argument_list|,
name|AMCC_TXPTR
argument_list|)
operator|!=
literal|0
operator|)
condition|)
return|return
literal|3
return|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x10
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x07
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x02
argument_list|,
literal|0x02
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x03
argument_list|,
literal|0x02
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
literal|0x02
argument_list|)
operator|&
literal|0xfe
operator|)
operator|!=
literal|0x02
operator|)
operator|||
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
literal|0x03
argument_list|)
operator|!=
literal|0x03
operator|)
condition|)
return|return
literal|4
return|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x02
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x03
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
literal|0x02
argument_list|)
operator|&
literal|0xfe
operator|)
operator|!=
literal|0x00
operator|)
operator|||
operator|(
name|iavc_read_port
argument_list|(
name|sc
argument_list|,
literal|0x03
argument_list|)
operator|!=
literal|0x01
operator|)
condition|)
return|return
literal|5
return|;
return|return
operator|(
literal|0
operator|)
return|;
comment|/* found */
block|}
end_function

begin_function
name|void
name|b1dma_reset
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|int
name|s
init|=
name|SPLI4B
argument_list|()
decl_stmt|;
name|sc
operator|->
name|sc_csr
operator|=
literal|0
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_INTCSR
argument_list|,
name|sc
operator|->
name|sc_csr
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_RXLEN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_TXLEN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x10
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* XXX magic numbers from */
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
literal|0x07
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* XXX the linux driver */
name|splx
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|10
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0x0f000000
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|10
operator|*
literal|1000
argument_list|)
expr_stmt|;
name|AMCC_WRITE
argument_list|(
name|sc
argument_list|,
name|AMCC_MCSR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DELAY
argument_list|(
literal|42
operator|*
literal|1000
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* //  AVM T1 (active PRI) */
end_comment

begin_comment
comment|/* XXX how do these differ from b1io_{read,write}_reg()? XXX */
end_comment

begin_function
specifier|static
name|int
name|b1dma_tx_empty
parameter_list|(
name|int
name|iobase
parameter_list|)
block|{
return|return
name|inb
argument_list|(
name|iobase
operator|+
literal|3
argument_list|)
operator|&
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|b1dma_rx_full
parameter_list|(
name|int
name|iobase
parameter_list|)
block|{
return|return
name|inb
argument_list|(
name|iobase
operator|+
literal|2
argument_list|)
operator|&
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|b1dma_tolink
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
specifier|volatile
name|int
name|spin
decl_stmt|;
name|char
modifier|*
name|s
init|=
operator|(
name|char
operator|*
operator|)
name|buf
decl_stmt|;
while|while
condition|(
name|len
operator|--
condition|)
block|{
name|spin
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|b1dma_tx_empty
argument_list|(
name|sc
operator|->
name|sc_iobase
argument_list|)
operator|&&
name|spin
operator|<
literal|100000
condition|)
name|spin
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|b1dma_tx_empty
argument_list|(
name|sc
operator|->
name|sc_iobase
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|t1io_outp
argument_list|(
name|sc
argument_list|,
literal|1
argument_list|,
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|b1dma_fromlink
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
specifier|volatile
name|int
name|spin
decl_stmt|;
name|char
modifier|*
name|s
init|=
operator|(
name|char
operator|*
operator|)
name|buf
decl_stmt|;
while|while
condition|(
name|len
operator|--
condition|)
block|{
name|spin
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|b1dma_rx_full
argument_list|(
name|sc
operator|->
name|sc_iobase
argument_list|)
operator|&&
name|spin
operator|<
literal|100000
condition|)
name|spin
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|b1dma_rx_full
argument_list|(
name|sc
operator|->
name|sc_iobase
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|s
operator|++
operator|=
name|t1io_inp
argument_list|(
name|sc
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|WriteReg
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|,
name|u_int32_t
name|reg
parameter_list|,
name|u_int8_t
name|val
parameter_list|)
block|{
name|u_int8_t
name|cmd
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|b1dma_tolink
argument_list|(
name|sc
argument_list|,
operator|&
name|cmd
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
operator|&&
name|b1dma_tolink
argument_list|(
name|sc
argument_list|,
operator|&
name|reg
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
block|{
name|u_int32_t
name|tmp
init|=
name|val
decl_stmt|;
return|return
name|b1dma_tolink
argument_list|(
name|sc
argument_list|,
operator|&
name|tmp
argument_list|,
literal|4
argument_list|)
return|;
block|}
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|u_int8_t
name|ReadReg
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|,
name|u_int32_t
name|reg
parameter_list|)
block|{
name|u_int8_t
name|cmd
init|=
literal|1
decl_stmt|;
if|if
condition|(
name|b1dma_tolink
argument_list|(
name|sc
argument_list|,
operator|&
name|cmd
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
operator|&&
name|b1dma_tolink
argument_list|(
name|sc
argument_list|,
operator|&
name|reg
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
block|{
name|u_int32_t
name|tmp
decl_stmt|;
if|if
condition|(
name|b1dma_fromlink
argument_list|(
name|sc
argument_list|,
operator|&
name|tmp
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|u_int8_t
operator|)
name|tmp
return|;
block|}
return|return
literal|0xff
return|;
block|}
end_function

begin_function
name|int
name|t1_detect
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|int
name|ret
init|=
name|b1dma_detect
argument_list|(
name|sc
argument_list|)
decl_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
if|if
condition|(
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80001000
argument_list|,
literal|0x11
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80101000
argument_list|,
literal|0x22
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80201000
argument_list|,
literal|0x33
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80301000
argument_list|,
literal|0x44
argument_list|)
operator|!=
literal|0
operator|)
condition|)
return|return
literal|6
return|;
if|if
condition|(
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80001000
argument_list|)
operator|!=
literal|0x11
operator|)
operator|||
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80101000
argument_list|)
operator|!=
literal|0x22
operator|)
operator|||
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80201000
argument_list|)
operator|!=
literal|0x33
operator|)
operator|||
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80301000
argument_list|)
operator|!=
literal|0x44
operator|)
condition|)
return|return
literal|7
return|;
if|if
condition|(
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80001000
argument_list|,
literal|0x55
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80101000
argument_list|,
literal|0x66
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80201000
argument_list|,
literal|0x77
argument_list|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|WriteReg
argument_list|(
name|sc
argument_list|,
literal|0x80301000
argument_list|,
literal|0x88
argument_list|)
operator|!=
literal|0
operator|)
condition|)
return|return
literal|8
return|;
if|if
condition|(
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80001000
argument_list|)
operator|!=
literal|0x55
operator|)
operator|||
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80101000
argument_list|)
operator|!=
literal|0x66
operator|)
operator|||
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80201000
argument_list|)
operator|!=
literal|0x77
operator|)
operator|||
operator|(
name|ReadReg
argument_list|(
name|sc
argument_list|,
literal|0x80301000
argument_list|)
operator|!=
literal|0x88
operator|)
condition|)
return|return
literal|9
return|;
return|return
literal|0
return|;
comment|/* found */
block|}
end_function

begin_function
name|void
name|t1_disable_irq
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
name|T1_IRQMASTER
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|t1_reset
parameter_list|(
name|iavc_softc_t
modifier|*
name|sc
parameter_list|)
block|{
name|b1_reset
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
name|B1_INSTAT
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
name|B1_OUTSTAT
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
name|T1_IRQMASTER
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|iavc_write_port
argument_list|(
name|sc
argument_list|,
name|T1_RESETBOARD
argument_list|,
literal|0x0f
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

