begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * in6_debug.c  --  Insipired by Craig Metz's Net/2 in6_debug.c, but  *                  not quite as heavyweight (initially, anyway).  *  * The idea is to have globals here, and dump netinet6/ data structures.  *  * Copyright 1995 by Dan McDonald, Bao Phan, and Randall Atkinson,  *	All Rights Reserved.    *      All Rights under this copyright have been assigned to NRL.  */
end_comment

begin_comment
comment|/*---------------------------------------------------------------------- #       @(#)COPYRIGHT   1.1a (NRL) 17 August 1995  COPYRIGHT NOTICE  All of the documentation and software included in this software distribution from the US Naval Research Laboratory (NRL) are copyrighted by their respective developers.  This software and documentation were developed at NRL by various people.  Those developers have each copyrighted the portions that they developed at NRL and have assigned All Rights for those portions to NRL.  Outside the USA, NRL also has copyright on the software developed at NRL. The affected files all contain specific copyright notices and those notices must be retained in any derived work.  NRL LICENSE  NRL grants permission for redistribution and use in source and binary forms, with or without modification, of the software and documentation created at NRL provided that the following conditions are met:  1. Redistributions of source code must retain the above copyright    notice, this list of conditions and the following disclaimer. 2. Redistributions in binary form must reproduce the above copyright    notice, this list of conditions and the following disclaimer in the    documentation and/or other materials provided with the distribution. 3. All advertising materials mentioning features or use of this software    must display the following acknowledgement:          This product includes software developed at the Information         Technology Division, US Naval Research Laboratory.  4. Neither the name of the NRL nor the names of its contributors    may be used to endorse or promote products derived from this software    without specific prior written permission.  THE SOFTWARE PROVIDED BY NRL IS PROVIDED BY NRL AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL NRL OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  The views and conclusions contained in the software and documentation are those of the authors and should not be interpreted as representing official policies, either expressed or implied, of the US Naval Research Laboratory (NRL).  ----------------------------------------------------------------------*/
end_comment

begin_define
define|#
directive|define
name|INET6_DEBUG_C
end_define

begin_include
include|#
directive|include
file|<netkey/osdep_44bsd.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/route.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in_systm.h>
end_include

begin_include
include|#
directive|include
file|<netinet/ip.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in_pcb.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_include
include|#
directive|include
file|<netinet6/in6.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/in6_var.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/ipv6.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/ipv6_var.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/ipv6_icmp.h>
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* INET6 */
end_comment

begin_if
if|#
directive|if
literal|0
end_if

begin_include
include|#
directive|include
file|"in6_types.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_define
define|#
directive|define
name|SA_LEN
value|1
end_define

begin_define
define|#
directive|define
name|SIN_LEN
value|1
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|KEY_DEBUG
end_ifdef

begin_include
include|#
directive|include
file|<netkey/key.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* KEY_DEBUG */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|IPSEC_DEBUG
end_ifdef

begin_include
include|#
directive|include
file|<netsec/ipsec.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* IPSEC_DEBUG */
end_comment

begin_if
if|#
directive|if
literal|0
end_if

begin_include
include|#
directive|include
file|<netinet6/in6_debug.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|DEFARGS
end_ifndef

begin_define
define|#
directive|define
name|DEFARGS
parameter_list|(
name|arglist
parameter_list|,
name|args
parameter_list|)
value|arglist args;
end_define

begin_define
define|#
directive|define
name|AND
value|;
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEFARGS */
end_comment

begin_comment
comment|/*  * Globals  */
end_comment

begin_comment
comment|/* The following should be sysctl-tweakable. */
end_comment

begin_decl_stmt
name|unsigned
name|int
name|in6_debug_level
init|=
name|IDL_FINISHED
operator|+
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0 is no debugging */
end_comment

begin_comment
comment|/*  * Functions and macros.  */
end_comment

begin_decl_stmt
name|void
name|in6_debug_init
name|DEFARGS
argument_list|(
operator|(
operator|)
argument_list|,
name|void
argument_list|)
block|{
comment|/* For now, nothing. */
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * dump_* dumps various data structures.  These should be called within  * the context of a DDO() macro.  They assume address and port fields  * are in network order.  ----------------------------------------------------------------------*/
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an IPv6 address.  Don't compress 0's out because of debugging.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_in_addr6
name|DEFARGS
argument_list|(
operator|(
name|in_addr6
operator|)
argument_list|,
expr|struct
name|in_addr6
operator|*
name|in_addr6
argument_list|)
block|{
name|u_short
modifier|*
name|shorts
init|=
operator|(
name|u_short
operator|*
operator|)
name|in_addr6
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|in_addr6
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL in_addr6? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"(conv. for printing) "
argument_list|)
expr_stmt|;
while|while
condition|(
name|i
operator|<
literal|7
condition|)
name|printf
argument_list|(
literal|"%4x:"
argument_list|,
name|htons
argument_list|(
name|shorts
index|[
name|i
operator|++
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%4x\n"
argument_list|,
name|htons
argument_list|(
name|shorts
index|[
literal|7
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_comment
comment|/*----------------------------------------------------------------------  * Dump and IPv4 address in x.x.x.x form.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_in_addr
name|DEFARGS
argument_list|(
operator|(
name|in_addr
operator|)
argument_list|,
expr|struct
name|in_addr
operator|*
name|in_addr
argument_list|)
block|{
name|u_char
modifier|*
name|chars
init|=
operator|(
name|u_char
operator|*
operator|)
name|in_addr
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|in_addr
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL in_addr? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|i
operator|<
literal|3
condition|)
name|printf
argument_list|(
literal|"%d."
argument_list|,
name|chars
index|[
name|i
operator|++
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d\n"
argument_list|,
name|chars
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an IPv6 socket address.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_sockaddr_in6
name|DEFARGS
argument_list|(
operator|(
name|sin6
operator|)
argument_list|,
expr|struct
name|sockaddr_in6
operator|*
name|sin6
argument_list|)
block|{
if|if
condition|(
operator|!
name|sin6
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL sockaddr_in6? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"sin6_len = %d, sin6_family = %d, sin6_port = %d (0x%x)\n"
argument_list|,
name|sin6
operator|->
name|sin6_len
argument_list|,
name|sin6
operator|->
name|sin6_family
argument_list|,
name|htons
argument_list|(
name|sin6
operator|->
name|sin6_port
argument_list|)
argument_list|,
name|htons
argument_list|(
name|sin6
operator|->
name|sin6_port
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sin6_flowinfo = 0x%x\n"
argument_list|,
name|sin6
operator|->
name|sin6_flowinfo
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sin6_addr = "
argument_list|)
expr_stmt|;
name|dump_in_addr6
argument_list|(
operator|&
name|sin6
operator|->
name|sin6_addr
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an IPv4 socket address.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_sockaddr_in
name|DEFARGS
argument_list|(
operator|(
name|sin
operator|)
argument_list|,
expr|struct
name|sockaddr_in
operator|*
name|sin
argument_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|sin
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL sockaddr_in? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
ifdef|#
directive|ifdef
name|SIN_LEN
name|printf
argument_list|(
literal|"sin_len = %d, "
argument_list|,
name|sin
operator|->
name|sin_len
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SIN_LEN */
name|printf
argument_list|(
literal|"sin_family = %d, sin_port (conv.) = %d (0x%x)\n"
argument_list|,
name|sin
operator|->
name|sin_family
argument_list|,
name|htons
argument_list|(
name|sin
operator|->
name|sin_port
argument_list|)
argument_list|,
name|htons
argument_list|(
name|sin
operator|->
name|sin_port
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sin_addr = "
argument_list|)
expr_stmt|;
name|dump_in_addr
argument_list|(
operator|&
name|sin
operator|->
name|sin_addr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sin_zero == "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%2x "
argument_list|,
name|sin
operator|->
name|sin_zero
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a generic socket address.  Use if no family-specific routine is  * available.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_sockaddr
name|DEFARGS
argument_list|(
operator|(
name|sa
operator|)
argument_list|,
name|SOCKADDR
operator|*
name|sa
argument_list|)
block|{
if|if
condition|(
operator|!
name|sa
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL sockaddr? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
ifdef|#
directive|ifdef
name|SA_LEN
name|printf
argument_list|(
literal|"sa_len = %d, "
argument_list|,
name|sa
operator|->
name|sa_len
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SA_LEN */
name|printf
argument_list|(
literal|"sa_family = %d"
argument_list|,
name|sa
operator|->
name|sa_family
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_LEN
name|printf
argument_list|(
literal|", remaining bytes are:\n"
argument_list|)
expr_stmt|;
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|sa
operator|->
name|sa_len
operator|-
literal|2
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%2x "
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|sa
operator|->
name|sa_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SA_LEN */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a link-layer socket address.  (Not that there are user-level link  * layer sockets, but there are plenty of link-layer addresses in the kernel.)  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_sockaddr_dl
name|DEFARGS
argument_list|(
operator|(
name|sdl
operator|)
argument_list|,
expr|struct
name|sockaddr_dl
operator|*
name|sdl
argument_list|)
block|{
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|sdl
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL sockaddr_dl? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"sdl_len = %d, sdl_family = %d, sdl_index = %d, sdl_type = %d,\n"
argument_list|,
name|sdl
operator|->
name|sdl_len
argument_list|,
name|sdl
operator|->
name|sdl_family
argument_list|,
name|sdl
operator|->
name|sdl_index
argument_list|,
name|sdl
operator|->
name|sdl_type
argument_list|)
expr_stmt|;
name|buf
index|[
name|sdl
operator|->
name|sdl_nlen
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sdl
operator|->
name|sdl_nlen
condition|)
name|bcopy
argument_list|(
name|sdl
operator|->
name|sdl_data
argument_list|,
name|buf
argument_list|,
name|sdl
operator|->
name|sdl_nlen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sdl_nlen = %d, (name = '%s'\n"
argument_list|,
name|sdl
operator|->
name|sdl_nlen
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sdl_alen = %d, "
argument_list|,
name|sdl
operator|->
name|sdl_alen
argument_list|)
expr_stmt|;
if|if
condition|(
name|sdl
operator|->
name|sdl_alen
condition|)
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"(addr = "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|sdl
operator|->
name|sdl_alen
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%2x "
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|sdl
operator|->
name|sdl_data
index|[
name|i
operator|+
name|sdl
operator|->
name|sdl_nlen
index|]
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sdl_slen = %d, "
argument_list|,
name|sdl
operator|->
name|sdl_slen
argument_list|)
expr_stmt|;
if|if
condition|(
name|sdl
operator|->
name|sdl_slen
condition|)
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"(addr = "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|sdl
operator|->
name|sdl_slen
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%2x "
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|sdl
operator|->
name|sdl_data
index|[
name|i
operator|+
name|sdl
operator|->
name|sdl_nlen
operator|+
name|sdl
operator|->
name|sdl_alen
index|]
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a socket address, calling a family-specific routine if available.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_smart_sockaddr
name|DEFARGS
argument_list|(
operator|(
name|sa
operator|)
argument_list|,
name|SOCKADDR
operator|*
name|sa
argument_list|)
block|{
name|DPRINTF
argument_list|(
name|IDL_MAJOR_EVENT
argument_list|,
operator|(
literal|"Entering dump_smart_sockaddr\n"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|sa
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL sockaddr? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|sa
operator|->
name|sa_family
condition|)
block|{
ifdef|#
directive|ifdef
name|INET6
case|case
name|AF_INET6
case|:
name|dump_sockaddr_in6
argument_list|(
operator|(
expr|struct
name|sockaddr_in6
operator|*
operator|)
name|sa
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* INET6 */
case|case
name|AF_INET
case|:
name|dump_sockaddr_in
argument_list|(
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
name|sa
argument_list|)
expr_stmt|;
break|break;
case|case
name|AF_LINK
case|:
name|dump_sockaddr_dl
argument_list|(
operator|(
expr|struct
name|sockaddr_dl
operator|*
operator|)
name|sa
argument_list|)
expr_stmt|;
break|break;
default|default:
name|dump_sockaddr
argument_list|(
name|sa
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an IPv6 header.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_ipv6
name|DEFARGS
argument_list|(
operator|(
name|ipv6
operator|)
argument_list|,
expr|struct
name|ipv6
operator|*
name|ipv6
argument_list|)
block|{
if|if
condition|(
operator|!
name|ipv6
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL ipv6? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"Vers& flow label (conv to host order) 0x%x\n"
argument_list|,
name|htonl
argument_list|(
name|ipv6
operator|->
name|ipv6_versfl
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Length (conv) = %d, nexthdr = %d, hoplimit = %d.\n"
argument_list|,
name|htons
argument_list|(
name|ipv6
operator|->
name|ipv6_length
argument_list|)
argument_list|,
name|ipv6
operator|->
name|ipv6_nexthdr
argument_list|,
name|ipv6
operator|->
name|ipv6_hoplimit
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Src: "
argument_list|)
expr_stmt|;
name|dump_in_addr6
argument_list|(
operator|&
name|ipv6
operator|->
name|ipv6_src
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Dst: "
argument_list|)
expr_stmt|;
name|dump_in_addr6
argument_list|(
operator|&
name|ipv6
operator|->
name|ipv6_dst
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an ICMPv6 header.  This function is not very smart beyond the  * type, code, and checksum.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|dump_ipv6_icmp
name|DEFARGS
argument_list|(
operator|(
name|icp
operator|)
argument_list|,
expr|struct
name|ipv6_icmp
operator|*
name|icp
argument_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|icp
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL ipv6_icmp? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"type %d, code %d, cksum (conv) = 0x%x\n"
argument_list|,
name|icp
operator|->
name|icmp_type
argument_list|,
name|icp
operator|->
name|icmp_code
argument_list|,
name|htons
argument_list|(
name|icp
operator|->
name|icmp_cksum
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"First four bytes:  0x%x"
argument_list|,
name|htonl
argument_list|(
name|icp
operator|->
name|icmp_unused
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Next four bytes: 0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%x"
argument_list|,
name|icp
operator|->
name|icmp_echodata
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_comment
comment|/*----------------------------------------------------------------------  * Dump only the header fields of a single mbuf.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_mbuf_hdr
name|DEFARGS
argument_list|(
operator|(
name|m
operator|)
argument_list|,
expr|struct
name|mbuf
operator|*
name|m
argument_list|)
block|{
if|if
condition|(
operator|!
name|m
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL mbuf? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"Single mbuf at %08x\n"
argument_list|,
name|m
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"m_len = %d, m_data = 0x%x, m_type = %d\n"
argument_list|,
name|m
operator|->
name|m_len
argument_list|,
name|m
operator|->
name|m_data
argument_list|,
name|m
operator|->
name|m_type
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"m_flags = 0x%x "
argument_list|,
name|m
operator|->
name|m_flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|->
name|m_flags
operator|&
name|M_PKTHDR
condition|)
name|printf
argument_list|(
literal|"m_pkthdr.len = %d, m_pkthdr.rcvif = 0x%x"
argument_list|,
name|m
operator|->
name|m_pkthdr
operator|.
name|len
argument_list|,
name|m
operator|->
name|m_pkthdr
operator|.
name|rcvif
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|->
name|m_flags
operator|&
name|M_EXT
condition|)
name|printf
argument_list|(
literal|" (IS CLUSTER MBUF)"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nm_next = 0x%x  m_nextpkt = 0x%x\n"
argument_list|,
name|m
operator|->
name|m_next
argument_list|,
name|m
operator|->
name|m_nextpkt
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump the entire contents of a single mbuf.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_mbuf
name|DEFARGS
argument_list|(
operator|(
name|m
operator|)
argument_list|,
expr|struct
name|mbuf
operator|*
name|m
argument_list|)
block|{
name|int
name|i
decl_stmt|;
name|dump_mbuf_hdr
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"m_data:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|m
operator|->
name|m_len
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%2x%s"
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|m
operator|->
name|m_data
index|[
name|i
index|]
argument_list|,
operator|(
operator|(
name|i
operator|+
literal|1
operator|)
operator|%
literal|16
operator|)
condition|?
literal|" "
else|:
literal|"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
operator|(
name|i
operator|%
literal|16
operator|)
condition|?
literal|"\n"
else|:
literal|""
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump the contents of an mbuf chain.  (WARNING:  Lots of text may  * result.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_mchain
name|DEFARGS
argument_list|(
operator|(
name|m
operator|)
argument_list|,
expr|struct
name|mbuf
operator|*
name|m
argument_list|)
block|{
name|struct
name|mbuf
modifier|*
name|walker
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|walker
operator|=
name|m
operator|,
name|i
operator|=
literal|0
init|;
name|walker
operator|!=
name|NULL
operator|&&
operator|(
name|i
operator|<
literal|10
operator|)
condition|;
name|walker
operator|=
name|walker
operator|->
name|m_next
operator|,
name|i
operator|++
control|)
name|dump_mbuf
argument_list|(
name|walker
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an mbuf chain's data in a format similar to tcpdump(8).  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_tcpdump
name|DEFARGS
argument_list|(
operator|(
name|m
operator|)
argument_list|,
expr|struct
name|mbuf
operator|*
name|m
argument_list|)
block|{
name|struct
name|mbuf
modifier|*
name|walker
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|count
decl_stmt|;
for|for
control|(
name|i
operator|=
name|count
operator|=
literal|0
init|;
name|m
operator|&&
operator|(
name|i
operator|<
literal|10
operator|)
condition|;
name|m
operator|=
name|m
operator|->
name|m_next
operator|,
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|m
operator|->
name|m_len
condition|;
name|j
operator|++
operator|,
name|count
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|count
operator|%
operator|(
literal|2
operator|*
literal|8
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|count
operator|%
literal|2
operator|)
condition|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
call|(
name|u_int8
call|)
argument_list|(
name|m
operator|->
name|m_data
index|[
name|j
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an IPv6 header index table, which is terminated by an entry with  * a NULL mbuf pointer.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_ihitab
name|DEFARGS
argument_list|(
operator|(
name|ihi
operator|)
argument_list|,
expr|struct
name|in6_hdrindex
operator|*
name|ihi
argument_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|ihi
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL hdrindex/ihi? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* This is dangerous, make sure ihitab was bzeroed. */
while|while
condition|(
name|ihi
index|[
name|i
index|]
operator|.
name|ihi_mbuf
condition|)
block|{
name|printf
argument_list|(
literal|"ihi_nexthdr = %d, ihi_mbuf = 0x%x.\n"
argument_list|,
name|ihi
index|[
name|i
index|]
operator|.
name|ihi_nexthdr
argument_list|,
name|ihi
index|[
name|i
index|]
operator|.
name|ihi_mbuf
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
block|}
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an interface address.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_ifa
name|DEFARGS
argument_list|(
operator|(
name|ifa
operator|)
argument_list|,
expr|struct
name|ifaddr
operator|*
name|ifa
argument_list|)
block|{
if|if
condition|(
name|ifa
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"ifa of NULL.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"ifa_addr: "
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|ifa
operator|->
name|ifa_addr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ifa_netmask: "
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|ifa
operator|->
name|ifa_netmask
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an interface structure.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_ifp
name|DEFARGS
argument_list|(
operator|(
name|ifp
operator|)
argument_list|,
expr|struct
name|ifnet
operator|*
name|ifp
argument_list|)
block|{
if|if
condition|(
operator|!
name|ifp
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL ifnet/ifp? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"Interface name: %s.\n"
argument_list|,
name|ifp
operator|->
name|if_name
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Interface type: %d.  "
argument_list|,
name|ifp
operator|->
name|if_type
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"MTU: %d.\n"
argument_list|,
name|ifp
operator|->
name|if_mtu
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a route structure (sockaddr/rtentry pair).  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_route
name|DEFARGS
argument_list|(
operator|(
name|ro
operator|)
argument_list|,
expr|struct
name|route
operator|*
name|ro
argument_list|)
block|{
if|if
condition|(
operator|!
name|ro
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL route? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"ro_rt = 0x%x, ro_dst is:\n"
argument_list|,
name|ro
operator|->
name|ro_rt
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
operator|&
name|ro
operator|->
name|ro_dst
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a routing entry.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_rtentry
name|DEFARGS
argument_list|(
operator|(
name|rt
operator|)
argument_list|,
expr|struct
name|rtentry
operator|*
name|rt
argument_list|)
block|{
if|if
condition|(
operator|!
name|rt
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL rtentry? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"rt_key is:\n"
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|rt_key
argument_list|(
name|rt
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_mask is:\n"
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|rt_mask
argument_list|(
name|rt
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_llinfo = 0x%x "
argument_list|,
name|rt
operator|->
name|rt_llinfo
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_rmx.rmx_mtu = %d "
argument_list|,
name|rt
operator|->
name|rt_rmx
operator|.
name|rmx_mtu
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_refcnt = %d "
argument_list|,
name|rt
operator|->
name|rt_refcnt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_flags = 0x%x\n"
argument_list|,
name|rt
operator|->
name|rt_flags
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_ifp is:\n"
argument_list|)
expr_stmt|;
name|dump_ifp
argument_list|(
name|rt
operator|->
name|rt_ifp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rt_ifa is:\n"
argument_list|)
expr_stmt|;
name|dump_ifa
argument_list|(
name|rt
operator|->
name|rt_ifa
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an Internet (v4/v6) protocol control block.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_inpcb
name|DEFARGS
argument_list|(
operator|(
name|inp
operator|)
argument_list|,
expr|struct
name|inpcb
operator|*
name|inp
argument_list|)
block|{
if|if
condition|(
operator|!
name|inp
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL inpcb? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"inp_next = 0x%x, inp_prev = 0x%x, inp_head = 0x%x.\n"
argument_list|,
name|inp
operator|->
name|inp_next
argument_list|,
name|inp
operator|->
name|inp_prev
argument_list|,
name|inp
operator|->
name|inp_head
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"inp_socket = 0x%x, inp_ppcb\n"
argument_list|,
name|inp
operator|->
name|inp_socket
argument_list|,
name|inp
operator|->
name|inp_ppcb
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|INET6
name|printf
argument_list|(
literal|"faddr, faddr6:\n"
argument_list|)
expr_stmt|;
name|dump_in_addr
argument_list|(
operator|&
name|inp
operator|->
name|inp_faddr
argument_list|)
expr_stmt|;
name|dump_in_addr6
argument_list|(
operator|&
name|inp
operator|->
name|inp_faddr6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"laddr, laddr6:\n"
argument_list|)
expr_stmt|;
name|dump_in_addr
argument_list|(
operator|&
name|inp
operator|->
name|inp_laddr
argument_list|)
expr_stmt|;
name|dump_in_addr6
argument_list|(
operator|&
name|inp
operator|->
name|inp_laddr6
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* INET6 */
name|printf
argument_list|(
literal|"faddr:\n"
argument_list|)
expr_stmt|;
name|dump_in_addr
argument_list|(
operator|&
name|inp
operator|->
name|inp_faddr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"laddr:\n"
argument_list|)
expr_stmt|;
name|dump_in_addr
argument_list|(
operator|&
name|inp
operator|->
name|inp_laddr
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* INET6 */
name|printf
argument_list|(
literal|"inp_route: "
argument_list|)
expr_stmt|;
name|dump_route
argument_list|(
operator|&
name|inp
operator|->
name|inp_route
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|INET6
name|printf
argument_list|(
literal|"inp_ipv6:"
argument_list|)
expr_stmt|;
name|dump_ipv6
argument_list|(
operator|&
name|inp
operator|->
name|inp_ipv6
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* INET6 */
name|printf
argument_list|(
literal|"inp_ip:"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<Coming soon.>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"inp_options = 0x%x, inp_moptions{6,} = 0x%x,\n"
argument_list|,
name|inp
operator|->
name|inp_options
argument_list|,
name|inp
operator|->
name|inp_moptions
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"inp_flags = 0x%x, inp_fport = %d, inp_lport = %d.\n"
argument_list|,
operator|(
name|unsigned
operator|)
name|inp
operator|->
name|inp_flags
argument_list|,
name|inp
operator|->
name|inp_fport
argument_list|,
name|inp
operator|->
name|inp_lport
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an IPv6 discovery queue structure.  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_discq
name|DEFARGS
argument_list|(
operator|(
name|dq
operator|)
argument_list|,
expr|struct
name|discq
operator|*
name|dq
argument_list|)
block|{
if|if
condition|(
operator|!
name|dq
condition|)
block|{
name|printf
argument_list|(
literal|"Dereference a NULL discq? I don't think so.\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"dq_next = 0x%x, dq_prev = 0x%x, dq_rt = 0x%x,\n"
argument_list|,
name|dq
operator|->
name|dq_next
argument_list|,
name|dq
operator|->
name|dq_prev
argument_list|,
name|dq
operator|->
name|dq_rt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"dq_queue = 0x%x.\n"
argument_list|,
name|dq
operator|->
name|dq_queue
argument_list|)
expr_stmt|;
comment|/* Dump first mbuf chain? */
comment|/*printf("dq_expire = %d (0x%x).\n",dq->dq_expire,dq->dq_expire);*/
block|}
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a data buffer   ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_buf
name|DEFARGS
argument_list|(
operator|(
name|buf
operator|,
name|len
operator|)
argument_list|,
name|char
operator|*
name|buf
name|AND
name|int
name|len
argument_list|)
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"buf=0x%x len=%d:\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"0x%x "
argument_list|,
operator|(
name|u_int8
operator|)
operator|*
operator|(
name|buf
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a key_tblnode structrue  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_keytblnode
name|DEFARGS
argument_list|(
operator|(
name|ktblnode
operator|)
argument_list|,
expr|struct
name|key_tblnode
operator|*
name|ktblnode
argument_list|)
block|{
if|if
condition|(
operator|!
name|ktblnode
condition|)
block|{
name|printf
argument_list|(
literal|"NULL key table node pointer!\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"solist=0x%x "
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ktblnode
operator|->
name|solist
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc=0x%x "
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ktblnode
operator|->
name|secassoc
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"next=0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ktblnode
operator|->
name|next
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump an ipsec_assoc structure  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_secassoc
name|DEFARGS
argument_list|(
operator|(
name|seca
operator|)
argument_list|,
expr|struct
name|key_secassoc
operator|*
name|seca
argument_list|)
block|{
name|u_int8
modifier|*
name|p
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|seca
condition|)
block|{
name|printf
argument_list|(
literal|"secassoc_len=%u "
argument_list|,
name|seca
operator|->
name|len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_type=%d "
argument_list|,
name|seca
operator|->
name|type
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_state=0x%x\n"
argument_list|,
name|seca
operator|->
name|state
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_label=%u "
argument_list|,
name|seca
operator|->
name|label
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_spi=0x%x "
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|seca
operator|->
name|spi
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_keylen=%u\n"
argument_list|,
name|seca
operator|->
name|keylen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_ivlen=%u "
argument_list|,
name|seca
operator|->
name|ivlen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_algorithm=%u "
argument_list|,
name|seca
operator|->
name|algorithm
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_lifetype=%u\n"
argument_list|,
name|seca
operator|->
name|lifetype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_iv=0x%x:\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|seca
operator|->
name|iv
argument_list|)
expr_stmt|;
name|p
operator|=
operator|(
name|u_int8
operator|*
operator|)
operator|(
name|seca
operator|->
name|iv
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|seca
operator|->
name|ivlen
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%x "
argument_list|,
operator|*
operator|(
name|p
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_key=0x%x:\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|seca
operator|->
name|key
argument_list|)
expr_stmt|;
name|p
operator|=
operator|(
name|u_int8
operator|*
operator|)
operator|(
name|seca
operator|->
name|key
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|seca
operator|->
name|keylen
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"0x%x "
argument_list|,
operator|*
operator|(
name|p
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_lifetime1=%u "
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|seca
operator|->
name|lifetime1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"secassoc_lifetime2=%u\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|seca
operator|->
name|lifetime2
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|seca
operator|->
name|src
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|seca
operator|->
name|dst
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|seca
operator|->
name|from
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"can't dump null secassoc pointer!\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a key_msghdr structure  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_keymsghdr
name|DEFARGS
argument_list|(
operator|(
name|km
operator|)
argument_list|,
expr|struct
name|key_msghdr
operator|*
name|km
argument_list|)
block|{
if|if
condition|(
name|km
condition|)
block|{
name|printf
argument_list|(
literal|"key_msglen=%d\n"
argument_list|,
name|km
operator|->
name|key_msglen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"key_msgvers=%d\n"
argument_list|,
name|km
operator|->
name|key_msgvers
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"key_msgtype=%d\n"
argument_list|,
name|km
operator|->
name|key_msgtype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"key_pid=%d\n"
argument_list|,
name|km
operator|->
name|key_pid
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"key_seq=%d\n"
argument_list|,
name|km
operator|->
name|key_seq
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"key_errno=%d\n"
argument_list|,
name|km
operator|->
name|key_errno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"type=0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|type
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"state=0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|state
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"label=0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|label
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"spi=0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|spi
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"keylen=%d\n"
argument_list|,
name|km
operator|->
name|keylen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ivlen=%d\n"
argument_list|,
name|km
operator|->
name|ivlen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"algorithm=%d\n"
argument_list|,
name|km
operator|->
name|algorithm
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"lifetype=0x%x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|lifetype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"lifetime1=%u\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|lifetime1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"lifetime2=%u\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|km
operator|->
name|lifetime2
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"key_msghdr pointer is NULL!\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*----------------------------------------------------------------------  * Dump a key_msgdata structure  ----------------------------------------------------------------------*/
end_comment

begin_decl_stmt
name|void
name|dump_keymsginfo
name|DEFARGS
argument_list|(
operator|(
name|kp
operator|)
argument_list|,
expr|struct
name|key_msgdata
operator|*
name|kp
argument_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|kp
condition|)
block|{
name|printf
argument_list|(
literal|"src addr:\n"
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|kp
operator|->
name|src
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"dest addr:\n"
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|kp
operator|->
name|dst
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"from addr:\n"
argument_list|)
expr_stmt|;
name|dump_smart_sockaddr
argument_list|(
name|kp
operator|->
name|from
argument_list|)
expr_stmt|;
define|#
directive|define
name|dumpbuf
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
define|\
value|{ for (i= 0; i< (b); i++) \       printf("0x%2x%s", (unsigned char)(*((caddr_t)a+i)),((i+1)%16)?" ":"\n");\       printf("\n"); }
name|printf
argument_list|(
literal|"iv is:\n"
argument_list|)
expr_stmt|;
name|dumpbuf
argument_list|(
name|kp
operator|->
name|iv
argument_list|,
name|kp
operator|->
name|ivlen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"key is:\n"
argument_list|)
expr_stmt|;
name|dumpbuf
argument_list|(
name|kp
operator|->
name|key
argument_list|,
name|kp
operator|->
name|keylen
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|dumpbuf
block|}
else|else
name|printf
argument_list|(
literal|"key_msgdata point is NULL!\n"
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

end_unit

