begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002-2009 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    similar to the "NO WARRANTY" disclaimer below ("Disclaimer") and any  *    redistribution must be conditioned upon including a substantially  *    similar Disclaimer requirement for further binary redistribution.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF NONINFRINGEMENT, MERCHANTIBILITY  * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL  * THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY,  * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER  * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGES.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*  * Driver for the Atheros Wireless LAN controller.  *  * This software is derived from work of Atsushi Onoe; his contribution  * is greatly appreciated.  */
end_comment

begin_include
include|#
directive|include
file|"opt_inet.h"
end_include

begin_include
include|#
directive|include
file|"opt_ath.h"
end_include

begin_include
include|#
directive|include
file|"opt_wlan.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/lock.h>
end_include

begin_include
include|#
directive|include
file|<sys/mutex.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/sockio.h>
end_include

begin_include
include|#
directive|include
file|<sys/errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/callout.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<sys/endian.h>
end_include

begin_include
include|#
directive|include
file|<sys/kthread.h>
end_include

begin_include
include|#
directive|include
file|<sys/taskqueue.h>
end_include

begin_include
include|#
directive|include
file|<sys/priv.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_include
include|#
directive|include
file|<net/if_arp.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<net/if_llc.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_var.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_regdomain.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|IEEE80211_SUPPORT_SUPERG
end_ifdef

begin_include
include|#
directive|include
file|<net80211/ieee80211_superg.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|IEEE80211_SUPPORT_TDMA
end_ifdef

begin_include
include|#
directive|include
file|<net80211/ieee80211_tdma.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<net/bpf.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|INET
end_ifdef

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<netinet/if_ether.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<dev/ath/if_athvar.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/ath_hal/ah_devid.h>
end_include

begin_comment
comment|/* XXX for softled */
end_comment

begin_include
include|#
directive|include
file|<dev/ath/ath_hal/ah_diagcodes.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_debug.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_led.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_misc.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_tx.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_sysctl.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ATH_TX99_DIAG
end_ifdef

begin_include
include|#
directive|include
file|<dev/ath/ath_tx99/ath_tx99.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|ATH_DEBUG_ALQ
end_ifdef

begin_include
include|#
directive|include
file|<dev/ath/if_ath_alq.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|ath_sysctl_slottime
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|slottime
decl_stmt|;
name|int
name|error
decl_stmt|;
name|ATH_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|ath_power_set_power_state
argument_list|(
name|sc
argument_list|,
name|HAL_PM_AWAKE
argument_list|)
expr_stmt|;
name|slottime
operator|=
name|ath_hal_getslottime
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
expr_stmt|;
name|ATH_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|slottime
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
goto|goto
name|finish
goto|;
name|error
operator|=
operator|!
name|ath_hal_setslottime
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|slottime
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
expr_stmt|;
name|finish
label|:
name|ATH_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|ath_power_restore_power_state
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|ATH_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
return|return
name|error
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_acktimeout
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|acktimeout
init|=
name|ath_hal_getacktimeout
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|acktimeout
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_setacktimeout
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|acktimeout
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_ctstimeout
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|ctstimeout
init|=
name|ath_hal_getctstimeout
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|ctstimeout
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_setctstimeout
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|ctstimeout
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_softled
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|softled
init|=
name|sc
operator|->
name|sc_softled
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|softled
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
name|softled
operator|=
operator|(
name|softled
operator|!=
literal|0
operator|)
expr_stmt|;
if|if
condition|(
name|softled
operator|!=
name|sc
operator|->
name|sc_softled
condition|)
block|{
if|if
condition|(
name|softled
condition|)
block|{
comment|/* NB: handle any sc_ledpin change */
name|ath_led_config
argument_list|(
name|sc
argument_list|)
expr_stmt|;
block|}
name|sc
operator|->
name|sc_softled
operator|=
name|softled
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_ledpin
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|ledpin
init|=
name|sc
operator|->
name|sc_ledpin
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|ledpin
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
name|ledpin
operator|!=
name|sc
operator|->
name|sc_ledpin
condition|)
block|{
name|sc
operator|->
name|sc_ledpin
operator|=
name|ledpin
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_softled
condition|)
block|{
name|ath_led_config
argument_list|(
name|sc
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_hardled
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|hardled
init|=
name|sc
operator|->
name|sc_hardled
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|hardled
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
name|hardled
operator|=
operator|(
name|hardled
operator|!=
literal|0
operator|)
expr_stmt|;
if|if
condition|(
name|hardled
operator|!=
name|sc
operator|->
name|sc_hardled
condition|)
block|{
if|if
condition|(
name|hardled
condition|)
block|{
comment|/* NB: handle any sc_ledpin change */
name|ath_led_config
argument_list|(
name|sc
argument_list|)
expr_stmt|;
block|}
name|sc
operator|->
name|sc_hardled
operator|=
name|hardled
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_txantenna
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|txantenna
init|=
name|ath_hal_getantennaswitch
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|txantenna
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
operator|&&
name|req
operator|->
name|newptr
condition|)
block|{
comment|/* XXX assumes 2 antenna ports */
if|if
condition|(
name|txantenna
operator|<
name|HAL_ANT_VARIABLE
operator|||
name|txantenna
operator|>
name|HAL_ANT_FIXED_B
condition|)
return|return
name|EINVAL
return|;
name|ath_hal_setantennaswitch
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|txantenna
argument_list|)
expr_stmt|;
comment|/* 		 * NB: with the switch locked this isn't meaningful, 		 *     but set it anyway so things like radiotap get 		 *     consistent info in their data. 		 */
name|sc
operator|->
name|sc_txantenna
operator|=
name|txantenna
expr_stmt|;
block|}
return|return
name|error
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_rxantenna
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|defantenna
init|=
name|ath_hal_getdefantenna
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|defantenna
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
operator|&&
name|req
operator|->
name|newptr
condition|)
name|ath_hal_setdefantenna
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|defantenna
argument_list|)
expr_stmt|;
return|return
name|error
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_diversity
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|diversity
init|=
name|ath_hal_getdiversity
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|diversity
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
operator|!
name|ath_hal_setdiversity
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|diversity
argument_list|)
condition|)
return|return
name|EINVAL
return|;
name|sc
operator|->
name|sc_diversity
operator|=
name|diversity
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_diag
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int32_t
name|diag
decl_stmt|;
name|int
name|error
decl_stmt|;
if|if
condition|(
operator|!
name|ath_hal_getdiag
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
operator|&
name|diag
argument_list|)
condition|)
return|return
name|EINVAL
return|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|diag
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_setdiag
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|diag
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_tpscale
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|struct
name|ifnet
modifier|*
name|ifp
init|=
name|sc
operator|->
name|sc_ifp
decl_stmt|;
name|u_int32_t
name|scale
decl_stmt|;
name|int
name|error
decl_stmt|;
operator|(
name|void
operator|)
name|ath_hal_gettpscale
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
operator|&
name|scale
argument_list|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|scale
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_settpscale
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|scale
argument_list|)
condition|?
name|EINVAL
else|:
operator|(
name|ifp
operator|->
name|if_drv_flags
operator|&
name|IFF_DRV_RUNNING
operator|)
condition|?
name|ath_reset
argument_list|(
name|ifp
argument_list|,
name|ATH_RESET_NOLOSS
argument_list|)
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_tpc
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|tpc
init|=
name|ath_hal_gettpc
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|tpc
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_settpc
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|tpc
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_rfkill
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|struct
name|ifnet
modifier|*
name|ifp
init|=
name|sc
operator|->
name|sc_ifp
decl_stmt|;
name|struct
name|ath_hal
modifier|*
name|ah
init|=
name|sc
operator|->
name|sc_ah
decl_stmt|;
name|u_int
name|rfkill
init|=
name|ath_hal_getrfkill
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|rfkill
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
name|rfkill
operator|==
name|ath_hal_getrfkill
argument_list|(
name|ah
argument_list|)
condition|)
comment|/* unchanged */
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ath_hal_setrfkill
argument_list|(
name|ah
argument_list|,
name|rfkill
argument_list|)
condition|)
return|return
name|EINVAL
return|;
return|return
operator|(
name|ifp
operator|->
name|if_drv_flags
operator|&
name|IFF_DRV_RUNNING
operator|)
condition|?
name|ath_reset
argument_list|(
name|ifp
argument_list|,
name|ATH_RESET_FULL
argument_list|)
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_txagg
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|i
decl_stmt|,
name|t
decl_stmt|,
name|param
init|=
literal|0
decl_stmt|;
name|int
name|error
decl_stmt|;
name|struct
name|ath_buf
modifier|*
name|bf
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|param
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
name|param
operator|!=
literal|1
condition|)
return|return
literal|0
return|;
name|printf
argument_list|(
literal|"no tx bufs (empty list): %d\n"
argument_list|,
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_getnobuf
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"no tx bufs (was busy): %d\n"
argument_list|,
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_getbusybuf
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr single packet: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_single_pkt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr single packet w/ BAW closed: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_baw_closed_single_pkt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr non-baw packet: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_nonbaw_pkt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr aggregate packet: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_aggr_pkt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr single packet low hwq: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_low_hwq_single_pkt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr single packet RTS aggr limited: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_rts_aggr_limited
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"aggr sched, no work: %d\n"
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_sched_nopkt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%2d: %10d "
argument_list|,
name|i
argument_list|,
name|sc
operator|->
name|sc_aggr_stats
operator|.
name|aggr_pkts
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|%
literal|4
operator|==
literal|3
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|HAL_NUM_TX_QUEUES
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ATH_TXQ_SETUP
argument_list|(
name|sc
argument_list|,
name|i
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"HW TXQ %d: axq_depth=%d, axq_aggr_depth=%d, "
literal|"axq_fifo_depth=%d, holdingbf=%p\n"
argument_list|,
name|i
argument_list|,
name|sc
operator|->
name|sc_txq
index|[
name|i
index|]
operator|.
name|axq_depth
argument_list|,
name|sc
operator|->
name|sc_txq
index|[
name|i
index|]
operator|.
name|axq_aggr_depth
argument_list|,
name|sc
operator|->
name|sc_txq
index|[
name|i
index|]
operator|.
name|axq_fifo_depth
argument_list|,
name|sc
operator|->
name|sc_txq
index|[
name|i
index|]
operator|.
name|axq_holdingbf
argument_list|)
expr_stmt|;
block|}
block|}
name|i
operator|=
name|t
operator|=
literal|0
expr_stmt|;
name|ATH_TXBUF_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|bf
argument_list|,
argument|&sc->sc_txbuf
argument_list|,
argument|bf_list
argument_list|)
block|{
if|if
condition|(
name|bf
operator|->
name|bf_flags
operator|&
name|ATH_BUF_BUSY
condition|)
block|{
name|printf
argument_list|(
literal|"Busy: %d\n"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|t
operator|++
expr_stmt|;
block|}
name|ATH_TXBUF_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Total TX buffers: %d; Total TX buffers busy: %d (%d)\n"
argument_list|,
name|t
argument_list|,
name|i
argument_list|,
name|sc
operator|->
name|sc_txbuf_cnt
argument_list|)
expr_stmt|;
name|i
operator|=
name|t
operator|=
literal|0
expr_stmt|;
name|ATH_TXBUF_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|bf
argument_list|,
argument|&sc->sc_txbuf_mgmt
argument_list|,
argument|bf_list
argument_list|)
block|{
if|if
condition|(
name|bf
operator|->
name|bf_flags
operator|&
name|ATH_BUF_BUSY
condition|)
block|{
name|printf
argument_list|(
literal|"Busy: %d\n"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|t
operator|++
expr_stmt|;
block|}
name|ATH_TXBUF_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Total mgmt TX buffers: %d; Total mgmt TX buffers busy: %d\n"
argument_list|,
name|t
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ATH_RX_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%d: fifolen: %d/%d; head=%d; tail=%d\n"
argument_list|,
name|i
argument_list|,
name|sc
operator|->
name|sc_rxedma
index|[
name|i
index|]
operator|.
name|m_fifo_depth
argument_list|,
name|sc
operator|->
name|sc_rxedma
index|[
name|i
index|]
operator|.
name|m_fifolen
argument_list|,
name|sc
operator|->
name|sc_rxedma
index|[
name|i
index|]
operator|.
name|m_fifo_head
argument_list|,
name|sc
operator|->
name|sc_rxedma
index|[
name|i
index|]
operator|.
name|m_fifo_tail
argument_list|)
expr_stmt|;
block|}
name|i
operator|=
literal|0
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|bf
argument_list|,
argument|&sc->sc_rxbuf
argument_list|,
argument|bf_list
argument_list|)
block|{
name|i
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"Total RX buffers in free list: %d buffers\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ATH_RX_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_rfsilent
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int
name|rfsilent
decl_stmt|;
name|int
name|error
decl_stmt|;
operator|(
name|void
operator|)
name|ath_hal_getrfsilent
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
operator|&
name|rfsilent
argument_list|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|rfsilent
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
operator|!
name|ath_hal_setrfsilent
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|rfsilent
argument_list|)
condition|)
return|return
name|EINVAL
return|;
name|sc
operator|->
name|sc_rfsilentpin
operator|=
name|rfsilent
operator|&
literal|0x1c
expr_stmt|;
name|sc
operator|->
name|sc_rfsilentpol
operator|=
operator|(
name|rfsilent
operator|&
literal|0x2
operator|)
operator|!=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_tpack
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int32_t
name|tpack
decl_stmt|;
name|int
name|error
decl_stmt|;
operator|(
name|void
operator|)
name|ath_hal_gettpack
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
operator|&
name|tpack
argument_list|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|tpack
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_settpack
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|tpack
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_tpcts
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|u_int32_t
name|tpcts
decl_stmt|;
name|int
name|error
decl_stmt|;
operator|(
name|void
operator|)
name|ath_hal_gettpcts
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
operator|&
name|tpcts
argument_list|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|tpcts
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
return|return
operator|!
name|ath_hal_settpcts
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|tpcts
argument_list|)
condition|?
name|EINVAL
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_intmit
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|intmit
decl_stmt|,
name|error
decl_stmt|;
name|intmit
operator|=
name|ath_hal_getintmit
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|intmit
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
comment|/* reusing error; 1 here means "good"; 0 means "fail" */
name|error
operator|=
name|ath_hal_setintmit
argument_list|(
name|sc
operator|->
name|sc_ah
argument_list|,
name|intmit
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
return|return
name|EINVAL
return|;
comment|/* 	 * Reset the hardware here - disabling ANI in the HAL 	 * doesn't reset ANI related registers, so it'll leave 	 * things in an inconsistent state. 	 */
if|if
condition|(
name|sc
operator|->
name|sc_ifp
operator|->
name|if_drv_flags
operator|&
name|IFF_DRV_RUNNING
condition|)
name|ath_reset
argument_list|(
name|sc
operator|->
name|sc_ifp
argument_list|,
name|ATH_RESET_NOLOSS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|IEEE80211_SUPPORT_TDMA
end_ifdef

begin_function
specifier|static
name|int
name|ath_sysctl_setcca
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|setcca
decl_stmt|,
name|error
decl_stmt|;
name|setcca
operator|=
name|sc
operator|->
name|sc_setcca
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|setcca
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
name|sc
operator|->
name|sc_setcca
operator|=
operator|(
name|setcca
operator|!=
literal|0
operator|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* IEEE80211_SUPPORT_TDMA */
end_comment

begin_function
specifier|static
name|int
name|ath_sysctl_forcebstuck
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|val
init|=
literal|0
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|val
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|taskqueue_enqueue_fast
argument_list|(
name|sc
operator|->
name|sc_tq
argument_list|,
operator|&
name|sc
operator|->
name|sc_bstucktask
argument_list|)
expr_stmt|;
name|val
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_hangcheck
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|val
init|=
literal|0
decl_stmt|;
name|int
name|error
decl_stmt|;
name|uint32_t
name|mask
init|=
literal|0xffffffff
decl_stmt|;
name|uint32_t
modifier|*
name|sp
decl_stmt|;
name|uint32_t
name|rsize
decl_stmt|;
name|struct
name|ath_hal
modifier|*
name|ah
init|=
name|sc
operator|->
name|sc_ah
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|val
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
return|return
literal|0
return|;
comment|/* Do a hang check */
if|if
condition|(
operator|!
name|ath_hal_getdiagstate
argument_list|(
name|ah
argument_list|,
name|HAL_DIAG_CHECK_HANGS
argument_list|,
operator|&
name|mask
argument_list|,
sizeof|sizeof
argument_list|(
name|mask
argument_list|)
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|sp
argument_list|,
operator|&
name|rsize
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"%s: sp=0x%08x\n"
argument_list|,
name|__func__
argument_list|,
operator|*
name|sp
argument_list|)
expr_stmt|;
name|val
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|ATH_DEBUG_ALQ
end_ifdef

begin_function
specifier|static
name|int
name|ath_sysctl_alq_log
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|error
decl_stmt|,
name|enable
decl_stmt|;
name|enable
operator|=
operator|(
name|sc
operator|->
name|sc_alq
operator|.
name|sc_alq_isactive
operator|)
expr_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|enable
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
operator|(
name|error
operator|)
return|;
elseif|else
if|if
condition|(
name|enable
condition|)
name|error
operator|=
name|if_ath_alq_start
argument_list|(
operator|&
name|sc
operator|->
name|sc_alq
argument_list|)
expr_stmt|;
else|else
name|error
operator|=
name|if_ath_alq_stop
argument_list|(
operator|&
name|sc
operator|->
name|sc_alq
argument_list|)
expr_stmt|;
return|return
operator|(
name|error
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Attach the ALQ debugging if required.  */
end_comment

begin_function
specifier|static
name|void
name|ath_sysctl_alq_attach
parameter_list|(
name|struct
name|ath_softc
modifier|*
name|sc
parameter_list|)
block|{
name|struct
name|sysctl_oid
modifier|*
name|tree
init|=
name|device_get_sysctl_tree
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_ctx_list
modifier|*
name|ctx
init|=
name|device_get_sysctl_ctx
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid_list
modifier|*
name|child
init|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
decl_stmt|;
name|tree
operator|=
name|SYSCTL_ADD_NODE
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"alq"
argument_list|,
name|CTLFLAG_RD
argument_list|,
name|NULL
argument_list|,
literal|"Atheros ALQ logging parameters"
argument_list|)
expr_stmt|;
name|child
operator|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_STRING
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"filename"
argument_list|,
name|CTLFLAG_RW
argument_list|,
name|sc
operator|->
name|sc_alq
operator|.
name|sc_alq_filename
argument_list|,
literal|0
argument_list|,
literal|"ALQ filename"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"enable"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_alq_log
argument_list|,
literal|"I"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"debugmask"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_alq
operator|.
name|sc_alq_debug
argument_list|,
literal|0
argument_list|,
literal|"ALQ debug mask"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"numlost"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_alq
operator|.
name|sc_alq_numlost
argument_list|,
literal|0
argument_list|,
literal|"number lost"
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ATH_DEBUG_ALQ */
end_comment

begin_function
name|void
name|ath_sysctlattach
parameter_list|(
name|struct
name|ath_softc
modifier|*
name|sc
parameter_list|)
block|{
name|struct
name|sysctl_ctx_list
modifier|*
name|ctx
init|=
name|device_get_sysctl_ctx
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid
modifier|*
name|tree
init|=
name|device_get_sysctl_tree
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|ath_hal
modifier|*
name|ah
init|=
name|sc
operator|->
name|sc_ah
decl_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"countrycode"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_eecc
argument_list|,
literal|0
argument_list|,
literal|"EEPROM country code"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"regdomain"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_eerd
argument_list|,
literal|0
argument_list|,
literal|"EEPROM regdomain code"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|ATH_DEBUG
name|SYSCTL_ADD_QUAD
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"debug"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_debug
argument_list|,
literal|"control debugging printfs"
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ATH_DEBUG_ALQ
name|SYSCTL_ADD_QUAD
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ktrdebug"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ktrdebug
argument_list|,
literal|"control debugging KTR"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* ATH_DEBUG_ALQ */
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"slottime"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_slottime
argument_list|,
literal|"I"
argument_list|,
literal|"802.11 slot time (us)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"acktimeout"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_acktimeout
argument_list|,
literal|"I"
argument_list|,
literal|"802.11 ACK timeout (us)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ctstimeout"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_ctstimeout
argument_list|,
literal|"I"
argument_list|,
literal|"802.11 CTS timeout (us)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"softled"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_softled
argument_list|,
literal|"I"
argument_list|,
literal|"enable/disable software LED support"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ledpin"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_ledpin
argument_list|,
literal|"I"
argument_list|,
literal|"GPIO pin connected to LED"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ledon"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ledon
argument_list|,
literal|0
argument_list|,
literal|"setting to turn LED on"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ledidle"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ledidle
argument_list|,
literal|0
argument_list|,
literal|"idle time for inactivity LED (ticks)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"hardled"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_hardled
argument_list|,
literal|"I"
argument_list|,
literal|"enable/disable hardware LED support"
argument_list|)
expr_stmt|;
comment|/* XXX Laziness - configure pins, then flip hardled off/on */
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"led_net_pin"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_led_net_pin
argument_list|,
literal|0
argument_list|,
literal|"MAC Network LED pin, or -1 to disable"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"led_pwr_pin"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_led_pwr_pin
argument_list|,
literal|0
argument_list|,
literal|"MAC Power LED pin, or -1 to disable"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"txantenna"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_txantenna
argument_list|,
literal|"I"
argument_list|,
literal|"antenna switch"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"rxantenna"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_rxantenna
argument_list|,
literal|"I"
argument_list|,
literal|"default/rx antenna"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath_hal_hasdiversity
argument_list|(
name|ah
argument_list|)
condition|)
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"diversity"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_diversity
argument_list|,
literal|"I"
argument_list|,
literal|"antenna diversity"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_txintrperiod
operator|=
name|ATH_TXINTR_PERIOD
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"txintrperiod"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_txintrperiod
argument_list|,
literal|0
argument_list|,
literal|"tx descriptor batching"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"diag"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_diag
argument_list|,
literal|"I"
argument_list|,
literal|"h/w diagnostic control"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"tpscale"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_tpscale
argument_list|,
literal|"I"
argument_list|,
literal|"tx power scaling"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath_hal_hastpc
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"tpc"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_tpc
argument_list|,
literal|"I"
argument_list|,
literal|"enable/disable per-packet TPC"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"tpack"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_tpack
argument_list|,
literal|"I"
argument_list|,
literal|"tx power for ack frames"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"tpcts"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_tpcts
argument_list|,
literal|"I"
argument_list|,
literal|"tx power for cts frames"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ath_hal_hasrfsilent
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"rfsilent"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_rfsilent
argument_list|,
literal|"I"
argument_list|,
literal|"h/w RF silent config"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"rfkill"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_rfkill
argument_list|,
literal|"I"
argument_list|,
literal|"enable/disable RF kill switch"
argument_list|)
expr_stmt|;
block|}
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"txagg"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_txagg
argument_list|,
literal|"I"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"forcebstuck"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_forcebstuck
argument_list|,
literal|"I"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"hangcheck"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_hangcheck
argument_list|,
literal|"I"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath_hal_hasintmit
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"intmit"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_intmit
argument_list|,
literal|"I"
argument_list|,
literal|"interference mitigation"
argument_list|)
expr_stmt|;
block|}
name|sc
operator|->
name|sc_monpass
operator|=
name|HAL_RXERR_DECRYPT
operator||
name|HAL_RXERR_MIC
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"monpass"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_monpass
argument_list|,
literal|0
argument_list|,
literal|"mask of error frames to pass when monitoring"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"hwq_limit_nonaggr"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_hwq_limit_nonaggr
argument_list|,
literal|0
argument_list|,
literal|"Hardware non-AMPDU queue depth before software-queuing TX frames"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"hwq_limit_aggr"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_hwq_limit_aggr
argument_list|,
literal|0
argument_list|,
literal|"Hardware AMPDU queue depth before software-queuing TX frames"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"tid_hwq_lo"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_tid_hwq_lo
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"tid_hwq_hi"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_tid_hwq_hi
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
comment|/* Aggregate length twiddles */
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"aggr_limit"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_aggr_limit
argument_list|,
literal|0
argument_list|,
literal|"Maximum A-MPDU size, or 0 for 'default'"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"rts_aggr_limit"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_rts_aggr_limit
argument_list|,
literal|0
argument_list|,
literal|"Maximum A-MPDU size for RTS-protected frames, or '0' "
literal|"for default"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"delim_min_pad"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_delim_min_pad
argument_list|,
literal|0
argument_list|,
literal|"Enforce a minimum number of delimiters per A-MPDU "
literal|" sub-frame"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"txq_data_minfree"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_txq_data_minfree
argument_list|,
literal|0
argument_list|,
literal|"Minimum free buffers before adding a data frame"
literal|" to the TX queue"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"txq_mcastq_maxdepth"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_txq_mcastq_maxdepth
argument_list|,
literal|0
argument_list|,
literal|"Maximum buffer depth for multicast/broadcast frames"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"txq_node_maxdepth"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_txq_node_maxdepth
argument_list|,
literal|0
argument_list|,
literal|"Maximum buffer depth for a single node"
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|SYSCTL_ADD_INT(ctx, SYSCTL_CHILDREN(tree), OID_AUTO, 		"cabq_enable", CTLFLAG_RW,&sc->sc_cabq_enable, 0, 		"Whether to transmit on the CABQ or not");
endif|#
directive|endif
ifdef|#
directive|ifdef
name|IEEE80211_SUPPORT_TDMA
if|if
condition|(
name|ath_hal_macversion
argument_list|(
name|ah
argument_list|)
operator|>
literal|0x78
condition|)
block|{
name|sc
operator|->
name|sc_tdmadbaprep
operator|=
literal|2
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"dbaprep"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_tdmadbaprep
argument_list|,
literal|0
argument_list|,
literal|"TDMA DBA preparation time"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_tdmaswbaprep
operator|=
literal|10
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"swbaprep"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_tdmaswbaprep
argument_list|,
literal|0
argument_list|,
literal|"TDMA SWBA preparation time"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"guardtime"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_tdmaguard
argument_list|,
literal|0
argument_list|,
literal|"TDMA slot guard time"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"superframe"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_tdmabintval
argument_list|,
literal|0
argument_list|,
literal|"TDMA calculated super frame"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"setcca"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_setcca
argument_list|,
literal|"I"
argument_list|,
literal|"enable CCA control"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ATH_DEBUG_ALQ
name|ath_sysctl_alq_attach
argument_list|(
name|sc
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|int
name|ath_sysctl_clearstats
parameter_list|(
name|SYSCTL_HANDLER_ARGS
parameter_list|)
block|{
name|struct
name|ath_softc
modifier|*
name|sc
init|=
name|arg1
decl_stmt|;
name|int
name|val
init|=
literal|0
decl_stmt|;
name|int
name|error
decl_stmt|;
name|error
operator|=
name|sysctl_handle_int
argument_list|(
name|oidp
argument_list|,
operator|&
name|val
argument_list|,
literal|0
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|req
operator|->
name|newptr
condition|)
return|return
name|error
return|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
return|return
literal|0
return|;
comment|/* Not clearing the stats is still valid */
name|memset
argument_list|(
operator|&
name|sc
operator|->
name|sc_stats
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|sc
operator|->
name|sc_stats
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|sc
operator|->
name|sc_aggr_stats
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|sc
operator|->
name|sc_aggr_stats
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|sc
operator|->
name|sc_intr_stats
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|sc
operator|->
name|sc_intr_stats
argument_list|)
argument_list|)
expr_stmt|;
name|val
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ath_sysctl_stats_attach_rxphyerr
parameter_list|(
name|struct
name|ath_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|sysctl_oid_list
modifier|*
name|parent
parameter_list|)
block|{
name|struct
name|sysctl_ctx_list
modifier|*
name|ctx
init|=
name|device_get_sysctl_ctx
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid
modifier|*
name|tree
init|=
name|device_get_sysctl_tree
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid_list
modifier|*
name|child
init|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
name|sn
index|[
literal|8
index|]
decl_stmt|;
name|tree
operator|=
name|SYSCTL_ADD_NODE
argument_list|(
name|ctx
argument_list|,
name|parent
argument_list|,
name|OID_AUTO
argument_list|,
literal|"rx_phy_err"
argument_list|,
name|CTLFLAG_RD
argument_list|,
name|NULL
argument_list|,
literal|"Per-code RX PHY Errors"
argument_list|)
expr_stmt|;
name|child
operator|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
name|snprintf
argument_list|(
name|sn
argument_list|,
sizeof|sizeof
argument_list|(
name|sn
argument_list|)
argument_list|,
literal|"%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
name|sn
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_phy
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ath_sysctl_stats_attach_intr
parameter_list|(
name|struct
name|ath_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|sysctl_oid_list
modifier|*
name|parent
parameter_list|)
block|{
name|struct
name|sysctl_ctx_list
modifier|*
name|ctx
init|=
name|device_get_sysctl_ctx
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid
modifier|*
name|tree
init|=
name|device_get_sysctl_tree
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid_list
modifier|*
name|child
init|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
name|sn
index|[
literal|8
index|]
decl_stmt|;
name|tree
operator|=
name|SYSCTL_ADD_NODE
argument_list|(
name|ctx
argument_list|,
name|parent
argument_list|,
name|OID_AUTO
argument_list|,
literal|"sync_intr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
name|NULL
argument_list|,
literal|"Sync interrupt statistics"
argument_list|)
expr_stmt|;
name|child
operator|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|snprintf
argument_list|(
name|sn
argument_list|,
sizeof|sizeof
argument_list|(
name|sn
argument_list|)
argument_list|,
literal|"%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
name|sn
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_intr_stats
operator|.
name|sync_intr
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|ath_sysctl_stats_attach
parameter_list|(
name|struct
name|ath_softc
modifier|*
name|sc
parameter_list|)
block|{
name|struct
name|sysctl_oid
modifier|*
name|tree
init|=
name|device_get_sysctl_tree
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_ctx_list
modifier|*
name|ctx
init|=
name|device_get_sysctl_ctx
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid_list
modifier|*
name|child
init|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
decl_stmt|;
comment|/* Create "clear" node */
name|SYSCTL_ADD_PROC
argument_list|(
name|ctx
argument_list|,
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
argument_list|,
name|OID_AUTO
argument_list|,
literal|"clear_stats"
argument_list|,
name|CTLTYPE_INT
operator||
name|CTLFLAG_RW
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|ath_sysctl_clearstats
argument_list|,
literal|"I"
argument_list|,
literal|"clear stats"
argument_list|)
expr_stmt|;
comment|/* Create stats node */
name|tree
operator|=
name|SYSCTL_ADD_NODE
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"stats"
argument_list|,
name|CTLFLAG_RD
argument_list|,
name|NULL
argument_list|,
literal|"Statistics"
argument_list|)
expr_stmt|;
name|child
operator|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
expr_stmt|;
comment|/* This was generated from if_athioctl.h */
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_watchdog"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_watchdog
argument_list|,
literal|0
argument_list|,
literal|"device reset by watchdog"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_hardware"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_hardware
argument_list|,
literal|0
argument_list|,
literal|"fatal hardware error interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_bmiss"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_bmiss
argument_list|,
literal|0
argument_list|,
literal|"beacon miss interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_bmiss_phantom"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_bmiss_phantom
argument_list|,
literal|0
argument_list|,
literal|"beacon miss interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_bstuck"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_bstuck
argument_list|,
literal|0
argument_list|,
literal|"beacon stuck interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rxorn"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rxorn
argument_list|,
literal|0
argument_list|,
literal|"rx overrun interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rxeol"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rxeol
argument_list|,
literal|0
argument_list|,
literal|"rx eol interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_txurn"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_txurn
argument_list|,
literal|0
argument_list|,
literal|"tx underrun interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_mib"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_mib
argument_list|,
literal|0
argument_list|,
literal|"mib interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_intrcoal"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_intrcoal
argument_list|,
literal|0
argument_list|,
literal|"interrupts coalesced"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_packets"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_packets
argument_list|,
literal|0
argument_list|,
literal|"packet sent on the interface"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_mgmt"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_mgmt
argument_list|,
literal|0
argument_list|,
literal|"management frames transmitted"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_discard"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_discard
argument_list|,
literal|0
argument_list|,
literal|"frames discarded prior to assoc"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_qstop"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_qstop
argument_list|,
literal|0
argument_list|,
literal|"output stopped 'cuz no buffer"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_encap"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_encap
argument_list|,
literal|0
argument_list|,
literal|"tx encapsulation failed"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_nonode"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_nonode
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz no node"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_nombuf"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_nombuf
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz no mbuf"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_nomcl"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_nomcl
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz no cluster"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_linear"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_linear
argument_list|,
literal|0
argument_list|,
literal|"tx linearized to cluster"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_nodata"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_nodata
argument_list|,
literal|0
argument_list|,
literal|"tx discarded empty frame"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_busdma"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_busdma
argument_list|,
literal|0
argument_list|,
literal|"tx failed for dma resrcs"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_xretries"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_xretries
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz too many retries"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_fifoerr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_fifoerr
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz FIFO underrun"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_filtered"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_filtered
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz xmit filtered"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_shortretry"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_shortretry
argument_list|,
literal|0
argument_list|,
literal|"tx on-chip retries (short)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_longretry"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_longretry
argument_list|,
literal|0
argument_list|,
literal|"tx on-chip retries (long)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_badrate"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_badrate
argument_list|,
literal|0
argument_list|,
literal|"tx failed 'cuz bogus xmit rate"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_noack"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_noack
argument_list|,
literal|0
argument_list|,
literal|"tx frames with no ack marked"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_rts"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_rts
argument_list|,
literal|0
argument_list|,
literal|"tx frames with rts enabled"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_cts"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_cts
argument_list|,
literal|0
argument_list|,
literal|"tx frames with cts enabled"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_shortpre"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_shortpre
argument_list|,
literal|0
argument_list|,
literal|"tx frames with short preamble"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_altrate"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_altrate
argument_list|,
literal|0
argument_list|,
literal|"tx frames with alternate rate"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_protect"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_protect
argument_list|,
literal|0
argument_list|,
literal|"tx frames with protection"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_ctsburst"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_ctsburst
argument_list|,
literal|0
argument_list|,
literal|"tx frames with cts and bursting"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_ctsext"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_ctsext
argument_list|,
literal|0
argument_list|,
literal|"tx frames with cts extension"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_nombuf"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_nombuf
argument_list|,
literal|0
argument_list|,
literal|"rx setup failed 'cuz no mbuf"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_busdma"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_busdma
argument_list|,
literal|0
argument_list|,
literal|"rx setup failed for dma resrcs"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_orn"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_orn
argument_list|,
literal|0
argument_list|,
literal|"rx failed 'cuz of desc overrun"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_crcerr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_crcerr
argument_list|,
literal|0
argument_list|,
literal|"rx failed 'cuz of bad CRC"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_fifoerr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_fifoerr
argument_list|,
literal|0
argument_list|,
literal|"rx failed 'cuz of FIFO overrun"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_badcrypt"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_badcrypt
argument_list|,
literal|0
argument_list|,
literal|"rx failed 'cuz decryption"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_badmic"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_badmic
argument_list|,
literal|0
argument_list|,
literal|"rx failed 'cuz MIC failure"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_phyerr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_phyerr
argument_list|,
literal|0
argument_list|,
literal|"rx failed 'cuz of PHY err"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_tooshort"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_tooshort
argument_list|,
literal|0
argument_list|,
literal|"rx discarded 'cuz frame too short"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_toobig"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_toobig
argument_list|,
literal|0
argument_list|,
literal|"rx discarded 'cuz frame too large"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_packets"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_packets
argument_list|,
literal|0
argument_list|,
literal|"packet recv on the interface"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_mgt"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_mgt
argument_list|,
literal|0
argument_list|,
literal|"management frames received"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_ctl"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_ctl
argument_list|,
literal|0
argument_list|,
literal|"rx discarded 'cuz ctl frame"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_be_xmit"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_be_xmit
argument_list|,
literal|0
argument_list|,
literal|"beacons transmitted"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_be_nombuf"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_be_nombuf
argument_list|,
literal|0
argument_list|,
literal|"beacon setup failed 'cuz no mbuf"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_per_cal"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_per_cal
argument_list|,
literal|0
argument_list|,
literal|"periodic calibration calls"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_per_calfail"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_per_calfail
argument_list|,
literal|0
argument_list|,
literal|"periodic calibration failed"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_per_rfgain"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_per_rfgain
argument_list|,
literal|0
argument_list|,
literal|"periodic calibration rfgain reset"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rate_calls"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rate_calls
argument_list|,
literal|0
argument_list|,
literal|"rate control checks"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rate_raise"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rate_raise
argument_list|,
literal|0
argument_list|,
literal|"rate control raised xmit rate"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rate_drop"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rate_drop
argument_list|,
literal|0
argument_list|,
literal|"rate control dropped xmit rate"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ant_defswitch"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ant_defswitch
argument_list|,
literal|0
argument_list|,
literal|"rx/default antenna switches"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ant_txswitch"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ant_txswitch
argument_list|,
literal|0
argument_list|,
literal|"tx antenna switches"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_cabq_xmit"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_cabq_xmit
argument_list|,
literal|0
argument_list|,
literal|"cabq frames transmitted"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_cabq_busy"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_cabq_busy
argument_list|,
literal|0
argument_list|,
literal|"cabq found busy"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_raw"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_raw
argument_list|,
literal|0
argument_list|,
literal|"tx frames through raw api"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ff_txok"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ff_txok
argument_list|,
literal|0
argument_list|,
literal|"fast frames tx'd successfully"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ff_txerr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ff_txerr
argument_list|,
literal|0
argument_list|,
literal|"fast frames tx'd w/ error"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ff_rx"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ff_rx
argument_list|,
literal|0
argument_list|,
literal|"fast frames rx'd"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ff_flush"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ff_flush
argument_list|,
literal|0
argument_list|,
literal|"fast frames flushed from staging q"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_qfull"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_qfull
argument_list|,
literal|0
argument_list|,
literal|"tx dropped 'cuz of queue limit"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_nobuf"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_nobuf
argument_list|,
literal|0
argument_list|,
literal|"tx dropped 'cuz no ath buffer"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tdma_update"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tdma_update
argument_list|,
literal|0
argument_list|,
literal|"TDMA slot timing updates"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tdma_timers"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tdma_timers
argument_list|,
literal|0
argument_list|,
literal|"TDMA slot update set beacon timers"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tdma_tsf"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tdma_tsf
argument_list|,
literal|0
argument_list|,
literal|"TDMA slot update set TSF"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tdma_ack"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tdma_ack
argument_list|,
literal|0
argument_list|,
literal|"TDMA tx failed 'cuz ACK required"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_raw_fail"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_raw_fail
argument_list|,
literal|0
argument_list|,
literal|"raw tx failed 'cuz h/w down"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_nofrag"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_nofrag
argument_list|,
literal|0
argument_list|,
literal|"tx dropped 'cuz no ath frag buffer"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_be_missed"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_be_missed
argument_list|,
literal|0
argument_list|,
literal|"number of -missed- beacons"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_ani_cal"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_ani_cal
argument_list|,
literal|0
argument_list|,
literal|"number of ANI polls"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_agg"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_agg
argument_list|,
literal|0
argument_list|,
literal|"number of aggregate frames received"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_halfgi"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_halfgi
argument_list|,
literal|0
argument_list|,
literal|"number of frames received with half-GI"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_2040"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_2040
argument_list|,
literal|0
argument_list|,
literal|"number of HT/40 frames received"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_pre_crc_err"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_pre_crc_err
argument_list|,
literal|0
argument_list|,
literal|"number of delimeter-CRC errors detected"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_post_crc_err"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_post_crc_err
argument_list|,
literal|0
argument_list|,
literal|"number of post-delimiter CRC errors detected"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_decrypt_busy_err"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_decrypt_busy_err
argument_list|,
literal|0
argument_list|,
literal|"number of frames received w/ busy decrypt engine"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_hi_rx_chain"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_hi_rx_chain
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_htprotect"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_htprotect
argument_list|,
literal|0
argument_list|,
literal|"HT tx frames with protection"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_hitqueueend"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_hitqueueend
argument_list|,
literal|0
argument_list|,
literal|"RX hit queue end"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_timeout"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_timeout
argument_list|,
literal|0
argument_list|,
literal|"TX Global Timeout"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_cst"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_cst
argument_list|,
literal|0
argument_list|,
literal|"TX Carrier Sense Timeout"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_xtxop"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_xtxop
argument_list|,
literal|0
argument_list|,
literal|"TX exceeded TXOP"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_timerexpired"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_timerexpired
argument_list|,
literal|0
argument_list|,
literal|"TX exceeded TX_TIMER register"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_desccfgerr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_desccfgerr
argument_list|,
literal|0
argument_list|,
literal|"TX Descriptor Cfg Error"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_swretries"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_swretries
argument_list|,
literal|0
argument_list|,
literal|"TX software retry count"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_swretrymax"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_swretrymax
argument_list|,
literal|0
argument_list|,
literal|"TX software retry max reached"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_data_underrun"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_data_underrun
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_delim_underrun"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_delim_underrun
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_aggr_failall"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_aggr_failall
argument_list|,
literal|0
argument_list|,
literal|"Number of aggregate TX failures (whole frame)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_aggr_ok"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_aggr_ok
argument_list|,
literal|0
argument_list|,
literal|"Number of aggregate TX OK completions (subframe)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_aggr_fail"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_aggr_fail
argument_list|,
literal|0
argument_list|,
literal|"Number of aggregate TX failures (subframe)"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_intr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_intr
argument_list|,
literal|0
argument_list|,
literal|"RX interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_intr"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_intr
argument_list|,
literal|0
argument_list|,
literal|"TX interrupts"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_mcastq_overflow"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_mcastq_overflow
argument_list|,
literal|0
argument_list|,
literal|"Number of multicast frames exceeding maximum mcast queue depth"
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_keymiss"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_keymiss
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_tx_swfiltered"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_tx_swfiltered
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|SYSCTL_ADD_UINT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ast_rx_stbc"
argument_list|,
name|CTLFLAG_RD
argument_list|,
operator|&
name|sc
operator|->
name|sc_stats
operator|.
name|ast_rx_stbc
argument_list|,
literal|0
argument_list|,
literal|"Number of STBC frames received"
argument_list|)
expr_stmt|;
comment|/* Attach the RX phy error array */
name|ath_sysctl_stats_attach_rxphyerr
argument_list|(
name|sc
argument_list|,
name|child
argument_list|)
expr_stmt|;
comment|/* Attach the interrupt statistics array */
name|ath_sysctl_stats_attach_intr
argument_list|(
name|sc
argument_list|,
name|child
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * This doesn't necessarily belong here (because it's HAL related, not  * driver related).  */
end_comment

begin_function
name|void
name|ath_sysctl_hal_attach
parameter_list|(
name|struct
name|ath_softc
modifier|*
name|sc
parameter_list|)
block|{
name|struct
name|sysctl_oid
modifier|*
name|tree
init|=
name|device_get_sysctl_tree
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_ctx_list
modifier|*
name|ctx
init|=
name|device_get_sysctl_ctx
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
decl_stmt|;
name|struct
name|sysctl_oid_list
modifier|*
name|child
init|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
decl_stmt|;
name|tree
operator|=
name|SYSCTL_ADD_NODE
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"hal"
argument_list|,
name|CTLFLAG_RD
argument_list|,
name|NULL
argument_list|,
literal|"Atheros HAL parameters"
argument_list|)
expr_stmt|;
name|child
operator|=
name|SYSCTL_CHILDREN
argument_list|(
name|tree
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_debug
operator|=
literal|0
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"debug"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_debug
argument_list|,
literal|0
argument_list|,
literal|"Atheros HAL debugging printfs"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_ar5416_biasadj
operator|=
literal|0
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"ar5416_biasadj"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_ar5416_biasadj
argument_list|,
literal|0
argument_list|,
literal|"Enable 2GHz AR5416 direction sensitivity bias adjust"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_dma_beacon_response_time
operator|=
literal|2
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"dma_brt"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_dma_beacon_response_time
argument_list|,
literal|0
argument_list|,
literal|"Atheros HAL DMA beacon response time"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_sw_beacon_response_time
operator|=
literal|10
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"sw_brt"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_sw_beacon_response_time
argument_list|,
literal|0
argument_list|,
literal|"Atheros HAL software beacon response time"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_additional_swba_backoff
operator|=
literal|0
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"swba_backoff"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_additional_swba_backoff
argument_list|,
literal|0
argument_list|,
literal|"Atheros HAL additional SWBA backoff time"
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_force_full_reset
operator|=
literal|0
expr_stmt|;
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"force_full_reset"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_force_full_reset
argument_list|,
literal|0
argument_list|,
literal|"Force full chip reset rather than a warm reset"
argument_list|)
expr_stmt|;
comment|/* 	 * This is initialised by the driver. 	 */
name|SYSCTL_ADD_INT
argument_list|(
name|ctx
argument_list|,
name|child
argument_list|,
name|OID_AUTO
argument_list|,
literal|"serialise_reg_war"
argument_list|,
name|CTLFLAG_RW
argument_list|,
operator|&
name|sc
operator|->
name|sc_ah
operator|->
name|ah_config
operator|.
name|ah_serialise_reg_war
argument_list|,
literal|0
argument_list|,
literal|"Force register access serialisation"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

