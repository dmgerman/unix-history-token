begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $FreeBSD$  */
end_comment

begin_struct
struct|struct
name|mcd_mbx
block|{
name|short
name|retry
decl_stmt|;
name|short
name|nblk
decl_stmt|;
name|int
name|sz
decl_stmt|;
name|u_long
name|skip
decl_stmt|;
name|struct
name|bio
modifier|*
name|bp
decl_stmt|;
name|short
name|count
decl_stmt|;
name|short
name|mode
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mcd_data
block|{
name|short
name|type
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|short
name|config
decl_stmt|;
name|short
name|flags
decl_stmt|;
name|u_char
name|read_command
decl_stmt|;
name|short
name|status
decl_stmt|;
name|int
name|blksize
decl_stmt|;
name|u_long
name|disksize
decl_stmt|;
name|int
name|partflags
decl_stmt|;
name|int
name|openflags
decl_stmt|;
name|struct
name|mcd_volinfo
name|volinfo
decl_stmt|;
name|struct
name|mcd_qchninfo
name|toc
index|[
name|MCD_MAXTOCS
index|]
decl_stmt|;
name|short
name|audio_status
decl_stmt|;
name|short
name|curr_mode
decl_stmt|;
name|struct
name|mcd_read2
name|lastpb
decl_stmt|;
name|short
name|debug
decl_stmt|;
name|struct
name|bio_queue_head
name|head
decl_stmt|;
comment|/* head of bio queue */
name|struct
name|mcd_mbx
name|mbx
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mcd_softc
block|{
name|device_t
name|dev
decl_stmt|;
name|struct
name|cdev
modifier|*
name|mcd_dev_t
decl_stmt|;
name|int
name|debug
decl_stmt|;
name|struct
name|resource
modifier|*
name|port
decl_stmt|;
name|int
name|port_rid
decl_stmt|;
name|int
name|port_type
decl_stmt|;
name|bus_space_tag_t
name|port_bst
decl_stmt|;
name|bus_space_handle_t
name|port_bsh
decl_stmt|;
name|struct
name|resource
modifier|*
name|irq
decl_stmt|;
name|int
name|irq_rid
decl_stmt|;
name|int
name|irq_type
decl_stmt|;
name|void
modifier|*
name|irq_ih
decl_stmt|;
name|struct
name|resource
modifier|*
name|drq
decl_stmt|;
name|int
name|drq_rid
decl_stmt|;
name|int
name|drq_type
decl_stmt|;
name|struct
name|mtx
name|mtx
decl_stmt|;
name|struct
name|callout_handle
name|ch
decl_stmt|;
name|int
name|ch_state
decl_stmt|;
name|struct
name|mcd_mbx
modifier|*
name|ch_mbxsave
decl_stmt|;
name|struct
name|mcd_data
name|data
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MCD_LOCK
parameter_list|(
name|_sc
parameter_list|)
value|splx(&(_sc)->mtx
end_define

begin_define
define|#
directive|define
name|MCD_UNLOCK
parameter_list|(
name|_sc
parameter_list|)
value|splx(&(_sc)->mtx
end_define

begin_define
define|#
directive|define
name|MCD_READ
parameter_list|(
name|_sc
parameter_list|,
name|_reg
parameter_list|)
define|\
value|bus_space_read_1(_sc->port_bst, _sc->port_bsh, _reg)
end_define

begin_define
define|#
directive|define
name|MCD_WRITE
parameter_list|(
name|_sc
parameter_list|,
name|_reg
parameter_list|,
name|_val
parameter_list|)
define|\
value|bus_space_write_1(_sc->port_bst, _sc->port_bsh, _reg, _val)
end_define

begin_function_decl
name|int
name|mcd_probe
parameter_list|(
name|struct
name|mcd_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mcd_attach
parameter_list|(
name|struct
name|mcd_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

end_unit

