begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************    Copyright (c) 2001-2013, Intel Corporation    All rights reserved.      Redistribution and use in source and binary forms, with or without    modification, are permitted provided that the following conditions are met:       1. Redistributions of source code must retain the above copyright notice,        this list of conditions and the following disclaimer.       2. Redistributions in binary form must reproduce the above copyright        notice, this list of conditions and the following disclaimer in the        documentation and/or other materials provided with the distribution.       3. Neither the name of the Intel Corporation nor the names of its        contributors may be used to endorse or promote products derived from        this software without specific prior written permission.      THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE    ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR    CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE   POSSIBILITY OF SUCH DAMAGE.  ******************************************************************************/
end_comment

begin_comment
comment|/*$FreeBSD$*/
end_comment

begin_include
include|#
directive|include
file|"ixgbe_type.h"
end_include

begin_include
include|#
directive|include
file|"ixgbe_dcb.h"
end_include

begin_include
include|#
directive|include
file|"ixgbe_dcb_82598.h"
end_include

begin_comment
comment|/**  * ixgbe_dcb_get_tc_stats_82598 - Return status data for each traffic class  * @hw: pointer to hardware structure  * @stats: pointer to statistics structure  * @tc_count:  Number of elements in bwg_array.  *  * This function returns the status data for each of the Traffic Classes in use.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_get_tc_stats_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|ixgbe_hw_stats
modifier|*
name|stats
parameter_list|,
name|u8
name|tc_count
parameter_list|)
block|{
name|int
name|tc
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"dcb_get_tc_stats"
argument_list|)
expr_stmt|;
if|if
condition|(
name|tc_count
operator|>
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
condition|)
return|return
name|IXGBE_ERR_PARAM
return|;
comment|/* Statistics pertaining to each traffic class */
for|for
control|(
name|tc
operator|=
literal|0
init|;
name|tc
operator|<
name|tc_count
condition|;
name|tc
operator|++
control|)
block|{
comment|/* Transmitted Packets */
name|stats
operator|->
name|qptc
index|[
name|tc
index|]
operator|+=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_QPTC
argument_list|(
name|tc
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Transmitted Bytes */
name|stats
operator|->
name|qbtc
index|[
name|tc
index|]
operator|+=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_QBTC
argument_list|(
name|tc
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Received Packets */
name|stats
operator|->
name|qprc
index|[
name|tc
index|]
operator|+=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_QPRC
argument_list|(
name|tc
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Received Bytes */
name|stats
operator|->
name|qbrc
index|[
name|tc
index|]
operator|+=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_QBRC
argument_list|(
name|tc
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* Can we get rid of these??  Consequently, getting rid 		 * of the tc_stats structure. 		 */
block|tc_stats_array[up]->in_overflow_discards = 0; 		tc_stats_array[up]->out_overflow_discards = 0;
endif|#
directive|endif
block|}
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_get_pfc_stats_82598 - Returns CBFC status data  * @hw: pointer to hardware structure  * @stats: pointer to statistics structure  * @tc_count:  Number of elements in bwg_array.  *  * This function returns the CBFC status data for each of the Traffic Classes.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_get_pfc_stats_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|ixgbe_hw_stats
modifier|*
name|stats
parameter_list|,
name|u8
name|tc_count
parameter_list|)
block|{
name|int
name|tc
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"dcb_get_pfc_stats"
argument_list|)
expr_stmt|;
if|if
condition|(
name|tc_count
operator|>
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
condition|)
return|return
name|IXGBE_ERR_PARAM
return|;
for|for
control|(
name|tc
operator|=
literal|0
init|;
name|tc
operator|<
name|tc_count
condition|;
name|tc
operator|++
control|)
block|{
comment|/* Priority XOFF Transmitted */
name|stats
operator|->
name|pxofftxc
index|[
name|tc
index|]
operator|+=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_PXOFFTXC
argument_list|(
name|tc
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Priority XOFF Received */
name|stats
operator|->
name|pxoffrxc
index|[
name|tc
index|]
operator|+=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_PXOFFRXC
argument_list|(
name|tc
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_config_rx_arbiter_82598 - Config Rx data arbiter  * @hw: pointer to hardware structure  * @dcb_config: pointer to ixgbe_dcb_config structure  *  * Configure Rx Data Arbiter and credits for each traffic class.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_config_rx_arbiter_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|u16
modifier|*
name|refill
parameter_list|,
name|u16
modifier|*
name|max
parameter_list|,
name|u8
modifier|*
name|tsa
parameter_list|)
block|{
name|u32
name|reg
init|=
literal|0
decl_stmt|;
name|u32
name|credit_refill
init|=
literal|0
decl_stmt|;
name|u32
name|credit_max
init|=
literal|0
decl_stmt|;
name|u8
name|i
init|=
literal|0
decl_stmt|;
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RUPPBMR
argument_list|)
operator||
name|IXGBE_RUPPBMR_MQA
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RUPPBMR
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RMCS
argument_list|)
expr_stmt|;
comment|/* Enable Arbiter */
name|reg
operator|&=
operator|~
name|IXGBE_RMCS_ARBDIS
expr_stmt|;
comment|/* Enable Receive Recycle within the BWG */
name|reg
operator||=
name|IXGBE_RMCS_RRM
expr_stmt|;
comment|/* Enable Deficit Fixed Priority arbitration*/
name|reg
operator||=
name|IXGBE_RMCS_DFP
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RMCS
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Configure traffic class credits and priority */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
condition|;
name|i
operator|++
control|)
block|{
name|credit_refill
operator|=
name|refill
index|[
name|i
index|]
expr_stmt|;
name|credit_max
operator|=
name|max
index|[
name|i
index|]
expr_stmt|;
name|reg
operator|=
name|credit_refill
operator||
operator|(
name|credit_max
operator|<<
name|IXGBE_RT2CR_MCL_SHIFT
operator|)
expr_stmt|;
if|if
condition|(
name|tsa
index|[
name|i
index|]
operator|==
name|ixgbe_dcb_tsa_strict
condition|)
name|reg
operator||=
name|IXGBE_RT2CR_LSP
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RT2CR
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RDRXCTL
argument_list|)
expr_stmt|;
name|reg
operator||=
name|IXGBE_RDRXCTL_RDMTS_1_2
expr_stmt|;
name|reg
operator||=
name|IXGBE_RDRXCTL_MPBEN
expr_stmt|;
name|reg
operator||=
name|IXGBE_RDRXCTL_MCEN
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RDRXCTL
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RXCTRL
argument_list|)
expr_stmt|;
comment|/* Make sure there is enough descriptors before arbitration */
name|reg
operator|&=
operator|~
name|IXGBE_RXCTRL_DMBYPS
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RXCTRL
argument_list|,
name|reg
argument_list|)
expr_stmt|;
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_config_tx_desc_arbiter_82598 - Config Tx Desc. arbiter  * @hw: pointer to hardware structure  * @dcb_config: pointer to ixgbe_dcb_config structure  *  * Configure Tx Descriptor Arbiter and credits for each traffic class.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_config_tx_desc_arbiter_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|u16
modifier|*
name|refill
parameter_list|,
name|u16
modifier|*
name|max
parameter_list|,
name|u8
modifier|*
name|bwg_id
parameter_list|,
name|u8
modifier|*
name|tsa
parameter_list|)
block|{
name|u32
name|reg
decl_stmt|,
name|max_credits
decl_stmt|;
name|u8
name|i
decl_stmt|;
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_DPMCS
argument_list|)
expr_stmt|;
comment|/* Enable arbiter */
name|reg
operator|&=
operator|~
name|IXGBE_DPMCS_ARBDIS
expr_stmt|;
name|reg
operator||=
name|IXGBE_DPMCS_TSOEF
expr_stmt|;
comment|/* Configure Max TSO packet size 34KB including payload and headers */
name|reg
operator||=
operator|(
literal|0x4
operator|<<
name|IXGBE_DPMCS_MTSOS_SHIFT
operator|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_DPMCS
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Configure traffic class credits and priority */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
condition|;
name|i
operator|++
control|)
block|{
name|max_credits
operator|=
name|max
index|[
name|i
index|]
expr_stmt|;
name|reg
operator|=
name|max_credits
operator|<<
name|IXGBE_TDTQ2TCCR_MCL_SHIFT
expr_stmt|;
name|reg
operator||=
name|refill
index|[
name|i
index|]
expr_stmt|;
name|reg
operator||=
call|(
name|u32
call|)
argument_list|(
name|bwg_id
index|[
name|i
index|]
argument_list|)
operator|<<
name|IXGBE_TDTQ2TCCR_BWG_SHIFT
expr_stmt|;
if|if
condition|(
name|tsa
index|[
name|i
index|]
operator|==
name|ixgbe_dcb_tsa_group_strict_cee
condition|)
name|reg
operator||=
name|IXGBE_TDTQ2TCCR_GSP
expr_stmt|;
if|if
condition|(
name|tsa
index|[
name|i
index|]
operator|==
name|ixgbe_dcb_tsa_strict
condition|)
name|reg
operator||=
name|IXGBE_TDTQ2TCCR_LSP
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_TDTQ2TCCR
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_config_tx_data_arbiter_82598 - Config Tx data arbiter  * @hw: pointer to hardware structure  * @dcb_config: pointer to ixgbe_dcb_config structure  *  * Configure Tx Data Arbiter and credits for each traffic class.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_config_tx_data_arbiter_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|u16
modifier|*
name|refill
parameter_list|,
name|u16
modifier|*
name|max
parameter_list|,
name|u8
modifier|*
name|bwg_id
parameter_list|,
name|u8
modifier|*
name|tsa
parameter_list|)
block|{
name|u32
name|reg
decl_stmt|;
name|u8
name|i
decl_stmt|;
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_PDPMCS
argument_list|)
expr_stmt|;
comment|/* Enable Data Plane Arbiter */
name|reg
operator|&=
operator|~
name|IXGBE_PDPMCS_ARBDIS
expr_stmt|;
comment|/* Enable DFP and Transmit Recycle Mode */
name|reg
operator||=
operator|(
name|IXGBE_PDPMCS_TPPAC
operator||
name|IXGBE_PDPMCS_TRM
operator|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_PDPMCS
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Configure traffic class credits and priority */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
condition|;
name|i
operator|++
control|)
block|{
name|reg
operator|=
name|refill
index|[
name|i
index|]
expr_stmt|;
name|reg
operator||=
call|(
name|u32
call|)
argument_list|(
name|max
index|[
name|i
index|]
argument_list|)
operator|<<
name|IXGBE_TDPT2TCCR_MCL_SHIFT
expr_stmt|;
name|reg
operator||=
call|(
name|u32
call|)
argument_list|(
name|bwg_id
index|[
name|i
index|]
argument_list|)
operator|<<
name|IXGBE_TDPT2TCCR_BWG_SHIFT
expr_stmt|;
if|if
condition|(
name|tsa
index|[
name|i
index|]
operator|==
name|ixgbe_dcb_tsa_group_strict_cee
condition|)
name|reg
operator||=
name|IXGBE_TDPT2TCCR_GSP
expr_stmt|;
if|if
condition|(
name|tsa
index|[
name|i
index|]
operator|==
name|ixgbe_dcb_tsa_strict
condition|)
name|reg
operator||=
name|IXGBE_TDPT2TCCR_LSP
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_TDPT2TCCR
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
comment|/* Enable Tx packet buffer division */
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_DTXCTL
argument_list|)
expr_stmt|;
name|reg
operator||=
name|IXGBE_DTXCTL_ENDBUBD
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_DTXCTL
argument_list|,
name|reg
argument_list|)
expr_stmt|;
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_config_pfc_82598 - Config priority flow control  * @hw: pointer to hardware structure  * @dcb_config: pointer to ixgbe_dcb_config structure  *  * Configure Priority Flow Control for each traffic class.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_config_pfc_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|pfc_en
parameter_list|)
block|{
name|u32
name|fcrtl
decl_stmt|,
name|reg
decl_stmt|;
name|u8
name|i
decl_stmt|;
comment|/* Enable Transmit Priority Flow Control */
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RMCS
argument_list|)
expr_stmt|;
name|reg
operator|&=
operator|~
name|IXGBE_RMCS_TFCE_802_3X
expr_stmt|;
name|reg
operator||=
name|IXGBE_RMCS_TFCE_PRIORITY
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RMCS
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Enable Receive Priority Flow Control */
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCTRL
argument_list|)
expr_stmt|;
name|reg
operator|&=
operator|~
operator|(
name|IXGBE_FCTRL_RPFCE
operator||
name|IXGBE_FCTRL_RFCE
operator|)
expr_stmt|;
if|if
condition|(
name|pfc_en
condition|)
name|reg
operator||=
name|IXGBE_FCTRL_RPFCE
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCTRL
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Configure PFC Tx thresholds per TC */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|pfc_en
operator|&
operator|(
literal|1
operator|<<
name|i
operator|)
operator|)
condition|)
block|{
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCRTL
argument_list|(
name|i
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCRTH
argument_list|(
name|i
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|fcrtl
operator|=
operator|(
name|hw
operator|->
name|fc
operator|.
name|low_water
index|[
name|i
index|]
operator|<<
literal|10
operator|)
operator||
name|IXGBE_FCRTL_XONE
expr_stmt|;
name|reg
operator|=
operator|(
name|hw
operator|->
name|fc
operator|.
name|high_water
index|[
name|i
index|]
operator|<<
literal|10
operator|)
operator||
name|IXGBE_FCRTH_FCEN
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCRTL
argument_list|(
name|i
argument_list|)
argument_list|,
name|fcrtl
argument_list|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCRTH
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
comment|/* Configure pause time */
name|reg
operator|=
name|hw
operator|->
name|fc
operator|.
name|pause_time
operator||
operator|(
name|hw
operator|->
name|fc
operator|.
name|pause_time
operator|<<
literal|16
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|IXGBE_DCB_MAX_TRAFFIC_CLASS
operator|/
literal|2
operator|)
condition|;
name|i
operator|++
control|)
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCTTV
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Configure flow control refresh threshold value */
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_FCRTV
argument_list|,
name|hw
operator|->
name|fc
operator|.
name|pause_time
operator|/
literal|2
argument_list|)
expr_stmt|;
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_config_tc_stats_82598 - Configure traffic class statistics  * @hw: pointer to hardware structure  *  * Configure queue statistics registers, all queues belonging to same traffic  * class uses a single set of queue statistics counters.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_config_tc_stats_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|)
block|{
name|u32
name|reg
init|=
literal|0
decl_stmt|;
name|u8
name|i
init|=
literal|0
decl_stmt|;
name|u8
name|j
init|=
literal|0
decl_stmt|;
comment|/* Receive Queues stats setting -  8 queues per statistics reg */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|i
operator|<
literal|15
operator|&&
name|j
operator|<
literal|8
condition|;
name|i
operator|=
name|i
operator|+
literal|2
operator|,
name|j
operator|++
control|)
block|{
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RQSMR
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|reg
operator||=
operator|(
operator|(
literal|0x1010101
operator|)
operator|*
name|j
operator|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RQSMR
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RQSMR
argument_list|(
name|i
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|reg
operator||=
operator|(
operator|(
literal|0x1010101
operator|)
operator|*
name|j
operator|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_RQSMR
argument_list|(
name|i
operator|+
literal|1
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
comment|/* Transmit Queues stats setting -  4 queues per statistics reg*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|reg
operator|=
name|IXGBE_READ_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_TQSMR
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|reg
operator||=
operator|(
operator|(
literal|0x1010101
operator|)
operator|*
name|i
operator|)
expr_stmt|;
name|IXGBE_WRITE_REG
argument_list|(
name|hw
argument_list|,
name|IXGBE_TQSMR
argument_list|(
name|i
argument_list|)
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * ixgbe_dcb_hw_config_82598 - Config and enable DCB  * @hw: pointer to hardware structure  * @dcb_config: pointer to ixgbe_dcb_config structure  *  * Configure dcb settings and enable dcb mode.  */
end_comment

begin_function
name|s32
name|ixgbe_dcb_hw_config_82598
parameter_list|(
name|struct
name|ixgbe_hw
modifier|*
name|hw
parameter_list|,
name|int
name|link_speed
parameter_list|,
name|u16
modifier|*
name|refill
parameter_list|,
name|u16
modifier|*
name|max
parameter_list|,
name|u8
modifier|*
name|bwg_id
parameter_list|,
name|u8
modifier|*
name|tsa
parameter_list|)
block|{
name|ixgbe_dcb_config_rx_arbiter_82598
argument_list|(
name|hw
argument_list|,
name|refill
argument_list|,
name|max
argument_list|,
name|tsa
argument_list|)
expr_stmt|;
name|ixgbe_dcb_config_tx_desc_arbiter_82598
argument_list|(
name|hw
argument_list|,
name|refill
argument_list|,
name|max
argument_list|,
name|bwg_id
argument_list|,
name|tsa
argument_list|)
expr_stmt|;
name|ixgbe_dcb_config_tx_data_arbiter_82598
argument_list|(
name|hw
argument_list|,
name|refill
argument_list|,
name|max
argument_list|,
name|bwg_id
argument_list|,
name|tsa
argument_list|)
expr_stmt|;
name|ixgbe_dcb_config_tc_stats_82598
argument_list|(
name|hw
argument_list|)
expr_stmt|;
return|return
name|IXGBE_SUCCESS
return|;
block|}
end_function

end_unit

