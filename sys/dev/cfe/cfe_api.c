begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $NetBSD: cfe_api.c,v 1.5 2005/12/11 12:18:07 christos Exp $ */
end_comment

begin_comment
comment|/* from: SiByte Id: cfe_api.c,v 1.16 2002/07/09 23:29:11 cgd Exp $ */
end_comment

begin_comment
comment|/*-  * Copyright 2000, 2001, 2002  * Broadcom Corporation. All rights reserved.  *  * This software is furnished under license and may be used and copied only  * in accordance with the following terms and conditions.  Subject to these  * conditions, you may download, copy, install, use, modify and distribute  * modified or unmodified copies of this software in source and/or binary  * form. No title or ownership is transferred hereby.  *  * 1) Any source code used, modified or distributed must reproduce and  *    retain this copyright notice and list of conditions as they appear in  *    the source file.  *  * 2) No right is granted to use any trade name, trademark, or logo of  *    Broadcom Corporation.  The "Broadcom Corporation" name may not be  *    used to endorse or promote products derived from this software  *    without the prior written permission of Broadcom Corporation.  *  * 3) THIS SOFTWARE IS PROVIDED "AS-IS" AND ANY EXPRESS OR IMPLIED  *    WARRANTIES, INCLUDING BUT NOT LIMITED TO, ANY IMPLIED WARRANTIES OF  *    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR  *    NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL BROADCOM BE LIABLE  *    FOR ANY DAMAGES WHATSOEVER, AND IN PARTICULAR, BROADCOM SHALL NOT BE  *    LIABLE FOR DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  *    CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  *    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR  *    BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,  *    WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE  *    OR OTHERWISE), EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  *********************************************************************     *     *  Broadcom Common Firmware Environment (CFE)     *     *  Device Function stubs			File: cfe_api.c     *     *  This module contains device function stubs (small routines to     *  call the standard "iocb" interface entry point to CFE).     *  There should be one routine here per iocb function call.     *     *  Authors:  Mitch Lichtenberg, Chris Demetriou     *     ********************************************************************* */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/cfe/cfe_api.h>
end_include

begin_include
include|#
directive|include
file|<dev/cfe/cfe_api_int.h>
end_include

begin_comment
comment|/* Cast from a native pointer to a cfe_xptr_t and back.  */
end_comment

begin_define
define|#
directive|define
name|XPTR_FROM_NATIVE
parameter_list|(
name|n
parameter_list|)
value|((cfe_xptr_t) (intptr_t) (n))
end_define

begin_define
define|#
directive|define
name|NATIVE_FROM_XPTR
parameter_list|(
name|x
parameter_list|)
value|((void *) (intptr_t) (x))
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|CFE_API_IMPL_NAMESPACE
end_ifdef

begin_define
define|#
directive|define
name|cfe_iocb_dispatch
parameter_list|(
name|a
parameter_list|)
value|__cfe_iocb_dispatch(a)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
name|int
name|cfe_iocb_dispatch
parameter_list|(
name|cfe_xiocb_t
modifier|*
name|xiocb
parameter_list|)
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_common
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_comment
comment|/*  * Declare the dispatch function with args of "intptr_t".  * This makes sure whatever model we're compiling in  * puts the pointers in a single register.  For example,  * combining -mlong64 and -mips1 or -mips2 would lead to  * trouble, since the handle and IOCB pointer will be  * passed in two registers each, and CFE expects one.  */
end_comment

begin_function_decl
specifier|static
name|int
function_decl|(
modifier|*
name|cfe_dispfunc
function_decl|)
parameter_list|(
name|intptr_t
name|handle
parameter_list|,
name|intptr_t
name|xiocb
parameter_list|)
init|=
literal|0
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|cfe_xuint_t
name|cfe_handle
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|cfe_init
parameter_list|(
name|cfe_xuint_t
name|handle
parameter_list|,
name|cfe_xuint_t
name|ept
parameter_list|)
block|{
name|cfe_dispfunc
operator|=
name|NATIVE_FROM_XPTR
argument_list|(
name|ept
argument_list|)
expr_stmt|;
name|cfe_handle
operator|=
name|handle
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|cfe_iocb_dispatch
parameter_list|(
name|cfe_xiocb_t
modifier|*
name|xiocb
parameter_list|)
block|{
if|if
condition|(
operator|!
name|cfe_dispfunc
condition|)
return|return
operator|-
literal|1
return|;
return|return
call|(
modifier|*
name|cfe_dispfunc
call|)
argument_list|(
operator|(
name|intptr_t
operator|)
name|cfe_handle
argument_list|,
operator|(
name|intptr_t
operator|)
name|xiocb
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_common || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_close
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_close
parameter_list|(
name|int
name|handle
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_CLOSE
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
name|handle
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
literal|0
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_close || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_cpu_start
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_cpu_start
parameter_list|(
name|int
name|cpu
parameter_list|,
name|void
function_decl|(
modifier|*
name|fn
function_decl|)
parameter_list|(
name|void
parameter_list|)
parameter_list|,
name|long
name|sp
parameter_list|,
name|long
name|gp
parameter_list|,
name|long
name|a1
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_CPUCTL
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_cpuctl_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|cpu_number
operator|=
name|cpu
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|cpu_command
operator|=
name|CFE_CPU_CMD_START
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|gp_val
operator|=
name|gp
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|sp_val
operator|=
name|sp
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|a1_val
operator|=
name|a1
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|start_addr
operator|=
operator|(
name|long
operator|)
name|fn
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_cpu_start || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_cpu_stop
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_cpu_stop
parameter_list|(
name|int
name|cpu
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_CPUCTL
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_cpuctl_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|cpu_number
operator|=
name|cpu
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_cpuctl
operator|.
name|cpu_command
operator|=
name|CFE_CPU_CMD_STOP
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_cpu_stop || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_enumenv
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_enumenv
parameter_list|(
name|int
name|idx
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|int
name|namelen
parameter_list|,
name|char
modifier|*
name|val
parameter_list|,
name|int
name|vallen
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_ENV_ENUM
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_envbuf_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|enum_idx
operator|=
name|idx
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|name_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|name_length
operator|=
name|namelen
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|val_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|val
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|val_length
operator|=
name|vallen
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_enumenv || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_enummem
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_enummem
parameter_list|(
name|int
name|idx
parameter_list|,
name|int
name|flags
parameter_list|,
name|cfe_xuint_t
modifier|*
name|start
parameter_list|,
name|cfe_xuint_t
modifier|*
name|length
parameter_list|,
name|cfe_xuint_t
modifier|*
name|type
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_MEMENUM
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
name|flags
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_meminfo_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_meminfo
operator|.
name|mi_idx
operator|=
name|idx
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
operator|*
name|start
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_meminfo
operator|.
name|mi_addr
expr_stmt|;
operator|*
name|length
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_meminfo
operator|.
name|mi_size
expr_stmt|;
operator|*
name|type
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_meminfo
operator|.
name|mi_type
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_enummem || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_exit
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_exit
parameter_list|(
name|int
name|warm
parameter_list|,
name|int
name|status
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_RESTART
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
name|warm
condition|?
name|CFE_FLG_WARMSTART
else|:
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_exitstat_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_exitstat
operator|.
name|status
operator|=
name|status
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_exit || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_flushcache
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_flushcache
parameter_list|(
name|int
name|flg
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_FLUSHCACHE
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
name|flg
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
literal|0
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_flushcache || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_getdevinfo
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_getdevinfo
parameter_list|(
name|char
modifier|*
name|name
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_GETINFO
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_buffer_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_offset
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_length
operator|=
name|cfe_strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
return|return
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_devflags
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_getdevinfo || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_getenv
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_getenv
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|dest
parameter_list|,
name|int
name|destlen
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
operator|*
name|dest
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_ENV_GET
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_envbuf_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|enum_idx
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|name_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|name_length
operator|=
name|cfe_strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|val_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|dest
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|val_length
operator|=
name|destlen
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_getenv || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_getfwinfo
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_getfwinfo
parameter_list|(
name|cfe_fwinfo_t
modifier|*
name|info
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_GETINFO
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_fwinfo_t
argument_list|)
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
name|info
operator|->
name|fwi_version
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_version
expr_stmt|;
name|info
operator|->
name|fwi_totalmem
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_totalmem
expr_stmt|;
name|info
operator|->
name|fwi_flags
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_flags
expr_stmt|;
name|info
operator|->
name|fwi_boardid
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_boardid
expr_stmt|;
name|info
operator|->
name|fwi_bootarea_va
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_bootarea_va
expr_stmt|;
name|info
operator|->
name|fwi_bootarea_pa
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_bootarea_pa
expr_stmt|;
name|info
operator|->
name|fwi_bootarea_size
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_fwinfo
operator|.
name|fwi_bootarea_size
expr_stmt|;
if|#
directive|if
literal|0
block|info->fwi_reserved1 = xiocb.plist.xiocb_fwinfo.fwi_reserved1;     info->fwi_reserved2 = xiocb.plist.xiocb_fwinfo.fwi_reserved2;     info->fwi_reserved3 = xiocb.plist.xiocb_fwinfo.fwi_reserved3;
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_getfwinfo || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_getstdhandle
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_getstdhandle
parameter_list|(
name|int
name|flg
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_GETHANDLE
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
name|flg
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
literal|0
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
return|return
name|xiocb
operator|.
name|xiocb_handle
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_getstdhandle || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_getticks
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int64_t
ifdef|#
directive|ifdef
name|CFE_API_IMPL_NAMESPACE
name|__cfe_getticks
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|cfe_getticks
parameter_list|(
name|void
parameter_list|)
endif|#
directive|endif
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_FW_GETTIME
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_time_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_time
operator|.
name|ticks
operator|=
literal|0
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_time
operator|.
name|ticks
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_getticks || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_inpstat
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_inpstat
parameter_list|(
name|int
name|handle
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_INPSTAT
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
name|handle
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_inpstat_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_inpstat
operator|.
name|inp_status
operator|=
literal|0
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
return|return
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_inpstat
operator|.
name|inp_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_inpstat || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_ioctl
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_ioctl
parameter_list|(
name|int
name|handle
parameter_list|,
name|unsigned
name|int
name|ioctlnum
parameter_list|,
name|unsigned
name|char
modifier|*
name|buffer
parameter_list|,
name|int
name|length
parameter_list|,
name|int
modifier|*
name|retlen
parameter_list|,
name|cfe_xuint_t
name|offset
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_IOCTL
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
name|handle
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_buffer_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_offset
operator|=
name|offset
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_ioctlcmd
operator|=
name|ioctlnum
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_length
operator|=
name|length
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|retlen
condition|)
operator|*
name|retlen
operator|=
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_retlen
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_ioctl || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_open
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_open
parameter_list|(
name|char
modifier|*
name|name
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_OPEN
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_buffer_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_offset
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_length
operator|=
name|cfe_strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
return|return
name|xiocb
operator|.
name|xiocb_handle
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_open || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_read
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_read
parameter_list|(
name|int
name|handle
parameter_list|,
name|unsigned
name|char
modifier|*
name|buffer
parameter_list|,
name|int
name|length
parameter_list|)
block|{
return|return
name|cfe_readblk
argument_list|(
name|handle
argument_list|,
literal|0
argument_list|,
name|buffer
argument_list|,
name|length
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_read || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_readblk
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_readblk
parameter_list|(
name|int
name|handle
parameter_list|,
name|cfe_xint_t
name|offset
parameter_list|,
name|unsigned
name|char
modifier|*
name|buffer
parameter_list|,
name|int
name|length
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_READ
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
name|handle
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_buffer_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_offset
operator|=
name|offset
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_length
operator|=
name|length
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
return|return
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_retlen
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_readblk || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_setenv
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_setenv
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_ENV_SET
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_envbuf_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|enum_idx
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|name_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|name_length
operator|=
name|cfe_strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|val_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|val
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_envbuf
operator|.
name|val_length
operator|=
name|cfe_strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_setenv || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
operator|(
name|defined
argument_list|(
name|CFE_API_strlen
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
operator|)
expr|\
operator|&&
operator|!
name|defined
argument_list|(
name|CFE_API_STRLEN_CUSTOM
argument_list|)
end_if

begin_function
name|int
name|cfe_strlen
parameter_list|(
name|char
modifier|*
name|name
parameter_list|)
block|{
name|int
name|count
init|=
literal|0
decl_stmt|;
while|while
condition|(
operator|*
name|name
operator|++
condition|)
name|count
operator|++
expr_stmt|;
return|return
name|count
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_strlen || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_write
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_write
parameter_list|(
name|int
name|handle
parameter_list|,
name|unsigned
name|char
modifier|*
name|buffer
parameter_list|,
name|int
name|length
parameter_list|)
block|{
return|return
name|cfe_writeblk
argument_list|(
name|handle
argument_list|,
literal|0
argument_list|,
name|buffer
argument_list|,
name|length
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_write || CFE_API_ALL */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CFE_API_writeblk
argument_list|)
operator|||
name|defined
argument_list|(
name|CFE_API_ALL
argument_list|)
end_if

begin_function
name|int
name|cfe_writeblk
parameter_list|(
name|int
name|handle
parameter_list|,
name|cfe_xint_t
name|offset
parameter_list|,
name|unsigned
name|char
modifier|*
name|buffer
parameter_list|,
name|int
name|length
parameter_list|)
block|{
name|cfe_xiocb_t
name|xiocb
decl_stmt|;
name|xiocb
operator|.
name|xiocb_fcode
operator|=
name|CFE_CMD_DEV_WRITE
expr_stmt|;
name|xiocb
operator|.
name|xiocb_status
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_handle
operator|=
name|handle
expr_stmt|;
name|xiocb
operator|.
name|xiocb_flags
operator|=
literal|0
expr_stmt|;
name|xiocb
operator|.
name|xiocb_psize
operator|=
sizeof|sizeof
argument_list|(
name|xiocb_buffer_t
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_offset
operator|=
name|offset
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_ptr
operator|=
name|XPTR_FROM_NATIVE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_length
operator|=
name|length
expr_stmt|;
name|cfe_iocb_dispatch
argument_list|(
operator|&
name|xiocb
argument_list|)
expr_stmt|;
if|if
condition|(
name|xiocb
operator|.
name|xiocb_status
operator|<
literal|0
condition|)
return|return
name|xiocb
operator|.
name|xiocb_status
return|;
return|return
name|xiocb
operator|.
name|plist
operator|.
name|xiocb_buffer
operator|.
name|buf_retlen
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CFE_API_writeblk || CFE_API_ALL */
end_comment

end_unit

