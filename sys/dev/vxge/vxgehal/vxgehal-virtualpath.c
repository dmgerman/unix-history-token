begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * SPDX-License-Identifier: BSD-3-Clause  *  * Copyright(c) 2002-2011 Exar Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification are permitted provided the following conditions are met:  *  *    1. Redistributions of source code must retain the above copyright notice,  *       this list of conditions and the following disclaimer.  *  *    2. Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *  *    3. Neither the name of the Exar Corporation nor the names of its  *       contributors may be used to endorse or promote products derived from  *       this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*$FreeBSD$*/
end_comment

begin_include
include|#
directive|include
file|<dev/vxge/vxgehal/vxgehal.h>
end_include

begin_comment
comment|/*  * __hal_vpath_fw_memo_get - Get the fw memo interface parameters  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  * @action: Action for FW Interface  * @param_index: Index of the parameter  * @data0: Buffer to return data 0 register contents  * @data1: Buffer to return data 1 register contents  *  * Returns FW memo interface parameters  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_fw_memo_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|,
name|u32
name|action
parameter_list|,
name|u64
name|param_index
parameter_list|,
name|u64
modifier|*
name|data0
parameter_list|,
name|u64
modifier|*
name|data1
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_reg
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|data0
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|data1
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
literal|", action = %d, "
literal|"param_index = %lld, data0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"data1 = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|,
name|action
argument_list|,
name|param_index
argument_list|,
operator|(
name|ptr_t
operator|)
name|data0
argument_list|,
operator|(
name|ptr_t
operator|)
name|data1
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|param_index
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|action
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|VXGE_HAL_DEF_DEVICE_POLL_MILLIS
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
condition|)
block|{
operator|*
name|data0
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
operator|*
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_fw_flash_ver_get - Get the fw version  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  * @fw_version: Buffer to return FW Version (Major)  * @fw_date: Buffer to return FW Version (date)  * @flash_version: Buffer to return FW Version (Major)  * @flash_date: Buffer to return FW Version (date)  *  * Returns FW Version  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_fw_flash_ver_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|,
name|vxge_hal_device_version_t
modifier|*
name|fw_version
parameter_list|,
name|vxge_hal_device_date_t
modifier|*
name|fw_date
parameter_list|,
name|vxge_hal_device_version_t
modifier|*
name|flash_version
parameter_list|,
name|vxge_hal_device_date_t
modifier|*
name|flash_date
parameter_list|)
block|{
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_reg
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|fw_version
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|fw_date
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|flash_version
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|flash_date
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"fw_version = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"fw_date = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"flash_version = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"flash_date = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|,
operator|(
name|ptr_t
operator|)
name|fw_version
argument_list|,
operator|(
name|ptr_t
operator|)
name|fw_date
argument_list|,
operator|(
name|ptr_t
operator|)
name|flash_version
argument_list|,
operator|(
name|ptr_t
operator|)
name|flash_date
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_VERSION
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_FW_VERSION
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|fw_date
operator|->
name|day
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FW_VER_DAY
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|fw_date
operator|->
name|month
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FW_VER_MONTH
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|fw_date
operator|->
name|year
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FW_VER_YEAR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|vxge_os_snprintf
argument_list|(
name|fw_date
operator|->
name|date
argument_list|,
sizeof|sizeof
argument_list|(
name|fw_date
operator|->
name|date
argument_list|)
argument_list|,
literal|"%2.2d/%2.2d/%4.4d"
argument_list|,
name|fw_date
operator|->
name|month
argument_list|,
name|fw_date
operator|->
name|day
argument_list|,
name|fw_date
operator|->
name|year
argument_list|)
expr_stmt|;
name|fw_version
operator|->
name|major
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FW_VER_MAJOR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|fw_version
operator|->
name|minor
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FW_VER_MINOR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|fw_version
operator|->
name|build
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FW_VER_BUILD
argument_list|(
name|data1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|vxge_os_snprintf
argument_list|(
name|fw_version
operator|->
name|version
argument_list|,
sizeof|sizeof
argument_list|(
name|fw_version
operator|->
name|version
argument_list|)
argument_list|,
literal|"%d.%d.%d"
argument_list|,
name|fw_version
operator|->
name|major
argument_list|,
name|fw_version
operator|->
name|minor
argument_list|,
name|fw_version
operator|->
name|build
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_FLASH_VERSION
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|flash_date
operator|->
name|day
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FLASH_VER_DAY
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|flash_date
operator|->
name|month
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FLASH_VER_MONTH
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|flash_date
operator|->
name|year
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FLASH_VER_YEAR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|vxge_os_snprintf
argument_list|(
name|flash_date
operator|->
name|date
argument_list|,
sizeof|sizeof
argument_list|(
name|flash_date
operator|->
name|date
argument_list|)
argument_list|,
literal|"%2.2d/%2.2d/%4.4d"
argument_list|,
name|flash_date
operator|->
name|month
argument_list|,
name|flash_date
operator|->
name|day
argument_list|,
name|flash_date
operator|->
name|year
argument_list|)
expr_stmt|;
name|flash_version
operator|->
name|major
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FLASH_VER_MAJOR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|flash_version
operator|->
name|minor
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FLASH_VER_MINOR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|flash_version
operator|->
name|build
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FLASH_VER_BUILD
argument_list|(
name|data1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|vxge_os_snprintf
argument_list|(
name|flash_version
operator|->
name|version
argument_list|,
sizeof|sizeof
argument_list|(
name|flash_version
operator|->
name|version
argument_list|)
argument_list|,
literal|"%d.%d.%d"
argument_list|,
name|flash_version
operator|->
name|major
argument_list|,
name|flash_version
operator|->
name|minor
argument_list|,
name|flash_version
operator|->
name|build
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_card_info_get - Get the card infor  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  * @serial_number: Buffer to return card serial number  * @part_number: Buffer to return card part number  * @product_description: Buffer to return card description  *  * Returns Card Info  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_card_info_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|,
name|u8
modifier|*
name|serial_number
parameter_list|,
name|u8
modifier|*
name|part_number
parameter_list|,
name|u8
modifier|*
name|product_description
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_reg
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|serial_number
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|part_number
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|product_description
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"serial_number = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"part_number = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"product_description = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|,
operator|(
name|ptr_t
operator|)
name|serial_number
argument_list|,
operator|(
name|ptr_t
operator|)
name|part_number
argument_list|,
operator|(
name|ptr_t
operator|)
name|product_description
argument_list|)
expr_stmt|;
operator|*
name|serial_number
operator|=
literal|0
expr_stmt|;
operator|*
name|part_number
operator|=
literal|0
expr_stmt|;
operator|*
name|product_description
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_SERIAL_NUMBER
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|serial_number
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|serial_number
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PART_NUMBER
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|part_number
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|part_number
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_DESC_0
init|;
name|i
operator|<=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_DESC_3
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|i
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|product_description
operator|)
index|[
name|j
operator|++
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|product_description
operator|)
index|[
name|j
operator|++
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_pmd_info_get - Get the PMD info  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  * @ports: Number of ports supported  * @pmd_port0: Buffer to return PMD info for port 0  * @pmd_port1: Buffer to return PMD info for port 1  *  * Returns PMD Info  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_pmd_info_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|,
name|u32
modifier|*
name|ports
parameter_list|,
name|vxge_hal_device_pmd_info_t
modifier|*
name|pmd_port0
parameter_list|,
name|vxge_hal_device_pmd_info_t
modifier|*
name|pmd_port1
parameter_list|)
block|{
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_reg
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|pmd_port0
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|pmd_port1
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"ports = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"pmd_port0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"pmd_port1 = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|,
operator|(
name|ptr_t
operator|)
name|ports
argument_list|,
operator|(
name|ptr_t
operator|)
name|pmd_port0
argument_list|,
operator|(
name|ptr_t
operator|)
name|pmd_port1
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORTS
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
operator|*
name|ports
operator|=
operator|(
name|u32
operator|)
name|data1
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT0_PMD_TYPE
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
name|data1
condition|)
block|{
name|pmd_port0
operator|->
name|type
operator|=
operator|(
name|u32
operator|)
name|data1
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT0_PMD_VENDOR
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port0
operator|->
name|vendor
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port0
operator|->
name|vendor
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT0_PMD_PARTNO
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port0
operator|->
name|part_num
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port0
operator|->
name|part_num
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT0_PMD_SERNO
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port0
operator|->
name|ser_num
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port0
operator|->
name|ser_num
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_os_memzero
argument_list|(
name|pmd_port0
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_device_pmd_info_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT1_PMD_TYPE
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
name|data1
condition|)
block|{
name|pmd_port1
operator|->
name|type
operator|=
operator|(
name|u32
operator|)
name|data1
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT1_PMD_VENDOR
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port1
operator|->
name|vendor
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port1
operator|->
name|vendor
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT1_PMD_PARTNO
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port1
operator|->
name|part_num
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port1
operator|->
name|part_num
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_MEMO_CARD_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PORT1_PMD_SERNO
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port1
operator|->
name|ser_num
operator|)
index|[
literal|0
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* LINTED */
operator|(
operator|(
name|u64
operator|*
operator|)
name|pmd_port1
operator|->
name|ser_num
operator|)
index|[
literal|1
index|]
operator|=
name|vxge_os_ntohll
argument_list|(
name|data2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_os_memzero
argument_list|(
name|pmd_port1
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_device_pmd_info_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_pci_func_mode_get - Get the pci mode  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  *  * Returns pci function mode  *  */
end_comment

begin_function
name|u64
name|__hal_vpath_pci_func_mode_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|)
block|{
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_reg
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_GET_FUNC_MODE
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_PCI_MODE
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|data1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_lag_mode_get - Get the LAG mode  * @vpath: VIrtual Path  *  * Returns the LAG mode in use  */
end_comment

begin_function
name|vxge_hal_device_lag_mode_e
name|__hal_vpath_lag_mode_get
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|u32
name|lag_mode
init|=
name|VXGE_HAL_DEVICE_LAG_MODE_UNKNOWN
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_vpath_fw_memo_get
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|vpath
operator|->
name|vp_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_PORT_INFO
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_LAG_MODE
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_MEMO_ITEM_STATUS
argument_list|(
name|data1
argument_list|)
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MEMO_ITEM_STATUS_SUCCESS
condition|)
block|{
name|lag_mode
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_MEMO_ITEM_GET_LAG_MODE
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|vxge_hal_device_lag_mode_e
operator|)
name|lag_mode
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_vpath_map_get - Get the vpath map  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vh: Virtual Hierrachy  * @func: Function number  * @vpath_reg: Pointer to vpath registers  *  * Returns vpath map for a give hierarchy and function  *  */
end_comment

begin_function
name|u64
name|__hal_vpath_vpath_map_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|u32
name|vh
parameter_list|,
name|u32
name|func
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|)
block|{
name|u64
name|i
decl_stmt|;
name|u64
name|val64
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_reg
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vh = %d, func = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vh
argument_list|,
name|func
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_fw_memo_get
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|vp_id
argument_list|,
name|vpath_reg
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_VPATH_MAP
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_VH
argument_list|(
name|vh
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FUNCTION
argument_list|(
name|func
argument_list|)
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_MAX_VIRTUAL_PATHS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|data2
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_IS_VPATH_ASSIGNED
argument_list|(
name|i
argument_list|)
condition|)
name|val64
operator||=
name|mBIT
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|val64
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_pci_read - Read the content of given address  *			 in pci config space.  * @vpath: Virtual Path object.  * @offset: Configuration address(offset)to read from  * @length: Length of the data (1, 2 or 4 bytes)  * @val: Pointer to a buffer to return the content of the address  *  * Read from the vpath pci config space.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_pci_read
parameter_list|(
name|struct
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u32
name|length
parameter_list|,
name|void
modifier|*
name|val
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|hldev
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|val
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d, "
literal|"offset = %d, val = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|,
name|vp_id
argument_list|,
name|offset
argument_list|,
operator|(
name|ptr_t
operator|)
name|val
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|length
condition|)
block|{
case|case
literal|1
case|:
name|vxge_os_pci_read8
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|cfgh
argument_list|,
name|offset
argument_list|,
operator|(
operator|(
name|u8
operator|*
operator|)
name|val
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|vxge_os_pci_read16
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|cfgh
argument_list|,
name|offset
argument_list|,
operator|(
operator|(
name|u16
operator|*
operator|)
name|val
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|vxge_os_pci_read32
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|cfgh
argument_list|,
name|offset
argument_list|,
operator|(
operator|(
name|u32
operator|*
operator|)
name|val
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
name|vxge_os_memzero
argument_list|(
name|val
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_fw_upgrade - Upgrade the firmware  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  * @buffer: Buffer containing F/W image  * @length: Length of F/W image  *  * Upgrade the firmware  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_fw_upgrade
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|,
name|u8
modifier|*
name|buffer
parameter_list|,
name|u32
name|length
parameter_list|)
block|{
name|u32
name|i
init|=
literal|0
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|u32
name|not_done
init|=
name|TRUE
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_reg
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|buffer
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"buffer = 0x"
name|VXGE_OS_STXFMT
literal|", length = %d\n"
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|,
operator|(
name|ptr_t
operator|)
name|buffer
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_STREAM_SKIP
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_UPGRADE
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET_FW_UPGRADE_MODE
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|__hal_device_register_stall
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|VXGE_HAL_DEF_DEVICE_POLL_MILLIS
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
operator|)
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
while|while
condition|(
name|not_done
condition|)
block|{
if|if
condition|(
operator|(
name|i
operator|+
literal|16
operator|)
operator|>
name|length
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
index|]
argument_list|)
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
operator|<<
literal|8
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|2
index|]
argument_list|)
operator|<<
literal|16
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|3
index|]
argument_list|)
operator|<<
literal|24
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|4
index|]
argument_list|)
operator|<<
literal|32
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|5
index|]
argument_list|)
operator|<<
literal|40
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|6
index|]
argument_list|)
operator|<<
literal|48
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|7
index|]
argument_list|)
operator|<<
literal|56
operator|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|8
index|]
argument_list|)
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|9
index|]
argument_list|)
operator|<<
literal|8
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|10
index|]
argument_list|)
operator|<<
literal|16
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|11
index|]
argument_list|)
operator|<<
literal|24
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|12
index|]
argument_list|)
operator|<<
literal|32
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|13
index|]
argument_list|)
operator|<<
literal|40
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|14
index|]
argument_list|)
operator|<<
literal|48
operator|)
operator||
operator|(
call|(
name|u64
call|)
argument_list|(
name|buffer
index|[
name|i
operator|+
literal|15
index|]
argument_list|)
operator|<<
literal|56
operator|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_UPGRADE
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET_FW_UPGRADE_DATA
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|__hal_device_register_stall
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|VXGE_HAL_DEF_DEVICE_POLL_MILLIS
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
operator|)
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_GET_RET_CODE
argument_list|(
name|val64
argument_list|)
condition|)
block|{
case|case
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_GET_RET_CODE_OK
case|:
name|i
operator|+=
literal|16
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_GET_RET_CODE_DONE
case|:
name|not_done
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_GET_RET_CODE_SKIP
case|:
name|i
operator|+=
literal|16
expr_stmt|;
name|i
operator|+=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_GET_SKIP_BYTES
argument_list|(
name|val64
argument_list|)
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FW_UPGRADE_GET_RET_CODE_ERROR
case|:
default|default:
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FW_UPGRADE
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET_FW_UPGRADE_COMMIT
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|__hal_device_register_stall
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
literal|100
operator|*
name|VXGE_HAL_DEF_DEVICE_POLL_MILLIS
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
operator|)
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_OK
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_flick_link_led - Flick (blink) link LED.  * @hldev: HAL device.  * @vp_id: Vpath Id  * @port : Port number 0, or 1  * @on_off: TRUE if flickering to be on, FALSE to be off  *  * Flicker the link LED.  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_flick_link_led
parameter_list|(
name|struct
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|u32
name|port
parameter_list|,
name|u32
name|on_off
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d, port = %d, on_off = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|,
name|vp_id
argument_list|,
name|port
argument_list|,
name|on_off
argument_list|)
expr_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
name|on_off
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LED_CONTROL
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_udp_rth_set - Enable or Disable UDP/RTH.  * @hldev: HAL device.  * @vp_id: Vpath Id  * @on_off: TRUE if UDP/RTH to be enabled, FALSE to be disabled  *  * Enable or Disable UDP/RTH.  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_udp_rth_set
parameter_list|(
name|struct
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|u32
name|on_off
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d, on_off = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|,
name|vp_id
argument_list|,
name|on_off
argument_list|)
expr_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
operator|(
name|on_off
operator|)
condition|?
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_UDP_RTH_ENABLE
else|:
literal|0
operator|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_UDP_RTH
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_pcie_func_mode_set - Set PCI-E function mode.  * @hldev: HAL device.  * @vp_id: Vpath Id  * @func_mode: func_mode to be set  *  * Set PCI-E function mode.  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_pcie_func_mode_set
parameter_list|(
name|struct
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|u32
name|func_mode
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d, func_mode = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|,
name|vp_id
argument_list|,
name|func_mode
argument_list|)
expr_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_FUNC_MODE
argument_list|(
name|func_mode
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_FUNC_MODE
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
operator|)
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_COMMIT
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_udp_rth_disable - Enable UDP/RTH.  * @vpath_handle: Vpath handle.  *  * Disable udp rth  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_udp_rth_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_udp_rth_set
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_rts_table_get - Get the entries from RTS access tables  * @vpath_handle: Vpath handle.  * @action: Identifies the action to take on the specified entry. The  *	    interpretation of this field depends on the DATA_STRUCT_SEL field  *	    DA, VID, ETYPE, PN, RANGE_PN:  *		8'd0 - ADD_ENTRY (Add an entry to the table. This command may be  *		rejected by management/administration).  *		8'd1 - DELETE_ENTRY (Add an entry to the table. This command may  *		be rejected by management/administration)  *		8'd2 - LIST_FIRST_ENTRY  *		8'd3 - LIST_NEXT_ENTRY  *		RTH_GEN_CFG, RTH_IT, RTH_JHASH_CFG, RTH_MASK, RTH_KEY, QOS, DS:  *		8'd0 - READ_ENTRY  *		  8'd1 - WRITE_ENTRY  *		Note: This field is updated by the H/W during an operation and  *		is used to report additional TBD status information back to the  *		host.  * @rts_table: Identifies the RTS data structure (i.e. lookup table) to access.  *		0; DA; Destination Address 1; VID; VLAN ID 2; ETYPE; Ethertype  *		3; PN; Layer 4 Port Number 4; Reserved 5; RTH_GEN_CFG; Receive  *		Traffic Hashing General Configuration 6; RTH_IT; Receive Traffic  *		Hashing Indirection Table 7; RTH_JHASH_CFG; Receive-Traffic  *		Hashing Jenkins Hash Configuration 8; RTH_MASK; Receive Traffic  *		Hashing Mask 9; RTH_KEY; Receive-Traffic Hashing Key 10; QOS;  *		VLAN Quality of Service 11; DS; IP Differentiated Services  * @offset: Applies to RTH_IT, RTH_MASK, RTH_KEY, QOS, DS structures only.  *		The interpretation of this field depends on the DATA_STRUCT_SEL  *		field:  *		RTH_IT - {BUCKET_NUM[0:7]} (Bucket Number)  *		RTH_MASK - {5'b0,  *		INDEX_8BYTE} (8-byte Index)  *		RTH_KEY - {5'b0, INDEX_8BYTE} (8-byte Index)  *		QOS - {5'b0, PRI} (Priority)  *		DS - {5'b0, CP} (Codepoint)  * @data1: Pointer to the data 1 to be read from the table  * @data2: Pointer to the data 2 to be read from the table  *  * Read from the RTS table  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_rts_table_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|action
parameter_list|,
name|u32
name|rts_table
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u64
modifier|*
name|data1
parameter_list|,
name|u64
modifier|*
name|data2
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|data1
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|data2
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", action = %d, rts_table = %d, "
literal|"offset = %d, data1 = 0x"
name|VXGE_OS_STXFMT
literal|", data2 = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|action
argument_list|,
name|rts_table
argument_list|,
name|offset
argument_list|,
operator|(
name|ptr_t
operator|)
name|data1
argument_list|,
operator|(
name|ptr_t
operator|)
name|data2
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|action
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|rts_table
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
name|offset
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_SOLO_IT
operator|)
operator|||
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MULTI_IT
operator|)
operator|||
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MASK
operator|)
operator|||
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_KEY
operator|)
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_TABLE_SEL
expr_stmt|;
block|}
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
operator|)
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_FAIL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
operator|*
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
operator|)
operator|||
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MULTI_IT
operator|)
condition|)
block|{
operator|*
name|data2
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_rts_table_set - Set the entries of RTS access tables  * @vpath_handle: Vpath handle.  * @action: Identifies the action to take on the specified entry. The  *		interpretation of this field depends on DATA_STRUCT_SEL field  *		DA, VID, ETYPE, PN, RANGE_PN:  *		8'd0 - ADD_ENTRY (Add an entry to the table. This command may be  *		   rejected by management/administration).  *		8'd1 - DELETE_ENTRY (Add an entry to the table. This command may  *		   be rejected by management/administration)  *		8'd2 - LIST_FIRST_ENTRY  *		8'd3 - LIST_NEXT_ENTRY  *		RTH_GEN_CFG, RTH_IT, RTH_JHASH_CFG, RTH_MASK, RTH_KEY, QOS, DS:  *		8'd0 - READ_ENTRY  *		  8'd1 - WRITE_ENTRY  *		Note: This field is updated by the H/W during an operation and  *		is used to report additional TBD status information back to the  *		host.  * @rts_table: Identifies the RTS data structure (i.e. lookup table) to access.  *		0; DA; Destination Address 1; VID; VLAN ID 2; ETYPE; Ethertype  *		3; PN; Layer 4 Port Number 4; Reserved 5; RTH_GEN_CFG; Receive  *		Traffic Hashing General Configuration 6; RTH_IT; Receive Traffic  *		Hashing Indirection Table 7; RTH_JHASH_CFG; Receive-Traffic  *		Hashing Jenkins Hash Configuration 8; RTH_MASK; Receive Traffic  *		Hashing Mask 9; RTH_KEY; Receive-Traffic Hashing Key 10; QOS;  *		VLAN Quality of Service 11; DS; IP Differentiated Services  * @offset: Applies to RTH_IT, RTH_MASK, RTH_KEY, QOS, DS structures only.  *		The interpretation of this field depends on the DATA_STRUCT_SEL  *		field:  *		RTH_IT - {BUCKET_NUM[0:7]} (Bucket Number)  *		RTH_MASK - {5'b0,  *		INDEX_8BYTE} (8-byte Index)  *		RTH_KEY - {5'b0, INDEX_8BYTE} (8-byte Index)  *		QOS - {5'b0, PRI} (Priority)  *		DS - {5'b0, CP} (Codepoint)  * @data1: data 1 to be written to the table  * @data2: data 2 to be written to the table  *  * Read from the RTS table  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_rts_table_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|action
parameter_list|,
name|u32
name|rts_table
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u64
name|data1
parameter_list|,
name|u64
name|data2
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", action = %d, rts_table = %d, "
literal|"offset = %d, data1 = 0x"
name|VXGE_OS_LLXFMT
literal|", data2 = 0x"
name|VXGE_OS_LLXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|action
argument_list|,
name|rts_table
argument_list|,
name|offset
argument_list|,
name|data1
argument_list|,
name|data2
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|data1
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
operator|)
operator|||
operator|(
name|rts_table
operator|==
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MULTI_IT
operator|)
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|data2
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
block|}
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|action
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|rts_table
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
name|offset
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mac_addr_add - Add the mac address entry for this vpath  *		  to MAC address table.  * @vpath_handle: Vpath handle.  * @macaddr: MAC address to be added for this vpath into the list  * @macaddr_mask: MAC address mask for macaddr  * @duplicate_mode: Duplicate MAC address add mode. Please see  *		vxge_hal_vpath_mac_addr_add_mode_e {}  *  * Adds the given mac address and mac address mask into the list for this  * vpath.  * see also: vxge_hal_vpath_mac_addr_delete, vxge_hal_vpath_mac_addr_get and  * vxge_hal_vpath_mac_addr_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mac_addr_add
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|macaddr_t
name|macaddr
parameter_list|,
name|macaddr_t
name|macaddr_mask
parameter_list|,
name|vxge_hal_vpath_mac_addr_add_mode_e
name|duplicate_mode
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"macaddr = %02x-%02x-%02x-%02x-%02x-%02x, "
literal|"macaddr_mask = %02x-%02x-%02x-%02x-%02x-%02x"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|macaddr
index|[
literal|0
index|]
argument_list|,
name|macaddr
index|[
literal|1
index|]
argument_list|,
name|macaddr
index|[
literal|2
index|]
argument_list|,
name|macaddr
index|[
literal|3
index|]
argument_list|,
name|macaddr
index|[
literal|4
index|]
argument_list|,
name|macaddr
index|[
literal|5
index|]
argument_list|,
name|macaddr_mask
index|[
literal|0
index|]
argument_list|,
name|macaddr_mask
index|[
literal|1
index|]
argument_list|,
name|macaddr_mask
index|[
literal|2
index|]
argument_list|,
name|macaddr_mask
index|[
literal|3
index|]
argument_list|,
name|macaddr_mask
index|[
literal|4
index|]
argument_list|,
name|macaddr_mask
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_ETH_ALEN
condition|;
name|i
operator|++
control|)
block|{
name|data1
operator|<<=
literal|8
expr_stmt|;
name|data1
operator||=
operator|(
name|u8
operator|)
name|macaddr
index|[
name|i
index|]
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_ETH_ALEN
condition|;
name|i
operator|++
control|)
block|{
name|data2
operator|<<=
literal|8
expr_stmt|;
name|data2
operator||=
operator|(
name|u8
operator|)
name|macaddr_mask
index|[
name|i
index|]
expr_stmt|;
block|}
switch|switch
condition|(
name|duplicate_mode
condition|)
block|{
case|case
name|VXGE_HAL_VPATH_MAC_ADDR_ADD_DUPLICATE
case|:
name|i
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_VPATH_MAC_ADDR_DISCARD_DUPLICATE
case|:
name|i
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_VPATH_MAC_ADDR_REPLACE_DUPLICATE
case|:
name|i
operator|=
literal|2
expr_stmt|;
break|break;
default|default:
name|i
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_ADD_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_DA_MAC_ADDR
argument_list|(
name|data1
argument_list|)
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_DA_MAC_ADDR_MASK
argument_list|(
name|data2
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_DA_MAC_ADDR_MODE
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_hw_addr_get - Get the hw address entry for this vpath  *		  from MAC address table.  * @pdev: PCI device object.  * @regh0: BAR0 mapped memory handle, or simply PCI device @pdev  * (Linux and the rest.)  * @vp_id: Vpath id  * @vpath_reg: Pointer to vpath registers  * @macaddr: First MAC address entry for this vpath in the list  * @macaddr_mask: MAC address mask for macaddr  *  * Returns the first mac address and mac address mask in the list for this  * vpath.  * see also: vxge_hal_vpath_mac_addr_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_hw_addr_get
parameter_list|(
name|pci_dev_h
name|pdev
parameter_list|,
name|pci_reg_h
name|regh0
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vpath_reg_t
modifier|*
name|vpath_reg
parameter_list|,
name|macaddr_t
name|macaddr
parameter_list|,
name|macaddr_t
name|macaddr_mask
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|u64
name|action
init|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_FIRST_ENTRY
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_reg
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|macaddr
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|macaddr_mask
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_driver
argument_list|(
literal|"pdev = 0x"
name|VXGE_OS_STXFMT
literal|", regh0 = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vp_id = %d, vpath_reg = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"macaddr = 0x"
name|VXGE_OS_STXFMT
literal|", macaddr_mask = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pdev
argument_list|,
operator|(
name|ptr_t
operator|)
name|regh0
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_reg
argument_list|,
operator|(
name|ptr_t
operator|)
name|macaddr
argument_list|,
operator|(
name|ptr_t
operator|)
name|macaddr_mask
argument_list|)
expr_stmt|;
comment|/* CONSTCOND */
while|while
condition|(
name|TRUE
condition|)
block|{
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|action
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|VXGE_HAL_DEF_DEVICE_POLL_MILLIS
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
condition|)
block|{
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|data2
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|pdev
argument_list|,
name|regh0
argument_list|,
operator|&
name|vpath_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|data1
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_DA_MAC_ADDR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|data2
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_DA_MAC_ADDR_MASK
argument_list|(
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|VXGE_HAL_IS_UNICAST
argument_list|(
name|data1
argument_list|)
condition|)
block|{
for|for
control|(
name|i
operator|=
name|VXGE_HAL_ETH_ALEN
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|macaddr
index|[
name|i
operator|-
literal|1
index|]
operator|=
call|(
name|u8
call|)
argument_list|(
name|data1
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|data1
operator|>>=
literal|8
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|VXGE_HAL_ETH_ALEN
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|macaddr_mask
index|[
name|i
operator|-
literal|1
index|]
operator|=
call|(
name|u8
call|)
argument_list|(
name|data2
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|data2
operator|>>=
literal|8
expr_stmt|;
block|}
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
break|break;
block|}
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_NEXT_ENTRY
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
break|break;
block|}
block|}
name|vxge_hal_trace_log_driver
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mac_addr_get - Get the first mac address entry for this vpath  *		  from MAC address table.  * @vpath_handle: Vpath handle.  * @macaddr: First MAC address entry for this vpath in the list  * @macaddr_mask: MAC address mask for macaddr  *  * Returns the first mac address and mac address mask in the list for this  * vpath.  * see also: vxge_hal_vpath_mac_addr_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mac_addr_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|macaddr_t
name|macaddr
parameter_list|,
name|macaddr_t
name|macaddr_mask
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_FIRST_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
argument_list|,
literal|0
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|data1
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_DA_MAC_ADDR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|data2
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_DA_MAC_ADDR_MASK
argument_list|(
name|data2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|VXGE_HAL_ETH_ALEN
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|macaddr
index|[
name|i
operator|-
literal|1
index|]
operator|=
call|(
name|u8
call|)
argument_list|(
name|data1
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|data1
operator|>>=
literal|8
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|VXGE_HAL_ETH_ALEN
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|macaddr_mask
index|[
name|i
operator|-
literal|1
index|]
operator|=
call|(
name|u8
call|)
argument_list|(
name|data2
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|data2
operator|>>=
literal|8
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mac_addr_get_next - Get the next mac address entry for vpath  *		  from MAC address table.  * @vpath_handle: Vpath handle.  * @macaddr: Next MAC address entry for this vpath in the list  * @macaddr_mask: MAC address mask for macaddr  *  * Returns the next mac address and mac address mask in the list for this  * vpath.  * see also: vxge_hal_vpath_mac_addr_get  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mac_addr_get_next
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|macaddr_t
name|macaddr
parameter_list|,
name|macaddr_t
name|macaddr_mask
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_NEXT_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
argument_list|,
literal|0
argument_list|,
operator|&
name|data1
argument_list|,
operator|&
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|data1
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_DA_MAC_ADDR
argument_list|(
name|data1
argument_list|)
expr_stmt|;
name|data2
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_DA_MAC_ADDR_MASK
argument_list|(
name|data2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|VXGE_HAL_ETH_ALEN
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|macaddr
index|[
name|i
operator|-
literal|1
index|]
operator|=
call|(
name|u8
call|)
argument_list|(
name|data1
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|data1
operator|>>=
literal|8
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|VXGE_HAL_ETH_ALEN
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|macaddr_mask
index|[
name|i
operator|-
literal|1
index|]
operator|=
call|(
name|u8
call|)
argument_list|(
name|data2
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|data2
operator|>>=
literal|8
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mac_addr_delete - Delete the mac address entry for this vpath  *		  to MAC address table.  * @vpath_handle: Vpath handle.  * @macaddr: MAC address to be added for this vpath into the list  * @macaddr_mask: MAC address mask for macaddr  *  * Delete the given mac address and mac address mask into the list for this  * vpath.  * see also: vxge_hal_vpath_mac_addr_add, vxge_hal_vpath_mac_addr_get and  * vxge_hal_vpath_mac_addr_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mac_addr_delete
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|macaddr_t
name|macaddr
parameter_list|,
name|macaddr_t
name|macaddr_mask
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|data1
init|=
literal|0ULL
decl_stmt|;
name|u64
name|data2
init|=
literal|0ULL
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"macaddr = %02x-%02x-%02x-%02x-%02x-%02x, "
literal|"macaddr_mask = %02x-%02x-%02x-%02x-%02x-%02x"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|macaddr
index|[
literal|0
index|]
argument_list|,
name|macaddr
index|[
literal|1
index|]
argument_list|,
name|macaddr
index|[
literal|2
index|]
argument_list|,
name|macaddr
index|[
literal|3
index|]
argument_list|,
name|macaddr
index|[
literal|4
index|]
argument_list|,
name|macaddr
index|[
literal|5
index|]
argument_list|,
name|macaddr_mask
index|[
literal|0
index|]
argument_list|,
name|macaddr_mask
index|[
literal|1
index|]
argument_list|,
name|macaddr_mask
index|[
literal|2
index|]
argument_list|,
name|macaddr_mask
index|[
literal|3
index|]
argument_list|,
name|macaddr_mask
index|[
literal|4
index|]
argument_list|,
name|macaddr_mask
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_ETH_ALEN
condition|;
name|i
operator|++
control|)
block|{
name|data1
operator|<<=
literal|8
expr_stmt|;
name|data1
operator||=
operator|(
name|u8
operator|)
name|macaddr
index|[
name|i
index|]
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_ETH_ALEN
condition|;
name|i
operator|++
control|)
block|{
name|data2
operator|<<=
literal|8
expr_stmt|;
name|data2
operator||=
operator|(
name|u8
operator|)
name|macaddr_mask
index|[
name|i
index|]
expr_stmt|;
block|}
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_DELETE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_DA
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_DA_MAC_ADDR
argument_list|(
name|data1
argument_list|)
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_DA_MAC_ADDR_MASK
argument_list|(
name|data2
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_vid_add - Add the vlan id entry for this vpath  *		  to vlan id table.  * @vpath_handle: Vpath handle.  * @vid: vlan id to be added for this vpath into the list  *  * Adds the given vlan id into the list for this  vpath.  * see also: vxge_hal_vpath_vid_delete, vxge_hal_vpath_vid_get and  * vxge_hal_vpath_vid_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_vid_add
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
name|vid
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", vid = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|u32
operator|)
name|vid
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_ADD_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_VID
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_VLAN_ID
argument_list|(
name|vid
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_vid_get - Get the first vid entry for this vpath  *		  from vlan id table.  * @vpath_handle: Vpath handle.  * @vid: Buffer to return vlan id  *  * Returns the first vlan id in the list for this vpath.  * see also: vxge_hal_vpath_vid_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_vid_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
modifier|*
name|vid
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|vid
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", vid = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|vid
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_FIRST_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_VID
argument_list|,
literal|0
argument_list|,
name|vid
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|vid
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_VLAN_ID
argument_list|(
operator|*
name|vid
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_vid_get_next - Get the next vid entry for this vpath  *		  from vlan id table.  * @vpath_handle: Vpath handle.  * @vid: Buffer to return vlan id  *  * Returns the next vlan id in the list for this vpath.  * see also: vxge_hal_vpath_vid_get  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_vid_get_next
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
modifier|*
name|vid
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|vid
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", vid = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|vid
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_NEXT_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_VID
argument_list|,
literal|0
argument_list|,
name|vid
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|vid
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_VLAN_ID
argument_list|(
operator|*
name|vid
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_vid_delete - Delete the vlan id entry for this vpath  *		  to vlan id table.  * @vpath_handle: Vpath handle.  * @vid: vlan id to be added for this vpath into the list  *  * Adds the given vlan id into the list for this  vpath.  * see also: vxge_hal_vpath_vid_add, vxge_hal_vpath_vid_get and  * vxge_hal_vpath_vid_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_vid_delete
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
name|vid
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", vid = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|u32
operator|)
name|vid
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_DELETE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_VID
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_VLAN_ID
argument_list|(
name|vid
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_etype_add - Add the Ethertype entry for this vpath  *		  to Ethertype table.  * @vpath_handle: Vpath handle.  * @etype: ethertype to be added for this vpath into the list  *  * Adds the given Ethertype into the list for this  vpath.  * see also: vxge_hal_vpath_etype_delete, vxge_hal_vpath_etype_get and  * vxge_hal_vpath_etype_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_etype_add
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
name|etype
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", etype = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|u32
operator|)
name|etype
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_ADD_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_ETYPE
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_ETYPE
argument_list|(
name|etype
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_etype_get - Get the first ethertype entry for this vpath  *		  from Ethertype table.  * @vpath_handle: Vpath handle.  * @etype: Buffer to return Ethertype  *  * Returns the first ethype entry in the list for this vpath.  * see also: vxge_hal_vpath_etype_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_etype_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
modifier|*
name|etype
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|etype
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", etype = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|etype
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_FIRST_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_ETYPE
argument_list|,
literal|0
argument_list|,
name|etype
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|etype
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_ETYPE
argument_list|(
operator|*
name|etype
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_etype_get_next - Get the next Ethertype entry for this vpath  *		  from Ethertype table.  * @vpath_handle: Vpath handle.  * @etype: Buffer to return Ethwrtype  *  * Returns the next Ethwrtype in the list for this vpath.  * see also: vxge_hal_vpath_etype_get  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_etype_get_next
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
modifier|*
name|etype
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|etype
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", etype = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|etype
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_NEXT_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_ETYPE
argument_list|,
literal|0
argument_list|,
name|etype
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|etype
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_ETYPE
argument_list|(
operator|*
name|etype
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_etype_delete - Delete the Ethertype entry for this vpath  *		  to Ethertype table.  * @vpath_handle: Vpath handle.  * @etype: ethertype to be added for this vpath into the list  *  * Adds the given Ethertype into the list for this  vpath.  * see also: vxge_hal_vpath_etype_add, vxge_hal_vpath_etype_get and  * vxge_hal_vpath_etype_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_etype_delete
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u64
name|etype
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", etype = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|u32
operator|)
name|etype
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_DELETE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_ETYPE
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_ETYPE
argument_list|(
name|etype
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_port_add - Add the port entry for this vpath  *		  to port number table.  * @vpath_handle: Vpath handle.  * @port_type: if 0 - Src port or 1 - Dest port  * @protocol: if 0 - TCP or 1 - UDP  * @port: port to be added for this vpath into the list  *  * Adds the given port into the list for this  vpath.  * see also: vxge_hal_vpath_port_delete, vxge_hal_vpath_port_get and  * vxge_hal_vpath_port_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_port_add
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|port_type
parameter_list|,
name|u32
name|protocol
parameter_list|,
name|u32
name|port
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", port_type = %d, "
literal|"protocol = %d, port = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|port_type
argument_list|,
name|protocol
argument_list|,
name|port
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_PN_PORT_NUM
argument_list|(
name|port
argument_list|)
expr_stmt|;
if|if
condition|(
name|port_type
condition|)
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_PN_SRC_DEST_SEL
expr_stmt|;
if|if
condition|(
name|protocol
condition|)
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_PN_TCP_UDP_SEL
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_ADD_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_PN
argument_list|,
literal|0
argument_list|,
name|val64
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_port_get  * Get the first port number entry for this vpath from port number table.  * @vpath_handle: Vpath handle.  * @port_type: Buffer to return if 0 - Src port or 1 - Dest port  * @protocol: Buffer to return if 0 - TCP or 1 - UDP  * @port: Buffer to return port number  *  * Returns the first port number entry in the list for this vpath.  * see also: vxge_hal_vpath_port_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_port_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
modifier|*
name|port_type
parameter_list|,
name|u32
modifier|*
name|protocol
parameter_list|,
name|u32
modifier|*
name|port
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|port_type
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|protocol
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|port
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", port_type = 0x"
name|VXGE_OS_STXFMT
literal|", protocol = 0x"
name|VXGE_OS_STXFMT
literal|", port = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|port_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|protocol
argument_list|,
operator|(
name|ptr_t
operator|)
name|port
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_FIRST_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_PN
argument_list|,
literal|0
argument_list|,
operator|&
name|val64
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|port_type
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_PN_SRC_DEST_SEL
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|protocol
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_PN_TCP_UDP_SEL
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|port
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_PN_PORT_NUM
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_port_get_next  * Get the next port number entry for this vpath from port number table.  * @vpath_handle: Vpath handle.  * @port_type: Buffer to return if 0 - Src port or 1 - Dest port  * @protocol: Buffer to return if 0 - TCP or 1 - UDP  * @port: Buffer to return port number  *  * Returns the next port number entry in the list for this vpath.  * see also: vxge_hal_vpath_port_get  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_port_get_next
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
modifier|*
name|port_type
parameter_list|,
name|u32
modifier|*
name|protocol
parameter_list|,
name|u32
modifier|*
name|port
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|port_type
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|protocol
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|port
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", port_type = 0x"
name|VXGE_OS_STXFMT
literal|", protocol = 0x"
name|VXGE_OS_STXFMT
literal|", port = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|port_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|protocol
argument_list|,
operator|(
name|ptr_t
operator|)
name|port
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_LIST_NEXT_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_PN
argument_list|,
literal|0
argument_list|,
operator|&
name|val64
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|port_type
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_PN_SRC_DEST_SEL
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|protocol
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_PN_TCP_UDP_SEL
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|port
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_PN_PORT_NUM
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_port_delete  * Delete the port entry for this vpath to port number table.  * @vpath_handle: Vpath handle.  * @port_type: if 0 - Src port or 1 - Dest port  * @protocol: if 0 - TCP or 1 - UDP  * @port: port to be added for this vpath into the list  *  * Adds the given port into the list for this  vpath.  * see also: vxge_hal_vpath_port_add, vxge_hal_vpath_port_get and  * vxge_hal_vpath_port_get_next  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_port_delete
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|port_type
parameter_list|,
name|u32
name|protocol
parameter_list|,
name|u32
name|port
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", port_type = %d, "
literal|"protocol = %d, port = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|port_type
argument_list|,
name|protocol
argument_list|,
name|port
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_PN_PORT_NUM
argument_list|(
name|port
argument_list|)
expr_stmt|;
if|if
condition|(
name|port_type
condition|)
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_PN_SRC_DEST_SEL
expr_stmt|;
if|if
condition|(
name|protocol
condition|)
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_PN_TCP_UDP_SEL
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_DELETE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_PN
argument_list|,
literal|0
argument_list|,
name|val64
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_set - Set/configure RTS hashing.  * @vpath_handle: Virtual Path handle.  * @algorithm: Algorithm Select  * @hash_type: Hash Type  * @bucket_size: no of least significant bits to be used for hashing.  * @it_switch: Itable switch required  *  * Used to set/configure all RTS hashing related stuff.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_itable_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_rth_algoritms_t
name|algorithm
parameter_list|,
name|vxge_hal_rth_hash_types_t
modifier|*
name|hash_type
parameter_list|,
name|u16
name|bucket_size
parameter_list|,
name|u16
name|it_switch
parameter_list|)
block|{
name|u64
name|data0
decl_stmt|,
name|data1
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", algorithm = %d, "
literal|"hash_type = 0x"
name|VXGE_OS_STXFMT
literal|", bucket_size = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|algorithm
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_type
argument_list|,
name|bucket_size
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_GEN_CFG
argument_list|,
literal|0
argument_list|,
operator|&
name|data0
argument_list|,
operator|&
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|algorithm
operator|==
name|RTH_ALG_NONE
condition|)
block|{
name|data0
operator|&=
operator|~
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_EN
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|it_switch
condition|)
block|{
if|if
condition|(
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_ACTIVE_TABLE
argument_list|(
name|data0
argument_list|)
condition|)
name|data0
operator|=
literal|0
expr_stmt|;
else|else
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_ACTIVE_TABLE
expr_stmt|;
block|}
else|else
block|{
name|data0
operator|&=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_ACTIVE_TABLE
expr_stmt|;
block|}
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_EN
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_BUCKET_SIZE
argument_list|(
name|bucket_size
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_ALG_SEL
argument_list|(
name|algorithm
argument_list|)
expr_stmt|;
if|if
condition|(
name|hash_type
operator|->
name|hash_type_tcpipv4_en
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_TCP_IPV4_EN
expr_stmt|;
if|if
condition|(
name|hash_type
operator|->
name|hash_type_ipv4_en
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_IPV4_EN
expr_stmt|;
if|if
condition|(
name|hash_type
operator|->
name|hash_type_tcpipv6_en
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_TCP_IPV6_EN
expr_stmt|;
if|if
condition|(
name|hash_type
operator|->
name|hash_type_ipv6_en
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_IPV6_EN
expr_stmt|;
if|if
condition|(
name|hash_type
operator|->
name|hash_type_tcpipv6ex_en
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_TCP_IPV6_EX_EN
expr_stmt|;
if|if
condition|(
name|hash_type
operator|->
name|hash_type_ipv6ex_en
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_GEN_RTH_IPV6_EX_EN
expr_stmt|;
block|}
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_GEN_CFG
argument_list|,
literal|0
argument_list|,
name|data0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_get - Read RTS hashing.  * @vpath_handle: Virtual Path handle.  * @algorithm: Buffer to return Algorithm Select  * @hash_type: Buffer to return Hash Type  * @table_select: Buffer to return active Table  * @bucket_size: Buffer to return no of least significant bits used for hashing.  *  * Used to read all RTS hashing related stuff.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_itable_set(),  *		vxge_hal_vpath_rts_rth_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_rth_algoritms_t
modifier|*
name|algorithm
parameter_list|,
name|vxge_hal_rth_hash_types_t
modifier|*
name|hash_type
parameter_list|,
name|u8
modifier|*
name|table_select
parameter_list|,
name|u16
modifier|*
name|bucket_size
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", algorithm = 0x"
name|VXGE_OS_STXFMT
literal|", hash_type = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"table_select = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"bucket_size = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|algorithm
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|table_select
argument_list|,
operator|(
name|ptr_t
operator|)
name|bucket_size
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_GEN_CFG
argument_list|,
literal|0
argument_list|,
operator|&
name|val64
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|algorithm
operator|=
operator|(
name|vxge_hal_rth_algoritms_t
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_ALG_SEL
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hash_type
operator|->
name|hash_type_tcpipv4_en
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_RTH_TCP_IPV4_EN
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|hash_type
operator|->
name|hash_type_ipv4_en
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_RTH_IPV4_EN
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|hash_type
operator|->
name|hash_type_tcpipv6_en
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_RTH_TCP_IPV6_EN
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|hash_type
operator|->
name|hash_type_ipv6_en
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_RTH_IPV6_EN
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|hash_type
operator|->
name|hash_type_tcpipv6ex_en
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_RTH_TCP_IPV6_EX_EN
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|hash_type
operator|->
name|hash_type_ipv6ex_en
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_RTH_IPV6_EX_EN
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
operator|*
name|table_select
operator|=
operator|(
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_ACTIVE_TABLE
argument_list|(
name|val64
argument_list|)
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
operator|*
name|bucket_size
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_GEN_BUCKET_SIZE
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_key_set - Configure 40byte secret for hash calc.  *  * @vpath_handle: Virtual Path ahandle.  * @KeySize: Number of 64-bit words  * @Key: up to 40-byte array of 64-bit values  * This function configures the 40-byte secret which is used for hash  * calculation.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_key_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u8
name|KeySize
parameter_list|,
name|u64
modifier|*
name|Key
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|Key
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", KeySize = %d"
literal|", Key = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|KeySize
argument_list|,
operator|(
name|ptr_t
operator|)
name|Key
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|KeySize
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_KEY
argument_list|,
name|i
argument_list|,
name|vxge_os_htonll
argument_list|(
operator|*
name|Key
operator|++
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
break|break;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_key_get - Read 40byte secret for hash calc.  *  * @vpath_handle: Virtual Path ahandle.  * @KeySize: Number of 64-bit words  * @Key: Buffer to return the key  * This function reads the 40-byte secret which is used for hash  * calculation.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set(),  *		vxge_hal_vpath_rts_rth_key_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_key_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u8
name|KeySize
parameter_list|,
name|u64
modifier|*
name|Key
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|Key
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", KeySize = %d"
literal|", Key = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|KeySize
argument_list|,
operator|(
name|ptr_t
operator|)
name|Key
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|KeySize
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_KEY
argument_list|,
name|i
argument_list|,
name|Key
operator|++
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
break|break;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_jhash_cfg_set - Configure JHASH algorithm  *  * @vpath_handle: Virtual Path ahandle.  * @golden_ratio: Golden ratio  * @init_value: Initial value  * This function configures JENKIN's HASH algorithm  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_jhash_cfg_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|golden_ratio
parameter_list|,
name|u32
name|init_value
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", golden_ratio = %d"
literal|", init_value = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|golden_ratio
argument_list|,
name|init_value
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_JHASH_CFG
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_JHASH_CFG_GOLDEN_RATIO
argument_list|(
name|golden_ratio
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_JHASH_CFG_INIT_VALUE
argument_list|(
name|init_value
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_jhash_cfg_get - Read JHASH algorithm  *  * @vpath_handle: Virtual Path ahandle.  * @golden_ratio: Buffer to return Golden ratio  * @init_value: Buffer to return Initial value  * This function reads JENKIN's HASH algorithm  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set(),  *		vxge_hal_vpath_rts_rth_jhash_cfg_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_jhash_cfg_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
modifier|*
name|golden_ratio
parameter_list|,
name|u32
modifier|*
name|init_value
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"golden_ratio = 0x"
name|VXGE_OS_STXFMT
literal|", init_value = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|golden_ratio
argument_list|,
operator|(
name|ptr_t
operator|)
name|init_value
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_JHASH_CFG
argument_list|,
literal|0
argument_list|,
operator|&
name|val64
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
operator|*
name|golden_ratio
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_JHASH_CFG_GOLDEN_RATIO
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|init_value
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_JHASH_CFG_INIT_VALUE
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_mask_set - Set/configure JHASH mask.  * @vpath_handle: Virtual Path ahandle.  * @table_size: Size of the mask table  * @hash_mask_ipv6sa: IPv6SA Hash Mask  * @hash_mask_ipv6da: IPv6DA Hash Mask  * @hash_mask_ipv4sa: IPv4SA Hash Mask  * @hash_mask_ipv4da: IPv4DA Hash Mask  * @hash_mask_l4sp: L4SP Hash Mask  * @hash_mask_l4dp: L4DP Hash Mask  *  * Used to set/configure indirection table.  * It enables the required no of entries in the IT.  * It adds entries to the IT.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_mask_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|table_size
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv6sa
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv6da
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv4sa
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv4da
parameter_list|,
name|u32
modifier|*
name|hash_mask_l4sp
parameter_list|,
name|u32
modifier|*
name|hash_mask_l4dp
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv6sa
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv6da
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv4sa
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv4da
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_l4sp
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_l4dp
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"table_size = %d, hash_mask_ipv6sa = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_ipv6da = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_ipv4sa = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_ipv4da = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_l4sp = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_l4dp = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|table_size
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv6sa
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv6da
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv4sa
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv4da
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_l4sp
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_l4dp
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|table_size
condition|;
name|i
operator|++
control|)
block|{
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV6_SA_MASK
argument_list|(
operator|*
name|hash_mask_ipv6sa
operator|++
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV6_DA_MASK
argument_list|(
operator|*
name|hash_mask_ipv6da
operator|++
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV4_SA_MASK
argument_list|(
operator|*
name|hash_mask_ipv4sa
operator|++
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV4_DA_MASK
argument_list|(
operator|*
name|hash_mask_ipv4da
operator|++
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_L4SP_MASK
argument_list|(
operator|*
name|hash_mask_l4sp
operator|++
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_L4DP_MASK
argument_list|(
operator|*
name|hash_mask_l4dp
operator|++
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MASK
argument_list|,
name|i
argument_list|,
name|val64
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
break|break;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_mask_get - Read JHASH mask.  * @vpath_handle: Virtual Path ahandle.  * @table_size: Size of the mask table  * @hash_mask_ipv6sa: Buffer to return IPv6SA Hash Mask  * @hash_mask_ipv6da: Buffer to return IPv6DA Hash Mask  * @hash_mask_ipv4sa: Buffer to return IPv4SA Hash Mask  * @hash_mask_ipv4da: Buffer to return IPv4DA Hash Mask  * @hash_mask_l4sp: Buffer to return L4SP Hash Mask  * @hash_mask_l4dp: Buffer to return L4DP Hash Mask  *  * Used to read rth mask.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set(),  *	  vxge_hal_vpath_rts_rth_mask_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_mask_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|table_size
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv6sa
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv6da
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv4sa
parameter_list|,
name|u32
modifier|*
name|hash_mask_ipv4da
parameter_list|,
name|u32
modifier|*
name|hash_mask_l4sp
parameter_list|,
name|u32
modifier|*
name|hash_mask_l4dp
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv6sa
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv6da
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv4sa
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_ipv4da
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_l4sp
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hash_mask_l4dp
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"table_size = %d, hash_mask_ipv6sa = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_ipv6da = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_ipv4sa = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_ipv4da = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_l4sp = 0x"
name|VXGE_OS_STXFMT
literal|", hash_mask_l4dp = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|table_size
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv6sa
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv6da
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv4sa
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_ipv4da
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_l4sp
argument_list|,
operator|(
name|ptr_t
operator|)
name|hash_mask_l4dp
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|table_size
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MASK
argument_list|,
name|i
argument_list|,
operator|&
name|val64
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
break|break;
operator|*
name|hash_mask_ipv6sa
operator|++
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_MASK_IPV6_SA_MASK
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|hash_mask_ipv6da
operator|++
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV6_DA_MASK
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|hash_mask_ipv4sa
operator|++
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV4_SA_MASK
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|hash_mask_ipv4da
operator|++
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_IPV4_DA_MASK
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|hash_mask_l4sp
operator|++
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_L4SP_MASK
argument_list|(
name|val64
argument_list|)
expr_stmt|;
operator|*
name|hash_mask_l4dp
operator|++
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_MASK_L4DP_MASK
argument_list|(
name|val64
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_itable_set - Set/configure indirection table (IT).  * @vpath_handles: Virtual Path handles.  * @vpath_count: Number of vpath handles passed in vpath_handles  * @itable: Pointer to indirection table  * @itable_size: Number of entries in itable  *  * Used to set/configure indirection table.  * It enables the required no of entries in the IT.  * It adds entries to the IT.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_itable_set
parameter_list|(
name|vxge_hal_vpath_h
modifier|*
name|vpath_handles
parameter_list|,
name|u32
name|vpath_count
parameter_list|,
name|u8
modifier|*
name|itable
parameter_list|,
name|u32
name|itable_size
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|,
name|l
decl_stmt|,
name|items
index|[
literal|4
index|]
decl_stmt|;
name|u64
name|data0
decl_stmt|;
name|u64
name|data1
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handles
index|[
literal|0
index|]
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handles
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|itable
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", vpath_count = %d, "
literal|"itable = 0x"
name|VXGE_OS_STXFMT
literal|", itable_size = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handles
argument_list|,
name|vpath_count
argument_list|,
operator|(
name|ptr_t
operator|)
name|itable
argument_list|,
name|itable_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|rth_it_type
operator|==
name|VXGE_HAL_RTH_IT_TYPE_SOLO_IT
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|itable_size
condition|;
name|j
operator|++
control|)
block|{
name|data1
operator|=
literal|0
expr_stmt|;
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_SOLO_IT_BUCKET_DATA
argument_list|(
name|itable
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handles
index|[
literal|0
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_SOLO_IT
argument_list|,
name|j
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|itable_size
condition|;
name|j
operator|++
control|)
block|{
name|data1
operator|=
literal|0
expr_stmt|;
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_SOLO_IT_ENTRY_EN
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_SOLO_IT_BUCKET_DATA
argument_list|(
name|itable
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handles
index|[
name|itable
index|[
name|j
index|]
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_SOLO_IT
argument_list|,
name|j
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vpath_count
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|k
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|k
operator|<
name|itable_size
condition|;
name|k
operator|++
control|)
block|{
if|if
condition|(
name|itable
index|[
name|k
index|]
operator|!=
name|i
condition|)
continue|continue;
for|for
control|(
name|l
operator|=
name|j
init|;
name|l
operator|<
literal|4
condition|;
name|l
operator|++
control|)
name|items
index|[
name|l
index|]
operator|=
name|k
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|++
operator|==
literal|3
operator|)
operator|||
operator|(
name|k
operator|==
operator|(
name|itable_size
operator|-
literal|1
operator|)
operator|)
condition|)
block|{
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM0_BUCKET_NUM
argument_list|(
name|items
index|[
literal|0
index|]
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM0_ENTRY_EN
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM0_BUCKET_DATA
argument_list|(
name|itable
index|[
name|items
index|[
literal|0
index|]
index|]
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM1_BUCKET_NUM
argument_list|(
name|items
index|[
literal|1
index|]
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM1_ENTRY_EN
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM1_BUCKET_DATA
argument_list|(
name|itable
index|[
name|items
index|[
literal|1
index|]
index|]
argument_list|)
expr_stmt|;
name|data1
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM0_BUCKET_NUM
argument_list|(
name|items
index|[
literal|2
index|]
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM0_ENTRY_EN
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM0_BUCKET_DATA
argument_list|(
name|itable
index|[
name|items
index|[
literal|2
index|]
index|]
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM1_BUCKET_NUM
argument_list|(
name|items
index|[
literal|3
index|]
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM1_ENTRY_EN
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM1_BUCKET_DATA
argument_list|(
name|itable
index|[
name|items
index|[
literal|3
index|]
index|]
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handles
index|[
name|i
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MULTI_IT
argument_list|,
literal|0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|j
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_itable_get - Read indirection table(IT).  * @vpath_handles: Virtual Path handles.  * @vpath_count: Number of vpath handles passed in vpath_handles  * @itable: Pointer to the buffer to return indirection table  * @itable_size: pointer to buffer to return Number of entries in itable  *  * Used to read indirection table.  *  * See also: vxge_hal_vpath_rts_rth_clr(), vxge_hal_vpath_rts_rth_set(),  *		vxge_hal_vpath_rts_rth_itable_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_itable_get
parameter_list|(
name|vxge_hal_vpath_h
modifier|*
name|vpath_handles
parameter_list|,
name|u32
name|vpath_count
parameter_list|,
name|u8
modifier|*
name|itable
parameter_list|,
name|u32
name|itable_size
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|;
name|u64
name|data0
decl_stmt|;
name|u64
name|data1
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handles
index|[
literal|0
index|]
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handles
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|itable
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", vpath_count = %d, "
literal|"itable = 0x"
name|VXGE_OS_STXFMT
literal|", itable_size = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handles
argument_list|,
name|vpath_count
argument_list|,
operator|(
name|ptr_t
operator|)
name|itable
argument_list|,
name|itable_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|rth_it_type
operator|==
name|VXGE_HAL_RTH_IT_TYPE_SOLO_IT
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vpath_count
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|itable_size
condition|;
name|j
operator|++
control|)
block|{
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handles
index|[
name|i
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_SOLO_IT
argument_list|,
name|j
argument_list|,
operator|&
name|data0
argument_list|,
operator|&
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|u8
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_SOLO_IT_ENTRY_EN
argument_list|(
name|data0
argument_list|)
condition|)
block|{
name|itable
index|[
name|j
index|]
operator|=
operator|(
name|u8
operator|)
name|i
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vpath_count
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|itable_size
condition|;
control|)
block|{
name|data0
operator|=
literal|0
expr_stmt|;
name|data1
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|j
operator|<
name|itable_size
condition|)
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM0_BUCKET_NUM
argument_list|(
name|j
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|+
literal|1
operator|<
name|itable_size
condition|)
name|data0
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM1_BUCKET_NUM
argument_list|(
name|j
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|+
literal|2
operator|<
name|itable_size
condition|)
name|data1
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM0_BUCKET_NUM
argument_list|(
name|j
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|+
literal|3
operator|<
name|itable_size
condition|)
name|data1
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM1_BUCKET_NUM
argument_list|(
name|j
operator|+
literal|3
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_get
argument_list|(
name|vpath_handles
index|[
name|i
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_READ_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MULTI_IT
argument_list|,
literal|0
argument_list|,
operator|&
name|data0
argument_list|,
operator|&
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
name|j
operator|<
name|itable_size
condition|)
block|{
if|if
condition|(
operator|(
name|u8
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_ITEM0_ENTRY_EN
argument_list|(
name|data0
argument_list|)
condition|)
block|{
name|itable
index|[
name|j
index|]
operator|=
operator|(
name|u8
operator|)
name|i
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|j
operator|<
name|itable_size
condition|)
block|{
if|if
condition|(
operator|(
name|u8
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_RTH_ITEM1_ENTRY_EN
argument_list|(
name|data0
argument_list|)
condition|)
block|{
name|itable
index|[
name|j
index|]
operator|=
operator|(
name|u8
operator|)
name|i
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|j
operator|<
name|itable_size
condition|)
block|{
if|if
condition|(
operator|(
name|u8
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_RTH_ITEM0_ENTRY_EN
argument_list|(
name|data1
argument_list|)
condition|)
block|{
name|itable
index|[
name|j
index|]
operator|=
operator|(
name|u8
operator|)
name|i
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|j
operator|<
name|itable_size
condition|)
block|{
if|if
condition|(
operator|(
name|u8
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_RTH_ITEM1_ENTRY_EN
argument_list|(
name|data1
argument_list|)
condition|)
block|{
name|itable
index|[
name|j
index|]
operator|=
operator|(
name|u8
operator|)
name|i
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
block|}
block|}
block|}
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rts_rth_clr - Clear RTS hashing.  * @vpath_handles: Virtual Path handles.  * @vpath_count: Number of vpath handles passed in vpath_handles  *  * This function is used to clear all RTS hashing related stuff.  *  * See also: vxge_hal_vpath_rts_rth_set(), vxge_hal_vpath_rts_rth_itable_set().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rts_rth_clr
parameter_list|(
name|vxge_hal_vpath_h
modifier|*
name|vpath_handles
parameter_list|,
name|u32
name|vpath_count
parameter_list|)
block|{
name|u64
name|data0
decl_stmt|,
name|data1
decl_stmt|;
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handles
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handles
index|[
literal|0
index|]
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handles = 0x"
name|VXGE_OS_STXFMT
literal|", vpath_count = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handles
argument_list|,
name|vpath_count
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|rth_it_type
operator|==
name|VXGE_HAL_RTH_IT_TYPE_SOLO_IT
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|VXGE_HAL_MAX_ITABLE_ENTRIES
condition|;
name|j
operator|++
control|)
block|{
name|data0
operator|=
literal|0
expr_stmt|;
name|data1
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handles
index|[
literal|0
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_SOLO_IT
argument_list|,
name|j
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vpath_count
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|VXGE_HAL_MAX_ITABLE_ENTRIES
condition|;
name|j
operator|+=
literal|4
control|)
block|{
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM0_BUCKET_NUM
argument_list|(
name|j
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_RTH_ITEM1_BUCKET_NUM
argument_list|(
name|j
operator|+
literal|1
argument_list|)
expr_stmt|;
name|data1
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM0_BUCKET_NUM
argument_list|(
name|j
operator|+
literal|2
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_RTH_ITEM1_BUCKET_NUM
argument_list|(
name|j
operator|+
literal|3
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_rts_table_set
argument_list|(
name|vpath_handles
index|[
name|i
index|]
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_WRITE_ENTRY
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_RTH_MULTI_IT
argument_list|,
literal|0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
block|}
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_promisc_enable - Enable promiscuous mode.  * @vpath_handle: Vpath handle.  *  * Enable promiscuous mode of X3100 operation.  *  * See also: vxge_hal_vpath_promisc_disable().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_promisc_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|promisc_en
operator|==
name|VXGE_HAL_VP_PROMISC_ENABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
operator||
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
operator||
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
operator||
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|promisc_en
operator|=
name|VXGE_HAL_VP_PROMISC_ENABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_promisc_disable - Disable promiscuous mode.  * @vpath_handle: Vpath handle.  *  * Disable promiscuous mode of X3100 operation.  *  * See also: vxge_hal_vpath_promisc_enable().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_promisc_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|promisc_en
operator|==
name|VXGE_HAL_VP_PROMISC_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|==
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_DISABLE
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|==
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_DISABLE
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_bcast_en
operator|==
name|VXGE_HAL_VPATH_RPA_BCAST_DISABLE
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_all_vid_en
operator|==
name|VXGE_HAL_VPATH_RPA_ALL_VID_DISABLE
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|promisc_en
operator|=
name|VXGE_HAL_VP_PROMISC_DISABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_bcast_enable - Enable broadcast  * @vpath_handle: Vpath handle.  *  * Enable receiving broadcasts.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_bcast_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_bcast_en
operator|==
name|VXGE_HAL_VPATH_RPA_BCAST_ENABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_bcast_en
operator|=
name|VXGE_HAL_VPATH_RPA_BCAST_ENABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_bcast_disable - Disable broadcast  * @vpath_handle: Vpath handle.  *  * Disable receiving broadcasts.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_bcast_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_bcast_en
operator|==
name|VXGE_HAL_VPATH_RPA_BCAST_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_bcast_en
operator|=
name|VXGE_HAL_VPATH_RPA_BCAST_DISABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mcast_enable - Enable multicast addresses.  * @vpath_handle: Vpath handle.  *  * Enable X3100 multicast addresses.  * Returns: VXGE_HAL_OK on success.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mcast_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|==
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_ENABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_ENABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mcast_disable - Disable  multicast addresses.  * @vpath_handle: Vpath handle.  *  * Disable X3100 multicast addresses.  * Returns: VXGE_HAL_OK - success.  * VXGE_HAL_INF_MEM_STROBE_CMD_EXECUTING - Failed to disable mcast  * feature within the time(timeout).  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mcast_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|==
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_DISABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_ucast_enable - Enable unicast addresses.  * @vpath_handle: Vpath handle.  *  * Enable X3100 unicast addresses.  * Returns: VXGE_HAL_OK on success.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_ucast_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|==
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_ENABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_ENABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_ucast_disable - Disable  unicast addresses.  * @vpath_handle: Vpath handle.  *  * Disable X3100 unicast addresses.  * Returns: VXGE_HAL_OK - success.  * VXGE_HAL_INF_MEM_STROBE_CMD_EXECUTING - Failed to disable mcast  * feature within the time(timeout).  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_ucast_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|==
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_DISABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_all_vid_enable - Enable all Vlan Ids.  * @vpath_handle: Vpath handle.  *  * Enable X3100 vlan ids.  * Returns: VXGE_HAL_OK on success.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_all_vid_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_all_vid_en
operator|==
name|VXGE_HAL_VPATH_RPA_ALL_VID_ENABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_all_vid_en
operator|=
name|VXGE_HAL_VPATH_RPA_ALL_VID_ENABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_all_vid_disable - Disable all Vlan Ids.  * @vpath_handle: Vpath handle.  *  * Disable X3100  vlan ids.  * Returns: VXGE_HAL_OK - success.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_all_vid_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_all_vid_en
operator|==
name|VXGE_HAL_VPATH_RPA_ALL_VID_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_all_vid_en
operator|=
name|VXGE_HAL_VPATH_RPA_ALL_VID_DISABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_strip_vlan_tag_enable - Enable strip vlan tag.  * @vpath_handle: Vpath handle.  *  * Enable X3100  strip vlan tag.  * Returns: VXGE_HAL_OK on success.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_strip_vlan_tag_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_strip_vlan_tag
operator|==
name|VXGE_HAL_VPATH_RPA_STRIP_VLAN_TAG_ENABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_STRIP_VLAN_TAG
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_strip_vlan_tag
operator|=
name|VXGE_HAL_VPATH_RPA_STRIP_VLAN_TAG_ENABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_strip_vlan_tag_disable - Disable strip vlan tag.  * @vpath_handle: Vpath handle.  *  * Disable X3100  strip vlan tag.  * Returns: VXGE_HAL_OK - success.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_strip_vlan_tag_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_strip_vlan_tag
operator|==
name|VXGE_HAL_VPATH_RPA_STRIP_VLAN_TAG_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_STRIP_VLAN_TAG
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_strip_vlan_tag
operator|=
name|VXGE_HAL_VPATH_RPA_STRIP_VLAN_TAG_DISABLE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_tpa_set - Set tpa parameters.  * @vpath_handle: Virtual Path ahandle.  * @params: vxge_hal_vpath_tpa_params {} structure with parameters  *  * The function	sets the tpa parametrs for the vpath.  *  * See also: vxge_hal_vpath_tpa_params {}  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_tpa_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_vpath_tpa_params
modifier|*
name|params
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|params
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", params = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tpa_cfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|->
name|tpa_ignore_frame_error
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|tpa_ignore_frame_error
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_IGNORE_FRAME_ERR
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_IGNORE_FRAME_ERR
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|tpa_ipv6_keep_searching
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|tpa_ipv6_keep_searching
condition|)
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_IPV6_STOP_SEARCHING
expr_stmt|;
else|else
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_IPV6_STOP_SEARCHING
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|tpa_l4_pshdr_present
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|tpa_l4_pshdr_present
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_L4_PSHDR_PRESENT
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_L4_PSHDR_PRESENT
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|tpa_support_mobile_ipv6_hdrs
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|tpa_support_mobile_ipv6_hdrs
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_SUPPORT_MOBILE_IPV6_HDRS
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_SUPPORT_MOBILE_IPV6_HDRS
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tpa_cfg
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|tpa_ignore_frame_error
operator|=
name|params
operator|->
name|tpa_ignore_frame_error
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|tpa_l4_pshdr_present
operator|=
name|params
operator|->
name|tpa_l4_pshdr_present
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|tpa_support_mobile_ipv6_hdrs
operator|=
name|params
operator|->
name|tpa_support_mobile_ipv6_hdrs
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tx_protocol_assist_cfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|->
name|tpa_lsov2_en
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|tpa_lsov2_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_LSOV2_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_LSOV2_EN
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|tpa_ipv6_keep_searching
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|tpa_ipv6_keep_searching
condition|)
name|val64
operator||=
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_IPV6_KEEP_SEARCHING
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_IPV6_KEEP_SEARCHING
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tx_protocol_assist_cfg
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|tpa_lsov2_en
operator|=
name|params
operator|->
name|tpa_lsov2_en
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|tpa_ipv6_keep_searching
operator|=
name|params
operator|->
name|tpa_ipv6_keep_searching
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_rpa_set - Set rpa parameters.  * @vpath_handle: Virtual Path ahandle.  * @params: vxge_hal_vpath_rpa_params {} structure with parameters  *  * The function	sets the rpa parametrs for the vpath.  *  * See also: vxge_hal_vpath_rpa_params {}  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_rpa_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_vpath_rpa_params
modifier|*
name|params
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|params
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", params = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|->
name|rpa_ipv4_tcp_incl_ph
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_ipv4_tcp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_TCP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_TCP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_ipv6_tcp_incl_ph
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_ipv6_tcp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_TCP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_TCP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_ipv4_udp_incl_ph
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_ipv4_udp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_UDP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_UDP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_ipv6_udp_incl_ph
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_ipv6_udp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_UDP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_UDP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_l4_incl_cf
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_l4_incl_cf
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_L4_INCL_CF
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_L4_INCL_CF
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_strip_vlan_tag
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_strip_vlan_tag
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_STRIP_VLAN_TAG
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_STRIP_VLAN_TAG
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ipv4_tcp_incl_ph
operator|=
name|params
operator|->
name|rpa_ipv4_tcp_incl_ph
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ipv6_tcp_incl_ph
operator|=
name|params
operator|->
name|rpa_ipv6_tcp_incl_ph
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ipv4_udp_incl_ph
operator|=
name|params
operator|->
name|rpa_ipv4_udp_incl_ph
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ipv6_udp_incl_ph
operator|=
name|params
operator|->
name|rpa_ipv6_udp_incl_ph
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_l4_incl_cf
operator|=
name|params
operator|->
name|rpa_l4_incl_cf
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_strip_vlan_tag
operator|=
name|params
operator|->
name|rpa_strip_vlan_tag
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|->
name|rpa_ucast_all_addr_en
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_ucast_all_addr_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_mcast_all_addr_en
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_mcast_all_addr_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_bcast_en
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_bcast_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_all_vid_en
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_all_vid_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|=
name|params
operator|->
name|rpa_ucast_all_addr_en
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|=
name|params
operator|->
name|rpa_mcast_all_addr_en
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_bcast_en
operator|=
name|params
operator|->
name|rpa_bcast_en
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_all_vid_en
operator|=
name|params
operator|->
name|rpa_all_vid_en
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|fau_rpa_vcfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|->
name|rpa_l4_comp_csum
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_l4_comp_csum
condition|)
name|val64
operator||=
name|VXGE_HAL_FAU_RPA_VCFG_L4_COMP_CSUM
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_FAU_RPA_VCFG_L4_COMP_CSUM
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_l3_incl_cf
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_l3_incl_cf
condition|)
name|val64
operator||=
name|VXGE_HAL_FAU_RPA_VCFG_L3_INCL_CF
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_FAU_RPA_VCFG_L3_INCL_CF
expr_stmt|;
block|}
if|if
condition|(
name|params
operator|->
name|rpa_l3_comp_csum
operator|!=
name|VXGE_HAL_DEFAULT_32
condition|)
block|{
if|if
condition|(
name|params
operator|->
name|rpa_l3_comp_csum
condition|)
name|val64
operator||=
name|VXGE_HAL_FAU_RPA_VCFG_L3_COMP_CSUM
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_FAU_RPA_VCFG_L3_COMP_CSUM
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|fau_rpa_vcfg
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_l4_comp_csum
operator|=
name|params
operator|->
name|rpa_l4_comp_csum
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_l3_incl_cf
operator|=
name|params
operator|->
name|rpa_l3_incl_cf
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|->
name|rpa_l3_comp_csum
operator|=
name|params
operator|->
name|rpa_l3_comp_csum
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_intr_enable - Enable vpath interrupts.  * @vpath: Virtual Path.  * @op: One of the vxge_hal_vpath_intr_e enumerated values specifying  *	  the type(s) of interrupts to enable.  *  * Enable vpath interrupts. The function is to be executed the last in  * vpath initialization sequence.  *  * See also: __hal_vpath_intr_disable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_intr_enable
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|pci_config_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_ppif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_msg_to_vpath_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_pcipif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|wrdma_alarm_status
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xgmac_vp_int_status
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_int_status
argument_list|)
expr_stmt|;
comment|/* Unmask the individual interrupts. */
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|pci_config_errors_mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|first_vp_id
operator|!=
name|vpath
operator|->
name|vp_id
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_to_vpath_alarm_mask
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_to_vpath_alarm_mask
argument_list|)
expr_stmt|;
block|}
block|}
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_ppif_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_msg_to_vpath_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_pcipif_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_PRC_ALARM_REG_PRC_RING_BUMP
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|wrdma_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xgmac_vp_int_mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|first_vp_id
operator|!=
name|vpath
operator|->
name|vp_id
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_mask
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
operator|(
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_REAF_FAULT
operator||
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_REAF_OK
operator|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_mask
argument_list|)
expr_stmt|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_en
argument_list|)
expr_stmt|;
comment|/* val64 |= VXGE_HAL_TIM_SET_INT_EN_VP(1<< (16 - vpath->vp_id)); */
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_set_int_en
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_intr_enable - Enable vpath interrupts.  * @vpath_handle: Virtual Path handle.  * @op: One of the vxge_hal_vpath_intr_e enumerated values specifying  *	  the type(s) of interrupts to enable.  *  * Enable vpath interrupts. The function is to be executed the last in  * vpath initialization sequence.  *  * See also: vxge_hal_vpath_intr_disable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_intr_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_intr_enable
argument_list|(
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
name|vp
operator|->
name|vpath
argument_list|)
expr_stmt|;
name|vxge_hal_vpath_unmask_all
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_intr_disable - Disable vpath interrupts.  * @vpath: Virtual Path.  * @op: One of the vxge_hal_vpath_intr_e enumerated values specifying  *	  the type(s) of interrupts to enable.  *  * Disable vpath interrupts. The function is to be executed the last in  * vpath initialization sequence.  *  * See also: __hal_vpath_intr_enable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_intr_disable
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_int_mask
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_TIM_CLR_INT_EN_VP
argument_list|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_clr_int_en
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|pci_config_errors_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_to_vpath_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_ppif_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_msg_to_vpath_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_pcipif_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|wrdma_alarm_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xgmac_vp_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_intr_disable - Disable vpath interrupts.  * @vpath_handle: Virtual Path handle.  * @op: One of the vxge_hal_vpath_intr_e enumerated values specifying  *	  the type(s) of interrupts to disable.  *  * Disable vpath interrupts.  *  * See also: vxge_hal_vpath_intr_enable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_intr_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_vpath_mask_all
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_vpath_intr_disable
argument_list|(
name|vpath
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mask_all - Mask all vpath interrupts.  * @vpath_handle: Virtual Path handle.  *  * Mask	all vpath interrupts.  *  * See also: vxge_hal_vpath_unmask_all()  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mask_all
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_VPATH_GENERAL_INT_MASK_PIC_INT
operator||
name|VXGE_HAL_VPATH_GENERAL_INT_MASK_PCI_INT
operator||
name|VXGE_HAL_VPATH_GENERAL_INT_MASK_WRDMA_INT
operator||
name|VXGE_HAL_VPATH_GENERAL_INT_MASK_XMAC_INT
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_int_mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|vBIT
argument_list|(
literal|0xf
argument_list|,
operator|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
literal|0xf
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_unmask_all - Unmask all vpath interrupts.  * @vpath_handle: Virtual Path handle.  *  * Unmask all vpath interrupts.  *  * See also: vxge_hal_vpath_mask_all()  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_unmask_all
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_int_mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
operator|(
name|vBIT
argument_list|(
literal|0xf
argument_list|,
operator|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
operator|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_link_state_test - Test for the link state.  * @vpath: Virtual Path.  *  * Test link state.  * Returns: link state.  */
end_comment

begin_function
name|vxge_hal_device_link_state_e
name|__hal_vpath_link_state_test
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_ASIC_NTWK_VP_CTRL_REQ_TEST_NTWK
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_ctrl
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_ASIC_NTWK_VP_CTRL_REQ_TEST_NTWK
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|hldev
operator|->
name|header
operator|.
name|link_state
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_link_state_poll - Poll for the link state.  * @vpath: Virtual Path.  *  * Get link state.  * Returns: link state.  */
end_comment

begin_function
name|vxge_hal_device_link_state_e
name|__hal_vpath_link_state_poll
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_LINK_NONE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_LINK_NONE
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|xgmac_gen_status_vpmgmt_clone
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_XGMAC_GEN_STATUS_VPMGMT_CLONE_XMACJ_NTWK_OK
condition|)
block|{
operator|(
name|void
operator|)
name|__hal_device_handle_link_up_ind
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_XGMAC_GEN_STATUS_VPMGMT_CLONE_XMACJ_NTWK_DATA_RATE
condition|)
block|{
name|VXGE_HAL_DEVICE_DATA_RATE_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|VXGE_HAL_DATA_RATE_10G
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|VXGE_HAL_DEVICE_DATA_RATE_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|VXGE_HAL_DATA_RATE_1G
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
operator|(
name|void
operator|)
name|__hal_device_handle_link_down_ind
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|vpath
operator|->
name|hldev
operator|->
name|header
operator|.
name|link_state
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_data_rate_poll - Poll for the data rate.  * @vpath: Virtual Path.  *  * Get data rate.  * Returns: data rate.  */
end_comment

begin_function
name|vxge_hal_device_data_rate_e
name|__hal_vpath_data_rate_poll
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_DATA_RATE_UNKNOWN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_DATA_RATE_UNKNOWN
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|xgmac_gen_status_vpmgmt_clone
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_XGMAC_GEN_STATUS_VPMGMT_CLONE_XMACJ_NTWK_DATA_RATE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_DATA_RATE_10G
operator|)
return|;
block|}
else|else
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_DATA_RATE_1G
operator|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_alarm_process - Process Alarms.  * @vpath: Virtual Path.  * @skip_alarms: Do not clear the alarms  *  * Process vpath alarms.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_alarm_process
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|,
name|u32
name|skip_alarms
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|u64
name|alarm_status
decl_stmt|;
name|u64
name|pic_status
init|=
literal|0
decl_stmt|;
name|u64
name|pif_status
decl_stmt|;
name|u64
name|wrdma_status
decl_stmt|;
name|u64
name|xgmac_status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
name|alarm_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"alarm_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|alarm_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|vxge_os_unlikely
argument_list|(
operator|!
name|alarm_status
argument_list|)
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_ERR_WRONG_IRQ
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_PIC_INT
condition|)
block|{
name|pic_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_ppif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"pic_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pic_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_VPATH_PPIF_INT_STATUS_GENERAL_ERRORS_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"general_errors_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_INI_SERR_DET
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|ini_serr_det
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
literal|"VXGE_HAL_GENERAL_ERRORS_REG_INI_SERR_DET"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_SERR
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_GENERAL_ERRORS_REG_INI_SERR_DET
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_reg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d \ 				    Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_SERR
operator|)
return|;
block|}
block|}
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_VPATH_PPIF_INT_STATUS_PCI_CONFIG_ERRORS_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|pci_config_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"pci_config_errors_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PCI_CONFIG_ERRORS_REG_STATUS_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|pci_config_status_err
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s: \ 				    VXGE_HAL_PCI_CONFIG_ERRORS_REG_STATUS_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PCI_CONFIG_ERRORS_REG_UNCOR_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|pci_config_uncor_err
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s: \ 				    VXGE_HAL_PCI_CONFIG_ERRORS_REG_UNCOR_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PCI_CONFIG_ERRORS_REG_COR_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|pci_config_cor_err
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s: \ 				    VXGE_HAL_PCI_CONFIG_ERRORS_REG_COR_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|pci_config_errors_reg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_VPATH_PPIF_INT_STATUS_MRPCIM_TO_VPATH_ALARM_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"mrpcim_to_vpath_alarm_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_MRPCIM_TO_VPATH_ALARM_REG_ALARM
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|mrpcim_to_vpath_alarms
operator|++
expr_stmt|;
name|hldev
operator|->
name|stats
operator|.
name|sw_dev_err_stats
operator|.
name|mrpcim_alarms
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_MRPCIM_TO_VPATH_ALARM_REG_ALARM"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_MRPCIM_CRITICAL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_MRPCIM_TO_VPATH_ALARM_REG_ALARM
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_MRPCIM_CRITICAL
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|mrpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_VPATH_PPIF_INT_STATUS_SRPCIM_TO_VPATH_ALARM_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"srpcim_to_vpath_alarm_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|srpcim_to_vpath_alarms
operator|++
expr_stmt|;
name|hldev
operator|->
name|stats
operator|.
name|sw_dev_err_stats
operator|.
name|srpcim_alarms
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_SRPCIM_TO_VPATH_ALARM_REG_GET_ALARM"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_srpcim_alarm_process
argument_list|(
operator|(
name|vxge_hal_device_h
operator|)
name|hldev
argument_list|,
name|skip_alarms
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_to_vpath_alarm_reg
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_ERR_EVENT_SRPCIM_CRITICAL
condition|)
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_WRDMA_INT
condition|)
block|{
name|wrdma_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|wrdma_alarm_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"wrdma_alarm_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|wrdma_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|wrdma_status
operator|&
name|VXGE_HAL_WRDMA_ALARM_STATUS_PRC_ALARM_PRC_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"prc_alarm_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PRC_ALARM_REG_PRC_RING_BUMP
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|prc_ring_bumps
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_PRC_ALARM_REG_PRC_RING_BUMP"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PRC_ALARM_REG_PRC_RXDCM_SC_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|prc_rxdcm_sc_err
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_PRC_ALARM_REG_PRC_RXDCM_SC_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_CRITICAL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_PRC_ALARM_REG_PRC_RXDCM_SC_ERR
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_reg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_EVENT_CRITICAL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_CRITICAL
operator|)
return|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PRC_ALARM_REG_PRC_RXDCM_SC_ABORT
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|prc_rxdcm_sc_abort
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s: \ 				    VXGE_HAL_PRC_ALARM_REG_PRC_RXDCM_SC_ABORT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_CRITICAL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_PRC_ALARM_REG_PRC_RXDCM_SC_ABORT
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_EVENT_CRITICAL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_CRITICAL
operator|)
return|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_PRC_ALARM_REG_PRC_QUANTA_SIZE_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|prc_quanta_size_err
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s: \ 				    VXGE_HAL_PRC_ALARM_REG_PRC_QUANTA_SIZE_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_alarm_reg
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_PIC_INT
condition|)
block|{
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_VPATH_PPIF_INT_STATUS_GENERAL_ERRORS_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"general_errors_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO0_OVRFLOW
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|dblgen_fifo0_overflow
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
literal|"VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO0_OVRFLOW"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO0_OVRFLOW
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_reg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d \ 				    Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_KDFCCTL
operator|)
return|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO1_OVRFLOW
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|dblgen_fifo1_overflow
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO1_OVRFLOW"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO2_OVRFLOW
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|dblgen_fifo2_overflow
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_GENERAL_ERRORS_REG_DBLGEN_FIFO2_OVRFLOW"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_STATSB_PIF_CHAIN_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|statsb_pif_chain_error
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_GENERAL_ERRORS_REG_STATSB_PIF_CHAIN_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_STATSB_DROP_TIMEOUT
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|statsb_drop_timeout
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_GENERAL_ERRORS_REG_STATSB_DROP_TIMEOUT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_GENERAL_ERRORS_REG_TGT_ILLEGAL_ACCESS
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|target_illegal_access
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_GENERAL_ERRORS_REG_TGT_ILLEGAL_ACCESS"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|general_errors_reg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_VPATH_PPIF_INT_STATUS_KDFCCTL_ERRORS_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"kdfcctl_errors_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_OVRWR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo0_overwrite
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_OVRWR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_OVRWR
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_reg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d \ 				    Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_KDFCCTL
operator|)
return|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO1_OVRWR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo1_overwrite
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO1_OVRWR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO2_OVRWR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo2_overwrite
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO2_OVRWR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_POISON
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo0_poison
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_POISON"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_POISON
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_reg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d \ 				    Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_KDFCCTL
operator|)
return|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO1_POISON
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo1_poison
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO1_POISON"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO2_POISON
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo2_poison
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO2_POISON"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_DMA_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo0_dma_error
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_DMA_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO0_DMA_ERR
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_reg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d \ 				    Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_EVENT_KDFCCTL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_EVENT_KDFCCTL
operator|)
return|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO1_DMA_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo1_dma_error
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO1_DMA_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO2_DMA_ERR
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|kdfcctl_fifo2_dma_error
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_KDFCCTL_ERRORS_REG_KDFCCTL_FIFO2_DMA_ERR"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|skip_alarms
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfcctl_errors_reg
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_PCI_INT
condition|)
block|{
name|pif_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_pcipif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"vpath_pcipif_int_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pif_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|pif_status
operator|&
name|VXGE_HAL_VPATH_PCIPIF_INT_STATUS_SRPCIM_MSG_TO_VPATH_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_msg_to_vpath_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"srpcim_msg_to_vpath_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_SRPCIM_MSG_TO_VPATH_REG_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|srpcim_to_vpath_wmsg
argument_list|)
expr_stmt|;
name|__hal_ifmsg_wmsg_process
argument_list|(
name|vpath
argument_list|,
name|val64
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|srpcim_msg_to_vpath
operator|++
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|srpcim_to_vpath_wmsg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_msg_to_vpath_mask
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
literal|"VXGE_HAL_SRPCIM_MSG_TO_VPATH_REG_INT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|srpcim_msg_to_vpath_reg
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_XMAC_INT
condition|)
block|{
name|xgmac_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xgmac_vp_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"xgmac_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|xgmac_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|xgmac_status
operator|&
name|VXGE_HAL_XGMAC_VP_INT_STATUS_ASIC_NTWK_VP_ERR_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"asic_ntwk_vp_err_reg = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_FAULT
operator|)
operator|&&
operator|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_OK
operator|)
operator|)
operator|)
operator|||
operator|(
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_FAULT_OCCURRED
operator|)
operator|&&
operator|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_OK_OCCURRED
operator|)
operator|)
operator|)
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|network_sustained_fault
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:"
expr|\
literal|"VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_FAULT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|vpath
operator|->
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_FAULT
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_mask
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_device_handle_link_down_ind
argument_list|(
name|hldev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_OK
operator|)
operator|&&
operator|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_FAULT
operator|)
operator|)
operator|)
operator|||
operator|(
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_OK_OCCURRED
operator|)
operator|&&
operator|(
operator|!
operator|(
name|val64
operator|&
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_FAULT_OCCURRED
operator|)
operator|)
operator|)
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|network_sustained_ok
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_OK"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_ASIC_NTWK_VP_ERR_REG_SUS_OK
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_mask
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_device_handle_link_up_ind
argument_list|(
name|hldev
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|asic_ntwk_vp_err_reg
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_INF_LINK_UP_DOWN
operator|)
return|;
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
operator|~
operator|(
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_PIC_INT
operator||
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_PCI_INT
operator||
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_WRDMA_INT
operator||
name|VXGE_HAL_VPATH_GENERAL_INT_STATUS_XMAC_INT
operator|)
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|error_stats
operator|.
name|unknown_alarms
operator|++
expr_stmt|;
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:%s:%d Unknown Alarm"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_UNKNOWN
argument_list|)
expr_stmt|;
name|status
operator|=
name|VXGE_HAL_ERR_EVENT_UNKNOWN
expr_stmt|;
block|}
else|else
block|{
name|hldev
operator|->
name|stats
operator|.
name|sw_dev_err_stats
operator|.
name|vpath_alarms
operator|++
expr_stmt|;
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_begin_irq - Begin IRQ processing.  * @vpath_handle: Virtual Path handle.  * @skip_alarms: Do not clear the alarms  * @reason: "Reason" for the interrupt,	the value of vpath's  *			general_int_status register.  *  * The function	performs two actions, It first checks whether (shared IRQ) the  * interrupt was raised	by the device. Next, it	masks the device interrupts.  *  * Note:  * vxge_hal_vpath_begin_irq() does not flush MMIO writes through the  * bridge. Therefore, two back-to-back interrupts are potentially possible.  * It is the responsibility	of the ULD to make sure	that only one  * vxge_hal_vpath_continue_irq() runs at a time.  *  * Returns: 0, if the interrupt	is not "ours" (note that in this case the  * vpath remain enabled).  * Otherwise, vxge_hal_vpath_begin_irq() returns 64bit general adapter  * status.  * See also: vxge_hal_vpath_handle_irq()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_begin_irq
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|skip_alarms
parameter_list|,
name|u64
modifier|*
name|reason
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|u64
name|adapter_status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_status_e
name|ret_val
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|reason
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", skip_alarms = %d, "
literal|"reason = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|skip_alarms
argument_list|,
operator|(
name|ptr_t
operator|)
name|reason
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|titan_general_int_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|vxge_os_unlikely
argument_list|(
operator|!
name|val64
argument_list|)
condition|)
block|{
comment|/* not Titan interrupt	 */
operator|*
name|reason
operator|=
literal|0
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_WRONG_IRQ
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_WRONG_IRQ
operator|)
return|;
block|}
if|if
condition|(
name|vxge_os_unlikely
argument_list|(
name|val64
operator|==
name|VXGE_HAL_ALL_FOXES
argument_list|)
condition|)
block|{
name|adapter_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|adapter_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|adapter_status
operator|==
name|VXGE_HAL_ALL_FOXES
condition|)
block|{
name|__hal_device_handle_error
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_EVENT_SLOT_FREEZE
argument_list|)
expr_stmt|;
operator|*
name|reason
operator|=
literal|0
expr_stmt|;
name|ret_val
operator|=
name|VXGE_HAL_ERR_SLOT_FREEZE
expr_stmt|;
goto|goto
name|exit
goto|;
block|}
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_TITAN_GENERAL_INT_STATUS_VPATH_TRAFFIC_INT
argument_list|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
argument_list|)
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
operator|*
name|reason
operator|=
name|bVAL4
argument_list|(
name|val64
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
operator|*
name|reason
operator|=
name|bVAL4
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
operator|*
name|reason
operator|=
name|VXGE_HAL_INTR_ALARM
expr_stmt|;
if|if
condition|(
name|vxge_os_unlikely
argument_list|(
name|val64
operator|&
name|VXGE_HAL_TITAN_GENERAL_INT_STATUS_MRPCIM_ALARM_INT
argument_list|)
condition|)
block|{
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_TITAN_GENERAL_INT_STATUS_MRPCIM_ALARM_INT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|ret_val
operator|=
name|VXGE_HAL_ERR_CRITICAL
expr_stmt|;
goto|goto
name|exit
goto|;
block|}
if|if
condition|(
name|vxge_os_unlikely
argument_list|(
name|val64
operator|&
name|VXGE_HAL_TITAN_GENERAL_INT_STATUS_SRPCIM_ALARM_INT
argument_list|)
condition|)
block|{
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_TITAN_GENERAL_INT_STATUS_SRPCIM_ALARM_INT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|ret_val
operator|=
name|VXGE_HAL_ERR_CRITICAL
expr_stmt|;
goto|goto
name|exit
goto|;
block|}
if|if
condition|(
name|vxge_os_unlikely
argument_list|(
name|val64
operator|&
name|VXGE_HAL_TITAN_GENERAL_INT_STATUS_VPATH_ALARM_INT
argument_list|)
condition|)
block|{
name|vxge_hal_info_log_vpath_irq
argument_list|(
literal|"%s:VXGE_HAL_TITAN_GENERAL_INT_STATUS_VPATH_ALARM_INT"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|ret_val
operator|=
name|__hal_vpath_alarm_process
argument_list|(
name|vpath
argument_list|,
name|skip_alarms
argument_list|)
expr_stmt|;
block|}
name|exit
label|:
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret_val
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_continue_irq - Continue handling IRQ:	process	all  *				completed descriptors.  * @vpath_handle: Virtual Path handle.  *  * Process completed descriptors and unmask the	vpath interrupts.  *  * The vxge_hal_vpath_continue_irq() calls upper-layer driver (ULD)  * via supplied completion callback.  *  * Note	that the vxge_hal_vpath_continue_irq is	part of	the _fast_ path.  * To optimize the processing, the function does _not_ check for  * errors and alarms.  *  * Returns: VXGE_HAL_OK.  *  * See also: vxge_hal_vpath_handle_irq()  * vxge_hal_ring_rxd_next_completed(),  * vxge_hal_fifo_txdl_next_completed(), vxge_hal_ring_callback_f {},  * vxge_hal_fifo_callback_f {}.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_continue_irq
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u32
name|got_rx
init|=
literal|1
decl_stmt|,
name|got_tx
init|=
literal|1
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|u32
name|isr_polling_cnt
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|isr_polling_cnt
operator|=
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|isr_polling_cnt
expr_stmt|;
do|do
block|{
if|if
condition|(
name|got_rx
operator|&&
operator|(
name|vp
operator|->
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
operator|)
condition|)
operator|(
name|void
operator|)
name|vxge_hal_vpath_poll_rx
argument_list|(
name|vpath_handle
argument_list|,
operator|&
name|got_rx
argument_list|)
expr_stmt|;
if|if
condition|(
name|got_tx
operator|&&
operator|(
name|vp
operator|->
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
operator|)
condition|)
operator|(
name|void
operator|)
name|vxge_hal_vpath_poll_tx
argument_list|(
name|vpath_handle
argument_list|,
operator|&
name|got_tx
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|got_rx
operator|&&
operator|!
name|got_tx
condition|)
break|break;
block|}
do|while
condition|(
name|isr_polling_cnt
operator|--
condition|)
do|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_handle_irq - Handle vpath IRQ.  * @vpath_handle: Virtual Path handle.  * @skip_alarms: Do not clear the alarms  *  * Perform the complete	handling of the	line interrupt.	The function  * performs two	calls.  * First it uses vxge_hal_vpath_begin_irq() to check the reason for  * the interrupt and mask the vpath interrupts.  * Second, it calls vxge_hal_vpath_continue_irq() to process all  * completed descriptors and re-enable the interrupts.  *  * Returns: VXGE_HAL_OK - success;  * VXGE_HAL_ERR_WRONG_IRQ - (shared) IRQ produced by other device.  *  * See also: vxge_hal_vpath_begin_irq(), vxge_hal_vpath_continue_irq().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_handle_irq
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|skip_alarms
parameter_list|)
block|{
name|u64
name|reason
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|vxge_hal_vpath_mask_all
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_vpath_begin_irq
argument_list|(
name|vpath_handle
argument_list|,
name|skip_alarms
argument_list|,
operator|&
name|reason
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_vpath_unmask_all
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
name|reason
operator|&
name|VXGE_HAL_INTR_ALARM
condition|)
block|{
if|if
condition|(
name|skip_alarms
condition|)
block|{
comment|/* ULD needs to unmask explicitely */
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_CRITICAL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_CRITICAL
operator|)
return|;
block|}
else|else
block|{
name|vxge_hal_vpath_unmask_all
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
if|if
condition|(
name|reason
operator|&
name|VXGE_HAL_INTR_RX
condition|)
name|vxge_hal_vpath_clear_rx
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_vpath_continue_irq
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_vpath_clear_tx
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_vpath_unmask_all
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mask_tx - Mask Tx interrupts.  * @vpath_handle: Virtual Path handle.  *  * Mask	Tx device interrupts.  *  * See also: vxge_hal_vpath_unmask_tx(), vxge_hal_vpath_mask_rx(),  * vxge_hal_vpath_clear_tx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mask_tx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_clear_tx - Acknowledge (that is, clear) the  * condition that has caused the TX interrupt.  * @vpath_handle: Virtual Path handle.  *  * Acknowledge (that is, clear)	the condition that has caused  * the Tx interrupt.  * See also: vxge_hal_vpath_begin_irq(), vxge_hal_vpath_continue_irq(),  * vxge_hal_vpath_clear_rx(), vxge_hal_vpath_mask_tx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_clear_tx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_status0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_status1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_unmask_tx - Unmask Tx	interrupts.  * @vpath_handle: Virtual Path handle.  *  * Unmask Tx vpath interrupts.  *  * See also: vxge_hal_vpath_mask_tx(), vxge_hal_vpath_clear_tx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_unmask_tx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_AVAILABLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mask_rx - Mask Rx	interrupts.  * @vpath_handle: Virtual Path handle.  *  * Mask	Rx vpath interrupts.  *  * See also: vxge_hal_vpath_unmask_rx(), vxge_hal_vpath_mask_tx(),  * vxge_hal_vpath_clear_rx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mask_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_clear_rx - Acknowledge (that is, clear) the  * condition that has caused the RX	interrupt.  * @vpath_handle: Virtual Path handle.  *  * Acknowledge (that is, clear)	the condition that has caused  * the Rx interrupt.  * See also: vxge_hal_vpath_begin_irq(), vxge_hal_vpath_continue_irq(),  * vxge_hal_vpath_clear_tx(), vxge_hal_vpath_mask_rx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_clear_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_status0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_status1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_unmask_rx - Unmask Rx	interrupts.  * @vpath_handle: Virtual Path handle.  *  * Unmask Rx vpath interrupts.  *  * See also: vxge_hal_vpath_mask_rx(), vxge_hal_vpath_clear_rx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_unmask_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mask_tx_rx - Mask Tx and Rx interrupts.  * @vpath_handle: Virtual Path handle.  *  * Mask	Tx and Rx vpath interrupts.  *  * See also: vxge_hal_vpath_unmask_tx_rx(), vxge_hal_vpath_clear_tx_rx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mask_tx_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
operator||
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|)
operator||
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_clear_tx_rx - Acknowledge (that is, clear) the  * condition that has caused the Tx and RX interrupt.  * @vpath_handle: Virtual Path handle.  *  * Acknowledge (that is, clear)	the condition that has caused  * the Tx and Rx interrupt.  * See also: vxge_hal_vpath_begin_irq(), vxge_hal_vpath_continue_irq(),  * vxge_hal_vpath_clear_tx_rx(), vxge_hal_vpath_mask_tx_rx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_clear_tx_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
name|val64
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
condition|)
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_status0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
condition|)
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_status1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_unmask_tx_rx - Unmask Tx and Rx interrupts.  * @vpath_handle: Virtual Path handle.  *  * Unmask Tx and Rx vpath interrupts.  *  * See also: vxge_hal_vpath_mask_tx_rx(), vxge_hal_vpath_clear_tx_rx().  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_unmask_tx_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_id
operator|<
literal|16
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
condition|)
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
else|else
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
name|val64
operator|&=
operator|~
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
else|else
name|val64
operator||=
name|vBIT
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|,
operator|(
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
condition|)
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|)
expr_stmt|;
else|else
name|val64
operator||=
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_TX
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|)
expr_stmt|;
else|else
name|val64
operator||=
name|VXGE_HAL_TIM_INT_MASK1_TIM_INT_MASK1
argument_list|(
name|VXGE_HAL_INTR_RX
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|tim_int_mask1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_alarm_process - Process Alarms.  * @vpath: Virtual Path.  * @skip_alarms: Do not clear the alarms  *  * Process vpath alarms.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_alarm_process
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|skip_alarms
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_alarm_process
argument_list|(
name|vp
operator|->
name|vpath
argument_list|,
name|skip_alarms
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_msix_mode - Is MSIX enabled?  * @vpath_handle: Virtual Path handle.  *  * Returns 0 if MSI is enabled for the specified device,  * non-zero otherwise.  */
end_comment

begin_function
name|u32
name|vxge_hal_vpath_msix_mode
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|hldev
operator|->
name|header
operator|.
name|msix_enabled
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_msix_set  * Associate MSIX vectors with TIM interrupts and alrms  * @vpath_handle: Virtual Path handle.  * @tim_msix_id: MSIX vectors associated with VXGE_HAL_VPATH_MSIX_MAX number of  *		interrupts(Can be repeated). If fifo or ring are not enabled  *		the MSIX vector for that should be set to 0  * @alarm_msix_id: MSIX vector for alarm.  *  * This API will associate a given MSIX vector numbers with the four TIM  * interrupts and alarm interrupt.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_msix_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
modifier|*
name|tim_msix_id
parameter_list|,
name|int
name|alarm_msix_id
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u32
name|j
decl_stmt|;
name|u32
name|rvp_id
decl_stmt|;
name|u32
name|msix_id
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"tim_msix_id0 = %d, tim_msix_id1 = %d, tim_msix_id2 = %d, "
literal|"tim_msix_id3 = %d, alarm_msix_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|tim_msix_id
index|[
literal|0
index|]
argument_list|,
name|tim_msix_id
index|[
literal|1
index|]
argument_list|,
name|tim_msix_id
index|[
literal|2
index|]
argument_list|,
name|tim_msix_id
index|[
literal|3
index|]
argument_list|,
name|alarm_msix_id
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_VPATH_MSIX_MAX
operator|+
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
name|VXGE_HAL_VPATH_MSIX_MAX
condition|)
name|msix_id
operator|=
name|alarm_msix_id
expr_stmt|;
else|else
name|msix_id
operator|=
name|tim_msix_id
index|[
name|i
index|]
expr_stmt|;
name|rvp_id
operator|=
name|msix_id
operator|/
name|VXGE_HAL_VPATH_MSIX_MAX
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|VXGE_HAL_MAX_VIRTUAL_PATHS
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|vpath_assignments
operator|&
name|mBIT
argument_list|(
name|j
argument_list|)
operator|)
condition|)
continue|continue;
if|if
condition|(
name|rvp_id
operator|--
operator|==
literal|0
condition|)
block|{
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|vp_id
operator|=
name|j
expr_stmt|;
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|int_num
operator|=
name|msix_id
operator|%
name|VXGE_HAL_VPATH_MSIX_MAX
expr_stmt|;
break|break;
block|}
block|}
block|}
name|val64
operator|=
name|VXGE_HAL_INTERRUPT_CFG0_GROUP0_MSIX_FOR_TXTI
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|0
index|]
index|]
operator|.
name|vp_id
operator|*
name|VXGE_HAL_VPATH_MSIX_MAX
operator|+
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|0
index|]
index|]
operator|.
name|int_num
argument_list|)
operator||
name|VXGE_HAL_INTERRUPT_CFG0_GROUP1_MSIX_FOR_TXTI
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|1
index|]
index|]
operator|.
name|vp_id
operator|*
name|VXGE_HAL_VPATH_MSIX_MAX
operator|+
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|1
index|]
index|]
operator|.
name|int_num
argument_list|)
operator||
name|VXGE_HAL_INTERRUPT_CFG0_GROUP2_MSIX_FOR_TXTI
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|2
index|]
index|]
operator|.
name|vp_id
operator|*
name|VXGE_HAL_VPATH_MSIX_MAX
operator|+
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|2
index|]
index|]
operator|.
name|int_num
argument_list|)
operator||
name|VXGE_HAL_INTERRUPT_CFG0_GROUP3_MSIX_FOR_TXTI
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|3
index|]
index|]
operator|.
name|vp_id
operator|*
name|VXGE_HAL_VPATH_MSIX_MAX
operator|+
name|hldev
operator|->
name|msix_map
index|[
name|tim_msix_id
index|[
literal|3
index|]
index|]
operator|.
name|int_num
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|interrupt_cfg0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTERRUPT_CFG2_ALARM_MAP_TO_MSG
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|alarm_msix_id
index|]
operator|.
name|vp_id
operator|*
name|VXGE_HAL_VPATH_MSIX_MAX
operator|+
name|hldev
operator|->
name|msix_map
index|[
name|alarm_msix_id
index|]
operator|.
name|int_num
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|interrupt_cfg2
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_MSIX_ONE_SHOT
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT0_EN_ONE_SHOT_VECT0_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect0_en
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT1_EN_ONE_SHOT_VECT1_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect1_en
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT2_EN_ONE_SHOT_VECT2_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect2_en
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT3_EN_ONE_SHOT_VECT3_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect3_en
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
condition|)
block|{
comment|/* For emulated-INTA we are only using MSI-X 1 to be one shot */
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT1_EN_ONE_SHOT_VECT1_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect1_en
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_msix_mask - Mask MSIX Vector.  * @vpath_handle: Virtual Path handle.  * @msix_id:  MSIX ID  *  * The function masks the msix interrupt for the given msix_id  *  * Note:  *  * Returns: 0,  * Otherwise, VXGE_HAL_ERR_WRONG_IRQ if the msix index is out of range  * status.  * See also:  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_msix_mask
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
name|msix_id
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", msix_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|msix_id
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|vp_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|set_msix_mask_vect
index|[
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|int_num
index|]
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_msix_clear - Clear MSIX Vector.  * @vpath_handle: Virtual Path handle.  * @msix_id:  MSI ID  *  * The function clears the msix interrupt for the given msix_id  *  * Note:  *  * Returns: 0,  * Otherwise, VXGE_HAL_ERR_WRONG_IRQ if the msix index is out of range  * status.  * See also:  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_msix_clear
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
name|msix_id
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", msix_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|msix_id
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_MSIX_ONE_SHOT
operator|)
operator|||
operator|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
operator|)
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|vp_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|clr_msix_one_shot_vec
index|[
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|int_num
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
condition|)
block|{
comment|/* Adding read to flush the write, 			 * for HP-ISS platform 			 */
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|titan_general_int_status
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|vp_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|clear_msix_mask_vect
index|[
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|int_num
index|]
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* NEW CODE BEGIN */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mf_msix_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
modifier|*
name|tim_msix_id
parameter_list|,
name|int
name|alarm_msix_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
comment|/* Write the internal msi-x vectors numbers */
name|val64
operator|=
name|VXGE_HAL_INTERRUPT_CFG0_GROUP0_MSIX_FOR_TXTI
argument_list|(
name|tim_msix_id
index|[
literal|0
index|]
argument_list|)
operator||
name|VXGE_HAL_INTERRUPT_CFG0_GROUP1_MSIX_FOR_TXTI
argument_list|(
name|tim_msix_id
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_EMULATED_INTA
argument_list|)
if|if
condition|(
name|hldev
operator|->
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
condition|)
name|val64
operator||=
name|VXGE_HAL_INTERRUPT_CFG0_GROUP2_MSIX_FOR_TXTI
argument_list|(
operator|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
operator|*
literal|4
operator|)
operator|+
name|tim_msix_id
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|interrupt_cfg0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|interrupt_cfg0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTERRUPT_CFG2_ALARM_MAP_TO_MSG
argument_list|(
operator|(
name|hldev
operator|->
name|first_vp_id
operator|*
literal|4
operator|)
operator|+
name|alarm_msix_id
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|interrupt_cfg2
argument_list|)
expr_stmt|;
if|if
condition|(
if|#
directive|if
name|defined
argument_list|(
name|VXGE_EMULATED_INTA
argument_list|)
operator|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
operator|)
operator|||
endif|#
directive|endif
operator|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_MSIX_ONE_SHOT
operator|)
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT1_EN_ONE_SHOT_VECT1_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect1_en
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_MSIX_ONE_SHOT
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT2_EN_ONE_SHOT_VECT2_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect2_en
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_ONE_SHOT_VECT3_EN_ONE_SHOT_VECT3_EN
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|one_shot_vect3_en
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mf_msix_mask - Mask MSIX Vector.  * @vp: Virtual Path handle.  * @msix_id:  MSIX ID  *  * The function masks the msix interrupt for the given msix_id  *  * Returns: 0,  * Otherwise, VXGE_HW_ERR_WRONG_IRQ if the msix index is out of range  * status.  * See also:  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mf_msix_mask
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
name|msix_id
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|msix_id
operator|>>
literal|2
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|hldev
operator|->
name|common_reg
operator|->
name|set_msix_mask_vect
index|[
name|msix_id
operator|%
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mf_msix_clear - Clear MSIX Vector.  * @vp: Virtual Path handle.  * @msix_id:  MSI ID  *  * The function clears the msix interrupt for the given msix_id  *  * Returns: 0,  * Otherwise, VXGE_HW_ERR_WRONG_IRQ if the msix index is out of range  * status.  * See also:  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mf_msix_clear
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
name|msix_id
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
if|if
condition|(
if|#
directive|if
name|defined
argument_list|(
name|VXGE_EMULATED_INTA
argument_list|)
operator|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
operator|)
operator|||
endif|#
directive|endif
operator|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_MSIX_ONE_SHOT
operator|)
condition|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
operator|(
name|msix_id
operator|>>
literal|2
operator|)
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|clr_msix_one_shot_vec
index|[
name|msix_id
operator|%
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
operator|(
name|msix_id
operator|>>
literal|2
operator|)
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|clear_msix_mask_vect
index|[
name|msix_id
operator|%
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mf_msix_unmask - Unmask the MSIX Vector.  * @vp: Virtual Path handle.  * @msix_id:  MSI ID  *  * The function unmasks the msix interrupt for the given msix_id  *  * Returns: 0,  * Otherwise, VXGE_HW_ERR_WRONG_IRQ if the msix index is out of range  * status.  * See also:  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_mf_msix_unmask
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
name|msix_id
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|msix_id
operator|>>
literal|2
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|hldev
operator|->
name|common_reg
operator|->
name|clear_msix_mask_vect
index|[
name|msix_id
operator|%
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* NEW CODE ENDS */
end_comment

begin_comment
comment|/*  * vxge_hal_vpath_msix_unmask - Unmask the MSIX Vector.  * @vpath_handle: Virtual Path handle.  * @msix_id:  MSI ID  *  * The function unmasks the msix interrupt for the given msix_id  *  * Note:  *  * Returns: 0,  * Otherwise, VXGE_HAL_ERR_WRONG_IRQ if the msix index is out of range  * status.  * See also:  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_msix_unmask
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|int
name|msix_id
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", msix_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
name|msix_id
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|vp_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|clear_msix_mask_vect
index|[
name|hldev
operator|->
name|msix_map
index|[
name|msix_id
index|]
operator|.
name|int_num
index|]
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_msix_mask_all - Mask all MSIX vectors for the vpath.  * @vpath_handle: Virtual Path handle.  *  * The function masks all msix interrupt for the given vpath  *  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_msix_mask_all
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|set_msix_mask_all_vect
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_msix_unmask_all - Unmask all MSIX vectors for the vpath.  * @vpath_handle: Virtual Path handle.  *  * The function unmasks the msix interrupt for the given vpath  *  */
end_comment

begin_function
name|void
name|vxge_hal_vpath_msix_unmask_all
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|mBIT
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|clear_msix_mask_all_vect
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_poll_rx - Poll Rx Virtual Path for completed  *			descriptors and process the same.  * @vpath_handle: Virtual Path ahandle.  * @got_rx: Buffer to return the flag set if receive interrupt is occurred  *  * The function	polls the Rx for the completed	descriptors and	calls  * the upper-layer driver (ULD)	via supplied completion	callback.  *  * Returns: VXGE_HAL_OK, if the polling is completed successful.  * VXGE_HAL_COMPLETIONS_REMAIN: There are still more completed  * descriptors available which are yet to be processed.  *  * See also: vxge_hal_vpath_poll_tx()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_poll_rx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
modifier|*
name|got_rx
parameter_list|)
block|{
name|u8
name|t_code
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_hal_rxd_h
name|first_rxdh
decl_stmt|;
name|void
modifier|*
name|rxd_priv
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_ring_t
modifier|*
name|ring
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|got_rx
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpathh = 0x"
name|VXGE_OS_STXFMT
literal|", got_rx = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|got_rx
argument_list|)
expr_stmt|;
name|ring
operator|=
operator|(
name|__hal_ring_t
operator|*
operator|)
name|vpath
operator|->
name|ringh
expr_stmt|;
if|if
condition|(
name|ring
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|ring
operator|->
name|cmpl_cnt
operator|=
literal|0
expr_stmt|;
name|ring
operator|->
name|channel
operator|.
name|poll_bytes
operator|=
literal|0
expr_stmt|;
operator|*
name|got_rx
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|=
name|vxge_hal_ring_rxd_next_completed
argument_list|(
name|vpath_handle
argument_list|,
operator|&
name|first_rxdh
argument_list|,
operator|&
name|rxd_priv
argument_list|,
operator|&
name|t_code
argument_list|)
operator|)
operator|==
name|VXGE_HAL_OK
condition|)
block|{
if|if
condition|(
name|ring
operator|->
name|callback
argument_list|(
name|vpath_handle
argument_list|,
name|first_rxdh
argument_list|,
name|rxd_priv
argument_list|,
name|t_code
argument_list|,
name|ring
operator|->
name|channel
operator|.
name|userdata
argument_list|)
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_COMPLETIONS_REMAIN
expr_stmt|;
block|}
operator|(
operator|*
name|got_rx
operator|)
operator|++
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_poll_tx - Poll Tx for completed descriptors and process  *			the same.  * @vpath_handle: Virtual Path ahandle.  * @got_tx: Buffer to return the flag set if transmit interrupt is occurred  *  * The function	polls the Tx for the completed	descriptors and	calls  * the upper-layer driver (ULD)	via supplied completion callback.  *  * Returns: VXGE_HAL_OK, if the polling is completed successful.  * VXGE_HAL_COMPLETIONS_REMAIN: There are still more completed  * descriptors available which are yet to be processed.  *  * See also: vxge_hal_vpath_poll_rx().  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_poll_tx
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
modifier|*
name|got_tx
parameter_list|)
block|{
name|vxge_hal_fifo_tcode_e
name|t_code
decl_stmt|;
name|vxge_hal_txdl_h
name|first_txdlh
decl_stmt|;
name|void
modifier|*
name|txdl_priv
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_fifo_t
modifier|*
name|fifo
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|got_tx
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"vpathh = 0x"
name|VXGE_OS_STXFMT
literal|", got_tx = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|got_tx
argument_list|)
expr_stmt|;
name|fifo
operator|=
operator|(
name|__hal_fifo_t
operator|*
operator|)
name|vpath
operator|->
name|fifoh
expr_stmt|;
if|if
condition|(
name|fifo
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|fifo
operator|->
name|channel
operator|.
name|poll_bytes
operator|=
literal|0
expr_stmt|;
operator|*
name|got_tx
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|=
name|vxge_hal_fifo_txdl_next_completed
argument_list|(
name|vpath_handle
argument_list|,
operator|&
name|first_txdlh
argument_list|,
operator|&
name|txdl_priv
argument_list|,
operator|&
name|t_code
argument_list|)
operator|)
operator|==
name|VXGE_HAL_OK
condition|)
block|{
if|if
condition|(
name|fifo
operator|->
name|callback
argument_list|(
name|vpath_handle
argument_list|,
name|first_txdlh
argument_list|,
name|txdl_priv
argument_list|,
name|t_code
argument_list|,
name|fifo
operator|->
name|channel
operator|.
name|userdata
argument_list|)
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_COMPLETIONS_REMAIN
expr_stmt|;
block|}
operator|(
operator|*
name|got_tx
operator|)
operator|++
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath_irq
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_mgmt_read  * @hldev: HAL device  * @vpath: Virtual path structure  *  * This routine reads the vpath_mgmt registers  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_mgmt_read
parameter_list|(
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|mtu
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|hldev
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|vpath
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
literal|", vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sess_grps_available
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|sgrp_own
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|vpath_is_first
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|is_first_vpath
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_IS_FIRST_GET_VPATH_IS_FIRST
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|tim_vpath_assignment
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|bmap_root_assigned
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_TIM_VPATH_ASSIGNMENT_GET_BMAP_ROOT
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|mtu
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_MAC_MAX_WIRE_PORTS
condition|;
name|i
operator|++
control|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|rxmac_cfg0_port_vpmgmt_clone
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|mtu
operator|<
operator|(
name|u32
operator|)
name|VXGE_HAL_RXMAC_CFG0_PORT_VPMGMT_CLONE_GET_MAX_PYLD_LEN
argument_list|(
name|val64
argument_list|)
condition|)
block|{
name|mtu
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RXMAC_CFG0_PORT_VPMGMT_CLONE_GET_MAX_PYLD_LEN
argument_list|(
name|val64
argument_list|)
expr_stmt|;
block|}
block|}
name|vpath
operator|->
name|max_mtu
operator|=
name|mtu
operator|+
name|VXGE_HAL_MAC_HEADER_MAX_SIZE
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|xmac_vsport_choices_vp
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vsport_choices
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_XMAC_VSPORT_CHOICES_VP_GET_VSPORT_VECTOR
argument_list|(
name|val64
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_MAX_VIRTUAL_PATHS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|val64
operator|&
name|mBIT
argument_list|(
name|i
argument_list|)
condition|)
name|vpath
operator|->
name|vsport_number
operator|=
name|i
expr_stmt|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vpmgmt_reg
operator|->
name|xgmac_gen_status_vpmgmt_clone
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_XGMAC_GEN_STATUS_VPMGMT_CLONE_XMACJ_NTWK_OK
condition|)
block|{
name|VXGE_HAL_DEVICE_LINK_STATE_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|VXGE_HAL_LINK_UP
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|VXGE_HAL_DEVICE_LINK_STATE_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|VXGE_HAL_LINK_DOWN
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_XGMAC_GEN_STATUS_VPMGMT_CLONE_XMACJ_NTWK_DATA_RATE
condition|)
block|{
name|VXGE_HAL_DEVICE_DATA_RATE_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|VXGE_HAL_DATA_RATE_10G
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|VXGE_HAL_DEVICE_DATA_RATE_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|VXGE_HAL_DATA_RATE_1G
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_reset_check - Check if resetting the vpath completed  *  * @vpath: Virtual Path  *  * This routine checks the vpath_rst_in_prog register to see if adapter  * completed the reset process for the vpath  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_reset_check
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|vpath_rst_in_prog
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_VPATH_RST_IN_PROG_VPATH_RST_IN_PROG
argument_list|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
argument_list|)
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_hw_reset  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine resets the vpath on the device  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_hw_reset
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_CMN_RSTHDLR_CFG0_SW_RESET_VPATH
argument_list|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vp_id
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|cmn_rsthdlr_cfg0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_ifmsg_wmsg_post
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_MSG_DEST_BROADCAST
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MSG_TYPE_VPATH_RESET_BEGIN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_sw_reset  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine resets the vpath structures  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_sw_reset
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
condition|)
block|{
name|status
operator|=
name|__hal_ring_reset
argument_list|(
name|vpath
operator|->
name|ringh
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
if|if
condition|(
name|vpath
operator|->
name|fifoh
condition|)
block|{
name|status
operator|=
name|__hal_fifo_reset
argument_list|(
name|vpath
operator|->
name|fifoh
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_enable  * @vpath_handle: Handle to the vpath object  *  * This routine clears the vpath reset and puts vpath in service  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_CMN_RSTHDLR_CFG1_CLR_VPATH_RESET
argument_list|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|cmn_rsthdlr_cfg1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_ifmsg_wmsg_post
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_MSG_DEST_BROADCAST
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MSG_TYPE_VPATH_RESET_END
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|VXGE_HAL_RING_POST_DOORBELL
argument_list|(
name|vpath_handle
argument_list|,
name|vpath
operator|->
name|ringh
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_prc_configure  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine configures the prc registers of virtual path  * using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_prc_configure
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_vp_config_t
modifier|*
name|vp_config
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vp_config
operator|=
name|vpath
operator|->
name|vp_config
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg1
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|rx_timer_val
operator|!=
name|VXGE_HAL_RING_USE_FLASH_DEFAULT_RX_TIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG1_RX_TIMER_VAL
argument_list|(
literal|0x1fffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_PRC_CFG1_RX_TIMER_VAL
argument_list|(
name|vp_config
operator|->
name|ring
operator|.
name|rx_timer_val
argument_list|)
expr_stmt|;
block|}
name|val64
operator||=
name|VXGE_HAL_PRC_CFG1_RTI_TINT_DISABLE
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|greedy_return
operator|!=
name|VXGE_HAL_RING_GREEDY_RETURN_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|greedy_return
condition|)
name|val64
operator||=
name|VXGE_HAL_PRC_CFG1_GREEDY_RETURN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG1_GREEDY_RETURN
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|rx_timer_ci
operator|!=
name|VXGE_HAL_RING_RX_TIMER_CI_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|rx_timer_ci
condition|)
name|val64
operator||=
name|VXGE_HAL_PRC_CFG1_RX_TIMER_CI
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG1_RX_TIMER_CI
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg1
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg7
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|scatter_mode
operator|!=
name|VXGE_HAL_RING_SCATTER_MODE_USE_FLASH_DEFAULT
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE
argument_list|(
literal|0x3
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|scatter_mode
condition|)
block|{
case|case
name|VXGE_HAL_RING_SCATTER_MODE_A
case|:
name|val64
operator||=
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE
argument_list|(
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE_A
argument_list|)
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_RING_SCATTER_MODE_B
case|:
name|val64
operator||=
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE
argument_list|(
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE_B
argument_list|)
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_RING_SCATTER_MODE_C
case|:
name|val64
operator||=
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE
argument_list|(
name|VXGE_HAL_PRC_CFG7_SCATTER_MODE_C
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg7
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg6
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|post_mode
operator|!=
name|VXGE_HAL_RING_POST_MODE_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|post_mode
operator|==
name|VXGE_HAL_RING_POST_MODE_DOORBELL
condition|)
name|val64
operator||=
name|VXGE_HAL_PRC_CFG6_DOORBELL_MODE_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG6_DOORBELL_MODE_EN
expr_stmt|;
block|}
else|else
block|{
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|post_mode
operator|=
operator|(
operator|(
name|val64
operator|&
name|VXGE_HAL_PRC_CFG6_DOORBELL_MODE_EN
operator|)
condition|?
name|VXGE_HAL_RING_POST_MODE_DOORBELL
else|:
name|VXGE_HAL_RING_POST_MODE_LEGACY
operator|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg6
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_PRC_CFG5_RXD0_ADD
argument_list|(
name|__hal_ring_first_block_address_get
argument_list|(
name|vpath
operator|->
name|ringh
argument_list|)
operator|>>
literal|3
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg5
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg4
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_IN_SVC
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG4_RING_MODE
argument_list|(
literal|0x3
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|buffer_mode
operator|==
name|VXGE_HAL_RING_RXD_BUFFER_MODE_1
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_RING_MODE
argument_list|(
name|VXGE_HAL_PRC_CFG4_RING_MODE_ONE_BUFFER
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|buffer_mode
operator|==
name|VXGE_HAL_RING_RXD_BUFFER_MODE_3
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_RING_MODE
argument_list|(
name|VXGE_HAL_PRC_CFG4_RING_MODE_THREE_BUFFER
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_RING_MODE
argument_list|(
name|VXGE_HAL_PRC_CFG4_RING_MODE_FIVE_BUFFER
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|no_snoop_bits
operator|!=
name|VXGE_HAL_RING_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
name|val64
operator|&=
operator|~
operator|(
name|VXGE_HAL_PRC_CFG4_FRM_NO_SNOOP
operator||
name|VXGE_HAL_PRC_CFG4_RXD_NO_SNOOP
operator|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|no_snoop_bits
operator|==
name|VXGE_HAL_RING_NO_SNOOP_RXD
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_RXD_NO_SNOOP
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|no_snoop_bits
operator|==
name|VXGE_HAL_RING_NO_SNOOP_FRM
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_FRM_NO_SNOOP
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|no_snoop_bits
operator|==
name|VXGE_HAL_RING_NO_SNOOP_ALL
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_FRM_NO_SNOOP
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_RXD_NO_SNOOP
expr_stmt|;
block|}
block|}
block|}
block|}
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|rth_en
operator|==
name|VXGE_HAL_RTH_DISABLE
condition|)
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_RTH_DISABLE
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG4_RTH_DISABLE
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_SIGNAL_BENIGN_OVFLW
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_BIMODAL_INTERRUPT
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|backoff_interval_us
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_BACKOFF_INTERVAL_US
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_PRC_CFG4_BACKOFF_INTERVAL
argument_list|(
literal|0xffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_PRC_CFG4_BACKOFF_INTERVAL
argument_list|(
name|vp_config
operator|->
name|ring
operator|.
name|backoff_interval_us
operator|*
literal|1000
operator|/
literal|4
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg4
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_kdfc_configure  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine configures the kdfc registers of virtual path  * using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_kdfc_configure
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|u64
name|vpath_stride
decl_stmt|;
name|u64
name|fifo_stride
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_kdfc_swapper_set
argument_list|(
operator|(
name|vxge_hal_device_t
operator|*
operator|)
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|post_mode
operator|==
name|VXGE_HAL_RING_POST_MODE_DOORBELL
operator|)
operator|&&
operator|(
name|vxge_hal_device_check_id
argument_list|(
name|devh
argument_list|)
operator|==
name|VXGE_HAL_CARD_TITAN_1
operator|)
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxdmem_size
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|rxd_mem_size
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RXDMEM_SIZE_PRC_RXDMEM_SIZE
argument_list|(
name|val64
argument_list|)
operator|*
literal|8
expr_stmt|;
block|}
else|else
block|{
name|vpath
operator|->
name|rxd_mem_size
operator|=
operator|(
name|VXGE_HAL_MAX_RING_LENGTH
operator|/
name|vxge_hal_ring_rxds_per_block_get
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|buffer_mode
argument_list|)
operator|)
operator|*
name|VXGE_OS_HOST_PAGE_SIZE
expr_stmt|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_drbl_triplet_total
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|max_kdfc_db
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_KDFC_DRBL_TRIPLET_TOTAL_GET_KDFC_MAX_SIZE
argument_list|(
name|val64
operator|+
literal|1
argument_list|)
operator|/
literal|2
expr_stmt|;
name|vpath
operator|->
name|max_ofl_db
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|fifo
operator|.
name|enable
operator|==
name|VXGE_HAL_FIFO_ENABLE
condition|)
block|{
name|vpath
operator|->
name|max_nofl_db
operator|=
name|vpath
operator|->
name|max_kdfc_db
operator|-
literal|1
expr_stmt|;
name|vpath
operator|->
name|max_msg_db
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|max_nofl_db
operator|<
name|vpath
operator|->
name|vp_config
operator|->
name|fifo
operator|.
name|fifo_length
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_BADCFG_FIFO_LENGTH
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_BADCFG_FIFO_LENGTH
operator|)
return|;
block|}
block|}
else|else
block|{
name|vpath
operator|->
name|max_nofl_db
operator|=
literal|0
expr_stmt|;
name|vpath
operator|->
name|max_msg_db
operator|=
name|vpath
operator|->
name|max_kdfc_db
expr_stmt|;
block|}
name|val64
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|max_nofl_db
condition|)
name|val64
operator||=
name|VXGE_HAL_KDFC_FIFO_TRPL_PARTITION_LENGTH_0
argument_list|(
operator|(
name|vpath
operator|->
name|max_nofl_db
operator|*
literal|2
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|max_msg_db
condition|)
name|val64
operator||=
name|VXGE_HAL_KDFC_FIFO_TRPL_PARTITION_LENGTH_1
argument_list|(
operator|(
name|vpath
operator|->
name|max_msg_db
operator|*
literal|2
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_fifo_trpl_partition
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_KDFC_FIFO_TRPL_CTRL_TRIPLET_ENABLE
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_fifo_trpl_ctrl
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_0_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|max_nofl_db
condition|)
block|{
name|val64
operator|&=
operator|~
operator|(
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_MODE
argument_list|(
literal|0x3
argument_list|)
operator||
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_SELECT
argument_list|(
literal|0xFF
argument_list|)
operator|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_MODE
argument_list|(
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_MODE_NON_OFFLOAD_ONLY
argument_list|)
operator||
if|#
directive|if
operator|!
name|defined
argument_list|(
name|VXGE_OS_HOST_BIG_ENDIAN
argument_list|)
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_SWAP_EN
operator||
endif|#
directive|endif
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_SELECT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
operator|!=
name|VXGE_HAL_VPATH_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
condition|)
name|val64
operator||=
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_NO_SNOOP
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_KDFC_TRPL_FIFO_0_CTRL_NO_SNOOP
expr_stmt|;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_0_ctrl
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_1_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|max_msg_db
condition|)
block|{
name|val64
operator|&=
operator|~
operator|(
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_MODE
argument_list|(
literal|0x3
argument_list|)
operator||
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_SELECT
argument_list|(
literal|0xFF
argument_list|)
operator|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_MODE
argument_list|(
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_MODE_MESSAGES_ONLY
argument_list|)
operator||
if|#
directive|if
operator|!
name|defined
argument_list|(
name|VXGE_OS_HOST_BIG_ENDIAN
argument_list|)
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_SWAP_EN
operator||
endif|#
directive|endif
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_SELECT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
operator|!=
name|VXGE_HAL_VPATH_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
condition|)
name|val64
operator||=
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_NO_SNOOP
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_KDFC_TRPL_FIFO_1_CTRL_NO_SNOOP
expr_stmt|;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_1_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_2_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_0_wb_address
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_1_wb_address
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|kdfc_trpl_fifo_2_wb_address
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vpath_stride
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|toc_reg
operator|->
name|toc_kdfc_vpath_stride
argument_list|)
expr_stmt|;
name|fifo_stride
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|toc_reg
operator|->
name|toc_kdfc_fifo_stride
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|nofl_db
operator|=
operator|(
name|__hal_non_offload_db_wrapper_t
operator|*
operator|)
operator|(
operator|(
name|void
operator|*
operator|)
operator|(
name|hldev
operator|->
name|kdfc
operator|+
operator|(
name|vp_id
operator|*
name|VXGE_HAL_TOC_KDFC_VPATH_STRIDE_GET_TOC_KDFC_VPATH_STRIDE
argument_list|(
name|vpath_stride
argument_list|)
operator|)
operator|)
operator|)
expr_stmt|;
name|vpath
operator|->
name|msg_db
operator|=
operator|(
name|__hal_messaging_db_wrapper_t
operator|*
operator|)
operator|(
operator|(
name|void
operator|*
operator|)
operator|(
name|hldev
operator|->
name|kdfc
operator|+
operator|(
name|vp_id
operator|*
name|VXGE_HAL_TOC_KDFC_VPATH_STRIDE_GET_TOC_KDFC_VPATH_STRIDE
argument_list|(
name|vpath_stride
argument_list|)
operator|)
operator|+
name|VXGE_HAL_TOC_KDFC_FIFO_STRIDE_GET_TOC_KDFC_FIFO_STRIDE
argument_list|(
name|fifo_stride
argument_list|)
operator|)
operator|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_mac_configure  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine configures the mac of virtual path using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_mac_configure
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_vp_config_t
modifier|*
name|vp_config
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vp_config
operator|=
name|vpath
operator|->
name|vp_config
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_XMAC_VSPORT_CHOICE_VSPORT_NUMBER
argument_list|(
name|vpath
operator|->
name|vsport_number
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_vsport_choice
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_ENABLE
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv4_tcp_incl_ph
operator|!=
name|VXGE_HAL_VPATH_RPA_IPV4_TCP_INCL_PH_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv4_tcp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_TCP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_TCP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv6_tcp_incl_ph
operator|!=
name|VXGE_HAL_VPATH_RPA_IPV6_TCP_INCL_PH_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv6_tcp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_TCP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_TCP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv4_udp_incl_ph
operator|!=
name|VXGE_HAL_VPATH_RPA_IPV4_UDP_INCL_PH_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv4_udp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_UDP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV4_UDP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv6_udp_incl_ph
operator|!=
name|VXGE_HAL_VPATH_RPA_IPV6_UDP_INCL_PH_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_ipv6_udp_incl_ph
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_UDP_INCL_PH
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_IPV6_UDP_INCL_PH
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_l4_incl_cf
operator|!=
name|VXGE_HAL_VPATH_RPA_L4_INCL_CF_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_l4_incl_cf
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_L4_INCL_CF
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_L4_INCL_CF
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_strip_vlan_tag
operator|!=
name|VXGE_HAL_VPATH_RPA_STRIP_VLAN_TAG_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_strip_vlan_tag
condition|)
name|val64
operator||=
name|VXGE_HAL_XMAC_RPA_VCFG_STRIP_VLAN_TAG
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_XMAC_RPA_VCFG_STRIP_VLAN_TAG
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_rpa_vcfg
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|mtu
operator|!=
name|VXGE_HAL_VPATH_USE_FLASH_DEFAULT_INITIAL_MTU
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_RTS_MAX_FRM_LEN
argument_list|(
literal|0x3fff
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|vp_config
operator|->
name|mtu
operator|+
name|VXGE_HAL_MAC_HEADER_MAX_SIZE
operator|)
operator|<
name|vpath
operator|->
name|max_mtu
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_RTS_MAX_FRM_LEN
argument_list|(
name|vp_config
operator|->
name|mtu
operator|+
name|VXGE_HAL_MAC_HEADER_MAX_SIZE
argument_list|)
expr_stmt|;
else|else
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_RTS_MAX_FRM_LEN
argument_list|(
name|vpath
operator|->
name|max_mtu
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|!=
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
condition|)
block|{
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_ENABLE
expr_stmt|;
block|}
else|else
block|{
name|vp_config
operator|->
name|rpa_ucast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_UCAST_ALL_ADDR_DISABLE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|!=
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
condition|)
block|{
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_ENABLE
expr_stmt|;
block|}
else|else
block|{
name|vp_config
operator|->
name|rpa_mcast_all_addr_en
operator|=
name|VXGE_HAL_VPATH_RPA_MCAST_ALL_ADDR_DISABLE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_bcast_en
operator|!=
name|VXGE_HAL_VPATH_RPA_BCAST_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_bcast_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
condition|)
block|{
name|vp_config
operator|->
name|rpa_bcast_en
operator|=
name|VXGE_HAL_VPATH_RPA_BCAST_ENABLE
expr_stmt|;
block|}
else|else
block|{
name|vp_config
operator|->
name|rpa_bcast_en
operator|=
name|VXGE_HAL_VPATH_RPA_BCAST_DISABLE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_all_vid_en
operator|!=
name|VXGE_HAL_VPATH_RPA_ALL_VID_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_all_vid_en
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
condition|)
block|{
name|vp_config
operator|->
name|rpa_all_vid_en
operator|=
name|VXGE_HAL_VPATH_RPA_ALL_VID_ENABLE
expr_stmt|;
block|}
else|else
block|{
name|vp_config
operator|->
name|rpa_all_vid_en
operator|=
name|VXGE_HAL_VPATH_RPA_ALL_VID_DISABLE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vpath
operator|->
name|promisc_en
operator|==
name|VXGE_HAL_VP_PROMISC_ENABLE
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_UCAST_ALL_ADDR_EN
operator||
name|VXGE_HAL_RXMAC_VCFG0_MCAST_ALL_ADDR_EN
operator||
name|VXGE_HAL_RXMAC_VCFG0_BCAST_EN
operator||
name|VXGE_HAL_RXMAC_VCFG0_ALL_VID_EN
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg1
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
operator|(
name|VXGE_HAL_RXMAC_VCFG1_RTS_RTH_MULTI_IT_BD_MODE
argument_list|(
literal|0x3
argument_list|)
operator||
name|VXGE_HAL_RXMAC_VCFG1_RTS_RTH_MULTI_IT_EN_MODE
operator|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|rth_it_type
operator|==
name|VXGE_HAL_RTH_IT_TYPE_MULTI_IT
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG1_RTS_RTH_MULTI_IT_BD_MODE
argument_list|(
literal|0x2
argument_list|)
operator||
name|VXGE_HAL_RXMAC_VCFG1_RTS_RTH_MULTI_IT_EN_MODE
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|vp_queue_l2_flow
operator|!=
name|VXGE_HAL_VPATH_VP_Q_L2_FLOW_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|vp_queue_l2_flow
condition|)
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG1_CONTRIB_L2_FLOW
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG1_CONTRIB_L2_FLOW
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg1
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|fau_rpa_vcfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|rpa_l4_comp_csum
operator|!=
name|VXGE_HAL_VPATH_RPA_L4_COMP_CSUM_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_l4_comp_csum
condition|)
name|val64
operator||=
name|VXGE_HAL_FAU_RPA_VCFG_L4_COMP_CSUM
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_FAU_RPA_VCFG_L4_COMP_CSUM
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_l3_incl_cf
operator|!=
name|VXGE_HAL_VPATH_RPA_L3_INCL_CF_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_l3_incl_cf
condition|)
name|val64
operator||=
name|VXGE_HAL_FAU_RPA_VCFG_L3_INCL_CF
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_FAU_RPA_VCFG_L3_INCL_CF
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|rpa_l3_comp_csum
operator|!=
name|VXGE_HAL_VPATH_RPA_L3_COMP_CSUM_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|rpa_l3_comp_csum
condition|)
name|val64
operator||=
name|VXGE_HAL_FAU_RPA_VCFG_L3_COMP_CSUM
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_FAU_RPA_VCFG_L3_COMP_CSUM
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|fau_rpa_vcfg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|fifo
operator|.
name|enable
operator|==
name|VXGE_HAL_FIFO_ENABLE
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tpa_cfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|tpa_ignore_frame_error
operator|!=
name|VXGE_HAL_VPATH_TPA_IGNORE_FRAME_ERROR_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|tpa_ignore_frame_error
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_IGNORE_FRAME_ERR
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_IGNORE_FRAME_ERR
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|tpa_ipv6_keep_searching
operator|!=
name|VXGE_HAL_VPATH_TPA_IPV6_KEEP_SEARCHING_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|tpa_ipv6_keep_searching
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_IPV6_STOP_SEARCHING
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_IPV6_STOP_SEARCHING
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|tpa_l4_pshdr_present
operator|!=
name|VXGE_HAL_VPATH_TPA_L4_PSHDR_PRESENT_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|tpa_l4_pshdr_present
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_L4_PSHDR_PRESENT
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_L4_PSHDR_PRESENT
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|tpa_support_mobile_ipv6_hdrs
operator|!=
name|VXGE_HAL_VPATH_TPA_SUPPORT_MOBILE_IPV6_HDRS_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|tpa_support_mobile_ipv6_hdrs
condition|)
name|val64
operator||=
name|VXGE_HAL_TPA_CFG_SUPPORT_MOBILE_IPV6_HDRS
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TPA_CFG_SUPPORT_MOBILE_IPV6_HDRS
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tpa_cfg
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tx_protocol_assist_cfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp_config
operator|->
name|tpa_lsov2_en
operator|!=
name|VXGE_HAL_VPATH_TPA_LSOV2_EN_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|tpa_lsov2_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_LSOV2_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_LSOV2_EN
expr_stmt|;
block|}
if|if
condition|(
name|vp_config
operator|->
name|tpa_ipv6_keep_searching
operator|!=
name|VXGE_HAL_VPATH_TPA_IPV6_KEEP_SEARCHING_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vp_config
operator|->
name|tpa_ipv6_keep_searching
condition|)
name|val64
operator||=
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_IPV6_KEEP_SEARCHING
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TX_PROTOCOL_ASSIST_CFG_IPV6_KEEP_SEARCHING
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tx_protocol_assist_cfg
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_tim_configure  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine configures the tim registers of virtual path  * using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_tim_configure
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_dest_addr
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_vpath_map
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_bitmap
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_remap
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rtdma_rd_optimization_ctrl
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RTDMA_RD_OPTIMIZATION_CTRL_FB_ADDR_BDRY_EN
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
condition|)
name|val64
operator|=
literal|0x1000150012000100ULL
expr_stmt|;
comment|/* override for HPISS */
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rtdma_rd_optimization_ctrl
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_wrkld_clc
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_WRKLD_CLC_WRKLD_EVAL_PRD
argument_list|(
literal|0x5BE9
argument_list|)
operator||
name|VXGE_HAL_TIM_WRKLD_CLC_CNT_FRM_BYTE
operator||
name|VXGE_HAL_TIM_WRKLD_CLC_WRKLD_EVAL_DIV
argument_list|(
literal|0x15
argument_list|)
operator||
name|VXGE_HAL_TIM_WRKLD_CLC_CNT_RX_TX
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_wrkld_clc
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_ENABLE
condition|)
block|{
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_TIM_RING_ASSN_INT_NUM
argument_list|(
name|vpath
operator|->
name|rx_intr_num
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_ring_assn
argument_list|)
expr_stmt|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_pci_cfg
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_PCI_CFG_ADD_PAD
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
operator|!=
name|VXGE_HAL_VPATH_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_PCI_CFG_NO_SNOOP
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_PCI_CFG_NO_SNOOP
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_pci_cfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|fifo
operator|.
name|enable
operator|==
name|VXGE_HAL_FIFO_ENABLE
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|btimer_val
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_BTIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_BTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_BTIMER_VAL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|btimer_val
argument_list|)
expr_stmt|;
block|}
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_BITMP_EN
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|txfrm_cnt_en
operator|!=
name|VXGE_HAL_TXFRM_CNT_EN_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|txfrm_cnt_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXFRM_CNT_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXFRM_CNT_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|txd_cnt_en
operator|!=
name|VXGE_HAL_TXD_CNT_EN_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|txd_cnt_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXD_CNT_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXD_CNT_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ac_en
operator|!=
name|VXGE_HAL_TIM_TIMER_AC_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ac_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_AC
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_AC
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ci_en
operator|!=
name|VXGE_HAL_TIM_TIMER_CI_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ci_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|urange_a
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_URANGE_A
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_A
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_A
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|urange_a
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|urange_b
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_URANGE_B
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_B
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_B
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|urange_b
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|urange_c
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_URANGE_C
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_C
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_C
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|urange_c
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|tim_tti_cfg1_saved
operator|=
name|val64
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg2_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_a
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_A
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_A
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_A
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_a
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_b
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_B
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_B
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_B
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_b
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_c
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_C
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_C
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_C
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_c
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_d
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_D
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_D
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_D
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|uec_d
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg2_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ri_en
operator|!=
name|VXGE_HAL_TIM_TIMER_RI_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ri_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_TIMER_RI
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_TIMER_RI
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|rtimer_event_sf
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_RTIMER_EVENT_SF
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_EVENT_SF
argument_list|(
literal|0xf
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_EVENT_SF
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|rtimer_event_sf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|rtimer_val
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_RTIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|rtimer_val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|util_sel
operator|!=
name|VXGE_HAL_TIM_UTIL_SEL_USE_FLASH_DEFAULT
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_UTIL_SEL
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_UTIL_SEL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|util_sel
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|ltimer_val
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_LTIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_LTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_LTIMER_VAL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|ltimer_val
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|tim_tti_cfg3_saved
operator|=
name|val64
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_ENABLE
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|btimer_val
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_BTIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_BTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_BTIMER_VAL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|btimer_val
argument_list|)
expr_stmt|;
block|}
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_BITMP_EN
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|txfrm_cnt_en
operator|!=
name|VXGE_HAL_TXFRM_CNT_EN_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|txfrm_cnt_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXFRM_CNT_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXFRM_CNT_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|txd_cnt_en
operator|!=
name|VXGE_HAL_TXD_CNT_EN_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|txd_cnt_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXD_CNT_EN
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TXD_CNT_EN
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ac_en
operator|!=
name|VXGE_HAL_TIM_TIMER_AC_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ac_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_AC
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_AC
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ci_en
operator|!=
name|VXGE_HAL_TIM_TIMER_CI_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ci_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|urange_a
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_URANGE_A
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_A
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_A
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|urange_a
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|urange_b
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_URANGE_B
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_B
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_B
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|urange_b
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|urange_c
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_URANGE_C
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_C
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_URNG_C
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|urange_c
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|tim_rti_cfg1_saved
operator|=
name|val64
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg2_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_a
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_A
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_A
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_A
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_a
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_b
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_B
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_B
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_B
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_b
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_c
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_C
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_C
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_C
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_c
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_d
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_UEC_D
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_D
argument_list|(
literal|0xffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG2_INT_NUM_UEC_D
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|uec_d
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg2_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ri_en
operator|!=
name|VXGE_HAL_TIM_TIMER_RI_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ri_en
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_TIMER_RI
expr_stmt|;
else|else
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_TIMER_RI
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|rtimer_event_sf
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_RTIMER_EVENT_SF
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_EVENT_SF
argument_list|(
literal|0xf
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_EVENT_SF
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|rtimer_event_sf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|rtimer_val
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_RTIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|rtimer_val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|util_sel
operator|!=
name|VXGE_HAL_TIM_UTIL_SEL_USE_FLASH_DEFAULT
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_UTIL_SEL
argument_list|(
literal|0x3f
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_UTIL_SEL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|util_sel
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|ltimer_val
operator|!=
name|VXGE_HAL_USE_FLASH_DEFAULT_TIM_LTIMER_VAL
condition|)
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_LTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_LTIMER_VAL
argument_list|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|ltimer_val
argument_list|)
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|tim_rti_cfg3_saved
operator|=
name|val64
expr_stmt|;
block|}
name|val64
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|intr_mode
operator|==
name|VXGE_HAL_INTR_MODE_EMULATED_INTA
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_BTIMER_VAL
argument_list|(
literal|1
argument_list|)
operator||
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_EINTA
index|]
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg2_int_num
index|[
name|VXGE_HAL_VPATH_INTR_EINTA
index|]
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_EINTA
index|]
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_BMAP
index|]
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg2_int_num
index|[
name|VXGE_HAL_VPATH_INTR_BMAP
index|]
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u64
operator|)
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_BMAP
index|]
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_is_rxdmem_leak - Check for the rxd memory leak.  * @vpath_handle: Virtual Path handle.  *  * The function checks for the rxd memory leak.  *  */
end_comment

begin_function
name|u32
name|vxge_hal_vpath_is_rxdmem_leak
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|u32
name|new_qw_count
decl_stmt|,
name|rxd_spat
decl_stmt|,
name|bRet
init|=
literal|0
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_DISABLE
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|bRet
argument_list|)
expr_stmt|;
return|return
operator|(
name|bRet
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_rxd_doorbell
argument_list|)
expr_stmt|;
name|new_qw_count
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_PRC_RXD_DOORBELL_GET_NEW_QW_CNT
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|prc_cfg6
argument_list|)
expr_stmt|;
name|rxd_spat
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_PRC_CFG6_GET_RXD_SPAT
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|bRet
operator|=
operator|(
name|new_qw_count
operator|>
operator|(
name|rxd_spat
operator|*
literal|3
operator|/
literal|2
operator|)
operator|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|bRet
argument_list|)
expr_stmt|;
return|return
operator|(
name|bRet
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mtu_check - check MTU value for ranges  * @vpath_handle: Virtal path handle  * @new_mtu: new MTU value to check  *  * Will do sanity check for new MTU value.  *  * Returns: VXGE_HAL_OK - success.  * VXGE_HAL_ERR_INVALID_MTU_SIZE - MTU is invalid.  *  * See also: vxge_hal_vpath_mtu_set()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_device_mtu_check
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|unsigned
name|long
name|new_mtu
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
name|new_mtu
operator|+=
name|VXGE_HAL_MAC_HEADER_MAX_SIZE
expr_stmt|;
if|if
condition|(
operator|(
name|new_mtu
operator|<
name|VXGE_HAL_MIN_MTU
operator|)
operator|||
operator|(
name|new_mtu
operator|>
name|vp
operator|->
name|vpath
operator|->
name|max_mtu
operator|)
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_ERR_INVALID_MTU_SIZE
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_mtu_set - Set MTU.  * @vpath_handle: Virtal path handle  * @new_mtu: New MTU size to configure.  *  * Set new MTU value. Example, to use jumbo frames:  * vxge_hal_vpath_mtu_set(my_device, 9600);  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_mtu_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|unsigned
name|long
name|new_mtu
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_HANDLE
operator|)
return|;
block|}
name|new_mtu
operator|+=
name|VXGE_HAL_MAC_HEADER_MAX_SIZE
expr_stmt|;
if|if
condition|(
operator|(
name|new_mtu
operator|<
name|VXGE_HAL_MIN_MTU
operator|)
operator|||
operator|(
name|new_mtu
operator|>
name|vp
operator|->
name|vpath
operator|->
name|max_mtu
operator|)
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_ERR_INVALID_MTU_SIZE
expr_stmt|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_RXMAC_VCFG0_RTS_MAX_FRM_LEN
argument_list|(
literal|0x3fff
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_RXMAC_VCFG0_RTS_MAX_FRM_LEN
argument_list|(
name|new_mtu
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|rxmac_vcfg0
argument_list|)
expr_stmt|;
name|vp
operator|->
name|vpath
operator|->
name|vp_config
operator|->
name|mtu
operator|=
name|new_mtu
operator|-
name|VXGE_HAL_MAC_HEADER_MAX_SIZE
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_size_quantum_set  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine configures the size quantum of virtual path  * using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_size_quantum_set
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
switch|switch
condition|(
name|__vxge_os_cacheline_size
condition|)
block|{
case|case
literal|8
case|:
name|val64
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|val64
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|32
case|:
name|val64
operator|=
literal|2
expr_stmt|;
break|break;
case|case
literal|64
case|:
name|val64
operator|=
literal|3
expr_stmt|;
break|break;
default|default:
case|case
literal|128
case|:
name|val64
operator|=
literal|4
expr_stmt|;
break|break;
case|case
literal|256
case|:
name|val64
operator|=
literal|5
expr_stmt|;
break|break;
case|case
literal|512
case|:
name|val64
operator|=
literal|6
expr_stmt|;
break|break;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_general_cfg2
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_hw_initialize  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine initializes the registers of virtual path  * using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_hw_initialize
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|u32
name|mrrs
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_hal_pci_e_capability_t
modifier|*
name|pci_e_cap
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|vpath_assignments
operator|&
name|mBIT
argument_list|(
name|vp_id
argument_list|)
operator|)
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_AVAILABLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_AVAILABLE
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_swapper_set
argument_list|(
operator|(
name|vxge_hal_device_t
operator|*
operator|)
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_size_quantum_set
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_mac_configure
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_kdfc_configure
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_tim_configure
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_USDC_VPATH_SGRP_ASSIGN
argument_list|(
name|vpath
operator|->
name|sess_grps_available
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|usdc_vpath
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|qcc_pci_cfg
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_QCC_PCI_CFG_ADD_PAD_CQE_SPACE
operator||
name|VXGE_HAL_QCC_PCI_CFG_ADD_PAD_WQE
operator||
name|VXGE_HAL_QCC_PCI_CFG_ADD_PAD_SRQIR
operator||
name|VXGE_HAL_QCC_PCI_CFG_CTL_STR_CQE_SPACE
operator||
name|VXGE_HAL_QCC_PCI_CFG_CTL_STR_WQE
operator||
name|VXGE_HAL_QCC_PCI_CFG_CTL_STR_SRQIR
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
operator|!=
name|VXGE_HAL_VPATH_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_QCC_PCI_CFG_NO_SNOOP_CQE_SPACE
operator||
name|VXGE_HAL_QCC_PCI_CFG_NO_SNOOP_WQE
operator||
name|VXGE_HAL_QCC_PCI_CFG_NO_SNOOP_SRQIR
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|&=
operator|~
operator|(
name|VXGE_HAL_QCC_PCI_CFG_NO_SNOOP_CQE_SPACE
operator||
name|VXGE_HAL_QCC_PCI_CFG_NO_SNOOP_WQE
operator||
name|VXGE_HAL_QCC_PCI_CFG_NO_SNOOP_SRQIR
operator|)
expr_stmt|;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|qcc_pci_cfg
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|h2l_vpath_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
operator|!=
name|VXGE_HAL_VPATH_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_H2L_VPATH_CONFIG_OD_NO_SNOOP
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_H2L_VPATH_CONFIG_OD_NO_SNOOP
expr_stmt|;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|h2l_vpath_config
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|ph2l_vp_cfg0
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
operator|!=
name|VXGE_HAL_VPATH_NO_SNOOP_USE_FLASH_DEFAULT
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|no_snoop
condition|)
block|{
name|val64
operator||=
name|VXGE_HAL_PH2L_VP_CFG0_NOSNOOP_DATA
expr_stmt|;
block|}
else|else
block|{
name|val64
operator|&=
operator|~
name|VXGE_HAL_PH2L_VP_CFG0_NOSNOOP_DATA
expr_stmt|;
block|}
block|}
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|ph2l_vp_cfg0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|gendma_int
argument_list|)
expr_stmt|;
name|pci_e_cap
operator|=
operator|(
name|vxge_hal_pci_e_capability_t
operator|*
operator|)
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|hldev
operator|->
name|pci_config_space_bios
operator|)
operator|+
name|hldev
operator|->
name|pci_e_caps
operator|)
expr_stmt|;
name|mrrs
operator|=
name|pci_e_cap
operator|->
name|pci_e_devctl
operator|>>
literal|12
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTDMA_RD_OPTIMIZATION_CTRL_GEN_INT_AFTER_ABORT
operator||
name|VXGE_HAL_RTDMA_RD_OPTIMIZATION_CTRL_FB_FILL_THRESH
argument_list|(
name|mrrs
argument_list|)
operator||
name|VXGE_HAL_RTDMA_RD_OPTIMIZATION_CTRL_FB_ADDR_BDRY_EN
operator||
name|VXGE_HAL_RTDMA_RD_OPTIMIZATION_CTRL_TXD_FILL_THRESH
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rtdma_rd_optimization_ctrl
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vp_initialize - Initialize Virtual Path structure  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  * @config: Configuration for the virtual path  *  * This routine initializes virtual path using the config passed  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vp_initialize
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|,
name|vxge_hal_vp_config_t
modifier|*
name|config
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|hldev
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|config
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d, config = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|,
operator|(
name|ptr_t
operator|)
name|config
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|vpath_assignments
operator|&
name|mBIT
argument_list|(
name|vp_id
argument_list|)
operator|)
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_AVAILABLE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_AVAILABLE
operator|)
return|;
block|}
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
name|vpath
operator|->
name|vp_id
operator|=
name|vp_id
expr_stmt|;
name|vpath
operator|->
name|vp_open
operator|=
name|VXGE_HAL_VP_OPEN
expr_stmt|;
name|vpath
operator|->
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
expr_stmt|;
name|vpath
operator|->
name|vp_config
operator|=
name|config
expr_stmt|;
name|vpath
operator|->
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|vpath
operator|->
name|vpmgmt_reg
operator|=
name|hldev
operator|->
name|vpmgmt_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|status
operator|=
name|__hal_vpath_hw_reset
argument_list|(
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath is already in reset  %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|__hal_vpath_reset_check
argument_list|(
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_os_memzero
argument_list|(
name|vpath
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_virtualpath_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_mgmt_read
argument_list|(
name|hldev
argument_list|,
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_os_memzero
argument_list|(
name|vpath
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_virtualpath_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vpath
operator|->
name|tx_intr_num
operator|=
operator|(
name|vp_id
operator|*
name|VXGE_HAL_MAX_INTR_PER_VP
operator|)
operator|+
name|VXGE_HAL_VPATH_INTR_TX
expr_stmt|;
name|vpath
operator|->
name|rx_intr_num
operator|=
operator|(
name|vp_id
operator|*
name|VXGE_HAL_MAX_INTR_PER_VP
operator|)
operator|+
name|VXGE_HAL_VPATH_INTR_RX
expr_stmt|;
name|vpath
operator|->
name|einta_intr_num
operator|=
operator|(
name|vp_id
operator|*
name|VXGE_HAL_MAX_INTR_PER_VP
operator|)
operator|+
name|VXGE_HAL_VPATH_INTR_EINTA
expr_stmt|;
name|vpath
operator|->
name|bmap_intr_num
operator|=
operator|(
name|vp_id
operator|*
name|VXGE_HAL_MAX_INTR_PER_VP
operator|)
operator|+
name|VXGE_HAL_VPATH_INTR_BMAP
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS
argument_list|)
name|vxge_os_spin_lock_init
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|,
name|hldev
operator|->
name|pdev
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS_IRQ
argument_list|)
name|vxge_os_spin_lock_init_irq
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|,
name|hldev
operator|->
name|irqh
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_list_init
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|=
operator|&
name|hldev
operator|->
name|stats
operator|.
name|sw_dev_info_stats
operator|.
name|vpath_info
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_os_memzero
argument_list|(
operator|&
name|vpath
operator|->
name|sw_stats
operator|->
name|obj_counts
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_sw_obj_count_t
argument_list|)
argument_list|)
expr_stmt|;
name|VXGE_HAL_DEVICE_TIM_INT_MASK_SET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_hw_initialize
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|__hal_vp_terminate
argument_list|(
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vp_terminate - Terminate Virtual Path structure  * @hldev: Handle to the device object  * @vp_id: Virtual Path Id  *  * This routine closes all channels it opened and freeup memory  */
end_comment

begin_function
name|void
name|__hal_vp_terminate
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vp_id
parameter_list|)
block|{
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vp_id = %d"
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|vp_id
index|]
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return;
block|}
name|VXGE_HAL_DEVICE_TIM_INT_MASK_RESET
argument_list|(
name|vpath
operator|->
name|hldev
argument_list|,
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS
argument_list|)
name|vxge_os_spin_lock_destroy
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS_IRQ
argument_list|)
name|vxge_os_spin_lock_destroy_irq
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_os_memzero
argument_list|(
name|vpath
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_virtualpath_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_obj_count_get - Get the Object usage count for a given  *		 virtual path  * @vpath_handle: Virtal path handle  * @obj_counts: Buffer to return object counts  *  * This function returns the object counts for virtual path.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_obj_count_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_vpath_sw_obj_count_t
modifier|*
name|obj_count
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
if|if
condition|(
operator|(
name|vpath_handle
operator|==
name|NULL
operator|)
operator|||
operator|(
name|obj_count
operator|==
name|NULL
operator|)
condition|)
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"obj_count = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|obj_count
argument_list|)
expr_stmt|;
name|vxge_os_memcpy
argument_list|(
name|obj_count
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|sw_stats
operator|->
name|obj_counts
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_sw_obj_count_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_open - Open a virtual path on a given adapter  * @devh: handle to device object  * @attr: Virtual path attributes  * @cb_fn: Call back to be called to complete an asynchronous function call  * @client_handle: handle to be returned in the callback  * @vpath_handle: Buffer to return a handle to the vpath  *  * This function is used to open access to virtual path of an  * adapter for offload, LRO and SPDM operations. This function returns  * synchronously.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_open
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|vxge_hal_vpath_attr_t
modifier|*
name|attr
parameter_list|,
name|vxge_hal_vpath_callback_f
name|cb_fn
parameter_list|,
name|vxge_hal_client_h
name|client_handle
parameter_list|,
name|vxge_hal_vpath_h
modifier|*
name|vpath_handle
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|devh
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|attr
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|cb_fn
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"attr = 0x"
name|VXGE_OS_STXFMT
literal|", cb_fn = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"client_handle = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
operator|(
name|ptr_t
operator|)
name|attr
argument_list|,
operator|(
name|ptr_t
operator|)
name|cb_fn
argument_list|,
operator|(
name|ptr_t
operator|)
name|client_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|&
name|hldev
operator|->
name|virtual_paths
index|[
name|attr
operator|->
name|vp_id
index|]
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_INVALID_STATE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_STATE
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vp_initialize
argument_list|(
name|hldev
argument_list|,
name|attr
operator|->
name|vp_id
argument_list|,
operator|&
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|vp_config
index|[
name|attr
operator|->
name|vp_id
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_err_log_vpath
argument_list|(
literal|"virtual Paths: __hal_vp_initialize failed ==> %s : %d"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
goto|goto
name|vpath_open_exit1
goto|;
block|}
name|vp
operator|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vxge_os_malloc
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_vpath_handle_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|==
name|NULL
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_ERR_OUT_OF_MEMORY
expr_stmt|;
goto|goto
name|vpath_open_exit2
goto|;
block|}
name|vxge_os_memzero
argument_list|(
name|vp
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_vpath_handle_t
argument_list|)
argument_list|)
expr_stmt|;
name|vp
operator|->
name|vpath
operator|=
name|vpath
expr_stmt|;
name|vp
operator|->
name|cb_fn
operator|=
name|cb_fn
expr_stmt|;
name|vp
operator|->
name|client_handle
operator|=
name|client_handle
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_config
operator|->
name|fifo
operator|.
name|enable
operator|==
name|VXGE_HAL_FIFO_ENABLE
condition|)
block|{
name|status
operator|=
name|__hal_fifo_create
argument_list|(
name|vp
argument_list|,
operator|&
name|attr
operator|->
name|fifo_attr
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
goto|goto
name|vpath_open_exit6
goto|;
block|}
block|}
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_ENABLE
condition|)
block|{
name|status
operator|=
name|__hal_ring_create
argument_list|(
name|vp
argument_list|,
operator|&
name|attr
operator|->
name|ring_attr
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
goto|goto
name|vpath_open_exit7
goto|;
block|}
name|status
operator|=
name|__hal_vpath_prc_configure
argument_list|(
name|devh
argument_list|,
name|attr
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
goto|goto
name|vpath_open_exit8
goto|;
block|}
block|}
name|vp
operator|->
name|vpath
operator|->
name|stats_block
operator|=
name|__hal_blockpool_block_allocate
argument_list|(
name|devh
argument_list|,
name|VXGE_OS_HOST_PAGE_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|stats_block
operator|==
name|NULL
condition|)
block|{
name|status
operator|=
name|VXGE_HAL_ERR_OUT_OF_MEMORY
expr_stmt|;
goto|goto
name|vpath_open_exit8
goto|;
block|}
name|vp
operator|->
name|vpath
operator|->
name|hw_stats
operator|=
operator|(
name|vxge_hal_vpath_stats_hw_info_t
operator|*
operator|)
name|vp
operator|->
name|vpath
operator|->
name|stats_block
operator|->
name|memblock
expr_stmt|;
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|hldev
operator|->
name|stats
operator|.
name|hw_dev_info_stats
operator|.
name|vpath_info
index|[
name|attr
operator|->
name|vp_id
index|]
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hw_stats
expr_stmt|;
name|vp
operator|->
name|vpath
operator|->
name|hw_stats_sav
operator|=
operator|&
name|hldev
operator|->
name|stats
operator|.
name|hw_dev_info_stats
operator|.
name|vpath_info_sav
index|[
name|attr
operator|->
name|vp_id
index|]
expr_stmt|;
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hw_stats_sav
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|stats_block
operator|->
name|dma_addr
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|stats_cfg
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_vpath_hw_stats_enable
argument_list|(
name|vp
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
goto|goto
name|vpath_open_exit8
goto|;
block|}
name|vxge_list_insert
argument_list|(
operator|&
name|vp
operator|->
name|item
argument_list|,
operator|&
name|vpath
operator|->
name|vpath_handles
argument_list|)
expr_stmt|;
name|hldev
operator|->
name|vpaths_deployed
operator||=
name|mBIT
argument_list|(
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
operator|*
name|vpath_handle
operator|=
name|vp
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
name|vpath_open_exit8
label|:
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
name|__hal_ring_delete
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vpath_open_exit7
label|:
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
condition|)
name|__hal_fifo_delete
argument_list|(
name|vp
argument_list|)
expr_stmt|;
name|vpath_open_exit6
label|:
name|vxge_os_free
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|vp
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_vpath_handle_t
argument_list|)
argument_list|)
expr_stmt|;
name|vpath_open_exit2
label|:
name|__hal_vp_terminate
argument_list|(
name|devh
argument_list|,
name|attr
operator|->
name|vp_id
argument_list|)
expr_stmt|;
name|vpath_open_exit1
label|:
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_id - Get virtual path ID  * @vpath_handle: Handle got from previous vpath open  *  * This function returns virtual path id  */
end_comment

begin_function
name|u32
name|vxge_hal_vpath_id
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u32
name|id
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|id
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
operator|->
name|vp_id
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|id
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_close - Close the handle got from previous vpath (vpath) open  * @vpath_handle: Handle got from previous vpath open  *  * This function is used to close access to virtual path opened  * earlier.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_close
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|u32
name|vp_id
decl_stmt|;
name|u32
name|is_empty
init|=
name|TRUE
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
name|vp
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vp_id
operator|=
name|vpath
operator|->
name|vp_id
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS
argument_list|)
name|vxge_os_spin_lock
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS_IRQ
argument_list|)
name|vxge_os_spin_lock_irq
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_list_remove
argument_list|(
operator|&
name|vp
operator|->
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|vxge_list_is_empty
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles
argument_list|)
condition|)
block|{
name|vxge_list_insert
argument_list|(
operator|&
name|vp
operator|->
name|item
argument_list|,
operator|&
name|vpath
operator|->
name|vpath_handles
argument_list|)
expr_stmt|;
name|is_empty
operator|=
name|FALSE
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS
argument_list|)
name|vxge_os_spin_unlock
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_VP_CBS_IRQ
argument_list|)
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|vpath
operator|->
name|vpath_handles_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|is_empty
condition|)
block|{
name|vxge_hal_err_log_vpath
argument_list|(
literal|"clients are still attached ==> %s : %d"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 1"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
name|vpath
operator|->
name|hldev
operator|->
name|vpaths_deployed
operator|&=
operator|~
name|mBIT
argument_list|(
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
name|__hal_ring_delete
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|fifoh
operator|!=
name|NULL
condition|)
name|__hal_fifo_delete
argument_list|(
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|stats_block
operator|!=
name|NULL
condition|)
block|{
name|__hal_blockpool_block_free
argument_list|(
name|hldev
argument_list|,
name|vpath
operator|->
name|stats_block
argument_list|)
expr_stmt|;
block|}
name|vxge_os_free
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|vpath_handle
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_vpath_handle_t
argument_list|)
argument_list|)
expr_stmt|;
name|__hal_vp_terminate
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|vp_open
operator|=
name|VXGE_HAL_VP_NOT_OPEN
expr_stmt|;
operator|(
name|void
operator|)
name|__hal_ifmsg_wmsg_post
argument_list|(
name|hldev
argument_list|,
name|vp_id
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_MSG_DEST_BROADCAST
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_MSG_TYPE_VPATH_RESET_END
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_reset - Resets vpath  * @vpath_handle: Handle got from previous vpath open  *  * This function is used to request a reset of vpath  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_reset
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|u32
name|count
init|=
literal|0
decl_stmt|,
name|total_count
init|=
literal|0
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|vxge_hw_vpath_set_zero_rx_frm_len
argument_list|(
name|hldev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
name|vxge_hw_vpath_wait_receive_idle
argument_list|(
name|hldev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|,
operator|&
name|count
argument_list|,
operator|&
name|total_count
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_hw_reset
argument_list|(
operator|(
name|vxge_hal_device_h
operator|)
name|hldev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
name|vp
operator|->
name|vpath
operator|->
name|sw_stats
operator|->
name|soft_reset_cnt
operator|++
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_reset_poll - Poll for reset complete  * @vpath_handle: Handle got from previous vpath open  *  * This function is used to poll for the vpath reset completion  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_reset_poll
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_reset_check
argument_list|(
name|vp
operator|->
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_sw_reset
argument_list|(
operator|(
name|vxge_hal_device_h
operator|)
name|hldev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|sw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_sw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_hw_initialize
argument_list|(
operator|(
name|vxge_hal_device_h
operator|)
name|hldev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
if|if
condition|(
name|vp
operator|->
name|vpath
operator|->
name|ringh
operator|!=
name|NULL
condition|)
block|{
name|status
operator|=
name|__hal_vpath_prc_configure
argument_list|(
operator|(
name|vxge_hal_device_h
operator|)
name|hldev
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|vp_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hw_stats_sav
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|stats_block
operator|->
name|dma_addr
argument_list|,
operator|&
name|vp
operator|->
name|vpath
operator|->
name|vp_reg
operator|->
name|stats_cfg
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_vpath_hw_stats_enable
argument_list|(
name|vp
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vxge_hal_trace_log_vpath
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_hw_stats_enable - Enable vpath h/wstatistics.  * @vpath_handle: Virtual Path handle.  *  * Enable the DMA vpath statistics. The function is to be called to re-enable  * the adapter to update stats into the host memory  *  * See also: vxge_hal_vpath_hw_stats_disable(), vxge_hal_vpath_hw_stats_get()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_hw_stats_enable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vpath
operator|=
name|vp
operator|->
name|vpath
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|vxge_os_memcpy
argument_list|(
name|vpath
operator|->
name|hw_stats_sav
argument_list|,
name|vpath
operator|->
name|hw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|stats_read_method
operator|==
name|VXGE_HAL_STATS_READ_METHOD_DMA
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|stats_cfg0
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_STATS_CFG0_STATS_ENABLE
argument_list|(
operator|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|stats_cfg0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|__hal_vpath_hw_stats_get
argument_list|(
name|vpath
argument_list|,
name|vpath
operator|->
name|hw_stats
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_hw_stats_disable - Disable vpath h/w statistics.  * @vpath_handle: Virtual Path handle.  *  * Enable the DMA vpath statistics. The function is to be called to disable  * the adapter to update stats into the host memory. This function is not  * needed to be called, normally.  *  * See also: vxge_hal_vpath_hw_stats_enable(), vxge_hal_vpath_hw_stats_get()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_hw_stats_disable
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|stats_cfg0
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_STATS_CFG0_STATS_ENABLE
argument_list|(
operator|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|stats_cfg0
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_hw_stats_get - Get the vpath hw statistics.  * @vpath_handle: Virtual Path handle.  * @hw_stats: Hardware stats  *  * Returns the vpath h/w stats.  *  * See also: vxge_hal_vpath_hw_stats_enable(),  * vxge_hal_vpath_hw_stats_disable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_hw_stats_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_vpath_stats_hw_info_t
modifier|*
name|hw_stats
parameter_list|)
block|{
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hw_stats
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
literal|", hw_stats = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|hw_stats
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|common_reg
operator|->
name|stats_cfg0
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_STATS_CFG0_STATS_ENABLE
argument_list|(
operator|(
literal|1
operator|<<
operator|(
literal|16
operator|-
name|vpath
operator|->
name|vp_id
operator|)
operator|)
argument_list|)
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_os_memcpy
argument_list|(
name|hw_stats
argument_list|,
name|vpath
operator|->
name|hw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_sw_stats_get - Get the vpath sw statistics.  * @vpath_handle: Virtual Path handle.  * @sw_stats: Software stats  *  * Returns the vpath s/w stats.  *  * See also: vxge_hal_vpath_hw_stats_get()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_sw_stats_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_vpath_stats_sw_info_t
modifier|*
name|sw_stats
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath_handle
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|sw_stats
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
literal|", sw_stats = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|,
operator|(
name|ptr_t
operator|)
name|sw_stats
argument_list|)
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
if|if
condition|(
name|hldev
operator|->
name|header
operator|.
name|traffic_intr_cnt
condition|)
block|{
name|int
name|intrcnt
init|=
name|hldev
operator|->
name|header
operator|.
name|traffic_intr_cnt
decl_stmt|;
if|if
condition|(
operator|!
name|intrcnt
condition|)
name|intrcnt
operator|=
literal|1
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|common_stats
operator|.
name|avg_compl_per_intr_cnt
operator|=
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|common_stats
operator|.
name|total_compl_cnt
operator|/
name|intrcnt
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|common_stats
operator|.
name|avg_compl_per_intr_cnt
operator|==
literal|0
condition|)
block|{
comment|/* to not confuse user */
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|common_stats
operator|.
name|avg_compl_per_intr_cnt
operator|=
literal|1
expr_stmt|;
block|}
name|vpath
operator|->
name|sw_stats
operator|->
name|ring_stats
operator|.
name|common_stats
operator|.
name|avg_compl_per_intr_cnt
operator|=
name|vpath
operator|->
name|sw_stats
operator|->
name|ring_stats
operator|.
name|common_stats
operator|.
name|total_compl_cnt
operator|/
name|intrcnt
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|sw_stats
operator|->
name|ring_stats
operator|.
name|common_stats
operator|.
name|avg_compl_per_intr_cnt
operator|==
literal|0
condition|)
block|{
comment|/* to not confuse user */
name|vpath
operator|->
name|sw_stats
operator|->
name|ring_stats
operator|.
name|common_stats
operator|.
name|avg_compl_per_intr_cnt
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|total_posts
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|avg_buffers_per_post
operator|=
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|total_buffers
operator|/
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|total_posts
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|avg_post_size
operator|=
call|(
name|u32
call|)
argument_list|(
name|vpath
operator|->
name|hw_stats
operator|->
name|tx_stats
operator|.
name|tx_ttl_eth_octets
operator|/
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|total_posts
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|total_buffers
condition|)
block|{
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|avg_buffer_size
operator|=
call|(
name|u32
call|)
argument_list|(
name|vpath
operator|->
name|hw_stats
operator|->
name|tx_stats
operator|.
name|tx_ttl_eth_octets
operator|/
name|vpath
operator|->
name|sw_stats
operator|->
name|fifo_stats
operator|.
name|total_buffers
argument_list|)
expr_stmt|;
block|}
name|vxge_os_memcpy
argument_list|(
name|sw_stats
argument_list|,
name|vpath
operator|->
name|sw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_sw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_stats_access - Get the statistics from the given location  *			  and offset and perform an operation  * @vpath: Virtual path.  * @operation: Operation to be performed  * @location: Location (one of vpath id, aggregate or port)  * @offset: Offset with in the location  * @stat: Pointer to a buffer to return the value  *  * Get the statistics from the given location and offset.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_stats_access
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|,
name|u32
name|operation
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u64
modifier|*
name|stat
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|val64
operator|=
name|VXGE_HAL_XMAC_STATS_ACCESS_CMD_OP
argument_list|(
name|operation
argument_list|)
operator||
name|VXGE_HAL_XMAC_STATS_ACCESS_CMD_STROBE
operator||
name|VXGE_HAL_XMAC_STATS_ACCESS_CMD_OFFSET_SEL
argument_list|(
name|offset
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_lower
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|32
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_stats_access_cmd
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|val64
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_stats_access_cmd
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_stats_access_cmd
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_XMAC_STATS_ACCESS_CMD_STROBE
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|==
name|VXGE_HAL_OK
operator|)
operator|&&
operator|(
name|operation
operator|==
name|VXGE_HAL_STATS_OP_READ
operator|)
condition|)
block|{
operator|*
name|stat
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|xmac_stats_access_data
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|stat
operator|=
literal|0
expr_stmt|;
block|}
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_stats_access  * Get statistics from given location and offset to perform an operation  * @vpath_handle: Virtual path handle.  * @operation: Operation to be performed  * @offset: Offset with in the location  * @stat: Pointer to a buffer to return the value  *  * Get the statistics from the given location and offset.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_stats_access
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|operation
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u64
modifier|*
name|stat
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_stats_access
argument_list|(
name|vp
operator|->
name|vpath
argument_list|,
name|operation
argument_list|,
name|offset
argument_list|,
name|stat
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_xmac_tx_stats_get - Get the TX Statistics of a vpath  * @vpath: vpath  * @vpath_tx_stats: Buffer to return TX Statistics of vpath.  *  * Get the TX Statistics of a vpath  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_xmac_tx_stats_get
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|,
name|vxge_hal_xmac_vpath_tx_stats_t
modifier|*
name|vpath_tx_stats
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_TTL_ETH_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_ttl_eth_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_TTL_ETH_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_TTL_ETH_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_ttl_eth_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_TTL_ETH_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_DATA_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_data_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_DATA_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_MCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_mcast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_MCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_BCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_bcast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_BCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_UCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_ucast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_UCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_TAGGED_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_tagged_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_TAGGED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_VLD_IP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_vld_ip
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_VLD_IP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_VLD_IP_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_vld_ip_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_VLD_IP_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_ICMP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_icmp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_ICMP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_TCP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_tcp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_TCP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_RST_TCP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_rst_tcp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_RST_TCP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_UDP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_udp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_UDP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_LOST_IP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_lost_ip
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_TX_LOST_IP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_UNKNOWN_PROTOCOL_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_unknown_protocol
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_TX_UNKNOWN_PROTOCOL
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_PARSE_ERROR_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_parse_error
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_TX_PARSE_ERROR
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_TCP_OFFLOAD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_tcp_offload
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_TCP_OFFLOAD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_RETX_TCP_OFFLOAD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_retx_tcp_offload
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_RETX_TCP_OFFLOAD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_TX_LOST_IP_OFFLOAD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_tx_stats
operator|->
name|tx_lost_ip_offload
operator|=
name|VXGE_HAL_STATS_GET_VPATH_TX_LOST_IP_OFFLOAD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_xmac_rx_stats_get - Get the RX Statistics of a vpath  * @vpath: vpath  * @vpath_rx_stats: Buffer to return RX Statistics of vpath.  *  * Get the RX Statistics of a vpath  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_xmac_rx_stats_get
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|,
name|vxge_hal_xmac_vpath_rx_stats_t
modifier|*
name|vpath_rx_stats
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_ETH_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_eth_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_ETH_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_VLD_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_vld_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_VLD_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_OFFLOAD_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_offload_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_OFFLOAD_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_ETH_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_eth_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_ETH_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_DATA_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_data_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_DATA_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_OFFLOAD_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_offload_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_OFFLOAD_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_VLD_MCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_vld_mcast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_VLD_MCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_VLD_BCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_vld_bcast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_VLD_BCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_ACC_UCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_accepted_ucast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_ACC_UCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_ACC_NUCAST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_accepted_nucast_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_ACC_NUCAST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TAGGED_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_tagged_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TAGGED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_LONG_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_long_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_LONG_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_USIZED_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_usized_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_USIZED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_OSIZED_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_osized_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_OSIZED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_FRAG_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_frag_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_FRAG_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_JABBER_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_jabber_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_JABBER_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_64_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_64_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_64_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_65_127_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_65_127_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_65_127_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_128_255_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_128_255_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_128_255_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_256_511_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_256_511_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_256_511_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_512_1023_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_512_1023_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_512_1023_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_1024_1518_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_1024_1518_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_1024_1518_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_1519_4095_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_1519_4095_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_1519_4095_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_4096_8191_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_4096_8191_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_4096_8191_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_8192_MAX_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_8192_max_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_8192_MAX_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TTL_GT_MAX_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ttl_gt_max_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TTL_GT_MAX_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_IP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ip
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_IP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_ACC_IP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_accepted_ip
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_ACC_IP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_IP_OCTETS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_ip_octets
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_IP_OCTETS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_ERR_IP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_err_ip
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_ERR_IP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_ICMP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_icmp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_ICMP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_TCP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_tcp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_TCP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_UDP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_udp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_UDP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_ERR_TCP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_err_tcp
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_ERR_TCP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_LOST_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_lost_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_LOST_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_LOST_IP_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_lost_ip
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_LOST_IP
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_LOST_IP_OFFLOAD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_lost_ip_offload
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_LOST_IP_OFFLOAD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_QUEUE_FULL_DISCARD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_queue_full_discard
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_STATS_GET_VPATH_RX_QUEUE_FULL_DISCARD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_RED_DISCARD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_red_discard
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_STATS_GET_VPATH_RX_RED_DISCARD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_SLEEP_DISCARD_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_sleep_discard
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_STATS_GET_VPATH_RX_SLEEP_DISCARD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_various_discard
operator|=
name|vpath_rx_stats
operator|->
name|rx_queue_full_discard
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_RX_MPA_OK_FRMS_OFFSET
argument_list|)
expr_stmt|;
name|vpath_rx_stats
operator|->
name|rx_mpa_ok_frms
operator|=
name|VXGE_HAL_STATS_GET_VPATH_RX_MPA_OK_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_xmac_tx_stats_get - Get the TX Statistics of a vpath  * @vpath_handle: vpath handle.  * @vpath_tx_stats: Buffer to return TX Statistics of vpath.  *  * Get the TX Statistics of a vpath  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_xmac_tx_stats_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_xmac_vpath_tx_stats_t
modifier|*
name|vpath_tx_stats
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_xmac_tx_stats_get
argument_list|(
name|vp
operator|->
name|vpath
argument_list|,
name|vpath_tx_stats
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_xmac_rx_stats_get - Get the RX Statistics of a vpath  * @vpath_handle: vpath handle.  * @vpath_rx_stats: Buffer to return RX Statistics of vpath.  *  * Get the RX Statistics of a vpath  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_xmac_rx_stats_get
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|vxge_hal_xmac_vpath_rx_stats_t
modifier|*
name|vpath_rx_stats
parameter_list|)
block|{
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|vpath_handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath_handle = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_xmac_rx_stats_get
argument_list|(
name|vp
operator|->
name|vpath
argument_list|,
name|vpath_rx_stats
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_vpath_hw_stats_get - Get the vpath hw statistics.  * @vpath: Virtual Path.  * @hw_stats: Hardware stats  *  * Returns the vpath h/w stats.  *  * See also: vxge_hal_vpath_hw_stats_enable(),  * vxge_hal_vpath_hw_stats_disable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_vpath_hw_stats_get
parameter_list|(
name|__hal_virtualpath_t
modifier|*
name|vpath
parameter_list|,
name|vxge_hal_vpath_stats_hw_info_t
modifier|*
name|hw_stats
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|vpath
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|hw_stats
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
literal|", hw_stats = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath
argument_list|,
operator|(
name|ptr_t
operator|)
name|hw_stats
argument_list|)
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_open
operator|==
name|VXGE_HAL_VP_NOT_OPEN
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_VPATH_NOT_OPEN
operator|)
return|;
block|}
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats0
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|ini_num_mwr_sent
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_DEBUG_STATS0_GET_INI_NUM_MWR_SENT
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats1
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|ini_num_mrd_sent
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_DEBUG_STATS1_GET_INI_NUM_MRD_SENT
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats2
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|ini_num_cpl_rcvd
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_DEBUG_STATS2_GET_INI_NUM_CPL_RCVD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats3
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|ini_num_mwr_byte_sent
operator|=
name|VXGE_HAL_VPATH_DEBUG_STATS3_GET_INI_NUM_MWR_BYTE_SENT
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats4
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|ini_num_cpl_byte_rcvd
operator|=
name|VXGE_HAL_VPATH_DEBUG_STATS4_GET_INI_NUM_CPL_BYTE_RCVD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats5
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|wrcrdtarb_xoff
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_DEBUG_STATS5_GET_WRCRDTARB_XOFF
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_debug_stats6
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rdcrdtarb_xoff
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_DEBUG_STATS6_GET_RDCRDTARB_XOFF
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_genstats_count01
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|vpath_genstats_count0
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_GENSTATS_COUNT01_GET_PPIF_VPATH_GENSTATS_COUNT0
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_genstats_count01
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|vpath_genstats_count1
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_GENSTATS_COUNT01_GET_PPIF_VPATH_GENSTATS_COUNT1
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_genstats_count23
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|vpath_genstats_count2
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_GENSTATS_COUNT23_GET_PPIF_VPATH_GENSTATS_COUNT2
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_genstats_count01
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|vpath_genstats_count3
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_GENSTATS_COUNT23_GET_PPIF_VPATH_GENSTATS_COUNT3
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_genstats_count4
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|vpath_genstats_count4
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_GENSTATS_COUNT4_GET_PPIF_VPATH_GENSTATS_COUNT4
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|vpath_genstats_count5
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|vpath_genstats_count5
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_VPATH_GENSTATS_COUNT5_GET_PPIF_VPATH_GENSTATS_COUNT5
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|status
operator|=
name|__hal_vpath_xmac_tx_stats_get
argument_list|(
name|vpath
argument_list|,
operator|&
name|hw_stats
operator|->
name|tx_stats
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|status
operator|=
name|__hal_vpath_xmac_rx_stats_get
argument_list|(
name|vpath
argument_list|,
operator|&
name|hw_stats
operator|->
name|rx_stats
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_PROG_EVENT_VNUM0_OFFSET
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|prog_event_vnum0
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_PROG_EVENT_VNUM0
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|prog_event_vnum1
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_PROG_EVENT_VNUM1
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|VXGE_HAL_VPATH_STATS_PIO_READ
argument_list|(
name|VXGE_HAL_STATS_VPATH_PROG_EVENT_VNUM2_OFFSET
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|prog_event_vnum2
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_PROG_EVENT_VNUM2
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|prog_event_vnum3
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_STATS_GET_VPATH_PROG_EVENT_VNUM3
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rx_multi_cast_stats
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_multi_cast_frame_discard
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_RX_MULTI_CAST_STATS_GET_FRAME_DISCARD
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rx_frm_transferred
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_frm_transferred
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RX_FRM_TRANSFERRED_GET_RX_FRM_TRANSFERRED
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|rxd_returned
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rxd_returned
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_RXD_RETURNED_GET_RXD_RETURNED
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|dbg_stats_rx_mpa
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_mpa_len_fail_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_DBG_STATS_GET_RX_MPA_LEN_FAIL_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_mpa_mrk_fail_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_DBG_STATS_GET_RX_MPA_MRK_FAIL_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_mpa_crc_fail_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_DBG_STATS_GET_RX_MPA_CRC_FAIL_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|dbg_stats_rx_fau
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_permitted_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_DBG_STATS_GET_RX_FAU_RX_PERMITTED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_vp_reset_discarded_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_DBG_STATS_GET_RX_FAU_RX_VP_RESET_DISCARDED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|rx_wol_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_DBG_STATS_GET_RX_FAU_RX_WOL_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tx_vp_reset_discarded_frms
argument_list|)
expr_stmt|;
name|hw_stats
operator|->
name|tx_vp_reset_discarded_frms
operator|=
operator|(
name|u16
operator|)
name|VXGE_HAL_TX_VP_RESET_DISCARDED_FRMS_GET_TX_VP_RESET_DISCARDED_FRMS
argument_list|(
name|val64
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_vpath_stats_clear - Clear all the statistics of vpath  * @vpath_handle: Virtual path handle.  *  * Clear the statistics of the given vpath.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_vpath_stats_clear
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|stat
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_vpath_handle_t
modifier|*
name|vp
init|=
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
decl_stmt|;
name|vxge_assert
argument_list|(
name|vp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
name|vp
operator|->
name|vpath
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"vpath = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|vpath_handle
argument_list|)
expr_stmt|;
name|vxge_os_memcpy
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hw_stats_sav
argument_list|,
name|vp
operator|->
name|vpath
operator|->
name|hw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|hw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_hw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_os_memzero
argument_list|(
name|vp
operator|->
name|vpath
operator|->
name|sw_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_hal_vpath_stats_sw_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|vxge_hal_vpath_stats_access
argument_list|(
name|vpath_handle
argument_list|,
name|VXGE_HAL_STATS_OP_CLEAR_ALL_VPATH_STATS
argument_list|,
literal|0
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_stats
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_set_fw_api - Setup FW api  * @devh: Device Handle.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_set_fw_api
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|vp_id
parameter_list|,
name|u32
name|action
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u64
name|data0
parameter_list|,
name|u64
name|data1
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|u32
name|fw_memo
init|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL_FW_MEMO
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Assumption: Privileged vpath is zero */
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|data0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|data1
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|val64
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION
argument_list|(
name|action
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_DATA_STRUCT_SEL
argument_list|(
name|fw_memo
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_OFFSET
argument_list|(
name|offset
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
name|vxge_os_wmb
argument_list|()
expr_stmt|;
name|status
operator|=
name|vxge_hal_device_register_poll
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|,
literal|0
argument_list|,
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_STROBE
argument_list|,
name|WAIT_FACTOR
operator|*
name|hldev
operator|->
name|header
operator|.
name|config
operator|.
name|device_poll_millis
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|&
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_RMACJ_STATUS
condition|)
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
else|else
name|status
operator|=
name|VXGE_HAL_FAIL
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_get_active_config - Get active configuration  * @devh: Device Handle.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_get_active_config
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|vxge_hal_xmac_nwif_actconfig
name|req_config
parameter_list|,
name|u64
modifier|*
name|cur_config
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|cmd
init|=
name|VXGE_HAL_XMAC_NWIF_Cmd_Get_Active_Config
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Assumption: Privileged vpath is zero */
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
literal|0
index|]
expr_stmt|;
comment|/* get port mode */
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SET_NWIF_CMD
argument_list|(
name|cmd
argument_list|)
operator||
name|req_config
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_PORT_CTRL
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
block|{
operator|*
name|cur_config
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_set_port_mode - Set dual port mode  * override the default dual port mode  * @devh: Device Handle.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_set_port_mode
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|vxge_hal_xmac_nwif_dp_mode
name|port_mode
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|cmd
init|=
name|VXGE_HAL_XMAC_NWIF_Cmd_SetMode
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
if|if
condition|(
operator|(
name|port_mode
operator|<
name|VXGE_HAL_DP_NP_MODE_DEFAULT
operator|)
operator|||
operator|(
name|port_mode
operator|>
name|VXGE_HAL_DP_NP_MODE_DISABLE_PORT_MGMT
operator|)
condition|)
block|{
name|vxge_os_printf
argument_list|(
literal|"Invalid port mode : %d\n"
argument_list|,
name|port_mode
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_DP_MODE
operator|)
return|;
block|}
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SET_NWIF_CMD
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|data1
operator|=
name|port_mode
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_PORT_CTRL
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_set_port_mode - Set dual port mode  * change behavior on failure *  * @devh: Device Handle.  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_set_behavior_on_failure
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|vxge_hal_xmac_nwif_behavior_on_failure
name|behave_on_failure
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|cmd
init|=
name|VXGE_HAL_XMAC_NWIF_Cmd_CfgSetBehaviourOnFailure
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
if|if
condition|(
operator|(
name|behave_on_failure
operator|<
name|VXGE_HAL_XMAC_NWIF_OnFailure_NoMove
operator|)
operator|||
operator|(
name|behave_on_failure
operator|>
name|VXGE_HAL_XMAC_NWIF_OnFailure_OtherPortBackOnRestore
operator|)
condition|)
block|{
name|vxge_os_printf
argument_list|(
literal|"Invalid setting for failure behavior : %d\n"
argument_list|,
name|behave_on_failure
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_FAIL
operator|)
return|;
block|}
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SET_NWIF_CMD
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|data1
operator|=
name|behave_on_failure
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_PORT_CTRL
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_set_l2switch_mode
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|enum
name|vxge_hal_xmac_nwif_l2_switch_status
name|l2_switch
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|cmd
init|=
name|VXGE_HAL_XMAC_NWIF_Cmd_CfgDualPort_L2SwitchEnable
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
if|if
condition|(
operator|(
name|l2_switch
operator|<
name|VXGE_HAL_XMAC_NWIF_L2_SWITCH_DISABLE
operator|)
operator|||
operator|(
name|l2_switch
operator|>
name|VXGE_HAL_XMAC_NWIF_L2_SWITCH_ENABLE
operator|)
condition|)
block|{
name|vxge_os_printf
argument_list|(
literal|"Invalid setting for failure behavior : %d\n"
argument_list|,
name|l2_switch
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_INVALID_L2_SWITCH_STATE
operator|)
return|;
block|}
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SET_NWIF_CMD
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|data1
operator|=
name|l2_switch
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_FW_MEMO_ACTION_PRIV_NWIF
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Get function mode */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_func_mode_get
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
modifier|*
name|func_mode
parameter_list|)
block|{
name|int
name|vp_id
decl_stmt|;
name|u32
name|action
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* get the first vpath number assigned to this function */
name|vp_id
operator|=
name|hldev
operator|->
name|first_vp_id
expr_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|vp_id
index|]
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_GET_FUNC_MODE
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
name|vp_id
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
literal|0x0
argument_list|,
literal|0x0
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
operator|*
name|func_mode
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_FUNC_MODE
argument_list|(
name|val64
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_func_mode_count
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|func_mode
parameter_list|,
name|u32
modifier|*
name|num_funcs
parameter_list|)
block|{
name|int
name|vp_id
decl_stmt|;
name|u32
name|action
decl_stmt|;
name|u64
name|val64
decl_stmt|,
name|data0
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vp_id
operator|=
name|hldev
operator|->
name|first_vp_id
expr_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
literal|0
index|]
expr_stmt|;
name|data0
operator|=
name|func_mode
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_GET_FUNC_COUNT
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
name|vp_id
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
literal|0x0
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
operator|*
name|num_funcs
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_GET_NUM_FUNC
argument_list|(
name|val64
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_config_vpath_map
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|port_map
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|cmd
init|=
name|VXGE_HAL_XMAC_NWIF_Cmd_CfgDualPort_VPathVector
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_FW_MEMO_ACTION_PRIV_NWIF
expr_stmt|;
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SET_NWIF_CMD
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|data1
operator|=
name|port_map
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_get_vpath_mask
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vf_id
parameter_list|,
name|u32
modifier|*
name|num_vp
parameter_list|,
name|u64
modifier|*
name|data1
parameter_list|)
block|{
name|u32
name|action
decl_stmt|,
name|vhn
init|=
literal|0
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
literal|0
index|]
expr_stmt|;
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_VFID
argument_list|(
name|vf_id
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_VHN
argument_list|(
name|vhn
argument_list|)
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_PRIV_VPATH_ACTION
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
literal|0x0
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
block|{
name|data0
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data0
argument_list|)
expr_stmt|;
operator|*
name|num_vp
operator|=
call|(
name|u32
call|)
argument_list|(
operator|(
name|data0
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_get_vpath_list
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|vf_id
parameter_list|,
name|u64
modifier|*
name|vpath_list
parameter_list|,
name|u32
modifier|*
name|vpath_count
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|;
name|u64
name|pos
decl_stmt|,
name|vpath_mask
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
operator|*
name|vpath_count
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|vxge_hal_get_vpath_mask
argument_list|(
name|devh
argument_list|,
name|vf_id
argument_list|,
name|vpath_count
argument_list|,
operator|&
name|vpath_mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_OK
condition|)
block|{
for|for
control|(
name|i
operator|=
name|VXGE_HAL_VPATH_BMAP_END
init|;
name|i
operator|>=
name|VXGE_HAL_VPATH_BMAP_START
condition|;
name|i
operator|--
control|)
block|{
if|if
condition|(
name|bVAL1
argument_list|(
name|vpath_mask
argument_list|,
name|i
argument_list|)
condition|)
block|{
name|pos
operator|=
name|VXGE_HAL_VPATH_BMAP_END
operator|-
name|i
expr_stmt|;
name|vpath_list
index|[
name|j
index|]
operator|=
name|pos
expr_stmt|;
name|j
operator|++
expr_stmt|;
block|}
block|}
block|}
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_rx_bw_priority_set
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|vp_id
parameter_list|)
block|{
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|action
decl_stmt|,
name|bandwidth
decl_stmt|,
name|priority
decl_stmt|,
name|set
init|=
literal|0
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
literal|0
index|]
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_BW_CONTROL
expr_stmt|;
name|bandwidth
operator|=
operator|(
operator|(
name|vxge_hal_device_t
operator|*
operator|)
operator|(
name|devh
operator|)
operator|)
operator|->
name|config
operator|.
name|vp_config
index|[
name|vp_id
index|]
operator|.
name|bandwidth
expr_stmt|;
name|priority
operator|=
operator|(
operator|(
name|vxge_hal_device_t
operator|*
operator|)
operator|(
name|devh
operator|)
operator|)
operator|->
name|config
operator|.
name|vp_config
index|[
name|vp_id
index|]
operator|.
name|priority
expr_stmt|;
comment|/* 	 * Get bandwidth and priority settings 	 * and perform read-modify-write operation 	 */
name|data0
operator|=
literal|1
expr_stmt|;
name|data0
operator||=
name|vp_id
operator|<<
literal|32
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
goto|goto
name|_exit
goto|;
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
comment|/* Set */
name|data0
operator|=
literal|0
expr_stmt|;
name|data0
operator||=
name|vp_id
operator|<<
literal|32
expr_stmt|;
comment|/* Rx Bandwidth */
if|if
condition|(
name|bandwidth
operator|!=
name|VXGE_HAL_VPATH_BW_LIMIT_DEFAULT
condition|)
block|{
name|set
operator|=
literal|1
expr_stmt|;
name|data1
operator|&=
operator|~
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_RX_MAX_BW
argument_list|(
literal|0xff
argument_list|)
expr_stmt|;
name|bandwidth
operator|=
operator|(
name|bandwidth
operator|*
literal|256
operator|)
operator|/
literal|10000
expr_stmt|;
name|data1
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_RX_MAX_BW
argument_list|(
name|bandwidth
argument_list|)
expr_stmt|;
name|data1
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_VPATH_OR_FUNC
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* Priority */
if|if
condition|(
name|priority
operator|!=
name|VXGE_HAL_VPATH_PRIORITY_DEFAULT
condition|)
block|{
name|set
operator|=
literal|1
expr_stmt|;
name|data1
operator|&=
operator|~
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_RX_PRIORITY
argument_list|(
literal|0x7
argument_list|)
expr_stmt|;
name|data1
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_RX_PRIORITY
argument_list|(
name|priority
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|set
operator|==
literal|1
condition|)
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
name|_exit
label|:
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_tx_bw_priority_set
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|vp_id
parameter_list|)
block|{
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|action
decl_stmt|,
name|bandwidth
decl_stmt|,
name|priority
decl_stmt|,
name|set
init|=
literal|0
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
literal|0
index|]
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_BW_CONTROL
expr_stmt|;
name|bandwidth
operator|=
operator|(
operator|(
name|vxge_hal_device_t
operator|*
operator|)
operator|(
name|devh
operator|)
operator|)
operator|->
name|config
operator|.
name|vp_config
index|[
name|vp_id
index|]
operator|.
name|bandwidth
expr_stmt|;
name|priority
operator|=
operator|(
operator|(
name|vxge_hal_device_t
operator|*
operator|)
operator|(
name|devh
operator|)
operator|)
operator|->
name|config
operator|.
name|vp_config
index|[
name|vp_id
index|]
operator|.
name|priority
expr_stmt|;
comment|/* 	 * Get bandwidth and priority settings and 	 * perform a read-modify-write operation 	 */
name|data0
operator|=
literal|1
expr_stmt|;
name|data0
operator||=
name|vp_id
operator|<<
literal|32
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
goto|goto
name|_exit
goto|;
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
comment|/* Set */
name|data0
operator|=
literal|0
expr_stmt|;
name|data0
operator||=
name|vp_id
operator|<<
literal|32
expr_stmt|;
comment|/* Tx Bandwidth */
if|if
condition|(
name|bandwidth
operator|!=
name|VXGE_HAL_VPATH_BW_LIMIT_DEFAULT
condition|)
block|{
name|set
operator|=
literal|1
expr_stmt|;
name|data1
operator|&=
operator|~
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_TX_MAX_BW
argument_list|(
literal|0xff
argument_list|)
expr_stmt|;
name|bandwidth
operator|=
operator|(
name|bandwidth
operator|*
literal|256
operator|)
operator|/
literal|10000
expr_stmt|;
name|data1
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_TX_MAX_BW
argument_list|(
name|bandwidth
argument_list|)
expr_stmt|;
block|}
comment|/* Priority */
if|if
condition|(
name|priority
operator|!=
name|VXGE_HAL_VPATH_PRIORITY_DEFAULT
condition|)
block|{
name|set
operator|=
literal|1
expr_stmt|;
name|data1
operator|&=
operator|~
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_TX_PRIORITY
argument_list|(
literal|0x7
argument_list|)
expr_stmt|;
name|data1
operator||=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_SET_TX_PRIORITY
argument_list|(
name|priority
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|set
operator|==
literal|1
condition|)
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
name|_exit
label|:
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_bw_priority_get
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|vp_id
parameter_list|,
name|u32
modifier|*
name|bandwidth
parameter_list|,
name|u32
modifier|*
name|priority
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
literal|0
index|]
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_BW_CONTROL
expr_stmt|;
comment|/* Get rx bandwidth and rx priority settings */
name|data0
operator|=
literal|1
expr_stmt|;
name|data0
operator||=
name|vp_id
operator|<<
literal|32
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
return|return
operator|(
name|status
operator|)
return|;
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
operator|*
name|priority
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_RX_PRIORITY
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* 	 * Bandwidth setting is stored in increments of approx. 39 Mb/s 	 * so revert it back to get the b/w value 	 */
operator|*
name|bandwidth
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_RX_MAX_BW
argument_list|(
name|data1
argument_list|)
expr_stmt|;
operator|*
name|bandwidth
operator|=
operator|(
operator|(
operator|*
name|bandwidth
operator|)
operator|*
literal|10000
operator|)
operator|/
literal|256
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_vf_rx_bw_get
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|func_id
parameter_list|,
name|u32
modifier|*
name|bandwidth
parameter_list|,
name|u32
modifier|*
name|priority
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_hal_vpath_reg_t
modifier|*
name|vp_reg
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vp_reg
operator|=
name|hldev
operator|->
name|vpath_reg
index|[
name|func_id
index|]
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_FW_MEMO_ACTION_NON_PRIV_BANDWIDTH_CTRL
expr_stmt|;
comment|/* Get rx bandwidth and rx priority settings */
name|data0
operator|=
literal|3
expr_stmt|;
name|data0
operator||=
name|func_id
operator|<<
literal|32
expr_stmt|;
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
name|func_id
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
return|return
operator|(
name|status
operator|)
return|;
name|data1
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vp_reg
operator|->
name|rts_access_steer_data1
argument_list|)
expr_stmt|;
operator|*
name|priority
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_RX_PRIORITY
argument_list|(
name|data1
argument_list|)
expr_stmt|;
comment|/* 	 * Bandwidth setting is stored in increments of approx. 39 Mb/s 	 * so revert it back to get the b/w value 	 */
operator|*
name|bandwidth
operator|=
operator|(
name|u32
operator|)
name|VXGE_HAL_RTS_ACCESS_STEER_DATA1_GET_RX_MAX_BW
argument_list|(
name|data1
argument_list|)
expr_stmt|;
operator|*
name|bandwidth
operator|=
operator|(
operator|(
operator|*
name|bandwidth
operator|)
operator|*
literal|10000
operator|)
operator|/
literal|256
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_function
name|void
name|vxge_hal_vpath_dynamic_tti_rtimer_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|timer_val
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|,
name|timer
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|val64
operator|=
name|vpath
operator|->
name|tim_tti_cfg3_saved
expr_stmt|;
name|timer
operator|=
operator|(
name|timer_val
operator|*
literal|1000
operator|)
operator|/
literal|272
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
if|if
condition|(
name|timer
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
name|timer
argument_list|)
operator||
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_EVENT_SF
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
comment|/* 	 * tti_cfg3_saved is not updated again because it is 	 * initialized at one place only - init time. 	 */
block|}
end_function

begin_function
name|void
name|vxge_hal_vpath_dynamic_rti_rtimer_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|,
name|u32
name|timer_val
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|,
name|timer
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
name|val64
operator|=
name|vpath
operator|->
name|tim_rti_cfg3_saved
expr_stmt|;
name|timer
operator|=
operator|(
name|timer_val
operator|*
literal|1000
operator|)
operator|/
literal|272
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
literal|0x3ffffff
argument_list|)
expr_stmt|;
if|if
condition|(
name|timer
condition|)
name|val64
operator||=
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_VAL
argument_list|(
name|timer
argument_list|)
operator||
name|VXGE_HAL_TIM_CFG3_INT_NUM_RTIMER_EVENT_SF
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg3_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
comment|/* 	 * rti_cfg3_saved is not updated again because it is 	 * initialized at one place only - init time. 	 */
block|}
end_function

begin_function
name|void
name|vxge_hal_vpath_tti_ci_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|fifo
operator|.
name|enable
operator|==
name|VXGE_HAL_FIFO_ENABLE
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ci_en
operator|!=
name|VXGE_HAL_TIM_TIMER_CI_ENABLE
condition|)
block|{
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ci_en
operator|=
name|VXGE_HAL_TIM_TIMER_CI_ENABLE
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
name|vpath
operator|->
name|tim_rti_cfg1_saved
operator|=
name|val64
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|vxge_hal_vpath_tti_ci_reset
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|fifo
operator|.
name|enable
operator|==
name|VXGE_HAL_FIFO_ENABLE
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ci_en
operator|!=
name|VXGE_HAL_TIM_TIMER_CI_DISABLE
condition|)
block|{
name|vpath
operator|->
name|vp_config
operator|->
name|tti
operator|.
name|timer_ci_en
operator|=
name|VXGE_HAL_TIM_TIMER_CI_DISABLE
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
name|vpath
operator|->
name|tim_rti_cfg1_saved
operator|=
name|val64
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_TX
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|vxge_hal_vpath_rti_ci_set
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_ENABLE
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ci_en
operator|!=
name|VXGE_HAL_TIM_TIMER_CI_ENABLE
condition|)
block|{
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ci_en
operator|=
name|VXGE_HAL_TIM_TIMER_CI_ENABLE
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
name|val64
operator||=
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
name|vpath
operator|->
name|tim_rti_cfg1_saved
operator|=
name|val64
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|vxge_hal_vpath_rti_ci_reset
parameter_list|(
name|vxge_hal_vpath_h
name|vpath_handle
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vpath
operator|=
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|vpath_handle
operator|)
operator|->
name|vpath
expr_stmt|;
name|hldev
operator|=
name|vpath
operator|->
name|hldev
expr_stmt|;
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|ring
operator|.
name|enable
operator|==
name|VXGE_HAL_RING_ENABLE
condition|)
block|{
if|if
condition|(
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ci_en
operator|!=
name|VXGE_HAL_TIM_TIMER_CI_DISABLE
condition|)
block|{
name|vpath
operator|->
name|vp_config
operator|->
name|rti
operator|.
name|timer_ci_en
operator|=
name|VXGE_HAL_TIM_TIMER_CI_DISABLE
expr_stmt|;
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
name|val64
operator|&=
operator|~
name|VXGE_HAL_TIM_CFG1_INT_NUM_TIMER_CI
expr_stmt|;
name|vpath
operator|->
name|tim_rti_cfg1_saved
operator|=
name|val64
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|val64
argument_list|,
operator|&
name|vpath
operator|->
name|vp_reg
operator|->
name|tim_cfg1_int_num
index|[
name|VXGE_HAL_VPATH_INTR_RX
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|vxge_hal_status_e
name|vxge_hal_send_message
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u64
name|vp_id
parameter_list|,
name|u8
name|msg_type
parameter_list|,
name|u8
name|msg_dst
parameter_list|,
name|u32
name|msg_data
parameter_list|,
name|u64
modifier|*
name|msg_sent_to_vpaths
parameter_list|)
block|{
name|u32
name|action
decl_stmt|;
name|u64
name|data0
init|=
literal|0x0
decl_stmt|,
name|data1
init|=
literal|0x0
decl_stmt|;
name|u32
name|attempts
init|=
name|VXGE_HAL_MSG_SEND_RETRY
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|data0
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SEND_MSG_TYPE
argument_list|(
name|msg_type
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SEND_MSG_DEST
argument_list|(
name|msg_dst
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SEND_MSG_SRC
argument_list|(
name|vp_id
argument_list|)
operator||
name|VXGE_HAL_RTS_ACCESS_STEER_DATA0_SEND_MSG_DATA
argument_list|(
name|msg_data
argument_list|)
expr_stmt|;
name|action
operator|=
name|VXGE_HAL_RTS_ACCESS_STEER_CTRL_ACTION_SEND_MSG
expr_stmt|;
do|do
block|{
name|status
operator|=
name|vxge_hal_set_fw_api
argument_list|(
name|devh
argument_list|,
name|vp_id
argument_list|,
name|action
argument_list|,
literal|0x0
argument_list|,
name|data0
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
block|{
name|attempts
operator|--
expr_stmt|;
if|if
condition|(
name|attempts
operator|==
literal|0
condition|)
return|return
operator|(
name|status
operator|)
return|;
block|}
block|}
do|while
condition|(
name|status
operator|!=
name|VXGE_HAL_OK
condition|)
do|;
if|if
condition|(
name|msg_sent_to_vpaths
operator|!=
name|NULL
condition|)
block|{
comment|/* The API returns a vector of VPATHs the message 		* was sent to in the event the destination is a 		* broadcast message or being sent to the privileged VPATH 		*/
operator|*
name|msg_sent_to_vpaths
operator|=
name|data0
operator|&
name|VXGE_HAL_MSG_SEND_TO_VPATH_MASK
expr_stmt|;
block|}
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

end_unit

