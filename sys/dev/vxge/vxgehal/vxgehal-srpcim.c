begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright(c) 2002-2011 Exar Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification are permitted provided the following conditions are met:  *  *    1. Redistributions of source code must retain the above copyright notice,  *       this list of conditions and the following disclaimer.  *  *    2. Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *  *    3. Neither the name of the Exar Corporation nor the names of its  *       contributors may be used to endorse or promote products derived from  *       this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*$FreeBSD$*/
end_comment

begin_include
include|#
directive|include
file|<dev/vxge/vxgehal/vxgehal.h>
end_include

begin_comment
comment|/*  * __hal_srpcim_alarm_process - Process Alarms.  * @hldev: HAL Device  * @srpcim_id: srpcim index  * @skip_alarms: Flag to indicate if not to clear the alarms  *  * Process srpcim alarms.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_srpcim_alarm_process
parameter_list|(
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|srpcim_id
parameter_list|,
name|u32
name|skip_alarms
parameter_list|)
block|{
name|u64
name|val64
decl_stmt|;
name|u64
name|alarm_status
decl_stmt|;
name|u64
name|pic_status
decl_stmt|;
name|u64
name|xgmac_status
decl_stmt|;
name|vxge_hal_srpcim_reg_t
modifier|*
name|srpcim_reg
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|)
expr_stmt|;
name|srpcim_reg
operator|=
name|hldev
operator|->
name|srpcim_reg
index|[
name|srpcim_id
index|]
expr_stmt|;
name|alarm_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_general_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_srpcim_irq
argument_list|(
literal|"alarm_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|alarm_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_SRPCIM_GENERAL_INT_STATUS_XMAC_INT
condition|)
block|{
name|xgmac_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|xgmac_sr_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_srpcim_irq
argument_list|(
literal|"xgmac_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|xgmac_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|xgmac_status
operator|&
name|VXGE_HAL_XGMAC_SR_INT_STATUS_ASIC_NTWK_SR_ERR_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|asic_ntwk_sr_err_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_srpcim_irq
argument_list|(
literal|"asic_ntwk_sr_err_reg = \ 			    0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|asic_ntwk_sr_err_reg
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
name|VXGE_HAL_SRPCIM_GENERAL_INT_STATUS_PIC_INT
condition|)
block|{
name|pic_status
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_ppif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_srpcim_irq
argument_list|(
literal|"pic_status = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|pic_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_SRPCIM_PPIF_INT_STATUS_SRPCIM_GEN_ERRORS_INT
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_gen_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_srpcim_irq
argument_list|(
literal|"srpcim_gen_errors_reg = \ 			    0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_gen_errors_reg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pic_status
operator|&
name|VXGE_HAL_SRPCIM_PPIF_INT_STATUS_MRPCIM_TO_SRPCIM_ALARM
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|mrpcim_to_srpcim_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_srpcim_irq
argument_list|(
literal|"mrpcim_to_srpcim_alarm_reg = \ 			    0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|mrpcim_to_srpcim_alarm_reg
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|alarm_status
operator|&
operator|~
operator|(
name|VXGE_HAL_SRPCIM_GENERAL_INT_STATUS_PIC_INT
operator||
name|VXGE_HAL_SRPCIM_GENERAL_INT_STATUS_XMAC_INT
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"%s:%s:%d Unknown Alarm"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_alarm_process - Process srpcim Alarms.  * @devh: Device Handle.  * @skip_alarms: Flag to indicate if not to clear the alarms  *  * Process srpcim alarms.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_srpcim_alarm_process
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|skip_alarms
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|u64
name|val64
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
operator|)
return|;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
name|val64
operator|=
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|hldev
operator|->
name|mrpcim_reg
operator|->
name|srpcim_to_mrpcim_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"srpcim_to_mrpcim_alarm_reg = \ 		    0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|val64
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|val64
operator|&
name|mBIT
argument_list|(
name|i
argument_list|)
condition|)
block|{
name|status
operator|=
name|__hal_srpcim_alarm_process
argument_list|(
name|hldev
argument_list|,
name|i
argument_list|,
name|skip_alarms
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|skip_alarms
condition|)
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|hldev
operator|->
name|mrpcim_reg
operator|->
name|srpcim_to_mrpcim_alarm_reg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|__hal_srpcim_alarm_process
argument_list|(
name|hldev
argument_list|,
name|hldev
operator|->
name|srpcim_id
argument_list|,
name|skip_alarms
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim_irq
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_srpcim_intr_enable - Enable srpcim interrupts.  * @hldev: Hal Device.  * @srpcim_id: SRPCIM Id  *  * Enable srpcim interrupts.  *  * See also: __hal_srpcim_intr_disable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_srpcim_intr_enable
parameter_list|(
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|srpcim_id
parameter_list|)
block|{
name|vxge_hal_srpcim_reg_t
modifier|*
name|srpcim_reg
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|)
expr_stmt|;
name|srpcim_reg
operator|=
name|hldev
operator|->
name|srpcim_reg
index|[
name|srpcim_id
index|]
expr_stmt|;
name|vxge_os_pio_mem_write64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_gen_errors_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|mrpcim_to_srpcim_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|vpath_to_srpcim_alarm_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_ppif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|mrpcim_msg_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|vpath_msg_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_pcipif_int_status
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|asic_ntwk_sr_err_reg
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|xgmac_sr_int_status
argument_list|)
expr_stmt|;
name|vxge_os_pio_mem_read64
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_general_int_status
argument_list|)
expr_stmt|;
comment|/* Unmask the individual interrupts. */
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|vpath_msg_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
literal|0
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_pcipif_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
operator|~
name|VXGE_HAL_SRPCIM_GENERAL_INT_MASK_PCI_INT
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_general_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_intr_enable - Enable srpcim interrupts.  * @devh: Hal Device.  *  * Enable srpcim interrupts.  *  * See also: vxge_hal_srpcim_intr_disable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_srpcim_intr_enable
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
operator|)
return|;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|__hal_srpcim_intr_enable
argument_list|(
name|hldev
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|status
operator|=
name|__hal_srpcim_intr_enable
argument_list|(
name|hldev
argument_list|,
name|hldev
operator|->
name|srpcim_id
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_srpcim_intr_disable - Disable srpcim interrupts.  * @hldev: Hal Device.  * @srpcim_id: SRPCIM Id  *  * Disable srpcim interrupts.  *  * See also: __hal_srpcim_intr_enable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_srpcim_intr_disable
parameter_list|(
name|__hal_device_t
modifier|*
name|hldev
parameter_list|,
name|u32
name|srpcim_id
parameter_list|)
block|{
name|vxge_hal_srpcim_reg_t
modifier|*
name|srpcim_reg
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|)
expr_stmt|;
name|srpcim_reg
operator|=
name|hldev
operator|->
name|srpcim_reg
index|[
name|srpcim_id
index|]
expr_stmt|;
comment|/* Mask the individual interrupts. */
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|vpath_msg_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_pcipif_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|VXGE_HAL_INTR_MASK_ALL
argument_list|,
operator|&
name|srpcim_reg
operator|->
name|srpcim_general_int_mask
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_intr_disable - Disable srpcim interrupts.  * @devh: Hal Device.  *  * Disable srpcim interrupts.  *  * See also: vxge_hal_srpcim_intr_enable()  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_srpcim_intr_disable
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
operator|)
return|;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|__hal_srpcim_intr_disable
argument_list|(
name|hldev
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|status
operator|=
name|__hal_srpcim_intr_disable
argument_list|(
name|hldev
argument_list|,
name|hldev
operator|->
name|srpcim_id
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_msix_set - Associate MSIX vector with srpcim alarm  * @hldev: HAL device.  * @alarm_msix_id: MSIX vector for alarm.  *  * This API will associate a given MSIX vector numbers with srpcim alarm  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_srpcim_msix_set
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|int
name|alarm_msix_id
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
operator|)
return|;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_INTERRUPT_CFG1_ALARM_MAP_TO_MSG
argument_list|(
name|alarm_msix_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|i
index|]
operator|->
name|srpcim_interrupt_cfg1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_INTERRUPT_CFG1_ALARM_MAP_TO_MSG
argument_list|(
name|alarm_msix_id
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|hldev
operator|->
name|srpcim_id
index|]
operator|->
name|srpcim_interrupt_cfg1
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_msix_mask - Mask MSIX Vector.  * @hldev: HAL device.  *  * The function masks the srpcim msix interrupt  *  */
end_comment

begin_function
name|void
name|vxge_hal_srpcim_msix_mask
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_SET_MSIX_MASK_SRPCIM_SET_MSIX_MASK
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|i
index|]
operator|->
name|srpcim_set_msix_mask
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_SET_MSIX_MASK_SRPCIM_SET_MSIX_MASK
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|hldev
operator|->
name|srpcim_id
index|]
operator|->
name|srpcim_set_msix_mask
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_msix_clear - Clear MSIX Vector.  * @hldev: HAL device.  *  * The function clears the srpcim msix interrupt  *  */
end_comment

begin_function
name|void
name|vxge_hal_srpcim_msix_clear
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_CLEAR_MSIX_MASK_SRPCIM_CLEAR_MSIX_MASK
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|i
index|]
operator|->
name|srpcim_clear_msix_mask
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_CLEAR_MSIX_MASK_SRPCIM_CLEAR_MSIX_MASK
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|hldev
operator|->
name|srpcim_id
index|]
operator|->
name|srpcim_clear_msix_mask
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_srpcim_msix_unmask - Unmask MSIX Vector.  * @hldev: HAL device.  *  * The function unmasks the srpcim msix interrupt  *  */
end_comment

begin_function
name|void
name|vxge_hal_srpcim_msix_unmask
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_MRPCIM
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|VXGE_HAL_TITAN_SRPCIM_REG_SPACES
condition|;
name|i
operator|++
control|)
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_CLR_MSIX_ONE_SHOT_SRPCIM_CLR_MSIX_ONE_SHOT
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|i
index|]
operator|->
name|srpcim_clr_msix_one_shot
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|vxge_hal_pio_mem_write32_upper
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|regh0
argument_list|,
operator|(
name|u32
operator|)
name|bVAL32
argument_list|(
name|VXGE_HAL_SRPCIM_CLR_MSIX_ONE_SHOT_SRPCIM_CLR_MSIX_ONE_SHOT
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|hldev
operator|->
name|srpcim_reg
index|[
name|hldev
operator|->
name|srpcim_id
index|]
operator|->
name|srpcim_clr_msix_one_shot
argument_list|)
expr_stmt|;
block|}
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * __hal_srpcim_initialize - Initialize srpcim.  * @hldev: HAL Device  *  * Initialize srpcim.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_srpcim_initialize
parameter_list|(
name|__hal_device_t
modifier|*
name|hldev
parameter_list|)
block|{
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hldev
operator|->
name|access_rights
operator|&
name|VXGE_HAL_DEVICE_ACCESS_RIGHT_SRPCIM
operator|)
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_PRIVILAGED_OPEARATION
operator|)
return|;
block|}
name|hldev
operator|->
name|srpcim
operator|=
operator|(
name|__hal_srpcim_t
operator|*
operator|)
name|vxge_os_malloc
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_srpcim_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|srpcim
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_OUT_OF_MEMORY
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_ERR_OUT_OF_MEMORY
operator|)
return|;
block|}
name|vxge_os_memzero
argument_list|(
name|hldev
operator|->
name|srpcim
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_srpcim_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_srpcim_terminate - Terminate srpcim.  * @hldev: HAL Device  *  * Terminate srpcim.  *  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_srpcim_terminate
parameter_list|(
name|__hal_device_t
modifier|*
name|hldev
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
init|=
name|VXGE_HAL_OK
decl_stmt|;
name|vxge_assert
argument_list|(
name|hldev
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"hldev = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|hldev
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|srpcim
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
name|vxge_os_free
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|hldev
operator|->
name|srpcim
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_srpcim_t
argument_list|)
argument_list|)
expr_stmt|;
name|hldev
operator|->
name|srpcim
operator|=
name|NULL
expr_stmt|;
name|vxge_hal_trace_log_srpcim
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

end_unit

