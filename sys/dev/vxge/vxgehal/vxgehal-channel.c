begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright(c) 2002-2011 Exar Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification are permitted provided the following conditions are met:  *  *    1. Redistributions of source code must retain the above copyright notice,  *       this list of conditions and the following disclaimer.  *  *    2. Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *  *    3. Neither the name of the Exar Corporation nor the names of its  *       contributors may be used to endorse or promote products derived from  *       this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*$FreeBSD$*/
end_comment

begin_include
include|#
directive|include
file|<dev/vxge/vxgehal/vxgehal.h>
end_include

begin_comment
comment|/*  * vxge_hal_channel_allocate - Allocate memory for channel  * @devh: Handle to the device object  * @vph: Handle to Virtual Path  * @type: Type of channel  * @length: Lengths of arrays  * @per_dtr_space: ULD requested per dtr space to be allocated in priv  * @userdata: User data to be passed back in the callback  *  * This function allocates required memory for the channel and various arrays  * in the channel  */
end_comment

begin_function
name|__hal_channel_t
modifier|*
name|vxge_hal_channel_allocate
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|vxge_hal_vpath_h
name|vph
parameter_list|,
name|__hal_channel_type_e
name|type
parameter_list|,
name|u32
name|length
parameter_list|,
name|u32
name|per_dtr_space
parameter_list|,
name|void
modifier|*
name|userdata
parameter_list|)
block|{
name|vxge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|vxge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__hal_channel_t
modifier|*
name|channel
decl_stmt|;
name|u32
name|i
decl_stmt|,
name|size
init|=
literal|0
decl_stmt|;
name|vxge_assert
argument_list|(
operator|(
name|devh
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|vph
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", vph = "
literal|"0x"
name|VXGE_OS_STXFMT
literal|", type = %d, length = %d, "
literal|"per_dtr_space = %d, userdata = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
operator|(
name|ptr_t
operator|)
name|vph
argument_list|,
name|type
argument_list|,
name|length
argument_list|,
name|per_dtr_space
argument_list|,
operator|(
name|ptr_t
operator|)
name|userdata
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|VXGE_HAL_CHANNEL_TYPE_FIFO
case|:
name|size
operator|=
sizeof|sizeof
argument_list|(
name|__hal_fifo_t
argument_list|)
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_RING
case|:
name|size
operator|=
sizeof|sizeof
argument_list|(
name|__hal_ring_t
argument_list|)
expr_stmt|;
break|break;
default|default:
name|vxge_assert
argument_list|(
name|size
argument_list|)
expr_stmt|;
break|break;
block|}
name|channel
operator|=
operator|(
name|__hal_channel_t
operator|*
operator|)
name|vxge_os_malloc
argument_list|(
name|hldev
operator|->
name|pdev
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_OUT_OF_MEMORY
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|vxge_os_memzero
argument_list|(
name|channel
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|vxge_list_init
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|)
expr_stmt|;
name|channel
operator|->
name|pdev
operator|=
name|hldev
operator|->
name|pdev
expr_stmt|;
name|channel
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|channel
operator|->
name|devh
operator|=
name|devh
expr_stmt|;
name|channel
operator|->
name|vph
operator|=
name|vph
expr_stmt|;
name|channel
operator|->
name|userdata
operator|=
name|userdata
expr_stmt|;
name|channel
operator|->
name|per_dtr_space
operator|=
name|per_dtr_space
expr_stmt|;
name|channel
operator|->
name|length
operator|=
name|length
expr_stmt|;
name|channel
operator|->
name|dtr_arr
operator|=
operator|(
name|__hal_dtr_item_t
operator|*
operator|)
name|vxge_os_malloc
argument_list|(
name|hldev
operator|->
name|pdev
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_dtr_item_t
argument_list|)
operator|*
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|->
name|dtr_arr
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_channel_free
argument_list|(
name|channel
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_HAL_ERR_OUT_OF_MEMORY
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|vxge_os_memzero
argument_list|(
name|channel
operator|->
name|dtr_arr
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_dtr_item_t
argument_list|)
operator|*
name|length
argument_list|)
expr_stmt|;
name|channel
operator|->
name|compl_index
operator|=
literal|0
expr_stmt|;
name|channel
operator|->
name|reserve_index
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
name|channel
operator|->
name|dtr_arr
index|[
name|i
index|]
operator|.
name|state
operator|=
name|VXGE_HAL_CHANNEL_DTR_FREE
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|channel
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_channel_free - Free memory allocated for channel  * @channel: channel to be freed  *  * This function deallocates memory from the channel and various arrays  * in the channel  */
end_comment

begin_function
name|void
name|vxge_hal_channel_free
parameter_list|(
name|__hal_channel_t
modifier|*
name|channel
parameter_list|)
block|{
name|int
name|size
init|=
literal|0
decl_stmt|;
name|vxge_hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|vxge_hal_device_t
operator|*
operator|)
name|channel
operator|->
name|devh
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"channel = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|channel
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|->
name|pdev
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|->
name|dtr_arr
condition|)
block|{
name|vxge_os_free
argument_list|(
name|channel
operator|->
name|pdev
argument_list|,
name|channel
operator|->
name|dtr_arr
argument_list|,
sizeof|sizeof
argument_list|(
name|__hal_dtr_item_t
argument_list|)
operator|*
name|channel
operator|->
name|length
argument_list|)
expr_stmt|;
name|channel
operator|->
name|dtr_arr
operator|=
name|NULL
expr_stmt|;
block|}
switch|switch
condition|(
name|channel
operator|->
name|type
condition|)
block|{
case|case
name|VXGE_HAL_CHANNEL_TYPE_FIFO
case|:
name|size
operator|=
sizeof|sizeof
argument_list|(
name|__hal_fifo_t
argument_list|)
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_RING
case|:
name|size
operator|=
sizeof|sizeof
argument_list|(
name|__hal_ring_t
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|vxge_os_free
argument_list|(
name|channel
operator|->
name|pdev
argument_list|,
name|channel
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * __hal_channel_initialize - Initialize a channel  * @channel: channel to be initialized  *  * This function initializes a channel by properly  *		setting the various references  */
end_comment

begin_function
name|vxge_hal_status_e
name|vxge_hal_channel_initialize
parameter_list|(
name|__hal_channel_t
modifier|*
name|channel
parameter_list|)
block|{
name|vxge_hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|vxge_hal_device_t
operator|*
operator|)
name|channel
operator|->
name|devh
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|channel
operator|->
name|vph
operator|)
operator|->
name|vpath
expr_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"channel = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|channel
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel
operator|->
name|type
condition|)
block|{
case|case
name|VXGE_HAL_CHANNEL_TYPE_FIFO
case|:
name|vpath
operator|->
name|fifoh
operator|=
operator|(
name|vxge_hal_fifo_h
operator|)
name|channel
expr_stmt|;
name|channel
operator|->
name|stats
operator|=
operator|&
operator|(
operator|(
name|__hal_fifo_t
operator|*
operator|)
name|channel
operator|)
operator|->
name|stats
operator|->
name|common_stats
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_RING
case|:
name|vpath
operator|->
name|ringh
operator|=
operator|(
name|vxge_hal_ring_h
operator|)
name|channel
expr_stmt|;
name|channel
operator|->
name|stats
operator|=
operator|&
operator|(
operator|(
name|__hal_ring_t
operator|*
operator|)
name|channel
operator|)
operator|->
name|stats
operator|->
name|common_stats
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|channel
operator|->
name|is_initd
operator|=
literal|1
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * __hal_channel_reset - Resets a channel  * @channel: channel to be reset  *  * This function resets a channel by properly setting the various references  */
end_comment

begin_function
name|vxge_hal_status_e
name|__hal_channel_reset
parameter_list|(
name|__hal_channel_t
modifier|*
name|channel
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|channel
operator|->
name|devh
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"channel = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|channel
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|->
name|pdev
argument_list|)
expr_stmt|;
name|channel
operator|->
name|compl_index
operator|=
literal|0
expr_stmt|;
name|channel
operator|->
name|reserve_index
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|channel
operator|->
name|length
condition|;
name|i
operator|++
control|)
block|{
name|channel
operator|->
name|dtr_arr
index|[
name|i
index|]
operator|.
name|state
operator|=
name|VXGE_HAL_CHANNEL_DTR_FREE
expr_stmt|;
block|}
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_HAL_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_hal_channel_terminate - Deinitializes a channel  * @channel: channel to be deinitialized  *  * This function deinitializes a channel by properly  *		setting the various references  */
end_comment

begin_function
name|void
name|vxge_hal_channel_terminate
parameter_list|(
name|__hal_channel_t
modifier|*
name|channel
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|__hal_virtualpath_t
modifier|*
name|vpath
decl_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|channel
operator|||
operator|!
name|channel
operator|->
name|is_initd
condition|)
return|return;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|channel
operator|->
name|devh
expr_stmt|;
name|vpath
operator|=
operator|(
name|__hal_virtualpath_t
operator|*
operator|)
operator|(
operator|(
name|__hal_vpath_handle_t
operator|*
operator|)
name|channel
operator|->
name|vph
operator|)
operator|->
name|vpath
expr_stmt|;
name|vxge_assert
argument_list|(
name|vpath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"channel = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|channel
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel
operator|->
name|type
condition|)
block|{
case|case
name|VXGE_HAL_CHANNEL_TYPE_FIFO
case|:
name|vpath
operator|->
name|fifoh
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_RING
case|:
name|vpath
operator|->
name|ringh
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_SEND_QUEUE
case|:
name|vxge_list_remove
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|obj_counts
operator|.
name|no_sqs
operator|--
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_RECEIVE_QUEUE
case|:
name|vxge_list_remove
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|obj_counts
operator|.
name|no_srqs
operator|--
expr_stmt|;
break|break;
case|case
name|VXGE_HAL_CHANNEL_TYPE_COMPLETION_QUEUE
case|:
name|vxge_list_remove
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|)
expr_stmt|;
name|vpath
operator|->
name|sw_stats
operator|->
name|obj_counts
operator|.
name|no_cqrqs
operator|--
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|__hal_channel_init_pending_list
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
name|vxge_list_init
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_list
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_VP_CHANNELS
argument_list|)
name|vxge_os_spin_lock_init
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|hldev
operator|->
name|pdev
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_VP_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_lock_init_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|hldev
operator|->
name|irqh
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|__hal_channel_insert_pending_list
parameter_list|(
name|__hal_channel_t
modifier|*
name|channel
parameter_list|)
block|{
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|channel
operator|->
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|channel
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"channel = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|channel
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_lock
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_lock_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_list_insert_before
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|,
operator|&
name|hldev
operator|->
name|pending_channel_list
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_unlock
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|__hal_channel_process_pending_list
argument_list|(
name|channel
operator|->
name|devh
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|__hal_channel_process_pending_list
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|vxge_hal_status_e
name|status
decl_stmt|;
name|__hal_channel_t
modifier|*
name|channel
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_lock
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_lock_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|channel
operator|=
operator|(
name|__hal_channel_t
operator|*
operator|)
name|vxge_list_first_get
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_list
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|!=
name|NULL
condition|)
name|vxge_list_remove
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_unlock
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|channel
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|channel
operator|->
name|type
condition|)
block|{
default|default:
name|status
operator|=
name|VXGE_HAL_OK
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|VXGE_HAL_ERR_OUT_OF_MEMORY
condition|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_lock
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_lock_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_list_insert
argument_list|(
operator|&
name|channel
operator|->
name|item
argument_list|,
operator|&
name|hldev
operator|->
name|pending_channel_list
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_unlock
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
block|}
end_function

begin_function
name|void
name|__hal_channel_destroy_pending_list
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|)
block|{
name|vxge_list_t
modifier|*
name|p
decl_stmt|,
modifier|*
name|n
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_channel
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|)
expr_stmt|;
name|vxge_list_for_each_safe
argument_list|(
argument|p
argument_list|,
argument|n
argument_list|,
argument|&hldev->pending_channel_list
argument_list|)
block|{
name|vxge_list_remove
argument_list|(
name|p
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
operator|(
name|__hal_channel_t
operator|*
operator|)
name|p
operator|)
operator|->
name|type
condition|)
block|{
default|default:
break|break;
block|}
block|}
if|#
directive|if
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS
argument_list|)
name|vxge_os_spin_lock_destroy
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|VXGE_HAL_PENDING_CHANNELS_IRQ
argument_list|)
name|vxge_os_spin_lock_destroy_irq
argument_list|(
operator|&
name|hldev
operator|->
name|pending_channel_lock
argument_list|,
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|vxge_hal_trace_log_channel
argument_list|(
literal|"<== %s:%s:%d  Result: 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

