begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * SPDX-License-Identifier: BSD-3-Clause  *  * Copyright(c) 2002-2011 Exar Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification are permitted provided the following conditions are met:  *  *    1. Redistributions of source code must retain the above copyright notice,  *       this list of conditions and the following disclaimer.  *  *    2. Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *  *    3. Neither the name of the Exar Corporation nor the names of its  *       contributors may be used to endorse or promote products derived from  *       this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*$FreeBSD$*/
end_comment

begin_include
include|#
directive|include
file|<dev/vxge/vxgehal/vxgehal.h>
end_include

begin_comment
comment|/*  * vxge_queue_item_data - Get item's data.  * @item: Queue item.  *  * Returns:  item data(variable size). Note that vxge_queue_t  * contains items comprized of a fixed vxge_queue_item_t "header"  * and a variable size data. This function returns the variable  * user-defined portion of the queue item.  */
end_comment

begin_function
name|void
modifier|*
name|vxge_queue_item_data
parameter_list|(
name|vxge_queue_item_t
modifier|*
name|item
parameter_list|)
block|{
return|return
operator|(
name|char
operator|*
operator|)
name|item
operator|+
sizeof|sizeof
argument_list|(
name|vxge_queue_item_t
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * __queue_consume - (Lockless) dequeue an item from the specified queue.  *  * @queue: Event queue.  * @data_max_size: Maximum size of the data  * @item: Queue item  * See vxge_queue_consume().  */
end_comment

begin_function
specifier|static
name|vxge_queue_status_e
name|__queue_consume
parameter_list|(
name|vxge_queue_t
modifier|*
name|queue
parameter_list|,
name|u32
name|data_max_size
parameter_list|,
name|vxge_queue_item_t
modifier|*
name|item
parameter_list|)
block|{
name|int
name|real_size
decl_stmt|;
name|vxge_queue_item_t
modifier|*
name|elem
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|queue
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queue = 0x"
name|VXGE_OS_STXFMT
literal|", size = %d, item = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
argument_list|,
name|data_max_size
argument_list|,
operator|(
name|ptr_t
operator|)
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|vxge_list_is_empty
argument_list|(
operator|&
name|queue
operator|->
name|list_head
argument_list|)
condition|)
block|{
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_IS_EMPTY
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_IS_EMPTY
operator|)
return|;
block|}
name|elem
operator|=
operator|(
name|vxge_queue_item_t
operator|*
operator|)
name|queue
operator|->
name|list_head
operator|.
name|next
expr_stmt|;
if|if
condition|(
name|elem
operator|->
name|data_size
operator|>
name|data_max_size
condition|)
block|{
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_NOT_ENOUGH_SPACE
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_NOT_ENOUGH_SPACE
operator|)
return|;
block|}
name|vxge_list_remove
argument_list|(
operator|&
name|elem
operator|->
name|item
argument_list|)
expr_stmt|;
name|real_size
operator|=
name|elem
operator|->
name|data_size
operator|+
sizeof|sizeof
argument_list|(
name|vxge_queue_item_t
argument_list|)
expr_stmt|;
if|if
condition|(
name|queue
operator|->
name|head_ptr
operator|==
name|elem
condition|)
block|{
name|queue
operator|->
name|head_ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|head_ptr
operator|+
name|real_size
expr_stmt|;
name|vxge_hal_info_log_queue
argument_list|(
literal|"event_type: %d \ 		    removing from the head: "
literal|"0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x0x"
name|VXGE_OS_STXFMT
literal|" elem 0x0x"
name|VXGE_OS_STXFMT
literal|" length %d"
argument_list|,
name|elem
operator|->
name|event_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|start_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|head_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|tail_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|end_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|elem
argument_list|,
name|real_size
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|tail_ptr
operator|-
name|real_size
operator|==
operator|(
name|char
operator|*
operator|)
name|elem
condition|)
block|{
name|queue
operator|->
name|tail_ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|tail_ptr
operator|-
name|real_size
expr_stmt|;
name|vxge_hal_info_log_queue
argument_list|(
literal|"event_type: %d \ 		    removing from the tail: "
literal|"0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|" elem 0x"
name|VXGE_OS_STXFMT
literal|" length %d"
argument_list|,
name|elem
operator|->
name|event_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|start_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|head_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|tail_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|end_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|elem
argument_list|,
name|real_size
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_hal_info_log_queue
argument_list|(
literal|"event_type: %d \ 		    removing from the list: "
literal|"0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|" elem 0x"
name|VXGE_OS_STXFMT
literal|" length %d"
argument_list|,
name|elem
operator|->
name|event_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|start_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|head_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|tail_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|end_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|elem
argument_list|,
name|real_size
argument_list|)
expr_stmt|;
block|}
name|vxge_assert
argument_list|(
name|queue
operator|->
name|tail_ptr
operator|>=
name|queue
operator|->
name|head_ptr
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|queue
operator|->
name|tail_ptr
operator|>=
name|queue
operator|->
name|start_ptr
operator|&&
name|queue
operator|->
name|tail_ptr
operator|<=
name|queue
operator|->
name|end_ptr
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|queue
operator|->
name|head_ptr
operator|>=
name|queue
operator|->
name|start_ptr
operator|&&
name|queue
operator|->
name|head_ptr
operator|<
name|queue
operator|->
name|end_ptr
argument_list|)
expr_stmt|;
name|vxge_os_memcpy
argument_list|(
name|item
argument_list|,
name|elem
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_queue_item_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_os_memcpy
argument_list|(
name|vxge_queue_item_data
argument_list|(
name|item
argument_list|)
argument_list|,
name|vxge_queue_item_data
argument_list|(
name|elem
argument_list|)
argument_list|,
name|elem
operator|->
name|data_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|vxge_list_is_empty
argument_list|(
operator|&
name|queue
operator|->
name|list_head
argument_list|)
condition|)
block|{
comment|/* reset buffer pointers just to be clean */
name|queue
operator|->
name|head_ptr
operator|=
name|queue
operator|->
name|tail_ptr
operator|=
name|queue
operator|->
name|start_ptr
expr_stmt|;
block|}
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_queue_produce - Enqueue an item (see vxge_queue_item_t {})  *			 into the specified queue.  * @queueh: Queue handle.  * @event_type: Event type. One of the enumerated event types  *		 that both consumer and producer "understand".  *		 For an example, please refer to vxge_hal_event_e.  * @context: Opaque (void *) "context", for instance event producer object.  * @is_critical: For critical event, e.g. ECC.  * @data_size: Size of the @data.  * @data: User data of variable @data_size that is _copied_ into  *	the new queue item (see vxge_queue_item_t {}). Upon return  *	from the call the @data memory can be re-used or released.  *  * Enqueue a new item.  *  * Returns: VXGE_QUEUE_OK - success.  * VXGE_QUEUE_IS_FULL - Queue is full.  * VXGE_QUEUE_OUT_OF_MEMORY - Memory allocation failed.  *  * See also: vxge_queue_item_t {}, vxge_queue_consume().  */
end_comment

begin_function
name|vxge_queue_status_e
name|vxge_queue_produce
parameter_list|(
name|vxge_queue_h
name|queueh
parameter_list|,
name|u32
name|event_type
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u32
name|is_critical
parameter_list|,
specifier|const
name|u32
name|data_size
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
name|vxge_queue_t
modifier|*
name|queue
init|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|queueh
decl_stmt|;
name|int
name|real_size
init|=
name|data_size
operator|+
sizeof|sizeof
argument_list|(
name|vxge_queue_item_t
argument_list|)
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_queue_item_t
modifier|*
name|elem
decl_stmt|;
name|unsigned
name|long
name|flags
init|=
literal|0
decl_stmt|;
name|vxge_assert
argument_list|(
name|queueh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queueh = 0x"
name|VXGE_OS_STXFMT
literal|", event_type = %d, "
literal|"context = 0x"
name|VXGE_OS_STXFMT
literal|", is_critical = %d, "
literal|"data_size = %d, data = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queueh
argument_list|,
name|event_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|context
argument_list|,
name|is_critical
argument_list|,
name|data_size
argument_list|,
operator|(
name|ptr_t
operator|)
name|data
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|real_size
operator|<=
name|VXGE_QUEUE_BUF_SIZE
argument_list|)
expr_stmt|;
name|vxge_os_spin_lock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_critical
operator|&&
operator|!
name|queue
operator|->
name|has_critical_event
condition|)
block|{
name|unsigned
name|char
name|item_buf
index|[
sizeof|sizeof
argument_list|(
name|vxge_queue_item_t
argument_list|)
operator|+
name|VXGE_DEFAULT_EVENT_MAX_DATA_SIZE
index|]
decl_stmt|;
name|vxge_queue_item_t
modifier|*
name|item
init|=
operator|(
name|vxge_queue_item_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
name|item_buf
decl_stmt|;
while|while
condition|(
name|__queue_consume
argument_list|(
name|queue
argument_list|,
name|VXGE_DEFAULT_EVENT_MAX_DATA_SIZE
argument_list|,
name|item
argument_list|)
operator|!=
name|VXGE_QUEUE_IS_EMPTY
condition|)
block|{ 		}
comment|/* do nothing */
block|}
name|try_again
label|:
if|if
condition|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|tail_ptr
operator|+
name|real_size
operator|<=
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|end_ptr
condition|)
block|{
name|elem
operator|=
operator|(
name|vxge_queue_item_t
operator|*
operator|)
name|queue
operator|->
name|tail_ptr
expr_stmt|;
name|queue
operator|->
name|tail_ptr
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|tail_ptr
operator|+
name|real_size
operator|)
expr_stmt|;
name|vxge_hal_info_log_queue
argument_list|(
literal|"event_type: %d adding to the tail: "
literal|"0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|" elem 0x"
name|VXGE_OS_STXFMT
literal|" length %d"
argument_list|,
name|event_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|start_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|head_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|tail_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|end_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|elem
argument_list|,
name|real_size
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|head_ptr
operator|-
name|real_size
operator|>=
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|start_ptr
condition|)
block|{
name|elem
operator|=
operator|(
name|vxge_queue_item_t
operator|*
operator|)
operator|(
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|head_ptr
operator|-
name|real_size
operator|)
operator|)
expr_stmt|;
name|queue
operator|->
name|head_ptr
operator|=
name|elem
expr_stmt|;
name|vxge_hal_info_log_queue
argument_list|(
literal|"event_type: %d adding to the head: "
literal|"0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|":"
literal|"0x"
name|VXGE_OS_STXFMT
literal|":0x"
name|VXGE_OS_STXFMT
literal|" length %d"
argument_list|,
name|event_type
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|start_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|head_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|tail_ptr
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
operator|->
name|end_ptr
argument_list|,
name|real_size
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vxge_queue_status_e
name|status
decl_stmt|;
if|if
condition|(
name|queue
operator|->
name|pages_current
operator|>=
name|queue
operator|->
name|pages_max
condition|)
block|{
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_IS_FULL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_IS_FULL
operator|)
return|;
block|}
if|if
condition|(
name|queue
operator|->
name|has_critical_event
condition|)
block|{
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_IS_FULL
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_IS_FULL
operator|)
return|;
block|}
comment|/* grow */
name|status
operator|=
name|vxge_io_queue_grow
argument_list|(
name|queueh
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|VXGE_QUEUE_OK
condition|)
block|{
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
goto|goto
name|try_again
goto|;
block|}
name|vxge_assert
argument_list|(
name|queue
operator|->
name|tail_ptr
operator|>=
name|queue
operator|->
name|head_ptr
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|queue
operator|->
name|tail_ptr
operator|>=
name|queue
operator|->
name|start_ptr
operator|&&
name|queue
operator|->
name|tail_ptr
operator|<=
name|queue
operator|->
name|end_ptr
argument_list|)
expr_stmt|;
name|vxge_assert
argument_list|(
name|queue
operator|->
name|head_ptr
operator|>=
name|queue
operator|->
name|start_ptr
operator|&&
name|queue
operator|->
name|head_ptr
operator|<
name|queue
operator|->
name|end_ptr
argument_list|)
expr_stmt|;
name|elem
operator|->
name|data_size
operator|=
name|data_size
expr_stmt|;
name|elem
operator|->
name|event_type
operator|=
operator|(
name|vxge_hal_event_e
operator|)
name|event_type
expr_stmt|;
name|elem
operator|->
name|is_critical
operator|=
name|is_critical
expr_stmt|;
if|if
condition|(
name|is_critical
condition|)
name|queue
operator|->
name|has_critical_event
operator|=
literal|1
expr_stmt|;
name|elem
operator|->
name|context
operator|=
name|context
expr_stmt|;
name|vxge_os_memcpy
argument_list|(
name|vxge_queue_item_data
argument_list|(
name|elem
argument_list|)
argument_list|,
name|data
argument_list|,
name|data_size
argument_list|)
expr_stmt|;
name|vxge_list_insert_before
argument_list|(
operator|&
name|elem
operator|->
name|item
argument_list|,
operator|&
name|queue
operator|->
name|list_head
argument_list|)
expr_stmt|;
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
comment|/* no lock taken! */
name|queue
operator|->
name|queued_func
argument_list|(
name|queue
operator|->
name|queued_data
argument_list|,
name|event_type
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_queue_create - Create protected first-in-first-out queue.  * @devh: HAL device handle.  * @pages_initial: Number of pages to be initially allocated at the  * time of queue creation.  * @pages_max: Max number of pages that can be allocated in the queue.  * @queued_func: Optional callback function to be called each time a new item is  * added to the queue.  * @queued_data: Argument to the callback function.  *  * Create protected (fifo) queue.  *  * Returns: Pointer to vxge_queue_t structure,  * NULL - on failure.  *  * See also: vxge_queue_item_t {}, vxge_queue_destroy().  */
end_comment

begin_function
name|vxge_queue_h
name|vxge_queue_create
parameter_list|(
name|vxge_hal_device_h
name|devh
parameter_list|,
name|u32
name|pages_initial
parameter_list|,
name|u32
name|pages_max
parameter_list|,
name|vxge_queued_f
name|queued_func
parameter_list|,
name|void
modifier|*
name|queued_data
parameter_list|)
block|{
name|vxge_queue_t
modifier|*
name|queue
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|vxge_assert
argument_list|(
name|devh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"devh = 0x"
name|VXGE_OS_STXFMT
literal|", pages_initial = %d, "
literal|"pages_max = %d, queued_func = 0x"
name|VXGE_OS_STXFMT
literal|", "
literal|"queued_data = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|devh
argument_list|,
name|pages_initial
argument_list|,
name|pages_max
argument_list|,
operator|(
name|ptr_t
operator|)
name|queued_func
argument_list|,
operator|(
name|ptr_t
operator|)
name|queued_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|queue
operator|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|vxge_os_malloc
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_queue_t
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_OUT_OF_MEMORY
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|queue
operator|->
name|queued_func
operator|=
name|queued_func
expr_stmt|;
name|queue
operator|->
name|queued_data
operator|=
name|queued_data
expr_stmt|;
name|queue
operator|->
name|hldev
operator|=
name|devh
expr_stmt|;
name|queue
operator|->
name|pdev
operator|=
name|hldev
operator|->
name|header
operator|.
name|pdev
expr_stmt|;
name|queue
operator|->
name|irqh
operator|=
name|hldev
operator|->
name|header
operator|.
name|irqh
expr_stmt|;
name|queue
operator|->
name|pages_current
operator|=
name|pages_initial
expr_stmt|;
name|queue
operator|->
name|start_ptr
operator|=
name|vxge_os_malloc
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|queue
operator|->
name|pages_current
operator|*
name|VXGE_QUEUE_BUF_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|queue
operator|->
name|start_ptr
operator|==
name|NULL
condition|)
block|{
name|vxge_os_free
argument_list|(
name|hldev
operator|->
name|header
operator|.
name|pdev
argument_list|,
name|queue
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_queue_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_OUT_OF_MEMORY
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|queue
operator|->
name|head_ptr
operator|=
name|queue
operator|->
name|tail_ptr
operator|=
name|queue
operator|->
name|start_ptr
expr_stmt|;
name|queue
operator|->
name|end_ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|start_ptr
operator|+
name|queue
operator|->
name|pages_current
operator|*
name|VXGE_QUEUE_BUF_SIZE
expr_stmt|;
name|vxge_os_spin_lock_init_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|queue
operator|->
name|irqh
argument_list|)
expr_stmt|;
name|queue
operator|->
name|pages_initial
operator|=
name|pages_initial
expr_stmt|;
name|queue
operator|->
name|pages_max
operator|=
name|pages_max
expr_stmt|;
name|vxge_list_init
argument_list|(
operator|&
name|queue
operator|->
name|list_head
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|queue
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_queue_destroy - Destroy vxge_queue_t object.  * @queueh: Queue handle.  *  * Destroy the specified vxge_queue_t object.  *  * See also: vxge_queue_item_t {}, vxge_queue_create().  */
end_comment

begin_function
name|void
name|vxge_queue_destroy
parameter_list|(
name|vxge_queue_h
name|queueh
parameter_list|)
block|{
name|vxge_queue_t
modifier|*
name|queue
init|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|queueh
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|queueh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queueh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queueh
argument_list|)
expr_stmt|;
name|vxge_os_spin_lock_destroy_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|queue
operator|->
name|irqh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|vxge_list_is_empty
argument_list|(
operator|&
name|queue
operator|->
name|list_head
argument_list|)
condition|)
block|{
name|vxge_hal_trace_log_queue
argument_list|(
literal|"destroying non-empty queue 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
argument_list|)
expr_stmt|;
block|}
name|vxge_os_free
argument_list|(
name|queue
operator|->
name|pdev
argument_list|,
name|queue
operator|->
name|start_ptr
argument_list|,
name|queue
operator|->
name|pages_current
operator|*
name|VXGE_QUEUE_BUF_SIZE
argument_list|)
expr_stmt|;
name|vxge_os_free
argument_list|(
name|queue
operator|->
name|pdev
argument_list|,
name|queue
argument_list|,
sizeof|sizeof
argument_list|(
name|vxge_queue_t
argument_list|)
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_io_queue_grow - Dynamically increases the size of the queue.  * @queueh: Queue handle.  *  * This function is called in the case of no slot avaialble in the queue  * to accommodate the newly received event.  * Note that queue cannot grow beyond the max size specified for the  * queue.  *  * Returns VXGE_QUEUE_OK: On success.  * VXGE_QUEUE_OUT_OF_MEMORY : No memory is available.  */
end_comment

begin_function
name|vxge_queue_status_e
name|vxge_io_queue_grow
parameter_list|(
name|vxge_queue_h
name|queueh
parameter_list|)
block|{
name|vxge_queue_t
modifier|*
name|queue
init|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|queueh
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|void
modifier|*
name|newbuf
decl_stmt|,
modifier|*
name|oldbuf
decl_stmt|;
name|vxge_list_t
modifier|*
name|item
decl_stmt|;
name|vxge_queue_item_t
modifier|*
name|elem
decl_stmt|;
name|vxge_assert
argument_list|(
name|queueh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queueh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queueh
argument_list|)
expr_stmt|;
name|vxge_hal_info_log_queue
argument_list|(
literal|"queue 0x"
name|VXGE_OS_STXFMT
literal|":%d is growing"
argument_list|,
operator|(
name|ptr_t
operator|)
name|queue
argument_list|,
name|queue
operator|->
name|pages_current
argument_list|)
expr_stmt|;
name|newbuf
operator|=
name|vxge_os_malloc
argument_list|(
name|queue
operator|->
name|pdev
argument_list|,
operator|(
name|queue
operator|->
name|pages_current
operator|+
literal|1
operator|)
operator|*
name|VXGE_QUEUE_BUF_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|newbuf
operator|==
name|NULL
condition|)
block|{
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|VXGE_QUEUE_OUT_OF_MEMORY
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_OUT_OF_MEMORY
operator|)
return|;
block|}
name|vxge_os_memcpy
argument_list|(
name|newbuf
argument_list|,
name|queue
operator|->
name|start_ptr
argument_list|,
name|queue
operator|->
name|pages_current
operator|*
name|VXGE_QUEUE_BUF_SIZE
argument_list|)
expr_stmt|;
name|oldbuf
operator|=
name|queue
operator|->
name|start_ptr
expr_stmt|;
comment|/* adjust queue sizes */
name|queue
operator|->
name|start_ptr
operator|=
name|newbuf
expr_stmt|;
name|queue
operator|->
name|end_ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
operator|(
name|queue
operator|->
name|pages_current
operator|+
literal|1
operator|)
operator|*
name|VXGE_QUEUE_BUF_SIZE
expr_stmt|;
name|queue
operator|->
name|tail_ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
comment|/* LINTED */
operator|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|tail_ptr
operator|-
operator|(
name|char
operator|*
operator|)
name|oldbuf
operator|)
expr_stmt|;
name|queue
operator|->
name|head_ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
comment|/* LINTED */
operator|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|head_ptr
operator|-
operator|(
name|char
operator|*
operator|)
name|oldbuf
operator|)
expr_stmt|;
name|vxge_assert
argument_list|(
operator|!
name|vxge_list_is_empty
argument_list|(
operator|&
name|queue
operator|->
name|list_head
argument_list|)
argument_list|)
expr_stmt|;
name|queue
operator|->
name|list_head
operator|.
name|next
operator|=
operator|(
name|vxge_list_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
comment|/* LINTED */
operator|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|list_head
operator|.
name|next
operator|-
operator|(
name|char
operator|*
operator|)
name|oldbuf
operator|)
operator|)
expr_stmt|;
name|queue
operator|->
name|list_head
operator|.
name|prev
operator|=
operator|(
name|vxge_list_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
comment|/* LINTED */
operator|(
operator|(
name|char
operator|*
operator|)
name|queue
operator|->
name|list_head
operator|.
name|prev
operator|-
operator|(
name|char
operator|*
operator|)
name|oldbuf
operator|)
operator|)
expr_stmt|;
comment|/* adjust queue list */
name|vxge_list_for_each
argument_list|(
argument|item
argument_list|,
argument|&queue->list_head
argument_list|)
block|{
name|elem
operator|=
name|vxge_container_of
argument_list|(
name|item
argument_list|,
name|vxge_queue_item_t
argument_list|,
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|elem
operator|->
name|item
operator|.
name|next
operator|!=
operator|&
name|queue
operator|->
name|list_head
condition|)
block|{
name|elem
operator|->
name|item
operator|.
name|next
operator|=
operator|(
name|vxge_list_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
comment|/* LINTED */
operator|(
operator|(
name|char
operator|*
operator|)
name|elem
operator|->
name|item
operator|.
name|next
operator|-
operator|(
name|char
operator|*
operator|)
name|oldbuf
operator|)
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|elem
operator|->
name|item
operator|.
name|prev
operator|!=
operator|&
name|queue
operator|->
name|list_head
condition|)
block|{
name|elem
operator|->
name|item
operator|.
name|prev
operator|=
operator|(
name|vxge_list_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|newbuf
operator|+
comment|/* LINTED */
operator|(
operator|(
name|char
operator|*
operator|)
name|elem
operator|->
name|item
operator|.
name|prev
operator|-
operator|(
name|char
operator|*
operator|)
name|oldbuf
operator|)
operator|)
expr_stmt|;
block|}
block|}
name|vxge_os_free
argument_list|(
name|queue
operator|->
name|pdev
argument_list|,
name|oldbuf
argument_list|,
name|queue
operator|->
name|pages_current
operator|*
name|VXGE_QUEUE_BUF_SIZE
argument_list|)
expr_stmt|;
name|queue
operator|->
name|pages_current
operator|++
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|VXGE_QUEUE_OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_queue_consume - Dequeue an item from the specified queue.  * @queueh: Queue handle.  * @data_max_size: Maximum expected size of the item.  * @item: Memory area into which the item is _copied_ upon return  *	from the function.  *  * Dequeue an item from the queue. The caller is required to provide  * enough space for the item.  *  * Returns: VXGE_QUEUE_OK - success.  * VXGE_QUEUE_IS_EMPTY - Queue is empty.  * VXGE_QUEUE_NOT_ENOUGH_SPACE - Requested item size(@data_max_size)  * is too small to accommodate an item from the queue.  *  * See also: vxge_queue_item_t {}, vxge_queue_produce().  */
end_comment

begin_function
name|vxge_queue_status_e
name|vxge_queue_consume
parameter_list|(
name|vxge_queue_h
name|queueh
parameter_list|,
name|u32
name|data_max_size
parameter_list|,
name|vxge_queue_item_t
modifier|*
name|item
parameter_list|)
block|{
name|vxge_queue_t
modifier|*
name|queue
init|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|queueh
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|unsigned
name|long
name|flags
init|=
literal|0
decl_stmt|;
name|vxge_queue_status_e
name|status
decl_stmt|;
name|vxge_assert
argument_list|(
name|queueh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queueh = 0x"
name|VXGE_OS_STXFMT
literal|", data_max_size = %d, "
literal|"item = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queueh
argument_list|,
name|data_max_size
argument_list|,
operator|(
name|ptr_t
operator|)
name|item
argument_list|)
expr_stmt|;
name|vxge_os_spin_lock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|status
operator|=
name|__queue_consume
argument_list|(
name|queue
argument_list|,
name|data_max_size
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|vxge_os_spin_unlock_irq
argument_list|(
operator|&
name|queue
operator|->
name|lock
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = %d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * vxge_queue_flush - Flush, or empty, the queue.  * @queueh: Queue handle.  *  * Flush the queue, i.e. make it empty by consuming all events  * without invoking the event processing logic (callbacks, etc.)  */
end_comment

begin_function
name|void
name|vxge_queue_flush
parameter_list|(
name|vxge_queue_h
name|queueh
parameter_list|)
block|{
name|unsigned
name|char
name|item_buf
index|[
sizeof|sizeof
argument_list|(
name|vxge_queue_item_t
argument_list|)
operator|+
name|VXGE_DEFAULT_EVENT_MAX_DATA_SIZE
index|]
decl_stmt|;
name|vxge_queue_item_t
modifier|*
name|item
init|=
operator|(
name|vxge_queue_item_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
name|item_buf
decl_stmt|;
name|vxge_queue_t
modifier|*
name|queue
init|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|queueh
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|queueh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queueh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queueh
argument_list|)
expr_stmt|;
comment|/* flush queue by consuming all enqueued items */
while|while
condition|(
name|vxge_queue_consume
argument_list|(
name|queueh
argument_list|,
name|VXGE_DEFAULT_EVENT_MAX_DATA_SIZE
argument_list|,
name|item
argument_list|)
operator|!=
name|VXGE_QUEUE_IS_EMPTY
condition|)
block|{
comment|/* do nothing */
name|vxge_hal_trace_log_queue
argument_list|(
literal|"item 0x"
name|VXGE_OS_STXFMT
literal|"(%d) flushed"
argument_list|,
operator|(
name|ptr_t
operator|)
name|item
argument_list|,
name|item
operator|->
name|event_type
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|vxge_queue_get_reset_critical
argument_list|(
name|queueh
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * vxge_queue_get_reset_critical - Check for critical events in the queue,  * @queueh: Queue handle.  *  * Check for critical event(s) in the queue, and reset the  * "has-critical-event" flag upon return.  * Returns: 1 - if the queue contains atleast one critical event.  * 0 - If there are no critical events in the queue.  */
end_comment

begin_function
name|u32
name|vxge_queue_get_reset_critical
parameter_list|(
name|vxge_queue_h
name|queueh
parameter_list|)
block|{
name|vxge_queue_t
modifier|*
name|queue
init|=
operator|(
name|vxge_queue_t
operator|*
operator|)
name|queueh
decl_stmt|;
name|int
name|c
init|=
name|queue
operator|->
name|has_critical_event
decl_stmt|;
name|__hal_device_t
modifier|*
name|hldev
decl_stmt|;
name|vxge_assert
argument_list|(
name|queueh
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|hldev
operator|=
operator|(
name|__hal_device_t
operator|*
operator|)
name|queue
operator|->
name|hldev
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"==> %s:%s:%d"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"queueh = 0x"
name|VXGE_OS_STXFMT
argument_list|,
operator|(
name|ptr_t
operator|)
name|queueh
argument_list|)
expr_stmt|;
name|queue
operator|->
name|has_critical_event
operator|=
literal|0
expr_stmt|;
name|vxge_hal_trace_log_queue
argument_list|(
literal|"<== %s:%s:%d Result = 0"
argument_list|,
name|__FILE__
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|(
name|c
operator|)
return|;
block|}
end_function

end_unit

