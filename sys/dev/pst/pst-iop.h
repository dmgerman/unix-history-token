begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2001,2002,2003 SÃ¸ren Schmidt<sos@FreeBSD.org>  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification, immediately at the beginning of the file.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of the author may not be used to endorse or promote products  *    derived from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/* misc defines */
end_comment

begin_expr_stmt
name|MALLOC_DECLARE
argument_list|(
name|M_PSTIOP
argument_list|)
expr_stmt|;
end_expr_stmt

begin_define
define|#
directive|define
name|I2O_IOP_OUTBOUND_FRAME_COUNT
value|32
end_define

begin_define
define|#
directive|define
name|I2O_IOP_OUTBOUND_FRAME_SIZE
value|0x20
end_define

begin_comment
comment|/* structure defs */
end_comment

begin_struct
struct|struct
name|out_mfa_buf
block|{
name|u_int32_t
name|buf
index|[
name|I2O_IOP_OUTBOUND_FRAME_SIZE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|iop_softc
block|{
name|struct
name|resource
modifier|*
name|r_mem
decl_stmt|;
name|struct
name|resource
modifier|*
name|r_irq
decl_stmt|;
name|caddr_t
name|ibase
decl_stmt|;
name|caddr_t
name|obase
decl_stmt|;
name|u_int32_t
name|phys_obase
decl_stmt|;
name|struct
name|i2o_registers
modifier|*
name|reg
decl_stmt|;
name|struct
name|i2o_status_get_reply
modifier|*
name|status
decl_stmt|;
name|int
name|lct_count
decl_stmt|;
name|struct
name|i2o_lct_entry
modifier|*
name|lct
decl_stmt|;
name|int
name|ism
decl_stmt|;
name|device_t
name|dev
decl_stmt|;
name|struct
name|mtx
name|mtx
decl_stmt|;
name|int
name|outstanding
decl_stmt|;
name|void
modifier|*
name|handle
decl_stmt|;
name|struct
name|intr_config_hook
modifier|*
name|iop_delayed_attach
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* structure at start of IOP shared mem */
end_comment

begin_struct
struct|struct
name|i2o_registers
block|{
specifier|volatile
name|u_int32_t
name|apic_select
decl_stmt|;
specifier|volatile
name|u_int32_t
name|reserved0
decl_stmt|;
specifier|volatile
name|u_int32_t
name|apic_winreg
decl_stmt|;
specifier|volatile
name|u_int32_t
name|reserved1
decl_stmt|;
specifier|volatile
name|u_int32_t
name|iqueue_reg0
decl_stmt|;
specifier|volatile
name|u_int32_t
name|iqueue_reg1
decl_stmt|;
specifier|volatile
name|u_int32_t
name|oqueue_reg0
decl_stmt|;
specifier|volatile
name|u_int32_t
name|oqueue_reg1
decl_stmt|;
specifier|volatile
name|u_int32_t
name|iqueue_event
decl_stmt|;
specifier|volatile
name|u_int32_t
name|iqueue_intr_status
decl_stmt|;
specifier|volatile
name|u_int32_t
name|iqueue_intr_mask
decl_stmt|;
specifier|volatile
name|u_int32_t
name|oqueue_event
decl_stmt|;
specifier|volatile
name|u_int32_t
name|oqueue_intr_status
decl_stmt|;
specifier|volatile
name|u_int32_t
name|oqueue_intr_mask
decl_stmt|;
define|#
directive|define
name|I2O_OUT_INTR_QUEUE
value|0x08
define|#
directive|define
name|I2O_OUT_INTR_BELL
value|0x04
define|#
directive|define
name|I2O_OUT_INTR_MSG1
value|0x02
define|#
directive|define
name|I2O_OUT_INTR_MSG0
value|0x01
specifier|volatile
name|u_int64_t
name|reserved2
decl_stmt|;
specifier|volatile
name|u_int32_t
name|iqueue
decl_stmt|;
specifier|volatile
name|u_int32_t
name|oqueue
decl_stmt|;
specifier|volatile
name|u_int64_t
name|reserved3
decl_stmt|;
specifier|volatile
name|u_int64_t
name|mac_addr
decl_stmt|;
specifier|volatile
name|u_int32_t
name|ip_addr
decl_stmt|;
specifier|volatile
name|u_int32_t
name|ip_mask
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Scatter/Gather List management  */
end_comment

begin_struct
struct|struct
name|i2o_sgl
block|{
name|u_int32_t
name|count
range|:
literal|24
decl_stmt|;
define|#
directive|define
name|I2O_SGL_CNT_MASK
value|0xffffff
name|u_int32_t
name|flags
range|:
literal|8
decl_stmt|;
define|#
directive|define
name|I2O_SGL_SIMPLE
value|0x10
define|#
directive|define
name|I2O_SGL_PAGELIST
value|0x20
define|#
directive|define
name|I2O_SGL_CHAIN
value|0x30
define|#
directive|define
name|I2O_SGL_ATTRIBUTE
value|0x7c
define|#
directive|define
name|I2O_SGL_BC0
value|0x01
define|#
directive|define
name|I2O_SGL_BC1
value|0x02
define|#
directive|define
name|I2O_SGL_DIR
value|0x04
define|#
directive|define
name|I2O_SGL_LA
value|0x08
define|#
directive|define
name|I2O_SGL_EOB
value|0x40
define|#
directive|define
name|I2O_SGL_END
value|0x80
name|u_int32_t
name|phys_addr
index|[
literal|1
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_define
define|#
directive|define
name|I2O_SGL_MAX_SEGS
value|((I2O_IOP_OUTBOUND_FRAME_SIZE - (8 + 2)) + 1)
end_define

begin_comment
comment|/* i2o command codes */
end_comment

begin_define
define|#
directive|define
name|I2O_UTIL_NOP
value|0x00
end_define

begin_define
define|#
directive|define
name|I2O_UTIL_PARAMS_GET
value|0x06
end_define

begin_define
define|#
directive|define
name|I2O_UTIL_CLAIM
value|0x09
end_define

begin_define
define|#
directive|define
name|I2O_UTIL_CONFIG_DIALOG
value|0x10
end_define

begin_define
define|#
directive|define
name|I2O_UTIL_EVENT_REGISTER
value|0x13
end_define

begin_define
define|#
directive|define
name|I2O_BSA_BLOCK_READ
value|0x30
end_define

begin_define
define|#
directive|define
name|I2O_BSA_BLOCK_WRITE
value|0x31
end_define

begin_define
define|#
directive|define
name|I2O_BSA_CACHE_FLUSH
value|0x37
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_STATUS_GET
value|0xa0
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_OUTBOUND_INIT
value|0xa1
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_LCT_NOTIFY
value|0xa2
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_SYSTAB_SET
value|0xa3
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_IOP_RESET
value|0xbd
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_SYS_ENABLE
value|0xd1
end_define

begin_define
define|#
directive|define
name|I2O_PRIVATE_MESSAGE
value|0xff
end_define

begin_comment
comment|/* basic message layout */
end_comment

begin_struct
struct|struct
name|i2o_basic_message
block|{
name|u_int8_t
name|version
range|:
literal|4
decl_stmt|;
name|u_int8_t
name|offset
range|:
literal|4
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_comment
comment|/* basic reply layout */
end_comment

begin_struct
struct|struct
name|i2o_single_reply
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
define|#
directive|define
name|I2O_MESSAGE_FLAGS_STATIC
value|0x01
define|#
directive|define
name|I2O_MESSAGE_FLAGS_64BIT
value|0x02
define|#
directive|define
name|I2O_MESSAGE_FLAGS_MULTIPLE
value|0x10
define|#
directive|define
name|I2O_MESSAGE_FLAGS_FAIL
value|0x20
define|#
directive|define
name|I2O_MESSAGE_FLAGS_LAST
value|0x40
define|#
directive|define
name|I2O_MESSAGE_FLAGS_REPLY
value|0x80
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int16_t
name|detailed_status
decl_stmt|;
define|#
directive|define
name|I2O_DETAIL_STATUS_SUCCESS
value|0x0000
define|#
directive|define
name|I2O_DETAIL_STATUS_BAD_KEY
value|0x0002
define|#
directive|define
name|I2O_DETAIL_STATUS_TCL_ERROR
value|0x0003
define|#
directive|define
name|I2O_DETAIL_STATUS_REPLY_BUFFER_FULL
value|0x0004
define|#
directive|define
name|I2O_DETAIL_STATUS_NO_SUCH_PAGE
value|0x0005
define|#
directive|define
name|I2O_DETAIL_STATUS_INSUFFICIENT_RESOURCE_SOFT
value|0x0006
define|#
directive|define
name|I2O_DETAIL_STATUS_INSUFFICIENT_RESOURCE_HARD
value|0x0007
define|#
directive|define
name|I2O_DETAIL_STATUS_CHAIN_BUFFER_TOO_LARGE
value|0x0009
define|#
directive|define
name|I2O_DETAIL_STATUS_UNSUPPORTED_FUNCTION
value|0x000a
define|#
directive|define
name|I2O_DETAIL_STATUS_DEVICE_LOCKED
value|0x000b
define|#
directive|define
name|I2O_DETAIL_STATUS_DEVICE_RESET
value|0x000c
define|#
directive|define
name|I2O_DETAIL_STATUS_INAPPROPRIATE_FUNCTION
value|0x000d
define|#
directive|define
name|I2O_DETAIL_STATUS_INVALID_INITIATOR_ADDRESS
value|0x000e
define|#
directive|define
name|I2O_DETAIL_STATUS_INVALID_MESSAGE_FLAGS
value|0x000f
define|#
directive|define
name|I2O_DETAIL_STATUS_INVALID_OFFSET
value|0x0010
define|#
directive|define
name|I2O_DETAIL_STATUS_INVALID_PARAMETER
value|0x0011
define|#
directive|define
name|I2O_DETAIL_STATUS_INVALID_REQUEST
value|0x0012
define|#
directive|define
name|I2O_DETAIL_STATUS_INVALID_TARGET_ADDRESS
value|0x0013
define|#
directive|define
name|I2O_DETAIL_STATUS_MESSAGE_TOO_LARGE
value|0x0014
define|#
directive|define
name|I2O_DETAIL_STATUS_MESSAGE_TOO_SMALL
value|0x0015
define|#
directive|define
name|I2O_DETAIL_STATUS_MISSING_PARAMETER
value|0x0016
define|#
directive|define
name|I2O_DETAIL_STATUS_TIMEOUT
value|0x0017
define|#
directive|define
name|I2O_DETAIL_STATUS_UNKNOWN_ERROR
value|0x0018
define|#
directive|define
name|I2O_DETAIL_STATUS_UNKNOWN_FUNCTION
value|0x0019
define|#
directive|define
name|I2O_DETAIL_STATUS_UNSUPPORTED_VERSION
value|0x001a
define|#
directive|define
name|I2O_DETAIL_STATUS_DEVICE_BUSY
value|0x001b
define|#
directive|define
name|I2O_DETAIL_STATUS_DEVICE_NOT_AVAILABLE
value|0x001c
name|u_int8_t
name|retry_count
decl_stmt|;
name|u_int8_t
name|status
decl_stmt|;
define|#
directive|define
name|I2O_REPLY_STATUS_SUCCESS
value|0x00
define|#
directive|define
name|I2O_REPLY_STATUS_ABORT_DIRTY
value|0x01
define|#
directive|define
name|I2O_REPLY_STATUS_ABORT_NO_DATA_TRANSFER
value|0x02
define|#
directive|define
name|I2O_REPLY_STATUS_ABORT_PARTIAL_TRANSFER
value|0x03
define|#
directive|define
name|I2O_REPLY_STATUS_ERROR_DIRTY
value|0x04
define|#
directive|define
name|I2O_REPLY_STATUS_ERROR_NO_DATA_TRANSFER
value|0x05
define|#
directive|define
name|I2O_REPLY_STATUS_ERROR_PARTIAL_TRANSFER
value|0x06
define|#
directive|define
name|I2O_REPLY_STATUS_PROCESS_ABORT_DIRTY
value|0x08
define|#
directive|define
name|I2O_REPLY_STATUS_PROCESS_ABORT_NO_DATA_TRANSFER
value|0x09
define|#
directive|define
name|I2O_REPLY_STATUS_PROCESS_ABORT_PARTIAL_TRANSFER
value|0x0a
define|#
directive|define
name|I2O_REPLY_STATUS_TRANSACTION_ERROR
value|0x0b
define|#
directive|define
name|I2O_REPLY_STATUS_PROGRESS_REPORT
value|0x80
name|u_int32_t
name|donecount
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_fault_reply
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int8_t
name|lowest_version
decl_stmt|;
name|u_int8_t
name|highest_version
decl_stmt|;
name|u_int8_t
name|severity
decl_stmt|;
define|#
directive|define
name|I2O_SEVERITY_FORMAT_ERROR
value|0x01
define|#
directive|define
name|I2O_SEVERITY_PATH_ERROR
value|0x02
define|#
directive|define
name|I2O_SEVERITY_PATH_STATE
value|0x04
define|#
directive|define
name|I2O_SEVERITY_CONGESTION
value|0x08
name|u_int8_t
name|failure_code
decl_stmt|;
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_SERVICE_SUSPENDED
value|0x81
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_SERVICE_TERMINATED
value|0x82
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_CONGESTION
value|0x83
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_FAIL
value|0x84
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_STATE_ERROR
value|0x85
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_TIME_OUT
value|0x86
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_ROUTING_FAILURE
value|0x87
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_INVALID_VERSION
value|0x88
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_INVALID_OFFSET
value|0x89
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_INVALID_MSG_FLAGS
value|0x8A
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_FRAME_TOO_SMALL
value|0x8B
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_FRAME_TOO_LARGE
value|0x8C
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_INVALID_TARGET_ID
value|0x8D
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_INVALID_INITIATOR_ID
value|0x8E
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_INVALID_INITIATOR_CONTEXT
value|0x8F
define|#
directive|define
name|I2O_FAILURE_CODE_TRANSPORT_UNKNOWN_FAILURE
value|0xFF
name|u_int32_t
name|failing_iop_id
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|reserved
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|failing_host_unit_id
range|:
literal|16
decl_stmt|;
name|u_int32_t
name|age_limit
decl_stmt|;
name|u_int64_t
name|preserved_mfa
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_exec_iop_reset_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int8_t
name|reserved
index|[
literal|16
index|]
decl_stmt|;
name|u_int32_t
name|status_word_low_addr
decl_stmt|;
name|u_int32_t
name|status_word_high_addr
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_exec_status_get_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int8_t
name|reserved
index|[
literal|16
index|]
decl_stmt|;
name|u_int32_t
name|reply_buf_low_addr
decl_stmt|;
name|u_int32_t
name|reply_buf_high_addr
decl_stmt|;
name|u_int32_t
name|reply_buf_length
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_status_get_reply
block|{
name|u_int16_t
name|organization_id
decl_stmt|;
name|u_int16_t
name|reserved
decl_stmt|;
name|u_int32_t
name|iop_id
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|reserved1
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|host_unit_id
range|:
literal|16
decl_stmt|;
name|u_int32_t
name|segment_number
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|i2o_version
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|iop_state
range|:
literal|8
decl_stmt|;
define|#
directive|define
name|I2O_IOP_STATE_INITIALIZING
value|0x01
define|#
directive|define
name|I2O_IOP_STATE_RESET
value|0x02
define|#
directive|define
name|I2O_IOP_STATE_HOLD
value|0x04
define|#
directive|define
name|I2O_IOP_STATE_READY
value|0x05
define|#
directive|define
name|I2O_IOP_STATE_OPERATIONAL
value|0x08
define|#
directive|define
name|I2O_IOP_STATE_FAILED
value|0x10
define|#
directive|define
name|I2O_IOP_STATE_FAULTED
value|0x11
name|u_int32_t
name|messenger_type
range|:
literal|8
decl_stmt|;
name|u_int16_t
name|inbound_mframe_size
decl_stmt|;
name|u_int8_t
name|init_code
decl_stmt|;
name|u_int8_t
name|reserved2
decl_stmt|;
name|u_int32_t
name|max_inbound_mframes
decl_stmt|;
name|u_int32_t
name|current_ibound_mframes
decl_stmt|;
name|u_int32_t
name|max_outbound_mframes
decl_stmt|;
name|u_int8_t
name|product_idstring
index|[
literal|24
index|]
decl_stmt|;
name|u_int32_t
name|expected_lct_size
decl_stmt|;
name|u_int32_t
name|iop_capabilities
decl_stmt|;
name|u_int32_t
name|desired_private_memsize
decl_stmt|;
name|u_int32_t
name|current_private_memsize
decl_stmt|;
name|u_int32_t
name|current_private_membase
decl_stmt|;
name|u_int32_t
name|desired_private_iosize
decl_stmt|;
name|u_int32_t
name|current_private_iosize
decl_stmt|;
name|u_int32_t
name|current_private_iobase
decl_stmt|;
name|u_int8_t
name|reserved3
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|sync_byte
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_exec_init_outqueue_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|host_pagesize
decl_stmt|;
name|u_int8_t
name|init_code
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int16_t
name|queue_framesize
decl_stmt|;
name|struct
name|i2o_sgl
name|sgl
index|[
literal|2
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_define
define|#
directive|define
name|I2O_EXEC_OUTBOUND_INIT_IN_PROGRESS
value|0x01
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_OUTBOUND_INIT_REJECTED
value|0x02
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_OUTBOUND_INIT_FAILED
value|0x03
end_define

begin_define
define|#
directive|define
name|I2O_EXEC_OUTBOUND_INIT_COMPLETE
value|0x04
end_define

begin_struct
struct|struct
name|i2o_exec_systab_set_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|iop_id
range|:
literal|12
decl_stmt|;
define|#
directive|define
name|I2O_EXEC_SYS_TAB_IOP_ID_LOCAL_IOP
value|0x000
define|#
directive|define
name|I2O_EXEC_SYS_TAB_IOP_ID_LOCAL_HOST
value|0x001
define|#
directive|define
name|I2O_EXEC_SYS_TAB_IOP_ID_UNKNOWN_IOP
value|0xfff
name|u_int32_t
name|reserved1
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|host_unit_id
range|:
literal|16
decl_stmt|;
define|#
directive|define
name|I2O_EXEC_SYS_TAB_HOST_UNIT_ID_LOCAL_UNIT
value|0x0000
define|#
directive|define
name|I2O_EXEC_SYS_TAB_HOST_UNIT_ID_UNKNOWN_UNIT
value|0xffff
name|u_int32_t
name|segment_number
range|:
literal|12
decl_stmt|;
define|#
directive|define
name|I2O_EXEC_SYS_TAB_SEG_NUMBER_LOCAL_SEGMENT
value|0x000
define|#
directive|define
name|I2O_EXEC_SYS_TAB_SEG_NUMBER_UNKNOWN_SEGMENT
value|0xfff
name|u_int32_t
name|reserved2
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|reserved3
range|:
literal|8
decl_stmt|;
name|struct
name|i2o_sgl
name|sgl
index|[
literal|3
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_exec_systab
block|{
name|u_int8_t
name|entries
decl_stmt|;
name|u_int8_t
name|version
decl_stmt|;
define|#
directive|define
name|I2O_RESOURCE_MANAGER_VERSION
value|0
name|u_int16_t
name|reserved1
decl_stmt|;
name|u_int32_t
name|change_id
decl_stmt|;
name|u_int64_t
name|reserved2
decl_stmt|;
name|u_int16_t
name|organization_id
decl_stmt|;
name|u_int16_t
name|reserved3
decl_stmt|;
name|u_int32_t
name|iop_id
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|reserved4
range|:
literal|20
decl_stmt|;
name|u_int32_t
name|segment_number
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|i2o_version
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|iop_state
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|messenger_type
range|:
literal|8
decl_stmt|;
name|u_int16_t
name|inbound_mframe_size
decl_stmt|;
name|u_int16_t
name|reserved5
decl_stmt|;
name|u_int32_t
name|last_changed
decl_stmt|;
name|u_int32_t
name|iop_capabilities
decl_stmt|;
name|u_int64_t
name|messenger_info
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_exec_get_lct_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|class
decl_stmt|;
name|u_int32_t
name|last_change_id
decl_stmt|;
name|struct
name|i2o_sgl
name|sgl
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_define
define|#
directive|define
name|I2O_TID_IOP
value|0x000
end_define

begin_define
define|#
directive|define
name|I2O_TID_HOST
value|0x001
end_define

begin_define
define|#
directive|define
name|I2O_TID_NONE
value|0xfff
end_define

begin_struct
struct|struct
name|i2o_lct_entry
block|{
name|u_int32_t
name|entry_size
range|:
literal|16
decl_stmt|;
name|u_int32_t
name|local_tid
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|reserved
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|change_id
decl_stmt|;
name|u_int32_t
name|device_flags
decl_stmt|;
name|u_int32_t
name|class
range|:
literal|12
decl_stmt|;
define|#
directive|define
name|I2O_CLASS_EXECUTIVE
value|0x000
define|#
directive|define
name|I2O_CLASS_DDM
value|0x001
define|#
directive|define
name|I2O_CLASS_RANDOM_BLOCK_STORAGE
value|0x010
define|#
directive|define
name|I2O_CLASS_SEQUENTIAL_STORAGE
value|0x011
define|#
directive|define
name|I2O_CLASS_LAN
value|0x020
define|#
directive|define
name|I2O_CLASS_WAN
value|0x030
define|#
directive|define
name|I2O_CLASS_FIBRE_CHANNEL_PORT
value|0x040
define|#
directive|define
name|I2O_CLASS_FIBRE_CHANNEL_PERIPHERAL
value|0x041
define|#
directive|define
name|I2O_CLASS_SCSI_PERIPHERAL
value|0x051
define|#
directive|define
name|I2O_CLASS_ATE_PORT
value|0x060
define|#
directive|define
name|I2O_CLASS_ATE_PERIPHERAL
value|0x061
define|#
directive|define
name|I2O_CLASS_FLOPPY_CONTROLLER
value|0x070
define|#
directive|define
name|I2O_CLASS_FLOPPY_DEVICE
value|0x071
define|#
directive|define
name|I2O_CLASS_BUS_ADAPTER_PORT
value|0x080
define|#
directive|define
name|I2O_CLASS_MATCH_ANYCLASS
value|0xffffffff
name|u_int32_t
name|class_version
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|class_org
range|:
literal|16
decl_stmt|;
name|u_int32_t
name|sub_class
decl_stmt|;
define|#
directive|define
name|I2O_SUBCLASS_i960
value|0x001
define|#
directive|define
name|I2O_SUBCLASS_HDM
value|0x020
define|#
directive|define
name|I2O_SUBCLASS_ISM
value|0x021
name|u_int32_t
name|user_tid
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|parent_tid
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|bios_info
range|:
literal|8
decl_stmt|;
name|u_int8_t
name|identity_tag
index|[
literal|8
index|]
decl_stmt|;
name|u_int32_t
name|event_capabilities
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_define
define|#
directive|define
name|I2O_LCT_ENTRYSIZE
value|(sizeof(struct i2o_lct_entry)/sizeof(u_int32_t))
end_define

begin_struct
struct|struct
name|i2o_get_lct_reply
block|{
name|u_int32_t
name|table_size
range|:
literal|16
decl_stmt|;
name|u_int32_t
name|boot_device
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|lct_version
range|:
literal|4
decl_stmt|;
name|u_int32_t
name|iop_flags
decl_stmt|;
name|u_int32_t
name|current_change_id
decl_stmt|;
name|struct
name|i2o_lct_entry
name|entry
index|[
literal|1
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_util_get_param_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|operation_flags
decl_stmt|;
name|struct
name|i2o_sgl
name|sgl
index|[
literal|2
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_get_param_template
block|{
name|u_int16_t
name|operation
decl_stmt|;
define|#
directive|define
name|I2O_PARAMS_OPERATION_FIELD_GET
value|0x0001
define|#
directive|define
name|I2O_PARAMS_OPERATION_LIST_GET
value|0x0002
define|#
directive|define
name|I2O_PARAMS_OPERATION_MORE_GET
value|0x0003
define|#
directive|define
name|I2O_PARAMS_OPERATION_SIZE_GET
value|0x0004
define|#
directive|define
name|I2O_PARAMS_OPERATION_TABLE_GET
value|0x0005
define|#
directive|define
name|I2O_PARAMS_OPERATION_FIELD_SET
value|0x0006
define|#
directive|define
name|I2O_PARAMS_OPERATION_LIST_SET
value|0x0007
define|#
directive|define
name|I2O_PARAMS_OPERATION_ROW_ADD
value|0x0008
define|#
directive|define
name|I2O_PARAMS_OPERATION_ROW_DELETE
value|0x0009
define|#
directive|define
name|I2O_PARAMS_OPERATION_TABLE_CLEAR
value|0x000A
name|u_int16_t
name|group
decl_stmt|;
define|#
directive|define
name|I2O_BSA_DEVICE_INFO_GROUP_NO
value|0x0000
define|#
directive|define
name|I2O_BSA_OPERATIONAL_CONTROL_GROUP_NO
value|0x0001
define|#
directive|define
name|I2O_BSA_POWER_CONTROL_GROUP_NO
value|0x0002
define|#
directive|define
name|I2O_BSA_CACHE_CONTROL_GROUP_NO
value|0x0003
define|#
directive|define
name|I2O_BSA_MEDIA_INFO_GROUP_NO
value|0x0004
define|#
directive|define
name|I2O_BSA_ERROR_LOG_GROUP_NO
value|0x0005
define|#
directive|define
name|I2O_UTIL_PARAMS_DESCRIPTOR_GROUP_NO
value|0xF000
define|#
directive|define
name|I2O_UTIL_PHYSICAL_DEVICE_TABLE_GROUP_NO
value|0xF001
define|#
directive|define
name|I2O_UTIL_CLAIMED_TABLE_GROUP_NO
value|0xF002
define|#
directive|define
name|I2O_UTIL_USER_TABLE_GROUP_NO
value|0xF003
define|#
directive|define
name|I2O_UTIL_PRIVATE_MESSAGE_EXTENSIONS_GROUP_NO
value|0xF005
define|#
directive|define
name|I2O_UTIL_AUTHORIZED_USER_TABLE_GROUP_NO
value|0xF006
define|#
directive|define
name|I2O_UTIL_DEVICE_IDENTITY_GROUP_NO
value|0xF100
define|#
directive|define
name|I2O_UTIL_DDM_IDENTITY_GROUP_NO
value|0xF101
define|#
directive|define
name|I2O_UTIL_USER_INFORMATION_GROUP_NO
value|0xF102
define|#
directive|define
name|I2O_UTIL_SGL_OPERATING_LIMITS_GROUP_NO
value|0xF103
define|#
directive|define
name|I2O_UTIL_SENSORS_GROUP_NO
value|0xF200
name|u_int16_t
name|field_count
decl_stmt|;
name|u_int16_t
name|pad
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_get_param_operation
block|{
name|u_int16_t
name|operation_count
decl_stmt|;
name|u_int16_t
name|reserved
decl_stmt|;
name|struct
name|i2o_get_param_template
name|operation
index|[
literal|1
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_get_param_reply
block|{
name|u_int16_t
name|result_count
decl_stmt|;
name|u_int16_t
name|reserved
decl_stmt|;
name|u_int16_t
name|block_size
decl_stmt|;
name|u_int8_t
name|block_status
decl_stmt|;
name|u_int8_t
name|error_info_size
decl_stmt|;
name|u_int32_t
name|result
index|[
literal|1
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_device_identity
block|{
name|u_int32_t
name|class
decl_stmt|;
name|u_int16_t
name|owner
decl_stmt|;
name|u_int16_t
name|parent
decl_stmt|;
name|u_int8_t
name|vendor
index|[
literal|16
index|]
decl_stmt|;
name|u_int8_t
name|product
index|[
literal|16
index|]
decl_stmt|;
name|u_int8_t
name|description
index|[
literal|16
index|]
decl_stmt|;
name|u_int8_t
name|revision
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|sn_format
decl_stmt|;
name|u_int8_t
name|serial
index|[
literal|256
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_bsa_device
block|{
name|u_int8_t
name|device_type
decl_stmt|;
name|u_int8_t
name|path_count
decl_stmt|;
name|u_int16_t
name|power_state
decl_stmt|;
name|u_int32_t
name|block_size
decl_stmt|;
name|u_int64_t
name|capacity
decl_stmt|;
name|u_int32_t
name|capabilities
decl_stmt|;
name|u_int32_t
name|state
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_util_claim_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int16_t
name|claim_flags
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|claim_type
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_util_event_register_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|event_mask
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_util_event_reply_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|event_mask
decl_stmt|;
name|u_int32_t
name|event_data
index|[
literal|1
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_util_config_dialog_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int32_t
name|page_number
decl_stmt|;
name|struct
name|i2o_sgl
name|sgl
index|[
literal|2
index|]
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_private_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int16_t
name|function_code
decl_stmt|;
name|u_int16_t
name|organization_id
decl_stmt|;
name|struct
name|i2o_sgl
name|in_sgl
decl_stmt|;
name|struct
name|i2o_sgl
name|out_sgl
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_bsa_rw_block_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int16_t
name|control_flags
decl_stmt|;
name|u_int8_t
name|time_multiplier
decl_stmt|;
name|u_int8_t
name|fetch_ahead
decl_stmt|;
name|u_int32_t
name|bytecount
decl_stmt|;
name|u_int64_t
name|lba
decl_stmt|;
name|struct
name|i2o_sgl
name|sgl
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|i2o_bsa_cache_flush_message
block|{
name|u_int8_t
name|version_offset
decl_stmt|;
name|u_int8_t
name|message_flags
decl_stmt|;
name|u_int16_t
name|message_size
decl_stmt|;
name|u_int32_t
name|target_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|initiator_address
range|:
literal|12
decl_stmt|;
name|u_int32_t
name|function
range|:
literal|8
decl_stmt|;
name|u_int32_t
name|initiator_context
decl_stmt|;
name|u_int32_t
name|transaction_context
decl_stmt|;
name|u_int16_t
name|control_flags
decl_stmt|;
name|u_int8_t
name|time_multiplier
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_comment
comment|/* prototypes */
end_comment

begin_function_decl
name|int
name|iop_init
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|iop_attach
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|iop_intr
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|iop_reset
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|iop_init_outqueue
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|iop_get_lct
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|i2o_get_param_reply
modifier|*
name|iop_get_util_params
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u_int32_t
name|iop_get_mfa
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|iop_free_mfa
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|iop_queue_wait_msg
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|,
name|int
parameter_list|,
name|struct
name|i2o_basic_message
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|iop_create_sgl
parameter_list|(
name|struct
name|i2o_basic_message
modifier|*
parameter_list|,
name|caddr_t
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* global prototypes */
end_comment

begin_function_decl
name|int
name|pst_add_raid
parameter_list|(
name|struct
name|iop_softc
modifier|*
parameter_list|,
name|struct
name|i2o_lct_entry
modifier|*
parameter_list|)
function_decl|;
end_function_decl

end_unit

