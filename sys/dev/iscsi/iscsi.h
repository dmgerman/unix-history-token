begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2012 The FreeBSD Foundation  * All rights reserved.  *  * This software was developed by Edward Tomasz Napierala under sponsorship  * from the FreeBSD Foundation.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|ISCSI_H
end_ifndef

begin_define
define|#
directive|define
name|ISCSI_H
end_define

begin_struct_decl
struct_decl|struct
name|iscsi_softc
struct_decl|;
end_struct_decl

begin_struct_decl
struct_decl|struct
name|icl_conn
struct_decl|;
end_struct_decl

begin_define
define|#
directive|define
name|ISCSI_NAME_LEN
value|224
end_define

begin_comment
comment|/* 223 bytes, by RFC 3720, + '\0' */
end_comment

begin_define
define|#
directive|define
name|ISCSI_ADDR_LEN
value|47
end_define

begin_comment
comment|/* INET6_ADDRSTRLEN + '\0' */
end_comment

begin_define
define|#
directive|define
name|ISCSI_SECRET_LEN
value|17
end_define

begin_comment
comment|/* 16 + '\0' */
end_comment

begin_struct
struct|struct
name|iscsi_outstanding
block|{
name|TAILQ_ENTRY
argument_list|(
argument|iscsi_outstanding
argument_list|)
name|io_next
expr_stmt|;
name|union
name|ccb
modifier|*
name|io_ccb
decl_stmt|;
name|size_t
name|io_received
decl_stmt|;
name|uint32_t
name|io_initiator_task_tag
decl_stmt|;
name|uint32_t
name|io_datasn
decl_stmt|;
name|void
modifier|*
name|io_icl_prv
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|iscsi_session
block|{
name|TAILQ_ENTRY
argument_list|(
argument|iscsi_session
argument_list|)
name|is_next
expr_stmt|;
name|struct
name|icl_conn
modifier|*
name|is_conn
decl_stmt|;
name|struct
name|mtx
name|is_lock
decl_stmt|;
name|uint32_t
name|is_statsn
decl_stmt|;
name|uint32_t
name|is_cmdsn
decl_stmt|;
name|uint32_t
name|is_expcmdsn
decl_stmt|;
name|uint32_t
name|is_maxcmdsn
decl_stmt|;
name|uint32_t
name|is_initiator_task_tag
decl_stmt|;
name|int
name|is_header_digest
decl_stmt|;
name|int
name|is_data_digest
decl_stmt|;
name|int
name|is_initial_r2t
decl_stmt|;
name|size_t
name|is_max_burst_length
decl_stmt|;
name|size_t
name|is_first_burst_length
decl_stmt|;
name|uint8_t
name|is_isid
index|[
literal|6
index|]
decl_stmt|;
name|uint16_t
name|is_tsih
decl_stmt|;
name|bool
name|is_immediate_data
decl_stmt|;
name|size_t
name|is_max_data_segment_length
decl_stmt|;
name|char
name|is_target_alias
index|[
name|ISCSI_ALIAS_LEN
index|]
decl_stmt|;
name|TAILQ_HEAD
argument_list|(
argument_list|,
argument|iscsi_outstanding
argument_list|)
name|is_outstanding
expr_stmt|;
name|STAILQ_HEAD
argument_list|(
argument_list|,
argument|icl_pdu
argument_list|)
name|is_postponed
expr_stmt|;
name|struct
name|callout
name|is_callout
decl_stmt|;
name|unsigned
name|int
name|is_timeout
decl_stmt|;
comment|/* 	 * XXX: This could be rewritten using a single variable, 	 * 	but somehow it results in uglier code.  	 */
comment|/* 	 * We're waiting for iscsid(8); after iscsid_timeout 	 * expires, kernel will wake up an iscsid(8) to handle 	 * the session. 	 */
name|bool
name|is_waiting_for_iscsid
decl_stmt|;
comment|/* 	 * Some iscsid(8) instance is handling the session; 	 * after login_timeout expires, kernel will wake up 	 * another iscsid(8) to handle the session. 	 */
name|bool
name|is_login_phase
decl_stmt|;
comment|/* 	 * We're in the process of removing the iSCSI session. 	 */
name|bool
name|is_terminating
decl_stmt|;
comment|/* 	 * We're waiting for the maintenance thread to do some 	 * reconnection tasks. 	 */
name|bool
name|is_reconnecting
decl_stmt|;
name|bool
name|is_connected
decl_stmt|;
name|struct
name|cam_devq
modifier|*
name|is_devq
decl_stmt|;
name|struct
name|cam_sim
modifier|*
name|is_sim
decl_stmt|;
name|struct
name|cam_path
modifier|*
name|is_path
decl_stmt|;
name|struct
name|cv
name|is_maintenance_cv
decl_stmt|;
name|struct
name|iscsi_softc
modifier|*
name|is_softc
decl_stmt|;
name|unsigned
name|int
name|is_id
decl_stmt|;
name|struct
name|iscsi_session_conf
name|is_conf
decl_stmt|;
name|bool
name|is_simq_frozen
decl_stmt|;
name|char
name|is_reason
index|[
name|ISCSI_REASON_LEN
index|]
decl_stmt|;
ifdef|#
directive|ifdef
name|ICL_KERNEL_PROXY
name|struct
name|cv
name|is_login_cv
decl_stmt|;
empty_stmt|;
name|struct
name|icl_pdu
modifier|*
name|is_login_pdu
decl_stmt|;
endif|#
directive|endif
block|}
struct|;
end_struct

begin_struct
struct|struct
name|iscsi_softc
block|{
name|device_t
name|sc_dev
decl_stmt|;
name|struct
name|sx
name|sc_lock
decl_stmt|;
name|struct
name|cdev
modifier|*
name|sc_cdev
decl_stmt|;
name|TAILQ_HEAD
argument_list|(
argument_list|,
argument|iscsi_session
argument_list|)
name|sc_sessions
expr_stmt|;
name|struct
name|cv
name|sc_cv
decl_stmt|;
name|unsigned
name|int
name|sc_last_session_id
decl_stmt|;
name|eventhandler_tag
name|sc_shutdown_pre_eh
decl_stmt|;
name|eventhandler_tag
name|sc_shutdown_post_eh
decl_stmt|;
block|}
struct|;
end_struct

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !ISCSI_H */
end_comment

end_unit

