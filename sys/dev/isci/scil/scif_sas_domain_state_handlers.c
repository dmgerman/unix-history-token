begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * This file is provided under a dual BSD/GPLv2 license.  When using or  * redistributing this file, you may do so under either license.  *  * GPL LICENSE SUMMARY  *  * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of version 2 of the GNU General Public License as  * published by the Free Software Foundation.  *  * This program is distributed in the hope that it will be useful, but  * WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.  * The full GNU General Public License is included in this distribution  * in the file called LICENSE.GPL.  *  * BSD LICENSE  *  * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  *   * Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  *   * Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in  *     the documentation and/or other materials provided with the  *     distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/**  * @file  *  * @brief This file contains all of the state handler routines for each  *        of the domain states defined by the SCI_BASE_DOMAIN state  *        machine.  * @note  *        - The discover method must be synchronized with the  *          controller's completion handler.  The OS specific driver  *          component is responsible for ensuring this occurs.  If the  *          discovery method is called from within the call  *          tree of the completion routine, then no action is necessary.  */
end_comment

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_port.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_io_request.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_logger.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_domain.h>
end_include

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* P R O T E C T E D   M E T H O D S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* S T A R T I N G   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_starting_port_ready_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"scif_sas_domain_starting_port_ready_handler(0x%x) enter\n"
operator|,
name|domain
operator|)
argument_list|)
expr_stmt|;
comment|// The domain was previously completely stopped.  Now that the port is
comment|// ready we can transition the domain to the ready state.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|,
name|SCI_BASE_DOMAIN_STATE_READY
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* R E A D Y   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to discover a domain.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a discover  *             operation.  *  * @return This method returns an indication of whether the discover operation  *         succeeded.  * @retval SCI_SUCCESSS This value is returned when the discover operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_discover_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|U32
name|op_timeout
parameter_list|,
name|U32
name|device_timeout
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"scif_sas_domain_ready_discover_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|op_timeout
operator|,
name|device_timeout
operator|)
argument_list|)
expr_stmt|;
name|fw_domain
operator|->
name|operation
operator|.
name|timeout
operator|=
name|op_timeout
expr_stmt|;
name|fw_domain
operator|->
name|operation
operator|.
name|device_timeout
operator|=
name|device_timeout
expr_stmt|;
name|fw_domain
operator|->
name|operation
operator|.
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
name|scif_cb_timer_start
argument_list|(
name|fw_domain
operator|->
name|controller
argument_list|,
name|fw_domain
operator|->
name|operation
operator|.
name|timer
argument_list|,
name|fw_domain
operator|->
name|operation
operator|.
name|timeout
argument_list|)
expr_stmt|;
name|scif_sas_domain_transition_to_discovering_state
argument_list|(
name|fw_domain
argument_list|)
expr_stmt|;
return|return
name|fw_domain
operator|->
name|operation
operator|.
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state processing for reception of a  *        port NOT ready notification from the core.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the core port has just come ready.  *  * @return  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_port_not_ready_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|U32
name|reason_code
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"scif_sas_domain_ready_port_not_ready_handler(0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|reason_code
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|reason_code
operator|!=
name|SCIC_PORT_NOT_READY_HARD_RESET_REQUESTED
condition|)
block|{
comment|// Change to the STOPPING state to cause existing request
comment|// completions to be terminated and devices removed.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|,
name|SCI_BASE_DOMAIN_STATE_STOPPING
argument_list|)
expr_stmt|;
block|}
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to start an IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being started.  *  * @return This method returns an indication of whether the start IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the start IO operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_start_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_ready_start_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|fw_device
operator|->
name|state_handlers
operator|->
name|parent
operator|.
name|start_io_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|SCI_SUCCESS
condition|)
block|{
comment|// Add the IO to the list of outstanding requests on the domain.
name|sci_fast_list_insert_tail
argument_list|(
operator|&
name|fw_domain
operator|->
name|request_list
argument_list|,
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to complete an IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication of whether the complete IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_complete_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_ready_complete_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
comment|// Remove the IO from the list of outstanding requests on the domain.
name|sci_fast_list_remove_element
argument_list|(
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
return|return
name|fw_device
operator|->
name|state_handlers
operator|->
name|parent
operator|.
name|complete_io_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to continue an IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a continue IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being started.  *  * @return This method returns an indication of whether the continue IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the continue IO operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_continue_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_ready_continue_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
comment|/// @todo fix return code handling.
return|return
name|SCI_FAILURE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to start a task request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start task  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  task_request This parameter specifies the task request that  *             is being started.  *  * @return This method returns an indication of whether the start task  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the start task operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_start_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|task_request
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_TASK_MANAGEMENT
operator|,
literal|"scif_sas_domain_ready_start_task_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|task_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|fw_device
operator|->
name|state_handlers
operator|->
name|parent
operator|.
name|start_task_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|SCI_SUCCESS
condition|)
block|{
comment|// Add the task to the list of outstanding requests on the domain.
name|sci_fast_list_insert_tail
argument_list|(
operator|&
name|fw_domain
operator|->
name|request_list
argument_list|,
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to complete a task request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete task  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  task_request This parameter specifies the task request that  *             is being started.  *  * @return This method returns an indication of whether the complete task  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete task operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_complete_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|task_request
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_TASK_MANAGEMENT
operator|,
literal|"scif_sas_domain_ready_complete_task_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|task_request
operator|)
argument_list|)
expr_stmt|;
comment|// Remove the IO from the list of outstanding requests on the domain.
name|sci_fast_list_remove_element
argument_list|(
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
return|return
name|fw_device
operator|->
name|state_handlers
operator|->
name|parent
operator|.
name|complete_task_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for when a user  *        attempts to start a high priority IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start high priority  *             IO operation (which is exclusively for Phy Control hard reset).  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start  *             high priority IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being started.  *  * @return This method returns an indication of whether the start IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the start IO operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_start_high_priority_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_ready_start_high_priority_request_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|fw_device
operator|->
name|state_handlers
operator|->
name|start_high_priority_io_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|SCI_SUCCESS
condition|)
block|{
comment|// Add the IO to the list of outstanding requests on the domain.
comment|// When domain is in READY state, this high priority io is likely
comment|// a smp Phy Control or Discover request sent to parent device of
comment|// a target device, which is to be Target Reset. This high priority
comment|// IO's probably has already been added to the domain's list as a
comment|// SCIF_SAS_TASK_REQUEST. We need to check if it is already on the
comment|// list.
if|if
condition|(
operator|!
name|sci_fast_list_is_on_this_list
argument_list|(
operator|&
name|fw_domain
operator|->
name|request_list
argument_list|,
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
condition|)
name|sci_fast_list_insert_tail
argument_list|(
operator|&
name|fw_domain
operator|->
name|request_list
argument_list|,
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides READY state specific handling for  *        when a user attempts to complete an high priroity IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete high  *             priority IO operation (which is exclusively for Phy Control  *             hard reset).  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication of whether the complete IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_ready_complete_high_priority_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|,
name|void
modifier|*
name|response_data
parameter_list|,
name|SCI_IO_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCIC_TRANSPORT_PROTOCOL
name|protocol
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_ready_complete_high_priority_io_handler(0x%x, 0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|,
name|response_data
operator|)
argument_list|)
expr_stmt|;
name|protocol
operator|=
name|scic_io_request_get_protocol
argument_list|(
name|fw_request
operator|->
name|core_object
argument_list|)
expr_stmt|;
comment|// If the request is an SMP HARD/LINK RESET request, then the request
comment|// came through the task management path (partially).  As a result,
comment|// the accounting for the request is managed in the task request
comment|// completion path.  Thus, only change the domain request counter if
comment|// the request is not an SMP target reset of some sort.
if|if
condition|(
operator|(
name|protocol
operator|!=
name|SCIC_SMP_PROTOCOL
operator|)
operator|||
operator|(
name|fw_device
operator|->
name|protocol_device
operator|.
name|smp_device
operator|.
name|current_activity
operator|!=
name|SCIF_SAS_SMP_REMOTE_DEVICE_ACTIVITY_TARGET_RESET
operator|)
condition|)
block|{
name|sci_fast_list_remove_element
argument_list|(
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
block|}
return|return
name|fw_device
operator|->
name|state_handlers
operator|->
name|complete_high_priority_io_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|,
name|response_data
argument_list|,
name|completion_status
argument_list|)
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* S T O P P I N G   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_stopping_device_stop_complete_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"scif_sas_domain_stopping_device_stop_complete_handler(0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|)
argument_list|)
expr_stmt|;
comment|// Attempt to transition to the stopped state.
name|scif_sas_domain_transition_to_stopped_state
argument_list|(
name|fw_domain
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides STOPPING state specific handling for  *        when a user attempts to complete an IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication of whether the complete IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_stopping_complete_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_stopping_complete_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|scif_sas_domain_ready_complete_io_handler
argument_list|(
name|domain
argument_list|,
name|remote_device
argument_list|,
name|io_request
argument_list|)
expr_stmt|;
comment|// Attempt to transition to the stopped state.
name|scif_sas_domain_transition_to_stopped_state
argument_list|(
name|fw_domain
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides STOPPING state specific handling for  *        when a user attempts to complete an IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication of whether the complete IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_stopping_complete_high_priority_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|,
name|void
modifier|*
name|response_data
parameter_list|,
name|SCI_IO_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_stopping_complete_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|scif_sas_domain_ready_complete_high_priority_io_handler
argument_list|(
name|domain
argument_list|,
name|remote_device
argument_list|,
name|io_request
argument_list|,
name|response_data
argument_list|,
name|completion_status
argument_list|)
expr_stmt|;
comment|// Attempt to transition to the stopped state.
name|scif_sas_domain_transition_to_stopped_state
argument_list|(
name|fw_domain
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides STOPPING state specific handling for  *        when a user attempts to complete a task request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete task  *             operation.  *  * @return This method returns an indication of whether the complete task  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete task operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_stopping_complete_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_TASK_MANAGEMENT
operator|,
literal|"scif_sas_domain_stopping_complete_task_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|task_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|scif_sas_domain_ready_complete_task_handler
argument_list|(
name|domain
argument_list|,
name|remote_device
argument_list|,
name|task_request
argument_list|)
expr_stmt|;
comment|// Attempt to transition to the stopped state.
name|scif_sas_domain_transition_to_stopped_state
argument_list|(
name|fw_domain
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* D I S C O V E R I N G   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides DISCOVERING state specific processing for  *        reception of a port NOT ready notification from the core.  A port  *        NOT ready notification forces the discovery operation to complete  *        in error.  Additionally, all IOs are aborted and devices removed.  *  * @param[in]  domain This parameter specifies the domain object  *             for which the core port is no longer ready.  *  * @return  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_port_not_ready_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|U32
name|reason_code
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"scif_sas_domain_discovering_port_not_ready_handler(0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|reason_code
operator|)
argument_list|)
expr_stmt|;
comment|// Change to the STOPPING state to cause existing request
comment|// completions to be terminated and devices removed.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|,
name|SCI_BASE_DOMAIN_STATE_STOPPING
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_device_start_complete_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"scif_sas_domain_discovering_device_start_complete_handler(0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|)
argument_list|)
expr_stmt|;
comment|//domain will decide what's next step.
name|scif_sas_domain_continue_discover
argument_list|(
name|fw_domain
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_device_stop_complete_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"scif_sas_domain_discovering_device_stop_complete_handler(0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides DISCOVERING state specific handling for when a user  *        attempts to start a high priority IO request.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being started.  *  * @return This method returns an indication of whether the start IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the start IO operation  *         begins successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_start_high_priority_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_discovery_start_high_priority_request_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|fw_device
operator|->
name|state_handlers
operator|->
name|start_high_priority_io_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|SCI_SUCCESS
condition|)
block|{
comment|// Add the IO to the list of outstanding requests on the domain.
comment|// It is possible this high priority IO's has already been added to
comment|// the domain's list as a SCIF_SAS_TASK_REQUEST. We need to check
comment|// if it is already on the list.
if|if
condition|(
operator|!
name|sci_fast_list_is_on_this_list
argument_list|(
operator|&
name|fw_domain
operator|->
name|request_list
argument_list|,
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
condition|)
name|sci_fast_list_insert_tail
argument_list|(
operator|&
name|fw_domain
operator|->
name|request_list
argument_list|,
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides DISCOVERING state specific handling for  *        when a user attempts to complete an IO request.  User IOs are  *        allowed to be completed during discovery.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication of whether the complete IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_complete_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_discovering_complete_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
return|return
name|scif_sas_domain_ready_complete_io_handler
argument_list|(
name|domain
argument_list|,
name|remote_device
argument_list|,
name|io_request
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides DISCOVERING state specific handling for  *        when a user attempts to complete an high priroity IO request.  User  *        IOs are allowed to be completed during discovery.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication of whether the complete IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_complete_high_priority_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|,
name|void
modifier|*
name|response_data
parameter_list|,
name|SCI_IO_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCIC_TRANSPORT_PROTOCOL
name|protocol
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_discovering_complete_high_priority_io_handler(0x%x, 0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|,
name|response_data
operator|)
argument_list|)
expr_stmt|;
name|protocol
operator|=
name|scic_io_request_get_protocol
argument_list|(
name|fw_request
operator|->
name|core_object
argument_list|)
expr_stmt|;
comment|// Remove the IO from the list of outstanding requests on the domain.
comment|// If the request is an SMP HARD/LINK RESET request, then the request
comment|// came through the task management path (partially).  As a result,
comment|// the accounting for the request is managed in the task request
comment|// completion path.  Thus, only change the domain request counter if
comment|// the request is not an SMP target reset of some sort.
if|if
condition|(
operator|(
name|protocol
operator|!=
name|SCIC_SMP_PROTOCOL
operator|)
operator|||
operator|(
name|fw_device
operator|->
name|protocol_device
operator|.
name|smp_device
operator|.
name|current_activity
operator|!=
name|SCIF_SAS_SMP_REMOTE_DEVICE_ACTIVITY_TARGET_RESET
operator|)
condition|)
block|{
name|sci_fast_list_remove_element
argument_list|(
operator|&
name|fw_request
operator|->
name|list_element
argument_list|)
expr_stmt|;
block|}
return|return
name|fw_device
operator|->
name|state_handlers
operator|->
name|complete_high_priority_io_handler
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
argument_list|,
operator|&
name|fw_request
operator|->
name|parent
argument_list|,
name|response_data
argument_list|,
name|completion_status
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides DISCOVERING state specific handling for  *        when the framework attempts to complete an IO request.  Internal  *        Framework IOs allowed to be continued during discovery.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a continue IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a continue  *             IO operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being continued.  *  * @return This method returns an indication of whether the continue IO  *         operation succeeded.  * @retval SCI_SUCCESS This value is returned when the continue IO operation  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_continue_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_domain_discovering_continue_io_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|io_request
operator|)
argument_list|)
expr_stmt|;
comment|/// @todo fix return code handling.
return|return
name|SCI_FAILURE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides handling when a user attempts to start  *        a task on a domain in DISCOVER state, only hard reset is allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start task  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  task_request This parameter specifies the task request that  *             is being started.  *  * @return This method returns a status of start task operations  * @retval SCI_FAILURE_INVALID_STATE This value is returned for any tasks,  *         except for HARD RESET.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_start_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_TASK_REQUEST_T
modifier|*
name|fw_task
init|=
operator|(
name|SCIF_SAS_TASK_REQUEST_T
operator|*
operator|)
name|task_request
decl_stmt|;
comment|//Only let target reset go through.
if|if
condition|(
name|scif_sas_task_request_get_function
argument_list|(
name|fw_task
argument_list|)
operator|==
name|SCI_SAS_HARD_RESET
condition|)
block|{
comment|//If the domain is in the middle of smp DISCOVER process,
comment|//interrupt it. After target reset is done, resume the smp DISCOVERY.
name|scif_sas_domain_cancel_smp_activities
argument_list|(
name|fw_device
operator|->
name|domain
argument_list|)
expr_stmt|;
return|return
name|scif_sas_domain_ready_start_task_handler
argument_list|(
name|domain
argument_list|,
name|remote_device
argument_list|,
name|task_request
argument_list|)
return|;
block|}
else|else
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x start task message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
block|}
end_function

begin_comment
comment|/**  * @brief This method provides DISCOVERING state specific handling for  *        when a user attempts to complete a task request.  User task  *        management requests are allowed to be completed during discovery.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  task_request This parameter specifies the task request that  *             is being completed.  *  * @return This method returns an indication of whether the complete task  *         management operation succeeded.  * @retval SCI_SUCCESS This value is returned when the complete task request  *         is successful.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_complete_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_TASK_MANAGEMENT
operator|,
literal|"scif_sas_domain_discovering_complete_task_handler(0x%x, 0x%x, 0x%x) enter\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|task_request
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|scif_sas_domain_ready_complete_task_handler
argument_list|(
name|domain
argument_list|,
name|remote_device
argument_list|,
name|task_request
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* D E F A U L T   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to discover a domain and a discovery  *        operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform an discover  *             operation.  * @param[in]  op_timeout This parameter specifies the timeout  *             (in milliseconds) for the entire discovery operation.  *             This timeout value should be some multiple of the  *             individual device_timeout value.  * @param[in]  device_timeout This parameter specifies the timeout  *             (in milliseconds) for an individual device being discovered  *             and configured during this operation.  *  * @return This method returns an indication that discovery operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_discover_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|U32
name|op_timeout
parameter_list|,
name|U32
name|device_timeout
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"Domain:0x%x State:0x%x requested to discover in invalid state\n"
operator|,
name|domain
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default processing for reception of a port  *        ready notification from the core.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the core port has just come ready.  *  * @return  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_port_ready_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|)
block|{
name|SCIF_LOG_INFO
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x State:0x%x port now ready\n"
operator|,
name|domain
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default processing for reception of a port  *        NOT ready notification from the core.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the core port has just come ready.  *  * @return  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_port_not_ready_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|U32
name|reason_code
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x State:0x%x Port Not Ready 0x%x in invalid state\n"
operator|,
name|domain
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|,
name|reason_code
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to start an IO on a domain and a start  *        IO operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being started.  *  * @return This method returns an indication that start IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_start_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x start IO message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to complete an IO on a domain and a  *        complete IO operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication that complete IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_complete_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x complete IO message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to complete an IO on a domain and a  *        complete IO operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being completed.  *  * @return This method returns an indication that complete IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_complete_high_priority_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|,
name|void
modifier|*
name|response_data
parameter_list|,
name|SCI_IO_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x complete IO message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to continue an IO on a domain and a  *        continue IO operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a continue IO  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the io request that is  *             being started.  *  * @return This method returns an indication that continue IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_continue_io_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x contineu IO message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to start a task on a domain and a start  *        task operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a start task  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  task_request This parameter specifies the task request that  *             is being started.  *  * @return This method returns an indication that start task operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_start_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x start task message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a user attempts to complete a task on a domain and a  *        complete task operation is not allowed.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the user is attempting to perform a complete task  *             operation.  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  task_request This parameter specifies the task request that  *             is being started.  *  * @return This method returns an indication that complete task operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_complete_task_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x complete task message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a remote device start operation completes in a state.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the remote device start operation is completing.  * @param[in]  remote_device This parameter specifies the remote device  *             for which the start operation is completing.  *  * @return This method returns an indication that start operation  *         completion is not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_device_start_complete_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x device stop complete message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when a remote device stop operation completes in a state.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the remote device stop operation is completing.  * @param[in]  remote_device This parameter specifies the remote device  *             for which the stop operation is completing.  *  * @return This method returns an indication that stop operation  *         completion is not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_device_stop_complete_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x device stop complete message invalid\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error)  *        when sci user try to destruct a remote device of this domain.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the remote device is to be destructed.  * @param[in]  remote_device This parameter specifies the remote device  *             to be destructed.  *  * @return This method returns an indication that device destruction  *         is not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_default_device_destruct_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x device destruct in invalid state\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides handling when sci user destruct a remote  *        device of this domain in discovering state. Mainly the device  *        is removed from domain's remote_device_list.  *  * @param[in]  domain This parameter specifies the domain object  *             on which the remote device is to be destructed.  * @param[in]  remote_device This parameter specifies the remote device  *             to be destructed.  *  * @return This method returns a status of the device destruction.  * @retval SCI_SUCCESS This value is returned when a remote device is  *         successfully removed from domain.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_domain_discovering_device_destruct_handler
parameter_list|(
name|SCI_BASE_DOMAIN_T
modifier|*
name|domain
parameter_list|,
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_SAS_DOMAIN_T
modifier|*
name|fw_domain
init|=
operator|(
name|SCIF_SAS_DOMAIN_T
operator|*
operator|)
name|domain
decl_stmt|;
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|domain
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_DOMAIN
operator|,
literal|"Domain:0x%x Device:0x%x State:0x%x device destruct in domain DISCOVERING state\n"
operator|,
name|domain
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|domain
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|//remove the remote device from domain's remote_device_list
name|sci_abstract_list_erase
argument_list|(
operator|&
operator|(
name|fw_domain
operator|->
name|remote_device_list
operator|)
argument_list|,
name|remote_device
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_define
define|#
directive|define
name|scif_sas_domain_stopped_discover_handler
define|\
value|scif_sas_domain_ready_discover_handler
end_define

begin_define
define|#
directive|define
name|scif_sas_domain_default_start_high_priority_io_handler
define|\
value|scif_sas_domain_default_start_io_handler
end_define

begin_decl_stmt
name|SCI_BASE_DOMAIN_STATE_HANDLER_T
name|scif_sas_domain_state_handler_table
index|[
name|SCI_BASE_DOMAIN_MAX_STATES
index|]
init|=
block|{
comment|// SCI_BASE_DOMAIN_STATE_INITIAL
block|{
name|scif_sas_domain_default_discover_handler
block|,
name|scif_sas_domain_default_port_ready_handler
block|,
name|scif_sas_domain_default_port_not_ready_handler
block|,
name|scif_sas_domain_default_device_start_complete_handler
block|,
name|scif_sas_domain_default_device_stop_complete_handler
block|,
name|scif_sas_domain_default_device_destruct_handler
block|,
name|scif_sas_domain_default_start_io_handler
block|,
name|scif_sas_domain_default_start_high_priority_io_handler
block|,
name|scif_sas_domain_default_complete_io_handler
block|,
name|scif_sas_domain_default_complete_high_priority_io_handler
block|,
name|scif_sas_domain_default_continue_io_handler
block|,
name|scif_sas_domain_default_start_task_handler
block|,
name|scif_sas_domain_default_complete_task_handler
block|}
block|,
comment|// SCI_BASE_DOMAIN_STATE_STARTING
block|{
name|scif_sas_domain_default_discover_handler
block|,
name|scif_sas_domain_starting_port_ready_handler
block|,
name|scif_sas_domain_default_port_not_ready_handler
block|,
name|scif_sas_domain_default_device_start_complete_handler
block|,
name|scif_sas_domain_default_device_stop_complete_handler
block|,
name|scif_sas_domain_default_device_destruct_handler
block|,
name|scif_sas_domain_default_start_io_handler
block|,
name|scif_sas_domain_default_start_high_priority_io_handler
block|,
name|scif_sas_domain_default_complete_io_handler
block|,
name|scif_sas_domain_default_complete_high_priority_io_handler
block|,
name|scif_sas_domain_default_continue_io_handler
block|,
name|scif_sas_domain_default_start_task_handler
block|,
name|scif_sas_domain_default_complete_task_handler
block|}
block|,
comment|// SCI_BASE_DOMAIN_STATE_READY
block|{
name|scif_sas_domain_ready_discover_handler
block|,
name|scif_sas_domain_default_port_ready_handler
block|,
name|scif_sas_domain_ready_port_not_ready_handler
block|,
name|scif_sas_domain_default_device_start_complete_handler
block|,
name|scif_sas_domain_default_device_stop_complete_handler
block|,
name|scif_sas_domain_default_device_destruct_handler
block|,
name|scif_sas_domain_ready_start_io_handler
block|,
name|scif_sas_domain_ready_start_high_priority_io_handler
block|,
name|scif_sas_domain_ready_complete_io_handler
block|,
name|scif_sas_domain_ready_complete_high_priority_io_handler
block|,
name|scif_sas_domain_ready_continue_io_handler
block|,
name|scif_sas_domain_ready_start_task_handler
block|,
name|scif_sas_domain_ready_complete_task_handler
block|}
block|,
comment|// SCI_BASE_DOMAIN_STATE_STOPPING
block|{
name|scif_sas_domain_default_discover_handler
block|,
name|scif_sas_domain_default_port_ready_handler
block|,
name|scif_sas_domain_default_port_not_ready_handler
block|,
name|scif_sas_domain_default_device_start_complete_handler
block|,
name|scif_sas_domain_stopping_device_stop_complete_handler
block|,
name|scif_sas_domain_default_device_destruct_handler
block|,
name|scif_sas_domain_default_start_io_handler
block|,
name|scif_sas_domain_default_start_high_priority_io_handler
block|,
name|scif_sas_domain_stopping_complete_io_handler
block|,
name|scif_sas_domain_stopping_complete_high_priority_io_handler
block|,
name|scif_sas_domain_default_continue_io_handler
block|,
name|scif_sas_domain_default_start_task_handler
block|,
name|scif_sas_domain_stopping_complete_task_handler
block|}
block|,
comment|// SCI_BASE_DOMAIN_STATE_STOPPED
block|{
name|scif_sas_domain_stopped_discover_handler
block|,
name|scif_sas_domain_default_port_ready_handler
block|,
name|scif_sas_domain_default_port_not_ready_handler
block|,
name|scif_sas_domain_default_device_start_complete_handler
block|,
name|scif_sas_domain_default_device_stop_complete_handler
block|,
name|scif_sas_domain_default_device_destruct_handler
block|,
name|scif_sas_domain_default_start_io_handler
block|,
name|scif_sas_domain_default_start_high_priority_io_handler
block|,
name|scif_sas_domain_default_complete_io_handler
block|,
name|scif_sas_domain_default_complete_high_priority_io_handler
block|,
name|scif_sas_domain_default_continue_io_handler
block|,
name|scif_sas_domain_default_start_task_handler
block|,
name|scif_sas_domain_default_complete_task_handler
block|}
block|,
comment|// SCI_BASE_DOMAIN_STATE_DISCOVERING
block|{
name|scif_sas_domain_default_discover_handler
block|,
name|scif_sas_domain_default_port_ready_handler
block|,
name|scif_sas_domain_discovering_port_not_ready_handler
block|,
name|scif_sas_domain_discovering_device_start_complete_handler
block|,
name|scif_sas_domain_discovering_device_stop_complete_handler
block|,
name|scif_sas_domain_discovering_device_destruct_handler
block|,
comment|//
name|scif_sas_domain_default_start_io_handler
block|,
name|scif_sas_domain_discovering_start_high_priority_io_handler
block|,
name|scif_sas_domain_discovering_complete_io_handler
block|,
name|scif_sas_domain_discovering_complete_high_priority_io_handler
block|,
comment|//
name|scif_sas_domain_discovering_continue_io_handler
block|,
name|scif_sas_domain_discovering_start_task_handler
block|,
name|scif_sas_domain_discovering_complete_task_handler
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

