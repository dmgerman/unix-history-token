begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * This file is provided under a dual BSD/GPLv2 license.  When using or  * redistributing this file, you may do so under either license. * * GPL LICENSE SUMMARY * * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved. * * This program is free software; you can redistribute it and/or modify * it under the terms of version 2 of the GNU General Public License as * published by the Free Software Foundation. * * This program is distributed in the hope that it will be useful, but * WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU * General Public License for more details. * * You should have received a copy of the GNU General Public License * along with this program; if not, write to the Free Software * Foundation, Inc., 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA. * The full GNU General Public License is included in this distribution * in the file called LICENSE.GPL. * * BSD LICENSE * * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved. * All rights reserved. * * Redistribution and use in source and binary forms, with or without * modification, are permitted provided that the following conditions * are met: * *   * Redistributions of source code must retain the above copyright *     notice, this list of conditions and the following disclaimer. *   * Redistributions in binary form must reproduce the above copyright *     notice, this list of conditions and the following disclaimer in *     the documentation and/or other materials provided with the *     distribution. * * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/** * @file * * @brief This file contains the structures, constants, and prototypes *        associated with the remote node context in the silicon.  It *        exists to model and manage the remote node context in the silicon. */
end_comment

begin_include
include|#
directive|include
file|<dev/isci/scil/sci_util.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_sds_logger.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_sds_controller.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_sds_remote_device.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_sds_remote_node_context.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/sci_base_state_machine.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_remote_device.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_sds_port.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scu_event_codes.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scu_task_context.h>
end_include

begin_comment
comment|/** * @brief */
end_comment

begin_function
name|void
name|scic_sds_remote_node_context_construct
parameter_list|(
name|SCIC_SDS_REMOTE_DEVICE_T
modifier|*
name|device
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
parameter_list|,
name|U16
name|remote_node_index
parameter_list|)
block|{
name|memset
argument_list|(
name|rnc
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
argument_list|)
argument_list|)
expr_stmt|;
name|rnc
operator|->
name|remote_node_index
operator|=
name|remote_node_index
expr_stmt|;
name|rnc
operator|->
name|device
operator|=
name|device
expr_stmt|;
name|rnc
operator|->
name|destination_state
operator|=
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_UNSPECIFIED
expr_stmt|;
name|rnc
operator|->
name|parent
operator|.
name|logger
operator|=
name|device
operator|->
name|parent
operator|.
name|parent
operator|.
name|logger
expr_stmt|;
name|sci_base_state_machine_construct
argument_list|(
operator|&
name|rnc
operator|->
name|state_machine
argument_list|,
operator|&
name|rnc
operator|->
name|parent
argument_list|,
name|scic_sds_remote_node_context_state_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INITIAL_STATE
argument_list|)
expr_stmt|;
name|sci_base_state_machine_start
argument_list|(
operator|&
name|rnc
operator|->
name|state_machine
argument_list|)
expr_stmt|;
comment|// State logging initialization takes place late for the remote node context
comment|// see the resume state handler for the initial state.
block|}
end_function

begin_comment
comment|/** * This method will return TRUE if the RNC is not in the initial state.  In * all other states the RNC is considered active and this will return TRUE. * * @note The destroy request of the state machine drives the RNC back to the *       initial state.  If the state machine changes then this routine will *       also have to be changed. * * @param[in] this_rnc The RNC for which the is posted request is being made. * * @return BOOL * @retval TRUE if the state machine is not in the initial state * @retval FALSE if the state machine is in the initial state */
end_comment

begin_function
name|BOOL
name|scic_sds_remote_node_context_is_initialized
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|U32
name|current_state
init|=
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
decl_stmt|;
if|if
condition|(
name|current_state
operator|==
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INITIAL_STATE
condition|)
block|{
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/** * This method will return TRUE if the remote node context is in a READY state * otherwise it will return FALSE * * @param[in] this_rnc The state of the remote node context object to check. * * @return BOOL * @retval TRUE if the remote node context is in the ready state. * @retval FALSE if the remote node context is not in the ready state. */
end_comment

begin_function
name|BOOL
name|scic_sds_remote_node_context_is_ready
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|U32
name|current_state
init|=
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
decl_stmt|;
if|if
condition|(
name|current_state
operator|==
name|SCIC_SDS_REMOTE_NODE_CONTEXT_READY_STATE
condition|)
block|{
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/** * This method will construct the RNC buffer for this remote device object. * * @param[in] this_device The remote device to use to construct the RNC *       buffer. * @param[in] rnc The buffer into which the remote device data will be copied. * * @return none */
end_comment

begin_function
name|void
name|scic_sds_remote_node_context_construct_buffer
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|SCU_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|SCIC_SDS_CONTROLLER_T
modifier|*
name|the_controller
decl_stmt|;
name|the_controller
operator|=
name|scic_sds_remote_device_get_controller
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
expr_stmt|;
name|rnc
operator|=
name|scic_sds_controller_get_remote_node_context_buffer
argument_list|(
name|the_controller
argument_list|,
name|this_rnc
operator|->
name|remote_node_index
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|rnc
argument_list|,
literal|0x00
argument_list|,
sizeof|sizeof
argument_list|(
name|SCU_REMOTE_NODE_CONTEXT_T
argument_list|)
operator|*
name|scic_sds_remote_device_node_count
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
argument_list|)
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|remote_node_index
operator|=
name|this_rnc
operator|->
name|remote_node_index
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|remote_node_port_width
operator|=
name|this_rnc
operator|->
name|device
operator|->
name|device_port_width
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|logical_port_index
operator|=
name|scic_sds_remote_device_get_port_index
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|remote_sas_address_hi
operator|=
name|SCIC_SWAP_DWORD
argument_list|(
name|this_rnc
operator|->
name|device
operator|->
name|device_address
operator|.
name|high
argument_list|)
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|remote_sas_address_lo
operator|=
name|SCIC_SWAP_DWORD
argument_list|(
name|this_rnc
operator|->
name|device
operator|->
name|device_address
operator|.
name|low
argument_list|)
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|nexus_loss_timer_enable
operator|=
name|TRUE
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|check_bit
operator|=
name|FALSE
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|is_valid
operator|=
name|FALSE
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|is_remote_node_context
operator|=
name|TRUE
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|function_number
operator|=
literal|0
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|arbitration_wait_time
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|this_rnc
operator|->
name|device
operator|->
name|target_protocols
operator|.
name|u
operator|.
name|bits
operator|.
name|attached_sata_device
operator|||
name|this_rnc
operator|->
name|device
operator|->
name|target_protocols
operator|.
name|u
operator|.
name|bits
operator|.
name|attached_stp_target
condition|)
block|{
name|rnc
operator|->
name|ssp
operator|.
name|connection_occupancy_timeout
operator|=
name|the_controller
operator|->
name|user_parameters
operator|.
name|sds1
operator|.
name|stp_max_occupancy_timeout
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|connection_inactivity_timeout
operator|=
name|the_controller
operator|->
name|user_parameters
operator|.
name|sds1
operator|.
name|stp_inactivity_timeout
expr_stmt|;
block|}
else|else
block|{
name|rnc
operator|->
name|ssp
operator|.
name|connection_occupancy_timeout
operator|=
name|the_controller
operator|->
name|user_parameters
operator|.
name|sds1
operator|.
name|ssp_max_occupancy_timeout
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|connection_inactivity_timeout
operator|=
name|the_controller
operator|->
name|user_parameters
operator|.
name|sds1
operator|.
name|ssp_inactivity_timeout
expr_stmt|;
block|}
name|rnc
operator|->
name|ssp
operator|.
name|initial_arbitration_wait_time
operator|=
literal|0
expr_stmt|;
comment|// Open Address Frame Parameters
name|rnc
operator|->
name|ssp
operator|.
name|oaf_connection_rate
operator|=
name|this_rnc
operator|->
name|device
operator|->
name|connection_rate
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|oaf_features
operator|=
literal|0
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|oaf_source_zone_group
operator|=
literal|0
expr_stmt|;
name|rnc
operator|->
name|ssp
operator|.
name|oaf_more_compatibility_features
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SCI_LOGGING
end_ifdef

begin_comment
comment|/** * This method will enable and turn on state transition logging for the remote * node context object. * * @param[in] this_rnc The remote node context for which state transition *       logging is to be enabled. * * @return none */
end_comment

begin_function
name|void
name|scic_sds_remote_node_context_initialize_state_logging
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|sci_base_state_machine_logger_initialize
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine_logger
argument_list|,
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
operator|&
name|this_rnc
operator|->
name|parent
argument_list|,
name|scic_cb_logger_log_states
argument_list|,
literal|"SCIC_SDS_REMOTE_NODE_CONTEXT_T"
argument_list|,
literal|"state machine"
argument_list|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * This method will stop the state machine logging for this object and should * be called before the object is destroyed. * * @param[in] this_rnc The remote node context on which to stop logging state *       transitions. * * @return none */
end_comment

begin_function
name|void
name|scic_sds_remote_node_context_deinitialize_state_logging
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|sci_base_state_machine_logger_deinitialize
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine_logger
argument_list|,
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/** * This method will setup the remote node context object so it will transition * to its ready state.  If the remote node context is already setup to * transition to its final state then this function does nothing. * * @param[in] this_rnc * @param[in] the_callback * @param[in] callback_parameter * * @return none */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_setup_to_resume
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
if|if
condition|(
name|this_rnc
operator|->
name|destination_state
operator|!=
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_FINAL
condition|)
block|{
name|this_rnc
operator|->
name|destination_state
operator|=
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_READY
expr_stmt|;
name|this_rnc
operator|->
name|user_callback
operator|=
name|the_callback
expr_stmt|;
name|this_rnc
operator|->
name|user_cookie
operator|=
name|callback_parameter
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** * This method will setup the remote node context object so it will * transistion to its final state. * * @param[in] this_rnc * @param[in] the_callback * @param[in] callback_parameter * * @return none */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_setup_to_destory
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|this_rnc
operator|->
name|destination_state
operator|=
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_FINAL
expr_stmt|;
name|this_rnc
operator|->
name|user_callback
operator|=
name|the_callback
expr_stmt|;
name|this_rnc
operator|->
name|user_cookie
operator|=
name|callback_parameter
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * This method will continue to resume a remote node context.  This is used * in the states where a resume is requested while a resume is in progress. * * @param[in] this_rnc * @param[in] the_callback * @param[in] callback_parameter */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_continue_to_resume_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
if|if
condition|(
name|this_rnc
operator|->
name|destination_state
operator|==
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_READY
condition|)
block|{
name|this_rnc
operator|->
name|user_callback
operator|=
name|the_callback
expr_stmt|;
name|this_rnc
operator|->
name|user_cookie
operator|=
name|callback_parameter
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* REMOTE NODE CONTEXT STATE MACHINE
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_default_destruct_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to stop while in unexpected state %d\n"
operator|,
name|this_rnc
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|// We have decided that the destruct request on the remote node context can not fail
comment|// since it is either in the initial/destroyed state or is can be destroyed.
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_default_suspend_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|suspend_type
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to suspend while in wrong state %d\n"
operator|,
name|this_rnc
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_default_resume_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to resume while in wrong state %d\n"
operator|,
name|this_rnc
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_default_start_io_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to start io 0x%x while in wrong state %d\n"
operator|,
name|this_rnc
operator|,
name|the_request
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_default_start_task_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to start task 0x%x while in wrong state %d\n"
operator|,
name|this_rnc
operator|,
name|the_request
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_default_event_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|event_code
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to process event 0x%x while in wrong state %d\n"
operator|,
name|this_rnc
operator|,
name|event_code
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/** * This method determines if the task request can be started by the SCU * hardware. When the RNC is in the ready state any task can be started. * * @param[in] this_rnc The rnc for which the task request is targeted. * @param[in] the_request The request which is going to be started. * * @return SCI_STATUS * @retval SCI_SUCCESS */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_success_start_task_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/** * This method handles destruct calls from the various state handlers.  The * remote node context can be requested to destroy from any state. If there * was a user callback it is always replaced with the request to destroy user * callback. * * @param[in] this_rnc * @param[in] the_callback * @param[in] callback_parameter * * @return SCI_STATUS */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_general_destruct_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|scic_sds_remote_node_context_setup_to_destory
argument_list|(
name|this_rnc
argument_list|,
name|the_callback
argument_list|,
name|callback_parameter
argument_list|)
expr_stmt|;
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_reset_required_start_io_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to start io 0x%x while in wrong state %d\n"
operator|,
name|this_rnc
operator|,
name|the_request
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_REMOTE_DEVICE_RESET_REQUIRED
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_initial_state_resume_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
if|if
condition|(
name|this_rnc
operator|->
name|remote_node_index
operator|!=
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALID_INDEX
condition|)
block|{
name|scic_sds_remote_node_context_setup_to_resume
argument_list|(
name|this_rnc
argument_list|,
name|the_callback
argument_list|,
name|callback_parameter
argument_list|)
expr_stmt|;
name|scic_sds_remote_node_context_construct_buffer
argument_list|(
name|this_rnc
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SCI_LOGGING
argument_list|)
comment|// If a remote node context has a logger already, don't work on its state
comment|// logging.
if|if
condition|(
name|this_rnc
operator|->
name|state_machine
operator|.
name|previous_state_id
operator|!=
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
condition|)
name|scic_sds_remote_node_context_initialize_state_logging
argument_list|(
name|this_rnc
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_POSTING_STATE
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_posting_state_event_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|event_code
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
switch|switch
condition|(
name|scu_get_event_code
argument_list|(
name|event_code
argument_list|)
condition|)
block|{
case|case
name|SCU_EVENT_POST_RNC_COMPLETE
case|:
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_READY_STATE
argument_list|)
expr_stmt|;
break|break;
default|default:
name|status
operator|=
name|SCI_FAILURE
expr_stmt|;
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to process unexpected event 0x%x while in posting state\n"
operator|,
name|this_rnc
operator|,
name|event_code
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_invalidating_state_destruct_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|scic_sds_remote_node_context_setup_to_destory
argument_list|(
name|this_rnc
argument_list|,
name|the_callback
argument_list|,
name|callback_parameter
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_invalidating_state_event_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|event_code
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
if|if
condition|(
name|scu_get_event_code
argument_list|(
name|event_code
argument_list|)
operator|==
name|SCU_EVENT_POST_RNC_INVALIDATE_COMPLETE
condition|)
block|{
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
if|if
condition|(
name|this_rnc
operator|->
name|destination_state
operator|==
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_FINAL
condition|)
block|{
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INITIAL_STATE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_POSTING_STATE
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
switch|switch
condition|(
name|scu_get_event_type
argument_list|(
name|event_code
argument_list|)
condition|)
block|{
case|case
name|SCU_EVENT_TYPE_RNC_SUSPEND_TX
case|:
case|case
name|SCU_EVENT_TYPE_RNC_SUSPEND_TX_RX
case|:
comment|// We really dont care if the hardware is going to suspend
comment|// the device since it's being invalidated anyway
name|SCIC_LOG_INFO
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x was suspeneded by hardware while being invalidated.\n"
operator|,
name|this_rnc
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
break|break;
default|default:
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to process event 0x%x while in state %d.\n"
operator|,
name|this_rnc
operator|,
name|event_code
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_FAILURE
expr_stmt|;
break|break;
block|}
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_resuming_state_event_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|event_code
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
if|if
condition|(
name|scu_get_event_code
argument_list|(
name|event_code
argument_list|)
operator|==
name|SCU_EVENT_POST_RCN_RELEASE
condition|)
block|{
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_READY_STATE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
switch|switch
condition|(
name|scu_get_event_type
argument_list|(
name|event_code
argument_list|)
condition|)
block|{
case|case
name|SCU_EVENT_TYPE_RNC_SUSPEND_TX
case|:
case|case
name|SCU_EVENT_TYPE_RNC_SUSPEND_TX_RX
case|:
comment|// We really dont care if the hardware is going to suspend
comment|// the device since it's being resumed anyway
name|SCIC_LOG_INFO
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x was suspeneded by hardware while being resumed.\n"
operator|,
name|this_rnc
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
break|break;
default|default:
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to process event 0x%x while in state %d.\n"
operator|,
name|this_rnc
operator|,
name|event_code
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_FAILURE
expr_stmt|;
break|break;
block|}
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_comment
comment|/** * This method will handle the suspend requests from the ready state. * * @param[in] this_rnc The remote node context object being suspended. * @param[in] the_callback The callback when the suspension is complete. * @param[in] callback_parameter The parameter that is to be passed into the *       callback. * * @return SCI_SUCCESS */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_ready_state_suspend_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|suspend_type
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|this_rnc
operator|->
name|user_callback
operator|=
name|the_callback
expr_stmt|;
name|this_rnc
operator|->
name|user_cookie
operator|=
name|callback_parameter
expr_stmt|;
name|this_rnc
operator|->
name|suspension_code
operator|=
name|suspend_type
expr_stmt|;
if|if
condition|(
name|suspend_type
operator|==
name|SCI_SOFTWARE_SUSPENSION
condition|)
block|{
name|scic_sds_remote_device_post_request
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|,
name|SCU_CONTEXT_COMMAND_POST_RNC_SUSPEND_TX
argument_list|)
expr_stmt|;
block|}
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_AWAIT_SUSPENSION_STATE
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/** * This method determines if the io request can be started by the SCU * hardware. When the RNC is in the ready state any io request can be started. * * @param[in] this_rnc The rnc for which the io request is targeted. * @param[in] the_request The request which is going to be started. * * @return SCI_STATUS * @retval SCI_SUCCESS */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_ready_state_start_io_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_ready_state_event_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|event_code
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
switch|switch
condition|(
name|scu_get_event_type
argument_list|(
name|event_code
argument_list|)
condition|)
block|{
case|case
name|SCU_EVENT_TL_RNC_SUSPEND_TX
case|:
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_SUSPENDED_STATE
argument_list|)
expr_stmt|;
name|this_rnc
operator|->
name|suspension_code
operator|=
name|scu_get_event_specifier
argument_list|(
name|event_code
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
break|break;
case|case
name|SCU_EVENT_TL_RNC_SUSPEND_TX_RX
case|:
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_RX_SUSPENDED_STATE
argument_list|)
expr_stmt|;
name|this_rnc
operator|->
name|suspension_code
operator|=
name|scu_get_event_specifier
argument_list|(
name|event_code
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
break|break;
default|default:
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to process event 0x%x while in state %d.\n"
operator|,
name|this_rnc
operator|,
name|event_code
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_FAILURE
expr_stmt|;
break|break;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_tx_suspended_state_resume_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|SMP_DISCOVER_RESPONSE_PROTOCOLS_T
name|protocols
decl_stmt|;
name|scic_sds_remote_node_context_setup_to_resume
argument_list|(
name|this_rnc
argument_list|,
name|the_callback
argument_list|,
name|callback_parameter
argument_list|)
expr_stmt|;
comment|// If this is an expander attached SATA device we must invalidate
comment|// and repost the RNC since this is the only way to clear the
comment|// TCi to NCQ tag mapping table for the RNi
comment|// All other device types we can just resume.
name|scic_remote_device_get_protocols
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|,
operator|&
name|protocols
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|protocols
operator|.
name|u
operator|.
name|bits
operator|.
name|attached_stp_target
operator|==
literal|1
operator|)
operator|&&
operator|!
operator|(
name|this_rnc
operator|->
name|device
operator|->
name|is_direct_attached
operator|)
condition|)
block|{
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_RESUMING_STATE
argument_list|)
expr_stmt|;
block|}
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/** * This method will report a success or failure attempt to start a new task * request to the hardware.  Since all task requests are sent on the high * priority queue they can be sent when the RCN is in a TX suspend state. * * @param[in] this_rnc The remote node context which is to receive the task *       request. * @param[in] the_request The task request to be transmitted to to the remote *       target device. * * @return SCI_STATUS * @retval SCI_SUCCESS */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_suspended_start_task_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
name|scic_sds_remote_node_context_resume
argument_list|(
name|this_rnc
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_tx_rx_suspended_state_resume_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|scic_sds_remote_node_context_setup_to_resume
argument_list|(
name|this_rnc
argument_list|,
name|the_callback
argument_list|,
name|callback_parameter
argument_list|)
expr_stmt|;
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_RESUMING_STATE
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_comment
comment|/** * */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_await_suspension_state_resume_handler
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|the_callback
parameter_list|,
name|void
modifier|*
name|callback_parameter
parameter_list|)
block|{
name|scic_sds_remote_node_context_setup_to_resume
argument_list|(
name|this_rnc
argument_list|,
name|the_callback
argument_list|,
name|callback_parameter
argument_list|)
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/** * This method will report a success or failure attempt to start a new task * request to the hardware.  Since all task requests are sent on the high * priority queue they can be sent when the RCN is in a TX suspend state. * * @param[in] this_rnc The remote node context which is to receive the task *       request. * @param[in] the_request The task request to be transmitted to to the remote *       target device. * * @return SCI_STATUS * @retval SCI_SUCCESS */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_await_suspension_state_start_task_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|struct
name|SCIC_SDS_REQUEST
modifier|*
name|the_request
parameter_list|)
block|{
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_function
specifier|static
name|SCI_STATUS
name|scic_sds_remote_node_context_await_suspension_state_event_handler
parameter_list|(
name|struct
name|SCIC_SDS_REMOTE_NODE_CONTEXT
modifier|*
name|this_rnc
parameter_list|,
name|U32
name|event_code
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
switch|switch
condition|(
name|scu_get_event_type
argument_list|(
name|event_code
argument_list|)
condition|)
block|{
case|case
name|SCU_EVENT_TL_RNC_SUSPEND_TX
case|:
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_SUSPENDED_STATE
argument_list|)
expr_stmt|;
name|this_rnc
operator|->
name|suspension_code
operator|=
name|scu_get_event_specifier
argument_list|(
name|event_code
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
break|break;
case|case
name|SCU_EVENT_TL_RNC_SUSPEND_TX_RX
case|:
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_RX_SUSPENDED_STATE
argument_list|)
expr_stmt|;
name|this_rnc
operator|->
name|suspension_code
operator|=
name|scu_get_event_specifier
argument_list|(
name|event_code
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_SUCCESS
expr_stmt|;
break|break;
default|default:
name|SCIC_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
operator|,
name|SCIC_LOG_OBJECT_SSP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_SMP_REMOTE_TARGET
operator||
name|SCIC_LOG_OBJECT_STP_REMOTE_TARGET
operator|,
literal|"SCIC Remote Node Context 0x%x requested to process event 0x%x while in state %d.\n"
operator|,
name|this_rnc
operator|,
name|event_code
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|this_rnc
operator|->
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|SCI_FAILURE
expr_stmt|;
break|break;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_decl_stmt
name|SCIC_SDS_REMOTE_NODE_CONTEXT_HANDLERS
name|scic_sds_remote_node_context_state_handler_table
index|[
name|SCIC_SDS_REMOTE_NODE_CONTEXT_MAX_STATES
index|]
init|=
block|{
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_INITIAL_STATE
block|{
name|scic_sds_remote_node_context_default_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_initial_state_resume_handler
block|,
name|scic_sds_remote_node_context_default_start_io_handler
block|,
name|scic_sds_remote_node_context_default_start_task_handler
block|,
name|scic_sds_remote_node_context_default_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_POSTING_STATE
block|{
name|scic_sds_remote_node_context_general_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_continue_to_resume_handler
block|,
name|scic_sds_remote_node_context_default_start_io_handler
block|,
name|scic_sds_remote_node_context_default_start_task_handler
block|,
name|scic_sds_remote_node_context_posting_state_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
block|{
name|scic_sds_remote_node_context_invalidating_state_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_continue_to_resume_handler
block|,
name|scic_sds_remote_node_context_default_start_io_handler
block|,
name|scic_sds_remote_node_context_default_start_task_handler
block|,
name|scic_sds_remote_node_context_invalidating_state_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_RESUMING_STATE
block|{
name|scic_sds_remote_node_context_general_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_continue_to_resume_handler
block|,
name|scic_sds_remote_node_context_default_start_io_handler
block|,
name|scic_sds_remote_node_context_success_start_task_handler
block|,
name|scic_sds_remote_node_context_resuming_state_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_READY_STATE
block|{
name|scic_sds_remote_node_context_general_destruct_handler
block|,
name|scic_sds_remote_node_context_ready_state_suspend_handler
block|,
name|scic_sds_remote_node_context_default_resume_handler
block|,
name|scic_sds_remote_node_context_ready_state_start_io_handler
block|,
name|scic_sds_remote_node_context_success_start_task_handler
block|,
name|scic_sds_remote_node_context_ready_state_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_TX_SUSPENDED_STATE
block|{
name|scic_sds_remote_node_context_general_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_tx_suspended_state_resume_handler
block|,
name|scic_sds_remote_node_context_reset_required_start_io_handler
block|,
name|scic_sds_remote_node_context_suspended_start_task_handler
block|,
name|scic_sds_remote_node_context_default_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_TX_RX_SUSPENDED_STATE
block|{
name|scic_sds_remote_node_context_general_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_tx_rx_suspended_state_resume_handler
block|,
name|scic_sds_remote_node_context_reset_required_start_io_handler
block|,
name|scic_sds_remote_node_context_suspended_start_task_handler
block|,
name|scic_sds_remote_node_context_default_event_handler
block|}
block|,
comment|// SCIC_SDS_REMOTE_NODE_CONTEXT_AWAIT_SUSPENSION_STATE
block|{
name|scic_sds_remote_node_context_general_destruct_handler
block|,
name|scic_sds_remote_node_context_default_suspend_handler
block|,
name|scic_sds_remote_node_context_await_suspension_state_resume_handler
block|,
name|scic_sds_remote_node_context_reset_required_start_io_handler
block|,
name|scic_sds_remote_node_context_await_suspension_state_start_task_handler
block|,
name|scic_sds_remote_node_context_await_suspension_state_event_handler
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|//*****************************************************************************
end_comment

begin_comment
comment|//* REMOTE NODE CONTEXT PRIVATE METHODS
end_comment

begin_comment
comment|//*****************************************************************************
end_comment

begin_comment
comment|/** * This method just calls the user callback function and then resets the * callback. * * @param[in out] rnc */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_notify_user
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_CALLBACK
name|local_user_callback
init|=
name|rnc
operator|->
name|user_callback
decl_stmt|;
name|void
modifier|*
name|local_user_cookie
init|=
name|rnc
operator|->
name|user_cookie
decl_stmt|;
comment|//we need to set the user_callback to NULL before it is called, because
comment|//the user callback's stack may eventually also set up a new set of
comment|//user callback. If we nullify the user_callback after it is called,
comment|//we are in the risk to lose the freshly set user callback.
name|rnc
operator|->
name|user_callback
operator|=
name|NULL
expr_stmt|;
name|rnc
operator|->
name|user_cookie
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|local_user_callback
operator|!=
name|NULL
condition|)
block|{
call|(
modifier|*
name|local_user_callback
call|)
argument_list|(
name|local_user_cookie
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** * This method will continue the remote node context state machine by * requesting to resume the remote node context state machine from its current * state. * * @param[in] rnc */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_continue_state_transitions
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
parameter_list|)
block|{
if|if
condition|(
name|rnc
operator|->
name|destination_state
operator|==
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_READY
condition|)
block|{
name|rnc
operator|->
name|state_handlers
operator|->
name|resume_handler
argument_list|(
name|rnc
argument_list|,
name|rnc
operator|->
name|user_callback
argument_list|,
name|rnc
operator|->
name|user_cookie
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** * This method will mark the rnc buffer as being valid and post the request to * the hardware. * * @param[in] this_rnc The remote node context object that is to be *            validated. * * @return none */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_validate_context_buffer
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|SCU_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc_buffer
decl_stmt|;
name|rnc_buffer
operator|=
name|scic_sds_controller_get_remote_node_context_buffer
argument_list|(
name|scic_sds_remote_device_get_controller
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
argument_list|,
name|this_rnc
operator|->
name|remote_node_index
argument_list|)
expr_stmt|;
name|rnc_buffer
operator|->
name|ssp
operator|.
name|is_valid
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|!
name|this_rnc
operator|->
name|device
operator|->
name|is_direct_attached
operator|&&
name|this_rnc
operator|->
name|device
operator|->
name|target_protocols
operator|.
name|u
operator|.
name|bits
operator|.
name|attached_stp_target
condition|)
block|{
name|scic_sds_remote_device_post_request
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|,
name|SCU_CONTEXT_COMMAND_POST_RNC_96
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|scic_sds_remote_device_post_request
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|,
name|SCU_CONTEXT_COMMAND_POST_RNC_32
argument_list|)
expr_stmt|;
if|if
condition|(
name|this_rnc
operator|->
name|device
operator|->
name|is_direct_attached
condition|)
block|{
name|scic_sds_port_setup_transports
argument_list|(
name|this_rnc
operator|->
name|device
operator|->
name|owning_port
argument_list|,
name|this_rnc
operator|->
name|remote_node_index
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/** * This method will update the RNC buffer and post the invalidate request. * * @param[in] this_rnc The remote node context object that is to be *       invalidated. * * @return none */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_invalidate_context_buffer
parameter_list|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
parameter_list|)
block|{
name|SCU_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc_buffer
decl_stmt|;
name|rnc_buffer
operator|=
name|scic_sds_controller_get_remote_node_context_buffer
argument_list|(
name|scic_sds_remote_device_get_controller
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|)
argument_list|,
name|this_rnc
operator|->
name|remote_node_index
argument_list|)
expr_stmt|;
name|rnc_buffer
operator|->
name|ssp
operator|.
name|is_valid
operator|=
name|FALSE
expr_stmt|;
name|scic_sds_remote_device_post_request
argument_list|(
name|this_rnc
operator|->
name|device
argument_list|,
name|SCU_CONTEXT_COMMAND_POST_RNC_INVALIDATE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|//*****************************************************************************
end_comment

begin_comment
comment|//* REMOTE NODE CONTEXT STATE ENTER AND EXIT METHODS
end_comment

begin_comment
comment|//*****************************************************************************
end_comment

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_initial_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INITIAL_STATE
argument_list|)
expr_stmt|;
comment|// Check to see if we have gotten back to the initial state because someone
comment|// requested to destroy the remote node context object.
if|if
condition|(
name|rnc
operator|->
name|state_machine
operator|.
name|previous_state_id
operator|==
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
condition|)
block|{
name|rnc
operator|->
name|destination_state
operator|=
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_UNSPECIFIED
expr_stmt|;
name|scic_sds_remote_node_context_notify_user
argument_list|(
name|rnc
argument_list|)
expr_stmt|;
comment|// Since we are destroying the remote node context deinitialize the state logging
comment|// should we resume the remote node context the state logging will be reinitialized
comment|// on the resume handler.
name|scic_sds_remote_node_context_deinitialize_state_logging
argument_list|(
name|rnc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_posting_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|this_rnc
decl_stmt|;
name|this_rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|this_rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_POSTING_STATE
argument_list|)
expr_stmt|;
name|scic_sds_remote_node_context_validate_context_buffer
argument_list|(
name|this_rnc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_invalidating_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
argument_list|)
expr_stmt|;
name|scic_sds_remote_node_context_invalidate_context_buffer
argument_list|(
name|rnc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_resuming_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|SMP_DISCOVER_RESPONSE_PROTOCOLS_T
name|protocols
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_RESUMING_STATE
argument_list|)
expr_stmt|;
comment|// For direct attached SATA devices we need to clear the TLCR
comment|// NCQ to TCi tag mapping on the phy and in cases where we
comment|// resume because of a target reset we also need to update
comment|// the STPTLDARNI register with the RNi of the device
name|scic_remote_device_get_protocols
argument_list|(
name|rnc
operator|->
name|device
argument_list|,
operator|&
name|protocols
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|protocols
operator|.
name|u
operator|.
name|bits
operator|.
name|attached_stp_target
operator|==
literal|1
operator|)
operator|&&
operator|(
name|rnc
operator|->
name|device
operator|->
name|is_direct_attached
operator|)
condition|)
block|{
name|scic_sds_port_setup_transports
argument_list|(
name|rnc
operator|->
name|device
operator|->
name|owning_port
argument_list|,
name|rnc
operator|->
name|remote_node_index
argument_list|)
expr_stmt|;
block|}
name|scic_sds_remote_device_post_request
argument_list|(
name|rnc
operator|->
name|device
argument_list|,
name|SCU_CONTEXT_COMMAND_POST_RNC_RESUME
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_ready_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_READY_STATE
argument_list|)
expr_stmt|;
name|rnc
operator|->
name|destination_state
operator|=
name|SCIC_SDS_REMOTE_NODE_DESTINATION_STATE_UNSPECIFIED
expr_stmt|;
if|if
condition|(
name|rnc
operator|->
name|user_callback
operator|!=
name|NULL
condition|)
block|{
name|scic_sds_remote_node_context_notify_user
argument_list|(
name|rnc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_tx_suspended_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_SUSPENDED_STATE
argument_list|)
expr_stmt|;
name|scic_sds_remote_node_context_continue_state_transitions
argument_list|(
name|rnc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_tx_rx_suspended_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_RX_SUSPENDED_STATE
argument_list|)
expr_stmt|;
name|scic_sds_remote_node_context_continue_state_transitions
argument_list|(
name|rnc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** * * * @param[in] object */
end_comment

begin_function
specifier|static
name|void
name|scic_sds_remote_node_context_await_suspension_state_enter
parameter_list|(
name|SCI_BASE_OBJECT_T
modifier|*
name|object
parameter_list|)
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
modifier|*
name|rnc
decl_stmt|;
name|rnc
operator|=
operator|(
name|SCIC_SDS_REMOTE_NODE_CONTEXT_T
operator|*
operator|)
name|object
expr_stmt|;
name|SET_STATE_HANDLER
argument_list|(
name|rnc
argument_list|,
name|scic_sds_remote_node_context_state_handler_table
argument_list|,
name|SCIC_SDS_REMOTE_NODE_CONTEXT_AWAIT_SUSPENSION_STATE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|// ---------------------------------------------------------------------------
end_comment

begin_decl_stmt
name|SCI_BASE_STATE_T
name|scic_sds_remote_node_context_state_table
index|[
name|SCIC_SDS_REMOTE_NODE_CONTEXT_MAX_STATES
index|]
init|=
block|{
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INITIAL_STATE
block|,
name|scic_sds_remote_node_context_initial_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_POSTING_STATE
block|,
name|scic_sds_remote_node_context_posting_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_INVALIDATING_STATE
block|,
name|scic_sds_remote_node_context_invalidating_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_RESUMING_STATE
block|,
name|scic_sds_remote_node_context_resuming_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_READY_STATE
block|,
name|scic_sds_remote_node_context_ready_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_SUSPENDED_STATE
block|,
name|scic_sds_remote_node_context_tx_suspended_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_TX_RX_SUSPENDED_STATE
block|,
name|scic_sds_remote_node_context_tx_rx_suspended_state_enter
block|,
name|NULL
block|}
block|,
block|{
name|SCIC_SDS_REMOTE_NODE_CONTEXT_AWAIT_SUSPENSION_STATE
block|,
name|scic_sds_remote_node_context_await_suspension_state_enter
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

