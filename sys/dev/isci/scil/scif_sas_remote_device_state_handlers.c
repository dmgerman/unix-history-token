begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * This file is provided under a dual BSD/GPLv2 license.  When using or  * redistributing this file, you may do so under either license.  *  * GPL LICENSE SUMMARY  *  * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of version 2 of the GNU General Public License as  * published by the Free Software Foundation.  *  * This program is distributed in the hope that it will be useful, but  * WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.  * The full GNU General Public License is included in this distribution  * in the file called LICENSE.GPL.  *  * BSD LICENSE  *  * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  *   * Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  *   * Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in  *     the documentation and/or other materials provided with the  *     distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/**  * @file  *  * @brief This file contains all of the method implementations pertaining  *        to the framework remote device state handler methods.  */
end_comment

begin_include
include|#
directive|include
file|<dev/isci/scil/scic_remote_device.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_logger.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_remote_device.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_domain.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_task_request.h>
end_include

begin_include
include|#
directive|include
file|<dev/isci/scil/scif_sas_internal_io_request.h>
end_include

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* S T O P P E D   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides STOPPED state specific handling for  *        when the framework attempts to start the remote device.  This  *        method attempts to transition the state machine into the  *        STARTING state.  If this is unsuccessful, then there is a direct  *        transition into the FAILED state.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object for which the framework is attempting to start.  *  * @return This method returns an indication as to whether the start  *         operating began successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_stopped_start_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_STARTING
argument_list|)
expr_stmt|;
comment|// Check to see if the state transition occurred without issue.
if|if
condition|(
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|==
name|SCI_BASE_REMOTE_DEVICE_STATE_FAILED
condition|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_DOMAIN_DISCOVERY
operator|,
literal|"Domain:0x%x Device:0x%x Status:0x%x failed to start\n"
operator|,
name|fw_device
operator|->
name|domain
operator|,
name|fw_device
operator|,
name|fw_device
operator|->
name|operation_status
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|fw_device
operator|->
name|operation_status
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides STOPPED state specific handling for  *        when the user attempts to destruct the remote device.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object for which the framework is attempting to start.  *  * @return This method returns an indication as to whether the destruct  *         operation completed successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_stopped_destruct_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCI_STATUS
name|status
decl_stmt|;
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SMP_DISCOVER_RESPONSE_PROTOCOLS_T
name|dev_protocols
decl_stmt|;
name|scic_remote_device_get_protocols
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|,
operator|&
name|dev_protocols
argument_list|)
expr_stmt|;
comment|//For smp device, need to clear its smp phy list first.
if|if
condition|(
name|dev_protocols
operator|.
name|u
operator|.
name|bits
operator|.
name|attached_smp_target
condition|)
name|scif_sas_smp_remote_device_removed
argument_list|(
name|fw_device
argument_list|)
expr_stmt|;
name|status
operator|=
name|scic_remote_device_destruct
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|SCI_SUCCESS
condition|)
block|{
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_FINAL
argument_list|)
expr_stmt|;
name|scif_sas_remote_device_deinitialize_state_logging
argument_list|(
name|fw_device
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SCIF_LOG_ERROR
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_REMOTE_DEVICE_CONFIG
operator|,
literal|"Device:0x%x Status:0x%x failed to destruct core device\n"
operator|,
name|fw_device
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* S T O P P I N G   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides STOPPING state specific handling for  *        when the core remote device object issues a stop completion  *        notification.  *  * @note There is no need to ensure all IO/Task requests are complete  *       before transitioning to the STOPPED state.  The SCI Core will  *       ensure this is accomplished.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object for which the completion occurred.  * @param[in]  completion_status This parameter specifies the status  *             of the completion operation.  *  * @return none.  */
end_comment

begin_function
specifier|static
name|void
name|scif_sas_remote_device_stopping_stop_complete_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|,
name|SCI_STATUS
name|completion_status
parameter_list|)
block|{
comment|// Transition directly to the STOPPED state since the core ensures
comment|// all IO/Tasks are complete.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_STOPPED
argument_list|)
expr_stmt|;
if|if
condition|(
name|completion_status
operator|!=
name|SCI_SUCCESS
condition|)
block|{
name|SCIF_LOG_ERROR
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_REMOTE_DEVICE_CONFIG
operator|,
literal|"Device:0x%x Status:0x%x failed to stop core device\n"
operator|,
name|fw_device
operator|,
name|completion_status
operator|)
argument_list|)
expr_stmt|;
comment|// Something is seriously wrong.  Stopping the core remote device
comment|// shouldn't fail in anyway.
name|scif_cb_controller_error
argument_list|(
name|fw_device
operator|->
name|domain
operator|->
name|controller
argument_list|,
name|SCI_CONTROLLER_REMOTE_DEVICE_ERROR
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * @brief This method provides STOPPING state handling for high priority  *        IO requests, when the framework attempts to complete a high  *        priority request.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object for which to complete the high priority IO.  * @param[in]  io_request This parameter specifies the IO request to be  *             completed.  * @param[in]  response_data This parameter is ignored, since the device  *             is in the stopping state.  *  * @return This method always returns success.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_stopping_complete_high_priority_io_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|,
name|void
modifier|*
name|response_data
parameter_list|,
name|SCI_IO_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_SAS_REQUEST_T
modifier|*
name|fw_request
init|=
operator|(
name|SCIF_SAS_REQUEST_T
operator|*
operator|)
name|io_request
decl_stmt|;
name|SCIF_LOG_TRACE
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_IO_REQUEST
operator|,
literal|"scif_sas_remote_device_stopping_complete_high_priority_io_handler(0x%x,0x%x,0x%x) enter\n"
operator|,
name|remote_device
operator|,
name|io_request
operator|,
name|response_data
operator|)
argument_list|)
expr_stmt|;
name|fw_device
operator|->
name|request_count
operator|--
expr_stmt|;
if|if
condition|(
name|fw_request
operator|->
name|is_internal
operator|==
name|TRUE
condition|)
block|{
name|scif_sas_internal_io_request_complete
argument_list|(
name|fw_device
operator|->
name|domain
operator|->
name|controller
argument_list|,
operator|(
name|SCIF_SAS_INTERNAL_IO_REQUEST_T
operator|*
operator|)
name|io_request
argument_list|,
name|SCI_SUCCESS
argument_list|)
expr_stmt|;
block|}
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* F A I L E D   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides FAILED state specific handling for  *        when the remote device is being stopped by the framework.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object for which the stop operation is being requested.  *  * @return This method returns an indication as to whether the failure  *         operation completed successfully.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_failed_stop_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x stopping failed device\n"
operator|,
name|fw_device
operator|)
argument_list|)
expr_stmt|;
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_STOPPING
argument_list|)
expr_stmt|;
comment|/// @todo Fix the return code handling.
return|return
name|SCI_FAILURE
return|;
block|}
end_function

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|//* D E F A U L T   H A N D L E R S
end_comment

begin_comment
comment|//******************************************************************************
end_comment

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to start a remote device and a start operation  *        is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             on which the user is attempting to perform a start operation.  *  * @return This method returns an indication that start operations are not  *         allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_start_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_REMOTE_DEVICE_CONFIG
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to start\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to stop a remote device and a stop operation  *        is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             on which the user is attempting to perform a stop operation.  *  * @return This method returns an indication that stop operations are not  *         allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_stop_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to stop\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when there is an attempt to fail a remote device from an invalid  *        state.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which there is an attempt to fail the device.  *  * @return This method returns an indication that the fail transition is not  *         allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_default_fail_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to fail device\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when there is an attempt to destruct a remote device from an  *        invalid state.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which there is an attempt to fail the device.  *  * @return This method returns an indication that the fail transition is not  *         allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_destruct_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to destruct.\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when there is an attempt to reset a remote device from an invalid  *        state.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which there is an attempt to fail the device.  *  * @return This method returns an indication that the fail transition is not  *         allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_reset_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to reset.\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when there is an attempt to complete a reset to the remote device  *        from an invalid state.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which there is an attempt to fail the device.  *  * @return This method returns an indication that the fail transition is not  *         allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_reset_complete_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to complete reset.\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to start an IO on a remote device and a start  *        IO operation is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the IO request to be  *             started.  *  * @return This method returns an indication that start IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_start_io_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to start IO.\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to complete an IO on a remote device and a  *        complete IO operation is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a complete  *             IO operation.  * @param[in]  io_request This parameter specifies the IO request to be  *             completed.  *  * @return This method returns an indication that complete IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_complete_io_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to complete IO\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to complete an IO on a remote device and a  *        complete IO operation is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the IO request to be  *             started.  *  * @return This method returns an indication that complete IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_complete_high_priority_io_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|,
name|void
modifier|*
name|response_data
parameter_list|,
name|SCI_IO_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to complete high priority IO\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to continue an IO on a remote device and a  *        continue IO operation is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start IO  *             operation.  * @param[in]  io_request This parameter specifies the IO request to be  *             started.  *  * @return This method returns an indication that continue IO operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_continue_io_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to continue IO\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to start a task on a remote device and a  *        start task operation is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device  *             object on which the user is attempting to perform a start  *             task operation.  * @param[in]  task_request This parameter specifies the task management  *             request to be started.  *  * @return This method returns an indication that start task operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_start_task_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_TASK_MANAGEMENT
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to start task\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        when a user attempts to complete a task on a remote device and a  *        complete task operation is not allowed.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             on which the user is attempting to perform a complete task  *             operation.  * @param[in]  task_request This parameter specifies the task management  *             request to be completed.  *  * @return This method returns an indication that complete task operations  *         are not allowed.  * @retval SCI_FAILURE_INVALID_STATE This value is always returned.  */
end_comment

begin_function
name|SCI_STATUS
name|scif_sas_remote_device_default_complete_task_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|task_request
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator||
name|SCIF_LOG_OBJECT_TASK_MANAGEMENT
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to complete task\n"
operator|,
name|remote_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
operator|(
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
operator|)
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|SCI_FAILURE_INVALID_STATE
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        for when the core issues a start completion notification and  *        such a notification isn't supported.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             for which the completion notification has occured.  * @param[in]  completion_status This parameter specifies the status  *             of the completion operation.  *  * @return none.  */
end_comment

begin_function
name|void
name|scif_sas_remote_device_default_start_complete_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|,
name|SCI_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to start complete\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        for when the core issues a stop completion notification and  *        such a notification isn't supported.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             for which the completion notification has occured.  * @param[in]  completion_status This parameter specifies the status  *             of the completion operation.  *  * @return none.  */
end_comment

begin_function
name|void
name|scif_sas_remote_device_default_stop_complete_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|,
name|SCI_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to stop complete\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        for when the core issues a ready notification and such a  *        notification isn't supported.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             for which the notification has occured.  *  * @return none.  */
end_comment

begin_function
name|void
name|scif_sas_remote_device_default_ready_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to handle ready\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides default handling (i.e. returns an error);  *        for when the core issues a not ready notification and such a  *        notification isn't supported.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             for which the notification has occured.  *  * @return none.  */
end_comment

begin_function
name|void
name|scif_sas_remote_device_default_not_ready_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|,
name|U32
name|reason_code
parameter_list|)
block|{
name|SCIF_LOG_WARNING
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x State:0x%x invalid state to handle not ready\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|DISABLE_WIDE_PORTED_TARGETS
argument_list|)
end_if

begin_comment
comment|/**  * @brief This method provides handling of device start complete duing  *        UPDATING_PORT_WIDTH state.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             which is start complete.  *  * @return none.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_updating_port_width_state_complete_io_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|,
name|SCI_BASE_REQUEST_T
modifier|*
name|io_request
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|fw_device
operator|->
name|request_count
operator|--
expr_stmt|;
comment|//If the request count is zero, go ahead to update the RNC.
if|if
condition|(
name|fw_device
operator|->
name|request_count
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|fw_device
operator|->
name|destination_state
operator|==
name|SCIF_SAS_REMOTE_DEVICE_DESTINATION_STATE_STOPPING
condition|)
block|{
comment|//if the destination state of this device change to STOPPING, no matter
comment|//whether we need to update the port width, just make the device
comment|//go to the STOPPING state, the device will be removed anyway.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_STOPPING
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|//stop the device, upon the stop complete callback, start the device again
comment|//with the updated port width.
name|scic_remote_device_stop
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|,
name|SCIF_SAS_REMOTE_DEVICE_CORE_OP_TIMEOUT
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * @brief This method provides handling of device start complete duing  *        UPDATING_PORT_WIDTH state.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             which is start complete.  *  * @return none.  */
end_comment

begin_function
specifier|static
name|void
name|scif_sas_remote_device_updating_port_width_state_start_complete_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|,
name|SCI_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_LOG_INFO
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x updating port width state start complete handler\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw_device
operator|->
name|destination_state
operator|==
name|SCIF_SAS_REMOTE_DEVICE_DESTINATION_STATE_STOPPING
condition|)
block|{
comment|//if the destination state of this device change to STOPPING, no matter
comment|//whether we need to update the port width again, just make the device
comment|//go to the STOPPING state.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_STOPPING
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|scic_remote_device_get_port_width
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|)
operator|!=
name|fw_device
operator|->
name|device_port_width
operator|&&
name|fw_device
operator|->
name|device_port_width
operator|!=
literal|0
condition|)
block|{
name|scic_remote_device_stop
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|,
name|SCIF_SAS_REMOTE_DEVICE_CORE_OP_TIMEOUT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|//Port width updating succeeds. Transfer to destination state.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_READY
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * @brief This method provides handling of device stop complete duing  *        UPDATING_PORT_WIDTH state.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             which is stop complete.  *  * @return none.  */
end_comment

begin_function
specifier|static
name|void
name|scif_sas_remote_device_updating_port_width_state_stop_complete_handler
parameter_list|(
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
parameter_list|,
name|SCI_STATUS
name|completion_status
parameter_list|)
block|{
name|SCIF_LOG_INFO
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x updating port width state stop complete handler\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw_device
operator|->
name|destination_state
operator|==
name|SCIF_SAS_REMOTE_DEVICE_DESTINATION_STATE_STOPPING
condition|)
block|{
comment|//Device directly transits to STOPPED STATE from UPDATING_PORT_WIDTH state,
name|fw_device
operator|->
name|domain
operator|->
name|device_start_count
operator|--
expr_stmt|;
comment|//if the destination state of this device change to STOPPING, no matter
comment|//whether we need to update the port width again, just make the device
comment|//go to the STOPPED state.
name|sci_base_state_machine_change_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|,
name|SCI_BASE_REMOTE_DEVICE_STATE_STOPPED
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|scic_remote_device_set_port_width
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|,
name|fw_device
operator|->
name|device_port_width
argument_list|)
expr_stmt|;
comment|//Device stop complete, means the RNC has been destructed. Now we need to
comment|//start core device so the RNC with updated port width will be posted.
name|scic_remote_device_start
argument_list|(
name|fw_device
operator|->
name|core_object
argument_list|,
name|SCIF_SAS_REMOTE_DEVICE_CORE_OP_TIMEOUT
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * @brief This method provides handling (i.e. returns an error);  *        when a user attempts to stop a remote device during the updating  *        port width state, it will record the destination state for this  *        device to be STOPPING, instead of usually READY state.  *  * @param[in]  remote_device This parameter specifies the remote device object  *             on which the user is attempting to perform a stop operation.  *  * @return This method always return SCI_SUCCESS.  */
end_comment

begin_function
specifier|static
name|SCI_STATUS
name|scif_sas_remote_device_updating_port_width_state_stop_handler
parameter_list|(
name|SCI_BASE_REMOTE_DEVICE_T
modifier|*
name|remote_device
parameter_list|)
block|{
name|SCIF_SAS_REMOTE_DEVICE_T
modifier|*
name|fw_device
init|=
operator|(
name|SCIF_SAS_REMOTE_DEVICE_T
operator|*
operator|)
name|remote_device
decl_stmt|;
name|SCIF_LOG_INFO
argument_list|(
operator|(
name|sci_base_object_get_logger
argument_list|(
name|fw_device
argument_list|)
operator|,
name|SCIF_LOG_OBJECT_REMOTE_DEVICE
operator|,
literal|"RemoteDevice:0x%x updating port width state stop handler\n"
operator|,
name|fw_device
operator|,
name|sci_base_state_machine_get_state
argument_list|(
operator|&
name|fw_device
operator|->
name|parent
operator|.
name|state_machine
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|//Can't stop the device right now. Remember the pending stopping request.
comment|//When exit the UPDATING_PORT_WIDTH state, we will check this variable
comment|//to decide which state to go.
name|fw_device
operator|->
name|destination_state
operator|=
name|SCIF_SAS_REMOTE_DEVICE_DESTINATION_STATE_STOPPING
expr_stmt|;
return|return
name|SCI_SUCCESS
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|//#if !defined(DISABLE_WIDE_PORTED_TARGETS)
end_comment

begin_define
define|#
directive|define
name|scif_sas_remote_device_stopping_complete_io_handler
define|\
value|scif_sas_remote_device_ready_operational_complete_io_handler
end_define

begin_define
define|#
directive|define
name|scif_sas_remote_device_stopping_complete_task_handler
define|\
value|scif_sas_remote_device_ready_operational_complete_task_handler
end_define

begin_decl_stmt
name|SCIF_SAS_REMOTE_DEVICE_STATE_HANDLER_T
name|scif_sas_remote_device_state_handler_table
index|[
name|SCI_BASE_REMOTE_DEVICE_MAX_STATES
index|]
init|=
block|{
comment|// SCI_BASE_REMOTE_DEVICE_STATE_INITIAL
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
comment|// SCI_BASE_REMOTE_DEVICE_STATE_STOPPED
block|{
block|{
name|scif_sas_remote_device_stopped_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_stopped_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
comment|// SCI_BASE_REMOTE_DEVICE_STATE_STARTING
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
comment|// SCI_BASE_REMOTE_DEVICE_STATE_READY - see substate handlers
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
comment|// SCI_BASE_REMOTE_DEVICE_STATE_STOPPING
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_stopping_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_stopping_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_stopping_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_stopping_complete_high_priority_io_handler
block|}
block|,
comment|// SCI_BASE_REMOTE_DEVICE_STATE_FAILED
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_failed_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
comment|// SCI_BASE_REMOTE_DEVICE_STATE_RESETTING - is unused by framework
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
if|#
directive|if
operator|!
name|defined
argument_list|(
name|DISABLE_WIDE_PORTED_TARGETS
argument_list|)
comment|// SCI_BASE_REMOTE_DEVICE_STATE_UPDATING_PORT_WIDTH
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_updating_port_width_state_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_updating_port_width_state_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_updating_port_width_state_start_complete_handler
block|,
name|scif_sas_remote_device_updating_port_width_state_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|,
endif|#
directive|endif
comment|// SCI_BASE_REMOTE_DEVICE_STATE_FINAL
block|{
block|{
name|scif_sas_remote_device_default_start_handler
block|,
name|scif_sas_remote_device_default_stop_handler
block|,
name|scif_sas_remote_device_default_fail_handler
block|,
name|scif_sas_remote_device_default_destruct_handler
block|,
name|scif_sas_remote_device_default_reset_handler
block|,
name|scif_sas_remote_device_default_reset_complete_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_io_handler
block|,
name|scif_sas_remote_device_default_continue_io_handler
block|,
name|scif_sas_remote_device_default_start_task_handler
block|,
name|scif_sas_remote_device_default_complete_task_handler
block|}
block|,
name|scif_sas_remote_device_default_start_complete_handler
block|,
name|scif_sas_remote_device_default_stop_complete_handler
block|,
name|scif_sas_remote_device_default_ready_handler
block|,
name|scif_sas_remote_device_default_not_ready_handler
block|,
name|scif_sas_remote_device_default_start_io_handler
block|,
name|scif_sas_remote_device_default_complete_high_priority_io_handler
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

