begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2012 Semihalf.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/module.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<sys/rman.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/sockio.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_include
include|#
directive|include
file|<net/if_arp.h>
end_include

begin_include
include|#
directive|include
file|<dev/mii/mii.h>
end_include

begin_include
include|#
directive|include
file|<dev/mii/miivar.h>
end_include

begin_include
include|#
directive|include
file|"miibus_if.h"
end_include

begin_include
include|#
directive|include
file|<contrib/ncsw/inc/Peripherals/fm_mac_ext.h>
end_include

begin_include
include|#
directive|include
file|<contrib/ncsw/inc/Peripherals/fm_port_ext.h>
end_include

begin_include
include|#
directive|include
file|<contrib/ncsw/inc/xx_ext.h>
end_include

begin_include
include|#
directive|include
file|"fman.h"
end_include

begin_include
include|#
directive|include
file|"bman.h"
end_include

begin_include
include|#
directive|include
file|"qman.h"
end_include

begin_include
include|#
directive|include
file|"if_dtsec.h"
end_include

begin_include
include|#
directive|include
file|"if_dtsec_rm.h"
end_include

begin_comment
comment|/**  * @group dTSEC RM private defines.  * @{  */
end_comment

begin_define
define|#
directive|define
name|DTSEC_BPOOLS_USED
value|(1)
end_define

begin_define
define|#
directive|define
name|DTSEC_MAX_TX_QUEUE_LEN
value|256
end_define

begin_struct
struct|struct
name|dtsec_rm_frame_info
block|{
name|struct
name|mbuf
modifier|*
name|fi_mbuf
decl_stmt|;
name|t_DpaaSGTE
name|fi_sgt
index|[
name|DPAA_NUM_OF_SG_TABLE_ENTRY
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
name|dtsec_rm_pool_params
block|{
name|DTSEC_RM_POOL_RX_LOW_MARK
init|=
literal|16
block|,
name|DTSEC_RM_POOL_RX_HIGH_MARK
init|=
literal|64
block|,
name|DTSEC_RM_POOL_RX_MAX_SIZE
init|=
literal|256
block|,
name|DTSEC_RM_POOL_FI_LOW_MARK
init|=
literal|16
block|,
name|DTSEC_RM_POOL_FI_HIGH_MARK
init|=
literal|64
block|,
name|DTSEC_RM_POOL_FI_MAX_SIZE
init|=
literal|256
block|, }
enum|;
end_enum

begin_enum
enum|enum
name|dtsec_rm_fqr_params
block|{
name|DTSEC_RM_FQR_RX_CHANNEL
init|=
name|e_QM_FQ_CHANNEL_POOL1
block|,
name|DTSEC_RM_FQR_RX_WQ
init|=
literal|1
block|,
name|DTSEC_RM_FQR_TX_CONF_CHANNEL
init|=
name|e_QM_FQ_CHANNEL_SWPORTAL0
block|,
name|DTSEC_RM_FQR_TX_WQ
init|=
literal|1
block|,
name|DTSEC_RM_FQR_TX_CONF_WQ
init|=
literal|1
block|}
enum|;
end_enum

begin_comment
comment|/** @} */
end_comment

begin_comment
comment|/**  * @group dTSEC Frame Info routines.  * @{  */
end_comment

begin_function
name|void
name|dtsec_rm_fi_pool_free
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
if|if
condition|(
name|sc
operator|->
name|sc_fi_zone
operator|!=
name|NULL
condition|)
name|uma_zdestroy
argument_list|(
name|sc
operator|->
name|sc_fi_zone
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|dtsec_rm_fi_pool_init
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
name|snprintf
argument_list|(
name|sc
operator|->
name|sc_fi_zname
argument_list|,
sizeof|sizeof
argument_list|(
name|sc
operator|->
name|sc_fi_zname
argument_list|)
argument_list|,
literal|"%s: Frame Info"
argument_list|,
name|device_get_nameunit
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_fi_zone
operator|=
name|uma_zcreate
argument_list|(
name|sc
operator|->
name|sc_fi_zname
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|dtsec_rm_frame_info
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
sizeof|sizeof
argument_list|(
name|void
operator|*
argument_list|)
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_fi_zone
operator|==
name|NULL
condition|)
return|return
operator|(
name|EIO
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|dtsec_rm_frame_info
modifier|*
name|dtsec_rm_fi_alloc
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
name|struct
name|dtsec_rm_frame_info
modifier|*
name|fi
decl_stmt|;
name|fi
operator|=
name|uma_zalloc
argument_list|(
name|sc
operator|->
name|sc_fi_zone
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
return|return
operator|(
name|fi
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|dtsec_rm_fi_free
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|dtsec_rm_frame_info
modifier|*
name|fi
parameter_list|)
block|{
name|uma_zfree
argument_list|(
name|sc
operator|->
name|sc_fi_zone
argument_list|,
name|fi
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** @} */
end_comment

begin_comment
comment|/**  * @group dTSEC FMan PORT routines.  * @{  */
end_comment

begin_function
name|int
name|dtsec_rm_fm_port_rx_init
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|,
name|int
name|unit
parameter_list|)
block|{
name|t_FmPortParams
name|params
decl_stmt|;
name|t_FmPortRxParams
modifier|*
name|rx_params
decl_stmt|;
name|t_FmPortExtPools
modifier|*
name|pool_params
decl_stmt|;
name|t_Error
name|error
decl_stmt|;
name|memset
argument_list|(
operator|&
name|params
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|params
argument_list|)
argument_list|)
expr_stmt|;
name|params
operator|.
name|baseAddr
operator|=
name|sc
operator|->
name|sc_fm_base
operator|+
name|sc
operator|->
name|sc_port_rx_hw_id
expr_stmt|;
name|params
operator|.
name|h_Fm
operator|=
name|sc
operator|->
name|sc_fmh
expr_stmt|;
name|params
operator|.
name|portType
operator|=
name|dtsec_fm_port_rx_type
argument_list|(
name|sc
operator|->
name|sc_eth_dev_type
argument_list|)
expr_stmt|;
name|params
operator|.
name|portId
operator|=
name|sc
operator|->
name|sc_eth_id
expr_stmt|;
name|params
operator|.
name|independentModeEnable
operator|=
name|FALSE
expr_stmt|;
name|params
operator|.
name|liodnBase
operator|=
name|FM_PORT_LIODN_BASE
expr_stmt|;
name|params
operator|.
name|f_Exception
operator|=
name|dtsec_fm_port_rx_exception_callback
expr_stmt|;
name|params
operator|.
name|h_App
operator|=
name|sc
expr_stmt|;
name|rx_params
operator|=
operator|&
name|params
operator|.
name|specificParams
operator|.
name|rxParams
expr_stmt|;
name|rx_params
operator|->
name|errFqid
operator|=
name|sc
operator|->
name|sc_rx_fqid
expr_stmt|;
name|rx_params
operator|->
name|dfltFqid
operator|=
name|sc
operator|->
name|sc_rx_fqid
expr_stmt|;
name|rx_params
operator|->
name|liodnOffset
operator|=
literal|0
expr_stmt|;
name|pool_params
operator|=
operator|&
name|rx_params
operator|->
name|extBufPools
expr_stmt|;
name|pool_params
operator|->
name|numOfPoolsUsed
operator|=
name|DTSEC_BPOOLS_USED
expr_stmt|;
name|pool_params
operator|->
name|extBufPool
operator|->
name|id
operator|=
name|sc
operator|->
name|sc_rx_bpid
expr_stmt|;
name|pool_params
operator|->
name|extBufPool
operator|->
name|size
operator|=
name|FM_PORT_BUFFER_SIZE
expr_stmt|;
name|sc
operator|->
name|sc_rxph
operator|=
name|FM_PORT_Config
argument_list|(
operator|&
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_rxph
operator|==
name|NULL
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"couldn't configure FM Port RX.\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENXIO
operator|)
return|;
block|}
name|error
operator|=
name|FM_PORT_Init
argument_list|(
name|sc
operator|->
name|sc_rxph
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|!=
name|E_OK
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"couldn't initialize FM Port RX.\n"
argument_list|)
expr_stmt|;
name|FM_PORT_Free
argument_list|(
name|sc
operator|->
name|sc_rxph
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENXIO
operator|)
return|;
block|}
if|if
condition|(
name|bootverbose
condition|)
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"RX hw port 0x%02x initialized.\n"
argument_list|,
name|sc
operator|->
name|sc_port_rx_hw_id
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|dtsec_rm_fm_port_tx_init
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|,
name|int
name|unit
parameter_list|)
block|{
name|t_FmPortParams
name|params
decl_stmt|;
name|t_FmPortNonRxParams
modifier|*
name|tx_params
decl_stmt|;
name|t_Error
name|error
decl_stmt|;
name|memset
argument_list|(
operator|&
name|params
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|params
argument_list|)
argument_list|)
expr_stmt|;
name|params
operator|.
name|baseAddr
operator|=
name|sc
operator|->
name|sc_fm_base
operator|+
name|sc
operator|->
name|sc_port_tx_hw_id
expr_stmt|;
name|params
operator|.
name|h_Fm
operator|=
name|sc
operator|->
name|sc_fmh
expr_stmt|;
name|params
operator|.
name|portType
operator|=
name|dtsec_fm_port_tx_type
argument_list|(
name|sc
operator|->
name|sc_eth_dev_type
argument_list|)
expr_stmt|;
name|params
operator|.
name|portId
operator|=
name|sc
operator|->
name|sc_eth_id
expr_stmt|;
name|params
operator|.
name|independentModeEnable
operator|=
name|FALSE
expr_stmt|;
name|params
operator|.
name|liodnBase
operator|=
name|FM_PORT_LIODN_BASE
expr_stmt|;
name|params
operator|.
name|f_Exception
operator|=
name|dtsec_fm_port_tx_exception_callback
expr_stmt|;
name|params
operator|.
name|h_App
operator|=
name|sc
expr_stmt|;
name|tx_params
operator|=
operator|&
name|params
operator|.
name|specificParams
operator|.
name|nonRxParams
expr_stmt|;
name|tx_params
operator|->
name|errFqid
operator|=
name|sc
operator|->
name|sc_tx_conf_fqid
expr_stmt|;
name|tx_params
operator|->
name|dfltFqid
operator|=
name|sc
operator|->
name|sc_tx_conf_fqid
expr_stmt|;
name|tx_params
operator|->
name|qmChannel
operator|=
name|sc
operator|->
name|sc_port_tx_qman_chan
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_OP_PARTITION_ERRATA_FMANx8
name|tx_params
operator|->
name|opLiodnOffset
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|sc
operator|->
name|sc_txph
operator|=
name|FM_PORT_Config
argument_list|(
operator|&
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_txph
operator|==
name|NULL
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"couldn't configure FM Port TX.\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENXIO
operator|)
return|;
block|}
name|error
operator|=
name|FM_PORT_Init
argument_list|(
name|sc
operator|->
name|sc_txph
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|!=
name|E_OK
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"couldn't initialize FM Port TX.\n"
argument_list|)
expr_stmt|;
name|FM_PORT_Free
argument_list|(
name|sc
operator|->
name|sc_txph
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENXIO
operator|)
return|;
block|}
if|if
condition|(
name|bootverbose
condition|)
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"TX hw port 0x%02x initialized.\n"
argument_list|,
name|sc
operator|->
name|sc_port_tx_hw_id
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/** @} */
end_comment

begin_comment
comment|/**  * @group dTSEC buffer pools routines.  * @{  */
end_comment

begin_function
specifier|static
name|t_Error
name|dtsec_rm_pool_rx_put_buffer
parameter_list|(
name|t_Handle
name|h_BufferPool
parameter_list|,
name|uint8_t
modifier|*
name|buffer
parameter_list|,
name|t_Handle
name|context
parameter_list|)
block|{
name|struct
name|dtsec_softc
modifier|*
name|sc
decl_stmt|;
name|sc
operator|=
name|h_BufferPool
expr_stmt|;
name|uma_zfree
argument_list|(
name|sc
operator|->
name|sc_rx_zone
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
return|return
operator|(
name|E_OK
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|uint8_t
modifier|*
name|dtsec_rm_pool_rx_get_buffer
parameter_list|(
name|t_Handle
name|h_BufferPool
parameter_list|,
name|t_Handle
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|dtsec_softc
modifier|*
name|sc
decl_stmt|;
name|uint8_t
modifier|*
name|buffer
decl_stmt|;
name|sc
operator|=
name|h_BufferPool
expr_stmt|;
name|buffer
operator|=
name|uma_zalloc
argument_list|(
name|sc
operator|->
name|sc_rx_zone
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
return|return
operator|(
name|buffer
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|dtsec_rm_pool_rx_depleted
parameter_list|(
name|t_Handle
name|h_App
parameter_list|,
name|bool
name|in
parameter_list|)
block|{
name|struct
name|dtsec_softc
modifier|*
name|sc
decl_stmt|;
name|unsigned
name|int
name|count
decl_stmt|;
name|sc
operator|=
name|h_App
expr_stmt|;
if|if
condition|(
operator|!
name|in
condition|)
return|return;
while|while
condition|(
literal|1
condition|)
block|{
name|count
operator|=
name|bman_count
argument_list|(
name|sc
operator|->
name|sc_rx_pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|>
name|DTSEC_RM_POOL_RX_HIGH_MARK
condition|)
return|return;
name|bman_pool_fill
argument_list|(
name|sc
operator|->
name|sc_rx_pool
argument_list|,
name|DTSEC_RM_POOL_RX_HIGH_MARK
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|dtsec_rm_pool_rx_free
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
if|if
condition|(
name|sc
operator|->
name|sc_rx_pool
operator|!=
name|NULL
condition|)
name|bman_pool_destroy
argument_list|(
name|sc
operator|->
name|sc_rx_pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_rx_zone
operator|!=
name|NULL
condition|)
name|uma_zdestroy
argument_list|(
name|sc
operator|->
name|sc_rx_zone
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|dtsec_rm_pool_rx_init
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
comment|/* FM_PORT_BUFFER_SIZE must be less than PAGE_SIZE */
name|CTASSERT
argument_list|(
name|FM_PORT_BUFFER_SIZE
operator|<
name|PAGE_SIZE
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|sc
operator|->
name|sc_rx_zname
argument_list|,
sizeof|sizeof
argument_list|(
name|sc
operator|->
name|sc_rx_zname
argument_list|)
argument_list|,
literal|"%s: RX Buffers"
argument_list|,
name|device_get_nameunit
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|)
argument_list|)
expr_stmt|;
name|sc
operator|->
name|sc_rx_zone
operator|=
name|uma_zcreate
argument_list|(
name|sc
operator|->
name|sc_rx_zname
argument_list|,
name|FM_PORT_BUFFER_SIZE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FM_PORT_BUFFER_SIZE
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_rx_zone
operator|==
name|NULL
condition|)
return|return
operator|(
name|EIO
operator|)
return|;
name|sc
operator|->
name|sc_rx_pool
operator|=
name|bman_pool_create
argument_list|(
operator|&
name|sc
operator|->
name|sc_rx_bpid
argument_list|,
name|FM_PORT_BUFFER_SIZE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|DTSEC_RM_POOL_RX_MAX_SIZE
argument_list|,
name|dtsec_rm_pool_rx_get_buffer
argument_list|,
name|dtsec_rm_pool_rx_put_buffer
argument_list|,
name|DTSEC_RM_POOL_RX_LOW_MARK
argument_list|,
name|DTSEC_RM_POOL_RX_HIGH_MARK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|dtsec_rm_pool_rx_depleted
argument_list|,
name|sc
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_rx_pool
operator|==
name|NULL
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"NULL rx pool  somehow\n"
argument_list|)
expr_stmt|;
name|dtsec_rm_pool_rx_free
argument_list|(
name|sc
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/** @} */
end_comment

begin_comment
comment|/**  * @group dTSEC Frame Queue Range routines.  * @{  */
end_comment

begin_function
specifier|static
name|void
name|dtsec_rm_fqr_mext_free
parameter_list|(
name|struct
name|mbuf
modifier|*
name|m
parameter_list|,
name|void
modifier|*
name|buffer
parameter_list|,
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|struct
name|dtsec_softc
modifier|*
name|sc
decl_stmt|;
name|sc
operator|=
name|arg
expr_stmt|;
if|if
condition|(
name|bman_count
argument_list|(
name|sc
operator|->
name|sc_rx_pool
argument_list|)
operator|<=
name|DTSEC_RM_POOL_RX_MAX_SIZE
condition|)
name|bman_put_buffer
argument_list|(
name|sc
operator|->
name|sc_rx_pool
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
else|else
name|dtsec_rm_pool_rx_put_buffer
argument_list|(
name|arg
argument_list|,
name|buffer
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|e_RxStoreResponse
name|dtsec_rm_fqr_rx_callback
parameter_list|(
name|t_Handle
name|app
parameter_list|,
name|t_Handle
name|fqr
parameter_list|,
name|t_Handle
name|portal
parameter_list|,
name|uint32_t
name|fqid_off
parameter_list|,
name|t_DpaaFD
modifier|*
name|frame
parameter_list|)
block|{
name|struct
name|dtsec_softc
modifier|*
name|sc
decl_stmt|;
name|struct
name|mbuf
modifier|*
name|m
decl_stmt|;
name|m
operator|=
name|NULL
expr_stmt|;
name|sc
operator|=
name|app
expr_stmt|;
name|KASSERT
argument_list|(
name|DPAA_FD_GET_FORMAT
argument_list|(
name|frame
argument_list|)
operator|==
name|e_DPAA_FD_FORMAT_TYPE_SHORT_SBSF
argument_list|,
operator|(
literal|"%s(): Got unsupported frame format 0x%02X!"
operator|,
name|__func__
operator|,
name|DPAA_FD_GET_FORMAT
argument_list|(
name|frame
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|KASSERT
argument_list|(
name|DPAA_FD_GET_OFFSET
argument_list|(
name|frame
argument_list|)
operator|==
literal|0
argument_list|,
operator|(
literal|"%s(): Only offset 0 is supported!"
operator|,
name|__func__
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|DPAA_FD_GET_STATUS
argument_list|(
name|frame
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"RX error: 0x%08X\n"
argument_list|,
name|DPAA_FD_GET_STATUS
argument_list|(
name|frame
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|err
goto|;
block|}
name|m
operator|=
name|m_gethdr
argument_list|(
name|M_NOWAIT
argument_list|,
name|MT_HEADER
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|==
name|NULL
condition|)
goto|goto
name|err
goto|;
name|m_extadd
argument_list|(
name|m
argument_list|,
name|DPAA_FD_GET_ADDR
argument_list|(
name|frame
argument_list|)
argument_list|,
name|FM_PORT_BUFFER_SIZE
argument_list|,
name|dtsec_rm_fqr_mext_free
argument_list|,
name|DPAA_FD_GET_ADDR
argument_list|(
name|frame
argument_list|)
argument_list|,
name|sc
argument_list|,
literal|0
argument_list|,
name|EXT_NET_DRV
argument_list|)
expr_stmt|;
name|m
operator|->
name|m_pkthdr
operator|.
name|rcvif
operator|=
name|sc
operator|->
name|sc_ifnet
expr_stmt|;
name|m
operator|->
name|m_len
operator|=
name|DPAA_FD_GET_LENGTH
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|m_fixhdr
argument_list|(
name|m
argument_list|)
expr_stmt|;
call|(
modifier|*
name|sc
operator|->
name|sc_ifnet
operator|->
name|if_input
call|)
argument_list|(
name|sc
operator|->
name|sc_ifnet
argument_list|,
name|m
argument_list|)
expr_stmt|;
return|return
operator|(
name|e_RX_STORE_RESPONSE_CONTINUE
operator|)
return|;
name|err
label|:
name|bman_put_buffer
argument_list|(
name|sc
operator|->
name|sc_rx_pool
argument_list|,
name|DPAA_FD_GET_ADDR
argument_list|(
name|frame
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|!=
name|NULL
condition|)
name|m_freem
argument_list|(
name|m
argument_list|)
expr_stmt|;
return|return
operator|(
name|e_RX_STORE_RESPONSE_CONTINUE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|e_RxStoreResponse
name|dtsec_rm_fqr_tx_confirm_callback
parameter_list|(
name|t_Handle
name|app
parameter_list|,
name|t_Handle
name|fqr
parameter_list|,
name|t_Handle
name|portal
parameter_list|,
name|uint32_t
name|fqid_off
parameter_list|,
name|t_DpaaFD
modifier|*
name|frame
parameter_list|)
block|{
name|struct
name|dtsec_rm_frame_info
modifier|*
name|fi
decl_stmt|;
name|struct
name|dtsec_softc
modifier|*
name|sc
decl_stmt|;
name|unsigned
name|int
name|qlen
decl_stmt|;
name|t_DpaaSGTE
modifier|*
name|sgt0
decl_stmt|;
name|sc
operator|=
name|app
expr_stmt|;
if|if
condition|(
name|DPAA_FD_GET_STATUS
argument_list|(
name|frame
argument_list|)
operator|!=
literal|0
condition|)
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"TX error: 0x%08X\n"
argument_list|,
name|DPAA_FD_GET_STATUS
argument_list|(
name|frame
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * We are storing struct dtsec_rm_frame_info in first entry 	 * of scatter-gather table. 	 */
name|sgt0
operator|=
name|DPAA_FD_GET_ADDR
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|fi
operator|=
name|DPAA_SGTE_GET_ADDR
argument_list|(
name|sgt0
argument_list|)
expr_stmt|;
comment|/* Free transmitted frame */
name|m_freem
argument_list|(
name|fi
operator|->
name|fi_mbuf
argument_list|)
expr_stmt|;
name|dtsec_rm_fi_free
argument_list|(
name|sc
argument_list|,
name|fi
argument_list|)
expr_stmt|;
name|qlen
operator|=
name|qman_fqr_get_counter
argument_list|(
name|sc
operator|->
name|sc_tx_conf_fqr
argument_list|,
literal|0
argument_list|,
name|e_QM_FQR_COUNTERS_FRAME
argument_list|)
expr_stmt|;
if|if
condition|(
name|qlen
operator|==
literal|0
condition|)
block|{
name|DTSEC_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_tx_fqr_full
condition|)
block|{
name|sc
operator|->
name|sc_tx_fqr_full
operator|=
literal|0
expr_stmt|;
name|dtsec_rm_if_start_locked
argument_list|(
name|sc
argument_list|)
expr_stmt|;
block|}
name|DTSEC_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|e_RX_STORE_RESPONSE_CONTINUE
operator|)
return|;
block|}
end_function

begin_function
name|void
name|dtsec_rm_fqr_rx_free
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
if|if
condition|(
name|sc
operator|->
name|sc_rx_fqr
condition|)
name|qman_fqr_free
argument_list|(
name|sc
operator|->
name|sc_rx_fqr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|dtsec_rm_fqr_rx_init
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
name|t_Error
name|error
decl_stmt|;
name|t_Handle
name|fqr
decl_stmt|;
comment|/* Default Frame Queue */
name|fqr
operator|=
name|qman_fqr_create
argument_list|(
literal|1
argument_list|,
name|DTSEC_RM_FQR_RX_CHANNEL
argument_list|,
name|DTSEC_RM_FQR_RX_WQ
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|fqr
operator|==
name|NULL
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"could not create default RX queue"
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|sc
operator|->
name|sc_rx_fqr
operator|=
name|fqr
expr_stmt|;
name|sc
operator|->
name|sc_rx_fqid
operator|=
name|qman_fqr_get_base_fqid
argument_list|(
name|fqr
argument_list|)
expr_stmt|;
name|error
operator|=
name|qman_fqr_register_cb
argument_list|(
name|fqr
argument_list|,
name|dtsec_rm_fqr_rx_callback
argument_list|,
name|sc
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|!=
name|E_OK
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"could not register RX callback\n"
argument_list|)
expr_stmt|;
name|dtsec_rm_fqr_rx_free
argument_list|(
name|sc
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|dtsec_rm_fqr_tx_free
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
if|if
condition|(
name|sc
operator|->
name|sc_tx_fqr
condition|)
name|qman_fqr_free
argument_list|(
name|sc
operator|->
name|sc_tx_fqr
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|->
name|sc_tx_conf_fqr
condition|)
name|qman_fqr_free
argument_list|(
name|sc
operator|->
name|sc_tx_conf_fqr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|dtsec_rm_fqr_tx_init
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
name|t_Error
name|error
decl_stmt|;
name|t_Handle
name|fqr
decl_stmt|;
comment|/* TX Frame Queue */
name|fqr
operator|=
name|qman_fqr_create
argument_list|(
literal|1
argument_list|,
name|sc
operator|->
name|sc_port_tx_qman_chan
argument_list|,
name|DTSEC_RM_FQR_TX_WQ
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|fqr
operator|==
name|NULL
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"could not create default TX queue"
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|sc
operator|->
name|sc_tx_fqr
operator|=
name|fqr
expr_stmt|;
comment|/* TX Confirmation Frame Queue */
name|fqr
operator|=
name|qman_fqr_create
argument_list|(
literal|1
argument_list|,
name|DTSEC_RM_FQR_TX_CONF_CHANNEL
argument_list|,
name|DTSEC_RM_FQR_TX_CONF_WQ
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|fqr
operator|==
name|NULL
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"could not create TX confirmation "
literal|"queue\n"
argument_list|)
expr_stmt|;
name|dtsec_rm_fqr_tx_free
argument_list|(
name|sc
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|sc
operator|->
name|sc_tx_conf_fqr
operator|=
name|fqr
expr_stmt|;
name|sc
operator|->
name|sc_tx_conf_fqid
operator|=
name|qman_fqr_get_base_fqid
argument_list|(
name|fqr
argument_list|)
expr_stmt|;
name|error
operator|=
name|qman_fqr_register_cb
argument_list|(
name|fqr
argument_list|,
name|dtsec_rm_fqr_tx_confirm_callback
argument_list|,
name|sc
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|!=
name|E_OK
condition|)
block|{
name|device_printf
argument_list|(
name|sc
operator|->
name|sc_dev
argument_list|,
literal|"could not register TX confirmation "
literal|"callback\n"
argument_list|)
expr_stmt|;
name|dtsec_rm_fqr_tx_free
argument_list|(
name|sc
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/** @} */
end_comment

begin_comment
comment|/**  * @group dTSEC IFnet routines.  * @{  */
end_comment

begin_function
name|void
name|dtsec_rm_if_start_locked
parameter_list|(
name|struct
name|dtsec_softc
modifier|*
name|sc
parameter_list|)
block|{
name|vm_size_t
name|dsize
decl_stmt|,
name|psize
decl_stmt|,
name|ssize
decl_stmt|;
name|struct
name|dtsec_rm_frame_info
modifier|*
name|fi
decl_stmt|;
name|unsigned
name|int
name|qlen
decl_stmt|,
name|i
decl_stmt|;
name|struct
name|mbuf
modifier|*
name|m0
decl_stmt|,
modifier|*
name|m
decl_stmt|;
name|vm_offset_t
name|vaddr
decl_stmt|;
name|vm_paddr_t
name|paddr
decl_stmt|;
name|t_DpaaFD
name|fd
decl_stmt|;
name|DTSEC_LOCK_ASSERT
argument_list|(
name|sc
argument_list|)
expr_stmt|;
comment|/* TODO: IFF_DRV_OACTIVE */
if|if
condition|(
operator|(
name|sc
operator|->
name|sc_mii
operator|->
name|mii_media_status
operator|&
name|IFM_ACTIVE
operator|)
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
operator|(
name|sc
operator|->
name|sc_ifnet
operator|->
name|if_drv_flags
operator|&
name|IFF_DRV_RUNNING
operator|)
operator|!=
name|IFF_DRV_RUNNING
condition|)
return|return;
while|while
condition|(
operator|!
name|IFQ_DRV_IS_EMPTY
argument_list|(
operator|&
name|sc
operator|->
name|sc_ifnet
operator|->
name|if_snd
argument_list|)
condition|)
block|{
comment|/* Check length of the TX queue */
name|qlen
operator|=
name|qman_fqr_get_counter
argument_list|(
name|sc
operator|->
name|sc_tx_fqr
argument_list|,
literal|0
argument_list|,
name|e_QM_FQR_COUNTERS_FRAME
argument_list|)
expr_stmt|;
if|if
condition|(
name|qlen
operator|>=
name|DTSEC_MAX_TX_QUEUE_LEN
condition|)
block|{
name|sc
operator|->
name|sc_tx_fqr_full
operator|=
literal|1
expr_stmt|;
return|return;
block|}
name|fi
operator|=
name|dtsec_rm_fi_alloc
argument_list|(
name|sc
argument_list|)
expr_stmt|;
if|if
condition|(
name|fi
operator|==
name|NULL
condition|)
return|return;
name|IFQ_DRV_DEQUEUE
argument_list|(
operator|&
name|sc
operator|->
name|sc_ifnet
operator|->
name|if_snd
argument_list|,
name|m0
argument_list|)
expr_stmt|;
if|if
condition|(
name|m0
operator|==
name|NULL
condition|)
block|{
name|dtsec_rm_fi_free
argument_list|(
name|sc
argument_list|,
name|fi
argument_list|)
expr_stmt|;
return|return;
block|}
name|i
operator|=
literal|0
expr_stmt|;
name|m
operator|=
name|m0
expr_stmt|;
name|psize
operator|=
literal|0
expr_stmt|;
name|dsize
operator|=
literal|0
expr_stmt|;
name|fi
operator|->
name|fi_mbuf
operator|=
name|m0
expr_stmt|;
while|while
condition|(
name|m
operator|&&
name|i
operator|<
name|DPAA_NUM_OF_SG_TABLE_ENTRY
condition|)
block|{
if|if
condition|(
name|m
operator|->
name|m_len
operator|==
literal|0
condition|)
continue|continue;
comment|/* 			 * First entry in scatter-gather table is used to keep 			 * pointer to frame info structure. 			 */
name|DPAA_SGTE_SET_ADDR
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|fi
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_LENGTH
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_EXTENSION
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_FINAL
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_BPID
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_OFFSET
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
name|dsize
operator|=
name|m
operator|->
name|m_len
expr_stmt|;
name|vaddr
operator|=
operator|(
name|vm_offset_t
operator|)
name|m
operator|->
name|m_data
expr_stmt|;
while|while
condition|(
name|dsize
operator|>
literal|0
operator|&&
name|i
operator|<
name|DPAA_NUM_OF_SG_TABLE_ENTRY
condition|)
block|{
name|paddr
operator|=
name|XX_VirtToPhys
argument_list|(
operator|(
name|void
operator|*
operator|)
name|vaddr
argument_list|)
expr_stmt|;
name|ssize
operator|=
name|PAGE_SIZE
operator|-
operator|(
name|paddr
operator|&
name|PAGE_MASK
operator|)
expr_stmt|;
if|if
condition|(
name|m
operator|->
name|m_len
operator|<
name|ssize
condition|)
name|ssize
operator|=
name|m
operator|->
name|m_len
expr_stmt|;
name|DPAA_SGTE_SET_ADDR
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
name|vaddr
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_LENGTH
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
name|ssize
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_EXTENSION
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_FINAL
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_BPID
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_SGTE_SET_OFFSET
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|dsize
operator|-=
name|ssize
expr_stmt|;
name|vaddr
operator|+=
name|ssize
expr_stmt|;
name|psize
operator|+=
name|ssize
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|dsize
operator|>
literal|0
condition|)
break|break;
name|m
operator|=
name|m
operator|->
name|m_next
expr_stmt|;
block|}
comment|/* Check if SG table was constructed properly */
if|if
condition|(
name|m
operator|!=
name|NULL
operator|||
name|dsize
operator|!=
literal|0
condition|)
block|{
name|dtsec_rm_fi_free
argument_list|(
name|sc
argument_list|,
name|fi
argument_list|)
expr_stmt|;
name|m_freem
argument_list|(
name|m0
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|DPAA_SGTE_SET_FINAL
argument_list|(
operator|&
name|fi
operator|->
name|fi_sgt
index|[
name|i
operator|-
literal|1
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_ADDR
argument_list|(
operator|&
name|fd
argument_list|,
name|fi
operator|->
name|fi_sgt
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_LENGTH
argument_list|(
operator|&
name|fd
argument_list|,
name|psize
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_FORMAT
argument_list|(
operator|&
name|fd
argument_list|,
name|e_DPAA_FD_FORMAT_TYPE_SHORT_MBSF
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_DD
argument_list|(
operator|&
name|fd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_PID
argument_list|(
operator|&
name|fd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_BPID
argument_list|(
operator|&
name|fd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_OFFSET
argument_list|(
operator|&
name|fd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DPAA_FD_SET_STATUS
argument_list|(
operator|&
name|fd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DTSEC_UNLOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
if|if
condition|(
name|qman_fqr_enqueue
argument_list|(
name|sc
operator|->
name|sc_tx_fqr
argument_list|,
literal|0
argument_list|,
operator|&
name|fd
argument_list|)
operator|!=
name|E_OK
condition|)
block|{
name|dtsec_rm_fi_free
argument_list|(
name|sc
argument_list|,
name|fi
argument_list|)
expr_stmt|;
name|m_freem
argument_list|(
name|m0
argument_list|)
expr_stmt|;
block|}
name|DTSEC_LOCK
argument_list|(
name|sc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** @} */
end_comment

end_unit

