begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************    Copyright (c) 2013-2015, Intel Corporation    All rights reserved.      Redistribution and use in source and binary forms, with or without    modification, are permitted provided that the following conditions are met:       1. Redistributions of source code must retain the above copyright notice,        this list of conditions and the following disclaimer.       2. Redistributions in binary form must reproduce the above copyright        notice, this list of conditions and the following disclaimer in the        documentation and/or other materials provided with the distribution.       3. Neither the name of the Intel Corporation nor the names of its        contributors may be used to endorse or promote products derived from        this software without specific prior written permission.      THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE    ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR    CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE   POSSIBILITY OF SUCH DAMAGE.  ******************************************************************************/
end_comment

begin_comment
comment|/*$FreeBSD$*/
end_comment

begin_include
include|#
directive|include
file|"i40e_type.h"
end_include

begin_include
include|#
directive|include
file|"i40e_adminq.h"
end_include

begin_include
include|#
directive|include
file|"i40e_prototype.h"
end_include

begin_include
include|#
directive|include
file|"i40e_virtchnl.h"
end_include

begin_comment
comment|/**  * i40e_set_mac_type - Sets MAC type  * @hw: pointer to the HW structure  *  * This function sets the mac type of the adapter based on the  * vendor ID and device ID stored in the hw structure.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_set_mac_type
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_set_mac_type\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|hw
operator|->
name|vendor_id
operator|==
name|I40E_INTEL_VENDOR_ID
condition|)
block|{
switch|switch
condition|(
name|hw
operator|->
name|device_id
condition|)
block|{
case|case
name|I40E_DEV_ID_SFP_XL710
case|:
case|case
name|I40E_DEV_ID_QEMU
case|:
case|case
name|I40E_DEV_ID_KX_B
case|:
case|case
name|I40E_DEV_ID_KX_C
case|:
case|case
name|I40E_DEV_ID_QSFP_A
case|:
case|case
name|I40E_DEV_ID_QSFP_B
case|:
case|case
name|I40E_DEV_ID_QSFP_C
case|:
case|case
name|I40E_DEV_ID_10G_BASE_T
case|:
case|case
name|I40E_DEV_ID_10G_BASE_T4
case|:
case|case
name|I40E_DEV_ID_20G_KR2
case|:
case|case
name|I40E_DEV_ID_20G_KR2_A
case|:
name|hw
operator|->
name|mac
operator|.
name|type
operator|=
name|I40E_MAC_XL710
expr_stmt|;
break|break;
case|case
name|I40E_DEV_ID_VF
case|:
case|case
name|I40E_DEV_ID_VF_HV
case|:
name|hw
operator|->
name|mac
operator|.
name|type
operator|=
name|I40E_MAC_VF
expr_stmt|;
break|break;
default|default:
name|hw
operator|->
name|mac
operator|.
name|type
operator|=
name|I40E_MAC_GENERIC
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
name|status
operator|=
name|I40E_ERR_DEVICE_NOT_SUPPORTED
expr_stmt|;
block|}
name|DEBUGOUT2
argument_list|(
literal|"i40e_set_mac_type found mac: %d, returns: %d\n"
argument_list|,
name|hw
operator|->
name|mac
operator|.
name|type
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_str - convert AQ err code to a string  * @hw: pointer to the HW structure  * @aq_err: the AQ error code to convert  **/
end_comment

begin_function
specifier|const
name|char
modifier|*
name|i40e_aq_str
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_admin_queue_err
name|aq_err
parameter_list|)
block|{
switch|switch
condition|(
name|aq_err
condition|)
block|{
case|case
name|I40E_AQ_RC_OK
case|:
return|return
literal|"OK"
return|;
case|case
name|I40E_AQ_RC_EPERM
case|:
return|return
literal|"I40E_AQ_RC_EPERM"
return|;
case|case
name|I40E_AQ_RC_ENOENT
case|:
return|return
literal|"I40E_AQ_RC_ENOENT"
return|;
case|case
name|I40E_AQ_RC_ESRCH
case|:
return|return
literal|"I40E_AQ_RC_ESRCH"
return|;
case|case
name|I40E_AQ_RC_EINTR
case|:
return|return
literal|"I40E_AQ_RC_EINTR"
return|;
case|case
name|I40E_AQ_RC_EIO
case|:
return|return
literal|"I40E_AQ_RC_EIO"
return|;
case|case
name|I40E_AQ_RC_ENXIO
case|:
return|return
literal|"I40E_AQ_RC_ENXIO"
return|;
case|case
name|I40E_AQ_RC_E2BIG
case|:
return|return
literal|"I40E_AQ_RC_E2BIG"
return|;
case|case
name|I40E_AQ_RC_EAGAIN
case|:
return|return
literal|"I40E_AQ_RC_EAGAIN"
return|;
case|case
name|I40E_AQ_RC_ENOMEM
case|:
return|return
literal|"I40E_AQ_RC_ENOMEM"
return|;
case|case
name|I40E_AQ_RC_EACCES
case|:
return|return
literal|"I40E_AQ_RC_EACCES"
return|;
case|case
name|I40E_AQ_RC_EFAULT
case|:
return|return
literal|"I40E_AQ_RC_EFAULT"
return|;
case|case
name|I40E_AQ_RC_EBUSY
case|:
return|return
literal|"I40E_AQ_RC_EBUSY"
return|;
case|case
name|I40E_AQ_RC_EEXIST
case|:
return|return
literal|"I40E_AQ_RC_EEXIST"
return|;
case|case
name|I40E_AQ_RC_EINVAL
case|:
return|return
literal|"I40E_AQ_RC_EINVAL"
return|;
case|case
name|I40E_AQ_RC_ENOTTY
case|:
return|return
literal|"I40E_AQ_RC_ENOTTY"
return|;
case|case
name|I40E_AQ_RC_ENOSPC
case|:
return|return
literal|"I40E_AQ_RC_ENOSPC"
return|;
case|case
name|I40E_AQ_RC_ENOSYS
case|:
return|return
literal|"I40E_AQ_RC_ENOSYS"
return|;
case|case
name|I40E_AQ_RC_ERANGE
case|:
return|return
literal|"I40E_AQ_RC_ERANGE"
return|;
case|case
name|I40E_AQ_RC_EFLUSHED
case|:
return|return
literal|"I40E_AQ_RC_EFLUSHED"
return|;
case|case
name|I40E_AQ_RC_BAD_ADDR
case|:
return|return
literal|"I40E_AQ_RC_BAD_ADDR"
return|;
case|case
name|I40E_AQ_RC_EMODE
case|:
return|return
literal|"I40E_AQ_RC_EMODE"
return|;
case|case
name|I40E_AQ_RC_EFBIG
case|:
return|return
literal|"I40E_AQ_RC_EFBIG"
return|;
block|}
name|snprintf
argument_list|(
name|hw
operator|->
name|err_str
argument_list|,
sizeof|sizeof
argument_list|(
name|hw
operator|->
name|err_str
argument_list|)
argument_list|,
literal|"%d"
argument_list|,
name|aq_err
argument_list|)
expr_stmt|;
return|return
name|hw
operator|->
name|err_str
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_stat_str - convert status err code to a string  * @hw: pointer to the HW structure  * @stat_err: the status error code to convert  **/
end_comment

begin_function
specifier|const
name|char
modifier|*
name|i40e_stat_str
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_status_code
name|stat_err
parameter_list|)
block|{
switch|switch
condition|(
name|stat_err
condition|)
block|{
case|case
name|I40E_SUCCESS
case|:
return|return
literal|"OK"
return|;
case|case
name|I40E_ERR_NVM
case|:
return|return
literal|"I40E_ERR_NVM"
return|;
case|case
name|I40E_ERR_NVM_CHECKSUM
case|:
return|return
literal|"I40E_ERR_NVM_CHECKSUM"
return|;
case|case
name|I40E_ERR_PHY
case|:
return|return
literal|"I40E_ERR_PHY"
return|;
case|case
name|I40E_ERR_CONFIG
case|:
return|return
literal|"I40E_ERR_CONFIG"
return|;
case|case
name|I40E_ERR_PARAM
case|:
return|return
literal|"I40E_ERR_PARAM"
return|;
case|case
name|I40E_ERR_MAC_TYPE
case|:
return|return
literal|"I40E_ERR_MAC_TYPE"
return|;
case|case
name|I40E_ERR_UNKNOWN_PHY
case|:
return|return
literal|"I40E_ERR_UNKNOWN_PHY"
return|;
case|case
name|I40E_ERR_LINK_SETUP
case|:
return|return
literal|"I40E_ERR_LINK_SETUP"
return|;
case|case
name|I40E_ERR_ADAPTER_STOPPED
case|:
return|return
literal|"I40E_ERR_ADAPTER_STOPPED"
return|;
case|case
name|I40E_ERR_INVALID_MAC_ADDR
case|:
return|return
literal|"I40E_ERR_INVALID_MAC_ADDR"
return|;
case|case
name|I40E_ERR_DEVICE_NOT_SUPPORTED
case|:
return|return
literal|"I40E_ERR_DEVICE_NOT_SUPPORTED"
return|;
case|case
name|I40E_ERR_MASTER_REQUESTS_PENDING
case|:
return|return
literal|"I40E_ERR_MASTER_REQUESTS_PENDING"
return|;
case|case
name|I40E_ERR_INVALID_LINK_SETTINGS
case|:
return|return
literal|"I40E_ERR_INVALID_LINK_SETTINGS"
return|;
case|case
name|I40E_ERR_AUTONEG_NOT_COMPLETE
case|:
return|return
literal|"I40E_ERR_AUTONEG_NOT_COMPLETE"
return|;
case|case
name|I40E_ERR_RESET_FAILED
case|:
return|return
literal|"I40E_ERR_RESET_FAILED"
return|;
case|case
name|I40E_ERR_SWFW_SYNC
case|:
return|return
literal|"I40E_ERR_SWFW_SYNC"
return|;
case|case
name|I40E_ERR_NO_AVAILABLE_VSI
case|:
return|return
literal|"I40E_ERR_NO_AVAILABLE_VSI"
return|;
case|case
name|I40E_ERR_NO_MEMORY
case|:
return|return
literal|"I40E_ERR_NO_MEMORY"
return|;
case|case
name|I40E_ERR_BAD_PTR
case|:
return|return
literal|"I40E_ERR_BAD_PTR"
return|;
case|case
name|I40E_ERR_RING_FULL
case|:
return|return
literal|"I40E_ERR_RING_FULL"
return|;
case|case
name|I40E_ERR_INVALID_PD_ID
case|:
return|return
literal|"I40E_ERR_INVALID_PD_ID"
return|;
case|case
name|I40E_ERR_INVALID_QP_ID
case|:
return|return
literal|"I40E_ERR_INVALID_QP_ID"
return|;
case|case
name|I40E_ERR_INVALID_CQ_ID
case|:
return|return
literal|"I40E_ERR_INVALID_CQ_ID"
return|;
case|case
name|I40E_ERR_INVALID_CEQ_ID
case|:
return|return
literal|"I40E_ERR_INVALID_CEQ_ID"
return|;
case|case
name|I40E_ERR_INVALID_AEQ_ID
case|:
return|return
literal|"I40E_ERR_INVALID_AEQ_ID"
return|;
case|case
name|I40E_ERR_INVALID_SIZE
case|:
return|return
literal|"I40E_ERR_INVALID_SIZE"
return|;
case|case
name|I40E_ERR_INVALID_ARP_INDEX
case|:
return|return
literal|"I40E_ERR_INVALID_ARP_INDEX"
return|;
case|case
name|I40E_ERR_INVALID_FPM_FUNC_ID
case|:
return|return
literal|"I40E_ERR_INVALID_FPM_FUNC_ID"
return|;
case|case
name|I40E_ERR_QP_INVALID_MSG_SIZE
case|:
return|return
literal|"I40E_ERR_QP_INVALID_MSG_SIZE"
return|;
case|case
name|I40E_ERR_QP_TOOMANY_WRS_POSTED
case|:
return|return
literal|"I40E_ERR_QP_TOOMANY_WRS_POSTED"
return|;
case|case
name|I40E_ERR_INVALID_FRAG_COUNT
case|:
return|return
literal|"I40E_ERR_INVALID_FRAG_COUNT"
return|;
case|case
name|I40E_ERR_QUEUE_EMPTY
case|:
return|return
literal|"I40E_ERR_QUEUE_EMPTY"
return|;
case|case
name|I40E_ERR_INVALID_ALIGNMENT
case|:
return|return
literal|"I40E_ERR_INVALID_ALIGNMENT"
return|;
case|case
name|I40E_ERR_FLUSHED_QUEUE
case|:
return|return
literal|"I40E_ERR_FLUSHED_QUEUE"
return|;
case|case
name|I40E_ERR_INVALID_PUSH_PAGE_INDEX
case|:
return|return
literal|"I40E_ERR_INVALID_PUSH_PAGE_INDEX"
return|;
case|case
name|I40E_ERR_INVALID_IMM_DATA_SIZE
case|:
return|return
literal|"I40E_ERR_INVALID_IMM_DATA_SIZE"
return|;
case|case
name|I40E_ERR_TIMEOUT
case|:
return|return
literal|"I40E_ERR_TIMEOUT"
return|;
case|case
name|I40E_ERR_OPCODE_MISMATCH
case|:
return|return
literal|"I40E_ERR_OPCODE_MISMATCH"
return|;
case|case
name|I40E_ERR_CQP_COMPL_ERROR
case|:
return|return
literal|"I40E_ERR_CQP_COMPL_ERROR"
return|;
case|case
name|I40E_ERR_INVALID_VF_ID
case|:
return|return
literal|"I40E_ERR_INVALID_VF_ID"
return|;
case|case
name|I40E_ERR_INVALID_HMCFN_ID
case|:
return|return
literal|"I40E_ERR_INVALID_HMCFN_ID"
return|;
case|case
name|I40E_ERR_BACKING_PAGE_ERROR
case|:
return|return
literal|"I40E_ERR_BACKING_PAGE_ERROR"
return|;
case|case
name|I40E_ERR_NO_PBLCHUNKS_AVAILABLE
case|:
return|return
literal|"I40E_ERR_NO_PBLCHUNKS_AVAILABLE"
return|;
case|case
name|I40E_ERR_INVALID_PBLE_INDEX
case|:
return|return
literal|"I40E_ERR_INVALID_PBLE_INDEX"
return|;
case|case
name|I40E_ERR_INVALID_SD_INDEX
case|:
return|return
literal|"I40E_ERR_INVALID_SD_INDEX"
return|;
case|case
name|I40E_ERR_INVALID_PAGE_DESC_INDEX
case|:
return|return
literal|"I40E_ERR_INVALID_PAGE_DESC_INDEX"
return|;
case|case
name|I40E_ERR_INVALID_SD_TYPE
case|:
return|return
literal|"I40E_ERR_INVALID_SD_TYPE"
return|;
case|case
name|I40E_ERR_MEMCPY_FAILED
case|:
return|return
literal|"I40E_ERR_MEMCPY_FAILED"
return|;
case|case
name|I40E_ERR_INVALID_HMC_OBJ_INDEX
case|:
return|return
literal|"I40E_ERR_INVALID_HMC_OBJ_INDEX"
return|;
case|case
name|I40E_ERR_INVALID_HMC_OBJ_COUNT
case|:
return|return
literal|"I40E_ERR_INVALID_HMC_OBJ_COUNT"
return|;
case|case
name|I40E_ERR_INVALID_SRQ_ARM_LIMIT
case|:
return|return
literal|"I40E_ERR_INVALID_SRQ_ARM_LIMIT"
return|;
case|case
name|I40E_ERR_SRQ_ENABLED
case|:
return|return
literal|"I40E_ERR_SRQ_ENABLED"
return|;
case|case
name|I40E_ERR_ADMIN_QUEUE_ERROR
case|:
return|return
literal|"I40E_ERR_ADMIN_QUEUE_ERROR"
return|;
case|case
name|I40E_ERR_ADMIN_QUEUE_TIMEOUT
case|:
return|return
literal|"I40E_ERR_ADMIN_QUEUE_TIMEOUT"
return|;
case|case
name|I40E_ERR_BUF_TOO_SHORT
case|:
return|return
literal|"I40E_ERR_BUF_TOO_SHORT"
return|;
case|case
name|I40E_ERR_ADMIN_QUEUE_FULL
case|:
return|return
literal|"I40E_ERR_ADMIN_QUEUE_FULL"
return|;
case|case
name|I40E_ERR_ADMIN_QUEUE_NO_WORK
case|:
return|return
literal|"I40E_ERR_ADMIN_QUEUE_NO_WORK"
return|;
case|case
name|I40E_ERR_BAD_IWARP_CQE
case|:
return|return
literal|"I40E_ERR_BAD_IWARP_CQE"
return|;
case|case
name|I40E_ERR_NVM_BLANK_MODE
case|:
return|return
literal|"I40E_ERR_NVM_BLANK_MODE"
return|;
case|case
name|I40E_ERR_NOT_IMPLEMENTED
case|:
return|return
literal|"I40E_ERR_NOT_IMPLEMENTED"
return|;
case|case
name|I40E_ERR_PE_DOORBELL_NOT_ENABLED
case|:
return|return
literal|"I40E_ERR_PE_DOORBELL_NOT_ENABLED"
return|;
case|case
name|I40E_ERR_DIAG_TEST_FAILED
case|:
return|return
literal|"I40E_ERR_DIAG_TEST_FAILED"
return|;
case|case
name|I40E_ERR_NOT_READY
case|:
return|return
literal|"I40E_ERR_NOT_READY"
return|;
case|case
name|I40E_NOT_SUPPORTED
case|:
return|return
literal|"I40E_NOT_SUPPORTED"
return|;
case|case
name|I40E_ERR_FIRMWARE_API_VERSION
case|:
return|return
literal|"I40E_ERR_FIRMWARE_API_VERSION"
return|;
block|}
name|snprintf
argument_list|(
name|hw
operator|->
name|err_str
argument_list|,
sizeof|sizeof
argument_list|(
name|hw
operator|->
name|err_str
argument_list|)
argument_list|,
literal|"%d"
argument_list|,
name|stat_err
argument_list|)
expr_stmt|;
return|return
name|hw
operator|->
name|err_str
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_debug_aq  * @hw: debug mask related to admin queue  * @mask: debug mask  * @desc: pointer to admin queue descriptor  * @buffer: pointer to command buffer  * @buf_len: max length of buffer  *  * Dumps debug log about adminq command with descriptor contents.  **/
end_comment

begin_function
name|void
name|i40e_debug_aq
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_debug_mask
name|mask
parameter_list|,
name|void
modifier|*
name|desc
parameter_list|,
name|void
modifier|*
name|buffer
parameter_list|,
name|u16
name|buf_len
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
modifier|*
name|aq_desc
init|=
operator|(
expr|struct
name|i40e_aq_desc
operator|*
operator|)
name|desc
decl_stmt|;
name|u16
name|len
init|=
name|LE16_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|datalen
argument_list|)
decl_stmt|;
name|u8
modifier|*
name|buf
init|=
operator|(
name|u8
operator|*
operator|)
name|buffer
decl_stmt|;
name|u16
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
operator|!
operator|(
name|mask
operator|&
name|hw
operator|->
name|debug_mask
operator|)
operator|)
operator|||
operator|(
name|desc
operator|==
name|NULL
operator|)
condition|)
return|return;
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"AQ CMD: opcode 0x%04X, flags 0x%04X, datalen 0x%04X, retval 0x%04X\n"
argument_list|,
name|LE16_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|opcode
argument_list|)
argument_list|,
name|LE16_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|flags
argument_list|)
argument_list|,
name|LE16_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|datalen
argument_list|)
argument_list|,
name|LE16_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|retval
argument_list|)
argument_list|)
expr_stmt|;
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"\tcookie (h,l) 0x%08X 0x%08X\n"
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|cookie_high
argument_list|)
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|cookie_low
argument_list|)
argument_list|)
expr_stmt|;
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"\tparam (0,1)  0x%08X 0x%08X\n"
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|params
operator|.
name|internal
operator|.
name|param0
argument_list|)
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|params
operator|.
name|internal
operator|.
name|param1
argument_list|)
argument_list|)
expr_stmt|;
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"\taddr (h,l)   0x%08X 0x%08X\n"
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|params
operator|.
name|external
operator|.
name|addr_high
argument_list|)
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|aq_desc
operator|->
name|params
operator|.
name|external
operator|.
name|addr_low
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|buffer
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|aq_desc
operator|->
name|datalen
operator|!=
literal|0
operator|)
condition|)
block|{
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"AQ CMD Buffer:\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_len
operator|<
name|len
condition|)
name|len
operator|=
name|buf_len
expr_stmt|;
comment|/* write the full 16-byte chunks */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|len
operator|-
literal|16
operator|)
condition|;
name|i
operator|+=
literal|16
control|)
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"\t0x%04X  %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X\n"
argument_list|,
name|i
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|2
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|3
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|4
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|5
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|6
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|7
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|8
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|9
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|10
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|11
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|12
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|13
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|14
index|]
argument_list|,
name|buf
index|[
name|i
operator|+
literal|15
index|]
argument_list|)
expr_stmt|;
comment|/* the most we could have left is 16 bytes, pad with zeros */
if|if
condition|(
name|i
operator|<
name|len
condition|)
block|{
name|char
name|d_buf
index|[
literal|16
index|]
decl_stmt|;
name|int
name|j
decl_stmt|;
name|memset
argument_list|(
name|d_buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|d_buf
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|j
operator|++
operator|,
name|i
operator|++
control|)
name|d_buf
index|[
name|j
index|]
operator|=
name|buf
index|[
name|i
index|]
expr_stmt|;
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|mask
argument_list|,
literal|"\t0x%04X  %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X\n"
argument_list|,
name|i
argument_list|,
name|d_buf
index|[
literal|0
index|]
argument_list|,
name|d_buf
index|[
literal|1
index|]
argument_list|,
name|d_buf
index|[
literal|2
index|]
argument_list|,
name|d_buf
index|[
literal|3
index|]
argument_list|,
name|d_buf
index|[
literal|4
index|]
argument_list|,
name|d_buf
index|[
literal|5
index|]
argument_list|,
name|d_buf
index|[
literal|6
index|]
argument_list|,
name|d_buf
index|[
literal|7
index|]
argument_list|,
name|d_buf
index|[
literal|8
index|]
argument_list|,
name|d_buf
index|[
literal|9
index|]
argument_list|,
name|d_buf
index|[
literal|10
index|]
argument_list|,
name|d_buf
index|[
literal|11
index|]
argument_list|,
name|d_buf
index|[
literal|12
index|]
argument_list|,
name|d_buf
index|[
literal|13
index|]
argument_list|,
name|d_buf
index|[
literal|14
index|]
argument_list|,
name|d_buf
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/**  * i40e_check_asq_alive  * @hw: pointer to the hw struct  *  * Returns TRUE if Queue is enabled else FALSE.  **/
end_comment

begin_function
name|bool
name|i40e_check_asq_alive
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
if|if
condition|(
name|hw
operator|->
name|aq
operator|.
name|asq
operator|.
name|len
condition|)
if|if
condition|(
operator|!
name|i40e_is_vf
argument_list|(
name|hw
argument_list|)
condition|)
return|return
operator|!
operator|!
operator|(
name|rd32
argument_list|(
name|hw
argument_list|,
name|hw
operator|->
name|aq
operator|.
name|asq
operator|.
name|len
argument_list|)
operator|&
name|I40E_PF_ATQLEN_ATQENABLE_MASK
operator|)
return|;
if|if
condition|(
name|i40e_is_vf
argument_list|(
name|hw
argument_list|)
condition|)
return|return
operator|!
operator|!
operator|(
name|rd32
argument_list|(
name|hw
argument_list|,
name|hw
operator|->
name|aq
operator|.
name|asq
operator|.
name|len
argument_list|)
operator|&
name|I40E_VF_ATQLEN1_ATQENABLE_MASK
operator|)
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_queue_shutdown  * @hw: pointer to the hw struct  * @unloading: is the driver unloading itself  *  * Tell the Firmware that we're shutting down the AdminQ and whether  * or not the driver is unloading as well.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_queue_shutdown
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|unloading
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_queue_shutdown
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_queue_shutdown
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_queue_shutdown
argument_list|)
expr_stmt|;
if|if
condition|(
name|unloading
condition|)
name|cmd
operator|->
name|driver_unloading
operator|=
name|CPU_TO_LE32
argument_list|(
name|I40E_AQ_DRIVER_UNLOADING
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* The i40e_ptype_lookup table is used to convert from the 8-bit ptype in the  * hardware to a bit-field that can be used by SW to more easily determine the  * packet type.  *  * Macros are used to shorten the table lines and make this table human  * readable.  *  * We store the PTYPE in the top byte of the bit field - this is just so that  * we can check that the table doesn't have a row missing, as the index into  * the table should be the PTYPE.  *  * Typical work flow:  *  * IF NOT i40e_ptype_lookup[ptype].known  * THEN  *      Packet is unknown  * ELSE IF i40e_ptype_lookup[ptype].outer_ip == I40E_RX_PTYPE_OUTER_IP  *      Use the rest of the fields to look at the tunnels, inner protocols, etc  * ELSE  *      Use the enum i40e_rx_l2_ptype to decode the packet type  * ENDIF  */
end_comment

begin_comment
comment|/* macro to make the table lines short */
end_comment

begin_define
define|#
directive|define
name|I40E_PTT
parameter_list|(
name|PTYPE
parameter_list|,
name|OUTER_IP
parameter_list|,
name|OUTER_IP_VER
parameter_list|,
name|OUTER_FRAG
parameter_list|,
name|T
parameter_list|,
name|TE
parameter_list|,
name|TEF
parameter_list|,
name|I
parameter_list|,
name|PL
parameter_list|)
define|\
value|{	PTYPE, \ 		1, \ 		I40E_RX_PTYPE_OUTER_##OUTER_IP, \ 		I40E_RX_PTYPE_OUTER_##OUTER_IP_VER, \ 		I40E_RX_PTYPE_##OUTER_FRAG, \ 		I40E_RX_PTYPE_TUNNEL_##T, \ 		I40E_RX_PTYPE_TUNNEL_END_##TE, \ 		I40E_RX_PTYPE_##TEF, \ 		I40E_RX_PTYPE_INNER_PROT_##I, \ 		I40E_RX_PTYPE_PAYLOAD_LAYER_##PL }
end_define

begin_define
define|#
directive|define
name|I40E_PTT_UNUSED_ENTRY
parameter_list|(
name|PTYPE
parameter_list|)
define|\
value|{ PTYPE, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
end_define

begin_comment
comment|/* shorter macros makes the table fit but are terse */
end_comment

begin_define
define|#
directive|define
name|I40E_RX_PTYPE_NOF
value|I40E_RX_PTYPE_NOT_FRAG
end_define

begin_define
define|#
directive|define
name|I40E_RX_PTYPE_FRG
value|I40E_RX_PTYPE_FRAG
end_define

begin_define
define|#
directive|define
name|I40E_RX_PTYPE_INNER_PROT_TS
value|I40E_RX_PTYPE_INNER_PROT_TIMESYNC
end_define

begin_comment
comment|/* Lookup table mapping the HW PTYPE to the bit field for decoding */
end_comment

begin_decl_stmt
name|struct
name|i40e_rx_ptype_decoded
name|i40e_ptype_lookup
index|[]
init|=
block|{
comment|/* L2 Packet types */
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|0
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|1
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY2
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|2
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|TS
argument_list|,
name|PAY2
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|3
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY2
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|5
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|6
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY2
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|7
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY2
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|8
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|9
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|10
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY2
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|11
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|12
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|13
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|14
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|15
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|16
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|17
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|18
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|19
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|20
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|21
argument_list|,
name|L2
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* Non Tunneled IPv4 */
name|I40E_PTT
argument_list|(
literal|22
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|23
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|24
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|25
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|26
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|27
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|28
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> IPv4 */
name|I40E_PTT
argument_list|(
literal|29
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|30
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|31
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|32
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|33
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|34
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|35
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> IPv6 */
name|I40E_PTT
argument_list|(
literal|36
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|37
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|38
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|39
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|40
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|41
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|42
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT */
name|I40E_PTT
argument_list|(
literal|43
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT --> IPv4 */
name|I40E_PTT
argument_list|(
literal|44
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|45
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|46
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|47
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|48
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|49
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|50
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT --> IPv6 */
name|I40E_PTT
argument_list|(
literal|51
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|52
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|53
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|54
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|55
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|56
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|57
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT --> MAC */
name|I40E_PTT
argument_list|(
literal|58
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT --> MAC --> IPv4 */
name|I40E_PTT
argument_list|(
literal|59
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|60
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|61
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|62
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|63
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|64
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|65
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT -> MAC --> IPv6 */
name|I40E_PTT
argument_list|(
literal|66
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|67
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|68
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|69
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|70
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|71
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|72
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 --> GRE/NAT --> MAC/VLAN */
name|I40E_PTT
argument_list|(
literal|73
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* IPv4 ---> GRE/NAT -> MAC/VLAN --> IPv4 */
name|I40E_PTT
argument_list|(
literal|74
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|75
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|76
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|77
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|78
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|79
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|80
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv4 -> GRE/NAT -> MAC/VLAN --> IPv6 */
name|I40E_PTT
argument_list|(
literal|81
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|82
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|83
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|84
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|85
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|86
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|87
argument_list|,
name|IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* Non Tunneled IPv6 */
name|I40E_PTT
argument_list|(
literal|88
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|89
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|90
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|91
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|92
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|93
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|94
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> IPv4 */
name|I40E_PTT
argument_list|(
literal|95
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|96
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|97
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|98
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|99
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|100
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|101
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> IPv6 */
name|I40E_PTT
argument_list|(
literal|102
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|103
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|104
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|105
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|106
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|107
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|108
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT */
name|I40E_PTT
argument_list|(
literal|109
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> IPv4 */
name|I40E_PTT
argument_list|(
literal|110
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|111
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|112
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|113
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|114
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|115
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|116
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> IPv6 */
name|I40E_PTT
argument_list|(
literal|117
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|118
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|119
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|120
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|121
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|122
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|123
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> MAC */
name|I40E_PTT
argument_list|(
literal|124
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> MAC -> IPv4 */
name|I40E_PTT
argument_list|(
literal|125
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|126
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|127
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|128
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|129
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|130
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|131
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> MAC -> IPv6 */
name|I40E_PTT
argument_list|(
literal|132
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|133
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|134
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|135
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|136
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|137
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|138
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> MAC/VLAN */
name|I40E_PTT
argument_list|(
literal|139
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|NONE
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> MAC/VLAN --> IPv4 */
name|I40E_PTT
argument_list|(
literal|140
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|141
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|142
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|143
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|144
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|145
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|146
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV4
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* IPv6 --> GRE/NAT -> MAC/VLAN --> IPv6 */
name|I40E_PTT
argument_list|(
literal|147
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|FRG
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|148
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|NONE
argument_list|,
name|PAY3
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|149
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|UDP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|150
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|151
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|TCP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|152
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|SCTP
argument_list|,
name|PAY4
argument_list|)
block|,
name|I40E_PTT
argument_list|(
literal|153
argument_list|,
name|IP
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|IP_GRENAT_MAC_VLAN
argument_list|,
name|IPV6
argument_list|,
name|NOF
argument_list|,
name|ICMP
argument_list|,
name|PAY4
argument_list|)
block|,
comment|/* unused entries */
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|154
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|155
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|156
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|157
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|158
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|159
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|160
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|161
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|162
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|163
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|164
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|165
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|166
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|167
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|168
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|169
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|170
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|171
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|172
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|173
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|174
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|175
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|176
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|177
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|178
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|179
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|180
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|181
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|182
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|183
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|184
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|185
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|186
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|187
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|188
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|189
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|190
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|191
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|192
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|193
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|194
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|195
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|196
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|197
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|198
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|199
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|200
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|201
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|202
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|203
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|204
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|205
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|206
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|207
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|208
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|209
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|210
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|211
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|212
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|213
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|214
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|215
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|216
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|217
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|218
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|219
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|220
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|221
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|222
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|223
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|224
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|225
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|226
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|227
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|228
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|229
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|230
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|231
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|232
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|233
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|234
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|235
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|236
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|237
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|238
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|239
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|240
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|241
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|242
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|243
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|244
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|245
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|246
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|247
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|248
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|249
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|250
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|251
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|252
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|253
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|254
argument_list|)
block|,
name|I40E_PTT_UNUSED_ENTRY
argument_list|(
literal|255
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**  * i40e_validate_mac_addr - Validate unicast MAC address  * @mac_addr: pointer to MAC address  *  * Tests a MAC address to ensure it is a valid Individual Address  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_validate_mac_addr
parameter_list|(
name|u8
modifier|*
name|mac_addr
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_validate_mac_addr"
argument_list|)
expr_stmt|;
comment|/* Broadcast addresses ARE multicast addresses 	 * Make sure it is not a multicast address 	 * Reject the zero address 	 */
if|if
condition|(
name|I40E_IS_MULTICAST
argument_list|(
name|mac_addr
argument_list|)
operator|||
operator|(
name|mac_addr
index|[
literal|0
index|]
operator|==
literal|0
operator|&&
name|mac_addr
index|[
literal|1
index|]
operator|==
literal|0
operator|&&
name|mac_addr
index|[
literal|2
index|]
operator|==
literal|0
operator|&&
name|mac_addr
index|[
literal|3
index|]
operator|==
literal|0
operator|&&
name|mac_addr
index|[
literal|4
index|]
operator|==
literal|0
operator|&&
name|mac_addr
index|[
literal|5
index|]
operator|==
literal|0
operator|)
condition|)
name|status
operator|=
name|I40E_ERR_INVALID_MAC_ADDR
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_init_shared_code - Initialize the shared code  * @hw: pointer to hardware structure  *  * This assigns the MAC type and PHY code and inits the NVM.  * Does not touch the hardware. This function must be called prior to any  * other function in the shared code. The i40e_hw structure should be  * memset to 0 prior to calling this function.  The following fields in  * hw structure should be filled in prior to calling this function:  * hw_addr, back, device_id, vendor_id, subsystem_device_id,  * subsystem_vendor_id, and revision_id  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_init_shared_code
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
name|u32
name|port
decl_stmt|,
name|ari
decl_stmt|,
name|func_rid
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_init_shared_code"
argument_list|)
expr_stmt|;
name|i40e_set_mac_type
argument_list|(
name|hw
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|hw
operator|->
name|mac
operator|.
name|type
condition|)
block|{
case|case
name|I40E_MAC_XL710
case|:
break|break;
default|default:
return|return
name|I40E_ERR_DEVICE_NOT_SUPPORTED
return|;
block|}
name|hw
operator|->
name|phy
operator|.
name|get_link_info
operator|=
name|TRUE
expr_stmt|;
comment|/* Determine port number and PF number*/
name|port
operator|=
operator|(
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PFGEN_PORTNUM
argument_list|)
operator|&
name|I40E_PFGEN_PORTNUM_PORT_NUM_MASK
operator|)
operator|>>
name|I40E_PFGEN_PORTNUM_PORT_NUM_SHIFT
expr_stmt|;
name|hw
operator|->
name|port
operator|=
operator|(
name|u8
operator|)
name|port
expr_stmt|;
name|ari
operator|=
operator|(
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLPCI_CAPSUP
argument_list|)
operator|&
name|I40E_GLPCI_CAPSUP_ARI_EN_MASK
operator|)
operator|>>
name|I40E_GLPCI_CAPSUP_ARI_EN_SHIFT
expr_stmt|;
name|func_rid
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PF_FUNC_RID
argument_list|)
expr_stmt|;
if|if
condition|(
name|ari
condition|)
name|hw
operator|->
name|pf_id
operator|=
call|(
name|u8
call|)
argument_list|(
name|func_rid
operator|&
literal|0xff
argument_list|)
expr_stmt|;
else|else
name|hw
operator|->
name|pf_id
operator|=
call|(
name|u8
call|)
argument_list|(
name|func_rid
operator|&
literal|0x7
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_init_nvm
argument_list|(
name|hw
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_mac_address_read - Retrieve the MAC addresses  * @hw: pointer to the hw struct  * @flags: a return indicator of what addresses were added to the addr store  * @addrs: the requestor's mac addr store  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
specifier|static
name|enum
name|i40e_status_code
name|i40e_aq_mac_address_read
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
modifier|*
name|flags
parameter_list|,
name|struct
name|i40e_aqc_mac_address_read_data
modifier|*
name|addrs
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_mac_address_read
modifier|*
name|cmd_data
init|=
operator|(
expr|struct
name|i40e_aqc_mac_address_read
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_mac_address_read
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|addrs
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|addrs
argument_list|)
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
operator|*
name|flags
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd_data
operator|->
name|command_flags
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_mac_address_write - Change the MAC addresses  * @hw: pointer to the hw struct  * @flags: indicates which MAC to be written  * @mac_addr: address to write  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_mac_address_write
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|flags
parameter_list|,
name|u8
modifier|*
name|mac_addr
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_mac_address_write
modifier|*
name|cmd_data
init|=
operator|(
expr|struct
name|i40e_aqc_mac_address_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_mac_address_write
argument_list|)
expr_stmt|;
name|cmd_data
operator|->
name|command_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd_data
operator|->
name|mac_sah
operator|=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|mac_addr
index|[
literal|0
index|]
operator|<<
literal|8
operator||
name|mac_addr
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|cmd_data
operator|->
name|mac_sal
operator|=
name|CPU_TO_LE32
argument_list|(
operator|(
operator|(
name|u32
operator|)
name|mac_addr
index|[
literal|2
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
name|u32
operator|)
name|mac_addr
index|[
literal|3
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|u32
operator|)
name|mac_addr
index|[
literal|4
index|]
operator|<<
literal|8
operator|)
operator||
name|mac_addr
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_get_mac_addr - get MAC address  * @hw: pointer to the HW structure  * @mac_addr: pointer to MAC address  *  * Reads the adapter's MAC address from register  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_get_mac_addr
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
modifier|*
name|mac_addr
parameter_list|)
block|{
name|struct
name|i40e_aqc_mac_address_read_data
name|addrs
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|flags
init|=
literal|0
decl_stmt|;
name|status
operator|=
name|i40e_aq_mac_address_read
argument_list|(
name|hw
argument_list|,
operator|&
name|flags
argument_list|,
operator|&
name|addrs
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|I40E_AQC_LAN_ADDR_VALID
condition|)
name|memcpy
argument_list|(
name|mac_addr
argument_list|,
operator|&
name|addrs
operator|.
name|pf_lan_mac
argument_list|,
sizeof|sizeof
argument_list|(
name|addrs
operator|.
name|pf_lan_mac
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_get_port_mac_addr - get Port MAC address  * @hw: pointer to the HW structure  * @mac_addr: pointer to Port MAC address  *  * Reads the adapter's Port MAC address  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_get_port_mac_addr
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
modifier|*
name|mac_addr
parameter_list|)
block|{
name|struct
name|i40e_aqc_mac_address_read_data
name|addrs
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|flags
init|=
literal|0
decl_stmt|;
name|status
operator|=
name|i40e_aq_mac_address_read
argument_list|(
name|hw
argument_list|,
operator|&
name|flags
argument_list|,
operator|&
name|addrs
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
return|return
name|status
return|;
if|if
condition|(
name|flags
operator|&
name|I40E_AQC_PORT_ADDR_VALID
condition|)
name|memcpy
argument_list|(
name|mac_addr
argument_list|,
operator|&
name|addrs
operator|.
name|port_mac
argument_list|,
sizeof|sizeof
argument_list|(
name|addrs
operator|.
name|port_mac
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|status
operator|=
name|I40E_ERR_INVALID_MAC_ADDR
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_pre_tx_queue_cfg - pre tx queue configure  * @hw: pointer to the HW structure  * @queue: target pf queue index  * @enable: state change request  *  * Handles hw requirement to indicate intention to enable  * or disable target queue.  **/
end_comment

begin_function
name|void
name|i40e_pre_tx_queue_cfg
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|queue
parameter_list|,
name|bool
name|enable
parameter_list|)
block|{
name|u32
name|abs_queue_idx
init|=
name|hw
operator|->
name|func_caps
operator|.
name|base_queue
operator|+
name|queue
decl_stmt|;
name|u32
name|reg_block
init|=
literal|0
decl_stmt|;
name|u32
name|reg_val
decl_stmt|;
if|if
condition|(
name|abs_queue_idx
operator|>=
literal|128
condition|)
block|{
name|reg_block
operator|=
name|abs_queue_idx
operator|/
literal|128
expr_stmt|;
name|abs_queue_idx
operator|%=
literal|128
expr_stmt|;
block|}
name|reg_val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLLAN_TXPRE_QDIS
argument_list|(
name|reg_block
argument_list|)
argument_list|)
expr_stmt|;
name|reg_val
operator|&=
operator|~
name|I40E_GLLAN_TXPRE_QDIS_QINDX_MASK
expr_stmt|;
name|reg_val
operator||=
operator|(
name|abs_queue_idx
operator|<<
name|I40E_GLLAN_TXPRE_QDIS_QINDX_SHIFT
operator|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|reg_val
operator||=
name|I40E_GLLAN_TXPRE_QDIS_CLEAR_QDIS_MASK
expr_stmt|;
else|else
name|reg_val
operator||=
name|I40E_GLLAN_TXPRE_QDIS_SET_QDIS_MASK
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_GLLAN_TXPRE_QDIS
argument_list|(
name|reg_block
argument_list|)
argument_list|,
name|reg_val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  *  i40e_read_pba_string - Reads part number string from EEPROM  *  @hw: pointer to hardware structure  *  @pba_num: stores the part number string from the EEPROM  *  @pba_num_size: part number string buffer length  *  *  Reads the part number string from the EEPROM.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_read_pba_string
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
modifier|*
name|pba_num
parameter_list|,
name|u32
name|pba_num_size
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
name|u16
name|pba_word
init|=
literal|0
decl_stmt|;
name|u16
name|pba_size
init|=
literal|0
decl_stmt|;
name|u16
name|pba_ptr
init|=
literal|0
decl_stmt|;
name|u16
name|i
init|=
literal|0
decl_stmt|;
name|status
operator|=
name|i40e_read_nvm_word
argument_list|(
name|hw
argument_list|,
name|I40E_SR_PBA_FLAGS
argument_list|,
operator|&
name|pba_word
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|!=
name|I40E_SUCCESS
operator|)
operator|||
operator|(
name|pba_word
operator|!=
literal|0xFAFA
operator|)
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"Failed to read PBA flags or flag is invalid.\n"
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|i40e_read_nvm_word
argument_list|(
name|hw
argument_list|,
name|I40E_SR_PBA_BLOCK_PTR
argument_list|,
operator|&
name|pba_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"Failed to read PBA Block pointer.\n"
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|i40e_read_nvm_word
argument_list|(
name|hw
argument_list|,
name|pba_ptr
argument_list|,
operator|&
name|pba_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"Failed to read PBA Block size.\n"
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
comment|/* Subtract one to get PBA word count (PBA Size word is included in 	 * total size) 	 */
name|pba_size
operator|--
expr_stmt|;
if|if
condition|(
name|pba_num_size
operator|<
operator|(
operator|(
operator|(
name|u32
operator|)
name|pba_size
operator|*
literal|2
operator|)
operator|+
literal|1
operator|)
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"Buffer to small for PBA data.\n"
argument_list|)
expr_stmt|;
return|return
name|I40E_ERR_PARAM
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pba_size
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|i40e_read_nvm_word
argument_list|(
name|hw
argument_list|,
operator|(
name|pba_ptr
operator|+
literal|1
operator|)
operator|+
name|i
argument_list|,
operator|&
name|pba_word
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
block|{
name|DEBUGOUT1
argument_list|(
literal|"Failed to read PBA Block word %d.\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|pba_num
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
name|pba_word
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
expr_stmt|;
name|pba_num
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
name|pba_word
operator|&
literal|0xFF
expr_stmt|;
block|}
name|pba_num
index|[
operator|(
name|pba_size
operator|*
literal|2
operator|)
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_get_media_type - Gets media type  * @hw: pointer to the hardware structure  **/
end_comment

begin_function
specifier|static
name|enum
name|i40e_media_type
name|i40e_get_media_type
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|enum
name|i40e_media_type
name|media
decl_stmt|;
switch|switch
condition|(
name|hw
operator|->
name|phy
operator|.
name|link_info
operator|.
name|phy_type
condition|)
block|{
case|case
name|I40E_PHY_TYPE_10GBASE_SR
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_LR
case|:
case|case
name|I40E_PHY_TYPE_1000BASE_SX
case|:
case|case
name|I40E_PHY_TYPE_1000BASE_LX
case|:
case|case
name|I40E_PHY_TYPE_40GBASE_SR4
case|:
case|case
name|I40E_PHY_TYPE_40GBASE_LR4
case|:
name|media
operator|=
name|I40E_MEDIA_TYPE_FIBER
expr_stmt|;
break|break;
case|case
name|I40E_PHY_TYPE_100BASE_TX
case|:
case|case
name|I40E_PHY_TYPE_1000BASE_T
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_T
case|:
name|media
operator|=
name|I40E_MEDIA_TYPE_BASET
expr_stmt|;
break|break;
case|case
name|I40E_PHY_TYPE_10GBASE_CR1_CU
case|:
case|case
name|I40E_PHY_TYPE_40GBASE_CR4_CU
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_CR1
case|:
case|case
name|I40E_PHY_TYPE_40GBASE_CR4
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_SFPP_CU
case|:
case|case
name|I40E_PHY_TYPE_40GBASE_AOC
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_AOC
case|:
name|media
operator|=
name|I40E_MEDIA_TYPE_DA
expr_stmt|;
break|break;
case|case
name|I40E_PHY_TYPE_1000BASE_KX
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_KX4
case|:
case|case
name|I40E_PHY_TYPE_10GBASE_KR
case|:
case|case
name|I40E_PHY_TYPE_40GBASE_KR4
case|:
case|case
name|I40E_PHY_TYPE_20GBASE_KR2
case|:
name|media
operator|=
name|I40E_MEDIA_TYPE_BACKPLANE
expr_stmt|;
break|break;
case|case
name|I40E_PHY_TYPE_SGMII
case|:
case|case
name|I40E_PHY_TYPE_XAUI
case|:
case|case
name|I40E_PHY_TYPE_XFI
case|:
case|case
name|I40E_PHY_TYPE_XLAUI
case|:
case|case
name|I40E_PHY_TYPE_XLPPI
case|:
default|default:
name|media
operator|=
name|I40E_MEDIA_TYPE_UNKNOWN
expr_stmt|;
break|break;
block|}
return|return
name|media
return|;
block|}
end_function

begin_define
define|#
directive|define
name|I40E_PF_RESET_WAIT_COUNT
value|200
end_define

begin_comment
comment|/**  * i40e_pf_reset - Reset the PF  * @hw: pointer to the hardware structure  *  * Assuming someone else has triggered a global reset,  * assure the global reset is complete and then reset the PF  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_pf_reset
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|u32
name|cnt
init|=
literal|0
decl_stmt|;
name|u32
name|cnt1
init|=
literal|0
decl_stmt|;
name|u32
name|reg
init|=
literal|0
decl_stmt|;
name|u32
name|grst_del
decl_stmt|;
comment|/* Poll for Global Reset steady state in case of recent GRST. 	 * The grst delay value is in 100ms units, and we'll wait a 	 * couple counts longer to be sure we don't just miss the end. 	 */
name|grst_del
operator|=
operator|(
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLGEN_RSTCTL
argument_list|)
operator|&
name|I40E_GLGEN_RSTCTL_GRSTDEL_MASK
operator|)
operator|>>
name|I40E_GLGEN_RSTCTL_GRSTDEL_SHIFT
expr_stmt|;
for|for
control|(
name|cnt
operator|=
literal|0
init|;
name|cnt
operator|<
name|grst_del
operator|+
literal|10
condition|;
name|cnt
operator|++
control|)
block|{
name|reg
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLGEN_RSTAT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|reg
operator|&
name|I40E_GLGEN_RSTAT_DEVSTATE_MASK
operator|)
condition|)
break|break;
name|i40e_msec_delay
argument_list|(
literal|100
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|reg
operator|&
name|I40E_GLGEN_RSTAT_DEVSTATE_MASK
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"Global reset polling failed to complete.\n"
argument_list|)
expr_stmt|;
return|return
name|I40E_ERR_RESET_FAILED
return|;
block|}
comment|/* Now Wait for the FW to be ready */
for|for
control|(
name|cnt1
operator|=
literal|0
init|;
name|cnt1
operator|<
name|I40E_PF_RESET_WAIT_COUNT
condition|;
name|cnt1
operator|++
control|)
block|{
name|reg
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLNVM_ULD
argument_list|)
expr_stmt|;
name|reg
operator|&=
operator|(
name|I40E_GLNVM_ULD_CONF_CORE_DONE_MASK
operator||
name|I40E_GLNVM_ULD_CONF_GLOBAL_DONE_MASK
operator|)
expr_stmt|;
if|if
condition|(
name|reg
operator|==
operator|(
name|I40E_GLNVM_ULD_CONF_CORE_DONE_MASK
operator||
name|I40E_GLNVM_ULD_CONF_GLOBAL_DONE_MASK
operator|)
condition|)
block|{
name|DEBUGOUT1
argument_list|(
literal|"Core and Global modules ready %d\n"
argument_list|,
name|cnt1
argument_list|)
expr_stmt|;
break|break;
block|}
name|i40e_msec_delay
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|reg
operator|&
operator|(
name|I40E_GLNVM_ULD_CONF_CORE_DONE_MASK
operator||
name|I40E_GLNVM_ULD_CONF_GLOBAL_DONE_MASK
operator|)
operator|)
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"wait for FW Reset complete timedout\n"
argument_list|)
expr_stmt|;
name|DEBUGOUT1
argument_list|(
literal|"I40E_GLNVM_ULD = 0x%x\n"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
return|return
name|I40E_ERR_RESET_FAILED
return|;
block|}
comment|/* If there was a Global Reset in progress when we got here, 	 * we don't need to do the PF Reset 	 */
if|if
condition|(
operator|!
name|cnt
condition|)
block|{
name|reg
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PFGEN_CTRL
argument_list|)
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_PFGEN_CTRL
argument_list|,
operator|(
name|reg
operator||
name|I40E_PFGEN_CTRL_PFSWR_MASK
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|cnt
operator|=
literal|0
init|;
name|cnt
operator|<
name|I40E_PF_RESET_WAIT_COUNT
condition|;
name|cnt
operator|++
control|)
block|{
name|reg
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PFGEN_CTRL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|reg
operator|&
name|I40E_PFGEN_CTRL_PFSWR_MASK
operator|)
condition|)
break|break;
name|i40e_msec_delay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|reg
operator|&
name|I40E_PFGEN_CTRL_PFSWR_MASK
condition|)
block|{
name|DEBUGOUT
argument_list|(
literal|"PF reset polling failed to complete.\n"
argument_list|)
expr_stmt|;
return|return
name|I40E_ERR_RESET_FAILED
return|;
block|}
block|}
name|i40e_clear_pxe_mode
argument_list|(
name|hw
argument_list|)
expr_stmt|;
return|return
name|I40E_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_clear_hw - clear out any left over hw state  * @hw: pointer to the hw struct  *  * Clear queues and interrupts, typically called at init time,  * but after the capabilities have been found so we know how many  * queues and msix vectors have been allocated.  **/
end_comment

begin_function
name|void
name|i40e_clear_hw
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|u32
name|num_queues
decl_stmt|,
name|base_queue
decl_stmt|;
name|u32
name|num_pf_int
decl_stmt|;
name|u32
name|num_vf_int
decl_stmt|;
name|u32
name|num_vfs
decl_stmt|;
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|;
name|u32
name|val
decl_stmt|;
name|u32
name|eol
init|=
literal|0x7ff
decl_stmt|;
comment|/* get number of interrupts, queues, and vfs */
name|val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLPCI_CNF2
argument_list|)
expr_stmt|;
name|num_pf_int
operator|=
operator|(
name|val
operator|&
name|I40E_GLPCI_CNF2_MSI_X_PF_N_MASK
operator|)
operator|>>
name|I40E_GLPCI_CNF2_MSI_X_PF_N_SHIFT
expr_stmt|;
name|num_vf_int
operator|=
operator|(
name|val
operator|&
name|I40E_GLPCI_CNF2_MSI_X_VF_N_MASK
operator|)
operator|>>
name|I40E_GLPCI_CNF2_MSI_X_VF_N_SHIFT
expr_stmt|;
name|val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PFLAN_QALLOC
argument_list|)
expr_stmt|;
name|base_queue
operator|=
operator|(
name|val
operator|&
name|I40E_PFLAN_QALLOC_FIRSTQ_MASK
operator|)
operator|>>
name|I40E_PFLAN_QALLOC_FIRSTQ_SHIFT
expr_stmt|;
name|j
operator|=
operator|(
name|val
operator|&
name|I40E_PFLAN_QALLOC_LASTQ_MASK
operator|)
operator|>>
name|I40E_PFLAN_QALLOC_LASTQ_SHIFT
expr_stmt|;
if|if
condition|(
name|val
operator|&
name|I40E_PFLAN_QALLOC_VALID_MASK
condition|)
name|num_queues
operator|=
operator|(
name|j
operator|-
name|base_queue
operator|)
operator|+
literal|1
expr_stmt|;
else|else
name|num_queues
operator|=
literal|0
expr_stmt|;
name|val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PF_VT_PFALLOC
argument_list|)
expr_stmt|;
name|i
operator|=
operator|(
name|val
operator|&
name|I40E_PF_VT_PFALLOC_FIRSTVF_MASK
operator|)
operator|>>
name|I40E_PF_VT_PFALLOC_FIRSTVF_SHIFT
expr_stmt|;
name|j
operator|=
operator|(
name|val
operator|&
name|I40E_PF_VT_PFALLOC_LASTVF_MASK
operator|)
operator|>>
name|I40E_PF_VT_PFALLOC_LASTVF_SHIFT
expr_stmt|;
if|if
condition|(
name|val
operator|&
name|I40E_PF_VT_PFALLOC_VALID_MASK
condition|)
name|num_vfs
operator|=
operator|(
name|j
operator|-
name|i
operator|)
operator|+
literal|1
expr_stmt|;
else|else
name|num_vfs
operator|=
literal|0
expr_stmt|;
comment|/* stop all the interrupts */
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_PFINT_ICR0_ENA
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|val
operator|=
literal|0x3
operator|<<
name|I40E_PFINT_DYN_CTLN_ITR_INDX_SHIFT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_pf_int
operator|-
literal|2
condition|;
name|i
operator|++
control|)
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_PFINT_DYN_CTLN
argument_list|(
name|i
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
comment|/* Set the FIRSTQ_INDX field to 0x7FF in PFINT_LNKLSTx */
name|val
operator|=
name|eol
operator|<<
name|I40E_PFINT_LNKLST0_FIRSTQ_INDX_SHIFT
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_PFINT_LNKLST0
argument_list|,
name|val
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_pf_int
operator|-
literal|2
condition|;
name|i
operator|++
control|)
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_PFINT_LNKLSTN
argument_list|(
name|i
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|val
operator|=
name|eol
operator|<<
name|I40E_VPINT_LNKLST0_FIRSTQ_INDX_SHIFT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_vfs
condition|;
name|i
operator|++
control|)
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_VPINT_LNKLST0
argument_list|(
name|i
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_vf_int
operator|-
literal|2
condition|;
name|i
operator|++
control|)
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_VPINT_LNKLSTN
argument_list|(
name|i
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
comment|/* warn the HW of the coming Tx disables */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_queues
condition|;
name|i
operator|++
control|)
block|{
name|u32
name|abs_queue_idx
init|=
name|base_queue
operator|+
name|i
decl_stmt|;
name|u32
name|reg_block
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|abs_queue_idx
operator|>=
literal|128
condition|)
block|{
name|reg_block
operator|=
name|abs_queue_idx
operator|/
literal|128
expr_stmt|;
name|abs_queue_idx
operator|%=
literal|128
expr_stmt|;
block|}
name|val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLLAN_TXPRE_QDIS
argument_list|(
name|reg_block
argument_list|)
argument_list|)
expr_stmt|;
name|val
operator|&=
operator|~
name|I40E_GLLAN_TXPRE_QDIS_QINDX_MASK
expr_stmt|;
name|val
operator||=
operator|(
name|abs_queue_idx
operator|<<
name|I40E_GLLAN_TXPRE_QDIS_QINDX_SHIFT
operator|)
expr_stmt|;
name|val
operator||=
name|I40E_GLLAN_TXPRE_QDIS_SET_QDIS_MASK
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_GLLAN_TXPRE_QDIS
argument_list|(
name|reg_block
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
name|i40e_usec_delay
argument_list|(
literal|400
argument_list|)
expr_stmt|;
comment|/* stop all the queues */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_queues
condition|;
name|i
operator|++
control|)
block|{
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_QINT_TQCTL
argument_list|(
name|i
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_QTX_ENA
argument_list|(
name|i
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_QINT_RQCTL
argument_list|(
name|i
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_QRX_ENA
argument_list|(
name|i
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* short wait for all queue disables to settle */
name|i40e_usec_delay
argument_list|(
literal|50
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * i40e_clear_pxe_mode - clear pxe operations mode  * @hw: pointer to the hw struct  *  * Make sure all PXE mode settings are cleared, including things  * like descriptor fetch/write-back mode.  **/
end_comment

begin_function
name|void
name|i40e_clear_pxe_mode
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
if|if
condition|(
name|i40e_check_asq_alive
argument_list|(
name|hw
argument_list|)
condition|)
name|i40e_aq_clear_pxe_mode
argument_list|(
name|hw
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * i40e_led_is_mine - helper to find matching led  * @hw: pointer to the hw struct  * @idx: index into GPIO registers  *  * returns: 0 if no match, otherwise the value of the GPIO_CTL register  */
end_comment

begin_function
specifier|static
name|u32
name|i40e_led_is_mine
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|int
name|idx
parameter_list|)
block|{
name|u32
name|gpio_val
init|=
literal|0
decl_stmt|;
name|u32
name|port
decl_stmt|;
if|if
condition|(
operator|!
name|hw
operator|->
name|func_caps
operator|.
name|led
index|[
name|idx
index|]
condition|)
return|return
literal|0
return|;
name|gpio_val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLGEN_GPIO_CTL
argument_list|(
name|idx
argument_list|)
argument_list|)
expr_stmt|;
name|port
operator|=
operator|(
name|gpio_val
operator|&
name|I40E_GLGEN_GPIO_CTL_PRT_NUM_MASK
operator|)
operator|>>
name|I40E_GLGEN_GPIO_CTL_PRT_NUM_SHIFT
expr_stmt|;
comment|/* if PRT_NUM_NA is 1 then this LED is not port specific, OR 	 * if it is not our port then ignore 	 */
if|if
condition|(
operator|(
name|gpio_val
operator|&
name|I40E_GLGEN_GPIO_CTL_PRT_NUM_NA_MASK
operator|)
operator|||
operator|(
name|port
operator|!=
name|hw
operator|->
name|port
operator|)
condition|)
return|return
literal|0
return|;
return|return
name|gpio_val
return|;
block|}
end_function

begin_define
define|#
directive|define
name|I40E_COMBINED_ACTIVITY
value|0xA
end_define

begin_define
define|#
directive|define
name|I40E_FILTER_ACTIVITY
value|0xE
end_define

begin_define
define|#
directive|define
name|I40E_LINK_ACTIVITY
value|0xC
end_define

begin_define
define|#
directive|define
name|I40E_MAC_ACTIVITY
value|0xD
end_define

begin_define
define|#
directive|define
name|I40E_LED0
value|22
end_define

begin_comment
comment|/**  * i40e_led_get - return current on/off mode  * @hw: pointer to the hw struct  *  * The value returned is the 'mode' field as defined in the  * GPIO register definitions: 0x0 = off, 0xf = on, and other  * values are variations of possible behaviors relating to  * blink, link, and wire.  **/
end_comment

begin_function
name|u32
name|i40e_led_get
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|u32
name|current_mode
init|=
literal|0
decl_stmt|;
name|u32
name|mode
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* as per the documentation GPIO 22-29 are the LED 	 * GPIO pins named LED0..LED7 	 */
for|for
control|(
name|i
operator|=
name|I40E_LED0
init|;
name|i
operator|<=
name|I40E_GLGEN_GPIO_CTL_MAX_INDEX
condition|;
name|i
operator|++
control|)
block|{
name|u32
name|gpio_val
init|=
name|i40e_led_is_mine
argument_list|(
name|hw
argument_list|,
name|i
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|gpio_val
condition|)
continue|continue;
comment|/* ignore gpio LED src mode entries related to the activity 		 *  LEDs 		 */
name|current_mode
operator|=
operator|(
operator|(
name|gpio_val
operator|&
name|I40E_GLGEN_GPIO_CTL_LED_MODE_MASK
operator|)
operator|>>
name|I40E_GLGEN_GPIO_CTL_LED_MODE_SHIFT
operator|)
expr_stmt|;
switch|switch
condition|(
name|current_mode
condition|)
block|{
case|case
name|I40E_COMBINED_ACTIVITY
case|:
case|case
name|I40E_FILTER_ACTIVITY
case|:
case|case
name|I40E_MAC_ACTIVITY
case|:
continue|continue;
default|default:
break|break;
block|}
name|mode
operator|=
operator|(
name|gpio_val
operator|&
name|I40E_GLGEN_GPIO_CTL_LED_MODE_MASK
operator|)
operator|>>
name|I40E_GLGEN_GPIO_CTL_LED_MODE_SHIFT
expr_stmt|;
break|break;
block|}
return|return
name|mode
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_led_set - set new on/off mode  * @hw: pointer to the hw struct  * @mode: 0=off, 0xf=on (else see manual for mode details)  * @blink: TRUE if the LED should blink when on, FALSE if steady  *  * if this function is used to turn on the blink it should  * be used to disable the blink when restoring the original state.  **/
end_comment

begin_function
name|void
name|i40e_led_set
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|mode
parameter_list|,
name|bool
name|blink
parameter_list|)
block|{
name|u32
name|current_mode
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|mode
operator|&
literal|0xfffffff0
condition|)
name|DEBUGOUT1
argument_list|(
literal|"invalid mode passed in %X\n"
argument_list|,
name|mode
argument_list|)
expr_stmt|;
comment|/* as per the documentation GPIO 22-29 are the LED 	 * GPIO pins named LED0..LED7 	 */
for|for
control|(
name|i
operator|=
name|I40E_LED0
init|;
name|i
operator|<=
name|I40E_GLGEN_GPIO_CTL_MAX_INDEX
condition|;
name|i
operator|++
control|)
block|{
name|u32
name|gpio_val
init|=
name|i40e_led_is_mine
argument_list|(
name|hw
argument_list|,
name|i
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|gpio_val
condition|)
continue|continue;
comment|/* ignore gpio LED src mode entries related to the activity 		 * LEDs 		 */
name|current_mode
operator|=
operator|(
operator|(
name|gpio_val
operator|&
name|I40E_GLGEN_GPIO_CTL_LED_MODE_MASK
operator|)
operator|>>
name|I40E_GLGEN_GPIO_CTL_LED_MODE_SHIFT
operator|)
expr_stmt|;
switch|switch
condition|(
name|current_mode
condition|)
block|{
case|case
name|I40E_COMBINED_ACTIVITY
case|:
case|case
name|I40E_FILTER_ACTIVITY
case|:
case|case
name|I40E_MAC_ACTIVITY
case|:
continue|continue;
default|default:
break|break;
block|}
name|gpio_val
operator|&=
operator|~
name|I40E_GLGEN_GPIO_CTL_LED_MODE_MASK
expr_stmt|;
comment|/* this& is a bit of paranoia, but serves as a range check */
name|gpio_val
operator||=
operator|(
operator|(
name|mode
operator|<<
name|I40E_GLGEN_GPIO_CTL_LED_MODE_SHIFT
operator|)
operator|&
name|I40E_GLGEN_GPIO_CTL_LED_MODE_MASK
operator|)
expr_stmt|;
if|if
condition|(
name|mode
operator|==
name|I40E_LINK_ACTIVITY
condition|)
name|blink
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|blink
condition|)
name|gpio_val
operator||=
name|BIT
argument_list|(
name|I40E_GLGEN_GPIO_CTL_LED_BLINK_SHIFT
argument_list|)
expr_stmt|;
else|else
name|gpio_val
operator|&=
operator|~
name|BIT
argument_list|(
name|I40E_GLGEN_GPIO_CTL_LED_BLINK_SHIFT
argument_list|)
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_GLGEN_GPIO_CTL
argument_list|(
name|i
argument_list|)
argument_list|,
name|gpio_val
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/* Admin command wrappers */
end_comment

begin_comment
comment|/**  * i40e_aq_get_phy_capabilities  * @hw: pointer to the hw struct  * @abilities: structure for PHY capabilities to be filled  * @qualified_modules: report Qualified Modules  * @report_init: report init capabilities (active are default)  * @cmd_details: pointer to command details structure or NULL  *  * Returns the various PHY abilities supported on the Port.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_phy_capabilities
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|qualified_modules
parameter_list|,
name|bool
name|report_init
parameter_list|,
name|struct
name|i40e_aq_get_phy_abilities_resp
modifier|*
name|abilities
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|abilities_size
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|i40e_aq_get_phy_abilities_resp
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|abilities
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_phy_abilities
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|abilities_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
if|if
condition|(
name|qualified_modules
condition|)
name|desc
operator|.
name|params
operator|.
name|external
operator|.
name|param0
operator||=
name|CPU_TO_LE32
argument_list|(
name|I40E_AQ_PHY_REPORT_QUALIFIED_MODULES
argument_list|)
expr_stmt|;
if|if
condition|(
name|report_init
condition|)
name|desc
operator|.
name|params
operator|.
name|external
operator|.
name|param0
operator||=
name|CPU_TO_LE32
argument_list|(
name|I40E_AQ_PHY_REPORT_INITIAL_VALUES
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|abilities
argument_list|,
name|abilities_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|hw
operator|->
name|aq
operator|.
name|asq_last_status
operator|==
name|I40E_AQ_RC_EIO
condition|)
name|status
operator|=
name|I40E_ERR_UNKNOWN_PHY
expr_stmt|;
if|if
condition|(
name|report_init
condition|)
name|hw
operator|->
name|phy
operator|.
name|phy_types
operator|=
name|LE32_TO_CPU
argument_list|(
name|abilities
operator|->
name|phy_type
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_phy_config  * @hw: pointer to the hw struct  * @config: structure with PHY configuration to be set  * @cmd_details: pointer to command details structure or NULL  *  * Set the various PHY configuration parameters  * supported on the Port.One or more of the Set PHY config parameters may be  * ignored in an MFP mode as the PF may not have the privilege to set some  * of the PHY Config parameters. This status will be indicated by the  * command response.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_phy_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_aq_set_phy_config
modifier|*
name|config
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aq_set_phy_config
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aq_set_phy_config
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
operator|!
name|config
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_phy_config
argument_list|)
expr_stmt|;
operator|*
name|cmd
operator|=
operator|*
name|config
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_set_fc  * @hw: pointer to the hw struct  *  * Set the requested flow control mode using set_phy_config.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_set_fc
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
modifier|*
name|aq_failures
parameter_list|,
name|bool
name|atomic_restart
parameter_list|)
block|{
name|enum
name|i40e_fc_mode
name|fc_mode
init|=
name|hw
operator|->
name|fc
operator|.
name|requested_mode
decl_stmt|;
name|struct
name|i40e_aq_get_phy_abilities_resp
name|abilities
decl_stmt|;
name|struct
name|i40e_aq_set_phy_config
name|config
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u8
name|pause_mask
init|=
literal|0x0
decl_stmt|;
operator|*
name|aq_failures
operator|=
literal|0x0
expr_stmt|;
switch|switch
condition|(
name|fc_mode
condition|)
block|{
case|case
name|I40E_FC_FULL
case|:
name|pause_mask
operator||=
name|I40E_AQ_PHY_FLAG_PAUSE_TX
expr_stmt|;
name|pause_mask
operator||=
name|I40E_AQ_PHY_FLAG_PAUSE_RX
expr_stmt|;
break|break;
case|case
name|I40E_FC_RX_PAUSE
case|:
name|pause_mask
operator||=
name|I40E_AQ_PHY_FLAG_PAUSE_RX
expr_stmt|;
break|break;
case|case
name|I40E_FC_TX_PAUSE
case|:
name|pause_mask
operator||=
name|I40E_AQ_PHY_FLAG_PAUSE_TX
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* Get the current phy config */
name|status
operator|=
name|i40e_aq_get_phy_capabilities
argument_list|(
name|hw
argument_list|,
name|FALSE
argument_list|,
name|false
argument_list|,
operator|&
name|abilities
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
block|{
operator|*
name|aq_failures
operator||=
name|I40E_SET_FC_AQ_FAIL_GET
expr_stmt|;
return|return
name|status
return|;
block|}
name|memset
argument_list|(
operator|&
name|config
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|config
argument_list|)
argument_list|)
expr_stmt|;
comment|/* clear the old pause settings */
name|config
operator|.
name|abilities
operator|=
name|abilities
operator|.
name|abilities
operator|&
operator|~
operator|(
name|I40E_AQ_PHY_FLAG_PAUSE_TX
operator|)
operator|&
operator|~
operator|(
name|I40E_AQ_PHY_FLAG_PAUSE_RX
operator|)
expr_stmt|;
comment|/* set the new abilities */
name|config
operator|.
name|abilities
operator||=
name|pause_mask
expr_stmt|;
comment|/* If the abilities have changed, then set the new config */
if|if
condition|(
name|config
operator|.
name|abilities
operator|!=
name|abilities
operator|.
name|abilities
condition|)
block|{
comment|/* Auto restart link so settings take effect */
if|if
condition|(
name|atomic_restart
condition|)
name|config
operator|.
name|abilities
operator||=
name|I40E_AQ_PHY_ENABLE_ATOMIC_LINK
expr_stmt|;
comment|/* Copy over all the old settings */
name|config
operator|.
name|phy_type
operator|=
name|abilities
operator|.
name|phy_type
expr_stmt|;
name|config
operator|.
name|link_speed
operator|=
name|abilities
operator|.
name|link_speed
expr_stmt|;
name|config
operator|.
name|eee_capability
operator|=
name|abilities
operator|.
name|eee_capability
expr_stmt|;
name|config
operator|.
name|eeer
operator|=
name|abilities
operator|.
name|eeer_val
expr_stmt|;
name|config
operator|.
name|low_power_ctrl
operator|=
name|abilities
operator|.
name|d3_lpan
expr_stmt|;
name|status
operator|=
name|i40e_aq_set_phy_config
argument_list|(
name|hw
argument_list|,
operator|&
name|config
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
operator|*
name|aq_failures
operator||=
name|I40E_SET_FC_AQ_FAIL_SET
expr_stmt|;
block|}
comment|/* Update the link info */
name|status
operator|=
name|i40e_update_link_info
argument_list|(
name|hw
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
block|{
comment|/* Wait a little bit (on 40G cards it sometimes takes a really 		 * long time for link to come back from the atomic reset) 		 * and try once more 		 */
name|i40e_msec_delay
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_update_link_info
argument_list|(
name|hw
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
condition|)
operator|*
name|aq_failures
operator||=
name|I40E_SET_FC_AQ_FAIL_UPDATE
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_mac_config  * @hw: pointer to the hw struct  * @max_frame_size: Maximum Frame Size to be supported by the port  * @crc_en: Tell HW to append a CRC to outgoing frames  * @pacing: Pacing configurations  * @cmd_details: pointer to command details structure or NULL  *  * Configure MAC settings for frame size, jumbo frame support and the  * addition of a CRC by the hardware.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_mac_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|max_frame_size
parameter_list|,
name|bool
name|crc_en
parameter_list|,
name|u16
name|pacing
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aq_set_mac_config
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aq_set_mac_config
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|max_frame_size
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_mac_config
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|max_frame_size
operator|=
name|CPU_TO_LE16
argument_list|(
name|max_frame_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|params
operator|=
operator|(
operator|(
name|u8
operator|)
name|pacing
operator|&
literal|0x0F
operator|)
operator|<<
literal|3
expr_stmt|;
if|if
condition|(
name|crc_en
condition|)
name|cmd
operator|->
name|params
operator||=
name|I40E_AQ_SET_MAC_CONFIG_CRC_EN
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_clear_pxe_mode  * @hw: pointer to the hw struct  * @cmd_details: pointer to command details structure or NULL  *  * Tell the firmware that the driver is taking over from PXE  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_clear_pxe_mode
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_clear_pxe
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_clear_pxe
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_clear_pxe_mode
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|rx_cnt
operator|=
literal|0x2
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_GLLAN_RCTL_0
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_link_restart_an  * @hw: pointer to the hw struct  * @enable_link: if TRUE: enable link, if FALSE: disable link  * @cmd_details: pointer to command details structure or NULL  *  * Sets up the link and restarts the Auto-Negotiation over the link.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_link_restart_an
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|enable_link
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_link_restart_an
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_link_restart_an
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_link_restart_an
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|command
operator|=
name|I40E_AQ_PHY_RESTART_AN
expr_stmt|;
if|if
condition|(
name|enable_link
condition|)
name|cmd
operator|->
name|command
operator||=
name|I40E_AQ_PHY_LINK_ENABLE
expr_stmt|;
else|else
name|cmd
operator|->
name|command
operator|&=
operator|~
name|I40E_AQ_PHY_LINK_ENABLE
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_link_info  * @hw: pointer to the hw struct  * @enable_lse: enable/disable LinkStatusEvent reporting  * @link: pointer to link status structure - optional  * @cmd_details: pointer to command details structure or NULL  *  * Returns the link status of the adapter.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_link_info
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|enable_lse
parameter_list|,
name|struct
name|i40e_link_status
modifier|*
name|link
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_get_link_status
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_get_link_status
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_link_status
modifier|*
name|hw_link_info
init|=
operator|&
name|hw
operator|->
name|phy
operator|.
name|link_info
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|bool
name|tx_pause
decl_stmt|,
name|rx_pause
decl_stmt|;
name|u16
name|command_flags
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_link_status
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable_lse
condition|)
name|command_flags
operator|=
name|I40E_AQ_LSE_ENABLE
expr_stmt|;
else|else
name|command_flags
operator|=
name|I40E_AQ_LSE_DISABLE
expr_stmt|;
name|resp
operator|->
name|command_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|command_flags
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
goto|goto
name|aq_get_link_info_exit
goto|;
comment|/* save off old link status information */
name|i40e_memcpy
argument_list|(
operator|&
name|hw
operator|->
name|phy
operator|.
name|link_info_old
argument_list|,
name|hw_link_info
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|hw_link_info
argument_list|)
argument_list|,
name|I40E_NONDMA_TO_NONDMA
argument_list|)
expr_stmt|;
comment|/* update link status */
name|hw_link_info
operator|->
name|phy_type
operator|=
operator|(
expr|enum
name|i40e_aq_phy_type
operator|)
name|resp
operator|->
name|phy_type
expr_stmt|;
name|hw
operator|->
name|phy
operator|.
name|media_type
operator|=
name|i40e_get_media_type
argument_list|(
name|hw
argument_list|)
expr_stmt|;
name|hw_link_info
operator|->
name|link_speed
operator|=
operator|(
expr|enum
name|i40e_aq_link_speed
operator|)
name|resp
operator|->
name|link_speed
expr_stmt|;
name|hw_link_info
operator|->
name|link_info
operator|=
name|resp
operator|->
name|link_info
expr_stmt|;
name|hw_link_info
operator|->
name|an_info
operator|=
name|resp
operator|->
name|an_info
expr_stmt|;
name|hw_link_info
operator|->
name|ext_info
operator|=
name|resp
operator|->
name|ext_info
expr_stmt|;
name|hw_link_info
operator|->
name|loopback
operator|=
name|resp
operator|->
name|loopback
expr_stmt|;
name|hw_link_info
operator|->
name|max_frame_size
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|max_frame_size
argument_list|)
expr_stmt|;
name|hw_link_info
operator|->
name|pacing
operator|=
name|resp
operator|->
name|config
operator|&
name|I40E_AQ_CONFIG_PACING_MASK
expr_stmt|;
comment|/* update fc info */
name|tx_pause
operator|=
operator|!
operator|!
operator|(
name|resp
operator|->
name|an_info
operator|&
name|I40E_AQ_LINK_PAUSE_TX
operator|)
expr_stmt|;
name|rx_pause
operator|=
operator|!
operator|!
operator|(
name|resp
operator|->
name|an_info
operator|&
name|I40E_AQ_LINK_PAUSE_RX
operator|)
expr_stmt|;
if|if
condition|(
name|tx_pause
operator|&
name|rx_pause
condition|)
name|hw
operator|->
name|fc
operator|.
name|current_mode
operator|=
name|I40E_FC_FULL
expr_stmt|;
elseif|else
if|if
condition|(
name|tx_pause
condition|)
name|hw
operator|->
name|fc
operator|.
name|current_mode
operator|=
name|I40E_FC_TX_PAUSE
expr_stmt|;
elseif|else
if|if
condition|(
name|rx_pause
condition|)
name|hw
operator|->
name|fc
operator|.
name|current_mode
operator|=
name|I40E_FC_RX_PAUSE
expr_stmt|;
else|else
name|hw
operator|->
name|fc
operator|.
name|current_mode
operator|=
name|I40E_FC_NONE
expr_stmt|;
if|if
condition|(
name|resp
operator|->
name|config
operator|&
name|I40E_AQ_CONFIG_CRC_ENA
condition|)
name|hw_link_info
operator|->
name|crc_enable
operator|=
name|TRUE
expr_stmt|;
else|else
name|hw_link_info
operator|->
name|crc_enable
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|resp
operator|->
name|command_flags
operator|&
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_LSE_ENABLE
argument_list|)
condition|)
name|hw_link_info
operator|->
name|lse_enable
operator|=
name|TRUE
expr_stmt|;
else|else
name|hw_link_info
operator|->
name|lse_enable
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
name|hw
operator|->
name|aq
operator|.
name|fw_maj_ver
operator|<
literal|4
operator|||
operator|(
name|hw
operator|->
name|aq
operator|.
name|fw_maj_ver
operator|==
literal|4
operator|&&
name|hw
operator|->
name|aq
operator|.
name|fw_min_ver
operator|<
literal|40
operator|)
operator|)
operator|&&
name|hw_link_info
operator|->
name|phy_type
operator|==
literal|0xE
condition|)
name|hw_link_info
operator|->
name|phy_type
operator|=
name|I40E_PHY_TYPE_10GBASE_SFPP_CU
expr_stmt|;
comment|/* save link status information */
if|if
condition|(
name|link
condition|)
name|i40e_memcpy
argument_list|(
name|link
argument_list|,
name|hw_link_info
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|hw_link_info
argument_list|)
argument_list|,
name|I40E_NONDMA_TO_NONDMA
argument_list|)
expr_stmt|;
comment|/* flag cleared so helper functions don't call AQ again */
name|hw
operator|->
name|phy
operator|.
name|get_link_info
operator|=
name|FALSE
expr_stmt|;
name|aq_get_link_info_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_phy_int_mask  * @hw: pointer to the hw struct  * @mask: interrupt mask to be set  * @cmd_details: pointer to command details structure or NULL  *  * Set link interrupt mask.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_phy_int_mask
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|mask
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_phy_int_mask
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_phy_int_mask
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_phy_int_mask
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|event_mask
operator|=
name|CPU_TO_LE16
argument_list|(
name|mask
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_local_advt_reg  * @hw: pointer to the hw struct  * @advt_reg: local AN advertisement register value  * @cmd_details: pointer to command details structure or NULL  *  * Get the Local AN advertisement register value.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_local_advt_reg
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u64
modifier|*
name|advt_reg
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_an_advt_reg
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_an_advt_reg
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_local_advt_reg
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
goto|goto
name|aq_get_local_advt_reg_exit
goto|;
operator|*
name|advt_reg
operator|=
call|(
name|u64
call|)
argument_list|(
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|local_an_reg1
argument_list|)
argument_list|)
operator|<<
literal|32
expr_stmt|;
operator|*
name|advt_reg
operator||=
name|LE32_TO_CPU
argument_list|(
name|resp
operator|->
name|local_an_reg0
argument_list|)
expr_stmt|;
name|aq_get_local_advt_reg_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_local_advt_reg  * @hw: pointer to the hw struct  * @advt_reg: local AN advertisement register value  * @cmd_details: pointer to command details structure or NULL  *  * Get the Local AN advertisement register value.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_local_advt_reg
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u64
name|advt_reg
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_an_advt_reg
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_an_advt_reg
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_local_advt_reg
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|local_an_reg0
operator|=
name|CPU_TO_LE32
argument_list|(
name|I40E_LO_DWORD
argument_list|(
name|advt_reg
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|local_an_reg1
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_HI_DWORD
argument_list|(
name|advt_reg
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_partner_advt  * @hw: pointer to the hw struct  * @advt_reg: AN partner advertisement register value  * @cmd_details: pointer to command details structure or NULL  *  * Get the link partner AN advertisement register value.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_partner_advt
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u64
modifier|*
name|advt_reg
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_an_advt_reg
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_an_advt_reg
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_partner_advt
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
goto|goto
name|aq_get_partner_advt_exit
goto|;
operator|*
name|advt_reg
operator|=
call|(
name|u64
call|)
argument_list|(
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|local_an_reg1
argument_list|)
argument_list|)
operator|<<
literal|32
expr_stmt|;
operator|*
name|advt_reg
operator||=
name|LE32_TO_CPU
argument_list|(
name|resp
operator|->
name|local_an_reg0
argument_list|)
expr_stmt|;
name|aq_get_partner_advt_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_lb_modes  * @hw: pointer to the hw struct  * @lb_modes: loopback mode to be set  * @cmd_details: pointer to command details structure or NULL  *  * Sets loopback modes.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_lb_modes
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|lb_modes
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_lb_mode
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_lb_mode
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_lb_modes
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|lb_mode
operator|=
name|CPU_TO_LE16
argument_list|(
name|lb_modes
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_phy_debug  * @hw: pointer to the hw struct  * @cmd_flags: debug command flags  * @cmd_details: pointer to command details structure or NULL  *  * Reset the external PHY.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_phy_debug
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|cmd_flags
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_phy_debug
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_phy_debug
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_phy_debug
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|command_flags
operator|=
name|cmd_flags
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_vsi  * @hw: pointer to the hw struct  * @vsi_ctx: pointer to a vsi context struct  * @cmd_details: pointer to command details structure or NULL  *  * Add a VSI context to the hardware. **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_vsi
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_vsi_context
modifier|*
name|vsi_ctx
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_get_update_vsi
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_get_update_vsi
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_get_update_vsi_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_get_update_vsi_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_vsi
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|uplink_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_ctx
operator|->
name|uplink_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|connection_type
operator|=
name|vsi_ctx
operator|->
name|connection_type
expr_stmt|;
name|cmd
operator|->
name|vf_id
operator|=
name|vsi_ctx
operator|->
name|vf_num
expr_stmt|;
name|cmd
operator|->
name|vsi_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_ctx
operator|->
name|flags
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
operator|&
name|vsi_ctx
operator|->
name|info
argument_list|,
sizeof|sizeof
argument_list|(
name|vsi_ctx
operator|->
name|info
argument_list|)
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
goto|goto
name|aq_add_vsi_exit
goto|;
name|vsi_ctx
operator|->
name|seid
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|seid
argument_list|)
expr_stmt|;
name|vsi_ctx
operator|->
name|vsi_number
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|vsi_number
argument_list|)
expr_stmt|;
name|vsi_ctx
operator|->
name|vsis_allocated
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|vsi_used
argument_list|)
expr_stmt|;
name|vsi_ctx
operator|->
name|vsis_unallocated
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|vsi_free
argument_list|)
expr_stmt|;
name|aq_add_vsi_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_default_vsi  * @hw: pointer to the hw struct  * @seid: vsi number  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_default_vsi
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_vsi_promiscuous_modes
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_vsi_promiscuous_modes
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_vsi_promiscuous_modes
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|promiscuous_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_DEFAULT
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|valid_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_DEFAULT
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_vsi_unicast_promiscuous  * @hw: pointer to the hw struct  * @seid: vsi number  * @set: set unicast promiscuous enable/disable  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_vsi_unicast_promiscuous
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|bool
name|set
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_vsi_promiscuous_modes
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_vsi_promiscuous_modes
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|flags
init|=
literal|0
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_vsi_promiscuous_modes
argument_list|)
expr_stmt|;
if|if
condition|(
name|set
condition|)
name|flags
operator||=
name|I40E_AQC_SET_VSI_PROMISC_UNICAST
expr_stmt|;
name|cmd
operator|->
name|promiscuous_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|valid_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_PROMISC_UNICAST
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_vsi_multicast_promiscuous  * @hw: pointer to the hw struct  * @seid: vsi number  * @set: set multicast promiscuous enable/disable  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_vsi_multicast_promiscuous
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|bool
name|set
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_vsi_promiscuous_modes
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_vsi_promiscuous_modes
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|flags
init|=
literal|0
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_vsi_promiscuous_modes
argument_list|)
expr_stmt|;
if|if
condition|(
name|set
condition|)
name|flags
operator||=
name|I40E_AQC_SET_VSI_PROMISC_MULTICAST
expr_stmt|;
name|cmd
operator|->
name|promiscuous_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|valid_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_PROMISC_MULTICAST
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_vsi_mc_promisc_on_vlan  * @hw: pointer to the hw struct  * @seid: vsi number  * @enable: set MAC L2 layer unicast promiscuous enable/disable for a given VLAN  * @vid: The VLAN tag filter - capture any multicast packet with this VLAN tag  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_vsi_mc_promisc_on_vlan
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|bool
name|enable
parameter_list|,
name|u16
name|vid
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_vsi_promiscuous_modes
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_vsi_promiscuous_modes
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|flags
init|=
literal|0
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_vsi_promiscuous_modes
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|flags
operator||=
name|I40E_AQC_SET_VSI_PROMISC_MULTICAST
expr_stmt|;
name|cmd
operator|->
name|promiscuous_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|valid_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_PROMISC_MULTICAST
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|vlan_tag
operator|=
name|CPU_TO_LE16
argument_list|(
name|vid
operator||
name|I40E_AQC_SET_VSI_VLAN_VALID
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_vsi_uc_promisc_on_vlan  * @hw: pointer to the hw struct  * @seid: vsi number  * @enable: set MAC L2 layer unicast promiscuous enable/disable for a given VLAN  * @vid: The VLAN tag filter - capture any unicast packet with this VLAN tag  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_vsi_uc_promisc_on_vlan
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|bool
name|enable
parameter_list|,
name|u16
name|vid
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_vsi_promiscuous_modes
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_vsi_promiscuous_modes
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|flags
init|=
literal|0
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_vsi_promiscuous_modes
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|flags
operator||=
name|I40E_AQC_SET_VSI_PROMISC_UNICAST
expr_stmt|;
name|cmd
operator|->
name|promiscuous_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|valid_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_PROMISC_UNICAST
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|vlan_tag
operator|=
name|CPU_TO_LE16
argument_list|(
name|vid
operator||
name|I40E_AQC_SET_VSI_VLAN_VALID
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_vsi_broadcast  * @hw: pointer to the hw struct  * @seid: vsi number  * @set_filter: TRUE to set filter, FALSE to clear filter  * @cmd_details: pointer to command details structure or NULL  *  * Set or clear the broadcast promiscuous flag (filter) for a given VSI.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_vsi_broadcast
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|bool
name|set_filter
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_set_vsi_promiscuous_modes
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_set_vsi_promiscuous_modes
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_vsi_promiscuous_modes
argument_list|)
expr_stmt|;
if|if
condition|(
name|set_filter
condition|)
name|cmd
operator|->
name|promiscuous_flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_PROMISC_BROADCAST
argument_list|)
expr_stmt|;
else|else
name|cmd
operator|->
name|promiscuous_flags
operator|&=
name|CPU_TO_LE16
argument_list|(
operator|~
name|I40E_AQC_SET_VSI_PROMISC_BROADCAST
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|valid_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_SET_VSI_PROMISC_BROADCAST
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_get_vsi_params - get VSI configuration info  * @hw: pointer to the hw struct  * @vsi_ctx: pointer to a vsi context struct  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_vsi_params
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_vsi_context
modifier|*
name|vsi_ctx
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_get_update_vsi
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_get_update_vsi
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_get_update_vsi_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_get_update_vsi_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_vsi_parameters
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|uplink_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_ctx
operator|->
name|seid
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
operator|&
name|vsi_ctx
operator|->
name|info
argument_list|,
sizeof|sizeof
argument_list|(
name|vsi_ctx
operator|->
name|info
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
goto|goto
name|aq_get_vsi_params_exit
goto|;
name|vsi_ctx
operator|->
name|seid
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|seid
argument_list|)
expr_stmt|;
name|vsi_ctx
operator|->
name|vsi_number
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|vsi_number
argument_list|)
expr_stmt|;
name|vsi_ctx
operator|->
name|vsis_allocated
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|vsi_used
argument_list|)
expr_stmt|;
name|vsi_ctx
operator|->
name|vsis_unallocated
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|vsi_free
argument_list|)
expr_stmt|;
name|aq_get_vsi_params_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_update_vsi_params  * @hw: pointer to the hw struct  * @vsi_ctx: pointer to a vsi context struct  * @cmd_details: pointer to command details structure or NULL  *  * Update a VSI context.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_update_vsi_params
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_vsi_context
modifier|*
name|vsi_ctx
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_get_update_vsi
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_get_update_vsi
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_update_vsi_parameters
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|uplink_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_ctx
operator|->
name|seid
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
operator|&
name|vsi_ctx
operator|->
name|info
argument_list|,
sizeof|sizeof
argument_list|(
name|vsi_ctx
operator|->
name|info
argument_list|)
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_switch_config  * @hw: pointer to the hardware structure  * @buf: pointer to the result buffer  * @buf_size: length of input buffer  * @start_seid: seid to start for the report, 0 == beginning  * @cmd_details: pointer to command details structure or NULL  *  * Fill the buf with switch configuration returned from AdminQ command  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_switch_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_aqc_get_switch_config_resp
modifier|*
name|buf
parameter_list|,
name|u16
name|buf_size
parameter_list|,
name|u16
modifier|*
name|start_seid
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_switch_seid
modifier|*
name|scfg
init|=
operator|(
expr|struct
name|i40e_aqc_switch_seid
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_switch_config
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|scfg
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
operator|*
name|start_seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buf
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
operator|*
name|start_seid
operator|=
name|LE16_TO_CPU
argument_list|(
name|scfg
operator|->
name|seid
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_firmware_version  * @hw: pointer to the hw struct  * @fw_major_version: firmware major version  * @fw_minor_version: firmware minor version  * @fw_build: firmware build number  * @api_major_version: major queue version  * @api_minor_version: minor queue version  * @cmd_details: pointer to command details structure or NULL  *  * Get the firmware version from the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_firmware_version
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
modifier|*
name|fw_major_version
parameter_list|,
name|u16
modifier|*
name|fw_minor_version
parameter_list|,
name|u32
modifier|*
name|fw_build
parameter_list|,
name|u16
modifier|*
name|api_major_version
parameter_list|,
name|u16
modifier|*
name|api_minor_version
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_get_version
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_get_version
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_version
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|I40E_SUCCESS
condition|)
block|{
if|if
condition|(
name|fw_major_version
operator|!=
name|NULL
condition|)
operator|*
name|fw_major_version
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|fw_major
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw_minor_version
operator|!=
name|NULL
condition|)
operator|*
name|fw_minor_version
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|fw_minor
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw_build
operator|!=
name|NULL
condition|)
operator|*
name|fw_build
operator|=
name|LE32_TO_CPU
argument_list|(
name|resp
operator|->
name|fw_build
argument_list|)
expr_stmt|;
if|if
condition|(
name|api_major_version
operator|!=
name|NULL
condition|)
operator|*
name|api_major_version
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|api_major
argument_list|)
expr_stmt|;
if|if
condition|(
name|api_minor_version
operator|!=
name|NULL
condition|)
operator|*
name|api_minor_version
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|api_minor
argument_list|)
expr_stmt|;
comment|/* A workaround to fix the API version in SW */
if|if
condition|(
name|api_major_version
operator|&&
name|api_minor_version
operator|&&
name|fw_major_version
operator|&&
name|fw_minor_version
operator|&&
operator|(
operator|(
operator|*
name|api_major_version
operator|==
literal|1
operator|)
operator|&&
operator|(
operator|*
name|api_minor_version
operator|==
literal|1
operator|)
operator|)
operator|&&
operator|(
operator|(
operator|(
operator|*
name|fw_major_version
operator|==
literal|4
operator|)
operator|&&
operator|(
operator|*
name|fw_minor_version
operator|>=
literal|2
operator|)
operator|)
operator|||
operator|(
operator|*
name|fw_major_version
operator|>
literal|4
operator|)
operator|)
condition|)
operator|*
name|api_minor_version
operator|=
literal|2
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_send_driver_version  * @hw: pointer to the hw struct  * @dv: driver's major, minor version  * @cmd_details: pointer to command details structure or NULL  *  * Send the driver version to the firmware  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_send_driver_version
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_driver_version
modifier|*
name|dv
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_driver_version
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_driver_version
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|len
decl_stmt|;
if|if
condition|(
name|dv
operator|==
name|NULL
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_driver_version
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|driver_major_ver
operator|=
name|dv
operator|->
name|major_version
expr_stmt|;
name|cmd
operator|->
name|driver_minor_ver
operator|=
name|dv
operator|->
name|minor_version
expr_stmt|;
name|cmd
operator|->
name|driver_build_ver
operator|=
name|dv
operator|->
name|build_version
expr_stmt|;
name|cmd
operator|->
name|driver_subbuild_ver
operator|=
name|dv
operator|->
name|subbuild_version
expr_stmt|;
name|len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dv
operator|->
name|driver_string
argument_list|)
operator|&&
operator|(
name|dv
operator|->
name|driver_string
index|[
name|len
index|]
operator|<
literal|0x80
operator|)
operator|&&
name|dv
operator|->
name|driver_string
index|[
name|len
index|]
condition|)
name|len
operator|++
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|dv
operator|->
name|driver_string
argument_list|,
name|len
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_get_link_status - get status of the HW network link  * @hw: pointer to the hw struct  * @link_up: pointer to bool (TRUE/FALSE = linkup/linkdown)  *  * Variable link_up TRUE if link is up, FALSE if link is down.  * The variable link_up is invalid if returned value of status != I40E_SUCCESS  *  * Side effect: LinkStatusEvent reporting becomes enabled  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_get_link_status
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
modifier|*
name|link_up
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
if|if
condition|(
name|hw
operator|->
name|phy
operator|.
name|get_link_info
condition|)
block|{
name|status
operator|=
name|i40e_update_link_info
argument_list|(
name|hw
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|I40E_DEBUG_LINK
argument_list|,
literal|"get link failed: status %d\n"
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
operator|*
name|link_up
operator|=
name|hw
operator|->
name|phy
operator|.
name|link_info
operator|.
name|link_info
operator|&
name|I40E_AQ_LINK_UP
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_updatelink_status - update status of the HW network link  * @hw: pointer to the hw struct  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_update_link_info
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|struct
name|i40e_aq_get_phy_abilities_resp
name|abilities
decl_stmt|;
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
name|status
operator|=
name|i40e_aq_get_link_info
argument_list|(
name|hw
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
return|return
name|status
return|;
name|status
operator|=
name|i40e_aq_get_phy_capabilities
argument_list|(
name|hw
argument_list|,
name|FALSE
argument_list|,
name|false
argument_list|,
operator|&
name|abilities
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
return|return
name|status
return|;
name|memcpy
argument_list|(
name|hw
operator|->
name|phy
operator|.
name|link_info
operator|.
name|module_type
argument_list|,
operator|&
name|abilities
operator|.
name|module_type
argument_list|,
sizeof|sizeof
argument_list|(
name|hw
operator|->
name|phy
operator|.
name|link_info
operator|.
name|module_type
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_get_link_speed  * @hw: pointer to the hw struct  *  * Returns the link speed of the adapter.  **/
end_comment

begin_function
name|enum
name|i40e_aq_link_speed
name|i40e_get_link_speed
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|enum
name|i40e_aq_link_speed
name|speed
init|=
name|I40E_LINK_SPEED_UNKNOWN
decl_stmt|;
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
if|if
condition|(
name|hw
operator|->
name|phy
operator|.
name|get_link_info
condition|)
block|{
name|status
operator|=
name|i40e_aq_get_link_info
argument_list|(
name|hw
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|I40E_SUCCESS
condition|)
goto|goto
name|i40e_link_speed_exit
goto|;
block|}
name|speed
operator|=
name|hw
operator|->
name|phy
operator|.
name|link_info
operator|.
name|link_speed
expr_stmt|;
name|i40e_link_speed_exit
label|:
return|return
name|speed
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_veb - Insert a VEB between the VSI and the MAC  * @hw: pointer to the hw struct  * @uplink_seid: the MAC or other gizmo SEID  * @downlink_seid: the VSI SEID  * @enabled_tc: bitmap of TCs to be enabled  * @default_port: TRUE for default port VSI, FALSE for control port  * @enable_l2_filtering: TRUE to add L2 filter table rules to regular forwarding rules for cloud support  * @veb_seid: pointer to where to put the resulting VEB SEID  * @cmd_details: pointer to command details structure or NULL  *  * This asks the FW to add a VEB between the uplink and downlink  * elements.  If the uplink SEID is 0, this will be a floating VEB.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_veb
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|uplink_seid
parameter_list|,
name|u16
name|downlink_seid
parameter_list|,
name|u8
name|enabled_tc
parameter_list|,
name|bool
name|default_port
parameter_list|,
name|bool
name|enable_l2_filtering
parameter_list|,
name|u16
modifier|*
name|veb_seid
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_veb
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_veb
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_veb_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_veb_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|veb_flags
init|=
literal|0
decl_stmt|;
comment|/* SEIDs need to either both be set or both be 0 for floating VEB */
if|if
condition|(
operator|!
operator|!
name|uplink_seid
operator|!=
operator|!
operator|!
name|downlink_seid
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_veb
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|uplink_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|uplink_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|downlink_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|downlink_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|enable_tcs
operator|=
name|enabled_tc
expr_stmt|;
if|if
condition|(
operator|!
name|uplink_seid
condition|)
name|veb_flags
operator||=
name|I40E_AQC_ADD_VEB_FLOATING
expr_stmt|;
if|if
condition|(
name|default_port
condition|)
name|veb_flags
operator||=
name|I40E_AQC_ADD_VEB_PORT_TYPE_DEFAULT
expr_stmt|;
else|else
name|veb_flags
operator||=
name|I40E_AQC_ADD_VEB_PORT_TYPE_DATA
expr_stmt|;
if|if
condition|(
name|enable_l2_filtering
condition|)
name|veb_flags
operator||=
name|I40E_AQC_ADD_VEB_ENABLE_L2_FILTER
expr_stmt|;
name|cmd
operator|->
name|veb_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|veb_flags
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|veb_seid
condition|)
operator|*
name|veb_seid
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|veb_seid
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_veb_parameters - Retrieve VEB parameters  * @hw: pointer to the hw struct  * @veb_seid: the SEID of the VEB to query  * @switch_id: the uplink switch id  * @floating: set to TRUE if the VEB is floating  * @statistic_index: index of the stats counter block for this VEB  * @vebs_used: number of VEB's used by function  * @vebs_free: total VEB's not reserved by any function  * @cmd_details: pointer to command details structure or NULL  *  * This retrieves the parameters for a particular VEB, specified by  * uplink_seid, and returns them to the caller.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_veb_parameters
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|veb_seid
parameter_list|,
name|u16
modifier|*
name|switch_id
parameter_list|,
name|bool
modifier|*
name|floating
parameter_list|,
name|u16
modifier|*
name|statistic_index
parameter_list|,
name|u16
modifier|*
name|vebs_used
parameter_list|,
name|u16
modifier|*
name|vebs_free
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_get_veb_parameters_completion
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_get_veb_parameters_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|veb_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_veb_parameters
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|veb_seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
goto|goto
name|get_veb_exit
goto|;
if|if
condition|(
name|switch_id
condition|)
operator|*
name|switch_id
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|switch_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|statistic_index
condition|)
operator|*
name|statistic_index
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|statistic_index
argument_list|)
expr_stmt|;
if|if
condition|(
name|vebs_used
condition|)
operator|*
name|vebs_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|vebs_used
argument_list|)
expr_stmt|;
if|if
condition|(
name|vebs_free
condition|)
operator|*
name|vebs_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|vebs_free
argument_list|)
expr_stmt|;
if|if
condition|(
name|floating
condition|)
block|{
name|u16
name|flags
init|=
name|LE16_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|veb_flags
argument_list|)
decl_stmt|;
if|if
condition|(
name|flags
operator|&
name|I40E_AQC_ADD_VEB_FLOATING
condition|)
operator|*
name|floating
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|floating
operator|=
name|FALSE
expr_stmt|;
block|}
name|get_veb_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_macvlan  * @hw: pointer to the hw struct  * @seid: VSI for the mac address  * @mv_list: list of macvlans to be added  * @count: length of the list  * @cmd_details: pointer to command details structure or NULL  *  * Add MAC/VLAN addresses to the HW filtering  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_macvlan
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_add_macvlan_element_data
modifier|*
name|mv_list
parameter_list|,
name|u16
name|count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_macvlan
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_macvlan
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|buf_size
decl_stmt|;
if|if
condition|(
name|count
operator|==
literal|0
operator|||
operator|!
name|mv_list
operator|||
operator|!
name|hw
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|buf_size
operator|=
name|count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|mv_list
argument_list|)
expr_stmt|;
comment|/* prep the rest of the request */
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_macvlan
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_addresses
operator|=
name|CPU_TO_LE16
argument_list|(
name|count
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|0
index|]
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_MACVLAN_CMD_SEID_VALID
operator||
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|mv_list
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_remove_macvlan  * @hw: pointer to the hw struct  * @seid: VSI for the mac address  * @mv_list: list of macvlans to be removed  * @count: length of the list  * @cmd_details: pointer to command details structure or NULL  *  * Remove MAC/VLAN addresses from the HW filtering  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_remove_macvlan
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_remove_macvlan_element_data
modifier|*
name|mv_list
parameter_list|,
name|u16
name|count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_macvlan
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_macvlan
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|buf_size
decl_stmt|;
if|if
condition|(
name|count
operator|==
literal|0
operator|||
operator|!
name|mv_list
operator|||
operator|!
name|hw
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|buf_size
operator|=
name|count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|mv_list
argument_list|)
expr_stmt|;
comment|/* prep the rest of the request */
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_macvlan
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_addresses
operator|=
name|CPU_TO_LE16
argument_list|(
name|count
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|0
index|]
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_MACVLAN_CMD_SEID_VALID
operator||
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|mv_list
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_vlan - Add VLAN ids to the HW filtering  * @hw: pointer to the hw struct  * @seid: VSI for the vlan filters  * @v_list: list of vlan filters to be added  * @count: length of the list  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_vlan
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_add_remove_vlan_element_data
modifier|*
name|v_list
parameter_list|,
name|u8
name|count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_macvlan
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_macvlan
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|buf_size
decl_stmt|;
if|if
condition|(
name|count
operator|==
literal|0
operator|||
operator|!
name|v_list
operator|||
operator|!
name|hw
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|buf_size
operator|=
name|count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|v_list
argument_list|)
expr_stmt|;
comment|/* prep the rest of the request */
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_vlan
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_addresses
operator|=
name|CPU_TO_LE16
argument_list|(
name|count
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|0
index|]
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
operator||
name|I40E_AQC_MACVLAN_CMD_SEID_VALID
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|v_list
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_remove_vlan - Remove VLANs from the HW filtering  * @hw: pointer to the hw struct  * @seid: VSI for the vlan filters  * @v_list: list of macvlans to be removed  * @count: length of the list  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_remove_vlan
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_add_remove_vlan_element_data
modifier|*
name|v_list
parameter_list|,
name|u8
name|count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_macvlan
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_macvlan
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|buf_size
decl_stmt|;
if|if
condition|(
name|count
operator|==
literal|0
operator|||
operator|!
name|v_list
operator|||
operator|!
name|hw
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|buf_size
operator|=
name|count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|v_list
argument_list|)
expr_stmt|;
comment|/* prep the rest of the request */
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_vlan
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_addresses
operator|=
name|CPU_TO_LE16
argument_list|(
name|count
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|0
index|]
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
operator||
name|I40E_AQC_MACVLAN_CMD_SEID_VALID
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|seid
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|v_list
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_send_msg_to_vf  * @hw: pointer to the hardware structure  * @vfid: vf id to send msg  * @v_opcode: opcodes for VF-PF communication  * @v_retval: return error code  * @msg: pointer to the msg buffer  * @msglen: msg length  * @cmd_details: pointer to command details  *  * send msg to vf  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_send_msg_to_vf
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|vfid
parameter_list|,
name|u32
name|v_opcode
parameter_list|,
name|u32
name|v_retval
parameter_list|,
name|u8
modifier|*
name|msg
parameter_list|,
name|u16
name|msglen
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_pf_vf_message
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_pf_vf_message
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_send_msg_to_vf
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|id
operator|=
name|CPU_TO_LE32
argument_list|(
name|vfid
argument_list|)
expr_stmt|;
name|desc
operator|.
name|cookie_high
operator|=
name|CPU_TO_LE32
argument_list|(
name|v_opcode
argument_list|)
expr_stmt|;
name|desc
operator|.
name|cookie_low
operator|=
name|CPU_TO_LE32
argument_list|(
name|v_retval
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_SI
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
condition|)
block|{
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|msglen
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_debug_read_register  * @hw: pointer to the hw struct  * @reg_addr: register address  * @reg_val: register value  * @cmd_details: pointer to command details structure or NULL  *  * Read the register using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_debug_read_register
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|reg_addr
parameter_list|,
name|u64
modifier|*
name|reg_val
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_debug_reg_read_write
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_debug_reg_read_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|reg_val
operator|==
name|NULL
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_debug_read_reg
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_addr
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|I40E_SUCCESS
condition|)
block|{
operator|*
name|reg_val
operator|=
operator|(
operator|(
name|u64
operator|)
name|LE32_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|value_high
argument_list|)
operator|<<
literal|32
operator|)
operator||
operator|(
name|u64
operator|)
name|LE32_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|value_low
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_debug_write_register  * @hw: pointer to the hw struct  * @reg_addr: register address  * @reg_val: register value  * @cmd_details: pointer to command details structure or NULL  *  * Write to a register using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_debug_write_register
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|reg_addr
parameter_list|,
name|u64
name|reg_val
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_debug_reg_read_write
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_debug_reg_read_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_debug_write_reg
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|address
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_addr
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|value_high
operator|=
name|CPU_TO_LE32
argument_list|(
call|(
name|u32
call|)
argument_list|(
name|reg_val
operator|>>
literal|32
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|value_low
operator|=
name|CPU_TO_LE32
argument_list|(
call|(
name|u32
call|)
argument_list|(
name|reg_val
operator|&
literal|0xFFFFFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_hmc_resource_profile  * @hw: pointer to the hw struct  * @profile: type of profile the HMC is to be set as  * @pe_vf_enabled_count: the number of PE enabled VFs the system has  * @cmd_details: pointer to command details structure or NULL  *  * query the HMC profile of the device.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_hmc_resource_profile
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_aq_hmc_profile
modifier|*
name|profile
parameter_list|,
name|u8
modifier|*
name|pe_vf_enabled_count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aq_get_set_hmc_resource_profile
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aq_get_set_hmc_resource_profile
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_query_hmc_resource_profile
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
operator|*
name|profile
operator|=
operator|(
expr|enum
name|i40e_aq_hmc_profile
operator|)
operator|(
name|resp
operator|->
name|pm_profile
operator|&
name|I40E_AQ_GET_HMC_RESOURCE_PROFILE_PM_MASK
operator|)
expr_stmt|;
operator|*
name|pe_vf_enabled_count
operator|=
name|resp
operator|->
name|pe_vf_enabled
operator|&
name|I40E_AQ_GET_HMC_RESOURCE_PROFILE_COUNT_MASK
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_hmc_resource_profile  * @hw: pointer to the hw struct  * @profile: type of profile the HMC is to be set as  * @pe_vf_enabled_count: the number of PE enabled VFs the system has  * @cmd_details: pointer to command details structure or NULL  *  * set the HMC profile of the device.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_hmc_resource_profile
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_aq_hmc_profile
name|profile
parameter_list|,
name|u8
name|pe_vf_enabled_count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aq_get_set_hmc_resource_profile
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aq_get_set_hmc_resource_profile
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_hmc_resource_profile
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|pm_profile
operator|=
operator|(
name|u8
operator|)
name|profile
expr_stmt|;
name|cmd
operator|->
name|pe_vf_enabled
operator|=
name|pe_vf_enabled_count
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_request_resource  * @hw: pointer to the hw struct  * @resource: resource id  * @access: access type  * @sdp_number: resource number  * @timeout: the maximum time in ms that the driver may hold the resource  * @cmd_details: pointer to command details structure or NULL  *  * requests common resource using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_request_resource
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_aq_resources_ids
name|resource
parameter_list|,
name|enum
name|i40e_aq_resource_access_type
name|access
parameter_list|,
name|u8
name|sdp_number
parameter_list|,
name|u64
modifier|*
name|timeout
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_request_resource
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_request_resource
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_aq_request_resource"
argument_list|)
expr_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_request_resource
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|resource_id
operator|=
name|CPU_TO_LE16
argument_list|(
name|resource
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|access_type
operator|=
name|CPU_TO_LE16
argument_list|(
name|access
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|resource_number
operator|=
name|CPU_TO_LE32
argument_list|(
name|sdp_number
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
comment|/* The completion specifies the maximum time in ms that the driver 	 * may hold the resource in the Timeout field. 	 * If the resource is held by someone else, the command completes with 	 * busy return value and the timeout field indicates the maximum time 	 * the current owner of the resource has to free it. 	 */
if|if
condition|(
name|status
operator|==
name|I40E_SUCCESS
operator|||
name|hw
operator|->
name|aq
operator|.
name|asq_last_status
operator|==
name|I40E_AQ_RC_EBUSY
condition|)
operator|*
name|timeout
operator|=
name|LE32_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|timeout
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_release_resource  * @hw: pointer to the hw struct  * @resource: resource id  * @sdp_number: resource number  * @cmd_details: pointer to command details structure or NULL  *  * release common resource using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_release_resource
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_aq_resources_ids
name|resource
parameter_list|,
name|u8
name|sdp_number
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_request_resource
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_request_resource
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_aq_release_resource"
argument_list|)
expr_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_release_resource
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|resource_id
operator|=
name|CPU_TO_LE16
argument_list|(
name|resource
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|resource_number
operator|=
name|CPU_TO_LE32
argument_list|(
name|sdp_number
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_read_nvm  * @hw: pointer to the hw struct  * @module_pointer: module pointer location in words from the NVM beginning  * @offset: byte offset from the module beginning  * @length: length of the section to be read (in bytes from the offset)  * @data: command buffer (size [bytes] = length)  * @last_command: tells if this is the last command in a series  * @cmd_details: pointer to command details structure or NULL  *  * Read the NVM using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_read_nvm
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|module_pointer
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u16
name|length
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|bool
name|last_command
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_nvm_update
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_nvm_update
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_aq_read_nvm"
argument_list|)
expr_stmt|;
comment|/* In offset the highest byte must be zeroed. */
if|if
condition|(
name|offset
operator|&
literal|0xFF000000
condition|)
block|{
name|status
operator|=
name|I40E_ERR_PARAM
expr_stmt|;
goto|goto
name|i40e_aq_read_nvm_exit
goto|;
block|}
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_nvm_read
argument_list|)
expr_stmt|;
comment|/* If this is the last command in a series, set the proper flag. */
if|if
condition|(
name|last_command
condition|)
name|cmd
operator|->
name|command_flags
operator||=
name|I40E_AQ_NVM_LAST_CMD
expr_stmt|;
name|cmd
operator|->
name|module_pointer
operator|=
name|module_pointer
expr_stmt|;
name|cmd
operator|->
name|offset
operator|=
name|CPU_TO_LE32
argument_list|(
name|offset
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|length
operator|=
name|CPU_TO_LE16
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|data
argument_list|,
name|length
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
name|i40e_aq_read_nvm_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_read_nvm_config - read an nvm config block  * @hw: pointer to the hw struct  * @cmd_flags: NVM access admin command bits  * @field_id: field or feature id  * @data: buffer for result  * @buf_size: buffer size  * @element_count: pointer to count of elements read by FW  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_read_nvm_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|cmd_flags
parameter_list|,
name|u32
name|field_id
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|u16
name|buf_size
parameter_list|,
name|u16
modifier|*
name|element_count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_nvm_config_read
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_nvm_config_read
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_nvm_config_read
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|cmd_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|cmd_flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|element_id
operator|=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
literal|0xffff
operator|&
name|field_id
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmd_flags
operator|&
name|I40E_AQ_ANVM_FEATURE_OR_IMMEDIATE_MASK
condition|)
name|cmd
operator|->
name|element_id_msw
operator|=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|field_id
operator|>>
literal|16
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|cmd
operator|->
name|element_id_msw
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|data
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|element_count
condition|)
operator|*
name|element_count
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd
operator|->
name|element_count
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_write_nvm_config - write an nvm config block  * @hw: pointer to the hw struct  * @cmd_flags: NVM access admin command bits  * @data: buffer for result  * @buf_size: buffer size  * @element_count: count of elements to be written  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_write_nvm_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|cmd_flags
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|u16
name|buf_size
parameter_list|,
name|u16
name|element_count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_nvm_config_write
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_nvm_config_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_nvm_config_write
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|element_count
operator|=
name|CPU_TO_LE16
argument_list|(
name|element_count
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|cmd_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|cmd_flags
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|data
argument_list|,
name|buf_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_oem_post_update - triggers an OEM specific flow after update  * @hw: pointer to the hw struct  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_oem_post_update
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_oem_post_update
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&&
name|LE16_TO_CPU
argument_list|(
name|desc
operator|.
name|retval
argument_list|)
operator|==
name|I40E_AQ_RC_ESRCH
condition|)
name|status
operator|=
name|I40E_ERR_NOT_IMPLEMENTED
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_erase_nvm  * @hw: pointer to the hw struct  * @module_pointer: module pointer location in words from the NVM beginning  * @offset: offset in the module (expressed in 4 KB from module's beginning)  * @length: length of the section to be erased (expressed in 4 KB)  * @last_command: tells if this is the last command in a series  * @cmd_details: pointer to command details structure or NULL  *  * Erase the NVM sector using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_erase_nvm
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|module_pointer
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u16
name|length
parameter_list|,
name|bool
name|last_command
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_nvm_update
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_nvm_update
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_aq_erase_nvm"
argument_list|)
expr_stmt|;
comment|/* In offset the highest byte must be zeroed. */
if|if
condition|(
name|offset
operator|&
literal|0xFF000000
condition|)
block|{
name|status
operator|=
name|I40E_ERR_PARAM
expr_stmt|;
goto|goto
name|i40e_aq_erase_nvm_exit
goto|;
block|}
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_nvm_erase
argument_list|)
expr_stmt|;
comment|/* If this is the last command in a series, set the proper flag. */
if|if
condition|(
name|last_command
condition|)
name|cmd
operator|->
name|command_flags
operator||=
name|I40E_AQ_NVM_LAST_CMD
expr_stmt|;
name|cmd
operator|->
name|module_pointer
operator|=
name|module_pointer
expr_stmt|;
name|cmd
operator|->
name|offset
operator|=
name|CPU_TO_LE32
argument_list|(
name|offset
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|length
operator|=
name|CPU_TO_LE16
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
name|i40e_aq_erase_nvm_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_parse_discover_capabilities  * @hw: pointer to the hw struct  * @buff: pointer to a buffer containing device/function capability records  * @cap_count: number of capability records in the list  * @list_type_opc: type of capabilities list to parse  *  * Parse the device/function capabilities list.  **/
end_comment

begin_function
specifier|static
name|void
name|i40e_parse_discover_capabilities
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u32
name|cap_count
parameter_list|,
name|enum
name|i40e_admin_queue_opc
name|list_type_opc
parameter_list|)
block|{
name|struct
name|i40e_aqc_list_capabilities_element_resp
modifier|*
name|cap
decl_stmt|;
name|u32
name|valid_functions
decl_stmt|,
name|num_functions
decl_stmt|;
name|u32
name|number
decl_stmt|,
name|logical_id
decl_stmt|,
name|phys_id
decl_stmt|;
name|struct
name|i40e_hw_capabilities
modifier|*
name|p
decl_stmt|;
name|u8
name|major_rev
decl_stmt|;
name|u32
name|i
init|=
literal|0
decl_stmt|;
name|u16
name|id
decl_stmt|;
name|cap
operator|=
operator|(
expr|struct
name|i40e_aqc_list_capabilities_element_resp
operator|*
operator|)
name|buff
expr_stmt|;
if|if
condition|(
name|list_type_opc
operator|==
name|i40e_aqc_opc_list_dev_capabilities
condition|)
name|p
operator|=
operator|(
expr|struct
name|i40e_hw_capabilities
operator|*
operator|)
operator|&
name|hw
operator|->
name|dev_caps
expr_stmt|;
elseif|else
if|if
condition|(
name|list_type_opc
operator|==
name|i40e_aqc_opc_list_func_capabilities
condition|)
name|p
operator|=
operator|(
expr|struct
name|i40e_hw_capabilities
operator|*
operator|)
operator|&
name|hw
operator|->
name|func_caps
expr_stmt|;
else|else
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cap_count
condition|;
name|i
operator|++
operator|,
name|cap
operator|++
control|)
block|{
name|id
operator|=
name|LE16_TO_CPU
argument_list|(
name|cap
operator|->
name|id
argument_list|)
expr_stmt|;
name|number
operator|=
name|LE32_TO_CPU
argument_list|(
name|cap
operator|->
name|number
argument_list|)
expr_stmt|;
name|logical_id
operator|=
name|LE32_TO_CPU
argument_list|(
name|cap
operator|->
name|logical_id
argument_list|)
expr_stmt|;
name|phys_id
operator|=
name|LE32_TO_CPU
argument_list|(
name|cap
operator|->
name|phys_id
argument_list|)
expr_stmt|;
name|major_rev
operator|=
name|cap
operator|->
name|major_rev
expr_stmt|;
switch|switch
condition|(
name|id
condition|)
block|{
case|case
name|I40E_AQ_CAP_ID_SWITCH_MODE
case|:
name|p
operator|->
name|switch_mode
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_MNG_MODE
case|:
name|p
operator|->
name|management_mode
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_NPAR_ACTIVE
case|:
name|p
operator|->
name|npar_enable
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_OS2BMC_CAP
case|:
name|p
operator|->
name|os2bmc
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_FUNCTIONS_VALID
case|:
name|p
operator|->
name|valid_functions
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_SRIOV
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|sr_iov_1_1
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_VF
case|:
name|p
operator|->
name|num_vfs
operator|=
name|number
expr_stmt|;
name|p
operator|->
name|vf_base_id
operator|=
name|logical_id
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_VMDQ
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|vmdq
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_8021QBG
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|evb_802_1_qbg
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_8021QBR
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|evb_802_1_qbh
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_VSI
case|:
name|p
operator|->
name|num_vsis
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_DCB
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
block|{
name|p
operator|->
name|dcb
operator|=
name|TRUE
expr_stmt|;
name|p
operator|->
name|enabled_tcmap
operator|=
name|logical_id
expr_stmt|;
name|p
operator|->
name|maxtc
operator|=
name|phys_id
expr_stmt|;
block|}
break|break;
case|case
name|I40E_AQ_CAP_ID_FCOE
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|fcoe
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_ISCSI
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|iscsi
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_RSS
case|:
name|p
operator|->
name|rss
operator|=
name|TRUE
expr_stmt|;
name|p
operator|->
name|rss_table_size
operator|=
name|number
expr_stmt|;
name|p
operator|->
name|rss_table_entry_width
operator|=
name|logical_id
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_RXQ
case|:
name|p
operator|->
name|num_rx_qp
operator|=
name|number
expr_stmt|;
name|p
operator|->
name|base_queue
operator|=
name|phys_id
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_TXQ
case|:
name|p
operator|->
name|num_tx_qp
operator|=
name|number
expr_stmt|;
name|p
operator|->
name|base_queue
operator|=
name|phys_id
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_MSIX
case|:
name|p
operator|->
name|num_msix_vectors
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_VF_MSIX
case|:
name|p
operator|->
name|num_msix_vectors_vf
operator|=
name|number
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_FLEX10
case|:
if|if
condition|(
name|major_rev
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|number
operator|==
literal|1
condition|)
block|{
name|p
operator|->
name|flex10_enable
operator|=
name|TRUE
expr_stmt|;
name|p
operator|->
name|flex10_capable
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Capability revision>= 2 */
if|if
condition|(
name|number
operator|&
literal|1
condition|)
name|p
operator|->
name|flex10_enable
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|number
operator|&
literal|2
condition|)
name|p
operator|->
name|flex10_capable
operator|=
name|TRUE
expr_stmt|;
block|}
name|p
operator|->
name|flex10_mode
operator|=
name|logical_id
expr_stmt|;
name|p
operator|->
name|flex10_status
operator|=
name|phys_id
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_CEM
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|mgmt_cem
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_IWARP
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|iwarp
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_LED
case|:
if|if
condition|(
name|phys_id
operator|<
name|I40E_HW_CAP_MAX_GPIO
condition|)
name|p
operator|->
name|led
index|[
name|phys_id
index|]
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_SDP
case|:
if|if
condition|(
name|phys_id
operator|<
name|I40E_HW_CAP_MAX_GPIO
condition|)
name|p
operator|->
name|sdp
index|[
name|phys_id
index|]
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_MDIO
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
block|{
name|p
operator|->
name|mdio_port_num
operator|=
name|phys_id
expr_stmt|;
name|p
operator|->
name|mdio_port_mode
operator|=
name|logical_id
expr_stmt|;
block|}
break|break;
case|case
name|I40E_AQ_CAP_ID_1588
case|:
if|if
condition|(
name|number
operator|==
literal|1
condition|)
name|p
operator|->
name|ieee_1588
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_FLOW_DIRECTOR
case|:
name|p
operator|->
name|fd
operator|=
name|TRUE
expr_stmt|;
name|p
operator|->
name|fd_filters_guaranteed
operator|=
name|number
expr_stmt|;
name|p
operator|->
name|fd_filters_best_effort
operator|=
name|logical_id
expr_stmt|;
break|break;
case|case
name|I40E_AQ_CAP_ID_WSR_PROT
case|:
name|p
operator|->
name|wr_csr_prot
operator|=
operator|(
name|u64
operator|)
name|number
expr_stmt|;
name|p
operator|->
name|wr_csr_prot
operator||=
operator|(
name|u64
operator|)
name|logical_id
operator|<<
literal|32
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
if|if
condition|(
name|p
operator|->
name|fcoe
condition|)
name|i40e_debug
argument_list|(
name|hw
argument_list|,
name|I40E_DEBUG_ALL
argument_list|,
literal|"device is FCoE capable\n"
argument_list|)
expr_stmt|;
comment|/* Always disable FCoE if compiled without the I40E_FCOE_ENA flag */
name|p
operator|->
name|fcoe
operator|=
name|FALSE
expr_stmt|;
comment|/* count the enabled ports (aka the "not disabled" ports) */
name|hw
operator|->
name|num_ports
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|u32
name|port_cfg_reg
init|=
name|I40E_PRTGEN_CNF
operator|+
operator|(
literal|4
operator|*
name|i
operator|)
decl_stmt|;
name|u64
name|port_cfg
init|=
literal|0
decl_stmt|;
comment|/* use AQ read to get the physical register offset instead 		 * of the port relative offset 		 */
name|i40e_aq_debug_read_register
argument_list|(
name|hw
argument_list|,
name|port_cfg_reg
argument_list|,
operator|&
name|port_cfg
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|port_cfg
operator|&
name|I40E_PRTGEN_CNF_PORT_DIS_MASK
operator|)
condition|)
name|hw
operator|->
name|num_ports
operator|++
expr_stmt|;
block|}
name|valid_functions
operator|=
name|p
operator|->
name|valid_functions
expr_stmt|;
name|num_functions
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|valid_functions
condition|)
block|{
if|if
condition|(
name|valid_functions
operator|&
literal|1
condition|)
name|num_functions
operator|++
expr_stmt|;
name|valid_functions
operator|>>=
literal|1
expr_stmt|;
block|}
comment|/* partition id is 1-based, and functions are evenly spread 	 * across the ports as partitions 	 */
name|hw
operator|->
name|partition_id
operator|=
operator|(
name|hw
operator|->
name|pf_id
operator|/
name|hw
operator|->
name|num_ports
operator|)
operator|+
literal|1
expr_stmt|;
name|hw
operator|->
name|num_partitions
operator|=
name|num_functions
operator|/
name|hw
operator|->
name|num_ports
expr_stmt|;
comment|/* additional HW specific goodies that might 	 * someday be HW version specific 	 */
name|p
operator|->
name|rx_buf_chain_len
operator|=
name|I40E_MAX_CHAINED_RX_BUFFERS
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_discover_capabilities  * @hw: pointer to the hw struct  * @buff: a virtual buffer to hold the capabilities  * @buff_size: Size of the virtual buffer  * @data_size: Size of the returned data, or buff size needed if AQ err==ENOMEM  * @list_type_opc: capabilities type to discover - pass in the command opcode  * @cmd_details: pointer to command details structure or NULL  *  * Get the device capabilities descriptions from the firmware  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_discover_capabilities
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|u16
modifier|*
name|data_size
parameter_list|,
name|enum
name|i40e_admin_queue_opc
name|list_type_opc
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aqc_list_capabilites
modifier|*
name|cmd
decl_stmt|;
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
init|=
name|I40E_SUCCESS
decl_stmt|;
name|cmd
operator|=
operator|(
expr|struct
name|i40e_aqc_list_capabilites
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
expr_stmt|;
if|if
condition|(
name|list_type_opc
operator|!=
name|i40e_aqc_opc_list_func_capabilities
operator|&&
name|list_type_opc
operator|!=
name|i40e_aqc_opc_list_dev_capabilities
condition|)
block|{
name|status
operator|=
name|I40E_ERR_PARAM
expr_stmt|;
goto|goto
name|exit
goto|;
block|}
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|list_type_opc
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
operator|*
name|data_size
operator|=
name|LE16_TO_CPU
argument_list|(
name|desc
operator|.
name|datalen
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
goto|goto
name|exit
goto|;
name|i40e_parse_discover_capabilities
argument_list|(
name|hw
argument_list|,
name|buff
argument_list|,
name|LE32_TO_CPU
argument_list|(
name|cmd
operator|->
name|count
argument_list|)
argument_list|,
name|list_type_opc
argument_list|)
expr_stmt|;
name|exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_update_nvm  * @hw: pointer to the hw struct  * @module_pointer: module pointer location in words from the NVM beginning  * @offset: byte offset from the module beginning  * @length: length of the section to be written (in bytes from the offset)  * @data: command buffer (size [bytes] = length)  * @last_command: tells if this is the last command in a series  * @cmd_details: pointer to command details structure or NULL  *  * Update the NVM using the admin queue commands  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_update_nvm
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|module_pointer
parameter_list|,
name|u32
name|offset
parameter_list|,
name|u16
name|length
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|bool
name|last_command
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_nvm_update
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_nvm_update
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|DEBUGFUNC
argument_list|(
literal|"i40e_aq_update_nvm"
argument_list|)
expr_stmt|;
comment|/* In offset the highest byte must be zeroed. */
if|if
condition|(
name|offset
operator|&
literal|0xFF000000
condition|)
block|{
name|status
operator|=
name|I40E_ERR_PARAM
expr_stmt|;
goto|goto
name|i40e_aq_update_nvm_exit
goto|;
block|}
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_nvm_update
argument_list|)
expr_stmt|;
comment|/* If this is the last command in a series, set the proper flag. */
if|if
condition|(
name|last_command
condition|)
name|cmd
operator|->
name|command_flags
operator||=
name|I40E_AQ_NVM_LAST_CMD
expr_stmt|;
name|cmd
operator|->
name|module_pointer
operator|=
name|module_pointer
expr_stmt|;
name|cmd
operator|->
name|offset
operator|=
name|CPU_TO_LE32
argument_list|(
name|offset
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|length
operator|=
name|CPU_TO_LE16
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|data
argument_list|,
name|length
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
name|i40e_aq_update_nvm_exit
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_lldp_mib  * @hw: pointer to the hw struct  * @bridge_type: type of bridge requested  * @mib_type: Local, Remote or both Local and Remote MIBs  * @buff: pointer to a user supplied buffer to store the MIB block  * @buff_size: size of the buffer (in bytes)  * @local_len : length of the returned Local LLDP MIB  * @remote_len: length of the returned Remote LLDP MIB  * @cmd_details: pointer to command details structure or NULL  *  * Requests the complete LLDP MIB (entire packet).  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_lldp_mib
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|bridge_type
parameter_list|,
name|u8
name|mib_type
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|u16
modifier|*
name|local_len
parameter_list|,
name|u16
modifier|*
name|remote_len
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_get_mib
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_get_mib
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_lldp_get_mib
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_get_mib
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_get_mib
argument_list|)
expr_stmt|;
comment|/* Indirect Command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|type
operator|=
name|mib_type
operator|&
name|I40E_AQ_LLDP_MIB_TYPE_MASK
expr_stmt|;
name|cmd
operator|->
name|type
operator||=
operator|(
operator|(
name|bridge_type
operator|<<
name|I40E_AQ_LLDP_BRIDGE_TYPE_SHIFT
operator|)
operator|&
name|I40E_AQ_LLDP_BRIDGE_TYPE_MASK
operator|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|local_len
operator|!=
name|NULL
condition|)
operator|*
name|local_len
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|local_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|remote_len
operator|!=
name|NULL
condition|)
operator|*
name|remote_len
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|remote_len
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_lldp_mib - Set the LLDP MIB  * @hw: pointer to the hw struct  * @mib_type: Local, Remote or both Local and Remote MIBs  * @buff: pointer to a user supplied buffer to store the MIB block  * @buff_size: size of the buffer (in bytes)  * @cmd_details: pointer to command details structure or NULL  *  * Set the LLDP MIB.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_lldp_mib
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|mib_type
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_set_local_mib
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_set_local_mib
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_set_local_mib
argument_list|)
expr_stmt|;
comment|/* Indirect Command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|type
operator|=
name|mib_type
expr_stmt|;
name|cmd
operator|->
name|length
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|address_high
operator|=
name|CPU_TO_LE32
argument_list|(
name|I40E_HI_WORD
argument_list|(
operator|(
name|u64
operator|)
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|address_low
operator|=
name|CPU_TO_LE32
argument_list|(
name|I40E_LO_DWORD
argument_list|(
operator|(
name|u64
operator|)
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_cfg_lldp_mib_change_event  * @hw: pointer to the hw struct  * @enable_update: Enable or Disable event posting  * @cmd_details: pointer to command details structure or NULL  *  * Enable or Disable posting of an event on ARQ when LLDP MIB  * associated with the interface changes  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_cfg_lldp_mib_change_event
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|enable_update
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_update_mib
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_update_mib
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_update_mib
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|enable_update
condition|)
name|cmd
operator|->
name|command
operator||=
name|I40E_AQ_LLDP_MIB_UPDATE_DISABLE
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_lldp_tlv  * @hw: pointer to the hw struct  * @bridge_type: type of bridge  * @buff: buffer with TLV to add  * @buff_size: length of the buffer  * @tlv_len: length of the TLV to be added  * @mib_len: length of the LLDP MIB returned in response  * @cmd_details: pointer to command details structure or NULL  *  * Add the specified TLV to LLDP Local MIB for the given bridge type,  * it is responsibility of the caller to make sure that the TLV is not  * already present in the LLDPDU.  * In return firmware will write the complete LLDP MIB with the newly  * added TLV in the response buffer.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_lldp_tlv
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|bridge_type
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|u16
name|tlv_len
parameter_list|,
name|u16
modifier|*
name|mib_len
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_add_tlv
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_add_tlv
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
operator|||
name|tlv_len
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_add_tlv
argument_list|)
expr_stmt|;
comment|/* Indirect Command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|type
operator|=
operator|(
operator|(
name|bridge_type
operator|<<
name|I40E_AQ_LLDP_BRIDGE_TYPE_SHIFT
operator|)
operator|&
name|I40E_AQ_LLDP_BRIDGE_TYPE_MASK
operator|)
expr_stmt|;
name|cmd
operator|->
name|len
operator|=
name|CPU_TO_LE16
argument_list|(
name|tlv_len
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|mib_len
operator|!=
name|NULL
condition|)
operator|*
name|mib_len
operator|=
name|LE16_TO_CPU
argument_list|(
name|desc
operator|.
name|datalen
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_update_lldp_tlv  * @hw: pointer to the hw struct  * @bridge_type: type of bridge  * @buff: buffer with TLV to update  * @buff_size: size of the buffer holding original and updated TLVs  * @old_len: Length of the Original TLV  * @new_len: Length of the Updated TLV  * @offset: offset of the updated TLV in the buff  * @mib_len: length of the returned LLDP MIB  * @cmd_details: pointer to command details structure or NULL  *  * Update the specified TLV to the LLDP Local MIB for the given bridge type.  * Firmware will place the complete LLDP MIB in response buffer with the  * updated TLV.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_update_lldp_tlv
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|bridge_type
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|u16
name|old_len
parameter_list|,
name|u16
name|new_len
parameter_list|,
name|u16
name|offset
parameter_list|,
name|u16
modifier|*
name|mib_len
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_update_tlv
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_update_tlv
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
operator|||
name|offset
operator|==
literal|0
operator|||
name|old_len
operator|==
literal|0
operator|||
name|new_len
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_update_tlv
argument_list|)
expr_stmt|;
comment|/* Indirect Command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|type
operator|=
operator|(
operator|(
name|bridge_type
operator|<<
name|I40E_AQ_LLDP_BRIDGE_TYPE_SHIFT
operator|)
operator|&
name|I40E_AQ_LLDP_BRIDGE_TYPE_MASK
operator|)
expr_stmt|;
name|cmd
operator|->
name|old_len
operator|=
name|CPU_TO_LE16
argument_list|(
name|old_len
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|new_offset
operator|=
name|CPU_TO_LE16
argument_list|(
name|offset
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|new_len
operator|=
name|CPU_TO_LE16
argument_list|(
name|new_len
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|mib_len
operator|!=
name|NULL
condition|)
operator|*
name|mib_len
operator|=
name|LE16_TO_CPU
argument_list|(
name|desc
operator|.
name|datalen
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_delete_lldp_tlv  * @hw: pointer to the hw struct  * @bridge_type: type of bridge  * @buff: pointer to a user supplied buffer that has the TLV  * @buff_size: length of the buffer  * @tlv_len: length of the TLV to be deleted  * @mib_len: length of the returned LLDP MIB  * @cmd_details: pointer to command details structure or NULL  *  * Delete the specified TLV from LLDP Local MIB for the given bridge type.  * The firmware places the entire LLDP MIB in the response buffer.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_delete_lldp_tlv
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|bridge_type
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|u16
name|tlv_len
parameter_list|,
name|u16
modifier|*
name|mib_len
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_add_tlv
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_add_tlv
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_delete_tlv
argument_list|)
expr_stmt|;
comment|/* Indirect Command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|len
operator|=
name|CPU_TO_LE16
argument_list|(
name|tlv_len
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|type
operator|=
operator|(
operator|(
name|bridge_type
operator|<<
name|I40E_AQ_LLDP_BRIDGE_TYPE_SHIFT
operator|)
operator|&
name|I40E_AQ_LLDP_BRIDGE_TYPE_MASK
operator|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|mib_len
operator|!=
name|NULL
condition|)
operator|*
name|mib_len
operator|=
name|LE16_TO_CPU
argument_list|(
name|desc
operator|.
name|datalen
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_stop_lldp  * @hw: pointer to the hw struct  * @shutdown_agent: True if LLDP Agent needs to be Shutdown  * @cmd_details: pointer to command details structure or NULL  *  * Stop or Shutdown the embedded LLDP Agent  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_stop_lldp
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|shutdown_agent
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_stop
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_stop
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_stop
argument_list|)
expr_stmt|;
if|if
condition|(
name|shutdown_agent
condition|)
name|cmd
operator|->
name|command
operator||=
name|I40E_AQ_LLDP_AGENT_SHUTDOWN
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_start_lldp  * @hw: pointer to the hw struct  * @cmd_details: pointer to command details structure or NULL  *  * Start the embedded LLDP Agent on all ports.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_start_lldp
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_start
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_start
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_start
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|command
operator|=
name|I40E_AQ_LLDP_AGENT_START
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_cee_dcb_config  * @hw: pointer to the hw struct  * @buff: response buffer that stores CEE operational configuration  * @buff_size: size of the buffer passed  * @cmd_details: pointer to command details structure or NULL  *  * Get CEE DCBX mode operational configuration from firmware  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_cee_dcb_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_cee_dcb_cfg
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
operator|(
name|void
operator|*
operator|)
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_start_stop_dcbx - Start/Stop DCBx service in FW  * @hw: pointer to the hw struct  * @start_agent: True if DCBx Agent needs to be Started  *				False if DCBx Agent needs to be Stopped  * @cmd_details: pointer to command details structure or NULL  *  * Start/Stop the embedded dcbx Agent  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_start_stop_dcbx
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|start_agent
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_lldp_stop_start_specific_agent
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_lldp_stop_start_specific_agent
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_lldp_stop_start_spec_agent
argument_list|)
expr_stmt|;
if|if
condition|(
name|start_agent
condition|)
name|cmd
operator|->
name|command
operator|=
name|I40E_AQC_START_SPECIFIC_AGENT_MASK
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_udp_tunnel  * @hw: pointer to the hw struct  * @udp_port: the UDP port to add  * @header_len: length of the tunneling header length in DWords  * @protocol_index: protocol index type  * @filter_index: pointer to filter index  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_udp_tunnel
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|udp_port
parameter_list|,
name|u8
name|protocol_index
parameter_list|,
name|u8
modifier|*
name|filter_index
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_udp_tunnel
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_udp_tunnel
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_del_udp_tunnel_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_del_udp_tunnel_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_udp_tunnel
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|udp_port
operator|=
name|CPU_TO_LE16
argument_list|(
name|udp_port
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|protocol_type
operator|=
name|protocol_index
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|filter_index
condition|)
operator|*
name|filter_index
operator|=
name|resp
operator|->
name|index
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_del_udp_tunnel  * @hw: pointer to the hw struct  * @index: filter index  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_del_udp_tunnel
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|index
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_remove_udp_tunnel
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_remove_udp_tunnel
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_del_udp_tunnel
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|index
operator|=
name|index
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_get_switch_resource_alloc (0x0204)  * @hw: pointer to the hw struct  * @num_entries: pointer to u8 to store the number of resource entries returned  * @buf: pointer to a user supplied buffer.  This buffer must be large enough  *        to store the resource information for all resource types.  Each  *        resource type is a i40e_aqc_switch_resource_alloc_data structure.  * @count: size, in bytes, of the buffer provided  * @cmd_details: pointer to command details structure or NULL  *  * Query the resources allocated to a function.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_get_switch_resource_alloc
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
modifier|*
name|num_entries
parameter_list|,
name|struct
name|i40e_aqc_switch_resource_alloc_element_resp
modifier|*
name|buf
parameter_list|,
name|u16
name|count
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_get_switch_resource_alloc
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_get_switch_resource_alloc
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|length
init|=
name|count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|buf
argument_list|)
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_get_switch_resource_alloc
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buf
argument_list|,
name|length
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|num_entries
condition|)
operator|*
name|num_entries
operator|=
name|cmd_resp
operator|->
name|num_entries
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_delete_element - Delete switch element  * @hw: pointer to the hw struct  * @seid: the SEID to delete from the switch  * @cmd_details: pointer to command details structure or NULL  *  * This deletes a switch element from the switch.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_delete_element
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_switch_seid
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_switch_seid
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_delete_element
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40_aq_add_pvirt - Instantiate a Port Virtualizer on a port  * @hw: pointer to the hw struct  * @flags: component flags  * @mac_seid: uplink seid (MAC SEID)  * @vsi_seid: connected vsi seid  * @ret_seid: seid of create pv component  *  * This instantiates an i40e port virtualizer with specified flags.  * Depending on specified flags the port virtualizer can act as a  * 802.1Qbr port virtualizer or a 802.1Qbg S-component.  */
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_pvirt
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|flags
parameter_list|,
name|u16
name|mac_seid
parameter_list|,
name|u16
name|vsi_seid
parameter_list|,
name|u16
modifier|*
name|ret_seid
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_update_pv
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_update_pv
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_update_pv_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_update_pv_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|vsi_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_pv
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|command_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|uplink_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|mac_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|connected_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|ret_seid
condition|)
operator|*
name|ret_seid
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|pv_seid
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_tag - Add an S/E-tag  * @hw: pointer to the hw struct  * @direct_to_queue: should s-tag direct flow to a specific queue  * @vsi_seid: VSI SEID to use this tag  * @tag: value of the tag  * @queue_num: queue number, only valid is direct_to_queue is TRUE  * @tags_used: return value, number of tags in use by this PF  * @tags_free: return value, number of unallocated tags  * @cmd_details: pointer to command details structure or NULL  *  * This associates an S- or E-tag to a VSI in the switch complex.  It returns  * the number of tags allocated by the PF, and the number of unallocated  * tags available.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_tag
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|bool
name|direct_to_queue
parameter_list|,
name|u16
name|vsi_seid
parameter_list|,
name|u16
name|tag
parameter_list|,
name|u16
name|queue_num
parameter_list|,
name|u16
modifier|*
name|tags_used
parameter_list|,
name|u16
modifier|*
name|tags_free
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_tag
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_tag
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_tag_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_tag_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|vsi_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_tag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|tag
operator|=
name|CPU_TO_LE16
argument_list|(
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|direct_to_queue
condition|)
block|{
name|cmd
operator|->
name|flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQC_ADD_TAG_FLAG_TO_QUEUE
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|queue_number
operator|=
name|CPU_TO_LE16
argument_list|(
name|queue_num
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|tags_used
operator|!=
name|NULL
condition|)
operator|*
name|tags_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|tags_used
argument_list|)
expr_stmt|;
if|if
condition|(
name|tags_free
operator|!=
name|NULL
condition|)
operator|*
name|tags_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|tags_free
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_remove_tag - Remove an S- or E-tag  * @hw: pointer to the hw struct  * @vsi_seid: VSI SEID this tag is associated with  * @tag: value of the S-tag to delete  * @tags_used: return value, number of tags in use by this PF  * @tags_free: return value, number of unallocated tags  * @cmd_details: pointer to command details structure or NULL  *  * This deletes an S- or E-tag from a VSI in the switch complex.  It returns  * the number of tags allocated by the PF, and the number of unallocated  * tags available.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_remove_tag
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|vsi_seid
parameter_list|,
name|u16
name|tag
parameter_list|,
name|u16
modifier|*
name|tags_used
parameter_list|,
name|u16
modifier|*
name|tags_free
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_remove_tag
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_remove_tag
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_tag_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_tag_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|vsi_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_tag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|tag
operator|=
name|CPU_TO_LE16
argument_list|(
name|tag
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|tags_used
operator|!=
name|NULL
condition|)
operator|*
name|tags_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|tags_used
argument_list|)
expr_stmt|;
if|if
condition|(
name|tags_free
operator|!=
name|NULL
condition|)
operator|*
name|tags_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|tags_free
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_mcast_etag - Add a multicast E-tag  * @hw: pointer to the hw struct  * @pv_seid: Port Virtualizer of this SEID to associate E-tag with  * @etag: value of E-tag to add  * @num_tags_in_buf: number of unicast E-tags in indirect buffer  * @buf: address of indirect buffer  * @tags_used: return value, number of E-tags in use by this port  * @tags_free: return value, number of unallocated M-tags  * @cmd_details: pointer to command details structure or NULL  *  * This associates a multicast E-tag to a port virtualizer.  It will return  * the number of tags allocated by the PF, and the number of unallocated  * tags available.  *  * The indirect buffer pointed to by buf is a list of 2-byte E-tags,  * num_tags_in_buf long.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_mcast_etag
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|pv_seid
parameter_list|,
name|u16
name|etag
parameter_list|,
name|u8
name|num_tags_in_buf
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|u16
modifier|*
name|tags_used
parameter_list|,
name|u16
modifier|*
name|tags_free
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_mcast_etag
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_mcast_etag
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_mcast_etag_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_mcast_etag_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|length
init|=
sizeof|sizeof
argument_list|(
name|u16
argument_list|)
operator|*
name|num_tags_in_buf
decl_stmt|;
if|if
condition|(
operator|(
name|pv_seid
operator|==
literal|0
operator|)
operator|||
operator|(
name|buf
operator|==
name|NULL
operator|)
operator|||
operator|(
name|num_tags_in_buf
operator|==
literal|0
operator|)
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_multicast_etag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|pv_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|pv_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|etag
operator|=
name|CPU_TO_LE16
argument_list|(
name|etag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_unicast_etags
operator|=
name|num_tags_in_buf
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buf
argument_list|,
name|length
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|tags_used
operator|!=
name|NULL
condition|)
operator|*
name|tags_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|mcast_etags_used
argument_list|)
expr_stmt|;
if|if
condition|(
name|tags_free
operator|!=
name|NULL
condition|)
operator|*
name|tags_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|mcast_etags_free
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_remove_mcast_etag - Remove a multicast E-tag  * @hw: pointer to the hw struct  * @pv_seid: Port Virtualizer SEID this M-tag is associated with  * @etag: value of the E-tag to remove  * @tags_used: return value, number of tags in use by this port  * @tags_free: return value, number of unallocated tags  * @cmd_details: pointer to command details structure or NULL  *  * This deletes an E-tag from the port virtualizer.  It will return  * the number of tags allocated by the port, and the number of unallocated  * tags available.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_remove_mcast_etag
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|pv_seid
parameter_list|,
name|u16
name|etag
parameter_list|,
name|u16
modifier|*
name|tags_used
parameter_list|,
name|u16
modifier|*
name|tags_free
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_mcast_etag
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_mcast_etag
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_mcast_etag_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_mcast_etag_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|pv_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_multicast_etag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|pv_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|pv_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|etag
operator|=
name|CPU_TO_LE16
argument_list|(
name|etag
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|tags_used
operator|!=
name|NULL
condition|)
operator|*
name|tags_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|mcast_etags_used
argument_list|)
expr_stmt|;
if|if
condition|(
name|tags_free
operator|!=
name|NULL
condition|)
operator|*
name|tags_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|mcast_etags_free
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_update_tag - Update an S/E-tag  * @hw: pointer to the hw struct  * @vsi_seid: VSI SEID using this S-tag  * @old_tag: old tag value  * @new_tag: new tag value  * @tags_used: return value, number of tags in use by this PF  * @tags_free: return value, number of unallocated tags  * @cmd_details: pointer to command details structure or NULL  *  * This updates the value of the tag currently attached to this VSI  * in the switch complex.  It will return the number of tags allocated  * by the PF, and the number of unallocated tags available.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_update_tag
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|vsi_seid
parameter_list|,
name|u16
name|old_tag
parameter_list|,
name|u16
name|new_tag
parameter_list|,
name|u16
modifier|*
name|tags_used
parameter_list|,
name|u16
modifier|*
name|tags_free
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_update_tag
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_update_tag
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_update_tag_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_update_tag_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|vsi_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_update_tag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|old_tag
operator|=
name|CPU_TO_LE16
argument_list|(
name|old_tag
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|new_tag
operator|=
name|CPU_TO_LE16
argument_list|(
name|new_tag
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|tags_used
operator|!=
name|NULL
condition|)
operator|*
name|tags_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|tags_used
argument_list|)
expr_stmt|;
if|if
condition|(
name|tags_free
operator|!=
name|NULL
condition|)
operator|*
name|tags_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|tags_free
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_dcb_ignore_pfc - Ignore PFC for given TCs  * @hw: pointer to the hw struct  * @tcmap: TC map for request/release any ignore PFC condition  * @request: request or release ignore PFC condition  * @tcmap_ret: return TCs for which PFC is currently ignored  * @cmd_details: pointer to command details structure or NULL  *  * This sends out request/release to ignore PFC condition for a TC.  * It will return the TCs for which PFC is currently ignored.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_dcb_ignore_pfc
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|tcmap
parameter_list|,
name|bool
name|request
parameter_list|,
name|u8
modifier|*
name|tcmap_ret
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_pfc_ignore
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_pfc_ignore
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_dcb_ignore_pfc
argument_list|)
expr_stmt|;
if|if
condition|(
name|request
condition|)
name|cmd_resp
operator|->
name|command_flags
operator|=
name|I40E_AQC_PFC_IGNORE_SET
expr_stmt|;
name|cmd_resp
operator|->
name|tc_bitmap
operator|=
name|tcmap
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|tcmap_ret
operator|!=
name|NULL
condition|)
operator|*
name|tcmap_ret
operator|=
name|cmd_resp
operator|->
name|tc_bitmap
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_dcb_updated - DCB Updated Command  * @hw: pointer to the hw struct  * @cmd_details: pointer to command details structure or NULL  *  * When LLDP is handled in PF this command is used by the PF  * to notify EMP that a DCB setting is modified.  * When LLDP is handled in EMP this command is used by the PF  * to notify EMP whenever one of the following parameters get  * modified:  *   - PFCLinkDelayAllowance in PRTDCB_GENC.PFCLDA  *   - PCIRTT in PRTDCB_GENC.PCIRTT  *   - Maximum Frame Size for non-FCoE TCs set by PRTDCB_TDPUC.MAX_TXFRAME.  * EMP will return when the shared RPB settings have been  * recomputed and modified. The retval field in the descriptor  * will be set to 0 when RPB is modified.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_dcb_updated
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_dcb_updated
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_statistics - Add a statistics block to a VLAN in a switch.  * @hw: pointer to the hw struct  * @seid: defines the SEID of the switch for which the stats are requested  * @vlan_id: the VLAN ID for which the statistics are requested  * @stat_index: index of the statistics counters block assigned to this VLAN  * @cmd_details: pointer to command details structure or NULL  *  * XL710 supports 128 smonVlanStats counters.This command is used to  * allocate a set of smonVlanStats counters to a specific VLAN in a specific  * switch.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_statistics
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|u16
name|vlan_id
parameter_list|,
name|u16
modifier|*
name|stat_index
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_statistics
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_statistics
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
operator|(
name|seid
operator|==
literal|0
operator|)
operator|||
operator|(
name|stat_index
operator|==
name|NULL
operator|)
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_statistics
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|vlan
operator|=
name|CPU_TO_LE16
argument_list|(
name|vlan_id
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|stat_index
condition|)
operator|*
name|stat_index
operator|=
name|LE16_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|stat_index
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_remove_statistics - Remove a statistics block to a VLAN in a switch.  * @hw: pointer to the hw struct  * @seid: defines the SEID of the switch for which the stats are requested  * @vlan_id: the VLAN ID for which the statistics are requested  * @stat_index: index of the statistics counters block assigned to this VLAN  * @cmd_details: pointer to command details structure or NULL  *  * XL710 supports 128 smonVlanStats counters.This command is used to  * deallocate a set of smonVlanStats counters to a specific VLAN in a specific  * switch.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_remove_statistics
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|u16
name|vlan_id
parameter_list|,
name|u16
name|stat_index
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_statistics
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_statistics
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_statistics
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|vlan
operator|=
name|CPU_TO_LE16
argument_list|(
name|vlan_id
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|stat_index
operator|=
name|CPU_TO_LE16
argument_list|(
name|stat_index
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_set_port_parameters - set physical port parameters.  * @hw: pointer to the hw struct  * @bad_frame_vsi: defines the VSI to which bad frames are forwarded  * @save_bad_pac: if set packets with errors are forwarded to the bad frames VSI  * @pad_short_pac: if set transmit packets smaller than 60 bytes are padded  * @double_vlan: if set double VLAN is enabled  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_port_parameters
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|bad_frame_vsi
parameter_list|,
name|bool
name|save_bad_pac
parameter_list|,
name|bool
name|pad_short_pac
parameter_list|,
name|bool
name|double_vlan
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aqc_set_port_parameters
modifier|*
name|cmd
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|u16
name|command_flags
init|=
literal|0
decl_stmt|;
name|cmd
operator|=
operator|(
expr|struct
name|i40e_aqc_set_port_parameters
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
expr_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_set_port_parameters
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|bad_frame_vsi
operator|=
name|CPU_TO_LE16
argument_list|(
name|bad_frame_vsi
argument_list|)
expr_stmt|;
if|if
condition|(
name|save_bad_pac
condition|)
name|command_flags
operator||=
name|I40E_AQ_SET_P_PARAMS_SAVE_BAD_PACKETS
expr_stmt|;
if|if
condition|(
name|pad_short_pac
condition|)
name|command_flags
operator||=
name|I40E_AQ_SET_P_PARAMS_PAD_SHORT_PACKETS
expr_stmt|;
if|if
condition|(
name|double_vlan
condition|)
name|command_flags
operator||=
name|I40E_AQ_SET_P_PARAMS_DOUBLE_VLAN_ENA
expr_stmt|;
name|cmd
operator|->
name|command_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|command_flags
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_tx_sched_cmd - generic Tx scheduler AQ command handler  * @hw: pointer to the hw struct  * @seid: seid for the physical port/switching component/vsi  * @buff: Indirect buffer to hold data parameters and response  * @buff_size: Indirect buffer size  * @opcode: Tx scheduler AQ command opcode  * @cmd_details: pointer to command details structure or NULL  *  * Generic command handler for Tx scheduler AQ commands  **/
end_comment

begin_function
specifier|static
name|enum
name|i40e_status_code
name|i40e_aq_tx_sched_cmd
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|enum
name|i40e_admin_queue_opc
name|opcode
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_tx_sched_ind
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_tx_sched_ind
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|bool
name|cmd_param_flag
init|=
name|FALSE
decl_stmt|;
switch|switch
condition|(
name|opcode
condition|)
block|{
case|case
name|i40e_aqc_opc_configure_vsi_ets_sla_bw_limit
case|:
case|case
name|i40e_aqc_opc_configure_vsi_tc_bw
case|:
case|case
name|i40e_aqc_opc_enable_switching_comp_ets
case|:
case|case
name|i40e_aqc_opc_modify_switching_comp_ets
case|:
case|case
name|i40e_aqc_opc_disable_switching_comp_ets
case|:
case|case
name|i40e_aqc_opc_configure_switching_comp_ets_bw_limit
case|:
case|case
name|i40e_aqc_opc_configure_switching_comp_bw_config
case|:
name|cmd_param_flag
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|i40e_aqc_opc_query_vsi_bw_config
case|:
case|case
name|i40e_aqc_opc_query_vsi_ets_sla_config
case|:
case|case
name|i40e_aqc_opc_query_switching_comp_ets_config
case|:
case|case
name|i40e_aqc_opc_query_port_ets_config
case|:
case|case
name|i40e_aqc_opc_query_switching_comp_bw_config
case|:
name|cmd_param_flag
operator|=
name|FALSE
expr_stmt|;
break|break;
default|default:
return|return
name|I40E_ERR_PARAM
return|;
block|}
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
comment|/* Indirect command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmd_param_flag
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_RD
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|vsi_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_config_vsi_bw_limit - Configure VSI BW Limit  * @hw: pointer to the hw struct  * @seid: VSI seid  * @credit: BW limit credits (0 = disabled)  * @max_credit: Max BW limit credits  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_config_vsi_bw_limit
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|u16
name|credit
parameter_list|,
name|u8
name|max_credit
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_configure_vsi_bw_limit
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_configure_vsi_bw_limit
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_configure_vsi_bw_limit
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|vsi_seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|credit
operator|=
name|CPU_TO_LE16
argument_list|(
name|credit
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|max_credit
operator|=
name|max_credit
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_config_switch_comp_bw_limit - Configure Switching component BW Limit  * @hw: pointer to the hw struct  * @seid: switching component seid  * @credit: BW limit credits (0 = disabled)  * @max_bw: Max BW limit credits  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_config_switch_comp_bw_limit
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|u16
name|credit
parameter_list|,
name|u8
name|max_bw
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_configure_switching_comp_bw_limit
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_configure_switching_comp_bw_limit
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_configure_switching_comp_bw_limit
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|credit
operator|=
name|CPU_TO_LE16
argument_list|(
name|credit
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|max_bw
operator|=
name|max_bw
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_config_vsi_ets_sla_bw_limit - Config VSI BW Limit per TC  * @hw: pointer to the hw struct  * @seid: VSI seid  * @bw_data: Buffer holding enabled TCs, per TC BW limit/credits  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_config_vsi_ets_sla_bw_limit
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_configure_vsi_ets_sla_bw_data
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_configure_vsi_ets_sla_bw_limit
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_config_vsi_tc_bw - Config VSI BW Allocation per TC  * @hw: pointer to the hw struct  * @seid: VSI seid  * @bw_data: Buffer holding enabled TCs, relative TC BW limit/credits  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_config_vsi_tc_bw
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_configure_vsi_tc_bw_data
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_configure_vsi_tc_bw
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_config_switch_comp_ets_bw_limit - Config Switch comp BW Limit per TC  * @hw: pointer to the hw struct  * @seid: seid of the switching component  * @bw_data: Buffer holding enabled TCs, per TC BW limit/credits  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_config_switch_comp_ets_bw_limit
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_configure_switching_comp_ets_bw_limit_data
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_configure_switching_comp_ets_bw_limit
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_query_vsi_bw_config - Query VSI BW configuration  * @hw: pointer to the hw struct  * @seid: seid of the VSI  * @bw_data: Buffer to hold VSI BW configuration  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_query_vsi_bw_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_query_vsi_bw_config_resp
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_query_vsi_bw_config
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_query_vsi_ets_sla_config - Query VSI BW configuration per TC  * @hw: pointer to the hw struct  * @seid: seid of the VSI  * @bw_data: Buffer to hold VSI BW configuration per TC  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_query_vsi_ets_sla_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_query_vsi_ets_sla_config_resp
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_query_vsi_ets_sla_config
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_query_switch_comp_ets_config - Query Switch comp BW config per TC  * @hw: pointer to the hw struct  * @seid: seid of the switching component  * @bw_data: Buffer to hold switching component's per TC BW config  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_query_switch_comp_ets_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_query_switching_comp_ets_config_resp
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_query_switching_comp_ets_config
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_query_port_ets_config - Query Physical Port ETS configuration  * @hw: pointer to the hw struct  * @seid: seid of the VSI or switching component connected to Physical Port  * @bw_data: Buffer to hold current ETS configuration for the Physical Port  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_query_port_ets_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_query_port_ets_config_resp
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_query_port_ets_config
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_query_switch_comp_bw_config - Query Switch comp BW configuration  * @hw: pointer to the hw struct  * @seid: seid of the switching component  * @bw_data: Buffer to hold switching component's BW configuration  * @cmd_details: pointer to command details structure or NULL  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_query_switch_comp_bw_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_query_switching_comp_bw_config_resp
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
return|return
name|i40e_aq_tx_sched_cmd
argument_list|(
name|hw
argument_list|,
name|seid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|bw_data
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
argument_list|,
name|i40e_aqc_opc_query_switching_comp_bw_config
argument_list|,
name|cmd_details
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_validate_filter_settings  * @hw: pointer to the hardware structure  * @settings: Filter control settings  *  * Check and validate the filter control settings passed.  * The function checks for the valid filter/context sizes being  * passed for FCoE and PE.  *  * Returns I40E_SUCCESS if the values passed are valid and within  * range else returns an error.  **/
end_comment

begin_function
specifier|static
name|enum
name|i40e_status_code
name|i40e_validate_filter_settings
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_filter_control_settings
modifier|*
name|settings
parameter_list|)
block|{
name|u32
name|fcoe_cntx_size
decl_stmt|,
name|fcoe_filt_size
decl_stmt|;
name|u32
name|pe_cntx_size
decl_stmt|,
name|pe_filt_size
decl_stmt|;
name|u32
name|fcoe_fmax
decl_stmt|;
name|u32
name|val
decl_stmt|;
comment|/* Validate FCoE settings passed */
switch|switch
condition|(
name|settings
operator|->
name|fcoe_filt_num
condition|)
block|{
case|case
name|I40E_HASH_FILTER_SIZE_1K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_2K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_4K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_8K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_16K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_32K
case|:
name|fcoe_filt_size
operator|=
name|I40E_HASH_FILTER_BASE_SIZE
expr_stmt|;
name|fcoe_filt_size
operator|<<=
operator|(
name|u32
operator|)
name|settings
operator|->
name|fcoe_filt_num
expr_stmt|;
break|break;
default|default:
return|return
name|I40E_ERR_PARAM
return|;
block|}
switch|switch
condition|(
name|settings
operator|->
name|fcoe_cntx_num
condition|)
block|{
case|case
name|I40E_DMA_CNTX_SIZE_512
case|:
case|case
name|I40E_DMA_CNTX_SIZE_1K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_2K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_4K
case|:
name|fcoe_cntx_size
operator|=
name|I40E_DMA_CNTX_BASE_SIZE
expr_stmt|;
name|fcoe_cntx_size
operator|<<=
operator|(
name|u32
operator|)
name|settings
operator|->
name|fcoe_cntx_num
expr_stmt|;
break|break;
default|default:
return|return
name|I40E_ERR_PARAM
return|;
block|}
comment|/* Validate PE settings passed */
switch|switch
condition|(
name|settings
operator|->
name|pe_filt_num
condition|)
block|{
case|case
name|I40E_HASH_FILTER_SIZE_1K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_2K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_4K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_8K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_16K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_32K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_64K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_128K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_256K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_512K
case|:
case|case
name|I40E_HASH_FILTER_SIZE_1M
case|:
name|pe_filt_size
operator|=
name|I40E_HASH_FILTER_BASE_SIZE
expr_stmt|;
name|pe_filt_size
operator|<<=
operator|(
name|u32
operator|)
name|settings
operator|->
name|pe_filt_num
expr_stmt|;
break|break;
default|default:
return|return
name|I40E_ERR_PARAM
return|;
block|}
switch|switch
condition|(
name|settings
operator|->
name|pe_cntx_num
condition|)
block|{
case|case
name|I40E_DMA_CNTX_SIZE_512
case|:
case|case
name|I40E_DMA_CNTX_SIZE_1K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_2K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_4K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_8K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_16K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_32K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_64K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_128K
case|:
case|case
name|I40E_DMA_CNTX_SIZE_256K
case|:
name|pe_cntx_size
operator|=
name|I40E_DMA_CNTX_BASE_SIZE
expr_stmt|;
name|pe_cntx_size
operator|<<=
operator|(
name|u32
operator|)
name|settings
operator|->
name|pe_cntx_num
expr_stmt|;
break|break;
default|default:
return|return
name|I40E_ERR_PARAM
return|;
block|}
comment|/* FCHSIZE + FCDSIZE should not be greater than PMFCOEFMAX */
name|val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_GLHMC_FCOEFMAX
argument_list|)
expr_stmt|;
name|fcoe_fmax
operator|=
operator|(
name|val
operator|&
name|I40E_GLHMC_FCOEFMAX_PMFCOEFMAX_MASK
operator|)
operator|>>
name|I40E_GLHMC_FCOEFMAX_PMFCOEFMAX_SHIFT
expr_stmt|;
if|if
condition|(
name|fcoe_filt_size
operator|+
name|fcoe_cntx_size
operator|>
name|fcoe_fmax
condition|)
return|return
name|I40E_ERR_INVALID_SIZE
return|;
return|return
name|I40E_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_set_filter_control  * @hw: pointer to the hardware structure  * @settings: Filter control settings  *  * Set the Queue Filters for PE/FCoE and enable filters required  * for a single PF. It is expected that these settings are programmed  * at the driver initialization time.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_set_filter_control
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_filter_control_settings
modifier|*
name|settings
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|ret
init|=
name|I40E_SUCCESS
decl_stmt|;
name|u32
name|hash_lut_size
init|=
literal|0
decl_stmt|;
name|u32
name|val
decl_stmt|;
if|if
condition|(
operator|!
name|settings
condition|)
return|return
name|I40E_ERR_PARAM
return|;
comment|/* Validate the input settings */
name|ret
operator|=
name|i40e_validate_filter_settings
argument_list|(
name|hw
argument_list|,
name|settings
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
comment|/* Read the PF Queue Filter control register */
name|val
operator|=
name|rd32
argument_list|(
name|hw
argument_list|,
name|I40E_PFQF_CTL_0
argument_list|)
expr_stmt|;
comment|/* Program required PE hash buckets for the PF */
name|val
operator|&=
operator|~
name|I40E_PFQF_CTL_0_PEHSIZE_MASK
expr_stmt|;
name|val
operator||=
operator|(
operator|(
name|u32
operator|)
name|settings
operator|->
name|pe_filt_num
operator|<<
name|I40E_PFQF_CTL_0_PEHSIZE_SHIFT
operator|)
operator|&
name|I40E_PFQF_CTL_0_PEHSIZE_MASK
expr_stmt|;
comment|/* Program required PE contexts for the PF */
name|val
operator|&=
operator|~
name|I40E_PFQF_CTL_0_PEDSIZE_MASK
expr_stmt|;
name|val
operator||=
operator|(
operator|(
name|u32
operator|)
name|settings
operator|->
name|pe_cntx_num
operator|<<
name|I40E_PFQF_CTL_0_PEDSIZE_SHIFT
operator|)
operator|&
name|I40E_PFQF_CTL_0_PEDSIZE_MASK
expr_stmt|;
comment|/* Program required FCoE hash buckets for the PF */
name|val
operator|&=
operator|~
name|I40E_PFQF_CTL_0_PFFCHSIZE_MASK
expr_stmt|;
name|val
operator||=
operator|(
operator|(
name|u32
operator|)
name|settings
operator|->
name|fcoe_filt_num
operator|<<
name|I40E_PFQF_CTL_0_PFFCHSIZE_SHIFT
operator|)
operator|&
name|I40E_PFQF_CTL_0_PFFCHSIZE_MASK
expr_stmt|;
comment|/* Program required FCoE DDP contexts for the PF */
name|val
operator|&=
operator|~
name|I40E_PFQF_CTL_0_PFFCDSIZE_MASK
expr_stmt|;
name|val
operator||=
operator|(
operator|(
name|u32
operator|)
name|settings
operator|->
name|fcoe_cntx_num
operator|<<
name|I40E_PFQF_CTL_0_PFFCDSIZE_SHIFT
operator|)
operator|&
name|I40E_PFQF_CTL_0_PFFCDSIZE_MASK
expr_stmt|;
comment|/* Program Hash LUT size for the PF */
name|val
operator|&=
operator|~
name|I40E_PFQF_CTL_0_HASHLUTSIZE_MASK
expr_stmt|;
if|if
condition|(
name|settings
operator|->
name|hash_lut_size
operator|==
name|I40E_HASH_LUT_SIZE_512
condition|)
name|hash_lut_size
operator|=
literal|1
expr_stmt|;
name|val
operator||=
operator|(
name|hash_lut_size
operator|<<
name|I40E_PFQF_CTL_0_HASHLUTSIZE_SHIFT
operator|)
operator|&
name|I40E_PFQF_CTL_0_HASHLUTSIZE_MASK
expr_stmt|;
comment|/* Enable FDIR, Ethertype and MACVLAN filters for PF and VFs */
if|if
condition|(
name|settings
operator|->
name|enable_fdir
condition|)
name|val
operator||=
name|I40E_PFQF_CTL_0_FD_ENA_MASK
expr_stmt|;
if|if
condition|(
name|settings
operator|->
name|enable_ethtype
condition|)
name|val
operator||=
name|I40E_PFQF_CTL_0_ETYPE_ENA_MASK
expr_stmt|;
if|if
condition|(
name|settings
operator|->
name|enable_macvlan
condition|)
name|val
operator||=
name|I40E_PFQF_CTL_0_MACVLAN_ENA_MASK
expr_stmt|;
name|wr32
argument_list|(
name|hw
argument_list|,
name|I40E_PFQF_CTL_0
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
name|I40E_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_rem_control_packet_filter - Add or Remove Control Packet Filter  * @hw: pointer to the hw struct  * @mac_addr: MAC address to use in the filter  * @ethtype: Ethertype to use in the filter  * @flags: Flags that needs to be applied to the filter  * @vsi_seid: seid of the control VSI  * @queue: VSI queue number to send the packet to  * @is_add: Add control packet filter if True else remove  * @stats: Structure to hold information on control filter counts  * @cmd_details: pointer to command details structure or NULL  *  * This command will Add or Remove control packet filter for a control VSI.  * In return it will update the total number of perfect filter count in  * the stats member.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_rem_control_packet_filter
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
modifier|*
name|mac_addr
parameter_list|,
name|u16
name|ethtype
parameter_list|,
name|u16
name|flags
parameter_list|,
name|u16
name|vsi_seid
parameter_list|,
name|u16
name|queue
parameter_list|,
name|bool
name|is_add
parameter_list|,
name|struct
name|i40e_control_filter_stats
modifier|*
name|stats
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_control_packet_filter
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_control_packet_filter
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_control_packet_filter_completion
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_control_packet_filter_completion
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|vsi_seid
operator|==
literal|0
condition|)
return|return
name|I40E_ERR_PARAM
return|;
if|if
condition|(
name|is_add
condition|)
block|{
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_control_packet_filter
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|queue
operator|=
name|CPU_TO_LE16
argument_list|(
name|queue
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_control_packet_filter
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|mac_addr
condition|)
name|i40e_memcpy
argument_list|(
name|cmd
operator|->
name|mac
argument_list|,
name|mac_addr
argument_list|,
name|I40E_ETH_LENGTH_OF_ADDRESS
argument_list|,
name|I40E_NONDMA_TO_NONDMA
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|etype
operator|=
name|CPU_TO_LE16
argument_list|(
name|ethtype
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|vsi_seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|stats
condition|)
block|{
name|stats
operator|->
name|mac_etype_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|mac_etype_used
argument_list|)
expr_stmt|;
name|stats
operator|->
name|etype_used
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|etype_used
argument_list|)
expr_stmt|;
name|stats
operator|->
name|mac_etype_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|mac_etype_free
argument_list|)
expr_stmt|;
name|stats
operator|->
name|etype_free
operator|=
name|LE16_TO_CPU
argument_list|(
name|resp
operator|->
name|etype_free
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_add_filter_to_drop_tx_flow_control_frames- filter to drop flow control  * @hw: pointer to the hw struct  * @seid: VSI seid to add ethertype filter from  **/
end_comment

begin_define
define|#
directive|define
name|I40E_FLOW_CONTROL_ETHTYPE
value|0x8808
end_define

begin_function
name|void
name|i40e_add_filter_to_drop_tx_flow_control_frames
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|)
block|{
name|u16
name|flag
init|=
name|I40E_AQC_ADD_CONTROL_PACKET_FLAGS_IGNORE_MAC
operator||
name|I40E_AQC_ADD_CONTROL_PACKET_FLAGS_DROP
operator||
name|I40E_AQC_ADD_CONTROL_PACKET_FLAGS_TX
decl_stmt|;
name|u16
name|ethtype
init|=
name|I40E_FLOW_CONTROL_ETHTYPE
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|status
operator|=
name|i40e_aq_add_rem_control_packet_filter
argument_list|(
name|hw
argument_list|,
name|NULL
argument_list|,
name|ethtype
argument_list|,
name|flag
argument_list|,
name|seid
argument_list|,
literal|0
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
name|DEBUGOUT
argument_list|(
literal|"Ethtype Filter Add failed: Error pruning Tx flow control frames\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_add_cloud_filters  * @hw: pointer to the hardware structure  * @seid: VSI seid to add cloud filters from  * @filters: Buffer which contains the filters to be added  * @filter_count: number of filters contained in the buffer  *  * Set the cloud filters for a given VSI.  The contents of the  * i40e_aqc_add_remove_cloud_filters_element_data are filled  * in by the caller of the function.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_add_cloud_filters
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_add_remove_cloud_filters_element_data
modifier|*
name|filters
parameter_list|,
name|u8
name|filter_count
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_cloud_filters
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_cloud_filters
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|u16
name|buff_len
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_add_cloud_filters
argument_list|)
expr_stmt|;
name|buff_len
operator|=
name|filter_count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|filters
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_len
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_filters
operator|=
name|filter_count
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|filters
argument_list|,
name|buff_len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_remove_cloud_filters  * @hw: pointer to the hardware structure  * @seid: VSI seid to remove cloud filters from  * @filters: Buffer which contains the filters to be removed  * @filter_count: number of filters contained in the buffer  *  * Remove the cloud filters for a given VSI.  The contents of the  * i40e_aqc_add_remove_cloud_filters_element_data are filled  * in by the caller of the function.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_remove_cloud_filters
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|seid
parameter_list|,
name|struct
name|i40e_aqc_add_remove_cloud_filters_element_data
modifier|*
name|filters
parameter_list|,
name|u8
name|filter_count
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_add_remove_cloud_filters
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_add_remove_cloud_filters
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u16
name|buff_len
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_remove_cloud_filters
argument_list|)
expr_stmt|;
name|buff_len
operator|=
name|filter_count
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|filters
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_len
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|num_filters
operator|=
name|filter_count
expr_stmt|;
name|cmd
operator|->
name|seid
operator|=
name|CPU_TO_LE16
argument_list|(
name|seid
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|filters
argument_list|,
name|buff_len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_alternate_write  * @hw: pointer to the hardware structure  * @reg_addr0: address of first dword to be read  * @reg_val0: value to be written under 'reg_addr0'  * @reg_addr1: address of second dword to be read  * @reg_val1: value to be written under 'reg_addr1'  *  * Write one or two dwords to alternate structure. Fields are indicated  * by 'reg_addr0' and 'reg_addr1' register numbers.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_alternate_write
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|reg_addr0
parameter_list|,
name|u32
name|reg_val0
parameter_list|,
name|u32
name|reg_addr1
parameter_list|,
name|u32
name|reg_val1
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_alternate_write
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_alternate_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_write
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address0
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_addr0
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address1
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_addr1
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|data0
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_val0
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|data1
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_val1
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_alternate_write_indirect  * @hw: pointer to the hardware structure  * @addr: address of a first register to be modified  * @dw_count: number of alternate structure fields to write  * @buffer: pointer to the command buffer  *  * Write 'dw_count' dwords from 'buffer' to alternate structure  * starting at 'addr'.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_alternate_write_indirect
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|addr
parameter_list|,
name|u32
name|dw_count
parameter_list|,
name|void
modifier|*
name|buffer
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_alternate_ind_write
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_alternate_ind_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buffer
operator|==
name|NULL
condition|)
return|return
name|I40E_ERR_PARAM
return|;
comment|/* Indirect command */
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_write_indirect
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_FLAG_RD
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|dw_count
operator|>
operator|(
name|I40E_AQ_LARGE_BUF
operator|/
literal|4
operator|)
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address
operator|=
name|CPU_TO_LE32
argument_list|(
name|addr
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|length
operator|=
name|CPU_TO_LE32
argument_list|(
name|dw_count
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buffer
argument_list|,
name|I40E_LO_DWORD
argument_list|(
literal|4
operator|*
name|dw_count
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_alternate_read  * @hw: pointer to the hardware structure  * @reg_addr0: address of first dword to be read  * @reg_val0: pointer for data read from 'reg_addr0'  * @reg_addr1: address of second dword to be read  * @reg_val1: pointer for data read from 'reg_addr1'  *  * Read one or two dwords from alternate structure. Fields are indicated  * by 'reg_addr0' and 'reg_addr1' register numbers. If 'reg_val1' pointer  * is not passed then only register at 'reg_addr0' is read.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_alternate_read
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|reg_addr0
parameter_list|,
name|u32
modifier|*
name|reg_val0
parameter_list|,
name|u32
name|reg_addr1
parameter_list|,
name|u32
modifier|*
name|reg_val1
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_alternate_write
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_alternate_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|reg_val0
operator|==
name|NULL
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_read
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address0
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_addr0
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address1
operator|=
name|CPU_TO_LE32
argument_list|(
name|reg_addr1
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|I40E_SUCCESS
condition|)
block|{
operator|*
name|reg_val0
operator|=
name|LE32_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|data0
argument_list|)
expr_stmt|;
if|if
condition|(
name|reg_val1
operator|!=
name|NULL
condition|)
operator|*
name|reg_val1
operator|=
name|LE32_TO_CPU
argument_list|(
name|cmd_resp
operator|->
name|data1
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_alternate_read_indirect  * @hw: pointer to the hardware structure  * @addr: address of the alternate structure field  * @dw_count: number of alternate structure fields to read  * @buffer: pointer to the command buffer  *  * Read 'dw_count' dwords from alternate structure starting at 'addr' and  * place them in 'buffer'. The buffer should be allocated by caller.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_alternate_read_indirect
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
name|addr
parameter_list|,
name|u32
name|dw_count
parameter_list|,
name|void
modifier|*
name|buffer
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_alternate_ind_write
modifier|*
name|cmd_resp
init|=
operator|(
expr|struct
name|i40e_aqc_alternate_ind_write
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buffer
operator|==
name|NULL
condition|)
return|return
name|I40E_ERR_PARAM
return|;
comment|/* Indirect command */
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_read_indirect
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_FLAG_RD
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|dw_count
operator|>
operator|(
name|I40E_AQ_LARGE_BUF
operator|/
literal|4
operator|)
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|address
operator|=
name|CPU_TO_LE32
argument_list|(
name|addr
argument_list|)
expr_stmt|;
name|cmd_resp
operator|->
name|length
operator|=
name|CPU_TO_LE32
argument_list|(
name|dw_count
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buffer
argument_list|,
name|I40E_LO_DWORD
argument_list|(
literal|4
operator|*
name|dw_count
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  *  i40e_aq_alternate_clear  *  @hw: pointer to the HW structure.  *  *  Clear the alternate structures of the port from which the function  *  is called.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_alternate_clear
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_clear_port
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  *  i40e_aq_alternate_write_done  *  @hw: pointer to the HW structure.  *  @bios_mode: indicates whether the command is executed by UEFI or legacy BIOS  *  @reset_needed: indicates the SW should trigger GLOBAL reset  *  *  Indicates to the FW that alternate structures have been changed.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_alternate_write_done
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|bios_mode
parameter_list|,
name|bool
modifier|*
name|reset_needed
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_alternate_write_done
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_alternate_write_done
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|reset_needed
operator|==
name|NULL
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_write_done
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|cmd_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|bios_mode
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
operator|&&
name|reset_needed
condition|)
operator|*
name|reset_needed
operator|=
operator|(
operator|(
name|LE16_TO_CPU
argument_list|(
name|cmd
operator|->
name|cmd_flags
argument_list|)
operator|&
name|I40E_AQ_ALTERNATE_RESET_NEEDED
operator|)
operator|!=
literal|0
operator|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  *  i40e_aq_set_oem_mode  *  @hw: pointer to the HW structure.  *  @oem_mode: the OEM mode to be used  *  *  Sets the device to a specific operating mode. Currently the only supported  *  mode is no_clp, which causes FW to refrain from using Alternate RAM.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_set_oem_mode
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|oem_mode
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_alternate_write_done
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_alternate_write_done
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_alternate_set_mode
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|cmd_flags
operator|=
name|CPU_TO_LE16
argument_list|(
name|oem_mode
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_resume_port_tx  * @hw: pointer to the hardware structure  * @cmd_details: pointer to command details structure or NULL  *  * Resume port's Tx traffic  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_resume_port_tx
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_resume_port_tx
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_set_pci_config_data - store PCI bus info  * @hw: pointer to hardware structure  * @link_status: the link status word from PCI config space  *  * Stores the PCI bus info (speed, width, type) within the i40e_hw structure  **/
end_comment

begin_function
name|void
name|i40e_set_pci_config_data
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u16
name|link_status
parameter_list|)
block|{
name|hw
operator|->
name|bus
operator|.
name|type
operator|=
name|i40e_bus_type_pci_express
expr_stmt|;
switch|switch
condition|(
name|link_status
operator|&
name|I40E_PCI_LINK_WIDTH
condition|)
block|{
case|case
name|I40E_PCI_LINK_WIDTH_1
case|:
name|hw
operator|->
name|bus
operator|.
name|width
operator|=
name|i40e_bus_width_pcie_x1
expr_stmt|;
break|break;
case|case
name|I40E_PCI_LINK_WIDTH_2
case|:
name|hw
operator|->
name|bus
operator|.
name|width
operator|=
name|i40e_bus_width_pcie_x2
expr_stmt|;
break|break;
case|case
name|I40E_PCI_LINK_WIDTH_4
case|:
name|hw
operator|->
name|bus
operator|.
name|width
operator|=
name|i40e_bus_width_pcie_x4
expr_stmt|;
break|break;
case|case
name|I40E_PCI_LINK_WIDTH_8
case|:
name|hw
operator|->
name|bus
operator|.
name|width
operator|=
name|i40e_bus_width_pcie_x8
expr_stmt|;
break|break;
default|default:
name|hw
operator|->
name|bus
operator|.
name|width
operator|=
name|i40e_bus_width_unknown
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|link_status
operator|&
name|I40E_PCI_LINK_SPEED
condition|)
block|{
case|case
name|I40E_PCI_LINK_SPEED_2500
case|:
name|hw
operator|->
name|bus
operator|.
name|speed
operator|=
name|i40e_bus_speed_2500
expr_stmt|;
break|break;
case|case
name|I40E_PCI_LINK_SPEED_5000
case|:
name|hw
operator|->
name|bus
operator|.
name|speed
operator|=
name|i40e_bus_speed_5000
expr_stmt|;
break|break;
case|case
name|I40E_PCI_LINK_SPEED_8000
case|:
name|hw
operator|->
name|bus
operator|.
name|speed
operator|=
name|i40e_bus_speed_8000
expr_stmt|;
break|break;
default|default:
name|hw
operator|->
name|bus
operator|.
name|speed
operator|=
name|i40e_bus_speed_unknown
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/**  * i40e_aq_debug_dump  * @hw: pointer to the hardware structure  * @cluster_id: specific cluster to dump  * @table_id: table id within cluster  * @start_index: index of line in the block to read  * @buff_size: dump buffer size  * @buff: dump buffer  * @ret_buff_size: actual buffer size returned  * @ret_next_table: next block to read  * @ret_next_index: next index to read  *  * Dump internal FW/HW data for debug purposes.  *  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_debug_dump
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u8
name|cluster_id
parameter_list|,
name|u8
name|table_id
parameter_list|,
name|u32
name|start_index
parameter_list|,
name|u16
name|buff_size
parameter_list|,
name|void
modifier|*
name|buff
parameter_list|,
name|u16
modifier|*
name|ret_buff_size
parameter_list|,
name|u8
modifier|*
name|ret_next_table
parameter_list|,
name|u32
modifier|*
name|ret_next_index
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_aqc_debug_dump_internals
modifier|*
name|cmd
init|=
operator|(
expr|struct
name|i40e_aqc_debug_dump_internals
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|struct
name|i40e_aqc_debug_dump_internals
modifier|*
name|resp
init|=
operator|(
expr|struct
name|i40e_aqc_debug_dump_internals
operator|*
operator|)
operator|&
name|desc
operator|.
name|params
operator|.
name|raw
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
if|if
condition|(
name|buff_size
operator|==
literal|0
operator|||
operator|!
name|buff
condition|)
return|return
name|I40E_ERR_PARAM
return|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_debug_dump_internals
argument_list|)
expr_stmt|;
comment|/* Indirect Command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|cmd
operator|->
name|cluster_id
operator|=
name|cluster_id
expr_stmt|;
name|cmd
operator|->
name|table_id
operator|=
name|table_id
expr_stmt|;
name|cmd
operator|->
name|idx
operator|=
name|CPU_TO_LE32
argument_list|(
name|start_index
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|buff_size
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|buff
argument_list|,
name|buff_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|status
condition|)
block|{
if|if
condition|(
name|ret_buff_size
operator|!=
name|NULL
condition|)
operator|*
name|ret_buff_size
operator|=
name|LE16_TO_CPU
argument_list|(
name|desc
operator|.
name|datalen
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret_next_table
operator|!=
name|NULL
condition|)
operator|*
name|ret_next_table
operator|=
name|resp
operator|->
name|table_id
expr_stmt|;
if|if
condition|(
name|ret_next_index
operator|!=
name|NULL
condition|)
operator|*
name|ret_next_index
operator|=
name|LE32_TO_CPU
argument_list|(
name|resp
operator|->
name|idx
argument_list|)
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_read_bw_from_alt_ram  * @hw: pointer to the hardware structure  * @max_bw: pointer for max_bw read  * @min_bw: pointer for min_bw read  * @min_valid: pointer for bool that is TRUE if min_bw is a valid value  * @max_valid: pointer for bool that is TRUE if max_bw is a valid value  *  * Read bw from the alternate ram for the given pf  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_read_bw_from_alt_ram
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|u32
modifier|*
name|max_bw
parameter_list|,
name|u32
modifier|*
name|min_bw
parameter_list|,
name|bool
modifier|*
name|min_valid
parameter_list|,
name|bool
modifier|*
name|max_valid
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|u32
name|max_bw_addr
decl_stmt|,
name|min_bw_addr
decl_stmt|;
comment|/* Calculate the address of the min/max bw registers */
name|max_bw_addr
operator|=
name|I40E_ALT_STRUCT_FIRST_PF_OFFSET
operator|+
name|I40E_ALT_STRUCT_MAX_BW_OFFSET
operator|+
operator|(
name|I40E_ALT_STRUCT_DWORDS_PER_PF
operator|*
name|hw
operator|->
name|pf_id
operator|)
expr_stmt|;
name|min_bw_addr
operator|=
name|I40E_ALT_STRUCT_FIRST_PF_OFFSET
operator|+
name|I40E_ALT_STRUCT_MIN_BW_OFFSET
operator|+
operator|(
name|I40E_ALT_STRUCT_DWORDS_PER_PF
operator|*
name|hw
operator|->
name|pf_id
operator|)
expr_stmt|;
comment|/* Read the bandwidths from alt ram */
name|status
operator|=
name|i40e_aq_alternate_read
argument_list|(
name|hw
argument_list|,
name|max_bw_addr
argument_list|,
name|max_bw
argument_list|,
name|min_bw_addr
argument_list|,
name|min_bw
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|min_bw
operator|&
name|I40E_ALT_BW_VALID_MASK
condition|)
operator|*
name|min_valid
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|min_valid
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|*
name|max_bw
operator|&
name|I40E_ALT_BW_VALID_MASK
condition|)
operator|*
name|max_valid
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|max_valid
operator|=
name|FALSE
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_configure_partition_bw  * @hw: pointer to the hardware structure  * @bw_data: Buffer holding valid pfs and bw limits  * @cmd_details: pointer to command details  *  * Configure partitions guaranteed/max bw  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_configure_partition_bw
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_aqc_configure_partition_bw_data
modifier|*
name|bw_data
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|u16
name|bwd_size
init|=
sizeof|sizeof
argument_list|(
operator|*
name|bw_data
argument_list|)
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_configure_partition_bw
argument_list|)
expr_stmt|;
comment|/* Indirect command */
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_BUF
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_RD
argument_list|)
expr_stmt|;
if|if
condition|(
name|bwd_size
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|bwd_size
argument_list|)
expr_stmt|;
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|&
name|desc
argument_list|,
name|bw_data
argument_list|,
name|bwd_size
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_aq_send_msg_to_pf  * @hw: pointer to the hardware structure  * @v_opcode: opcodes for VF-PF communication  * @v_retval: return error code  * @msg: pointer to the msg buffer  * @msglen: msg length  * @cmd_details: pointer to command details  *  * Send message to PF driver using admin queue. By default, this message  * is sent asynchronously, i.e. i40e_asq_send_command() does not wait for  * completion before returning.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_aq_send_msg_to_pf
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|enum
name|i40e_virtchnl_ops
name|v_opcode
parameter_list|,
name|enum
name|i40e_status_code
name|v_retval
parameter_list|,
name|u8
modifier|*
name|msg
parameter_list|,
name|u16
name|msglen
parameter_list|,
name|struct
name|i40e_asq_cmd_details
modifier|*
name|cmd_details
parameter_list|)
block|{
name|struct
name|i40e_aq_desc
name|desc
decl_stmt|;
name|struct
name|i40e_asq_cmd_details
name|details
decl_stmt|;
name|enum
name|i40e_status_code
name|status
decl_stmt|;
name|i40e_fill_default_direct_cmd_desc
argument_list|(
operator|&
name|desc
argument_list|,
name|i40e_aqc_opc_send_msg_to_pf
argument_list|)
expr_stmt|;
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_SI
argument_list|)
expr_stmt|;
name|desc
operator|.
name|cookie_high
operator|=
name|CPU_TO_LE32
argument_list|(
name|v_opcode
argument_list|)
expr_stmt|;
name|desc
operator|.
name|cookie_low
operator|=
name|CPU_TO_LE32
argument_list|(
name|v_retval
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
condition|)
block|{
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
call|(
name|u16
call|)
argument_list|(
name|I40E_AQ_FLAG_BUF
operator||
name|I40E_AQ_FLAG_RD
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
operator|>
name|I40E_AQ_LARGE_BUF
condition|)
name|desc
operator|.
name|flags
operator||=
name|CPU_TO_LE16
argument_list|(
operator|(
name|u16
operator|)
name|I40E_AQ_FLAG_LB
argument_list|)
expr_stmt|;
name|desc
operator|.
name|datalen
operator|=
name|CPU_TO_LE16
argument_list|(
name|msglen
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|cmd_details
condition|)
block|{
name|i40e_memset
argument_list|(
operator|&
name|details
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|details
argument_list|)
argument_list|,
name|I40E_NONDMA_MEM
argument_list|)
expr_stmt|;
name|details
operator|.
name|async
operator|=
name|TRUE
expr_stmt|;
name|cmd_details
operator|=
operator|&
name|details
expr_stmt|;
block|}
name|status
operator|=
name|i40e_asq_send_command
argument_list|(
name|hw
argument_list|,
operator|(
expr|struct
name|i40e_aq_desc
operator|*
operator|)
operator|&
name|desc
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|,
name|cmd_details
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * i40e_vf_parse_hw_config  * @hw: pointer to the hardware structure  * @msg: pointer to the virtual channel VF resource structure  *  * Given a VF resource message from the PF, populate the hw struct  * with appropriate information.  **/
end_comment

begin_function
name|void
name|i40e_vf_parse_hw_config
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|,
name|struct
name|i40e_virtchnl_vf_resource
modifier|*
name|msg
parameter_list|)
block|{
name|struct
name|i40e_virtchnl_vsi_resource
modifier|*
name|vsi_res
decl_stmt|;
name|int
name|i
decl_stmt|;
name|vsi_res
operator|=
operator|&
name|msg
operator|->
name|vsi_res
index|[
literal|0
index|]
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|num_vsis
operator|=
name|msg
operator|->
name|num_vsis
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|num_rx_qp
operator|=
name|msg
operator|->
name|num_queue_pairs
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|num_tx_qp
operator|=
name|msg
operator|->
name|num_queue_pairs
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|num_msix_vectors_vf
operator|=
name|msg
operator|->
name|max_vectors
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|dcb
operator|=
name|msg
operator|->
name|vf_offload_flags
operator|&
name|I40E_VIRTCHNL_VF_OFFLOAD_L2
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|fcoe
operator|=
operator|(
name|msg
operator|->
name|vf_offload_flags
operator|&
name|I40E_VIRTCHNL_VF_OFFLOAD_FCOE
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|hw
operator|->
name|dev_caps
operator|.
name|iwarp
operator|=
operator|(
name|msg
operator|->
name|vf_offload_flags
operator|&
name|I40E_VIRTCHNL_VF_OFFLOAD_IWARP
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|msg
operator|->
name|num_vsis
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|vsi_res
operator|->
name|vsi_type
operator|==
name|I40E_VSI_SRIOV
condition|)
block|{
name|i40e_memcpy
argument_list|(
name|hw
operator|->
name|mac
operator|.
name|perm_addr
argument_list|,
name|vsi_res
operator|->
name|default_mac_addr
argument_list|,
name|I40E_ETH_LENGTH_OF_ADDRESS
argument_list|,
name|I40E_NONDMA_TO_NONDMA
argument_list|)
expr_stmt|;
name|i40e_memcpy
argument_list|(
name|hw
operator|->
name|mac
operator|.
name|addr
argument_list|,
name|vsi_res
operator|->
name|default_mac_addr
argument_list|,
name|I40E_ETH_LENGTH_OF_ADDRESS
argument_list|,
name|I40E_NONDMA_TO_NONDMA
argument_list|)
expr_stmt|;
block|}
name|vsi_res
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * i40e_vf_reset  * @hw: pointer to the hardware structure  *  * Send a VF_RESET message to the PF. Does not wait for response from PF  * as none will be forthcoming. Immediately after calling this function,  * the admin queue should be shut down and (optionally) reinitialized.  **/
end_comment

begin_function
name|enum
name|i40e_status_code
name|i40e_vf_reset
parameter_list|(
name|struct
name|i40e_hw
modifier|*
name|hw
parameter_list|)
block|{
return|return
name|i40e_aq_send_msg_to_pf
argument_list|(
name|hw
argument_list|,
name|I40E_VIRTCHNL_OP_RESET_VF
argument_list|,
name|I40E_SUCCESS
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_function

end_unit

