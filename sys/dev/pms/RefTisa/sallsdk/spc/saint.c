begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************* *Copyright (c) 2014 PMC-Sierra, Inc.  All rights reserved.  * *Redistribution and use in source and binary forms, with or without modification, are permitted provided  *that the following conditions are met:  *1. Redistributions of source code must retain the above copyright notice, this list of conditions and the *following disclaimer.  *2. Redistributions in binary form must reproduce the above copyright notice,  *this list of conditions and the following disclaimer in the documentation and/or other materials provided *with the distribution.  * *THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED  *WARRANTIES,INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS *FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE *FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  *NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR  *BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  *LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  *SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE  ********************************************************************************/
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_comment
comment|/*! \file saint.c  *  \brief The file implements the functions to handle/enable/disable interrupt  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/pms/config.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sallsdk/spc/saglobal.h>
end_include

begin_define
define|#
directive|define
name|SA_CLEAR_ODCR_IN_INTERRUPT
end_define

begin_comment
comment|//#define SA_TEST_FW_SPURIOUS_INT
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SA_TEST_FW_SPURIOUS_INT
end_ifdef

begin_decl_stmt
name|bit32
name|gOurIntCount
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bit32
name|gSpuriousIntCount
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bit32
name|gSpuriousInt
index|[
literal|64
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bit32
name|gSpuriousInt1
index|[
literal|64
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SA_TEST_FW_SPURIOUS_INT */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SA_ENABLE_TRACE_FUNCTIONS
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|siTraceFileID
end_ifdef

begin_undef
undef|#
directive|undef
name|siTraceFileID
end_undef

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* siTraceFileID */
end_comment

begin_define
define|#
directive|define
name|siTraceFileID
value|'G'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SA_ENABLE_TRACE_FUNCTIONS */
end_comment

begin_function_decl
name|LOCAL
name|FORCEINLINE
name|bit32
name|siProcessOBMsg
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|count
parameter_list|,
name|bit32
name|queueNum
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|LOCAL
name|bit32
name|siFatalInterruptHandler
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
name|agNULL
decl_stmt|;
name|agsaFatalErrorInfo_t
name|fatal_error
decl_stmt|;
name|bit32
name|value
decl_stmt|;
name|bit32
name|ret
init|=
name|AGSA_RC_FAILURE
decl_stmt|;
name|bit32
name|Sendfatal
init|=
name|agTRUE
decl_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|agNULL
operator|!=
name|agRoot
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|agRoot
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: agRoot == agNULL\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
name|saRoot
operator|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|agNULL
operator|!=
name|saRoot
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: saRoot == agNULL\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_1
argument_list|,
name|MSGU_SCRATCH_PAD_1
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|->
name|ResetFailed
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: ResetFailed\n"
operator|)
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
if|if
condition|(
name|SCRATCH_PAD1_V_ERROR_STATE
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|si_memset
argument_list|(
operator|&
name|fatal_error
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|agsaFatalErrorInfo_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* read detail fatal errors */
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_0
argument_list|,
name|MSGU_SCRATCH_PAD_0
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo0
operator|=
name|value
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: ScratchPad0 AAP error 0x%x code 0x%x\n"
operator|,
name|SCRATCH_PAD1_V_ERROR_STATE
argument_list|(
name|value
argument_list|)
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_1
argument_list|,
name|MSGU_SCRATCH_PAD_1
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo1
operator|=
name|value
expr_stmt|;
comment|/* AAP error state */
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: AAP error state and error code 0x%x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_2
argument_list|,
name|MSGU_SCRATCH_PAD_2
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo2
operator|=
name|value
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2 0x%08x\n"
operator|,
name|fatal_error
operator|.
name|errorInfo2
operator|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_ILA_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler:SCRATCH_PAD1_V_ERROR_STATE SCRATCH_PAD2_FW_ILA_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_ILA_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_FLM_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_FLM_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_FLM_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_FW_ASRT_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_FW_ASRT_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_FW_ASRT_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_WDG_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_HW_WDG_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_HW_WDG_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_GEN_EXCEPTION_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_GEN_EXCEPTION_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_GEN_EXCEPTION_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_UNDTMN_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_UNDTMN_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_UNDTMN_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_FATAL_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_HW_FATAL_ERR 0x%08x\n"
operator|,
name|SCRATCH_PAD2_FW_HW_FATAL_ERR
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_PCS_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_PCS_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_GSM_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_GSM_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP0_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP0_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP1_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP1_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP2_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP2_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_ERAAE_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_ERAAE_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_SDS_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_SDS_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_PCIE_CORE_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_PCIE_CORE_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_PCIE_AL_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_PCIE_AL_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_MSGU_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_MSGU_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_SPBC_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_SPBC_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_BDMA_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_BDMA_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_MCPSL2B_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_MCPSL2B_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_MCPSDC_ERR
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_MCPSDC_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_MASK
operator|)
operator|==
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_UNDETERMINED_ERROR_OCCURRED
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_HW_ERROR_INT_INDX_UNDETERMINED_ERROR_OCCURRED 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SALLSDK_DEBUG */
if|if
condition|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_NON_FATAL_ERR
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_ILA_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_FLM_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_FW_ASRT_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_WDG_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_GEN_EXCEPTION_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_UNDTMN_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_PCS_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_GSM_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP0_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_OSSP2_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_ERAAE_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_SDS_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_PCIE_CORE_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_PCIE_AL_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_MSGU_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_SPBC_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_BDMA_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_MCPSL2B_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_MCPSDC_ERR
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_HW_ERROR_INT_INDX_UNDETERMINED_ERROR_OCCURRED
operator|)
operator|&&
operator|!
operator|(
name|fatal_error
operator|.
name|errorInfo2
operator|&
name|SCRATCH_PAD2_FW_HW_FATAL_ERR
operator|)
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: SCRATCH_PAD2_FW_HW_NON_FATAL_ERR 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|Sendfatal
operator|=
name|agFALSE
expr_stmt|;
block|}
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_3
argument_list|,
name|MSGU_SCRATCH_PAD_3
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: ScratchPad3 IOP error code 0x%08x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo3
operator|=
name|value
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|saRoot
condition|)
block|{
name|fatal_error
operator|.
name|regDumpBusBaseNum0
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|regDumpPCIBAR
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset0
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpOffset0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen0
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpLength0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpBusBaseNum1
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|regDumpPCIBAR
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset1
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpOffset1
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen1
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpLength1
expr_stmt|;
block|}
else|else
block|{
name|fatal_error
operator|.
name|regDumpBusBaseNum0
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset0
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen0
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpBusBaseNum1
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset1
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen1
operator|=
literal|0
expr_stmt|;
block|}
comment|/* Call Back with error */
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: Sendfatal %x HostR0 0x%x\n"
operator|,
name|Sendfatal
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_Rsvd_0_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler:  ScratchPad2 0x%x ScratchPad3 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Host_Scratchpad_2_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Host_Scratchpad_3_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ossaHwCB
argument_list|(
name|agRoot
argument_list|,
name|agNULL
argument_list|,
name|OSSA_HW_EVENT_MALFUNCTION
argument_list|,
name|Sendfatal
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|fatal_error
argument_list|,
name|agNULL
argument_list|)
expr_stmt|;
name|ret
operator|=
name|AGSA_RC_SUCCESS
expr_stmt|;
block|}
else|else
block|{
name|bit32
name|host_reg0
decl_stmt|;
name|host_reg0
operator|=
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_Rsvd_0_Register
argument_list|)
expr_stmt|;
if|if
condition|(
name|host_reg0
operator|==
literal|0x2
condition|)
block|{
name|Sendfatal
operator|=
name|agFALSE
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: Non fatal ScratchPad1 0x%x HostR0 0x%x\n"
operator|,
name|value
operator|,
name|host_reg0
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler:  ScratchPad0 0x%x ScratchPad1 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_0_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_1_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler:  ScratchPad2 0x%x ScratchPad3 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_2_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_3_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ossaHwCB
argument_list|(
name|agRoot
argument_list|,
name|agNULL
argument_list|,
name|OSSA_HW_EVENT_MALFUNCTION
argument_list|,
name|Sendfatal
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|fatal_error
argument_list|,
name|agNULL
argument_list|)
expr_stmt|;
name|ret
operator|=
name|AGSA_RC_SUCCESS
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|host_reg0
operator|==
name|HDA_AES_DIF_FUNC
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: HDA_AES_DIF_FUNC 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_Rsvd_0_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|Sendfatal
operator|=
name|agFALSE
expr_stmt|;
name|ret
operator|=
name|AGSA_RC_SUCCESS
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: No error detected ScratchPad1 0x%x HostR0 0x%x\n"
operator|,
name|value
operator|,
name|host_reg0
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler:  ScratchPad0 0x%x ScratchPad1 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_0_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_1_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler:  ScratchPad2 0x%x ScratchPad3 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_2_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_3_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: Doorbell_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siFatalInterruptHandler: Doorbell_Mask %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|AGSA_RC_FAILURE
expr_stmt|;
block|}
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|GLOBAL
name|bit32
name|saFatalInterruptHandler
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
name|agNULL
decl_stmt|;
name|bit32
name|ret
init|=
name|AGSA_RC_FAILURE
decl_stmt|;
comment|/* sanity check */
name|SA_ASSERT
argument_list|(
operator|(
name|agNULL
operator|!=
name|agRoot
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|saRoot
operator|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|agNULL
operator|!=
name|saRoot
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|->
name|ResetFailed
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saFatalInterruptHandler: ResetFailed\n"
operator|)
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptEnable
operator|!=
literal|1
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saFatalInterruptHandler: fatalErrorInterrtupt is NOT enabled\n"
operator|)
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptVector
operator|!=
name|interruptVectorIndex
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saFatalInterruptHandler: interruptVectorIndex does not match 0x%x 0x%x\n"
operator|,
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptVector
operator|,
name|interruptVectorIndex
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saFatalInterruptHandler:  ScratchPad0 0x%x ScratchPad1 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_0_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_1_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saFatalInterruptHandler:  ScratchPad2 0x%x ScratchPad3 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_2_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_3_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
name|ret
operator|=
name|siFatalInterruptHandler
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process the interrupts  *  *  The saInterruptHandler() function is called after an interrupts has  *  been received  *  This function disables interrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex message that caused MSI message  *  *  \return TRUE if we caused interrupt  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|FORCEINLINE
name|bit32
name|saInterruptHandler
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|bit32
name|ToBeProcessedCount
init|=
literal|0
decl_stmt|;
name|bit32
name|our_int
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|SA_TEST_FW_SPURIOUS_INT
name|bit8
name|i
decl_stmt|;
endif|#
directive|endif
comment|/* SA_TEST_FW_SPURIOUS_INT */
if|if
condition|(
name|agNULL
operator|==
name|saRoot
condition|)
block|{
comment|/* Can be called before initialize is completed in a shared        interrupt environment like windows 2003     */
return|return
operator|(
name|ToBeProcessedCount
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|our_int
operator|=
name|saRoot
operator|->
name|OurInterrupt
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
operator|)
operator|==
name|FALSE
condition|)
block|{
ifdef|#
directive|ifdef
name|SA_TEST_FW_SPURIOUS_INT
name|gSpuriousIntCount
operator|++
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_REGISTERS
argument_list|,
literal|"S1"
argument_list|,
name|gSpuriousIntCount
argument_list|)
expr_stmt|;
comment|/* TP:S1 gSpuriousIntCount */
endif|#
directive|endif
comment|/* SA_TEST_FW_SPURIOUS_INT */
return|return
operator|(
name|ToBeProcessedCount
operator|)
return|;
block|}
name|smTraceFuncEnter
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|"5q"
argument_list|)
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|"VI"
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
comment|/* TP:Vi interrupt VectorIndex */
if|if
condition|(
name|agFALSE
operator|==
name|saRoot
operator|->
name|sysIntsActive
condition|)
block|{
comment|// SA_ASSERT(0, "saInterruptHandler sysIntsActive not set");
ifdef|#
directive|ifdef
name|SA_PRINTOUT_IN_WINDBG
ifndef|#
directive|ifndef
name|DBG
name|DbgPrint
argument_list|(
literal|"saInterruptHandler: sysIntsActive not set Doorbell_Mask_Set  %08X U %08X\n"
argument_list|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
argument_list|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DBG  */
endif|#
directive|endif
comment|/* SA_PRINTOUT_IN_WINDBG  */
name|SA_DBG1
argument_list|(
operator|(
literal|"saInterruptHandler: Doorbell_Mask_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
return|return
operator|(
name|ToBeProcessedCount
operator|)
return|;
block|}
comment|/* Allow replacement of disable interrupt */
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_TEST_FW_SPURIOUS_INT
comment|/* count for my interrupt */
name|gOurIntCount
operator|++
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_REGISTERS
argument_list|,
literal|"S4"
argument_list|,
name|gOurIntCount
argument_list|)
expr_stmt|;
comment|/* TP:S4 gOurIntCount */
endif|#
directive|endif
comment|/* SA_TEST_FW_SPURIOUS_INT */
name|smTraceFuncExit
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|'a'
argument_list|,
literal|"5q"
argument_list|)
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to disable MSIX interrupts  *  *  siDisableMSIXInterrupts disables interrupts  *  called thru macro ossaDisableInterrupts  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siDisableMSIXInterrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|msi_index
decl_stmt|;
ifndef|#
directive|ifndef
name|SA_CLEAR_ODCR_IN_INTERRUPT
name|bit32
name|value
decl_stmt|;
endif|#
directive|endif
comment|/* SA_CLEAR_ODCR_IN_INTERRUPT */
name|msi_index
operator|=
name|interruptVectorIndex
operator|*
name|MSIX_TABLE_ELEMENT_SIZE
expr_stmt|;
name|msi_index
operator|+=
name|MSIX_TABLE_BASE
expr_stmt|;
name|ossaHwRegWrite
argument_list|(
name|agRoot
argument_list|,
name|msi_index
argument_list|,
name|MSIX_INTERRUPT_DISABLE
argument_list|)
expr_stmt|;
name|ossaHwRegRead
argument_list|(
name|agRoot
argument_list|,
name|msi_index
argument_list|)
expr_stmt|;
comment|/* Dummy read */
ifndef|#
directive|ifndef
name|SA_CLEAR_ODCR_IN_INTERRUPT
name|value
operator|=
operator|(
literal|1
operator|<<
name|interruptVectorIndex
operator|)
expr_stmt|;
name|ossaHwRegWrite
argument_list|(
name|agRoot
argument_list|,
name|MSGU_ODCR
argument_list|,
name|value
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SA_CLEAR_ODCR_IN_INTERRUPT */
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to disable MSIX V interrupts  *  *  siDisableMSIXInterrupts disables interrupts  *  called thru macro ossaDisableInterrupts  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|void
name|siDisableMSIX_V_Interrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit64
name|mask
decl_stmt|;
name|agsabit32bit64
name|u64
decl_stmt|;
name|mask
operator|=
operator|(
operator|(
name|bit64
operator|)
literal|1
operator|<<
name|interruptVectorIndex
operator|)
expr_stmt|;
name|u64
operator|.
name|B64
operator|=
name|mask
expr_stmt|;
if|if
condition|(
name|smIS64bInt
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|SA_DBG4
argument_list|(
operator|(
literal|"siDisableMSIX_V_Interrupts: VI %d U 0x%08X L 0x%08X\n"
operator|,
name|interruptVectorIndex
operator|,
name|u64
operator|.
name|S32
index|[
literal|1
index|]
operator|,
name|u64
operator|.
name|S32
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|,
name|u64
operator|.
name|S32
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|,
name|u64
operator|.
name|S32
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to disable MSI interrupts  *  *  siDisableMSIInterrupts disables interrupts  *  called thru macro ossaDisableInterrupts  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siDisableMSIInterrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|ODMRValue
decl_stmt|;
name|bit32
name|mask
decl_stmt|;
name|mask
operator|=
literal|1
operator|<<
name|interruptVectorIndex
expr_stmt|;
comment|/*Must be protected for interuption */
name|ODMRValue
operator|=
name|ossaHwRegRead
argument_list|(
name|agRoot
argument_list|,
name|MSGU_ODMR
argument_list|)
expr_stmt|;
name|ODMRValue
operator||=
name|mask
expr_stmt|;
name|ossaHwRegWrite
argument_list|(
name|agRoot
argument_list|,
name|MSGU_ODMR
argument_list|,
name|ODMRValue
argument_list|)
expr_stmt|;
name|ossaHwRegWrite
argument_list|(
name|agRoot
argument_list|,
name|MSGU_ODCR
argument_list|,
name|mask
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to disable MSI V interrupts  *  *  siDisableMSIInterrupts disables interrupts  *  called thru macro ossaDisableInterrupts  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siDisableMSI_V_Interrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|SA_ASSERT
argument_list|(
literal|0
argument_list|,
literal|"Should not be called"
argument_list|)
expr_stmt|;
name|SA_DBG4
argument_list|(
operator|(
literal|"siDisableMSI_V_Interrupts:\n"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process Legacy interrupts  *  *  siDisableLegacyInterrupts disables interrupts  *  called thru macro ossaDisableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex not used in legacy case  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siDisableLegacyInterrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|ossaHwRegWrite
argument_list|(
name|agRoot
argument_list|,
name|MSGU_ODMR
argument_list|,
name|ODMR_MASK_ALL
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|SA_CLEAR_ODCR_IN_INTERRUPT
name|ossaHwRegWrite
argument_list|(
name|agRoot
argument_list|,
name|MSGU_ODCR
argument_list|,
name|ODCR_CLEAR_ALL
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SA_CLEAR_ODCR_IN_INTERRUPT */
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process Legacy V interrupts  *  *  siDisableLegacyInterrupts disables interrupts  *  called thru macro ossaDisableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex not used in legacy case  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siDisableLegacy_V_Interrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit64
name|mask
decl_stmt|;
name|agsabit32bit64
name|u64
decl_stmt|;
name|mask
operator|=
operator|(
operator|(
name|bit64
operator|)
literal|1
operator|<<
name|interruptVectorIndex
operator|)
expr_stmt|;
name|u64
operator|.
name|B64
operator|=
name|mask
expr_stmt|;
name|SA_DBG4
argument_list|(
operator|(
literal|"siDisableLegacy_V_Interrupts:IN MSGU_READ_ODR  %08X\n"
operator|,
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODR
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG4
argument_list|(
operator|(
literal|"siDisableLegacy_V_Interrupts:IN MSGU_READ_ODMR %08X\n"
operator|,
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|smIS64bInt
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|SA_DBG4
argument_list|(
operator|(
literal|"siDisableLegacy_V_Interrupts: VI %d U 0x%08X L 0x%08X\n"
operator|,
name|interruptVectorIndex
operator|,
name|u64
operator|.
name|S32
index|[
literal|1
index|]
operator|,
name|u64
operator|.
name|S32
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|,
name|u64
operator|.
name|S32
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|,
name|u64
operator|.
name|S32
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process MSIX interrupts  *  *  siOurMSIXInterrupt checks if we generated interrupt  *  called thru function pointer saRoot->OurInterrupt  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \return always true  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|bit32
name|siOurMSIXInterrupt
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process MSIX V interrupts  *  *  siOurMSIXInterrupt checks if we generated interrupt  *  called thru function pointer saRoot->OurInterrupt  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \return always true  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|bit32
name|siOurMSIX_V_Interrupt
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process MSI interrupts  *  *  siOurMSIInterrupt checks if we generated interrupt  *  called thru function pointer saRoot->OurInterrupt  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \return always true  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|bit32
name|siOurMSIInterrupt
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process MSI V interrupts  *  *  siOurMSIInterrupt checks if we generated interrupt  *  called thru function pointer saRoot->OurInterrupt  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \return always true  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|bit32
name|siOurMSI_V_Interrupt
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|SA_DBG4
argument_list|(
operator|(
literal|":siOurMSI_V_Interrupt\n"
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process Legacy interrupts  *  *  siOurLegacyInterrupt checks if we generated interrupt  *  called thru function pointer saRoot->OurInterrupt  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \return true if we claim interrupt  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|bit32
name|siOurLegacyInterrupt
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|Int_masked
decl_stmt|;
name|bit32
name|Int_active
decl_stmt|;
name|Int_masked
operator|=
name|MSGU_READ_ODMR
expr_stmt|;
name|Int_active
operator|=
name|MSGU_READ_ODR
expr_stmt|;
if|if
condition|(
name|Int_masked
operator|&
literal|1
condition|)
block|{
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
if|if
condition|(
name|Int_active
operator|&
literal|1
condition|)
block|{
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process Legacy V interrupts  *  *  siOurLegacyInterrupt checks if we generated interrupt  *  called thru function pointer saRoot->OurInterrupt  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \return true if we claim interrupt  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|bit32
name|siOurLegacy_V_Interrupt
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|Int_active
decl_stmt|;
name|Int_active
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODR
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
expr_stmt|;
return|return
operator|(
name|Int_active
condition|?
name|TRUE
else|:
name|FALSE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to process the cause of interrupt  *  *  The saDelayedInterruptHandler() function is called after an interrupt messages has  *  been received it may be called by a deferred procedure call  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex  - vector index for message  *  \param count Number of completion queue entries to consume  *  *  \return number of messages processed  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|FORCEINLINE
name|bit32
name|saDelayedInterruptHandler
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|,
name|bit32
name|count
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|bit32
name|processedMsgCount
init|=
literal|0
decl_stmt|;
name|bit32
name|pad1
init|=
literal|0
decl_stmt|;
name|bit32
name|host_reg0
init|=
literal|0
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
name|bit32
name|host_reg1
init|=
literal|0
decl_stmt|;
endif|#
directive|endif
name|bit8
name|i
init|=
literal|0
decl_stmt|;
name|OSSA_OUT_ENTER
argument_list|(
name|agRoot
argument_list|)
expr_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5p"
argument_list|)
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"Vd"
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
comment|/* TP:Vd delayed VectorIndex */
name|smTrace
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"Vc"
argument_list|,
name|count
argument_list|)
expr_stmt|;
comment|/* TP:Vc IOMB count*/
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptEnable
operator|&&
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptVector
operator|==
name|interruptVectorIndex
condition|)
block|{
name|pad1
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_1
argument_list|,
name|MSGU_SCRATCH_PAD_1
argument_list|)
expr_stmt|;
name|host_reg0
operator|=
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_Rsvd_0_Register
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|hostDirectAccessMode
operator|&
literal|2
condition|)
block|{
if|if
condition|(
name|host_reg0
operator|==
name|HDA_AES_DIF_FUNC
condition|)
block|{
name|host_reg0
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
name|host_reg1
operator|=
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_Rsvd_1_Register
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|(
name|SCRATCH_PAD1_V_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|!=
literal|0
operator|)
operator|&&
name|host_reg0
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: vi %d  Error %08X\n"
operator|,
name|interruptVectorIndex
operator|,
name|SCRATCH_PAD1_V_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: Sp 1 %08X Hr0 %08X Hr1 %08X\n"
operator|,
name|pad1
operator|,
name|host_reg0
operator|,
name|host_reg1
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: SCRATCH_PAD1_V_ERROR_STATE      %08X\n"
operator|,
name|SCRATCH_PAD1_V_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: SCRATCH_PAD1_V_ILA_ERROR_STATE  %08X\n"
operator|,
name|SCRATCH_PAD1_V_ILA_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: SCRATCH_PAD1_V_RAAE_ERROR_STATE %08X\n"
operator|,
name|SCRATCH_PAD1_V_RAAE_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: SCRATCH_PAD1_V_IOP0_ERROR_STATE %08X\n"
operator|,
name|SCRATCH_PAD1_V_IOP0_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: SCRATCH_PAD1_V_IOP1_ERROR_STATE %08X\n"
operator|,
name|SCRATCH_PAD1_V_IOP1_ERROR_STATE
argument_list|(
name|pad1
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|siFatalInterruptHandler
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
name|ossaDisableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG2
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: Fatal Check VI %d SCRATCH_PAD1 %08X host_reg0 %08X host_reg1 %08X\n"
operator|,
name|interruptVectorIndex
operator|,
name|pad1
operator|,
name|host_reg0
operator|,
name|host_reg1
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"saDelayedInterruptHandler:  ScratchPad0 0x%x ScratchPad1 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_0_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_1_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"saDelayedInterruptHandler:  ScratchPad2 0x%x ScratchPad3 0x%x\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_2_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Scratchpad_3_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: Doorbell_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"saDelayedInterruptHandler: Doorbell_Mask %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|SA_LNX_PERF_MODE
return|return
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|interruptVectorIndex
argument_list|)
return|;
endif|#
directive|endif
comment|/* check all the configuration outbound queues within a vector bitmap */
name|SA_ASSERT
argument_list|(
operator|(
name|saRoot
operator|->
name|QueueConfig
operator|.
name|numOutboundQueues
operator|<
literal|65
operator|)
argument_list|,
literal|"numOutboundQueue"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|saRoot
operator|->
name|QueueConfig
operator|.
name|numOutboundQueues
condition|;
name|i
operator|++
control|)
block|{
comment|/* process IOMB in the outbound queue 0 to 31 if bit set in the vector bitmap */
if|if
condition|(
name|i
operator|<
name|OQ_NUM_32
condition|)
block|{
if|if
condition|(
name|saRoot
operator|->
name|interruptVecIndexBitMap
index|[
name|interruptVectorIndex
index|]
operator|&
operator|(
literal|1
operator|<<
name|i
operator|)
condition|)
block|{
name|processedMsgCount
operator|+=
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|saRoot
operator|->
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptEnable
operator|==
literal|0
condition|)
block|{
comment|/* polling mode - interruptVectorIndex = 0 only and no bit set */
name|processedMsgCount
operator|+=
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|SA_FW_TEST_INTERRUPT_REASSERT
elseif|else
if|if
condition|(
name|saRoot
operator|->
name|CheckAll
condition|)
block|{
comment|/* polling mode - interruptVectorIndex = 0 only and no bit set */
name|processedMsgCount
operator|+=
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SA_FW_TEST_INTERRUPT_REASSERT */
block|}
else|else
block|{
comment|/* process IOMB in the outbound queue 32 to 63 if bit set in the vector bitmap */
if|if
condition|(
name|saRoot
operator|->
name|interruptVecIndexBitMap1
index|[
name|interruptVectorIndex
index|]
operator|&
operator|(
literal|1
operator|<<
operator|(
name|i
operator|-
name|OQ_NUM_32
operator|)
operator|)
condition|)
block|{
name|processedMsgCount
operator|+=
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
comment|/* check interruptEnable bit for polling mode of OQ */
comment|/* the following code can be removed, we do not care about the bit */
elseif|else
if|if
condition|(
name|saRoot
operator|->
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptEnable
operator|==
literal|0
condition|)
block|{
comment|/* polling mode - interruptVectorIndex = 0 only and no bit set */
name|processedMsgCount
operator|+=
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|SA_FW_TEST_INTERRUPT_REASSERT
elseif|else
if|if
condition|(
name|saRoot
operator|->
name|CheckAll
condition|)
block|{
comment|/* polling mode - interruptVectorIndex = 0 only and no bit set */
name|processedMsgCount
operator|+=
name|siProcessOBMsg
argument_list|(
name|agRoot
argument_list|,
name|count
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SA_FW_TEST_INTERRUPT_REASSERT */
block|}
block|}
ifdef|#
directive|ifdef
name|SA_FW_TEST_INTERRUPT_REASSERT
name|saRoot
operator|->
name|CheckAll
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* SA_FW_TEST_INTERRUPT_REASSERT */
ifndef|#
directive|ifndef
name|SA_RENABLE_IN_OSLAYER
if|if
condition|(
name|agTRUE
operator|==
name|saRoot
operator|->
name|sysIntsActive
condition|)
block|{
comment|/* Allow replacement of enable interrupt */
name|ossaReenableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SA_RENABLE_IN_OSLAYER */
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5p"
argument_list|)
expr_stmt|;
name|OSSA_OUT_LEAVE
argument_list|(
name|agRoot
argument_list|)
expr_stmt|;
return|return
name|processedMsgCount
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to reenable MSIX interrupts  *  *  siReenableMSIXInterrupts  reenableinterrupts  *  called thru macro ossaReenableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex  - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|void
name|siReenableMSIXInterrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|msi_index
decl_stmt|;
ifdef|#
directive|ifdef
name|SA_CLEAR_ODCR_IN_INTERRUPT
name|bit32
name|value
decl_stmt|;
endif|#
directive|endif
comment|/* SA_CLEAR_ODCR_IN_INTERRUPT */
name|msi_index
operator|=
name|interruptVectorIndex
operator|*
name|MSIX_TABLE_ELEMENT_SIZE
expr_stmt|;
name|msi_index
operator|+=
name|MSIX_TABLE_BASE
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|msi_index
argument_list|,
name|MSIX_INTERRUPT_ENABLE
argument_list|)
expr_stmt|;
name|SA_DBG4
argument_list|(
operator|(
literal|"siReenableMSIXInterrupts:interruptVectorIndex %d\n"
operator|,
name|interruptVectorIndex
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_CLEAR_ODCR_IN_INTERRUPT
name|value
operator|=
operator|(
literal|1
operator|<<
name|interruptVectorIndex
operator|)
expr_stmt|;
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODCR
argument_list|,
name|MSGU_ODCR
argument_list|,
name|value
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SA_CLEAR_ODCR_IN_INTERRUPT */
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to reenable MSIX interrupts  *  *  siReenableMSIXInterrupts  reenableinterrupts  *  called thru macro ossaReenableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex  - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|void
name|siReenableMSIX_V_Interrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|bit64
name|mask
decl_stmt|;
name|agsabit32bit64
name|u64
decl_stmt|;
name|mask
operator|=
operator|(
operator|(
name|bit64
operator|)
literal|1
operator|<<
name|interruptVectorIndex
operator|)
expr_stmt|;
name|u64
operator|.
name|B64
operator|=
name|mask
expr_stmt|;
name|SA_DBG4
argument_list|(
operator|(
literal|"siReenableMSIX_V_Interrupts:\n"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|->
name|sysIntsActive
condition|)
block|{
if|if
condition|(
name|smIS64bInt
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|SA_DBG4
argument_list|(
operator|(
literal|"siReenableMSIX_V_Interrupts: VI %d U 0x%08X L 0x%08X\n"
operator|,
name|interruptVectorIndex
operator|,
name|u64
operator|.
name|S32
index|[
literal|1
index|]
operator|,
name|u64
operator|.
name|S32
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Clear_RegisterU
argument_list|,
name|u64
operator|.
name|S32
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Clear_Register
argument_list|,
name|u64
operator|.
name|S32
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siReenableMSIX_V_Interrupts: VI %d sysIntsActive off\n"
operator|,
name|interruptVectorIndex
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to reenable MSI interrupts  *  *  siReenableMSIXInterrupts  reenableinterrupts  *  called thru macro ossaReenableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex  - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siReenableMSIInterrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|ODMRValue
decl_stmt|;
name|ODMRValue
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|MSGU_ODMR
argument_list|)
expr_stmt|;
name|ODMRValue
operator|&=
operator|~
operator|(
literal|1
operator|<<
name|interruptVectorIndex
operator|)
expr_stmt|;
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|MSGU_ODMR
argument_list|,
name|ODMRValue
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to reenable MSI V interrupts  *  *  siReenableMSIXInterrupts  reenableinterrupts  *  called thru macro ossaReenableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex  - vector index for message  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siReenableMSI_V_Interrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|SA_ASSERT
argument_list|(
literal|0
argument_list|,
literal|"Should not be called"
argument_list|)
expr_stmt|;
name|SA_DBG4
argument_list|(
operator|(
literal|"siReenableMSI_V_Interrupts:\n"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to reenable Legacy interrupts  *  *  siReenableLegacyInterrupts reenableinterrupts  *  called thru macro ossaReenableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex always zero  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siReenableLegacyInterrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|MSGU_ODMR
argument_list|,
name|ODMR_CLEAR_ALL
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_CLEAR_ODCR_IN_INTERRUPT
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODCR
argument_list|,
name|MSGU_ODCR
argument_list|,
name|ODCR_CLEAR_ALL
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SA_CLEAR_ODCR_IN_INTERRUPT */
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to reenable Legacy V interrupts  *  *  siReenableLegacyInterrupts reenableinterrupts  *  called thru macro ossaReenableInterrupts  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex always zero  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siReenableLegacy_V_Interrupts
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|bit32
name|mask
decl_stmt|;
name|mask
operator|=
literal|1
operator|<<
name|interruptVectorIndex
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"siReenableLegacy_V_Interrupts:IN MSGU_READ_ODR  %08X\n"
operator|,
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODR
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"siReenableLegacy_V_Interrupts:IN MSGU_READ_ODMR %08X\n"
operator|,
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Clear_Register
argument_list|,
name|mask
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Clear_Register
argument_list|,
name|mask
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"siReenableLegacy_V_Interrupts:OUT MSGU_READ_ODMR %08X\n"
operator|,
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to enable a single interrupt vector  *  *  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex Interrupt vector to enable  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief  saSystemInterruptsEnable  *   Function to enable a single interrupt vector  *  *  \param agRoot OS Layer-specific and LL Layer-specific context handles for this  *                instance of SAS/SATA hardware  *  \param interruptVectorIndex Interrupt vector to enable  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|FORCEINLINE
name|void
name|saSystemInterruptsEnable
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|interruptVectorIndex
parameter_list|)
block|{
name|ossaReenableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|interruptVectorIndex
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle Outbound Message  *  *  The handle for outbound message  *  *  \param agRoot   handles for this instance of SAS/SATA hardware  *  \param count    interrupt message count  *  \param queueNum outbound queue  *  *  \return  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|LOCAL
name|FORCEINLINE
name|bit32
name|siProcessOBMsg
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|count
parameter_list|,
name|bit32
name|queueNum
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|mpiOCQueue_t
modifier|*
name|circularQ
init|=
name|agNULL
decl_stmt|;
name|void
modifier|*
name|pMsg1
init|=
name|agNULL
decl_stmt|;
name|bit32
name|ret
decl_stmt|,
name|processedMsgCount
init|=
literal|0
decl_stmt|;
name|bit32
name|ParseOBIombStatus
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|SA_ENABLE_TRACE_FUNCTIONS
name|bit32
name|i
init|=
literal|0
decl_stmt|;
endif|#
directive|endif
name|bit16
name|opcode
init|=
literal|0
decl_stmt|;
name|mpiMsgCategory_t
name|category
decl_stmt|;
name|bit8
name|bc
init|=
literal|0
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5r"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"siProcessOBMsg: queueNum 0x%x\n"
operator|,
name|queueNum
operator|)
argument_list|)
expr_stmt|;
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_OBQ_LOCK
operator|+
name|queueNum
argument_list|)
expr_stmt|;
name|circularQ
operator|=
operator|&
name|saRoot
operator|->
name|outboundQueue
index|[
name|queueNum
index|]
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|circularQ
operator|->
name|agRoot
argument_list|,
operator|&
name|circularQ
operator|->
name|producerIdx
argument_list|,
name|circularQ
operator|->
name|piPointer
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|circularQ
operator|->
name|producerIdx
operator|==
name|circularQ
operator|->
name|consumerIdx
condition|)
block|{
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_OBQ_LOCK
operator|+
name|queueNum
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5r"
argument_list|)
expr_stmt|;
return|return
name|processedMsgCount
return|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_OBQ_LOCK
operator|+
name|queueNum
argument_list|)
expr_stmt|;
do|do
block|{
comment|/* ossaSingleThreadedEnter(agRoot, LL_IOREQ_OBQ_LOCK + queueNum); */
name|ret
operator|=
name|mpiMsgConsume
argument_list|(
name|circularQ
argument_list|,
operator|&
name|pMsg1
argument_list|,
operator|&
name|category
argument_list|,
operator|&
name|opcode
argument_list|,
operator|&
name|bc
argument_list|)
expr_stmt|;
comment|/* ossaSingleThreadedLeave(agRoot, LL_IOREQ_OBQ_LOCK + queueNum); */
if|if
condition|(
name|AGSA_RC_SUCCESS
operator|==
name|ret
condition|)
block|{
name|smTrace
argument_list|(
name|hpDBG_IOMB
argument_list|,
literal|"M0"
argument_list|,
name|queueNum
argument_list|)
expr_stmt|;
comment|/* TP:M0 queueNum */
name|smTrace
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"MA"
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
comment|/* TP:MA opcode */
name|smTrace
argument_list|(
name|hpDBG_IOMB
argument_list|,
literal|"MB"
argument_list|,
name|category
argument_list|)
expr_stmt|;
comment|/* TP:MB category */
ifdef|#
directive|ifdef
name|SA_ENABLE_TRACE_FUNCTIONS
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
operator|(
name|bit32
operator|)
name|bc
operator|*
operator|(
name|circularQ
operator|->
name|elementSize
operator|/
literal|4
operator|)
operator|)
condition|;
name|i
operator|++
control|)
block|{
comment|/* The -sizeof(mpiMsgHeader_t) is to account for mpiMsgConsume incrementing the pointer past the header*/
name|smTrace
argument_list|(
name|hpDBG_IOMB
argument_list|,
literal|"MC"
argument_list|,
operator|*
operator|(
operator|(
operator|(
name|bit32
operator|*
operator|)
operator|(
operator|(
name|bit8
operator|*
operator|)
name|pMsg1
operator|-
sizeof|sizeof
argument_list|(
name|mpiMsgHeader_t
argument_list|)
operator|)
operator|)
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
comment|/* TP:MC Outbound IOMB Dword */
block|}
endif|#
directive|endif
name|MPI_DEBUG_TRACE
argument_list|(
name|circularQ
operator|->
name|qNumber
argument_list|,
operator|(
operator|(
name|circularQ
operator|->
name|producerIdx
operator|<<
literal|16
operator|)
operator||
name|circularQ
operator|->
name|consumerIdx
operator|)
argument_list|,
name|MPI_DEBUG_TRACE_OBQ
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
operator|(
name|bit8
operator|*
operator|)
name|pMsg1
operator|)
operator|-
sizeof|sizeof
argument_list|(
name|mpiMsgHeader_t
argument_list|)
operator|)
argument_list|,
name|circularQ
operator|->
name|elementSize
argument_list|)
expr_stmt|;
name|ossaLogIomb
argument_list|(
name|circularQ
operator|->
name|agRoot
argument_list|,
name|circularQ
operator|->
name|qNumber
argument_list|,
name|FALSE
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
operator|(
name|bit8
operator|*
operator|)
name|pMsg1
operator|)
operator|-
sizeof|sizeof
argument_list|(
name|mpiMsgHeader_t
argument_list|)
operator|)
argument_list|,
name|bc
operator|*
name|circularQ
operator|->
name|elementSize
argument_list|)
expr_stmt|;
name|ossaQueueProcessed
argument_list|(
name|agRoot
argument_list|,
name|queueNum
argument_list|,
name|circularQ
operator|->
name|producerIdx
argument_list|,
name|circularQ
operator|->
name|consumerIdx
argument_list|)
expr_stmt|;
comment|/* process the outbound message */
name|ParseOBIombStatus
operator|=
name|mpiParseOBIomb
argument_list|(
name|agRoot
argument_list|,
operator|(
name|bit32
operator|*
operator|)
name|pMsg1
argument_list|,
name|category
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
if|if
condition|(
name|ParseOBIombStatus
operator|==
name|AGSA_RC_FAILURE
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siProcessOBMsg, Failed Q %2d PI 0x%03x CI 0x%03x\n"
operator|,
name|queueNum
operator|,
name|circularQ
operator|->
name|producerIdx
operator|,
name|circularQ
operator|->
name|consumerIdx
operator|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
comment|/* free the message for debug: this is a hang! */
name|mpiMsgFreeSet
argument_list|(
name|circularQ
argument_list|,
name|pMsg1
argument_list|,
name|bc
argument_list|)
expr_stmt|;
name|processedMsgCount
operator|++
expr_stmt|;
endif|#
directive|endif
comment|/**/
break|break;
block|}
comment|/* free the message from the outbound circular buffer */
name|mpiMsgFreeSet
argument_list|(
name|circularQ
argument_list|,
name|pMsg1
argument_list|,
name|bc
argument_list|)
expr_stmt|;
name|processedMsgCount
operator|++
expr_stmt|;
block|}
else|else
comment|//if (AGSA_RC_BUSY == ret) // always (circularQ->producerIdx == circularQ->consumerIdx)
comment|// || (AGSA_RC_FAILURE == ret)
block|{
break|break;
block|}
block|}
comment|/* end of message processing if hit the count */
do|while
condition|(
name|count
operator|>
name|processedMsgCount
condition|)
do|;
comment|/* #define SALLSDK_FATAL_ERROR_DETECT 1 */
comment|/*    this comments are to be removed    fill in 0x1D 0x1e 0x1f 0x20 in MPI table for   bit32   regDumpBusBaseNum0;   bit32   regDumpOffset0;   bit32   regDumpLen0;   bit32   regDumpBusBaseNum1;   bit32   regDumpOffset1;   bit32   regDumpLen1;   in agsaFatalErrorInfo_t    ??? regDumpBusBaseNum0 and regDumpBusBaseNum1     saRoot->mainConfigTable.regDumpPCIBAR = pcibar;     saRoot->mainConfigTable.FatalErrorDumpOffset0 = config->FatalErrorDumpOffset0;     saRoot->mainConfigTable.FatalErrorDumpLength0 = config->FatalErrorDumpLength0;     saRoot->mainConfigTable.FatalErrorDumpOffset1 = config->FatalErrorDumpOffset1;     saRoot->mainConfigTable.FatalErrorDumpLength1 = config->FatalErrorDumpLength1;    */
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_FATAL_ERROR_DETECT
argument_list|)
if|if
condition|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
condition|)
comment|/* SPC only */
block|{
comment|/* any fatal error happened */
comment|/* executing this code impacts performance by 1% when no error is detected */
block|{
name|agsaFatalErrorInfo_t
name|fatal_error
decl_stmt|;
name|bit32
name|value
decl_stmt|;
name|bit32
name|value1
decl_stmt|;
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_1
argument_list|,
name|MSGU_SCRATCH_PAD_1
argument_list|)
expr_stmt|;
name|value1
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_2
argument_list|,
name|MSGU_SCRATCH_PAD_2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|&
name|SA_FATAL_ERROR_SP1_AAP1_ERR_MASK
operator|)
operator|==
name|SA_FATAL_ERROR_FATAL_ERROR
operator|||
operator|(
name|value1
operator|&
name|SA_FATAL_ERROR_SP2_IOP_ERR_MASK
operator|)
operator|==
name|SA_FATAL_ERROR_FATAL_ERROR
condition|)
block|{
name|si_memset
argument_list|(
operator|&
name|fatal_error
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|agsaFatalErrorInfo_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* read detail fatal errors */
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_0
argument_list|,
name|MSGU_SCRATCH_PAD_0
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo0
operator|=
name|value
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siProcessOBMsg: ScratchPad0 AAP error code 0x%x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_1
argument_list|,
name|MSGU_SCRATCH_PAD_1
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo1
operator|=
name|value
expr_stmt|;
comment|/* AAP error state */
name|SA_DBG1
argument_list|(
operator|(
literal|"siProcessOBMsg: AAP error state and error code 0x%x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_2
argument_list|,
name|MSGU_SCRATCH_PAD_2
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo2
operator|=
name|value
expr_stmt|;
comment|/* IOP error state */
name|SA_DBG1
argument_list|(
operator|(
literal|"siProcessOBMsg: IOP error state and error code 0x%x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|siHalRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_SCRATCH_PAD_3
argument_list|,
name|MSGU_SCRATCH_PAD_3
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siProcessOBMsg: ScratchPad3 IOP error code 0x%x\n"
operator|,
name|value
operator|)
argument_list|)
expr_stmt|;
name|fatal_error
operator|.
name|errorInfo3
operator|=
name|value
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|saRoot
condition|)
block|{
name|fatal_error
operator|.
name|regDumpBusBaseNum0
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|regDumpPCIBAR
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset0
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpOffset0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen0
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpLength0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpBusBaseNum1
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|regDumpPCIBAR
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset1
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpOffset1
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen1
operator|=
name|saRoot
operator|->
name|mainConfigTable
operator|.
name|FatalErrorDumpLength1
expr_stmt|;
block|}
else|else
block|{
name|fatal_error
operator|.
name|regDumpBusBaseNum0
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset0
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen0
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpBusBaseNum1
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpOffset1
operator|=
literal|0
expr_stmt|;
name|fatal_error
operator|.
name|regDumpLen1
operator|=
literal|0
expr_stmt|;
block|}
comment|/* Call Back with error */
name|SA_DBG1
argument_list|(
operator|(
literal|"siProcessOBMsg: SALLSDK_FATAL_ERROR_DETECT \n"
operator|)
argument_list|)
expr_stmt|;
name|ossaHwCB
argument_list|(
name|agRoot
argument_list|,
name|agNULL
argument_list|,
name|OSSA_HW_EVENT_MALFUNCTION
argument_list|,
literal|0
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|fatal_error
argument_list|,
name|agNULL
argument_list|)
expr_stmt|;
block|}
block|}
block|}
endif|#
directive|endif
comment|/* SALLSDK_FATAL_ERROR_DETECT */
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"5r"
argument_list|)
expr_stmt|;
return|return
name|processedMsgCount
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Function to enable/disable interrupts  *  *  The saSystemInterruptsActive() function is called to indicate to the LL Layer  *  whether interrupts are available. The parameter sysIntsActive indicates whether  *  interrupts are available at this time.  *  *  \param agRoot handles for this instance of SAS/SATA hardware  *  \param sysIntsActive flag for enable/disable interrupt  *  *  \return -void-  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|saSystemInterruptsActive
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|agBOOLEAN
name|sysIntsActive
parameter_list|)
block|{
name|bit32
name|x
decl_stmt|;
name|agsaLLRoot_t
modifier|*
name|saRoot
decl_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|agNULL
operator|!=
name|agRoot
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|agRoot
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: agRoot == agNULL\n"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|saRoot
operator|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|agNULL
operator|!=
name|saRoot
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: saRoot == agNULL\n"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|smTraceFuncEnter
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|"5s"
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: now 0x%X new 0x%x\n"
operator|,
name|saRoot
operator|->
name|sysIntsActive
operator|,
name|sysIntsActive
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Doorbell_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Doorbell_Mask %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|saRoot
operator|->
name|sysIntsActive
operator|&&
name|sysIntsActive
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Already active 0x%X new 0x%x\n"
operator|,
name|saRoot
operator|->
name|sysIntsActive
operator|,
name|sysIntsActive
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|'a'
argument_list|,
literal|"5s"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|saRoot
operator|->
name|sysIntsActive
operator|&&
operator|!
name|sysIntsActive
condition|)
block|{
if|if
condition|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|MSGU_ODMR
argument_list|,
name|AGSA_INTERRUPT_HANDLE_ALL_CHANNELS
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|,
name|AGSA_INTERRUPT_HANDLE_ALL_CHANNELS
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|,
name|AGSA_INTERRUPT_HANDLE_ALL_CHANNELS
argument_list|)
expr_stmt|;
block|}
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Already disabled 0x%X new 0x%x\n"
operator|,
name|saRoot
operator|->
name|sysIntsActive
operator|,
name|sysIntsActive
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|'b'
argument_list|,
literal|"5s"
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Set the flag is sdkData */
name|saRoot
operator|->
name|sysIntsActive
operator|=
operator|(
name|bit8
operator|)
name|sysIntsActive
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|"Vq"
argument_list|,
name|sysIntsActive
argument_list|)
expr_stmt|;
comment|/* TP:Vq sysIntsActive */
comment|/* If sysIntsActive is true */
if|if
condition|(
name|agTRUE
operator|==
name|sysIntsActive
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Doorbell_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Doorbell_Mask_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|smIS_SPCV
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Clear_Register
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Clear_RegisterU
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
block|}
comment|/* enable interrupt */
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|saRoot
operator|->
name|numInterruptVectors
condition|;
name|x
operator|++
control|)
block|{
name|ossaReenableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptEnable
condition|)
block|{
name|ossaReenableInterrupts
argument_list|(
name|agRoot
argument_list|,
name|saRoot
operator|->
name|swConfig
operator|.
name|fatalErrorInterruptVector
argument_list|)
expr_stmt|;
block|}
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|MSGU_ODMR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* If sysIntsActive is false */
else|else
block|{
comment|/* disable interrupt */
if|if
condition|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|siHalRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|GEN_MSGU_ODMR
argument_list|,
name|MSGU_ODMR
argument_list|,
name|AGSA_INTERRUPT_HANDLE_ALL_CHANNELS
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|,
name|AGSA_INTERRUPT_HANDLE_ALL_CHANNELS
argument_list|)
expr_stmt|;
name|ossaHwRegWriteExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|,
name|AGSA_INTERRUPT_HANDLE_ALL_CHANNELS
argument_list|)
expr_stmt|;
block|}
block|}
name|SA_DBG3
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Doorbell_Set  %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"saSystemInterruptsActive: Doorbell_Mask %08X U %08X\n"
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_Register
argument_list|)
operator|,
name|ossaHwRegReadExt
argument_list|(
name|agRoot
argument_list|,
name|PCIBAR0
argument_list|,
name|V_Outbound_Doorbell_Mask_Set_RegisterU
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_TICK_INT
argument_list|,
literal|'c'
argument_list|,
literal|"5s"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle for received SAS with data payload event  *  *  The handle for received SAS with data payload event  *  *  \param agRoot   handles for this instance of SAS/SATA hardware  *  \param pRequest handles for the IOrequest  *  \param pRespIU  the pointer to the Response IU  *  \param param    Payload Length  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siEventSSPResponseWtDataRcvd
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|agsaIORequestDesc_t
modifier|*
name|pRequest
parameter_list|,
name|agsaSSPResponseInfoUnit_t
modifier|*
name|pRespIU
parameter_list|,
name|bit32
name|param
parameter_list|,
name|bit32
name|sspTag
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaDeviceDesc_t
modifier|*
name|pDevice
decl_stmt|;
name|bit32
name|count
init|=
literal|0
decl_stmt|;
name|bit32
name|padCount
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5g"
argument_list|)
expr_stmt|;
comment|/* get frame handle */
comment|/* If the request is still valid */
if|if
condition|(
name|agTRUE
operator|==
name|pRequest
operator|->
name|valid
condition|)
block|{
comment|/* get device */
name|pDevice
operator|=
name|pRequest
operator|->
name|pDevice
expr_stmt|;
comment|/* Delete the request from the pendingIORequests */
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
if|if
condition|(
name|sspTag
operator|&
name|SSP_RESCV_BIT
condition|)
block|{
comment|/* get the pad count, bit 17 and 18 of sspTag */
name|padCount
operator|=
operator|(
name|sspTag
operator|>>
name|SSP_RESCV_PAD_SHIFT
operator|)
operator|&
literal|0x3
expr_stmt|;
comment|/* get Residual Count */
name|count
operator|=
operator|*
operator|(
name|bit32
operator|*
operator|)
operator|(
operator|(
name|bit8
operator|*
operator|)
name|pRespIU
operator|+
name|param
operator|+
name|padCount
operator|)
expr_stmt|;
block|}
operator|(
operator|*
call|(
name|ossaSSPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|OSSA_IO_SUCCESS
operator|,
name|param
operator|,
operator|(
name|void
operator|*
operator|)
name|pRespIU
operator|,
call|(
name|bit16
call|)
argument_list|(
name|sspTag
operator|&
name|SSPTAG_BITS
argument_list|)
operator|,
name|count
operator|)
expr_stmt|;
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
comment|/* return the request to free pool */
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siEventSSPResponseWtDataRcvd: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siEventSSPResponseWtDataRcvd: pRequest->Valid not TRUE\n"
operator|)
argument_list|)
expr_stmt|;
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5g"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle successfully completed IO event  *  *  Handle successfully completed IO  *  *  \param agRoot   handles for this instance of SAS/SATA hardware  *  \param pRequest Pointer of IO request of the IO  *  \param status   status of the IO  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|FORCEINLINE
name|void
name|siIODone
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|agsaIORequestDesc_t
modifier|*
name|pRequest
parameter_list|,
name|bit32
name|status
parameter_list|,
name|bit32
name|sspTag
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaDeviceDesc_t
modifier|*
name|pDevice
init|=
name|agNULL
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5h"
argument_list|)
expr_stmt|;
name|SA_ASSERT
argument_list|(
name|NULL
operator|!=
name|pRequest
argument_list|,
literal|"pRequest cannot be null"
argument_list|)
expr_stmt|;
comment|/* If the request is still valid */
if|if
condition|(
name|agTRUE
operator|==
name|pRequest
operator|->
name|valid
condition|)
block|{
comment|/* get device */
name|pDevice
operator|=
name|pRequest
operator|->
name|pDevice
expr_stmt|;
comment|/* process different request type */
switch|switch
condition|(
name|pRequest
operator|->
name|requestType
operator|&
name|AGSA_REQTYPE_MASK
condition|)
block|{
case|case
name|AGSA_SSP_REQTYPE
case|:
block|{
name|SA_ASSERT
argument_list|(
name|pRequest
operator|->
name|valid
argument_list|,
literal|"pRequest not valid"
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|completionCB
argument_list|(
name|agRoot
argument_list|,
name|pRequest
operator|->
name|pIORequestContext
argument_list|,
name|OSSA_IO_SUCCESS
argument_list|,
literal|0
argument_list|,
name|agNULL
argument_list|,
call|(
name|bit16
call|)
argument_list|(
name|sspTag
operator|&
name|SSPTAG_BITS
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingIORequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* return the request to free pool */
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|AGSA_SATA_REQTYPE
case|:
block|{
name|SA_DBG5
argument_list|(
operator|(
literal|"siIODone: SATA complete\n"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|pRequest
operator|->
name|pIORequestContext
condition|)
block|{
name|SA_DBG5
argument_list|(
operator|(
literal|"siIODone: Complete Request\n"
operator|)
argument_list|)
expr_stmt|;
operator|(
operator|*
call|(
name|ossaSATACompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|OSSA_IO_SUCCESS
operator|,
name|agNULL
operator|,
literal|0
operator|,
name|agNULL
operator|)
expr_stmt|;
block|}
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingIORequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
break|break;
block|}
case|case
name|AGSA_SMP_REQTYPE
case|:
block|{
if|if
condition|(
name|agNULL
operator|!=
name|pRequest
operator|->
name|pIORequestContext
condition|)
block|{
operator|(
operator|*
call|(
name|ossaSMPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|OSSA_IO_SUCCESS
operator|,
literal|0
operator|,
name|agNULL
operator|)
expr_stmt|;
block|}
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingSMPRequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* return the request to free pool */
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siIODone: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
break|break;
block|}
default|default:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siIODone: unknown request type (%x) is completed. HTag=0x%x\n"
operator|,
name|pRequest
operator|->
name|requestType
operator|,
name|pRequest
operator|->
name|HTag
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siIODone: The request is not valid any more. HTag=0x%x requestType=0x%x\n"
operator|,
name|pRequest
operator|->
name|HTag
operator|,
name|pRequest
operator|->
name|requestType
operator|)
argument_list|)
expr_stmt|;
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5h"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle abnormal completed IO/SMP event  *  *  Handle abnormal completed IO/SMP  *  *  \param agRoot   handles for this instance of SAS/SATA hardware  *  \param pRequest Pointer of IO request of the IO  *  \param status   status of the IO  *  \param param    Length  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siAbnormal
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|agsaIORequestDesc_t
modifier|*
name|pRequest
parameter_list|,
name|bit32
name|status
parameter_list|,
name|bit32
name|param
parameter_list|,
name|bit32
name|sspTag
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaDeviceDesc_t
modifier|*
name|pDevice
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5i"
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|==
name|pRequest
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siAbnormal: pRequest is NULL.\n"
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5i"
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* If the request is still valid */
if|if
condition|(
name|agTRUE
operator|==
name|pRequest
operator|->
name|valid
condition|)
block|{
comment|/* get device */
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|->
name|pIORequestContext
operator|->
name|osData
operator|!=
name|pRequest
operator|->
name|pIORequestContext
operator|->
name|sdkData
operator|)
argument_list|,
literal|"pIORequestContext"
argument_list|)
expr_stmt|;
name|pDevice
operator|=
name|pRequest
operator|->
name|pDevice
expr_stmt|;
comment|/* remove the IO request from IOMap */
name|saRoot
operator|->
name|IOMap
index|[
name|pRequest
operator|->
name|HTag
index|]
operator|.
name|Tag
operator|=
name|MARK_OFF
expr_stmt|;
name|saRoot
operator|->
name|IOMap
index|[
name|pRequest
operator|->
name|HTag
index|]
operator|.
name|IORequest
operator|=
name|agNULL
expr_stmt|;
name|saRoot
operator|->
name|IOMap
index|[
name|pRequest
operator|->
name|HTag
index|]
operator|.
name|agContext
operator|=
name|agNULL
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"P6"
argument_list|,
name|status
argument_list|)
expr_stmt|;
comment|/* TP:P6 siAbnormal status */
name|smTrace
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"P7"
argument_list|,
name|param
argument_list|)
expr_stmt|;
comment|/* TP:P7 siAbnormal param */
comment|/* process different request type */
switch|switch
condition|(
name|pRequest
operator|->
name|requestType
operator|&
name|AGSA_REQTYPE_MASK
condition|)
block|{
case|case
name|AGSA_SSP_REQTYPE
case|:
block|{
operator|(
operator|*
call|(
name|ossaSSPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|status
operator|,
name|param
operator|,
name|agNULL
operator|,
call|(
name|bit16
call|)
argument_list|(
name|sspTag
operator|&
name|SSPTAG_BITS
argument_list|)
operator|,
operator|(
operator|(
name|sspTag
operator|&
name|SSP_AGR_S_BIT
operator|)
condition|?
operator|(
literal|1
operator|<<
literal|0
operator|)
else|:
literal|0
operator|)
operator|)
expr_stmt|;
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingIORequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
comment|/* return the request to free pool */
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siAbnormal: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|AGSA_SATA_REQTYPE
case|:
block|{
name|SA_DBG5
argument_list|(
operator|(
literal|"siAbnormal: SATA \n"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|pRequest
operator|->
name|pIORequestContext
condition|)
block|{
name|SA_DBG5
argument_list|(
operator|(
literal|"siAbnormal: Calling SATACompletedCB\n"
operator|)
argument_list|)
expr_stmt|;
operator|(
operator|*
call|(
name|ossaSATACompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|status
operator|,
name|agNULL
operator|,
name|param
operator|,
name|agNULL
operator|)
expr_stmt|;
block|}
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingIORequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* return the request to free pool */
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siAbnormal: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|AGSA_SMP_REQTYPE
case|:
block|{
if|if
condition|(
name|agNULL
operator|!=
name|pRequest
operator|->
name|pIORequestContext
condition|)
block|{
operator|(
operator|*
call|(
name|ossaSMPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|status
operator|,
name|param
operator|,
name|agNULL
operator|)
expr_stmt|;
block|}
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingSMPRequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* return the request to free pool */
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siAbnormal: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siAbnormal: unknown request type (%x) is completed. Tag=0x%x\n"
operator|,
name|pRequest
operator|->
name|requestType
operator|,
name|pRequest
operator|->
name|HTag
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siAbnormal: The request is not valid any more. Tag=0x%x\n"
operator|,
name|pRequest
operator|->
name|HTag
operator|)
argument_list|)
expr_stmt|;
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"5i"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle abnormal DIF completed IO/SMP event  *  *  Handle abnormal completed IO/SMP  *  *  \param agRoot   handles for this instance of SAS/SATA hardware  *  \param pRequest Pointer of IO request of the IO  *  \param status   status of the IO  *  \param param    Length  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siDifAbnormal
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|agsaIORequestDesc_t
modifier|*
name|pRequest
parameter_list|,
name|bit32
name|status
parameter_list|,
name|bit32
name|param
parameter_list|,
name|bit32
name|sspTag
parameter_list|,
name|bit32
modifier|*
name|pMsg1
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaDeviceDesc_t
modifier|*
name|pDevice
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"2S"
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|==
name|pRequest
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siDifAbnormal: pRequest is NULL.\n"
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"2S"
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* If the request is still valid */
if|if
condition|(
name|agTRUE
operator|==
name|pRequest
operator|->
name|valid
condition|)
block|{
comment|/* get device */
name|pDevice
operator|=
name|pRequest
operator|->
name|pDevice
expr_stmt|;
comment|/* remove the IO request from IOMap */
name|saRoot
operator|->
name|IOMap
index|[
name|pRequest
operator|->
name|HTag
index|]
operator|.
name|Tag
operator|=
name|MARK_OFF
expr_stmt|;
name|saRoot
operator|->
name|IOMap
index|[
name|pRequest
operator|->
name|HTag
index|]
operator|.
name|IORequest
operator|=
name|agNULL
expr_stmt|;
name|saRoot
operator|->
name|IOMap
index|[
name|pRequest
operator|->
name|HTag
index|]
operator|.
name|agContext
operator|=
name|agNULL
expr_stmt|;
name|smTrace
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"P6"
argument_list|,
name|status
argument_list|)
expr_stmt|;
comment|/* TP:P6 siDifAbnormal status */
comment|/* process different request type */
switch|switch
condition|(
name|pRequest
operator|->
name|requestType
operator|&
name|AGSA_REQTYPE_MASK
condition|)
block|{
case|case
name|AGSA_SSP_REQTYPE
case|:
block|{
name|agsaDifDetails_t
name|agDifDetails
decl_stmt|;
name|agsaSSPCompletionDifRsp_t
modifier|*
name|pIomb
decl_stmt|;
name|pIomb
operator|=
operator|(
name|agsaSSPCompletionDifRsp_t
operator|*
operator|)
name|pMsg1
expr_stmt|;
name|si_memset
argument_list|(
operator|&
name|agDifDetails
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|agDifDetails
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|UpperLBA
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|UpperLBA
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|LowerLBA
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|LowerLBA
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|sasAddressHi
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|sasAddressHi
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|sasAddressLo
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|sasAddressLo
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|ExpectedCRCUDT01
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|ExpectedCRCUDT01
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|ExpectedUDT2345
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|ExpectedUDT2345
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|ActualCRCUDT01
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|ActualCRCUDT01
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|ActualUDT2345
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|ActualUDT2345
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|DIFErrDevID
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|DIFErrDevID
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|agDifDetails
operator|.
name|ErrBoffsetEDataLen
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|ErrBoffsetEDataLen
argument_list|)
argument_list|)
expr_stmt|;
name|agDifDetails
operator|.
name|frame
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
name|bit8
operator|*
operator|)
operator|(
name|pIomb
operator|+
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionDifRsp_t
argument_list|,
name|EDATA_FRM
argument_list|)
operator|)
expr_stmt|;
operator|(
operator|*
call|(
name|ossaSSPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|status
operator|,
name|param
operator|,
operator|&
name|agDifDetails
operator|,
call|(
name|bit16
call|)
argument_list|(
name|sspTag
operator|&
name|SSPTAG_BITS
argument_list|)
operator|,
operator|(
operator|(
name|sspTag
operator|&
name|SSP_AGR_S_BIT
operator|)
condition|?
operator|(
literal|1
operator|<<
literal|0
operator|)
else|:
literal|0
operator|)
operator|)
expr_stmt|;
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
comment|/* Delete the request from the pendingIORequests */
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* return the request to free pool */
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siDifAbnormal: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siDifAbnormal: unknown request type (%x) is completed. Tag=0x%x\n"
operator|,
name|pRequest
operator|->
name|requestType
operator|,
name|pRequest
operator|->
name|HTag
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siDifAbnormal: The request is not valid any more. Tag=0x%x\n"
operator|,
name|pRequest
operator|->
name|HTag
operator|)
argument_list|)
expr_stmt|;
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"2S"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle for received SMP response event  *  *  The handle for received SMP response event  *  *  \param agRoot      handles for this instance of SAS/SATA hardware  *  \param pIomb       Pointer of payload of IOMB  *  \param payloadSize size of the payload  *  \param tag         the tag of the request SMP  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siSMPRespRcvd
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|agsaSMPCompletionRsp_t
modifier|*
name|pIomb
parameter_list|,
name|bit32
name|payloadSize
parameter_list|,
name|bit32
name|tag
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaFrameHandle_t
name|frameHandle
decl_stmt|;
name|agsaIORequestDesc_t
modifier|*
name|pRequest
decl_stmt|;
name|agsaDeviceDesc_t
modifier|*
name|pDevice
decl_stmt|;
name|agsaPort_t
modifier|*
name|pPort
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5j"
argument_list|)
expr_stmt|;
comment|/* get the request */
name|pRequest
operator|=
operator|(
name|agsaIORequestDesc_t
operator|*
operator|)
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|IORequest
expr_stmt|;
name|SA_ASSERT
argument_list|(
name|pRequest
argument_list|,
literal|"pRequest"
argument_list|)
expr_stmt|;
comment|/* get the port */
name|pPort
operator|=
name|pRequest
operator|->
name|pPort
expr_stmt|;
name|SA_ASSERT
argument_list|(
name|pPort
argument_list|,
literal|"pPort"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pRequest
operator|->
name|IRmode
operator|==
literal|0
condition|)
block|{
comment|/* get frame handle - direct response mode */
name|frameHandle
operator|=
call|(
name|agsaFrameHandle_t
call|)
argument_list|(
operator|&
operator|(
name|pIomb
operator|->
name|SMPrsp
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
name|SA_DBG3
argument_list|(
operator|(
literal|"saSMPRespRcvd(direct): smpRspPtr=0x%p - len=0x%x\n"
operator|,
name|frameHandle
operator|,
name|payloadSize
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SALLSDK_DEBUG */
block|}
else|else
block|{
comment|/* indirect response mode */
name|frameHandle
operator|=
name|agNULL
expr_stmt|;
block|}
comment|/* If the request is still valid */
if|if
condition|(
name|agTRUE
operator|==
name|pRequest
operator|->
name|valid
condition|)
block|{
comment|/* get device */
name|pDevice
operator|=
name|pRequest
operator|->
name|pDevice
expr_stmt|;
name|SA_ASSERT
argument_list|(
name|pDevice
argument_list|,
literal|"pDevice"
argument_list|)
expr_stmt|;
comment|/* Delete the request from the pendingSMPRequests */
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|saLlistIORemove
argument_list|(
operator|&
operator|(
name|pDevice
operator|->
name|pendingIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
comment|/* If the request is from OS layer */
if|if
condition|(
name|agNULL
operator|!=
name|pRequest
operator|->
name|pIORequestContext
condition|)
block|{
if|if
condition|(
name|agNULL
operator|==
name|frameHandle
condition|)
block|{
comment|/* indirect mode */
comment|/* call back with success */
operator|(
operator|*
call|(
name|ossaSMPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|OSSA_IO_SUCCESS
operator|,
name|payloadSize
operator|,
name|frameHandle
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* direct mode */
comment|/* call back with success */
operator|(
operator|*
call|(
name|ossaSMPCompletedCB_t
call|)
argument_list|(
name|pRequest
operator|->
name|completionCB
argument_list|)
operator|)
operator|(
name|agRoot
operator|,
name|pRequest
operator|->
name|pIORequestContext
operator|,
name|OSSA_IO_SUCCESS
operator|,
name|payloadSize
operator|,
name|frameHandle
operator|)
expr_stmt|;
block|}
block|}
comment|/* remove the IO request from IOMap */
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|Tag
operator|=
name|MARK_OFF
expr_stmt|;
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|IORequest
operator|=
name|agNULL
expr_stmt|;
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|agContext
operator|=
name|agNULL
expr_stmt|;
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
name|pRequest
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
if|if
condition|(
name|saLlistIOGetCount
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|)
operator|<
name|SA_RESERVED_REQUEST_COUNT
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siSMPRespRcvd: saving pRequest (%p) for later use\n"
operator|,
name|pRequest
operator|)
argument_list|)
expr_stmt|;
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeReservedRequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* return the request to free pool */
name|saLlistIOAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freeIORequests
operator|)
argument_list|,
operator|&
operator|(
name|pRequest
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
block|}
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_IOREQ_LOCKEQ_LOCK
argument_list|)
expr_stmt|;
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5j"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle for received Phy Up event  *  *  The handle for received Phy Up event  *  *  \param agRoot handles for this instance of SAS/SATA hardware  *  \param phyId for the Phy Up event happened  *  \param agSASIdentify is the remote phy Identify  *  \param portId is the port context index of the phy up event  *  \param deviceId is the device context index  *  \param linkRate link up rate from SPC  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siEventPhyUpRcvd
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|phyId
parameter_list|,
name|agsaSASIdentify_t
modifier|*
name|agSASIdentify
parameter_list|,
name|bit32
name|portId
parameter_list|,
name|bit32
name|npipps
parameter_list|,
name|bit8
name|linkRate
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaPhy_t
modifier|*
name|pPhy
init|=
operator|&
operator|(
name|saRoot
operator|->
name|phys
index|[
name|phyId
index|]
operator|)
decl_stmt|;
name|agsaPort_t
modifier|*
name|pPort
decl_stmt|;
name|agsaSASIdentify_t
name|remoteIdentify
decl_stmt|;
name|agsaPortContext_t
modifier|*
name|agPortContext
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5k"
argument_list|)
expr_stmt|;
comment|/* Read remote SAS Identify from response message and save it */
name|remoteIdentify
operator|=
operator|*
name|agSASIdentify
expr_stmt|;
comment|/* get port context from portMap */
name|SA_DBG2
argument_list|(
operator|(
literal|"siEventPhyUpRcvd:PortID 0x%x PortStatus 0x%x PortContext %p\n"
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
operator|&
name|PORTID_MASK
index|]
operator|.
name|PortID
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
operator|&
name|PORTID_MASK
index|]
operator|.
name|PortStatus
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
operator|&
name|PORTID_MASK
index|]
operator|.
name|PortContext
operator|)
argument_list|)
expr_stmt|;
name|agPortContext
operator|=
operator|(
name|agsaPortContext_t
operator|*
operator|)
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"siEventPhyUpRcvd: portID %d PortContext %p linkRate 0x%X\n"
operator|,
name|portId
operator|,
name|agPortContext
operator|,
name|linkRate
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|smIS_SPCV8006
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siEventPhyUpRcvd: SAS_PHY_UP received for SATA Controller\n"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|agNULL
operator|!=
name|agPortContext
condition|)
block|{
comment|/* existing port */
name|pPort
operator|=
operator|(
name|agsaPort_t
operator|*
operator|)
operator|(
name|agPortContext
operator|->
name|sdkData
operator|)
expr_stmt|;
name|pPort
operator|->
name|portId
operator|=
name|portId
expr_stmt|;
comment|/* include the phy to the port */
name|pPort
operator|->
name|phyMap
index|[
name|phyId
index|]
operator|=
name|agTRUE
expr_stmt|;
comment|/* Set the port for the phy */
name|saRoot
operator|->
name|phys
index|[
name|phyId
index|]
operator|.
name|pPort
operator|=
name|pPort
expr_stmt|;
comment|/* Update port state */
if|if
condition|(
name|OSSA_PORT_VALID
operator|==
operator|(
name|npipps
operator|&
name|PORT_STATE_MASK
operator|)
condition|)
block|{
name|pPort
operator|->
name|status
operator|&=
operator|~
name|PORT_INVALIDATING
expr_stmt|;
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortStatus
operator|&=
operator|~
name|PORT_INVALIDATING
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"siEventPhyUpRcvd: portID %d PortContext %p, hitting workaround\n"
operator|,
name|portId
operator|,
name|agPortContext
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_PORT_LOCK
argument_list|)
expr_stmt|;
comment|/* new port */
comment|/* Allocate a free port */
name|pPort
operator|=
operator|(
name|agsaPort_t
operator|*
operator|)
name|saLlistGetHead
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freePorts
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|pPort
condition|)
block|{
comment|/* Acquire port list lock */
name|saLlistRemove
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freePorts
operator|)
argument_list|,
operator|&
operator|(
name|pPort
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* setup the port data structure */
name|pPort
operator|->
name|portContext
operator|.
name|osData
operator|=
name|agNULL
expr_stmt|;
name|pPort
operator|->
name|portContext
operator|.
name|sdkData
operator|=
name|pPort
expr_stmt|;
comment|/* Add to valid port list */
name|saLlistAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|validPorts
operator|)
argument_list|,
operator|&
operator|(
name|pPort
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* Release port list lock */
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_PORT_LOCK
argument_list|)
expr_stmt|;
comment|/* include the phy to the port */
name|pPort
operator|->
name|phyMap
index|[
name|phyId
index|]
operator|=
name|agTRUE
expr_stmt|;
comment|/* Set the port for the phy */
name|saRoot
operator|->
name|phys
index|[
name|phyId
index|]
operator|.
name|pPort
operator|=
name|pPort
expr_stmt|;
comment|/* Setup portMap based on portId */
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortID
operator|=
name|portId
expr_stmt|;
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
operator|=
operator|&
operator|(
name|pPort
operator|->
name|portContext
operator|)
expr_stmt|;
name|pPort
operator|->
name|portId
operator|=
name|portId
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"siEventPhyUpRcvd: NewPort portID %d PortContext %p\n"
operator|,
name|portId
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_PORT_LOCK
argument_list|)
expr_stmt|;
comment|/* pPort is agNULL*/
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5k"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|OSSA_PORT_VALID
operator|==
operator|(
name|npipps
operator|&
name|PORT_STATE_MASK
operator|)
condition|)
block|{
name|pPort
operator|->
name|status
operator|&=
operator|~
name|PORT_INVALIDATING
expr_stmt|;
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortStatus
operator|&=
operator|~
name|PORT_INVALIDATING
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siEventPhyUpRcvd: PortInvalid portID %d PortContext %p\n"
operator|,
name|portId
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* adjust the bit fields before callback */
name|phyId
operator|=
operator|(
name|linkRate
operator|<<
name|SHIFT8
operator|)
operator||
name|phyId
expr_stmt|;
comment|/* report PhyId, NPIP, PortState */
name|phyId
operator||=
operator|(
name|npipps
operator|&
name|PHY_IN_PORT_MASK
operator|)
operator||
operator|(
operator|(
name|npipps
operator|&
name|PORT_STATE_MASK
operator|)
operator|<<
name|SHIFT16
operator|)
expr_stmt|;
name|ossaHwCB
argument_list|(
name|agRoot
argument_list|,
operator|&
operator|(
name|pPort
operator|->
name|portContext
operator|)
argument_list|,
name|OSSA_HW_EVENT_SAS_PHY_UP
argument_list|,
name|phyId
argument_list|,
name|agNULL
argument_list|,
operator|&
name|remoteIdentify
argument_list|)
expr_stmt|;
comment|/* set PHY_UP status */
name|PHY_STATUS_SET
argument_list|(
name|pPhy
argument_list|,
name|PHY_UP
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"5k"
argument_list|)
expr_stmt|;
comment|/* return */
return|return;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Routine to handle for received SATA signature event  *  *  The handle for received SATA signature event  *  *  \param agRoot   handles for this instance of SAS/SATA hardware  *  \param phyId    the phy id of the phy received the frame  *  \param pMsg     the pointer to the message payload  *  \param portId   the port context index of the phy up event  *  \param deviceId the device context index  *  \param linkRate link up rate from SPC  *  *  \return -void-  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|void
name|siEventSATASignatureRcvd
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
name|phyId
parameter_list|,
name|void
modifier|*
name|pMsg
parameter_list|,
name|bit32
name|portId
parameter_list|,
name|bit32
name|npipps
parameter_list|,
name|bit8
name|linkRate
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaPhy_t
modifier|*
name|pPhy
init|=
operator|&
operator|(
name|saRoot
operator|->
name|phys
index|[
name|phyId
index|]
operator|)
decl_stmt|;
name|agsaPort_t
modifier|*
name|pPort
init|=
name|agNULL
decl_stmt|;
name|agsaPortContext_t
modifier|*
name|agPortContext
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
name|agsaFisRegDeviceToHost_t
modifier|*
name|fisD2H
decl_stmt|;
comment|/* Read the D2H FIS */
name|fisD2H
operator|=
operator|(
name|agsaFisRegDeviceToHost_t
operator|*
operator|)
name|pMsg
expr_stmt|;
endif|#
directive|endif
comment|/* SALLSDK_DEBUG */
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5m"
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"siEventSATASignatureRcvd: About to read the signatureFIS data\n"
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"agsaFisRegDeviceToHost_t:\n"
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  fisType         = %x\n"
operator|,
name|fisD2H
operator|->
name|h
operator|.
name|fisType
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  i_pmPort        = %x\n"
operator|,
name|fisD2H
operator|->
name|h
operator|.
name|i_pmPort
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  status          = %x\n"
operator|,
name|fisD2H
operator|->
name|h
operator|.
name|status
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  error           = %x\n"
operator|,
name|fisD2H
operator|->
name|h
operator|.
name|error
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  lbaLow          = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|lbaLow
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  lbaMid          = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|lbaMid
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  lbaHigh         = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|lbaHigh
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  device          = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|device
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  lbaLowExp       = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|lbaLowExp
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  lbaMidExp       = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|lbaMidExp
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  lbaHighExp      = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|lbaHighExp
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  reserved4       = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|reserved4
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  sectorCount     = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|sectorCount
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  sectorCountExp  = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|sectorCountExp
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  reserved5       = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|reserved5
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  reserved6       = %x\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|reserved6
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"  reserved7 (32)  = %08X\n"
operator|,
name|fisD2H
operator|->
name|d
operator|.
name|reserved7
operator|)
argument_list|)
expr_stmt|;
name|SA_DBG5
argument_list|(
operator|(
literal|"siEventSATASignatureRcvd: GOOD signatureFIS data\n"
operator|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
comment|/* read signature */
name|pPhy
operator|->
name|remoteSignature
index|[
literal|0
index|]
operator|=
operator|(
name|bit8
operator|)
name|fisD2H
operator|->
name|d
operator|.
name|sectorCount
expr_stmt|;
name|pPhy
operator|->
name|remoteSignature
index|[
literal|1
index|]
operator|=
operator|(
name|bit8
operator|)
name|fisD2H
operator|->
name|d
operator|.
name|lbaLow
expr_stmt|;
name|pPhy
operator|->
name|remoteSignature
index|[
literal|2
index|]
operator|=
operator|(
name|bit8
operator|)
name|fisD2H
operator|->
name|d
operator|.
name|lbaMid
expr_stmt|;
name|pPhy
operator|->
name|remoteSignature
index|[
literal|3
index|]
operator|=
operator|(
name|bit8
operator|)
name|fisD2H
operator|->
name|d
operator|.
name|lbaHigh
expr_stmt|;
name|pPhy
operator|->
name|remoteSignature
index|[
literal|4
index|]
operator|=
operator|(
name|bit8
operator|)
name|fisD2H
operator|->
name|d
operator|.
name|device
expr_stmt|;
endif|#
directive|endif
comment|/* get port context from portMap */
name|SA_DBG2
argument_list|(
operator|(
literal|"siEventSATASignatureRcvd:PortID 0x%x PortStatus 0x%x PortContext %p\n"
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
operator|&
name|PORTID_MASK
index|]
operator|.
name|PortID
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
operator|&
name|PORTID_MASK
index|]
operator|.
name|PortStatus
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
operator|&
name|PORTID_MASK
index|]
operator|.
name|PortContext
operator|)
argument_list|)
expr_stmt|;
name|agPortContext
operator|=
operator|(
name|agsaPortContext_t
operator|*
operator|)
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"siEventSATASignatureRcvd: portID %d PortContext %p\n"
operator|,
name|portId
operator|,
name|agPortContext
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|agPortContext
condition|)
block|{
comment|/* exist port */
name|pPort
operator|=
operator|(
name|agsaPort_t
operator|*
operator|)
operator|(
name|agPortContext
operator|->
name|sdkData
operator|)
expr_stmt|;
name|pPort
operator|->
name|portId
operator|=
name|portId
expr_stmt|;
comment|/* include the phy to the port */
name|pPort
operator|->
name|phyMap
index|[
name|phyId
index|]
operator|=
name|agTRUE
expr_stmt|;
comment|/* Set the port for the phy */
name|saRoot
operator|->
name|phys
index|[
name|phyId
index|]
operator|.
name|pPort
operator|=
name|pPort
expr_stmt|;
block|}
else|else
block|{
name|ossaSingleThreadedEnter
argument_list|(
name|agRoot
argument_list|,
name|LL_PORT_LOCK
argument_list|)
expr_stmt|;
comment|/* new port */
comment|/* Allocate a free port */
name|pPort
operator|=
operator|(
name|agsaPort_t
operator|*
operator|)
name|saLlistGetHead
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freePorts
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|!=
name|pPort
condition|)
block|{
comment|/* Acquire port list lock */
name|saLlistRemove
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|freePorts
operator|)
argument_list|,
operator|&
operator|(
name|pPort
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* setup the port data structure */
name|pPort
operator|->
name|portContext
operator|.
name|osData
operator|=
name|agNULL
expr_stmt|;
name|pPort
operator|->
name|portContext
operator|.
name|sdkData
operator|=
name|pPort
expr_stmt|;
comment|/* Add to valid port list */
name|saLlistAdd
argument_list|(
operator|&
operator|(
name|saRoot
operator|->
name|validPorts
operator|)
argument_list|,
operator|&
operator|(
name|pPort
operator|->
name|linkNode
operator|)
argument_list|)
expr_stmt|;
comment|/* Release port list lock */
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_PORT_LOCK
argument_list|)
expr_stmt|;
comment|/* include the phy to the port */
name|pPort
operator|->
name|phyMap
index|[
name|phyId
index|]
operator|=
name|agTRUE
expr_stmt|;
comment|/* Set the port for the phy */
name|saRoot
operator|->
name|phys
index|[
name|phyId
index|]
operator|.
name|pPort
operator|=
name|pPort
expr_stmt|;
comment|/* Setup portMap based on portId */
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortID
operator|=
name|portId
expr_stmt|;
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
operator|=
operator|&
operator|(
name|pPort
operator|->
name|portContext
operator|)
expr_stmt|;
name|pPort
operator|->
name|portId
operator|=
name|portId
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"siEventSATASignatureRcvd: NewPort portID %d portContect %p\n"
operator|,
name|portId
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ossaSingleThreadedLeave
argument_list|(
name|agRoot
argument_list|,
name|LL_PORT_LOCK
argument_list|)
expr_stmt|;
comment|/* pPort is agNULL*/
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5m"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|OSSA_PORT_VALID
operator|==
operator|(
name|npipps
operator|&
name|PORT_STATE_MASK
operator|)
condition|)
block|{
name|pPort
operator|->
name|status
operator|&=
operator|~
name|PORT_INVALIDATING
expr_stmt|;
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortStatus
operator|&=
operator|~
name|PORT_INVALIDATING
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"siEventSATASignatureRcvd: PortInvalid portID %d PortContext %p\n"
operator|,
name|portId
operator|,
name|saRoot
operator|->
name|PortMap
index|[
name|portId
index|]
operator|.
name|PortContext
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* adjust the bit fields before callback */
name|phyId
operator|=
operator|(
name|linkRate
operator|<<
name|SHIFT8
operator|)
operator||
name|phyId
expr_stmt|;
comment|/* report PhyId, NPIP, PortState */
name|phyId
operator||=
operator|(
name|npipps
operator|&
name|PHY_IN_PORT_MASK
operator|)
operator||
operator|(
operator|(
name|npipps
operator|&
name|PORT_STATE_MASK
operator|)
operator|<<
name|SHIFT16
operator|)
expr_stmt|;
name|ossaHwCB
argument_list|(
name|agRoot
argument_list|,
operator|&
operator|(
name|pPort
operator|->
name|portContext
operator|)
argument_list|,
name|OSSA_HW_EVENT_SATA_PHY_UP
argument_list|,
name|phyId
argument_list|,
name|agNULL
argument_list|,
name|pMsg
argument_list|)
expr_stmt|;
comment|/* set PHY_UP status */
name|PHY_STATUS_SET
argument_list|(
name|pPhy
argument_list|,
name|PHY_UP
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"5m"
argument_list|)
expr_stmt|;
comment|/* return */
return|return;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief Process Outbound IOMB Message  *  *  Process Outbound IOMB from SPC  *  *  \param agRoot       Handles for this instance of SAS/SATA LL Layer  *  \param pMsg1        Pointer of Response IOMB message 1  *  \param category     category of outbpond IOMB header  *  \param opcode       Opcode of Outbound IOMB header  *  \param bc           buffer count of IOMB header  *  *  \return success or fail  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|bit32
name|mpiParseOBIomb
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
modifier|*
name|pMsg1
parameter_list|,
name|mpiMsgCategory_t
name|category
parameter_list|,
name|bit16
name|opcode
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|bit32
name|ret
init|=
name|AGSA_RC_SUCCESS
decl_stmt|;
name|bit32
name|parserStatus
init|=
name|AGSA_RC_SUCCESS
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"2f"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|opcode
condition|)
block|{
case|case
name|OPC_OUB_COMBINED_SSP_COMP
case|:
block|{
name|agsaSSPCoalescedCompletionRsp_t
modifier|*
name|pIomb
init|=
operator|(
name|agsaSSPCoalescedCompletionRsp_t
operator|*
operator|)
name|pMsg1
decl_stmt|;
name|agsaIORequestDesc_t
modifier|*
name|pRequest
init|=
name|agNULL
decl_stmt|;
name|bit32
name|tag
init|=
literal|0
decl_stmt|;
name|bit32
name|sspTag
init|=
literal|0
decl_stmt|;
name|bit32
name|count
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPCompleted
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SSP_COMP Response received IOMB=%p %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPCompleted
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_COMBINED_SSP_COMP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* get Tag */
for|for
control|(
name|count
operator|=
literal|0
init|;
name|count
operator|<
name|pIomb
operator|->
name|coalescedCount
condition|;
name|count
operator|++
control|)
block|{
name|tag
operator|=
name|pIomb
operator|->
name|sspComplCxt
index|[
name|count
index|]
operator|.
name|tag
expr_stmt|;
name|sspTag
operator|=
name|pIomb
operator|->
name|sspComplCxt
index|[
name|count
index|]
operator|.
name|SSPTag
expr_stmt|;
name|pRequest
operator|=
operator|(
name|agsaIORequestDesc_t
operator|*
operator|)
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|IORequest
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|)
argument_list|,
literal|"pRequest"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pRequest
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb,OPC_OUB_COMBINED_SSP_COMP Resp IOMB tag=0x%x, status=0x%x, param=0x%x, SSPTag=0x%x\n"
operator|,
name|tag
operator|,
name|OSSA_IO_SUCCESS
operator|,
literal|0
operator|,
name|sspTag
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_ENABLE_PCI_TRIGGER
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|PCI_trigger
operator|&
name|PCI_TRIGGER_COAL_IOMB_ERROR
condition|)
block|{
name|siPCITriger
argument_list|(
name|agRoot
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SA_ENABLE_PCI_TRIGGER */
return|return
operator|(
name|AGSA_RC_FAILURE
operator|)
return|;
block|}
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|->
name|valid
operator|)
argument_list|,
literal|"pRequest->valid"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_ENABLE_PCI_TRIGGER
if|if
condition|(
operator|!
name|pRequest
operator|->
name|valid
condition|)
block|{
if|if
condition|(
name|saRoot
operator|->
name|swConfig
operator|.
name|PCI_trigger
operator|&
name|PCI_TRIGGER_COAL_INVALID
condition|)
block|{
name|siPCITriger
argument_list|(
name|agRoot
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* SA_ENABLE_PCI_TRIGGER */
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_COMBINED_SSP_COMP IOMB tag=0x%x, status=0x%x, param=0x%x, SSPTag=0x%x\n"
operator|,
name|tag
operator|,
name|OSSA_IO_SUCCESS
operator|,
literal|0
operator|,
name|sspTag
operator|)
argument_list|)
expr_stmt|;
comment|/* Completion of SSP without Response Data */
name|siIODone
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_SUCCESS
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OPC_OUB_SSP_COMP
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPCompleted
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SSP_COMP Response received IOMB=%p %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPCompleted
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SSP_COMP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the SSP IO Completed response message */
name|mpiSSPCompletion
argument_list|(
name|agRoot
argument_list|,
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_COMBINED_SATA_COMP
case|:
block|{
name|agsaSATACoalescedCompletionRsp_t
modifier|*
name|pIomb
decl_stmt|;
name|agsaIORequestDesc_t
modifier|*
name|pRequest
decl_stmt|;
name|bit32
name|tag
decl_stmt|;
name|bit32
name|count
decl_stmt|;
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPCompleted
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_COMBINED_SATA_COMP Response received IOMB=%p %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPCompleted
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_COMBINED_SATA_COMP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pIomb
operator|=
operator|(
name|agsaSATACoalescedCompletionRsp_t
operator|*
operator|)
name|pMsg1
expr_stmt|;
comment|/* get Tag */
for|for
control|(
name|count
operator|=
literal|0
init|;
name|count
operator|<
name|pIomb
operator|->
name|coalescedCount
condition|;
name|count
operator|++
control|)
block|{
name|tag
operator|=
name|pIomb
operator|->
name|stpComplCxt
index|[
name|count
index|]
operator|.
name|tag
expr_stmt|;
name|pRequest
operator|=
operator|(
name|agsaIORequestDesc_t
operator|*
operator|)
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|IORequest
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|)
argument_list|,
literal|"pRequest"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pRequest
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb,OPC_OUB_COMBINED_SATA_COMP Resp IOMB tag=0x%x, status=0x%x, param=0x%x\n"
operator|,
name|tag
operator|,
name|OSSA_IO_SUCCESS
operator|,
literal|0
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|AGSA_RC_FAILURE
operator|)
return|;
block|}
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|->
name|valid
operator|)
argument_list|,
literal|"pRequest->valid"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_COMBINED_SATA_COMP IOMB tag=0x%x, status=0x%x, param=0x%x\n"
operator|,
name|tag
operator|,
name|OSSA_IO_SUCCESS
operator|,
literal|0
operator|)
argument_list|)
expr_stmt|;
comment|/* Completion of SATA without Response Data */
name|siIODone
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_SUCCESS
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|OPC_OUB_SATA_COMP
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSataCompleted
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SATA_COMP Response received IOMB=%p %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSataCompleted
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SATA_COMP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the response message */
name|mpiSATACompletion
argument_list|(
name|agRoot
argument_list|,
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SSP_ABORT_RSP
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPAbortedCB
operator|++
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SSP_ABORT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the response message */
name|parserStatus
operator|=
name|mpiSSPAbortRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSSPAbortRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
if|if
condition|(
name|parserStatus
operator|!=
name|AGSA_RC_SUCCESS
condition|)
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, mpiSSPAbortRsp FAIL IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|OPC_OUB_SATA_ABORT_RSP
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSataAbortedCB
operator|++
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SATA_ABORT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the response message */
name|mpiSATAAbortRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSATAAbortRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SATA_EVENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SATA_EVENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSATAEvent
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSATAEventRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SSP_EVENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SSP_EVENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSSPEvent
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSSPEventRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SMP_COMP
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSMPCompleted
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SMP_COMP Response received IOMB=%p, %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSMPCompleted
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SMP_COMP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the response message */
name|mpiSMPCompletion
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSMPCompletionRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_ECHO
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numEchoCB
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, ECHO Response received %d\n"
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numEchoCB
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, ECHO Response received\n"
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the response message */
name|mpiEchoRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaEchoRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_NVMD_DATA
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_NVMD_DATA received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetNVMDataRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetNVMDataRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SPC_HW_EVENT
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPC"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SPC_HW_EVENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiHWevent
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaHWEvent_SPC_OUB_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_HW_EVENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, HW_EVENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiHWevent
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaHWEvent_SPC_OUB_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_PHY_START_RESPONSE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_PHY_START_RESPONSE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiPhyStartEvent
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaHWEvent_Phy_OUB_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_PHY_STOP_RESPONSE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_PHY_STOP_RESPONSE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiPhyStopEvent
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaHWEvent_Phy_OUB_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_LOCAL_PHY_CNTRL
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, PHY CONTROL Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiPhyCntrlRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaLocalPhyCntrlRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SPC_DEV_REGIST
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPC"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SPC_DEV_REGIST Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDeviceRegRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDeviceRegistrationRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DEV_REGIST
case|:
block|{
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiParseOBIomb, DEV_REGISTRATION Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDeviceRegRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDeviceRegistrationRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DEREG_DEV
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, DEREGISTRATION DEVICE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDeregDevHandleRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDeregDevHandleRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_DEV_HANDLE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, GET_DEV_HANDLE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetDevHandleRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetDevHandleRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SPC_DEV_HANDLE_ARRIV
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SPC_DEV_HANDLE_ARRIV Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDeviceHandleArrived
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDeviceHandleArrivedNotify_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DEV_HANDLE_ARRIV
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, DEV_HANDLE_ARRIV Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDeviceHandleArrived
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDeviceHandleArrivedNotify_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SSP_RECV_EVENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SSP_RECV_EVENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSSPReqReceivedNotify
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSSPReqReceivedNotify_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DEV_INFO
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPCV
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPCV"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, DEV_INFO Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetDevInfoRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetDevInfoRspV_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_PHY_PROFILE_RSP
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPCV
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPCV"
argument_list|)
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_PHY_PROFILE_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetPhyProfileRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetPhyProfileRspV_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SET_PHY_PROFILE_RSP
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPCV
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPCV"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_PHY_PROFILE_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSetPhyProfileRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSetPhyProfileRspV_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SPC_DEV_INFO
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPC"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, DEV_INFO Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetDevInfoRspSpc
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetDevInfoRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_FW_FLASH_UPDATE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_FW_FLASH_UPDATE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiFwFlashUpdateRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaFwFlashUpdateRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_FLASH_OP_EXT_RSP
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_FLASH_OP_EXT_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiFwExtFlashUpdateRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaFwFlashOpExtRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
ifdef|#
directive|ifdef
name|SPC_ENABLE_PROFILE
case|case
name|OPC_OUB_FW_PROFILE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_FW_PROFILE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiFwProfileRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaFwProfileRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
case|case
name|OPC_OUB_SET_NVMD_DATA
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_NVMD_DATA received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSetNVMDataRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSetNVMDataRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GPIO_RESPONSE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_GPIO_RESPONSE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGPIORsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGPIORsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GPIO_EVENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_GPIO_RESPONSE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGPIOEventRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGPIOEvent_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GENERAL_EVENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_GENERAL_EVENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGeneralEventRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGeneralEventRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SAS_DIAG_MODE_START_END
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SAS_DIAG_MODE_START_END Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSASDiagStartEndRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSASDiagStartEndRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SAS_DIAG_EXECUTE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SAS_DIAG_EXECUTE_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSASDiagExecuteRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSASDiagExecuteRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_TIME_STAMP
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_TIME_STAMP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetTimeStampRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetTimeStampRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SPC_SAS_HW_EVENT_ACK
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPC"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb,OPC_OUB_SPC_SAS_HW_EVENT_ACK  Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSASHwEventAckRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSASHwEventAckRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SAS_HW_EVENT_ACK
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPCV
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPCV"
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SAS_HW_EVENT_ACK Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSASHwEventAckRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSASHwEventAckRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_PORT_CONTROL
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_PORT_CONTROL Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiPortControlRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaPortControlRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SMP_ABORT_RSP
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSMPAbortedCB
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, SMP_ABORT Response received IOMB=%p, %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSMPAbortedCB
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SMP_ABORT_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* process the response message */
name|mpiSMPAbortRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSMPAbortRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DEVICE_HANDLE_REMOVAL
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_DEVICE_HANDLE_REMOVAL received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDeviceHandleRemoval
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDeviceHandleRemoval_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SET_DEVICE_STATE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_DEVICE_STATE received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSetDeviceStateRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSetDeviceStateRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_DEVICE_STATE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_DEVICE_STATE received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetDeviceStateRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetDeviceStateRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SET_DEV_INFO
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_DEV_INFO received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSetDevInfoRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSetDeviceInfoRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SAS_RE_INITIALIZE
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPC
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPC"
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SAS_RE_INITIALIZE received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSasReInitializeRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSasReInitializeRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SGPIO_RESPONSE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SGPIO_RESPONSE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiSGpioRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSGpioRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_PCIE_DIAG_EXECUTE
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_PCIE_DIAG_EXECUTE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiPCIeDiagExecuteRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaPCIeDiagExecuteRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_VIST_CAP_RSP
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_INB_GET_VIST_CAP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetVHistRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetVHistCapRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|2104
case|:
block|{
if|if
condition|(
name|smIS_SPC6V
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_DFE_DATA_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetDFEDataRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetDDEFDataRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|smIS_SPC12V
argument_list|(
name|agRoot
argument_list|)
condition|)
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_INB_GET_VIST_CAP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiGetVHistRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetVHistCapRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, 2104  Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
block|}
break|break;
block|}
case|case
name|OPC_OUB_SET_CONTROLLER_CONFIG
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_CONTROLLER_CONFIG Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiSetControllerConfigRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSetControllerConfigRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_CONTROLLER_CONFIG
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_CONTROLLER_CONFIG Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiGetControllerConfigRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetControllerConfigRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_KEK_MANAGEMENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_KEK_MANAGEMENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiKekManagementRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaKekManagementRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DEK_MANAGEMENT
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_DEK_MANAGEMENT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiDekManagementRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDekManagementRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_OPR_MGMT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_OPR_MGMT Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiOperatorManagementRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaOperatorMangmenRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_ENC_TEST_EXECUTE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_ENC_TEST_EXECUTE Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiBistRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaEncryptBistRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_SET_OPERATOR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SET_OPERATOR Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiSetOperatorRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaSetOperatorRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_GET_OPERATOR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_GET_OPERATOR Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
name|mpiGetOperatorRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaGetOperatorRsp_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OPC_OUB_DIF_ENC_OFFLOAD_RSP
case|:
block|{
name|SA_ASSERT
argument_list|(
operator|(
name|smIS_SPCV
argument_list|(
name|agRoot
argument_list|)
operator|)
argument_list|,
literal|"smIS_SPCV"
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_DIF_ENC_OFFLOAD_RSP Response received IOMB=%p\n"
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
comment|/* process the response message */
name|mpiDifEncOffloadRsp
argument_list|(
name|agRoot
argument_list|,
operator|(
name|agsaDifEncOffloadRspV_t
operator|*
operator|)
name|pMsg1
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numUNKNWRespIOMB
operator|++
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, UnKnown Response received IOMB=%p, %d\n"
operator|,
name|pMsg1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numUNKNWRespIOMB
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, Unknown IOMB Response received opcode 0x%X IOMB=%p\n"
operator|,
name|opcode
operator|,
name|pMsg1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
block|}
block|}
comment|/* switch */
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"2f"
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief SPC MPI SATA Completion  *  *  This function handles the SATA completion.  *  *  \param agRoot       Handles for this instance of SAS/SATA LLL  *  \param pIomb1       Pointer of Message1  *  \param bc           buffer count  *  *  \return The read value  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|FORCEINLINE
name|bit32
name|mpiSATACompletion
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
modifier|*
name|pIomb1
parameter_list|)
block|{
name|bit32
name|ret
init|=
name|AGSA_RC_SUCCESS
decl_stmt|;
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|bit32
name|status
decl_stmt|;
name|bit32
name|tag
decl_stmt|;
name|bit32
name|param
decl_stmt|;
name|agsaIORequestDesc_t
modifier|*
name|pRequest
decl_stmt|;
name|bit32
modifier|*
name|agFirstDword
decl_stmt|;
name|bit32
modifier|*
name|pResp
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"2s"
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|AGROOT
argument_list|,
operator|&
name|tag
argument_list|,
name|pIomb1
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSATACompletionRsp_t
argument_list|,
name|tag
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|AGROOT
argument_list|,
operator|&
name|status
argument_list|,
name|pIomb1
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSATACompletionRsp_t
argument_list|,
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|AGROOT
argument_list|,
operator|&
name|param
argument_list|,
name|pIomb1
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSATACompletionRsp_t
argument_list|,
name|param
argument_list|)
argument_list|)
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiSATACompletion: start, HTAG=0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
comment|/* get IOrequest from IOMap */
name|pRequest
operator|=
operator|(
name|agsaIORequestDesc_t
operator|*
operator|)
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|IORequest
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|)
argument_list|,
literal|"pRequest"
argument_list|)
expr_stmt|;
if|if
condition|(
name|agNULL
operator|==
name|pRequest
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: agNULL == pRequest tag 0x%X status 0x%X\n"
operator|,
name|tag
operator|,
name|status
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"2s"
argument_list|)
expr_stmt|;
return|return
name|AGSA_RC_FAILURE
return|;
block|}
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|->
name|valid
operator|)
argument_list|,
literal|"pRequest->valid"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pRequest
operator|->
name|valid
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: not valid IOMB tag=0x%x status=0x%x param=0x%x Device =0x%x\n"
operator|,
name|tag
operator|,
name|status
operator|,
name|param
operator|,
name|pRequest
operator|->
name|pDevice
condition|?
name|pRequest
operator|->
name|pDevice
operator|->
name|DeviceMapIndex
else|:
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|status
condition|)
block|{
case|case
name|OSSA_IO_SUCCESS
case|:
block|{
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_SUCCESS, param=0x%x\n"
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|param
condition|)
block|{
comment|/* SATA request completion */
name|siIODone
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_SUCCESS
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* param number bytes of SATA Rsp */
name|agFirstDword
operator|=
operator|&
name|pIomb1
index|[
literal|3
index|]
expr_stmt|;
name|pResp
operator|=
operator|&
name|pIomb1
index|[
literal|4
index|]
expr_stmt|;
comment|/* CB function to the up layer */
comment|/* Response Length not include firstDW */
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_COMPLETED_ERROR_SCSI_STATUS
operator|++
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiSATACompletion: param 0x%x agFirstDwordResp 0x%x Resp 0x%x tag 0x%x\n"
operator|,
name|param
operator|,
operator|*
name|agFirstDword
operator|,
operator|*
name|pResp
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|siEventSATAResponseWtDataRcvd
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|agFirstDword
argument_list|,
name|pResp
argument_list|,
operator|(
name|param
operator|-
literal|4
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|OSSA_IO_ABORTED
case|:
block|{
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_ABORTED tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_ABORTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_UNDERFLOW
case|:
block|{
comment|/* SATA Completion with error */
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_UNDERFLOW tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
comment|/*underflow means underrun, treat it as success*/
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_UNDERFLOW
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_NO_DEVICE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_NO_DEVICE tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_NO_DEVICE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_BREAK
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_ERROR_BREAK SPC tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_BREAK
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_PHY_NOT_READY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_ERROR_PHY_NOT_READY tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_PHY_NOT_READY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_PROTOCOL_NOT_SUPPORTED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_PROTOCOL_NOT_SUPPORTED tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_PROTOCOL_NOT_SUPPORTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_ZONE_VIOLATION
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_ZONE_VIOLATION tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_ZONE_VIOLATION
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_BREAK
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_BREAK SPC tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_BREAK
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_BAD_DESTINATION
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_BAD_DESTINATION tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_BAD_DESTINATION
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_CONNECTION_RATE_NOT_SUPPORTED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_CONNECTION_RATE_NOT_SUPPORTED tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_CONNECTION_RATE_NOT_SUPPORTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_STP_RESOURCES_BUSY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_STP_RESOURCES_BUSY tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_STP_RESOURCES_BUSY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_WRONG_DESTINATION
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_WRONG_DESTINATION tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_WRONG_DESTINATION
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_NAK_RECEIVED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_ERROR_NAK_RECEIVED tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_NAK_RECEIVED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_DMA
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_ERROR_DMA tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_DMA
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_SATA_LINK_TIMEOUT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_ERROR_SATA_LINK_TIMEOUT tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_SATA_LINK_TIMEOUT
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_REJECTED_NCQ_MODE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_ERROR_REJECTED_NCQ_MODE tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_REJECTED_NCQ_MODE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_OPEN_RETRY_TIMEOUT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_XFER_OPEN_RETRY_TIMEOUT tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_OPEN_RETRY_TIMEOUT
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_PORT_IN_RESET
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_PORT_IN_RESET tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_PORT_IN_RESET
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_NON_OPERATIONAL
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_DS_NON_OPERATIONAL tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_NON_OPERATIONAL
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_IN_RECOVERY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_DS_IN_RECOVERY tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_IN_RECOVERY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_IN_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_DS_IN_ERROR tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_IN_ERROR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_ABORT_IN_PROGRESS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_ABORT_IN_PROGRESS tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_ABORT_IN_PROGRESS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_ABORT_DELAYED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_ABORT_DELAYED tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_ABORT_DELAYED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY_ALT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY_ALT tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY_ALT
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_RETRY_BACKOFF_THRESHOLD_REACHED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_RETRY_BACKOFF_THRESHOLD_REACHED HTAG = 0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_RETRY_BACKOFF_THRESHOLD_REACHED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_TMO
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_TMO tag 0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_TMO
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_NO_DEST
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_NO_DEST tag 0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_NO_DEST
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_COLLIDE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_COLLIDE tag 0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_COLLIDE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_PATHWAY_BLOCKED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion, OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_PATHWAY_BLOCKED tag 0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_PATHWAY_BLOCKED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_INVALID
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_DS_INVALID tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_INVALID
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERR_LAST_PIO_DATAIN_CRC_ERR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFER_ERR_LAST_PIO_DATAIN_CRC_ERR tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERR_LAST_PIO_DATAIN_CRC_ERR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_MPI_IO_RQE_BUSY_FULL
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_MPI_IO_RQE_BUSY_FULL tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_MPI_IO_RQE_BUSY_FULL
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
ifdef|#
directive|ifdef
name|REMOVED
case|case
name|OSSA_IO_XFER_ERR_EOB_DATA_OVERRUN
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFER_ERR_EOB_DATA_OVERRUN tag 0x%x\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERR_EOB_DATA_OVERRUN
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
case|case
name|OSSA_MPI_ERR_IO_RESOURCE_UNAVAILABLE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OPC_OUB_SATA_COMP:OSSA_MPI_ERR_IO_RESOURCE_UNAVAILABLE \n"
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_MPI_ERR_IO_RESOURCE_UNAVAILABLE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_MPI_ERR_ATAPI_DEVICE_BUSY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_MPI_ERR_ATAPI_DEVICE_BUSY tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_MPI_ERR_ATAPI_DEVICE_BUSY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_CIPHER_MODE_INVALID
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_CIPHER_MODE_INVALID tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_IV_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_DEK_IV_MISMATCH tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_IV_MISMATCH
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_RAM_INTERFACE_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_DEK_RAM_INTERFACE_ERROR tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_RAM_INTERFACE_ERROR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_OPEN_PREEMPTED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_OPEN_CNX_ERROR_OPEN_PREEMPTED tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_OPEN_PREEMPTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_KEY_TAG_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_DEK_KEY_TAG_MISMATCH tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_KEY_TAG_MISMATCH
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_ILLEGAL_TABLE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: OSSA_IO_XFR_ERROR_DEK_ILLEGAL_TABLE tag 0x%X\n"
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: Unknown status  0x%x tag 0x%x\n"
operator|,
name|status
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_UNKNOWN_ERROR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
comment|/* The HTag should equal to the IOMB tag */
if|if
condition|(
name|pRequest
operator|->
name|HTag
operator|!=
name|tag
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSATACompletion: Error Htag %d not equal IOMBtag %d\n"
operator|,
name|pRequest
operator|->
name|HTag
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"2s"
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/*! \brief SPC MPI SSP Completion  *  *  This function handles the SSP completion.  *  *  \param agRoot       Handles for this instance of SAS/SATA LLL  *  \param pIomb1       Pointer of Message1  *  \param bc           buffer count  *  *  \return The read value  *  */
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_function
name|GLOBAL
name|FORCEINLINE
name|bit32
name|mpiSSPCompletion
parameter_list|(
name|agsaRoot_t
modifier|*
name|agRoot
parameter_list|,
name|bit32
modifier|*
name|pIomb1
parameter_list|)
block|{
name|agsaLLRoot_t
modifier|*
name|saRoot
init|=
operator|(
name|agsaLLRoot_t
operator|*
operator|)
operator|(
name|agRoot
operator|->
name|sdkData
operator|)
decl_stmt|;
name|agsaSSPCompletionRsp_t
modifier|*
name|pIomb
init|=
operator|(
name|agsaSSPCompletionRsp_t
operator|*
operator|)
name|pIomb1
decl_stmt|;
name|agsaIORequestDesc_t
modifier|*
name|pRequest
init|=
name|agNULL
decl_stmt|;
name|agsaSSPResponseInfoUnit_t
modifier|*
name|pRespIU
init|=
name|agNULL
decl_stmt|;
name|bit32
name|tag
init|=
literal|0
decl_stmt|;
name|bit32
name|sspTag
init|=
literal|0
decl_stmt|;
name|bit32
name|status
decl_stmt|,
name|param
init|=
literal|0
decl_stmt|;
name|bit32
name|ret
init|=
name|AGSA_RC_SUCCESS
decl_stmt|;
name|smTraceFuncEnter
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|"5A"
argument_list|)
expr_stmt|;
comment|/* get Tag */
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|tag
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionRsp_t
argument_list|,
name|tag
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|status
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionRsp_t
argument_list|,
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|param
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionRsp_t
argument_list|,
name|param
argument_list|)
argument_list|)
expr_stmt|;
name|OSSA_READ_LE_32
argument_list|(
name|agRoot
argument_list|,
operator|&
name|sspTag
argument_list|,
name|pIomb
argument_list|,
name|OSSA_OFFSET_OF
argument_list|(
name|agsaSSPCompletionRsp_t
argument_list|,
name|SSPTag
argument_list|)
argument_list|)
expr_stmt|;
comment|/* get SSP_START IOrequest from IOMap */
name|pRequest
operator|=
operator|(
name|agsaIORequestDesc_t
operator|*
operator|)
name|saRoot
operator|->
name|IOMap
index|[
name|tag
index|]
operator|.
name|IORequest
expr_stmt|;
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|)
argument_list|,
literal|"pRequest"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pRequest
operator|==
name|agNULL
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion,AGSA_RC_FAILURE SSP Resp IOMB tag=0x%x, status=0x%x, param=0x%x, SSPTag=0x%x\n"
operator|,
name|tag
operator|,
name|status
operator|,
name|param
operator|,
name|sspTag
operator|)
argument_list|)
expr_stmt|;
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'a'
argument_list|,
literal|"5A"
argument_list|)
expr_stmt|;
return|return
operator|(
name|AGSA_RC_FAILURE
operator|)
return|;
block|}
name|SA_ASSERT
argument_list|(
operator|(
name|pRequest
operator|->
name|valid
operator|)
argument_list|,
literal|"pRequest->valid"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pRequest
operator|->
name|valid
condition|)
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion, SSP Resp IOMB tag=0x%x, status=0x%x, param=0x%x, SSPTag=0x%x Device =0x%x\n"
operator|,
name|tag
operator|,
name|status
operator|,
name|param
operator|,
name|sspTag
operator|,
name|pRequest
operator|->
name|pDevice
condition|?
name|pRequest
operator|->
name|pDevice
operator|->
name|DeviceMapIndex
else|:
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|status
condition|)
block|{
case|case
name|OSSA_IO_SUCCESS
case|:
block|{
if|if
condition|(
operator|!
name|param
condition|)
block|{
comment|/* Completion of SSP without Response Data */
name|siIODone
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_SUCCESS
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Get SSP Response with Response Data */
name|pRespIU
operator|=
operator|(
name|agsaSSPResponseInfoUnit_t
operator|*
operator|)
operator|&
operator|(
name|pIomb
operator|->
name|SSPrsp
operator|)
expr_stmt|;
if|if
condition|(
name|pRespIU
operator|->
name|status
operator|==
literal|0x02
operator|||
name|pRespIU
operator|->
name|status
operator|==
literal|0x18
operator|||
name|pRespIU
operator|->
name|status
operator|==
literal|0x30
operator|||
name|pRespIU
operator|->
name|status
operator|==
literal|0x40
condition|)
block|{
comment|/* SCSI status is CHECK_CONDITION, RESV_CONFLICT, ACA_ACTIVE, TASK_ABORTED */
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_COMPLETED_ERROR_SCSI_STATUS
operator|++
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiSSPCompletion: pRespIU->status 0x%x tag 0x%x\n"
operator|,
name|pRespIU
operator|->
name|status
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
block|}
name|siEventSSPResponseWtDataRcvd
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|pRespIU
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_INVALID_SSP_RSP_FRAME
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_INVALID_SSP_RSP_FRAME tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_INVALID_SSP_RSP_FRAME
operator|++
expr_stmt|;
comment|/* Get SSP Response with Response Data */
name|pRespIU
operator|=
operator|(
name|agsaSSPResponseInfoUnit_t
operator|*
operator|)
operator|&
operator|(
name|pIomb
operator|->
name|SSPrsp
operator|)
expr_stmt|;
if|if
condition|(
name|pRespIU
operator|->
name|status
operator|==
literal|0x02
operator|||
name|pRespIU
operator|->
name|status
operator|==
literal|0x18
operator|||
name|pRespIU
operator|->
name|status
operator|==
literal|0x30
operator|||
name|pRespIU
operator|->
name|status
operator|==
literal|0x40
condition|)
block|{
comment|/* SCSI status is CHECK_CONDITION, RESV_CONFLICT, ACA_ACTIVE, TASK_ABORTED */
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_COMPLETED_ERROR_SCSI_STATUS
operator|++
expr_stmt|;
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiSSPCompletion: pRespIU->status 0x%x tag 0x%x\n"
operator|,
name|pRespIU
operator|->
name|status
operator|,
name|tag
operator|)
argument_list|)
expr_stmt|;
block|}
name|siEventSSPResponseWtDataRcvd
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|pRespIU
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_ABORTED
case|:
block|{
ifdef|#
directive|ifdef
name|SALL_API_TEST
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPAborted
operator|++
expr_stmt|;
name|SA_DBG3
argument_list|(
operator|(
literal|"mpiSSPCompletion, OSSA_IO_ABORTED Response received IOMB=%p %d\n"
operator|,
name|pIomb1
operator|,
name|saRoot
operator|->
name|LLCounters
operator|.
name|IOCounter
operator|.
name|numSSPAborted
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiSSPCompletion, OSSA_IO_ABORTED IOMB tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_ABORTED
operator|++
expr_stmt|;
comment|/* SSP Abort CB */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_UNDERFLOW
case|:
block|{
comment|/* SSP Completion with error */
name|SA_DBG2
argument_list|(
operator|(
literal|"mpiSSPCompletion, OSSA_IO_UNDERFLOW tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
comment|/*saRoot->IoErrorCount.agOSSA_IO_UNDERFLOW++;*/
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_NO_DEVICE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_NO_DEVICE tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_NO_DEVICE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_BREAK
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_BREAK tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_BREAK
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_PHY_NOT_READY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_PHY_NOT_READY tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_PHY_NOT_READY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_PROTOCOL_NOT_SUPPORTED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_PROTOCOL_NOT_SUPPORTED tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_PROTOCOL_NOT_SUPPORTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_ZONE_VIOLATION
case|:
block|{
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_ZONE_VIOLATION
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_ZONE_VIOLATION tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_BREAK
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_BREAK tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_BREAK
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_BAD_DESTINATION
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_BAD_DESTINATION tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_BAD_DESTINATION
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_CONNECTION_RATE_NOT_SUPPORTED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_CONNECTION_RATE_NOT_SUPPORTED tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_CONNECTION_RATE_NOT_SUPPORTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_WRONG_DESTINATION
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_WRONG_DESTINATION tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_WRONG_DESTINATION
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_NAK_RECEIVED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_NAK_RECEIVED tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_NAK_RECEIVED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_ACK_NAK_TIMEOUT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_ACK_NAK_TIMEOUT tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_ACK_NAK_TIMEOUT
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_DMA
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_DMA tag 0x%x ssptag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_DMA
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_OPEN_RETRY_TIMEOUT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_OPEN_RETRY_TIMEOUT tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_OPEN_RETRY_TIMEOUT
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_UNEXPECTED_PHASE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_UNEXPECTED_PHASE tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_UNEXPECTED_PHASE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_OFFSET_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_OFFSET_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_OFFSET_MISMATCH
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_PORT_IN_RESET
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_PORT_IN_RESET tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_PORT_IN_RESET
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_NON_OPERATIONAL
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_DS_NON_OPERATIONAL tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_NON_OPERATIONAL
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_IN_RECOVERY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_DS_IN_RECOVERY tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_IN_RECOVERY
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_TM_TAG_NOT_FOUND
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_TM_TAG_NOT_FOUND tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_TM_TAG_NOT_FOUND
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_PIO_SETUP_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_PIO_SETUP_ERROR tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_PIO_SETUP_ERROR
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_SSP_EXT_IU_ZERO_LEN_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_SSP_IU_ZERO_LEN_ERROR tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_SSP_EXT_IU_ZERO_LEN_ERROR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_IN_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_DS_IN_ERROR tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_IN_ERROR
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_ABORT_IN_PROGRESS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_ABORT_IN_PROGRESS tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_ABORT_IN_PROGRESS
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_ABORT_DELAYED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_ABORT_DELAYED tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_ABORT_DELAYED
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_INVALID_LENGTH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_INVALID_LENGTH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_INVALID_LENGTH
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY_ALT
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY_ALT tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_HW_RESOURCE_BUSY_ALT
operator|++
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_RETRY_BACKOFF_THRESHOLD_REACHED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_RETRY_BACKOFF_THRESHOLD_REACHED HTAG = 0x%x ssptag = 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_RETRY_BACKOFF_THRESHOLD_REACHED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
literal|0
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_TMO
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_TMO tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_TMO
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_NO_DEST
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_NO_DEST tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_NO_DEST
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_COLLIDE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_COLLIDE tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_OPEN_COLLIDE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_PATHWAY_BLOCKED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_PATHWAY_BLOCKED tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_IT_NEXUS_LOSS_PATHWAY_BLOCKED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_DS_INVALID
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_DS_INVALID tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_DS_INVALID
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_MPI_IO_RQE_BUSY_FULL
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_MPI_IO_RQE_BUSY_FULL tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_MPI_IO_RQE_BUSY_FULL
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_MPI_ERR_IO_RESOURCE_UNAVAILABLE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_MPI_ERR_IO_RESOURCE_UNAVAILABLE tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_MPI_ERR_IO_RESOURCE_UNAVAILABLE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_KEY_CACHE_MISS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_KEY_TAG_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DEK_KEY_TAG_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_KEY_TAG_MISMATCH
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_CIPHER_MODE_INVALID
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_CIPHER_MODE_INVALID tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_CIPHER_MODE_INVALID
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_IV_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DEK_IV_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_IV_MISMATCH
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_RAM_INTERFACE_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DEK_RAM_INTERFACE_ERROR tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_RAM_INTERFACE_ERROR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_INTERNAL_RAM
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_INTERNAL_RAM tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_INTERNAL_RAM
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_INDEX_OUT_OF_BOUNDS
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DEK_ILLEGAL_TABLE
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DEK_ILLEGAL_TABLE tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DEK_ILLEGAL_TABLE
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
ifdef|#
directive|ifdef
name|SA_TESTBASE_EXTRA
comment|/* TestBase */
case|case
name|OSSA_IO_HOST_BST_INVALID
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiParseOBIomb, OPC_OUB_SSP_COMP: OSSA_IO_HOST_BST_INVALID 0x%x\n"
operator|,
name|status
operator|)
argument_list|)
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
comment|/*  SA_TESTBASE_EXTRA */
case|case
name|OSSA_IO_XFR_ERROR_DIF_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DIF_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DIF_MISMATCH
operator|++
expr_stmt|;
name|siDifAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|,
name|pIomb1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DIF_APPLICATION_TAG_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DIF_APPLICATION_TAG_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DIF_APPLICATION_TAG_MISMATCH
operator|++
expr_stmt|;
name|siDifAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|,
name|pIomb1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DIF_REFERENCE_TAG_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DIF_REFERENCE_TAG_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DIF_REFERENCE_TAG_MISMATCH
operator|++
expr_stmt|;
name|siDifAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|,
name|pIomb1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFR_ERROR_DIF_CRC_MISMATCH
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFR_ERROR_DIF_CRC_MISMATCH tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFR_ERROR_DIF_CRC_MISMATCH
operator|++
expr_stmt|;
name|siDifAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|,
name|pIomb1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERROR_DIF_INTERNAL_ERROR
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERROR_DIF_INTERNAL_ERROR tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERROR_DIF_INTERNAL_ERROR
operator|++
expr_stmt|;
name|siDifAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|,
name|pIomb1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_XFER_ERR_EOB_DATA_OVERRUN
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_XFER_ERR_EOB_DATA_OVERRUN tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_XFER_ERR_EOB_DATA_OVERRUN
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|OSSA_IO_OPEN_CNX_ERROR_OPEN_PREEMPTED
case|:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: OSSA_IO_OPEN_CNX_ERROR_OPEN_PREEMPTED tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_OPEN_CNX_ERROR_OPEN_PREEMPTED
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|status
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{
name|SA_DBG1
argument_list|(
operator|(
literal|"mpiSSPCompletion: Unknown tag 0x%x sspTag 0x%x status 0x%x param 0x%x\n"
operator|,
name|tag
operator|,
name|sspTag
operator|,
name|status
operator|,
name|param
operator|)
argument_list|)
expr_stmt|;
comment|/* not allowed case. Therefore, return failed status */
name|saRoot
operator|->
name|IoErrorCount
operator|.
name|agOSSA_IO_UNKNOWN_ERROR
operator|++
expr_stmt|;
name|siAbnormal
argument_list|(
name|agRoot
argument_list|,
name|pRequest
argument_list|,
name|OSSA_IO_FAILED
argument_list|,
name|param
argument_list|,
name|sspTag
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|smTraceFuncExit
argument_list|(
name|hpDBG_VERY_LOUD
argument_list|,
literal|'b'
argument_list|,
literal|"5A"
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

end_unit

