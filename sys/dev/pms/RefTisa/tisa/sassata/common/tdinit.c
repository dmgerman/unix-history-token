begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************* *Copyright (c) 2014 PMC-Sierra, Inc.  All rights reserved.  * *Redistribution and use in source and binary forms, with or without modification, are permitted provided  *that the following conditions are met:  *1. Redistributions of source code must retain the above copyright notice, this list of conditions and the *following disclaimer.  *2. Redistributions in binary form must reproduce the above copyright notice,  *this list of conditions and the following disclaimer in the documentation and/or other materials provided *with the distribution.  * *THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED  *WARRANTIES,INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS *FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE *FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  *NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR  *BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  *LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  *SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE   ********************************************************************************/
end_comment

begin_comment
comment|/*******************************************************************************/
end_comment

begin_comment
comment|/** \file  *  * This file contains the SAS/SATA TD layer initialization functions  *  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/pms/config.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/freebsd/driver/common/osenv.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/freebsd/driver/common/ostypes.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/freebsd/driver/common/osdebug.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sallsdk/api/sa.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sallsdk/api/saapi.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sallsdk/api/saosapi.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/api/titypes.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/api/ostiapi.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/api/tiapi.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/api/tiglobal.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|FDS_SM
end_ifdef

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sat/api/sm.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sat/api/smapi.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/sat/api/tdsmapi.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|FDS_DM
end_ifdef

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/discovery/api/dm.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/discovery/api/dmapi.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/discovery/api/tddmapi.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/common/tdtypes.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/freebsd/driver/common/osstring.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/common/tdutil.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
end_ifdef

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/ini/itdtypes.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/ini/itddefs.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/ini/itdglobl.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|TARGET_DRIVER
end_ifdef

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/tgt/ttdglobl.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/tgt/ttdxchg.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/sas/tgt/ttdtypes.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/common/tdsatypes.h>
end_include

begin_include
include|#
directive|include
file|<dev/pms/RefTisa/tisa/sassata/common/tdproto.h>
end_include

begin_function_decl
name|LOCAL
name|bit32
name|tdsaGetCardID
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|bit32
name|tdCardIDList
index|[
name|TD_MAX_CARD_NUM
index|]
init|=
block|{
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|,
name|TD_CARD_ID_FREE
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/***************************************************************************** * * tdsaGetCardID * *  Purpose:   * *  Parameters: * *    tiRoot:        Pointer to driver/port instance. * *  Return:  *   tiSuccess : CardIDString was successfully read *   tiError   : CardIDString reading failed * *****************************************************************************/
end_comment

begin_function
name|bit32
name|tdsaGetCardID
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|bit32
name|i
decl_stmt|;
name|bit32
name|RetVal
init|=
literal|0xFFFFFFFF
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TD_MAX_CARD_NUM
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|tdCardIDList
index|[
name|i
index|]
operator|==
name|TD_CARD_ID_FREE
condition|)
block|{
name|tdCardIDList
index|[
name|i
index|]
operator|=
name|TD_CARD_ID_ALLOC
expr_stmt|;
name|RetVal
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
return|return
name|RetVal
return|;
block|}
end_function

begin_comment
comment|/* tdsaGetCardID() */
end_comment

begin_comment
comment|/***************************************************************************** * * tdsaFreeCardID * *  Purpose:   * *  Parameters: * *    tiRoot:        Pointer to driver/port instance. * *  Return:  *   tiSuccess : CardIDString was successfully read *   tiError   : CardIDString reading failed * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaFreeCardID
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|bit32
name|CardID
parameter_list|)
block|{
name|OS_ASSERT
argument_list|(
name|CardID
operator|<
name|TD_MAX_CARD_NUM
argument_list|,
literal|"Invalid CardID\n"
argument_list|)
expr_stmt|;
name|tdCardIDList
index|[
name|CardID
index|]
operator|=
name|TD_CARD_ID_FREE
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tdFreeCardID() */
end_comment

begin_comment
comment|/***************************************************************************** * * tdsaGetCardIDString * *  Purpose:   * *  Parameters: * *    tiRoot:        Pointer to driver/port instance. * *  Return:  *   tiSuccess : CardIDString was successfully read *   tiError   : CardIDString reading failed * *****************************************************************************/
end_comment

begin_function
name|bit32
name|tdsaGetCardIDString
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
operator|(
name|tdsaRoot
operator|->
name|tdsaAllShared
operator|)
decl_stmt|;
name|bit32
name|ret
init|=
name|tiError
decl_stmt|;
name|bit32
name|thisCardID
init|=
name|tdsaGetCardID
argument_list|(
name|tiRoot
argument_list|)
decl_stmt|;
name|char
name|CardNum
index|[
literal|10
index|]
decl_stmt|;
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaGetCardIDString: start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaGetCardIDString: thisCardID 0x%x\n"
operator|,
name|thisCardID
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|thisCardID
operator|==
literal|0xFFFFFFFF
condition|)
block|{
name|TI_DBG1
argument_list|(
operator|(
literal|"tdGetCardIDString: No more CardIDs available\n"
operator|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|tiError
expr_stmt|;
block|}
else|else
block|{
name|tdsaAllShared
operator|->
name|CardID
operator|=
name|thisCardID
expr_stmt|;
name|osti_sprintf
argument_list|(
name|CardNum
argument_list|,
literal|"CardNum%d"
argument_list|,
name|thisCardID
argument_list|)
expr_stmt|;
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaGetCardIDString: CardNum is %s\n"
operator|,
name|CardNum
operator|)
argument_list|)
expr_stmt|;
name|osti_strcpy
argument_list|(
name|tdsaAllShared
operator|->
name|CardIDString
argument_list|,
name|CardNum
argument_list|)
expr_stmt|;
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaGetCardIDString: tdsaAllShared->CardIDString is %s\n"
operator|,
name|tdsaAllShared
operator|->
name|CardIDString
operator|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|tiSuccess
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tiCOMGetResource * *  Purpose:  This function is called to determine the Transport *            Dependent Layer internal resource requirement. *            This function will internally call the initiator specific, *            target specific and shared TD resource requirement calls. * * \param   tiRoot:             Pointer to driver/port instance. * \param   loResource:         Pointer to low level TSDK resource requirement. * \param   initiatorResource:  Pointer to initiator functionality memory and *                              option requirement. * \param  targetResource:      Pointer to target functionality memory and *                              option requirement. * \param  tdSharedMem:         Pointer to cached memory required by the *                              target/initiator shared functionality. * *  \return None * *  \note - This function only return the memory requirement in the tiMem_t *          structure in loResource, initiatorResource, targetResource *          and tdSharedMem. It does not allocate memory, so the address *          fields in tiMem_t are not used. * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tiCOMGetResource
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|tiLoLevelResource_t
modifier|*
name|loResource
parameter_list|,
name|tiInitiatorResource_t
modifier|*
name|initiatorResource
parameter_list|,
name|tiTargetResource_t
modifier|*
name|targetResource
parameter_list|,
name|tiTdSharedMem_t
modifier|*
name|tdSharedMem
parameter_list|)
block|{
name|TI_DBG6
argument_list|(
operator|(
literal|"tiCOMGetResource start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tiCOMGetResource: loResource %p\n"
operator|,
name|loResource
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|loResource
operator|!=
name|agNULL
condition|)
block|{
name|tdsaLoLevelGetResource
argument_list|(
name|tiRoot
argument_list|,
name|loResource
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tdSharedMem
operator|!=
name|agNULL
condition|)
block|{
name|tdsaSharedMemCalculate
argument_list|(
name|tiRoot
argument_list|,
name|loResource
argument_list|,
name|tdSharedMem
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
comment|/* initiator */
if|if
condition|(
name|initiatorResource
operator|!=
name|agNULL
condition|)
block|{
name|itdssGetResource
argument_list|(
name|tiRoot
argument_list|,
name|initiatorResource
argument_list|)
expr_stmt|;
comment|/*       * for the time being set the initiator usecsPerTick      * same as lolevel usecsPerTick      */
if|if
condition|(
name|loResource
operator|==
name|agNULL
condition|)
block|{
name|TI_DBG1
argument_list|(
operator|(
literal|"tiCOMGetResource: loResource is NULL, wrong\n"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TARGET_DRIVER
comment|/* target */
if|if
condition|(
name|targetResource
operator|!=
name|agNULL
condition|)
block|{
name|ttdssGetResource
argument_list|(
name|tiRoot
argument_list|,
name|targetResource
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tiCOMInit * *  Purpose:  This function is called to initialize Transport Dependent Layer. *            This function will internally call the initiator specific, *            target specific and shared TD initialization calls. * *  \param  tiRoot:             Pointer to target driver/port instance. *  \param  loResource:         Pointer to low level TSDK resource requirement. *  \param  initiatorResource:  Pointer to initiator functionality memory and *                              option requirement. *  \param  targetResource:     Pointer to target functionality memory and *                              option requirement. *  \param  tdSharedMem:        Pointer to cached memory required by the *                              target/initiator shared functionality. * *  \return: tiSuccess  - if successful *           tiError    - if failed * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|bit32
name|tiCOMInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|tiLoLevelResource_t
modifier|*
name|loResource
parameter_list|,
name|tiInitiatorResource_t
modifier|*
name|initiatorResource
parameter_list|,
name|tiTargetResource_t
modifier|*
name|targetResource
parameter_list|,
name|tiTdSharedMem_t
modifier|*
name|tdSharedMem
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
decl_stmt|;
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
decl_stmt|;
name|tdsaDeviceData_t
modifier|*
name|tdsaDeviceData
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_INT_COALESCE
name|tdsaIntCoalesceContext_t
modifier|*
name|tdsaIntCoalCxt
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TD_DISCOVER
name|tdsaExpander_t
modifier|*
name|tdsaExpander
decl_stmt|;
endif|#
directive|endif
name|bit32
name|status
init|=
name|tiSuccess
decl_stmt|;
name|void
modifier|*
name|IniAddr
init|=
name|agNULL
decl_stmt|;
name|void
modifier|*
name|TgtAddr
init|=
name|agNULL
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|TD_INT_COALESCE
argument_list|)
operator|||
name|defined
argument_list|(
name|TD_DISCOVER
argument_list|)
operator|||
name|defined
argument_list|(
name|TD_INTERNAL_DEBUG
argument_list|)
name|bit32
name|MaxTargets
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TD_INTERNAL_DEBUG
comment|/* for debugging only */
name|tdsaEsglAllInfo_t
modifier|*
name|pEsglAllInfo
decl_stmt|;
name|tdList_t
modifier|*
name|tdlist_to_fill
decl_stmt|;
name|tdsaEsglPageInfo_t
modifier|*
name|page_to_fill
decl_stmt|;
endif|#
directive|endif
name|bit32
name|i
decl_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|dmSwConfig_t
name|dmSwConfig
decl_stmt|;
specifier|static
name|dmMemoryRequirement_t
name|dmMemRequirement
decl_stmt|;
name|bit32
name|dmUsecsPerTick
init|=
literal|0
decl_stmt|;
name|bit32
name|dmMaxNumLocks
init|=
literal|0
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
name|smSwConfig_t
name|smSwConfig
decl_stmt|;
specifier|static
name|smMemoryRequirement_t
name|smMemRequirement
decl_stmt|;
name|bit32
name|smUsecsPerTick
init|=
literal|0
decl_stmt|;
name|bit32
name|smMaxNumLocks
init|=
literal|0
decl_stmt|;
endif|#
directive|endif
comment|/* for memory analysis */
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdsaroot\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdsaRoot_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdsaRoot_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdsaEsglAllInfo_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdsaEsglAllInfo_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: portcontext\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdsaPortContext_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: device data\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdsaDeviceData_t  %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: agsaSASDeviceInfo_t  %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|agsaSASDeviceInfo_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: satDeviceData_t  %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|satDeviceData_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: agsaSATAIdentifyData_t  %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|agsaSATAIdentifyData_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: IO request body\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdIORequestBody_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdIORequestBody_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tdssIOCompleted_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdssIOCompleted_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: agsaIORequest_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|agsaIORequest_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: FOR SAS\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: agsaSASRequestBody_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|agsaSASRequestBody_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: FOR SATA\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: agsaSATAInitiatorRequest_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|agsaSATAInitiatorRequest_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: scsiRspSense_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|scsiRspSense_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: tiSenseData_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tiSenseData_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: satIOContext_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|satIOContext_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: satInternalIo_t %d\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|satInternalIo_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|/*************************************************************************   * TD SHARED AREA   *************************************************************************/
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: start\n"
operator|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|TD_INT_COALESCE
argument_list|)
operator|&&
name|defined
argument_list|(
name|TD_DISCOVER
argument_list|)
comment|/* Let's start from the tdsaRoot */
name|tdsaRoot
operator|=
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
expr_stmt|;
name|tdsaPortContext
operator|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
operator|+
sizeof|sizeof
argument_list|(
name|tdsaRoot_t
argument_list|)
operator|)
expr_stmt|;
name|tdsaDeviceData
operator|=
operator|(
name|tdsaDeviceData_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaPortContext
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|*
name|TD_MAX_PORT_CONTEXT
operator|)
operator|)
expr_stmt|;
comment|/* the following fn fills in MaxTargets */
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tiCOMInit: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
name|tdsaIntCoalCxt
operator|=
operator|(
name|tdsaIntCoalesceContext_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaDeviceData
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|*
name|MaxTargets
operator|)
operator|)
expr_stmt|;
name|tdsaExpander
operator|=
operator|(
name|tdsaExpander_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaIntCoalCxt
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaIntCoalesceContext_t
argument_list|)
operator|*
name|TD_MAX_INT_COALESCE
operator|)
operator|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|TD_INT_COALESCE
argument_list|)
comment|/* Let's start from the tdsaRoot */
name|tdsaRoot
operator|=
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
expr_stmt|;
name|tdsaPortContext
operator|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
operator|+
sizeof|sizeof
argument_list|(
name|tdsaRoot_t
argument_list|)
operator|)
expr_stmt|;
name|tdsaDeviceData
operator|=
operator|(
name|tdsaDeviceData_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaPortContext
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|*
name|TD_MAX_PORT_CONTEXT
operator|)
operator|)
expr_stmt|;
comment|/* the following fn fills in MaxTargets */
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tiCOMInit: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
name|tdsaIntCoalCxt
operator|=
operator|(
name|tdsaIntCoalesceContext_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaDeviceData
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|*
name|MaxTargets
operator|)
operator|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|TD_DISCOVER
argument_list|)
comment|/* Let's start from the tdsaRoot */
name|tdsaRoot
operator|=
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
expr_stmt|;
name|tdsaPortContext
operator|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
operator|+
sizeof|sizeof
argument_list|(
name|tdsaRoot_t
argument_list|)
operator|)
expr_stmt|;
name|tdsaDeviceData
operator|=
operator|(
name|tdsaDeviceData_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaPortContext
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|*
name|TD_MAX_PORT_CONTEXT
operator|)
operator|)
expr_stmt|;
comment|/* the following fn fills in MaxTargets */
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tiCOMInit: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
name|tdsaExpander
operator|=
operator|(
name|tdsaExpander_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaDeviceData
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|*
name|MaxTargets
operator|)
operator|)
expr_stmt|;
else|#
directive|else
comment|/* Let's start from the tdsaRoot */
name|tdsaRoot
operator|=
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
expr_stmt|;
name|tdsaPortContext
operator|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
operator|+
sizeof|sizeof
argument_list|(
name|tdsaRoot_t
argument_list|)
operator|)
expr_stmt|;
name|tdsaDeviceData
operator|=
operator|(
name|tdsaDeviceData_t
operator|*
operator|)
operator|(
operator|(
name|bitptr
operator|)
name|tdsaPortContext
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|*
name|TD_MAX_PORT_CONTEXT
operator|)
operator|)
expr_stmt|;
endif|#
directive|endif
name|TI_DBG6
argument_list|(
operator|(
literal|"tiCOMInit: ******* tdsaRoot %p tdsaPortContext %p tdsaDeviceData %p\n"
operator|,
name|tdsaRoot
operator|,
name|tdsaPortContext
operator|,
name|tdsaDeviceData
operator|)
argument_list|)
expr_stmt|;
name|tiRoot
operator|->
name|tdData
operator|=
name|tdsaRoot
expr_stmt|;
name|tdsaAllShared
operator|=
operator|&
operator|(
name|tdsaRoot
operator|->
name|tdsaAllShared
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
comment|/**< Initialize initiator; itdssIni_t itself */
if|if
condition|(
name|initiatorResource
condition|)
block|{
name|IniAddr
operator|=
name|initiatorResource
operator|->
name|initiatorMem
operator|.
name|tdCachedMem
index|[
literal|0
index|]
operator|.
name|virtPtr
expr_stmt|;
name|tdsaRoot
operator|->
name|itdsaIni
operator|=
name|IniAddr
expr_stmt|;
name|tdsaRoot
operator|->
name|itdsaIni
operator|->
name|tdsaAllShared
operator|=
name|tdsaAllShared
expr_stmt|;
name|tdsaAllShared
operator|->
name|itdsaIni
operator|=
name|tdsaRoot
operator|->
name|itdsaIni
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TARGET_DRIVER
comment|/**< Initialize target; ttdssTgt_t itself */
if|if
condition|(
name|targetResource
condition|)
block|{
name|TgtAddr
operator|=
name|targetResource
operator|->
name|targetMem
operator|.
name|tdMem
index|[
literal|0
index|]
operator|.
name|virtPtr
expr_stmt|;
name|tdsaRoot
operator|->
name|ttdsaTgt
operator|=
name|TgtAddr
expr_stmt|;
name|tdsaRoot
operator|->
name|ttdsaTgt
operator|->
name|tdsaAllShared
operator|=
name|tdsaAllShared
expr_stmt|;
name|tdsaAllShared
operator|->
name|ttdsaTgt
operator|=
name|tdsaRoot
operator|->
name|ttdsaTgt
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* target driver */
name|TI_DBG5
argument_list|(
operator|(
literal|"tiCOMInit: IniAddr %p TgtAddr %p\n"
operator|,
name|IniAddr
operator|,
name|TgtAddr
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG3
argument_list|(
operator|(
literal|"tiCOMInit: tdsaRoot %p tdsaAllShared %p \n"
operator|,
name|tdsaRoot
operator|,
name|tdsaAllShared
operator|)
argument_list|)
expr_stmt|;
comment|/**<  Initialize the OS data part of the interrupt context agRoot */
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|tiRoot
operator|=
name|tiRoot
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|tdsaAllShared
operator|=
operator|(
name|void
operator|*
operator|)
name|tdsaAllShared
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|itdsaIni
operator|=
operator|(
name|void
operator|*
operator|)
name|IniAddr
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|ttdsaTgt
operator|=
operator|(
name|void
operator|*
operator|)
name|TgtAddr
expr_stmt|;
comment|/* for sata */
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|tdstHost
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|tdstDevice
operator|=
name|agNULL
expr_stmt|;
comment|/* tiInterruptContext is an enum value */
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|.
name|IntContext
operator|=
name|tiInterruptContext
expr_stmt|;
comment|/* queueId or lockid in TD layer; LL maxlock + 1 since TD uses only one lock */
comment|/* agsaRoot_t */
name|tdsaAllShared
operator|->
name|agRootInt
operator|.
name|osData
operator|=
operator|(
name|void
operator|*
operator|)
operator|&
operator|(
name|tdsaAllShared
operator|->
name|agRootOsDataForInt
operator|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootInt
operator|.
name|sdkData
operator|=
name|agNULL
expr_stmt|;
comment|/**< Initialize the OS data part of the non-interrupt context agRoot */
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|tiRoot
operator|=
name|tiRoot
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|tdsaAllShared
operator|=
operator|(
name|void
operator|*
operator|)
name|tdsaAllShared
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|itdsaIni
operator|=
operator|(
name|void
operator|*
operator|)
name|IniAddr
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|ttdsaTgt
operator|=
operator|(
name|void
operator|*
operator|)
name|TgtAddr
expr_stmt|;
comment|/* for sata */
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|tdstHost
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|tdstDevice
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|.
name|IntContext
operator|=
name|tiNonInterruptContext
expr_stmt|;
comment|/* queueId or lockid in TD layer; LL maxlock + 1 since TD uses only one lock */
comment|/* agsaRoot_t */
name|tdsaAllShared
operator|->
name|agRootNonInt
operator|.
name|osData
operator|=
operator|(
name|void
operator|*
operator|)
operator|&
operator|(
name|tdsaAllShared
operator|->
name|agRootOsDataForNonInt
operator|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|agRootNonInt
operator|.
name|sdkData
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|loResource
operator|=
operator|*
name|loResource
expr_stmt|;
name|tdsaAllShared
operator|->
name|PortContextMem
operator|=
name|tdsaPortContext
expr_stmt|;
name|tdsaAllShared
operator|->
name|DeviceMem
operator|=
name|tdsaDeviceData
expr_stmt|;
name|tdsaAllShared
operator|->
name|IBQnumber
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|OBQnumber
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|TD_INT_COALESCE
name|tdsaAllShared
operator|->
name|IntCoalesce
operator|=
name|tdsaIntCoalCxt
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TD_DISCOVER
name|tdsaAllShared
operator|->
name|ExpanderHead
operator|=
name|tdsaExpander
expr_stmt|;
endif|#
directive|endif
name|tdsaAllShared
operator|->
name|MaxNumLocks
operator|=
name|loResource
operator|->
name|loLevelOption
operator|.
name|numOfQueuesPerPort
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumOSLocks
operator|=
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxNumOSLocks
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|FDS_DM
argument_list|)
operator|&&
name|defined
argument_list|(
name|FDS_SM
argument_list|)
name|dmGetRequirements
argument_list|(
name|agNULL
argument_list|,
operator|&
name|dmSwConfig
argument_list|,
operator|&
name|dmMemRequirement
argument_list|,
operator|&
name|dmUsecsPerTick
argument_list|,
operator|&
name|dmMaxNumLocks
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumDMLocks
operator|=
name|dmMaxNumLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: DM MaxNumDMLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumDMLocks
operator|)
argument_list|)
expr_stmt|;
name|smGetRequirements
argument_list|(
name|agNULL
argument_list|,
operator|&
name|smSwConfig
argument_list|,
operator|&
name|smMemRequirement
argument_list|,
operator|&
name|smUsecsPerTick
argument_list|,
operator|&
name|smMaxNumLocks
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumSMLocks
operator|=
name|smMaxNumLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: SM MaxNumSMLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumSMLocks
operator|)
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|=
name|tdsaAllShared
operator|->
name|MaxNumLocks
operator|-
name|TD_MAX_LOCKS
operator|-
name|tdsaAllShared
operator|->
name|MaxNumDMLocks
operator|-
name|tdsaAllShared
operator|->
name|MaxNumSMLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: LL MaxNumLLLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|)
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|FDS_DM
argument_list|)
name|dmGetRequirements
argument_list|(
name|agNULL
argument_list|,
operator|&
name|dmSwConfig
argument_list|,
operator|&
name|dmMemRequirement
argument_list|,
operator|&
name|dmUsecsPerTick
argument_list|,
operator|&
name|dmMaxNumLocks
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumDMLocks
operator|=
name|dmMaxNumLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: DM MaxNumDMLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumDMLocks
operator|)
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|=
name|tdsaAllShared
operator|->
name|MaxNumLocks
operator|-
name|TD_MAX_LOCKS
operator|-
name|tdsaAllShared
operator|->
name|MaxNumDMLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: LL MaxNumLLLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|)
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|FDS_SM
argument_list|)
name|smGetRequirements
argument_list|(
name|agNULL
argument_list|,
operator|&
name|smSwConfig
argument_list|,
operator|&
name|smMemRequirement
argument_list|,
operator|&
name|smUsecsPerTick
argument_list|,
operator|&
name|smMaxNumLocks
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumSMLocks
operator|=
name|smMaxNumLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: SM MaxNumSMLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumSMLocks
operator|)
argument_list|)
expr_stmt|;
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|=
name|tdsaAllShared
operator|->
name|MaxNumLocks
operator|-
name|TD_MAX_LOCKS
operator|-
name|tdsaAllShared
operator|->
name|MaxNumSMLocks
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: LL MaxNumLLLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|=
name|tdsaAllShared
operator|->
name|MaxNumLocks
operator|-
name|TD_MAX_LOCKS
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tiCOMInit: LL MaxNumLLLocks 0x%x\n"
operator|,
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TBD
name|tdsaAllShared
operator|->
name|MaxNumLLLocks
operator|=
name|loResource
operator|->
name|loLevelOption
operator|.
name|numOfQueuesPerPort
operator|-
name|TD_MAX_LOCKS
expr_stmt|;
endif|#
directive|endif
name|tdsaAllShared
operator|->
name|resetCount
operator|=
literal|0
expr_stmt|;
comment|/* used for saHwEventAck() and ossaDeregisterDeviceHandleCB() */
comment|//  tdsaAllShared->EventValid = agFALSE;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TD_MAX_NUM_PHYS
condition|;
name|i
operator|++
control|)
block|{
name|tdsaAllShared
operator|->
name|eventSource
index|[
name|i
index|]
operator|.
name|EventValid
operator|=
name|agFALSE
expr_stmt|;
name|tdsaAllShared
operator|->
name|eventSource
index|[
name|i
index|]
operator|.
name|Source
operator|.
name|agPortContext
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|eventSource
index|[
name|i
index|]
operator|.
name|Source
operator|.
name|event
operator|=
literal|0
expr_stmt|;
comment|/* phy ID */
name|tdsaAllShared
operator|->
name|eventSource
index|[
name|i
index|]
operator|.
name|Source
operator|.
name|param
operator|=
literal|0xFF
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TD_INTERNAL_DEBUG
comment|/* for debugging only */
name|pEsglAllInfo
operator|=
operator|(
name|tdsaEsglAllInfo_t
operator|*
operator|)
operator|&
operator|(
name|tdsaAllShared
operator|->
name|EsglAllInfo
operator|)
expr_stmt|;
endif|#
directive|endif
comment|/* initialize CardIDString */
name|osti_strcpy
argument_list|(
name|tdsaAllShared
operator|->
name|CardIDString
argument_list|,
literal|""
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|tdsaAllShared
operator|->
name|dmRoot
operator|.
name|tdData
operator|=
name|tdsaRoot
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
name|tdsaAllShared
operator|->
name|smRoot
operator|.
name|tdData
operator|=
name|tdsaRoot
expr_stmt|;
endif|#
directive|endif
comment|/* get card ID */
if|if
condition|(
name|tdsaGetCardIDString
argument_list|(
name|tiRoot
argument_list|)
operator|==
name|tiError
condition|)
block|{
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaGetCardIDString() failed\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|tiError
return|;
block|}
comment|/**< initializes jumptable */
name|tdsaJumpTableInit
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
comment|/**< initializes tdsaPortStartInfo_s including flags */
name|tdssInitSASPortStartInfo
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
comment|/* resets all the relevant flags */
name|tdsaResetComMemFlags
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
comment|/**< initializes timers */
name|tdsaInitTimers
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: ******* before tdsaRoot %p tdsaPortContext %p tdsaDeviceData %p\n"
operator|,
name|tdsaRoot
operator|,
name|tdsaPortContext
operator|,
name|tdsaDeviceData
operator|)
argument_list|)
expr_stmt|;
comment|/**< initializes tdsaPortContext_t */
name|tdsaPortContextInit
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
comment|/**< initializes devicelist in tdsaPortContext_t */
name|tdsaDeviceDataInit
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TD_INT_COALESCE
name|tdsaIntCoalCxtInit
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TD_DISCOVER
name|tdsaExpanderInit
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|tdsaQueueConfigInit
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TD_INTERNAL_DEBUG
comment|/* for debugging only */
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: temp 1\n"
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_DEQUEUE_FROM_HEAD
argument_list|(
operator|&
name|tdlist_to_fill
argument_list|,
operator|&
name|pEsglAllInfo
operator|->
name|freelist
argument_list|)
expr_stmt|;
comment|/* get the pointer to the page from list pointer */
name|page_to_fill
operator|=
name|TDLIST_OBJECT_BASE
argument_list|(
name|tdsaEsglPageInfo_t
argument_list|,
name|tdlist
argument_list|,
name|tdlist_to_fill
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: pageinfo ID %d\n"
operator|,
name|page_to_fill
operator|->
name|id
operator|)
argument_list|)
expr_stmt|;
comment|/* this does not work */
name|TDLIST_ENQUEUE_AT_HEAD
argument_list|(
name|tdlist_to_fill
argument_list|,
operator|&
name|pEsglAllInfo
operator|->
name|freelist
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"ticominit: devide\n"
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_DEQUEUE_FROM_HEAD
argument_list|(
operator|&
name|tdlist_to_fill
argument_list|,
operator|&
name|pEsglAllInfo
operator|->
name|freelist
argument_list|)
expr_stmt|;
comment|/* get the pointer to the page from list pointer */
name|page_to_fill
operator|=
name|TDLIST_OBJECT_BASE
argument_list|(
name|tdsaEsglPageInfo_t
argument_list|,
name|tdlist
argument_list|,
name|tdlist_to_fill
argument_list|)
expr_stmt|;
name|TDINIT_PRINT
argument_list|(
literal|"ticominit: second pageinfo ID %d\n"
argument_list|,
name|page_to_fill
operator|->
name|id
argument_list|)
expr_stmt|;
name|TDLIST_ENQUEUE_AT_HEAD
argument_list|(
name|tdlist_to_fill
argument_list|,
operator|&
name|pEsglAllInfo
operator|->
name|freelist
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
if|if
condition|(
name|initiatorResource
operator|!=
name|agNULL
condition|)
block|{
name|tdsaAllShared
operator|->
name|currentOperation
operator||=
name|TD_OPERATION_INITIATOR
expr_stmt|;
name|TI_DBG5
argument_list|(
operator|(
literal|"tiCOMInit: calling itdssInit\n"
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|itdssInit
argument_list|(
name|tiRoot
argument_list|,
name|initiatorResource
argument_list|,
name|tdSharedMem
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|tiSuccess
condition|)
block|{
name|TI_DBG1
argument_list|(
operator|(
literal|"tiCOMInit: itdInit FAILED\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TARGET_DRIVER
if|if
condition|(
name|targetResource
operator|!=
name|agNULL
condition|)
block|{
name|tdsaAllShared
operator|->
name|currentOperation
operator||=
name|TD_OPERATION_TARGET
expr_stmt|;
name|TI_DBG5
argument_list|(
operator|(
literal|"tiCOMInit: calling ttdssInit\n"
operator|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|ttdssInit
argument_list|(
name|tiRoot
argument_list|,
name|targetResource
argument_list|,
name|tdSharedMem
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|tiSuccess
condition|)
block|{
name|TI_DBG1
argument_list|(
operator|(
literal|"tiCOMInit: ttdInit FAILED\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
block|}
endif|#
directive|endif
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaLoLevelGetResource * *  Purpose:  This function is called to determine the Transport  *            Dependent Layer internal resource requirement used by the  *            lower layer TSDK. * *  \param  tiRoot:             Pointer to driver/port instance. *  \param  loResource:         Pointer to low level TSDK resource requirement. * *  \return: None * *  \note -  currenlty mem[0] - mem[18] are being used * *****************************************************************************/
end_comment

begin_comment
comment|/*   this calls ostiGetTransportParam which parses the configuration file to get   parameters. */
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaLoLevelGetResource
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|tiLoLevelResource_t
modifier|*
name|loResource
parameter_list|)
block|{
name|agsaRoot_t
name|agRoot
decl_stmt|;
name|bit32
name|usecsPerTick
init|=
literal|0
decl_stmt|;
name|agsaSwConfig_t
name|SwConfig
decl_stmt|;
specifier|static
name|agsaQueueConfig_t
name|QueueConfig
decl_stmt|;
specifier|static
name|agsaMemoryRequirement_t
name|memRequirement
decl_stmt|;
name|bit32
name|maxQueueSets
init|=
literal|0
decl_stmt|;
name|bit32
name|maxNumOSLocks
init|=
literal|0
decl_stmt|;
name|bit32
name|i
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|bit32
name|buffLen
decl_stmt|;
name|bit32
name|lenRecv
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|pLastUsedChar
init|=
name|agNULL
decl_stmt|;
name|char
name|globalStr
index|[]
init|=
literal|"Global"
decl_stmt|;
name|char
name|iniParmsStr
index|[]
init|=
literal|"InitiatorParms"
decl_stmt|;
name|char
name|SwParmsStr
index|[]
init|=
literal|"SWParms"
decl_stmt|;
name|char
name|OBQueueProps
index|[]
init|=
literal|"OBQueueProps"
decl_stmt|;
name|char
name|IBQueueProps
index|[]
init|=
literal|"IBQueueProps"
decl_stmt|;
specifier|static
name|char
name|IBQueueSize
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|OBQueueSize
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|IBQueueEleSize
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|OBQueueEleSize
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|OBQueueInterruptCount
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|OBQueueInterruptDelay
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|OBQueueInterruptEnable
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|IBQueuePriority
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|tmpBuffer
index|[
name|DEFAULT_KEY_BUFFER_SIZE
index|]
decl_stmt|;
specifier|static
name|bit32
name|InboundQueueSize
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|OutboundQueueSize
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|InboundQueueEleSize
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|OutboundQueueEleSize
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|InboundQueuePriority
index|[
name|AGSA_MAX_INBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|OutboundQueueInterruptDelay
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|OutboundQueueInterruptCount
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|OutboundQueueInterruptEnable
index|[
name|AGSA_MAX_OUTBOUND_Q
index|]
decl_stmt|;
specifier|static
name|bit32
name|cardID
init|=
literal|0
decl_stmt|;
name|char
name|CardNum
index|[
literal|10
index|]
decl_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|dmRoot_t
name|dmRoot
decl_stmt|;
name|dmSwConfig_t
name|dmSwConfig
decl_stmt|;
specifier|static
name|dmMemoryRequirement_t
name|dmMemRequirement
decl_stmt|;
name|bit32
name|dmUsecsPerTick
init|=
literal|0
decl_stmt|;
name|bit32
name|dmMaxNumLocks
init|=
literal|0
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
name|smRoot_t
name|smRoot
decl_stmt|;
name|smSwConfig_t
name|smSwConfig
decl_stmt|;
specifier|static
name|smMemoryRequirement_t
name|smMemRequirement
decl_stmt|;
name|bit32
name|smUsecsPerTick
init|=
literal|0
decl_stmt|;
name|bit32
name|smMaxNumLocks
init|=
literal|0
decl_stmt|;
endif|#
directive|endif
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: start \n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: loResource %p\n"
operator|,
name|loResource
operator|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
name|agRoot
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|agsaRoot_t
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
name|QueueConfig
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|QueueConfig
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
name|memRequirement
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|memRequirement
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
name|InboundQueueSize
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|InboundQueueSize
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
name|OutboundQueueSize
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|OutboundQueueSize
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
name|InboundQueueEleSize
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|InboundQueueEleSize
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
name|OutboundQueueEleSize
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|OutboundQueueEleSize
argument_list|)
argument_list|)
expr_stmt|;
name|memRequirement
operator|.
name|count
operator|=
literal|0
expr_stmt|;
comment|/* default values which are overwritten later */
comment|/* The followings are default values */
name|SwConfig
operator|.
name|maxActiveIOs
operator|=
name|DEFAULT_MAX_ACTIVE_IOS
expr_stmt|;
name|SwConfig
operator|.
name|numDevHandles
operator|=
name|DEFAULT_MAX_DEV
expr_stmt|;
name|SwConfig
operator|.
name|smpReqTimeout
operator|=
name|DEFAULT_SMP_TIMEOUT
expr_stmt|;
comment|/* DEFAULT_VALUE; */
name|SwConfig
operator|.
name|numberOfEventRegClients
operator|=
name|DEFAULT_NUM_REG_CLIENTS
expr_stmt|;
name|SwConfig
operator|.
name|sizefEventLog1
operator|=
name|HOST_EVENT_LOG_SIZE
expr_stmt|;
comment|/* in KBytes */
name|SwConfig
operator|.
name|sizefEventLog2
operator|=
name|HOST_EVENT_LOG_SIZE
expr_stmt|;
comment|/* in KBytes */
name|SwConfig
operator|.
name|eventLog1Option
operator|=
name|DEFAULT_EVENT_LOG_OPTION
expr_stmt|;
name|SwConfig
operator|.
name|eventLog2Option
operator|=
name|DEFAULT_EVENT_LOG_OPTION
expr_stmt|;
name|SwConfig
operator|.
name|fatalErrorInterruptEnable
operator|=
literal|1
expr_stmt|;
name|SwConfig
operator|.
name|fatalErrorInterruptVector
operator|=
literal|0
expr_stmt|;
comment|/* Was 1 */
name|SwConfig
operator|.
name|hostDirectAccessSupport
operator|=
literal|0
expr_stmt|;
name|SwConfig
operator|.
name|hostDirectAccessMode
operator|=
literal|0
expr_stmt|;
name|SwConfig
operator|.
name|FWConfig
operator|=
literal|0
expr_stmt|;
name|SwConfig
operator|.
name|enableDIF
operator|=
name|agFALSE
expr_stmt|;
name|SwConfig
operator|.
name|enableEncryption
operator|=
name|agFALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|SA_CONFIG_MDFD_REGISTRY
name|SwConfig
operator|.
name|disableMDF
operator|=
name|agFALSE
expr_stmt|;
endif|#
directive|endif
comment|/*SA_CONFIG_MDFD_REGISTRY*/
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
name|SwConfig
operator|.
name|sallDebugLevel
operator|=
literal|1
expr_stmt|;
comment|/* DEFAULT_VALUE; */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SA_ENABLE_PCI_TRIGGER
name|SwConfig
operator|.
name|PCI_trigger
operator|=
literal|0
expr_stmt|;
comment|/* DEFAULT_VALUE; */
endif|#
directive|endif
comment|/* SA_ENABLE_PCI_TRIGGER */
ifdef|#
directive|ifdef
name|FDS_DM
comment|/* defaults */
name|dmMemRequirement
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|dmSwConfig
operator|.
name|numDevHandles
operator|=
name|DEFAULT_MAX_DEV
expr_stmt|;
ifdef|#
directive|ifdef
name|DM_DEBUG
name|dmSwConfig
operator|.
name|DMDebugLevel
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
comment|/* defaults */
name|smMemRequirement
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|smSwConfig
operator|.
name|maxActiveIOs
operator|=
name|DEFAULT_MAX_ACTIVE_IOS
expr_stmt|;
name|smSwConfig
operator|.
name|numDevHandles
operator|=
name|DEFAULT_MAX_DEV
expr_stmt|;
ifdef|#
directive|ifdef
name|SM_DEBUG
name|smSwConfig
operator|.
name|SMDebugLevel
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
name|buffer
operator|=
name|tmpBuffer
expr_stmt|;
name|buffLen
operator|=
sizeof|sizeof
argument_list|(
name|tmpBuffer
argument_list|)
expr_stmt|;
comment|/* param3 points to QueueConfig; tdsaAllShared does not exit at this point yet */
name|SwConfig
operator|.
name|param3
operator|=
operator|(
name|void
operator|*
operator|)
operator|&
name|QueueConfig
expr_stmt|;
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
name|iniParmsStr
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
literal|"MaxTargets"
argument_list|,
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|numDevHandles
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|numDevHandles
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: MaxTargets %d\n"
operator|,
name|SwConfig
operator|.
name|numDevHandles
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/*                                                                  * read the NumInboundQueue parameter    */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|numInboundQueues
operator|=
name|DEFAULT_NUM_INBOUND_QUEUE
expr_stmt|;
comment|/* default 1 Inbound queue */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"NumInboundQueues"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|QueueConfig
operator|.
name|numInboundQueues
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QueueConfig
operator|.
name|numInboundQueues
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|QueueConfig
operator|.
name|numInboundQueues
operator|>
name|AGSA_MAX_INBOUND_Q
condition|)
block|{
name|QueueConfig
operator|.
name|numInboundQueues
operator|=
name|AGSA_MAX_INBOUND_Q
expr_stmt|;
block|}
block|}
comment|/*                                                                  * read the NumOutboundQueue parameter    */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|numOutboundQueues
operator|=
name|DEFAULT_NUM_OUTBOUND_QUEUE
expr_stmt|;
comment|/* default 1 Outbound queue */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"NumOutboundQueues"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|QueueConfig
operator|.
name|numOutboundQueues
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QueueConfig
operator|.
name|numOutboundQueues
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|QueueConfig
operator|.
name|numOutboundQueues
operator|>
name|AGSA_MAX_OUTBOUND_Q
condition|)
block|{
name|QueueConfig
operator|.
name|numOutboundQueues
operator|=
name|AGSA_MAX_OUTBOUND_Q
expr_stmt|;
block|}
block|}
comment|/*                                                                  * read the MaxActiveIO parameter    */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"MaxActiveIO"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|maxActiveIOs
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|maxActiveIOs
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*                                                                  * read the SMPTO parameter (SMP Timeout)    */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"SMPTO"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|smpReqTimeout
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|smpReqTimeout
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*                                                                  * read the NumRegClients parameter    */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"NumRegClients"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|numberOfEventRegClients
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|numberOfEventRegClients
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
if|#
directive|if
name|defined
argument_list|(
name|SALLSDK_DEBUG
argument_list|)
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"LLDebugLevel"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|sallDebugLevel
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|sallDebugLevel
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|DM_DEBUG
argument_list|)
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"DMDebugLevel"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|dmSwConfig
operator|.
name|DMDebugLevel
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dmSwConfig
operator|.
name|DMDebugLevel
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|SM_DEBUG
argument_list|)
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"SMDebugLevel"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|smSwConfig
operator|.
name|SMDebugLevel
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|smSwConfig
operator|.
name|SMDebugLevel
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|.
name|numInboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|osti_sprintf
argument_list|(
name|IBQueueSize
argument_list|,
literal|"IBQueueNumElements%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|IBQueueEleSize
argument_list|,
literal|"IBQueueElementSize%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|IBQueuePriority
argument_list|,
literal|"IBQueuePriority%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|/*      * read the IBQueueSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|InboundQueueSize
index|[
name|i
index|]
operator|=
name|DEFAULT_INBOUND_QUEUE_SIZE
expr_stmt|;
comment|/* default 256 Inbound queue size */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|IBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|IBQueueSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|InboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|InboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d IB queue size %d\n"
operator|,
name|i
operator|,
name|InboundQueueSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the IBQueueEleSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|InboundQueueEleSize
index|[
name|i
index|]
operator|=
name|DEFAULT_INBOUND_QUEUE_ELE_SIZE
expr_stmt|;
comment|/* default 128 Inbound queue element */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|IBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|IBQueueEleSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|InboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|InboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d IB queue ele size %d\n"
operator|,
name|i
operator|,
name|InboundQueueEleSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the IBQueuePriority      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|InboundQueuePriority
index|[
name|i
index|]
operator|=
name|DEFAULT_INBOUND_QUEUE_PRIORITY
expr_stmt|;
comment|/* default 0 Inbound queue priority */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|IBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|IBQueuePriority
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|InboundQueuePriority
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|InboundQueuePriority
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d priority %d\n"
operator|,
name|i
operator|,
name|InboundQueuePriority
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**********************************************/
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
block|}
comment|/* end of loop */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|.
name|numOutboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|osti_sprintf
argument_list|(
name|OBQueueSize
argument_list|,
literal|"OBQueueNumElements%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueEleSize
argument_list|,
literal|"OBQueueElementSize%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueInterruptDelay
argument_list|,
literal|"OBQueueInterruptDelay%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueInterruptCount
argument_list|,
literal|"OBQueueInterruptCount%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueInterruptEnable
argument_list|,
literal|"OBQueueInterruptEnable%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|/*      * read the OBQueueSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|OutboundQueueSize
index|[
name|i
index|]
operator|=
name|DEFAULT_OUTBOUND_QUEUE_SIZE
expr_stmt|;
comment|/* default 256 Outbound queue size */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d OB queue size %d\n"
operator|,
name|i
operator|,
name|OutboundQueueSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueEleSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|=
name|DEFAULT_OUTBOUND_QUEUE_ELE_SIZE
expr_stmt|;
comment|/* default 128 Outbound queue element */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueEleSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d OB queue ele size %d\n"
operator|,
name|i
operator|,
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueInterruptDelay      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|=
name|DEFAULT_OUTBOUND_QUEUE_INTERRUPT_DELAY
expr_stmt|;
comment|/* default 1 Outbound interrupt delay */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueInterruptDelay
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d interrupt delay %d\n"
operator|,
name|i
operator|,
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueInterruptCount      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|=
name|DEFAULT_OUTBOUND_QUEUE_INTERRUPT_COUNT
expr_stmt|;
comment|/* default 1 Outbound interrupt count */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueInterruptCount
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d interrupt count %d\n"
operator|,
name|i
operator|,
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueInterruptEnable      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
name|DEFAULT_OUTBOUND_INTERRUPT_ENABLE
expr_stmt|;
comment|/* default 1 Outbound interrupt is enabled */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueInterruptEnable
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SPC_POLLINGMODE
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* SPC_POLLINGMODE */
block|}
else|else
block|{
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SPC_POLLINGMODE
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* SPC_POLLINGMODE */
block|}
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d interrupt enable %d\n"
operator|,
name|i
operator|,
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/**********************************************/
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
block|}
comment|/* end of loop */
comment|/************************************************************    * READ CARD Specific   */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|.
name|numInboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|osti_sprintf
argument_list|(
name|CardNum
argument_list|,
literal|"CardNum%d"
argument_list|,
name|cardID
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|IBQueueSize
argument_list|,
literal|"IBQueueNumElements%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|IBQueueEleSize
argument_list|,
literal|"IBQueueElementSize%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|IBQueuePriority
argument_list|,
literal|"IBQueuePriority%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|/*      * read the IBQueueSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|IBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|IBQueueSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|InboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|InboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d IB queue size %d\n"
operator|,
name|i
operator|,
name|InboundQueueSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the IBQueueEleSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|IBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|IBQueueEleSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|InboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|InboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d IB queue size %d\n"
operator|,
name|i
operator|,
name|InboundQueueEleSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the IBQueuePriority      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|IBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|IBQueuePriority
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|InboundQueuePriority
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|InboundQueuePriority
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: card number %d queue number %d priority %d\n"
operator|,
name|cardID
operator|,
name|i
operator|,
name|InboundQueuePriority
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**********************************************/
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
block|}
comment|/* end of loop */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|.
name|numOutboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|osti_sprintf
argument_list|(
name|CardNum
argument_list|,
literal|"CardNum%d"
argument_list|,
name|cardID
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueSize
argument_list|,
literal|"OBQueueNumElements%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueEleSize
argument_list|,
literal|"OBQueueElementSize%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueInterruptDelay
argument_list|,
literal|"OBQueueInterruptDelay%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueInterruptCount
argument_list|,
literal|"OBQueueInterruptCount%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|osti_sprintf
argument_list|(
name|OBQueueInterruptEnable
argument_list|,
literal|"OBQueueInterruptEnable%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|/*      * read the OBQueueSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d OB queue size %d\n"
operator|,
name|i
operator|,
name|OutboundQueueSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueEleSize      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueEleSize
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: queue number %d OB queue ele size %d\n"
operator|,
name|i
operator|,
name|OutboundQueueEleSize
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueInterruptDelay      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueInterruptDelay
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: card number %d queue number %d interrupt delay %d\n"
operator|,
name|cardID
operator|,
name|i
operator|,
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueInterruptCount      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueInterruptCount
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: card number %d queue number %d interrupt count %d\n"
operator|,
name|cardID
operator|,
name|i
operator|,
name|OutboundQueueInterruptCount
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * read the OBQueueInterruptEnable      */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|CardNum
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|OBQueueProps
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
name|OBQueueInterruptEnable
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SPC_POLLINGMODE
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* SPC_POLLINGMODE */
block|}
else|else
block|{
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
operator|(
name|bit16
operator|)
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SPC_POLLINGMODE
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* SPC_POLLINGMODE */
block|}
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: card number %d queue number %d interrupt count %d\n"
operator|,
name|cardID
operator|,
name|i
operator|,
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/**********************************************/
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
block|}
comment|/* end of loop */
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: \n"
operator|)
argument_list|)
expr_stmt|;
name|tdsaPrintSwConfig
argument_list|(
operator|&
name|SwConfig
argument_list|)
expr_stmt|;
comment|/* fills in queue related parameters */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|.
name|numInboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|.
name|inboundQueues
index|[
name|i
index|]
operator|.
name|elementCount
operator|=
name|InboundQueueSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|.
name|inboundQueues
index|[
name|i
index|]
operator|.
name|elementSize
operator|=
name|InboundQueueEleSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|.
name|inboundQueues
index|[
name|i
index|]
operator|.
name|priority
operator|=
name|InboundQueuePriority
index|[
name|i
index|]
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|.
name|numOutboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|elementCount
operator|=
name|OutboundQueueSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|elementSize
operator|=
name|OutboundQueueEleSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptDelay
operator|=
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptCount
operator|=
name|OutboundQueueInterruptCount
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|.
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptEnable
operator|=
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
expr_stmt|;
block|}
comment|/* process event log related parameters */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"EventLogSize1"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|sizefEventLog1
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|sizefEventLog1
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"EventLogOption1"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|eventLog1Option
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|eventLog1Option
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"EventLogSize2"
argument_list|,
comment|/* valueName */
comment|/* size in K Dwords  */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|sizefEventLog2
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|sizefEventLog2
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"EventLogOption2"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|eventLog2Option
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|eventLog2Option
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* end of event log related parameters */
comment|/*     HDA parameters   */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"HDASupport"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|hostDirectAccessSupport
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|hostDirectAccessSupport
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
comment|/***********************************************************************/
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"HDAMode"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|hostDirectAccessMode
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|hostDirectAccessMode
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
comment|/***********************************************************************/
comment|/* the end of HDA parameters */
comment|/* FW configuration */
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"FWConfig"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|FWConfig
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|FWConfig
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* The end of FW configuration */
ifdef|#
directive|ifdef
name|SA_ENABLE_TRACE_FUNCTIONS
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:  SA_ENABLE_TRACE_FUNCTIONS\n"
operator|)
argument_list|)
expr_stmt|;
comment|/*   buffer = tmpBuffer;   buffLen = sizeof(tmpBuffer);    osti_memset(buffer, 0, buffLen);   lenRecv = 0; */
name|SwConfig
operator|.
name|TraceBufferSize
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
comment|/* key */
name|SwParmsStr
argument_list|,
comment|/* subkey1 */
name|agNULL
argument_list|,
comment|/* subkey2 */
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
comment|/* subkey5 */
literal|"TraceBufferSize"
argument_list|,
comment|/* valueName */
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SwConfig
operator|.
name|TraceBufferSize
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SwConfig
operator|.
name|TraceBufferSize
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: SwConfig.TraceBufferSize %d\n"
operator|,
name|SwConfig
operator|.
name|TraceBufferSize
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/*# SA_ENABLE_TRACE_FUNCTIONS */
name|SwConfig
operator|.
name|mpiContextTable
operator|=
name|agNULL
expr_stmt|;
name|SwConfig
operator|.
name|mpiContextTablelen
operator|=
literal|0
expr_stmt|;
comment|/* default */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|.
name|sasHwEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|sataNCQErrorEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TARGET_DRIVER
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|.
name|tgtITNexusEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|tgtSSPEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|tgtSMPEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
name|QueueConfig
operator|.
name|iqNormalPriorityProcessingDepth
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|iqHighPriorityProcessingDepth
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|.
name|generalEventQueue
operator|=
literal|0
expr_stmt|;
comment|/*     * can agRoot be agNULL below? Yes.     * saGetRequirements(agRoot, IN, OUT, OUT, OUT);     */
name|saGetRequirements
argument_list|(
operator|&
name|agRoot
argument_list|,
operator|&
name|SwConfig
argument_list|,
operator|&
name|memRequirement
argument_list|,
operator|&
name|usecsPerTick
argument_list|,
operator|&
name|maxQueueSets
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|dmGetRequirements
argument_list|(
operator|&
name|dmRoot
argument_list|,
operator|&
name|dmSwConfig
argument_list|,
operator|&
name|dmMemRequirement
argument_list|,
operator|&
name|dmUsecsPerTick
argument_list|,
operator|&
name|dmMaxNumLocks
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
name|smGetRequirements
argument_list|(
operator|&
name|smRoot
argument_list|,
operator|&
name|smSwConfig
argument_list|,
operator|&
name|smMemRequirement
argument_list|,
operator|&
name|smUsecsPerTick
argument_list|,
operator|&
name|smMaxNumLocks
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* initialization */
name|maxNumOSLocks
operator|=
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxNumOSLocks
expr_stmt|;
comment|/*    MAX_LL_LAYER_MEM_DESCRIPTORS is 24. see tidefs.h and tiLoLevelMem_t    in titypes.h  */
if|#
directive|if
name|defined
argument_list|(
name|FDS_DM
argument_list|)
operator|&&
name|defined
argument_list|(
name|FDS_SM
argument_list|)
comment|/* for LL */
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:MAX_LL_LAYER_MEM_DESCRIPTORS %d\n"
operator|,
name|MAX_LL_LAYER_MEM_DESCRIPTORS
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_LL_LAYER_MEM_DESCRIPTORS
condition|;
name|i
operator|++
control|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|reserved
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|virtPtr
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|osHandle
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrUpper
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrLower
operator|=
literal|0
expr_stmt|;
block|}
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:memRequirement.count %d\n"
operator|,
name|memRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from saGetRequirements */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|memRequirement
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* for DM */
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:dmMemRequirement.count %d\n"
operator|,
name|dmMemRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from dmGetRequirements */
for|for
control|(
name|i
operator|=
name|memRequirement
operator|.
name|count
init|;
name|i
operator|<
operator|(
name|memRequirement
operator|.
name|count
operator|+
name|dmMemRequirement
operator|.
name|count
operator|)
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* for SM */
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:smMemRequirement.count %d\n"
operator|,
name|smMemRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from dmGetRequirements */
for|for
control|(
name|i
operator|=
operator|(
name|memRequirement
operator|.
name|count
operator|+
name|dmMemRequirement
operator|.
name|count
operator|)
init|;
name|i
operator|<
operator|(
name|memRequirement
operator|.
name|count
operator|+
name|dmMemRequirement
operator|.
name|count
operator|+
name|smMemRequirement
operator|.
name|count
operator|)
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
operator|-
name|dmMemRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* sets the low level options */
name|loResource
operator|->
name|loLevelOption
operator|.
name|usecsPerTick
operator|=
name|MIN
argument_list|(
name|MIN
argument_list|(
name|usecsPerTick
argument_list|,
name|dmUsecsPerTick
argument_list|)
argument_list|,
name|smUsecsPerTick
argument_list|)
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|numOfQueuesPerPort
operator|=
name|maxQueueSets
operator|+
name|dmMaxNumLocks
operator|+
name|smMaxNumLocks
operator|+
name|TD_MAX_LOCKS
operator|+
name|maxNumOSLocks
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|mutexLockUsage
operator|=
name|tiOneMutexLockPerQueue
expr_stmt|;
comment|/* no more ESGL */
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|=
name|memRequirement
operator|.
name|count
operator|+
name|dmMemRequirement
operator|.
name|count
operator|+
name|smMemRequirement
operator|.
name|count
expr_stmt|;
comment|/* setting interrupt requirements */
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSIX_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSI_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|=
name|SwConfig
operator|.
name|legacyInt_X
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking maxInterruptVectors(MSIX) %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking max_MSI_InterruptVectors %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking flag - legacyInt_X %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|)
argument_list|)
expr_stmt|;
comment|//  TI_DBG6(("tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n",memRequirement.count, loResource->loLevelMem.mem[memRequirement.count].numElements,loResource->loLevelMem.mem[memRequirement.count].totalLength, loResource->loLevelMem.mem[memRequirement.count].singleElementLength,loResource->loLevelMem.mem[memRequirement.count].alignment ));
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: total memRequirement count %d TI_DMA_MEM\n"
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|FDS_DM
argument_list|)
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:MAX_LL_LAYER_MEM_DESCRIPTORS %d\n"
operator|,
name|MAX_LL_LAYER_MEM_DESCRIPTORS
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_LL_LAYER_MEM_DESCRIPTORS
condition|;
name|i
operator|++
control|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|reserved
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|virtPtr
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|osHandle
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrUpper
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrLower
operator|=
literal|0
expr_stmt|;
block|}
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:memRequirement.count %d\n"
operator|,
name|memRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from saGetRequirements */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|memRequirement
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:dmMemRequirement.count %d\n"
operator|,
name|dmMemRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from dmGetRequirements */
for|for
control|(
name|i
operator|=
name|memRequirement
operator|.
name|count
init|;
name|i
operator|<
operator|(
name|memRequirement
operator|.
name|count
operator|+
name|dmMemRequirement
operator|.
name|count
operator|)
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|dmMemRequirement
operator|.
name|dmMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* sets the low level options */
name|loResource
operator|->
name|loLevelOption
operator|.
name|usecsPerTick
operator|=
name|MIN
argument_list|(
name|usecsPerTick
argument_list|,
name|dmUsecsPerTick
argument_list|)
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|numOfQueuesPerPort
operator|=
name|maxQueueSets
operator|+
name|dmMaxNumLocks
operator|+
name|TD_MAX_LOCKS
operator|+
name|maxNumOSLocks
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|mutexLockUsage
operator|=
name|tiOneMutexLockPerQueue
expr_stmt|;
comment|/* no more ESGL */
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|=
name|memRequirement
operator|.
name|count
operator|+
name|dmMemRequirement
operator|.
name|count
expr_stmt|;
comment|/* setting interrupt requirements */
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSIX_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSI_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|=
name|SwConfig
operator|.
name|legacyInt_X
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking maxInterruptVectors(MSIX) %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking max_MSI_InterruptVectors %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking flag - legacyInt_X %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|)
argument_list|)
expr_stmt|;
comment|//  TI_DBG6(("tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n",memRequirement.count, loResource->loLevelMem.mem[memRequirement.count].numElements,loResource->loLevelMem.mem[memRequirement.count].totalLength, loResource->loLevelMem.mem[memRequirement.count].singleElementLength,loResource->loLevelMem.mem[memRequirement.count].alignment ));
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: total memRequirement count %d TI_DMA_MEM\n"
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|FDS_SM
argument_list|)
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:MAX_LL_LAYER_MEM_DESCRIPTORS %d\n"
operator|,
name|MAX_LL_LAYER_MEM_DESCRIPTORS
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_LL_LAYER_MEM_DESCRIPTORS
condition|;
name|i
operator|++
control|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|reserved
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|virtPtr
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|osHandle
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrUpper
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrLower
operator|=
literal|0
expr_stmt|;
block|}
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:memRequirement.count %d\n"
operator|,
name|memRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from saGetRequirements */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|memRequirement
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|TI_DBG1
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:smMemRequirement.count %d\n"
operator|,
name|smMemRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
comment|/* using the returned value from smGetRequirements */
for|for
control|(
name|i
operator|=
name|memRequirement
operator|.
name|count
init|;
name|i
operator|<
operator|(
name|memRequirement
operator|.
name|count
operator|+
name|smMemRequirement
operator|.
name|count
operator|)
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|smMemRequirement
operator|.
name|smMemory
index|[
name|i
operator|-
name|memRequirement
operator|.
name|count
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* sets the low level options */
name|loResource
operator|->
name|loLevelOption
operator|.
name|usecsPerTick
operator|=
name|MIN
argument_list|(
name|usecsPerTick
argument_list|,
name|smUsecsPerTick
argument_list|)
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|numOfQueuesPerPort
operator|=
name|maxQueueSets
operator|+
name|smMaxNumLocks
operator|+
name|TD_MAX_LOCKS
operator|+
name|maxNumOSLocks
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|mutexLockUsage
operator|=
name|tiOneMutexLockPerQueue
expr_stmt|;
comment|/* no more ESGL */
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|=
name|memRequirement
operator|.
name|count
operator|+
name|smMemRequirement
operator|.
name|count
expr_stmt|;
comment|/* setting interrupt requirements */
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSIX_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSI_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|=
name|SwConfig
operator|.
name|legacyInt_X
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking maxInterruptVectors(MSIX) %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking max_MSI_InterruptVectors %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking flag - legacyInt_X %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|)
argument_list|)
expr_stmt|;
comment|//  TI_DBG6(("tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n",memRequirement.count, loResource->loLevelMem.mem[memRequirement.count].numElements,loResource->loLevelMem.mem[memRequirement.count].totalLength, loResource->loLevelMem.mem[memRequirement.count].singleElementLength,loResource->loLevelMem.mem[memRequirement.count].alignment ));
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: total memRequirement count %d TI_DMA_MEM\n"
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource:MAX_LL_LAYER_MEM_DESCRIPTORS %d\n"
operator|,
name|MAX_LL_LAYER_MEM_DESCRIPTORS
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_LL_LAYER_MEM_DESCRIPTORS
condition|;
name|i
operator|++
control|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|reserved
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|virtPtr
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|osHandle
operator|=
name|agNULL
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrUpper
operator|=
literal|0
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|physAddrLower
operator|=
literal|0
expr_stmt|;
block|}
comment|/* using the returned value from saGetRequirements */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|memRequirement
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
comment|/* hardcoded values for now */
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|numElements
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|totalLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|singleElementLength
expr_stmt|;
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|=
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|alignment
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|i
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AGSA_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AGSA_CACHED_DMA_MEM
operator|==
name|memRequirement
operator|.
name|agMemory
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|i
index|]
operator|.
name|type
operator|=
name|TI_CACHED_DMA_MEM
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d TI_CACHED_DMA_MEM\n"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* sets the low level options */
name|loResource
operator|->
name|loLevelOption
operator|.
name|usecsPerTick
operator|=
name|usecsPerTick
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|numOfQueuesPerPort
operator|=
name|maxQueueSets
operator|+
name|TD_MAX_LOCKS
operator|+
name|maxNumOSLocks
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|mutexLockUsage
operator|=
name|tiOneMutexLockPerQueue
expr_stmt|;
comment|/* no more ESGL */
name|loResource
operator|->
name|loLevelMem
operator|.
name|count
operator|=
name|memRequirement
operator|.
name|count
expr_stmt|;
comment|/* setting interrupt requirements */
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSIX_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|=
name|SwConfig
operator|.
name|max_MSI_InterruptVectors
expr_stmt|;
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|=
name|SwConfig
operator|.
name|legacyInt_X
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking maxInterruptVectors(MSIX) %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|maxInterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking max_MSI_InterruptVectors %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|max_MSI_InterruptVectors
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: asking flag - legacyInt_X %d \n"
operator|,
name|loResource
operator|->
name|loLevelOption
operator|.
name|flag
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: index %d numElements %d totalLength %d singleElementLength %d alignment %d\n"
operator|,
name|memRequirement
operator|.
name|count
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|memRequirement
operator|.
name|count
index|]
operator|.
name|numElements
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|memRequirement
operator|.
name|count
index|]
operator|.
name|totalLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|memRequirement
operator|.
name|count
index|]
operator|.
name|singleElementLength
operator|,
name|loResource
operator|->
name|loLevelMem
operator|.
name|mem
index|[
name|memRequirement
operator|.
name|count
index|]
operator|.
name|alignment
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaLoLevelGetResource: memRequirement.count %d TI_DMA_MEM\n"
operator|,
name|memRequirement
operator|.
name|count
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaSharedMemCalculate * *  Purpose:  This function is called to determine the Transport  *            Dependent Layer internal resource requirement  *            for shared memory between target and initiator *            functionality. * *  \param  tiRoot:             Pointer to driver/port instance. *  \param  tdSharedMem:        Pointer to shared memory structure * *  \return: None * *  \note - The shared memory is composed of like the followings *          sizeof(tdsaRoot_t) *          + sizeof(tdsaPortContext_t) * TD_MAX_PORT_CONTEXT *          + sizeof(tdsaDeviceData_t) * MaxTargets *          + sizeof(tdsaEsglPageInfo_t) * NumEsglPages * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaSharedMemCalculate
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|tiLoLevelResource_t
modifier|*
name|loResource
parameter_list|,
name|tiTdSharedMem_t
modifier|*
name|tdSharedMem
parameter_list|)
block|{
name|bit32
name|MaxTargets
decl_stmt|;
comment|/* the following fn fills in MaxTargets */
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaSharedMemCalculate: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
comment|/*    * Cached mem for the shared TD Layer functionality    */
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|singleElementLength
operator|=
sizeof|sizeof
argument_list|(
name|tdsaRoot_t
argument_list|)
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|*
name|TD_MAX_PORT_CONTEXT
operator|)
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|*
name|MaxTargets
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TD_INT_COALESCE
comment|/* adding TD interrupt coalesce data structure to the shared TD layer */
comment|/* TD_MAX_INT_COALESCE is defined to be 512 */
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|singleElementLength
operator|+=
sizeof|sizeof
argument_list|(
name|tdsaIntCoalesceContext_t
argument_list|)
operator|*
name|TD_MAX_INT_COALESCE
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TD_DISCOVER
comment|/* adding expander data strutures */
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|singleElementLength
operator|+=
sizeof|sizeof
argument_list|(
name|tdsaExpander_t
argument_list|)
operator|*
name|MaxTargets
expr_stmt|;
endif|#
directive|endif
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|numElements
operator|=
literal|1
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|totalLength
operator|=
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|singleElementLength
operator|*
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|numElements
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|alignment
operator|=
literal|8
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|type
operator|=
name|TI_CACHED_MEM
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|virtPtr
operator|=
name|agNULL
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|osHandle
operator|=
name|agNULL
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|physAddrUpper
operator|=
literal|0
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|physAddrLower
operator|=
literal|0
expr_stmt|;
name|tdSharedMem
operator|->
name|tdSharedCachedMem1
operator|.
name|reserved
operator|=
literal|0
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \biref tdResetComMemFlags * *  Purpose:  This function is called to reset all the flags for the port * *  \param  tiRoot:             Pointer to driver/port instance. * *  \return: None * * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaResetComMemFlags
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_DEBUG_ENABLE
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContextMem
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaResetComMemFlags: start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaResetComMemFlag:: ******* tdsaRoot %p \n"
operator|,
name|tdsaRoot
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaResetComMemFlag:: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|tdsaAllShared
operator|->
name|flags
operator|.
name|sysIntsActive
operator|=
name|agFALSE
expr_stmt|;
name|tdsaAllShared
operator|->
name|flags
operator|.
name|resetInProgress
operator|=
name|agFALSE
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \biref tdssInitSASPortStartInfo * *  Purpose:  This function sets information related to staring a port * *  \param  tiRoot:             Pointer to driver/port instance. * *  \return: None * * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdssInitSASPortStartInfo
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
name|int
name|i
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_DEBUG_ENABLE
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContextMem
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdssInitSASPortStartInfo: start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdssInitSASPortStartInfo: ******* tdsaRoot %p \n"
operator|,
name|tdsaRoot
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdssInitSASPortStartInfo: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TD_MAX_NUM_PHYS
condition|;
name|i
operator|++
control|)
block|{
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|tiPortalContext
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|portContext
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressHi
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressHi
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressHi
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressHi
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressLo
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressLo
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressLo
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|sasAddressLo
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|SASID
operator|.
name|phyIdentifier
operator|=
operator|(
name|bit8
operator|)
name|i
expr_stmt|;
comment|/* continue .... */
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|flags
operator|.
name|portStarted
operator|=
name|agFALSE
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|flags
operator|.
name|portInitialized
operator|=
name|agFALSE
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|flags
operator|.
name|portReadyForDiscoverySent
operator|=
name|agFALSE
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|flags
operator|.
name|portStoppedByOSLayer
operator|=
name|agFALSE
expr_stmt|;
name|tdsaAllShared
operator|->
name|Ports
index|[
name|i
index|]
operator|.
name|flags
operator|.
name|failPortInit
operator|=
name|agFALSE
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaInitTimers * *  Purpose: This function is called to initialize the timers *           for initiator * *  \param   tiRoot: pointer to the driver instance * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaInitTimers
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_DEBUG_ENABLE
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContextMem
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaInitTimers: start \n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaInitTimers: ******* tdsaRoot %p \n"
operator|,
name|tdsaRoot
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaInitTimers: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* initialize the timerlist */
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaAllShared
operator|->
name|timerlist
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaJumpTableInit * *  Purpose: This function initializes SAS related callback functions * *  \param   tiRoot: pointer to the driver instance * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaJumpTableInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_DEBUG_ENABLE
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContextMem
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaJumpTableInit: start \n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaJumpTableInit:: ******* tdsaRoot %p \n"
operator|,
name|tdsaRoot
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaJumpTableInit:: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* tdtype.h */
comment|/*     For combo,     pSSPIOCompleted, pSMPCompleted; use callback      pSSPReqReceive, pSMPReqReceived; use jumptable   */
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pSSPIOCompleted
operator|=
name|agNULL
expr_stmt|;
comment|/* initiator */
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pSMPCompleted
operator|=
name|agNULL
expr_stmt|;
comment|/* initiator */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|TARGET_DRIVER
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pSSPIOCompleted
operator|=
name|agNULL
expr_stmt|;
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pSSPReqReceived
operator|=
operator|&
name|ttdsaSSPReqReceived
expr_stmt|;
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pSMPReqReceived
operator|=
operator|&
name|ttdsaSMPReqReceived
expr_stmt|;
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pSMPCompleted
operator|=
name|agNULL
expr_stmt|;
endif|#
directive|endif
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|.
name|pGetSGLChunk
operator|=
name|agNULL
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaPortContextInit * *  Purpose: This function initializes port contexts. * *  \param   tiRoot: pointer to the driver instance * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaPortContextInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContextMem
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|int
name|j
init|=
literal|0
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: ******* sizeof(tdsaPortContext) %d %x\n"
operator|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|,
operator|(
name|unsigned
name|int
operator|)
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: ******* tdsaRoot %p \n"
operator|,
name|tdsaRoot
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: ******* tdsaPortContext+1 %p \n"
operator|,
name|tdsaPortContext
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: *******&tdsaPortContext[0] %p&tdsaPortContext[1] %p\n"
operator|,
operator|&
operator|(
name|tdsaPortContext
index|[
literal|0
index|]
operator|)
operator|,
operator|&
operator|(
name|tdsaPortContext
index|[
literal|1
index|]
operator|)
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaAllShared
operator|->
name|MainPortContextList
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaAllShared
operator|->
name|FreePortContextList
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TD_MAX_PORT_CONTEXT
condition|;
name|i
operator|++
control|)
block|{
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|FreeLink
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|MainLink
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TD_DISCOVER
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|discoveringExpanderList
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|UpdiscoveringExpanderList
operator|)
argument_list|)
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|type
operator|=
name|TDSA_DISCOVERY_OPTION_FULL_START
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|discoveryTimer
operator|)
argument_list|)
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|configureRouteTimer
operator|)
argument_list|)
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|deviceRegistrationTimer
operator|)
argument_list|)
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|SMPBusyTimer
operator|)
argument_list|)
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|BCTimer
operator|)
argument_list|)
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|DiscoverySMPTimer
operator|)
argument_list|)
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|retries
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|configureRouteRetries
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|deviceRetistrationRetries
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|pendingSMP
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|SeenBC
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|forcedOK
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|SMPRetries
operator|=
literal|0
expr_stmt|;
comment|//    tdsaPortContext[i].discovery.doIncremental = agFALSE;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|discovery
operator|.
name|ResetTriggerred
operator|=
name|agFALSE
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|DiscoveryState
operator|=
name|ITD_DSTATE_NOT_STARTED
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|nativeSATAMode
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|directAttatchedSAS
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|DiscoveryRdyGiven
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|SeenLinkUp
operator|=
name|agFALSE
expr_stmt|;
endif|#
directive|endif
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|id
operator|=
name|i
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|agPortContext
operator|=
name|agNULL
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|LinkRate
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|Count
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|valid
operator|=
name|agFALSE
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|TD_MAX_NUM_PHYS
condition|;
name|j
operator|++
control|)
block|{
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|PhyIDList
index|[
name|j
index|]
operator|=
name|agFALSE
expr_stmt|;
block|}
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|RegisteredDevNums
operator|=
literal|0
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|eventPhyID
operator|=
literal|0xFF
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|Transient
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|PortRecoverPhyID
operator|=
literal|0xFF
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|DiscFailNSeenBC
operator|=
name|agFALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|dmPortContext
operator|.
name|tdData
operator|=
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|)
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|DMDiscoveryState
operator|=
name|dmDiscCompleted
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|UseDM
operator|=
name|agFALSE
expr_stmt|;
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|UpdateMCN
operator|=
name|agFALSE
expr_stmt|;
endif|#
directive|endif
comment|/* add more variables later */
name|TDLIST_ENQUEUE_AT_TAIL
argument_list|(
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|.
name|FreeLink
operator|)
argument_list|,
operator|&
operator|(
name|tdsaAllShared
operator|->
name|FreePortContextList
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TD_INTERNAL_DEBUG
comment|/* for debugging only */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TD_MAX_PORT_CONTEXT
condition|;
name|i
operator|++
control|)
block|{
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: index %d&tdsaPortContext[] %p\n"
operator|,
name|i
operator|,
operator|&
operator|(
name|tdsaPortContext
index|[
name|i
index|]
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaPortContextInit: sizeof(tdsaPortContext_t) %d 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|,
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaPortContextReInit * *  Purpose: This function re-initializes port contexts for reuse. * *  \param   tiRoot:         pointer to the driver instance *  \param   onePortContext: pointer to the portcontext * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaPortContextReInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|tdsaPortContext_t
modifier|*
name|onePortContext
parameter_list|)
block|{
name|int
name|j
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_DISCOVER
name|tdsaDiscovery_t
modifier|*
name|discovery
decl_stmt|;
endif|#
directive|endif
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaPortContextReInit: start\n"
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TD_DISCOVER
name|discovery
operator|=
operator|&
operator|(
name|onePortContext
operator|->
name|discovery
operator|)
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|type
operator|=
name|TDSA_DISCOVERY_OPTION_FULL_START
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|retries
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|configureRouteRetries
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|deviceRetistrationRetries
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|pendingSMP
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|SeenBC
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|forcedOK
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|SMPRetries
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|discovery
operator|.
name|ResetTriggerred
operator|=
name|agFALSE
expr_stmt|;
comment|/* free expander lists */
name|tdsaFreeAllExp
argument_list|(
name|tiRoot
argument_list|,
name|onePortContext
argument_list|)
expr_stmt|;
comment|/* kill the discovery-related timers if they are running */
if|if
condition|(
name|discovery
operator|->
name|discoveryTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|discovery
operator|->
name|discoveryTimer
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|discovery
operator|->
name|configureRouteTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|discovery
operator|->
name|configureRouteTimer
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|discovery
operator|->
name|deviceRegistrationTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|discovery
operator|->
name|deviceRegistrationTimer
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|discovery
operator|->
name|BCTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|discovery
operator|->
name|BCTimer
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|discovery
operator|->
name|SMPBusyTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|discovery
operator|->
name|SMPBusyTimer
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|discovery
operator|->
name|DiscoverySMPTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|discovery
operator|->
name|DiscoverySMPTimer
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|INITIATOR_DRIVER
name|onePortContext
operator|->
name|DiscoveryState
operator|=
name|ITD_DSTATE_NOT_STARTED
expr_stmt|;
name|onePortContext
operator|->
name|nativeSATAMode
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|directAttatchedSAS
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|DiscoveryRdyGiven
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|SeenLinkUp
operator|=
name|agFALSE
expr_stmt|;
endif|#
directive|endif
name|onePortContext
operator|->
name|agPortContext
operator|->
name|osData
operator|=
name|agNULL
expr_stmt|;
name|onePortContext
operator|->
name|agPortContext
operator|=
name|agNULL
expr_stmt|;
name|onePortContext
operator|->
name|tiPortalContext
operator|=
name|agNULL
expr_stmt|;
name|onePortContext
operator|->
name|agRoot
operator|=
name|agNULL
expr_stmt|;
name|onePortContext
operator|->
name|LinkRate
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|Count
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|TD_MAX_NUM_PHYS
condition|;
name|j
operator|++
control|)
block|{
name|onePortContext
operator|->
name|PhyIDList
index|[
name|j
index|]
operator|=
name|agFALSE
expr_stmt|;
block|}
name|onePortContext
operator|->
name|RegisteredDevNums
operator|=
literal|0
expr_stmt|;
name|onePortContext
operator|->
name|eventPhyID
operator|=
literal|0xFF
expr_stmt|;
name|onePortContext
operator|->
name|Transient
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|PortRecoverPhyID
operator|=
literal|0xFF
expr_stmt|;
name|onePortContext
operator|->
name|DiscFailNSeenBC
operator|=
name|agFALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|onePortContext
operator|->
name|dmPortContext
operator|.
name|tdData
operator|=
name|onePortContext
expr_stmt|;
name|onePortContext
operator|->
name|DMDiscoveryState
operator|=
name|dmDiscCompleted
expr_stmt|;
name|onePortContext
operator|->
name|UseDM
operator|=
name|agFALSE
expr_stmt|;
name|onePortContext
operator|->
name|UpdateMCN
operator|=
name|agFALSE
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaDeviceDataInit * *  Purpose: This function initializes devices * *  \param   tiRoot: pointer to the driver instance * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaDeviceDataInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
ifdef|#
directive|ifdef
name|TD_DEBUG_ENABLE
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContextMem
decl_stmt|;
endif|#
directive|endif
name|tdsaDeviceData_t
modifier|*
name|tdsaDeviceData
init|=
operator|(
name|tdsaDeviceData_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|DeviceMem
decl_stmt|;
name|int
name|i
decl_stmt|;
ifdef|#
directive|ifdef
name|SATA_ENABLE
name|bit32
name|j
decl_stmt|;
name|satInternalIo_t
modifier|*
name|satIntIO
decl_stmt|;
endif|#
directive|endif
name|bit32
name|MaxTargets
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: ******* tdsaDeviceData %p\n"
operator|,
name|tdsaDeviceData
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: ******* tdsaDeviceData+1 %p\n"
operator|,
name|tdsaDeviceData
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: *******&tdsaDeviceData[0] %p&tdsaDeviceData[1] %p\n"
operator|,
operator|&
operator|(
name|tdsaDeviceData
index|[
literal|0
index|]
operator|)
operator|,
operator|&
operator|(
name|tdsaDeviceData
index|[
literal|1
index|]
operator|)
operator|)
argument_list|)
expr_stmt|;
comment|/* the following fn fills in MaxTargets */
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaAllShared
operator|->
name|MainDeviceList
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaAllShared
operator|->
name|FreeDeviceList
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|int
operator|)
name|MaxTargets
condition|;
name|i
operator|++
control|)
block|{
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|FreeLink
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|MainLink
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|IncDisLink
operator|)
argument_list|)
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|id
operator|=
name|i
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|InQID
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|OutQID
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|DeviceType
operator|=
name|TD_DEFAULT_DEVICE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|agRoot
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|agDevHandle
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|pJumpTable
operator|=
operator|&
operator|(
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|)
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|tiDeviceHandle
operator|.
name|osData
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|tiDeviceHandle
operator|.
name|tdData
operator|=
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|)
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|tdPortContext
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|tdExpander
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|ExpDevice
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|phyID
operator|=
literal|0xFF
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|SASAddressID
operator|.
name|sasAddressHi
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|SASAddressID
operator|.
name|sasAddressLo
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|valid
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|valid2
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|processed
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|initiator_ssp_stp_smp
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|target_ssp_stp_smp
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|numOfPhys
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|registered
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|directlyAttached
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|SASSpecDeviceType
operator|=
literal|0xFF
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|IOStart
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|IOResponse
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|agDeviceResetContext
operator|.
name|osData
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|agDeviceResetContext
operator|.
name|sdkData
operator|=
name|agNULL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|TRflag
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|ResetCnt
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|OSAbortAll
operator|=
name|agFALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|devMCN
operator|=
literal|1
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|finalMCN
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|SMNumOfFCA
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|SMNumOfID
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SATA_ENABLE
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satIoLinkList
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satFreeIntIoLinkList
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satActiveIntIoLinkList
operator|)
argument_list|)
expr_stmt|;
comment|/* default */
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satDriveState
operator|=
name|SAT_DEV_STATE_NORMAL
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satNCQMaxIO
operator|=
name|SAT_NCQ_MAX
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satPendingIO
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satPendingNCQIO
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satPendingNONNCQIO
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|IDDeviceValid
operator|=
name|agFALSE
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|freeSATAFDMATagBitmap
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|NumOfFCA
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|NumOfIDRetries
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|ID_Retries
operator|=
literal|0
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|IDPending
operator|=
name|agFALSE
expr_stmt|;
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|SATAIDDeviceTimer
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_SM
name|tdsaInitTimerRequest
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|tdIDTimer
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|osti_memset
argument_list|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satMaxLBA
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satMaxLBA
argument_list|)
argument_list|)
expr_stmt|;
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satSaDeviceData
operator|=
operator|&
name|tdsaDeviceData
index|[
name|i
index|]
expr_stmt|;
name|satIntIO
operator|=
operator|&
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satIntIo
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|SAT_MAX_INT_IO
condition|;
name|j
operator|++
control|)
block|{
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
name|satIntIO
operator|->
name|satIntIoLink
argument_list|)
expr_stmt|;
name|TDLIST_ENQUEUE_AT_TAIL
argument_list|(
operator|&
name|satIntIO
operator|->
name|satIntIoLink
argument_list|,
operator|&
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|satDevData
operator|.
name|satFreeIntIoLinkList
argument_list|)
expr_stmt|;
name|satIntIO
operator|->
name|satOrgTiIORequest
operator|=
name|agNULL
expr_stmt|;
name|satIntIO
operator|->
name|id
operator|=
name|j
expr_stmt|;
name|satIntIO
operator|=
name|satIntIO
operator|+
literal|1
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* some other variables */
name|TDLIST_ENQUEUE_AT_TAIL
argument_list|(
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|.
name|FreeLink
operator|)
argument_list|,
operator|&
operator|(
name|tdsaAllShared
operator|->
name|FreeDeviceList
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TD_INTERNAL_DEBUG
comment|/* for debugging only */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MaxTargets
condition|;
name|i
operator|++
control|)
block|{
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: index %d&tdsaDeviceData[] %p\n"
operator|,
name|i
operator|,
operator|&
operator|(
name|tdsaDeviceData
index|[
name|i
index|]
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: sizeof(tdsaDeviceData_t) %d 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|,
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief tdsaDeviceDataReInit * *  Purpose: This function re-initializes device data for reuse. * *  \param   tiRoot:         pointer to the driver instance *  \param   onePortContext: pointer to the device data * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaDeviceDataReInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|tdsaDeviceData_t
modifier|*
name|oneDeviceData
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
ifdef|#
directive|ifdef
name|SATA_ENABLE
name|int
name|j
init|=
literal|0
decl_stmt|;
name|satInternalIo_t
modifier|*
name|satIntIO
decl_stmt|;
endif|#
directive|endif
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaDeviceDataReInit: start\n"
operator|)
argument_list|)
expr_stmt|;
name|oneDeviceData
operator|->
name|InQID
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|OutQID
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|DeviceType
operator|=
name|TD_DEFAULT_DEVICE
expr_stmt|;
name|oneDeviceData
operator|->
name|agDevHandle
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|pJumpTable
operator|=
operator|&
operator|(
name|tdsaAllShared
operator|->
name|tdJumpTable
operator|)
expr_stmt|;
name|oneDeviceData
operator|->
name|tiDeviceHandle
operator|.
name|osData
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|tiDeviceHandle
operator|.
name|tdData
operator|=
name|oneDeviceData
expr_stmt|;
name|oneDeviceData
operator|->
name|tdPortContext
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|tdExpander
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|ExpDevice
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|phyID
operator|=
literal|0xFF
expr_stmt|;
name|oneDeviceData
operator|->
name|SASAddressID
operator|.
name|sasAddressHi
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|SASAddressID
operator|.
name|sasAddressLo
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|valid
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|valid2
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|processed
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|initiator_ssp_stp_smp
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|target_ssp_stp_smp
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|numOfPhys
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|registered
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|directlyAttached
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|SASSpecDeviceType
operator|=
literal|0xFF
expr_stmt|;
name|oneDeviceData
operator|->
name|IOStart
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|IOResponse
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|agDeviceResetContext
operator|.
name|osData
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|agDeviceResetContext
operator|.
name|sdkData
operator|=
name|agNULL
expr_stmt|;
name|oneDeviceData
operator|->
name|TRflag
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|ResetCnt
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|OSAbortAll
operator|=
name|agFALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|FDS_DM
name|oneDeviceData
operator|->
name|devMCN
operator|=
literal|1
expr_stmt|;
name|oneDeviceData
operator|->
name|finalMCN
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FDS_SM
name|oneDeviceData
operator|->
name|SMNumOfFCA
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|SMNumOfID
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|oneDeviceData
operator|->
name|tdIDTimer
operator|.
name|timerRunning
operator|==
name|agTRUE
condition|)
block|{
name|tdsaKillTimer
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|oneDeviceData
operator|->
name|tdIDTimer
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SATA_ENABLE
comment|/* default */
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satDriveState
operator|=
name|SAT_DEV_STATE_NORMAL
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satNCQMaxIO
operator|=
name|SAT_NCQ_MAX
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satPendingIO
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satPendingNCQIO
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satPendingNONNCQIO
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|IDDeviceValid
operator|=
name|agFALSE
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|freeSATAFDMATagBitmap
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|NumOfFCA
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|NumOfIDRetries
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|ID_Retries
operator|=
literal|0
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|IDPending
operator|=
name|agFALSE
expr_stmt|;
name|osti_memset
argument_list|(
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satMaxLBA
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satMaxLBA
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satIdentifyData
operator|)
argument_list|,
literal|0xFF
argument_list|,
sizeof|sizeof
argument_list|(
name|agsaSATAIdentifyData_t
argument_list|)
argument_list|)
expr_stmt|;
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satSaDeviceData
operator|=
name|oneDeviceData
expr_stmt|;
name|satIntIO
operator|=
operator|(
name|satInternalIo_t
operator|*
operator|)
operator|&
operator|(
name|oneDeviceData
operator|->
name|satDevData
operator|.
name|satIntIo
index|[
literal|0
index|]
operator|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|SAT_MAX_INT_IO
condition|;
name|j
operator|++
control|)
block|{
name|TI_DBG3
argument_list|(
operator|(
literal|"tdsaDeviceDataReInit: in loop of internal io free, id %d\n"
operator|,
name|satIntIO
operator|->
name|id
operator|)
argument_list|)
expr_stmt|;
name|satFreeIntIoResource
argument_list|(
name|tiRoot
argument_list|,
operator|&
operator|(
name|oneDeviceData
operator|->
name|satDevData
operator|)
argument_list|,
name|satIntIO
argument_list|)
expr_stmt|;
name|satIntIO
operator|=
name|satIntIO
operator|+
literal|1
expr_stmt|;
block|}
endif|#
directive|endif
return|return;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|TD_INT_COALESCE
end_ifdef

begin_comment
comment|/***************************************************************************** *! \brief tdsaIntCoalCxtInit( * *  Purpose: This function initializes interrupt coalesce contexts. * *  \param   tiRoot: pointer to the driver instance * *  \return: None * *  \note:  * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaIntCoalCxtInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
name|tdsaPortContext_t
modifier|*
name|tdsaPortContext
init|=
operator|(
name|tdsaPortContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|PortContext
decl_stmt|;
name|tdsaDeviceData_t
modifier|*
name|tdsaDeviceData
init|=
operator|(
name|tdsaDeviceData_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|DeviceDataHead
decl_stmt|;
name|tdsaIntCoalesceContext_t
modifier|*
name|tdsaIntCoalCxt
init|=
operator|(
name|tdsaIntCoalesceContext_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|IntCoalesce
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|int
name|j
init|=
literal|0
decl_stmt|;
name|bit32
name|MaxTargets
decl_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: start\n"
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: ******* sizeof(tdsaPortContext) %d 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|,
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: ******* sizeof(tdsaIntCoalCxt) %d 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|,
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: ******* sizeof(tdsaIntCoalCxt) %d 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaIntCoalesceContext_t
argument_list|)
operator|,
sizeof|sizeof
argument_list|(
name|tdsaIntCoalesceContext_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: ******* tdsaRoot %p \n"
operator|,
name|tdsaRoot
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: ******* tdsaPortContext %p \n"
operator|,
name|tdsaPortContext
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaDeviceDataInit: ******* tdsaDeviceData %p\n"
operator|,
name|tdsaDeviceData
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: ******* tdsaIntCoalCxt+1 %p \n"
operator|,
name|tdsaIntCoalCxt
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: *******&tdsaIntCoalCxt[0] %p&tdsaIntCoalCxt[1] %p\n"
operator|,
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|)
operator|,
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
literal|1
index|]
operator|)
operator|)
argument_list|)
expr_stmt|;
comment|/* for debug */
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: TD_MAX_PORT_CONTEXT %d\n"
operator|,
name|TD_MAX_PORT_CONTEXT
operator|)
argument_list|)
expr_stmt|;
comment|/* the following fn fills in MaxTargets */
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: portcontext in sum 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaPortContext_t
argument_list|)
operator|*
name|TD_MAX_PORT_CONTEXT
operator|)
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaIntCoalCxtInit: devicedata in sum 0x%x\n"
operator|,
sizeof|sizeof
argument_list|(
name|tdsaDeviceData_t
argument_list|)
operator|*
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
comment|/*       tdsaIntCoalCx[0] is just head, not an element   */
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|.
name|MainLink
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|.
name|FreeLink
operator|)
argument_list|)
expr_stmt|;
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|.
name|tdsaAllShared
operator|=
name|tdsaAllShared
expr_stmt|;
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|.
name|tiIntCoalesceCxt
operator|=
name|agNULL
expr_stmt|;
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|.
name|id
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|TD_MAX_INT_COALESCE
condition|;
name|i
operator|++
control|)
block|{
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
name|i
index|]
operator|.
name|FreeLink
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
name|i
index|]
operator|.
name|MainLink
operator|)
argument_list|)
expr_stmt|;
name|tdsaIntCoalCxt
index|[
name|i
index|]
operator|.
name|tdsaAllShared
operator|=
name|tdsaAllShared
expr_stmt|;
name|tdsaIntCoalCxt
index|[
name|i
index|]
operator|.
name|tiIntCoalesceCxt
operator|=
name|agNULL
expr_stmt|;
name|tdsaIntCoalCxt
index|[
name|i
index|]
operator|.
name|id
operator|=
name|i
expr_stmt|;
comment|/* enqueue */
name|TDLIST_ENQUEUE_AT_TAIL
argument_list|(
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
name|i
index|]
operator|.
name|FreeLink
operator|)
argument_list|,
operator|&
operator|(
name|tdsaIntCoalCxt
index|[
literal|0
index|]
operator|.
name|FreeLink
operator|)
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TD_INT_COALESCE */
end_comment

begin_function
name|osGLOBAL
name|void
name|tdsaExpanderInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
name|tdsaExpander_t
modifier|*
name|tdsaExpander
init|=
operator|(
name|tdsaExpander_t
operator|*
operator|)
name|tdsaAllShared
operator|->
name|ExpanderHead
decl_stmt|;
name|bit32
name|MaxTargets
decl_stmt|;
name|int
name|i
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaExpanderInit: start\n"
operator|)
argument_list|)
expr_stmt|;
name|tdssGetMaxTargetsParams
argument_list|(
name|tiRoot
argument_list|,
operator|&
name|MaxTargets
argument_list|)
expr_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdsaExpanderInit: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
comment|//  TDLIST_INIT_HDR(&(tdsaAllShared->discoveringExpanderList));
name|TDLIST_INIT_HDR
argument_list|(
operator|&
operator|(
name|tdsaAllShared
operator|->
name|freeExpanderList
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|int
operator|)
name|MaxTargets
condition|;
name|i
operator|++
control|)
block|{
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|linkNode
operator|)
argument_list|)
expr_stmt|;
name|TDLIST_INIT_ELEMENT
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|upNode
operator|)
argument_list|)
expr_stmt|;
comment|/* initialize expander fields */
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|tdDevice
operator|=
name|agNULL
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|tdUpStreamExpander
operator|=
name|agNULL
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|tdDeviceToProcess
operator|=
name|agNULL
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|tdCurrentDownStreamExpander
operator|=
name|agNULL
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|hasUpStreamDevice
operator|=
name|agFALSE
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|numOfUpStreamPhys
operator|=
literal|0
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|currentUpStreamPhyIndex
operator|=
literal|0
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|numOfDownStreamPhys
operator|=
literal|0
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|currentDownStreamPhyIndex
operator|=
literal|0
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|discoveringPhyId
operator|=
literal|0
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|underDiscovering
operator|=
name|agFALSE
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|id
operator|=
name|i
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|tdReturnginExpander
operator|=
name|agNULL
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|discoverSMPAllowed
operator|=
name|agTRUE
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|currentIndex
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|currentIndex
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|upStreamPhys
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|upStreamPhys
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|downStreamPhys
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|downStreamPhys
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|routingAttribute
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|routingAttribute
argument_list|)
argument_list|)
expr_stmt|;
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|configSASAddrTableIndex
operator|=
literal|0
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|configSASAddressHiTable
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|configSASAddressHiTable
argument_list|)
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|configSASAddressLoTable
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|configSASAddressLoTable
argument_list|)
argument_list|)
expr_stmt|;
name|TDLIST_ENQUEUE_AT_TAIL
argument_list|(
operator|&
operator|(
name|tdsaExpander
index|[
name|i
index|]
operator|.
name|linkNode
operator|)
argument_list|,
operator|&
operator|(
name|tdsaAllShared
operator|->
name|freeExpanderList
operator|)
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_function
name|osGLOBAL
name|void
name|tdsaQueueConfigInit
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|)
block|{
name|tdsaRoot_t
modifier|*
name|tdsaRoot
init|=
operator|(
name|tdsaRoot_t
operator|*
operator|)
name|tiRoot
operator|->
name|tdData
decl_stmt|;
name|tdsaContext_t
modifier|*
name|tdsaAllShared
init|=
operator|(
name|tdsaContext_t
operator|*
operator|)
operator|&
name|tdsaRoot
operator|->
name|tdsaAllShared
decl_stmt|;
comment|/* for memory index requirement */
name|agsaQueueConfig_t
modifier|*
name|QueueConfig
decl_stmt|;
name|bit32
name|i
decl_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdsaQueueConfigInit: start\n"
operator|)
argument_list|)
expr_stmt|;
name|tdsaGetSwConfigParams
argument_list|(
name|tiRoot
argument_list|)
expr_stmt|;
name|QueueConfig
operator|=
operator|&
name|tdsaAllShared
operator|->
name|QueueConfig
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|->
name|numInboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|->
name|inboundQueues
index|[
name|i
index|]
operator|.
name|elementCount
operator|=
name|tdsaAllShared
operator|->
name|InboundQueueSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|->
name|inboundQueues
index|[
name|i
index|]
operator|.
name|elementSize
operator|=
name|tdsaAllShared
operator|->
name|InboundQueueEleSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|->
name|inboundQueues
index|[
name|i
index|]
operator|.
name|priority
operator|=
name|tdsaAllShared
operator|->
name|InboundQueuePriority
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|->
name|inboundQueues
index|[
name|i
index|]
operator|.
name|reserved
operator|=
literal|0
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QueueConfig
operator|->
name|numOutboundQueues
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|->
name|outboundQueues
index|[
name|i
index|]
operator|.
name|elementCount
operator|=
name|tdsaAllShared
operator|->
name|OutboundQueueSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|->
name|outboundQueues
index|[
name|i
index|]
operator|.
name|elementSize
operator|=
name|tdsaAllShared
operator|->
name|OutboundQueueEleSize
index|[
name|i
index|]
expr_stmt|;
name|QueueConfig
operator|->
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptDelay
operator|=
name|tdsaAllShared
operator|->
name|OutboundQueueInterruptDelay
index|[
name|i
index|]
expr_stmt|;
comment|/* default 0; no interrupt delay */
name|QueueConfig
operator|->
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptCount
operator|=
name|tdsaAllShared
operator|->
name|OutboundQueueInterruptCount
index|[
name|i
index|]
expr_stmt|;
comment|/* default 1*/
name|QueueConfig
operator|->
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptEnable
operator|=
name|tdsaAllShared
operator|->
name|OutboundQueueInterruptEnable
index|[
name|i
index|]
expr_stmt|;
comment|/* default 1*/
name|QueueConfig
operator|->
name|outboundQueues
index|[
name|i
index|]
operator|.
name|interruptVectorIndex
operator|=
literal|0
expr_stmt|;
block|}
comment|/*  default  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|->
name|sasHwEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|->
name|sataNCQErrorEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TARGET_DRIVER
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|QueueConfig
operator|->
name|tgtITNexusEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|->
name|tgtSSPEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|->
name|tgtSMPEventQueue
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
name|QueueConfig
operator|->
name|iqNormalPriorityProcessingDepth
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|->
name|iqHighPriorityProcessingDepth
operator|=
literal|0
expr_stmt|;
name|QueueConfig
operator|->
name|generalEventQueue
operator|=
literal|0
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/***************************************************************************** *! \brief  tdssGetMaxTargetsParams * *  Purpose: This function is called to get default parameters from the  *           OS Specific area. This function is called in the context of  *           tiCOMGetResource() and tiCOMInit(). * * *  \param  tiRoot:   Pointer to initiator driver/port instance. *  \param  option:   Pointer to bit32 where the max target number is saved * *  \return: None * *  \note - * *****************************************************************************/
end_comment

begin_function
name|osGLOBAL
name|void
name|tdssGetMaxTargetsParams
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|bit32
modifier|*
name|pMaxTargets
parameter_list|)
block|{
name|char
modifier|*
name|key
init|=
name|agNULL
decl_stmt|;
name|char
modifier|*
name|subkey1
init|=
name|agNULL
decl_stmt|;
name|char
modifier|*
name|subkey2
init|=
name|agNULL
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|bit32
name|buffLen
decl_stmt|;
name|bit32
name|lenRecv
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|pLastUsedChar
init|=
name|agNULL
decl_stmt|;
name|char
name|tmpBuffer
index|[
name|DEFAULT_KEY_BUFFER_SIZE
index|]
decl_stmt|;
name|char
name|globalStr
index|[]
init|=
literal|"Global"
decl_stmt|;
name|char
name|iniParmsStr
index|[]
init|=
literal|"InitiatorParms"
decl_stmt|;
name|bit32
name|MaxTargets
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdssGetMaxTargetsParams: start\n"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pMaxTargets
operator|=
name|DEFAULT_MAX_DEV
expr_stmt|;
comment|/* to remove compiler warnings */
name|pLastUsedChar
operator|=
name|pLastUsedChar
expr_stmt|;
name|lenRecv
operator|=
name|lenRecv
expr_stmt|;
name|subkey2
operator|=
name|subkey2
expr_stmt|;
name|subkey1
operator|=
name|subkey1
expr_stmt|;
name|key
operator|=
name|key
expr_stmt|;
name|buffer
operator|=
operator|&
name|tmpBuffer
index|[
literal|0
index|]
expr_stmt|;
name|buffLen
operator|=
sizeof|sizeof
argument_list|(
name|tmpBuffer
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
comment|/* defaults are overwritten in the following */
comment|/* Get MaxTargets */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
name|iniParmsStr
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
literal|"MaxTargets"
argument_list|,
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|MaxTargets
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|MaxTargets
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
operator|*
name|pMaxTargets
operator|=
name|MaxTargets
expr_stmt|;
name|TI_DBG2
argument_list|(
operator|(
literal|"tdssGetMaxTargetsParams: MaxTargets %d\n"
operator|,
name|MaxTargets
operator|)
argument_list|)
expr_stmt|;
block|}
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* temporary to distinguish SAS and SATA mode  */
end_comment

begin_function
name|osGLOBAL
name|void
name|tdssGetSATAOnlyModeParams
parameter_list|(
name|tiRoot_t
modifier|*
name|tiRoot
parameter_list|,
name|bit32
modifier|*
name|pSATAOnlyMode
parameter_list|)
block|{
name|char
modifier|*
name|key
init|=
name|agNULL
decl_stmt|;
name|char
modifier|*
name|subkey1
init|=
name|agNULL
decl_stmt|;
name|char
modifier|*
name|subkey2
init|=
name|agNULL
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|bit32
name|buffLen
decl_stmt|;
name|bit32
name|lenRecv
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|pLastUsedChar
init|=
name|agNULL
decl_stmt|;
name|char
name|tmpBuffer
index|[
name|DEFAULT_KEY_BUFFER_SIZE
index|]
decl_stmt|;
name|char
name|globalStr
index|[]
init|=
literal|"Global"
decl_stmt|;
name|char
name|iniParmsStr
index|[]
init|=
literal|"InitiatorParms"
decl_stmt|;
name|bit32
name|SATAOnlyMode
decl_stmt|;
name|TI_DBG6
argument_list|(
operator|(
literal|"tdssGetSATAOnlyModeParams: start\n"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pSATAOnlyMode
operator|=
name|agFALSE
expr_stmt|;
comment|/* default SAS and SATA */
comment|/* to remove compiler warnings */
name|pLastUsedChar
operator|=
name|pLastUsedChar
expr_stmt|;
name|lenRecv
operator|=
name|lenRecv
expr_stmt|;
name|subkey2
operator|=
name|subkey2
expr_stmt|;
name|subkey1
operator|=
name|subkey1
expr_stmt|;
name|key
operator|=
name|key
expr_stmt|;
name|buffer
operator|=
operator|&
name|tmpBuffer
index|[
literal|0
index|]
expr_stmt|;
name|buffLen
operator|=
sizeof|sizeof
argument_list|(
name|tmpBuffer
argument_list|)
expr_stmt|;
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
comment|/* defaults are overwritten in the following */
comment|/* Get SATAOnlyMode */
if|if
condition|(
operator|(
name|ostiGetTransportParam
argument_list|(
name|tiRoot
argument_list|,
name|globalStr
argument_list|,
name|iniParmsStr
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
name|agNULL
argument_list|,
literal|"SATAOnlyMode"
argument_list|,
name|buffer
argument_list|,
name|buffLen
argument_list|,
operator|&
name|lenRecv
argument_list|)
operator|==
name|tiSuccess
operator|)
operator|&&
operator|(
name|lenRecv
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|osti_strncmp
argument_list|(
name|buffer
argument_list|,
literal|"0x"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|SATAOnlyMode
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SATAOnlyMode
operator|=
name|osti_strtoul
argument_list|(
name|buffer
argument_list|,
operator|&
name|pLastUsedChar
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
operator|*
name|pSATAOnlyMode
operator|=
name|SATAOnlyMode
expr_stmt|;
block|}
name|osti_memset
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|,
name|buffLen
argument_list|)
expr_stmt|;
name|lenRecv
operator|=
literal|0
expr_stmt|;
return|return;
block|}
end_function

end_unit

