begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  * Copyright 2008 (c) Intel Corporation  *   Jesse Barnes<jbarnes@virtuousgeek.org>  *  * Permission is hereby granted, free of charge, to any person obtaining a  * copy of this software and associated documentation files (the  * "Software"), to deal in the Software without restriction, including  * without limitation the rights to use, copy, modify, merge, publish,  * distribute, sub license, and/or sell copies of the Software, and to  * permit persons to whom the Software is furnished to do so, subject to  * the following conditions:  *  * The above copyright notice and this permission notice (including the  * next paragraph) shall be included in all copies or substantial portions  * of the Software.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS  * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT.  * IN NO EVENT SHALL TUNGSTEN GRAPHICS AND/OR ITS SUPPLIERS BE LIABLE FOR  * ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,  * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE  * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/drm2/drmP.h>
end_include

begin_include
include|#
directive|include
file|<dev/drm2/drm.h>
end_include

begin_include
include|#
directive|include
file|<dev/drm2/i915/i915_drm.h>
end_include

begin_include
include|#
directive|include
file|<dev/drm2/i915/intel_drv.h>
end_include

begin_function
specifier|static
name|bool
name|i915_pipe_enabled
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|enum
name|pipe
name|pipe
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|u32
name|dpll_reg
decl_stmt|;
comment|/* On IVB, 3rd pipe shares PLL with another one */
if|if
condition|(
name|pipe
operator|>
literal|1
condition|)
return|return
name|false
return|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dpll_reg
operator|=
name|_PCH_DPLL
argument_list|(
name|pipe
argument_list|)
expr_stmt|;
else|else
name|dpll_reg
operator|=
operator|(
name|pipe
operator|==
name|PIPE_A
operator|)
condition|?
name|_DPLL_A
else|:
name|_DPLL_B
expr_stmt|;
return|return
operator|(
name|I915_READ
argument_list|(
name|dpll_reg
argument_list|)
operator|&
name|DPLL_VCO_ENABLE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_save_palette
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|enum
name|pipe
name|pipe
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|unsigned
name|long
name|reg
init|=
operator|(
name|pipe
operator|==
name|PIPE_A
condition|?
name|_PALETTE_A
else|:
name|_PALETTE_B
operator|)
decl_stmt|;
name|u32
modifier|*
name|array
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|i915_pipe_enabled
argument_list|(
name|dev
argument_list|,
name|pipe
argument_list|)
condition|)
return|return;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|reg
operator|=
operator|(
name|pipe
operator|==
name|PIPE_A
operator|)
condition|?
name|_LGC_PALETTE_A
else|:
name|_LGC_PALETTE_B
expr_stmt|;
if|if
condition|(
name|pipe
operator|==
name|PIPE_A
condition|)
name|array
operator|=
name|dev_priv
operator|->
name|save_palette_a
expr_stmt|;
else|else
name|array
operator|=
name|dev_priv
operator|->
name|save_palette_b
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
name|array
index|[
name|i
index|]
operator|=
name|I915_READ
argument_list|(
name|reg
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_restore_palette
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|enum
name|pipe
name|pipe
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|unsigned
name|long
name|reg
init|=
operator|(
name|pipe
operator|==
name|PIPE_A
condition|?
name|_PALETTE_A
else|:
name|_PALETTE_B
operator|)
decl_stmt|;
name|u32
modifier|*
name|array
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|i915_pipe_enabled
argument_list|(
name|dev
argument_list|,
name|pipe
argument_list|)
condition|)
return|return;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|reg
operator|=
operator|(
name|pipe
operator|==
name|PIPE_A
operator|)
condition|?
name|_LGC_PALETTE_A
else|:
name|_LGC_PALETTE_B
expr_stmt|;
if|if
condition|(
name|pipe
operator|==
name|PIPE_A
condition|)
name|array
operator|=
name|dev_priv
operator|->
name|save_palette_a
expr_stmt|;
else|else
name|array
operator|=
name|dev_priv
operator|->
name|save_palette_b
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
name|I915_WRITE
argument_list|(
name|reg
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|,
name|array
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|u8
name|i915_read_indexed
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|u16
name|index_port
parameter_list|,
name|u16
name|data_port
parameter_list|,
name|u8
name|reg
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|I915_WRITE8
argument_list|(
name|index_port
argument_list|,
name|reg
argument_list|)
expr_stmt|;
return|return
name|I915_READ8
argument_list|(
name|data_port
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|u8
name|i915_read_ar
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|u16
name|st01
parameter_list|,
name|u8
name|reg
parameter_list|,
name|u16
name|palette_enable
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
name|I915_WRITE8
argument_list|(
name|VGA_AR_INDEX
argument_list|,
name|palette_enable
operator||
name|reg
argument_list|)
expr_stmt|;
return|return
name|I915_READ8
argument_list|(
name|VGA_AR_DATA_READ
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_write_ar
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|u16
name|st01
parameter_list|,
name|u8
name|reg
parameter_list|,
name|u8
name|val
parameter_list|,
name|u16
name|palette_enable
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
name|I915_WRITE8
argument_list|(
name|VGA_AR_INDEX
argument_list|,
name|palette_enable
operator||
name|reg
argument_list|)
expr_stmt|;
name|I915_WRITE8
argument_list|(
name|VGA_AR_DATA_WRITE
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_write_indexed
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|u16
name|index_port
parameter_list|,
name|u16
name|data_port
parameter_list|,
name|u8
name|reg
parameter_list|,
name|u8
name|val
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|I915_WRITE8
argument_list|(
name|index_port
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|I915_WRITE8
argument_list|(
name|data_port
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_save_vga
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|i
decl_stmt|;
name|u16
name|cr_index
decl_stmt|,
name|cr_data
decl_stmt|,
name|st01
decl_stmt|;
comment|/* VGA color palette registers */
name|dev_priv
operator|->
name|saveDACMASK
operator|=
name|I915_READ8
argument_list|(
name|VGA_DACMASK
argument_list|)
expr_stmt|;
comment|/* MSR bits */
name|dev_priv
operator|->
name|saveMSR
operator|=
name|I915_READ8
argument_list|(
name|VGA_MSR_READ
argument_list|)
expr_stmt|;
if|if
condition|(
name|dev_priv
operator|->
name|saveMSR
operator|&
name|VGA_MSR_CGA_MODE
condition|)
block|{
name|cr_index
operator|=
name|VGA_CR_INDEX_CGA
expr_stmt|;
name|cr_data
operator|=
name|VGA_CR_DATA_CGA
expr_stmt|;
name|st01
operator|=
name|VGA_ST01_CGA
expr_stmt|;
block|}
else|else
block|{
name|cr_index
operator|=
name|VGA_CR_INDEX_MDA
expr_stmt|;
name|cr_data
operator|=
name|VGA_CR_DATA_MDA
expr_stmt|;
name|st01
operator|=
name|VGA_ST01_MDA
expr_stmt|;
block|}
comment|/* CRT controller regs */
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|cr_index
argument_list|,
name|cr_data
argument_list|,
literal|0x11
argument_list|,
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|cr_index
argument_list|,
name|cr_data
argument_list|,
literal|0x11
argument_list|)
operator|&
operator|(
operator|~
literal|0x80
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|0x24
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveCR
index|[
name|i
index|]
operator|=
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|cr_index
argument_list|,
name|cr_data
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|/* Make sure we don't turn off CR group 0 writes */
name|dev_priv
operator|->
name|saveCR
index|[
literal|0x11
index|]
operator|&=
operator|~
literal|0x80
expr_stmt|;
comment|/* Attribute controller registers */
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveAR_INDEX
operator|=
name|I915_READ8
argument_list|(
name|VGA_AR_INDEX
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|0x14
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveAR
index|[
name|i
index|]
operator|=
name|i915_read_ar
argument_list|(
name|dev
argument_list|,
name|st01
argument_list|,
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
name|I915_WRITE8
argument_list|(
name|VGA_AR_INDEX
argument_list|,
name|dev_priv
operator|->
name|saveAR_INDEX
argument_list|)
expr_stmt|;
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
comment|/* Graphics controller registers */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|9
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveGR
index|[
name|i
index|]
operator|=
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveGR
index|[
literal|0x10
index|]
operator|=
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
literal|0x10
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveGR
index|[
literal|0x11
index|]
operator|=
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
literal|0x11
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveGR
index|[
literal|0x18
index|]
operator|=
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
literal|0x18
argument_list|)
expr_stmt|;
comment|/* Sequencer registers */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveSR
index|[
name|i
index|]
operator|=
name|i915_read_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_SR_INDEX
argument_list|,
name|VGA_SR_DATA
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_restore_vga
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|i
decl_stmt|;
name|u16
name|cr_index
decl_stmt|,
name|cr_data
decl_stmt|,
name|st01
decl_stmt|;
comment|/* MSR bits */
name|I915_WRITE8
argument_list|(
name|VGA_MSR_WRITE
argument_list|,
name|dev_priv
operator|->
name|saveMSR
argument_list|)
expr_stmt|;
if|if
condition|(
name|dev_priv
operator|->
name|saveMSR
operator|&
name|VGA_MSR_CGA_MODE
condition|)
block|{
name|cr_index
operator|=
name|VGA_CR_INDEX_CGA
expr_stmt|;
name|cr_data
operator|=
name|VGA_CR_DATA_CGA
expr_stmt|;
name|st01
operator|=
name|VGA_ST01_CGA
expr_stmt|;
block|}
else|else
block|{
name|cr_index
operator|=
name|VGA_CR_INDEX_MDA
expr_stmt|;
name|cr_data
operator|=
name|VGA_CR_DATA_MDA
expr_stmt|;
name|st01
operator|=
name|VGA_ST01_MDA
expr_stmt|;
block|}
comment|/* Sequencer registers, don't write SR07 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|7
condition|;
name|i
operator|++
control|)
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_SR_INDEX
argument_list|,
name|VGA_SR_DATA
argument_list|,
name|i
argument_list|,
name|dev_priv
operator|->
name|saveSR
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* CRT controller regs */
comment|/* Enable CR group 0 writes */
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|cr_index
argument_list|,
name|cr_data
argument_list|,
literal|0x11
argument_list|,
name|dev_priv
operator|->
name|saveCR
index|[
literal|0x11
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|0x24
condition|;
name|i
operator|++
control|)
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|cr_index
argument_list|,
name|cr_data
argument_list|,
name|i
argument_list|,
name|dev_priv
operator|->
name|saveCR
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* Graphics controller regs */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|9
condition|;
name|i
operator|++
control|)
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
name|i
argument_list|,
name|dev_priv
operator|->
name|saveGR
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
literal|0x10
argument_list|,
name|dev_priv
operator|->
name|saveGR
index|[
literal|0x10
index|]
argument_list|)
expr_stmt|;
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
literal|0x11
argument_list|,
name|dev_priv
operator|->
name|saveGR
index|[
literal|0x11
index|]
argument_list|)
expr_stmt|;
name|i915_write_indexed
argument_list|(
name|dev
argument_list|,
name|VGA_GR_INDEX
argument_list|,
name|VGA_GR_DATA
argument_list|,
literal|0x18
argument_list|,
name|dev_priv
operator|->
name|saveGR
index|[
literal|0x18
index|]
argument_list|)
expr_stmt|;
comment|/* Attribute controller registers */
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
comment|/* switch back to index mode */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|0x14
condition|;
name|i
operator|++
control|)
name|i915_write_ar
argument_list|(
name|dev
argument_list|,
name|st01
argument_list|,
name|i
argument_list|,
name|dev_priv
operator|->
name|saveAR
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
comment|/* switch back to index mode */
name|I915_WRITE8
argument_list|(
name|VGA_AR_INDEX
argument_list|,
name|dev_priv
operator|->
name|saveAR_INDEX
operator||
literal|0x20
argument_list|)
expr_stmt|;
name|I915_READ8
argument_list|(
name|st01
argument_list|)
expr_stmt|;
comment|/* VGA color palette registers */
name|I915_WRITE8
argument_list|(
name|VGA_DACMASK
argument_list|,
name|dev_priv
operator|->
name|saveDACMASK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_save_modeset_reg
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|drm_core_check_feature
argument_list|(
name|dev
argument_list|,
name|DRIVER_MODESET
argument_list|)
condition|)
return|return;
comment|/* Cursor state */
name|dev_priv
operator|->
name|saveCURACNTR
operator|=
name|I915_READ
argument_list|(
name|_CURACNTR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveCURAPOS
operator|=
name|I915_READ
argument_list|(
name|_CURAPOS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveCURABASE
operator|=
name|I915_READ
argument_list|(
name|_CURABASE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveCURBCNTR
operator|=
name|I915_READ
argument_list|(
name|_CURBCNTR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveCURBPOS
operator|=
name|I915_READ
argument_list|(
name|_CURBPOS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveCURBBASE
operator|=
name|I915_READ
argument_list|(
name|_CURBBASE
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_GEN2
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveCURSIZE
operator|=
name|I915_READ
argument_list|(
name|CURSIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|savePCH_DREF_CONTROL
operator|=
name|I915_READ
argument_list|(
name|PCH_DREF_CONTROL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDISP_ARB_CTL
operator|=
name|I915_READ
argument_list|(
name|DISP_ARB_CTL
argument_list|)
expr_stmt|;
block|}
comment|/* Pipe& plane A info */
name|dev_priv
operator|->
name|savePIPEACONF
operator|=
name|I915_READ
argument_list|(
name|_PIPEACONF
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEASRC
operator|=
name|I915_READ
argument_list|(
name|_PIPEASRC
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveFPA0
operator|=
name|I915_READ
argument_list|(
name|_PCH_FPA0
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFPA1
operator|=
name|I915_READ
argument_list|(
name|_PCH_FPA1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDPLL_A
operator|=
name|I915_READ
argument_list|(
name|_PCH_DPLL_A
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|saveFPA0
operator|=
name|I915_READ
argument_list|(
name|_FPA0
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFPA1
operator|=
name|I915_READ
argument_list|(
name|_FPA1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDPLL_A
operator|=
name|I915_READ
argument_list|(
name|_DPLL_A
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveDPLL_A_MD
operator|=
name|I915_READ
argument_list|(
name|_DPLL_A_MD
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveHTOTAL_A
operator|=
name|I915_READ
argument_list|(
name|_HTOTAL_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveHBLANK_A
operator|=
name|I915_READ
argument_list|(
name|_HBLANK_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveHSYNC_A
operator|=
name|I915_READ
argument_list|(
name|_HSYNC_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVTOTAL_A
operator|=
name|I915_READ
argument_list|(
name|_VTOTAL_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVBLANK_A
operator|=
name|I915_READ
argument_list|(
name|_VBLANK_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVSYNC_A
operator|=
name|I915_READ
argument_list|(
name|_VSYNC_A
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveBCLRPAT_A
operator|=
name|I915_READ
argument_list|(
name|_BCLRPAT_A
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|savePIPEA_DATA_M1
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_DATA_M1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_DATA_N1
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_DATA_N1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_LINK_M1
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_LINK_M1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_LINK_N1
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_LINK_N1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFDI_TXA_CTL
operator|=
name|I915_READ
argument_list|(
name|_FDI_TXA_CTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFDI_RXA_CTL
operator|=
name|I915_READ
argument_list|(
name|_FDI_RXA_CTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFA_CTL_1
operator|=
name|I915_READ
argument_list|(
name|_PFA_CTL_1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFA_WIN_SZ
operator|=
name|I915_READ
argument_list|(
name|_PFA_WIN_SZ
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFA_WIN_POS
operator|=
name|I915_READ
argument_list|(
name|_PFA_WIN_POS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANSACONF
operator|=
name|I915_READ
argument_list|(
name|_TRANSACONF
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_HTOTAL_A
operator|=
name|I915_READ
argument_list|(
name|_TRANS_HTOTAL_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_HBLANK_A
operator|=
name|I915_READ
argument_list|(
name|_TRANS_HBLANK_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_HSYNC_A
operator|=
name|I915_READ
argument_list|(
name|_TRANS_HSYNC_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_VTOTAL_A
operator|=
name|I915_READ
argument_list|(
name|_TRANS_VTOTAL_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_VBLANK_A
operator|=
name|I915_READ
argument_list|(
name|_TRANS_VBLANK_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_VSYNC_A
operator|=
name|I915_READ
argument_list|(
name|_TRANS_VSYNC_A
argument_list|)
expr_stmt|;
block|}
name|dev_priv
operator|->
name|saveDSPACNTR
operator|=
name|I915_READ
argument_list|(
name|_DSPACNTR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPASTRIDE
operator|=
name|I915_READ
argument_list|(
name|_DSPASTRIDE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPASIZE
operator|=
name|I915_READ
argument_list|(
name|_DSPASIZE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPAPOS
operator|=
name|I915_READ
argument_list|(
name|_DSPAPOS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPAADDR
operator|=
name|I915_READ
argument_list|(
name|_DSPAADDR
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
condition|)
block|{
name|dev_priv
operator|->
name|saveDSPASURF
operator|=
name|I915_READ
argument_list|(
name|_DSPASURF
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPATILEOFF
operator|=
name|I915_READ
argument_list|(
name|_DSPATILEOFF
argument_list|)
expr_stmt|;
block|}
name|i915_save_palette
argument_list|(
name|dev
argument_list|,
name|PIPE_A
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEASTAT
operator|=
name|I915_READ
argument_list|(
name|_PIPEASTAT
argument_list|)
expr_stmt|;
comment|/* Pipe& plane B info */
name|dev_priv
operator|->
name|savePIPEBCONF
operator|=
name|I915_READ
argument_list|(
name|_PIPEBCONF
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEBSRC
operator|=
name|I915_READ
argument_list|(
name|_PIPEBSRC
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveFPB0
operator|=
name|I915_READ
argument_list|(
name|_PCH_FPB0
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFPB1
operator|=
name|I915_READ
argument_list|(
name|_PCH_FPB1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDPLL_B
operator|=
name|I915_READ
argument_list|(
name|_PCH_DPLL_B
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|saveFPB0
operator|=
name|I915_READ
argument_list|(
name|_FPB0
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFPB1
operator|=
name|I915_READ
argument_list|(
name|_FPB1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDPLL_B
operator|=
name|I915_READ
argument_list|(
name|_DPLL_B
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveDPLL_B_MD
operator|=
name|I915_READ
argument_list|(
name|_DPLL_B_MD
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveHTOTAL_B
operator|=
name|I915_READ
argument_list|(
name|_HTOTAL_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveHBLANK_B
operator|=
name|I915_READ
argument_list|(
name|_HBLANK_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveHSYNC_B
operator|=
name|I915_READ
argument_list|(
name|_HSYNC_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVTOTAL_B
operator|=
name|I915_READ
argument_list|(
name|_VTOTAL_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVBLANK_B
operator|=
name|I915_READ
argument_list|(
name|_VBLANK_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVSYNC_B
operator|=
name|I915_READ
argument_list|(
name|_VSYNC_B
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveBCLRPAT_B
operator|=
name|I915_READ
argument_list|(
name|_BCLRPAT_B
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|savePIPEB_DATA_M1
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_DATA_M1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_DATA_N1
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_DATA_N1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_LINK_M1
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_LINK_M1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_LINK_N1
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_LINK_N1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFDI_TXB_CTL
operator|=
name|I915_READ
argument_list|(
name|_FDI_TXB_CTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFDI_RXB_CTL
operator|=
name|I915_READ
argument_list|(
name|_FDI_RXB_CTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFB_CTL_1
operator|=
name|I915_READ
argument_list|(
name|_PFB_CTL_1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFB_WIN_SZ
operator|=
name|I915_READ
argument_list|(
name|_PFB_WIN_SZ
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFB_WIN_POS
operator|=
name|I915_READ
argument_list|(
name|_PFB_WIN_POS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANSBCONF
operator|=
name|I915_READ
argument_list|(
name|_TRANSBCONF
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_HTOTAL_B
operator|=
name|I915_READ
argument_list|(
name|_TRANS_HTOTAL_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_HBLANK_B
operator|=
name|I915_READ
argument_list|(
name|_TRANS_HBLANK_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_HSYNC_B
operator|=
name|I915_READ
argument_list|(
name|_TRANS_HSYNC_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_VTOTAL_B
operator|=
name|I915_READ
argument_list|(
name|_TRANS_VTOTAL_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_VBLANK_B
operator|=
name|I915_READ
argument_list|(
name|_TRANS_VBLANK_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveTRANS_VSYNC_B
operator|=
name|I915_READ
argument_list|(
name|_TRANS_VSYNC_B
argument_list|)
expr_stmt|;
block|}
name|dev_priv
operator|->
name|saveDSPBCNTR
operator|=
name|I915_READ
argument_list|(
name|_DSPBCNTR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPBSTRIDE
operator|=
name|I915_READ
argument_list|(
name|_DSPBSTRIDE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPBSIZE
operator|=
name|I915_READ
argument_list|(
name|_DSPBSIZE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPBPOS
operator|=
name|I915_READ
argument_list|(
name|_DSPBPOS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPBADDR
operator|=
name|I915_READ
argument_list|(
name|_DSPBADDR
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
condition|)
block|{
name|dev_priv
operator|->
name|saveDSPBSURF
operator|=
name|I915_READ
argument_list|(
name|_DSPBSURF
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDSPBTILEOFF
operator|=
name|I915_READ
argument_list|(
name|_DSPBTILEOFF
argument_list|)
expr_stmt|;
block|}
name|i915_save_palette
argument_list|(
name|dev
argument_list|,
name|PIPE_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEBSTAT
operator|=
name|I915_READ
argument_list|(
name|_PIPEBSTAT
argument_list|)
expr_stmt|;
comment|/* Fences */
switch|switch
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
condition|)
block|{
case|case
literal|7
case|:
case|case
literal|6
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
index|]
operator|=
name|I915_READ64
argument_list|(
name|FENCE_REG_SANDYBRIDGE_0
operator|+
operator|(
name|i
operator|*
literal|8
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
case|case
literal|4
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
index|]
operator|=
name|I915_READ64
argument_list|(
name|FENCE_REG_965_0
operator|+
operator|(
name|i
operator|*
literal|8
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|IS_I945G
argument_list|(
name|dev
argument_list|)
operator|||
name|IS_I945GM
argument_list|(
name|dev
argument_list|)
operator|||
name|IS_G33
argument_list|(
name|dev
argument_list|)
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
operator|+
literal|8
index|]
operator|=
name|I915_READ
argument_list|(
name|FENCE_REG_945_8
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
case|case
literal|2
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
index|]
operator|=
name|I915_READ
argument_list|(
name|FENCE_REG_830_0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_restore_modeset_reg
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|dpll_a_reg
decl_stmt|,
name|fpa0_reg
decl_stmt|,
name|fpa1_reg
decl_stmt|;
name|int
name|dpll_b_reg
decl_stmt|,
name|fpb0_reg
decl_stmt|,
name|fpb1_reg
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|drm_core_check_feature
argument_list|(
name|dev
argument_list|,
name|DRIVER_MODESET
argument_list|)
condition|)
return|return;
comment|/* Fences */
switch|switch
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
condition|)
block|{
case|case
literal|7
case|:
case|case
literal|6
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
name|I915_WRITE64
argument_list|(
name|FENCE_REG_SANDYBRIDGE_0
operator|+
operator|(
name|i
operator|*
literal|8
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
case|case
literal|4
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
name|I915_WRITE64
argument_list|(
name|FENCE_REG_965_0
operator|+
operator|(
name|i
operator|*
literal|8
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
case|case
literal|2
case|:
if|if
condition|(
name|IS_I945G
argument_list|(
name|dev
argument_list|)
operator|||
name|IS_I945GM
argument_list|(
name|dev
argument_list|)
operator|||
name|IS_G33
argument_list|(
name|dev
argument_list|)
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|I915_WRITE
argument_list|(
name|FENCE_REG_945_8
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
operator|+
literal|8
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|I915_WRITE
argument_list|(
name|FENCE_REG_830_0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveFENCE
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dpll_a_reg
operator|=
name|_PCH_DPLL_A
expr_stmt|;
name|dpll_b_reg
operator|=
name|_PCH_DPLL_B
expr_stmt|;
name|fpa0_reg
operator|=
name|_PCH_FPA0
expr_stmt|;
name|fpb0_reg
operator|=
name|_PCH_FPB0
expr_stmt|;
name|fpa1_reg
operator|=
name|_PCH_FPA1
expr_stmt|;
name|fpb1_reg
operator|=
name|_PCH_FPB1
expr_stmt|;
block|}
else|else
block|{
name|dpll_a_reg
operator|=
name|_DPLL_A
expr_stmt|;
name|dpll_b_reg
operator|=
name|_DPLL_B
expr_stmt|;
name|fpa0_reg
operator|=
name|_FPA0
expr_stmt|;
name|fpb0_reg
operator|=
name|_FPB0
expr_stmt|;
name|fpa1_reg
operator|=
name|_FPA1
expr_stmt|;
name|fpb1_reg
operator|=
name|_FPB1
expr_stmt|;
block|}
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|PCH_DREF_CONTROL
argument_list|,
name|dev_priv
operator|->
name|savePCH_DREF_CONTROL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|DISP_ARB_CTL
argument_list|,
name|dev_priv
operator|->
name|saveDISP_ARB_CTL
argument_list|)
expr_stmt|;
block|}
comment|/* Pipe& plane A info */
comment|/* Prime the clock */
if|if
condition|(
name|dev_priv
operator|->
name|saveDPLL_A
operator|&
name|DPLL_VCO_ENABLE
condition|)
block|{
name|I915_WRITE
argument_list|(
name|dpll_a_reg
argument_list|,
name|dev_priv
operator|->
name|saveDPLL_A
operator|&
operator|~
name|DPLL_VCO_ENABLE
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|dpll_a_reg
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
block|}
name|I915_WRITE
argument_list|(
name|fpa0_reg
argument_list|,
name|dev_priv
operator|->
name|saveFPA0
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|fpa1_reg
argument_list|,
name|dev_priv
operator|->
name|saveFPA1
argument_list|)
expr_stmt|;
comment|/* Actually enable it */
name|I915_WRITE
argument_list|(
name|dpll_a_reg
argument_list|,
name|dev_priv
operator|->
name|saveDPLL_A
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|dpll_a_reg
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_DPLL_A_MD
argument_list|,
name|dev_priv
operator|->
name|saveDPLL_A_MD
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|_DPLL_A_MD
argument_list|)
expr_stmt|;
block|}
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
comment|/* Restore mode */
name|I915_WRITE
argument_list|(
name|_HTOTAL_A
argument_list|,
name|dev_priv
operator|->
name|saveHTOTAL_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_HBLANK_A
argument_list|,
name|dev_priv
operator|->
name|saveHBLANK_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_HSYNC_A
argument_list|,
name|dev_priv
operator|->
name|saveHSYNC_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_VTOTAL_A
argument_list|,
name|dev_priv
operator|->
name|saveVTOTAL_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_VBLANK_A
argument_list|,
name|dev_priv
operator|->
name|saveVBLANK_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_VSYNC_A
argument_list|,
name|dev_priv
operator|->
name|saveVSYNC_A
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|_BCLRPAT_A
argument_list|,
name|dev_priv
operator|->
name|saveBCLRPAT_A
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_PIPEA_DATA_M1
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_DATA_M1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEA_DATA_N1
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_DATA_N1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEA_LINK_M1
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_LINK_M1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEA_LINK_N1
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_LINK_N1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_FDI_RXA_CTL
argument_list|,
name|dev_priv
operator|->
name|saveFDI_RXA_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_FDI_TXA_CTL
argument_list|,
name|dev_priv
operator|->
name|saveFDI_TXA_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PFA_CTL_1
argument_list|,
name|dev_priv
operator|->
name|savePFA_CTL_1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PFA_WIN_SZ
argument_list|,
name|dev_priv
operator|->
name|savePFA_WIN_SZ
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PFA_WIN_POS
argument_list|,
name|dev_priv
operator|->
name|savePFA_WIN_POS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANSACONF
argument_list|,
name|dev_priv
operator|->
name|saveTRANSACONF
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_HTOTAL_A
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_HTOTAL_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_HBLANK_A
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_HBLANK_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_HSYNC_A
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_HSYNC_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_VTOTAL_A
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_VTOTAL_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_VBLANK_A
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_VBLANK_A
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_VSYNC_A
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_VSYNC_A
argument_list|)
expr_stmt|;
block|}
comment|/* Restore plane info */
name|I915_WRITE
argument_list|(
name|_DSPASIZE
argument_list|,
name|dev_priv
operator|->
name|saveDSPASIZE
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPAPOS
argument_list|,
name|dev_priv
operator|->
name|saveDSPAPOS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEASRC
argument_list|,
name|dev_priv
operator|->
name|savePIPEASRC
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPAADDR
argument_list|,
name|dev_priv
operator|->
name|saveDSPAADDR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPASTRIDE
argument_list|,
name|dev_priv
operator|->
name|saveDSPASTRIDE
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_DSPASURF
argument_list|,
name|dev_priv
operator|->
name|saveDSPASURF
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPATILEOFF
argument_list|,
name|dev_priv
operator|->
name|saveDSPATILEOFF
argument_list|)
expr_stmt|;
block|}
name|I915_WRITE
argument_list|(
name|_PIPEACONF
argument_list|,
name|dev_priv
operator|->
name|savePIPEACONF
argument_list|)
expr_stmt|;
name|i915_restore_palette
argument_list|(
name|dev
argument_list|,
name|PIPE_A
argument_list|)
expr_stmt|;
comment|/* Enable the plane */
name|I915_WRITE
argument_list|(
name|_DSPACNTR
argument_list|,
name|dev_priv
operator|->
name|saveDSPACNTR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPAADDR
argument_list|,
name|I915_READ
argument_list|(
name|_DSPAADDR
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Pipe& plane B info */
if|if
condition|(
name|dev_priv
operator|->
name|saveDPLL_B
operator|&
name|DPLL_VCO_ENABLE
condition|)
block|{
name|I915_WRITE
argument_list|(
name|dpll_b_reg
argument_list|,
name|dev_priv
operator|->
name|saveDPLL_B
operator|&
operator|~
name|DPLL_VCO_ENABLE
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|dpll_b_reg
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
block|}
name|I915_WRITE
argument_list|(
name|fpb0_reg
argument_list|,
name|dev_priv
operator|->
name|saveFPB0
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|fpb1_reg
argument_list|,
name|dev_priv
operator|->
name|saveFPB1
argument_list|)
expr_stmt|;
comment|/* Actually enable it */
name|I915_WRITE
argument_list|(
name|dpll_b_reg
argument_list|,
name|dev_priv
operator|->
name|saveDPLL_B
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|dpll_b_reg
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_DPLL_B_MD
argument_list|,
name|dev_priv
operator|->
name|saveDPLL_B_MD
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|_DPLL_B_MD
argument_list|)
expr_stmt|;
block|}
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
comment|/* Restore mode */
name|I915_WRITE
argument_list|(
name|_HTOTAL_B
argument_list|,
name|dev_priv
operator|->
name|saveHTOTAL_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_HBLANK_B
argument_list|,
name|dev_priv
operator|->
name|saveHBLANK_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_HSYNC_B
argument_list|,
name|dev_priv
operator|->
name|saveHSYNC_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_VTOTAL_B
argument_list|,
name|dev_priv
operator|->
name|saveVTOTAL_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_VBLANK_B
argument_list|,
name|dev_priv
operator|->
name|saveVBLANK_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_VSYNC_B
argument_list|,
name|dev_priv
operator|->
name|saveVSYNC_B
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|_BCLRPAT_B
argument_list|,
name|dev_priv
operator|->
name|saveBCLRPAT_B
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_PIPEB_DATA_M1
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_DATA_M1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_DATA_N1
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_DATA_N1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_LINK_M1
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_LINK_M1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_LINK_N1
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_LINK_N1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_FDI_RXB_CTL
argument_list|,
name|dev_priv
operator|->
name|saveFDI_RXB_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_FDI_TXB_CTL
argument_list|,
name|dev_priv
operator|->
name|saveFDI_TXB_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PFB_CTL_1
argument_list|,
name|dev_priv
operator|->
name|savePFB_CTL_1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PFB_WIN_SZ
argument_list|,
name|dev_priv
operator|->
name|savePFB_WIN_SZ
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PFB_WIN_POS
argument_list|,
name|dev_priv
operator|->
name|savePFB_WIN_POS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANSBCONF
argument_list|,
name|dev_priv
operator|->
name|saveTRANSBCONF
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_HTOTAL_B
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_HTOTAL_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_HBLANK_B
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_HBLANK_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_HSYNC_B
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_HSYNC_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_VTOTAL_B
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_VTOTAL_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_VBLANK_B
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_VBLANK_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_TRANS_VSYNC_B
argument_list|,
name|dev_priv
operator|->
name|saveTRANS_VSYNC_B
argument_list|)
expr_stmt|;
block|}
comment|/* Restore plane info */
name|I915_WRITE
argument_list|(
name|_DSPBSIZE
argument_list|,
name|dev_priv
operator|->
name|saveDSPBSIZE
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPBPOS
argument_list|,
name|dev_priv
operator|->
name|saveDSPBPOS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEBSRC
argument_list|,
name|dev_priv
operator|->
name|savePIPEBSRC
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPBADDR
argument_list|,
name|dev_priv
operator|->
name|saveDSPBADDR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPBSTRIDE
argument_list|,
name|dev_priv
operator|->
name|saveDSPBSTRIDE
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_DSPBSURF
argument_list|,
name|dev_priv
operator|->
name|saveDSPBSURF
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPBTILEOFF
argument_list|,
name|dev_priv
operator|->
name|saveDSPBTILEOFF
argument_list|)
expr_stmt|;
block|}
name|I915_WRITE
argument_list|(
name|_PIPEBCONF
argument_list|,
name|dev_priv
operator|->
name|savePIPEBCONF
argument_list|)
expr_stmt|;
name|i915_restore_palette
argument_list|(
name|dev
argument_list|,
name|PIPE_B
argument_list|)
expr_stmt|;
comment|/* Enable the plane */
name|I915_WRITE
argument_list|(
name|_DSPBCNTR
argument_list|,
name|dev_priv
operator|->
name|saveDSPBCNTR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_DSPBADDR
argument_list|,
name|I915_READ
argument_list|(
name|_DSPBADDR
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Cursor state */
name|I915_WRITE
argument_list|(
name|_CURAPOS
argument_list|,
name|dev_priv
operator|->
name|saveCURAPOS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_CURACNTR
argument_list|,
name|dev_priv
operator|->
name|saveCURACNTR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_CURABASE
argument_list|,
name|dev_priv
operator|->
name|saveCURABASE
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_CURBPOS
argument_list|,
name|dev_priv
operator|->
name|saveCURBPOS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_CURBCNTR
argument_list|,
name|dev_priv
operator|->
name|saveCURBCNTR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_CURBBASE
argument_list|,
name|dev_priv
operator|->
name|saveCURBBASE
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_GEN2
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|CURSIZE
argument_list|,
name|dev_priv
operator|->
name|saveCURSIZE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_save_display
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
comment|/* Display arbitration control */
name|dev_priv
operator|->
name|saveDSPARB
operator|=
name|I915_READ
argument_list|(
name|DSPARB
argument_list|)
expr_stmt|;
comment|/* This is only meaningful in non-KMS mode */
comment|/* Don't save them in KMS mode */
name|i915_save_modeset_reg
argument_list|(
name|dev
argument_list|)
expr_stmt|;
comment|/* CRT state */
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveADPA
operator|=
name|I915_READ
argument_list|(
name|PCH_ADPA
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|saveADPA
operator|=
name|I915_READ
argument_list|(
name|ADPA
argument_list|)
expr_stmt|;
block|}
comment|/* LVDS state */
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|savePP_CONTROL
operator|=
name|I915_READ
argument_list|(
name|PCH_PP_CONTROL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveBLC_PWM_CTL
operator|=
name|I915_READ
argument_list|(
name|BLC_PWM_PCH_CTL1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveBLC_PWM_CTL2
operator|=
name|I915_READ
argument_list|(
name|BLC_PWM_PCH_CTL2
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveBLC_CPU_PWM_CTL
operator|=
name|I915_READ
argument_list|(
name|BLC_PWM_CPU_CTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveBLC_CPU_PWM_CTL2
operator|=
name|I915_READ
argument_list|(
name|BLC_PWM_CPU_CTL2
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveLVDS
operator|=
name|I915_READ
argument_list|(
name|PCH_LVDS
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|savePP_CONTROL
operator|=
name|I915_READ
argument_list|(
name|PP_CONTROL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePFIT_PGM_RATIOS
operator|=
name|I915_READ
argument_list|(
name|PFIT_PGM_RATIOS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveBLC_PWM_CTL
operator|=
name|I915_READ
argument_list|(
name|BLC_PWM_CTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveBLC_HIST_CTL
operator|=
name|I915_READ
argument_list|(
name|BLC_HIST_CTL
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
condition|)
name|dev_priv
operator|->
name|saveBLC_PWM_CTL2
operator|=
name|I915_READ
argument_list|(
name|BLC_PWM_CTL2
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_MOBILE
argument_list|(
name|dev
argument_list|)
operator|&&
operator|!
name|IS_I830
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveLVDS
operator|=
name|I915_READ
argument_list|(
name|LVDS
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|IS_I830
argument_list|(
name|dev
argument_list|)
operator|&&
operator|!
name|IS_845G
argument_list|(
name|dev
argument_list|)
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|savePFIT_CONTROL
operator|=
name|I915_READ
argument_list|(
name|PFIT_CONTROL
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|savePP_ON_DELAYS
operator|=
name|I915_READ
argument_list|(
name|PCH_PP_ON_DELAYS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePP_OFF_DELAYS
operator|=
name|I915_READ
argument_list|(
name|PCH_PP_OFF_DELAYS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePP_DIVISOR
operator|=
name|I915_READ
argument_list|(
name|PCH_PP_DIVISOR
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|savePP_ON_DELAYS
operator|=
name|I915_READ
argument_list|(
name|PP_ON_DELAYS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePP_OFF_DELAYS
operator|=
name|I915_READ
argument_list|(
name|PP_OFF_DELAYS
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePP_DIVISOR
operator|=
name|I915_READ
argument_list|(
name|PP_DIVISOR
argument_list|)
expr_stmt|;
block|}
comment|/* Display Port state */
if|if
condition|(
name|SUPPORTS_INTEGRATED_DP
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveDP_B
operator|=
name|I915_READ
argument_list|(
name|DP_B
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDP_C
operator|=
name|I915_READ
argument_list|(
name|DP_C
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDP_D
operator|=
name|I915_READ
argument_list|(
name|DP_D
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_GMCH_DATA_M
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_GMCH_DATA_M
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_GMCH_DATA_M
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_GMCH_DATA_M
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_GMCH_DATA_N
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_GMCH_DATA_N
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_GMCH_DATA_N
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_GMCH_DATA_N
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_DP_LINK_M
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_DP_LINK_M
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_DP_LINK_M
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_DP_LINK_M
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEA_DP_LINK_N
operator|=
name|I915_READ
argument_list|(
name|_PIPEA_DP_LINK_N
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePIPEB_DP_LINK_N
operator|=
name|I915_READ
argument_list|(
name|_PIPEB_DP_LINK_N
argument_list|)
expr_stmt|;
block|}
comment|/* FIXME: save TV& SDVO state */
comment|/* Only save FBC state on the platform that supports FBC */
if|if
condition|(
name|I915_HAS_FBC
argument_list|(
name|dev
argument_list|)
condition|)
block|{
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveDPFC_CB_BASE
operator|=
name|I915_READ
argument_list|(
name|ILK_DPFC_CB_BASE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_GM45
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveDPFC_CB_BASE
operator|=
name|I915_READ
argument_list|(
name|DPFC_CB_BASE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|saveFBC_CFB_BASE
operator|=
name|I915_READ
argument_list|(
name|FBC_CFB_BASE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFBC_LL_BASE
operator|=
name|I915_READ
argument_list|(
name|FBC_LL_BASE
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFBC_CONTROL2
operator|=
name|I915_READ
argument_list|(
name|FBC_CONTROL2
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFBC_CONTROL
operator|=
name|I915_READ
argument_list|(
name|FBC_CONTROL
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* VGA state */
name|dev_priv
operator|->
name|saveVGA0
operator|=
name|I915_READ
argument_list|(
name|VGA0
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVGA1
operator|=
name|I915_READ
argument_list|(
name|VGA1
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveVGA_PD
operator|=
name|I915_READ
argument_list|(
name|VGA_PD
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|dev_priv
operator|->
name|saveVGACNTRL
operator|=
name|I915_READ
argument_list|(
name|CPU_VGACNTRL
argument_list|)
expr_stmt|;
else|else
name|dev_priv
operator|->
name|saveVGACNTRL
operator|=
name|I915_READ
argument_list|(
name|VGACNTRL
argument_list|)
expr_stmt|;
name|i915_save_vga
argument_list|(
name|dev
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i915_restore_display
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
comment|/* Display arbitration */
name|I915_WRITE
argument_list|(
name|DSPARB
argument_list|,
name|dev_priv
operator|->
name|saveDSPARB
argument_list|)
expr_stmt|;
comment|/* Display port ratios (must be done before clock is set) */
if|if
condition|(
name|SUPPORTS_INTEGRATED_DP
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|_PIPEA_GMCH_DATA_M
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_GMCH_DATA_M
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_GMCH_DATA_M
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_GMCH_DATA_M
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEA_GMCH_DATA_N
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_GMCH_DATA_N
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_GMCH_DATA_N
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_GMCH_DATA_N
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEA_DP_LINK_M
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_DP_LINK_M
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_DP_LINK_M
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_DP_LINK_M
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEA_DP_LINK_N
argument_list|,
name|dev_priv
operator|->
name|savePIPEA_DP_LINK_N
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_PIPEB_DP_LINK_N
argument_list|,
name|dev_priv
operator|->
name|savePIPEB_DP_LINK_N
argument_list|)
expr_stmt|;
block|}
comment|/* This is only meaningful in non-KMS mode */
comment|/* Don't restore them in KMS mode */
name|i915_restore_modeset_reg
argument_list|(
name|dev
argument_list|)
expr_stmt|;
comment|/* CRT state */
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|PCH_ADPA
argument_list|,
name|dev_priv
operator|->
name|saveADPA
argument_list|)
expr_stmt|;
else|else
name|I915_WRITE
argument_list|(
name|ADPA
argument_list|,
name|dev_priv
operator|->
name|saveADPA
argument_list|)
expr_stmt|;
comment|/* LVDS state */
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|4
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|BLC_PWM_CTL2
argument_list|,
name|dev_priv
operator|->
name|saveBLC_PWM_CTL2
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|PCH_LVDS
argument_list|,
name|dev_priv
operator|->
name|saveLVDS
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_MOBILE
argument_list|(
name|dev
argument_list|)
operator|&&
operator|!
name|IS_I830
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|LVDS
argument_list|,
name|dev_priv
operator|->
name|saveLVDS
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|IS_I830
argument_list|(
name|dev
argument_list|)
operator|&&
operator|!
name|IS_845G
argument_list|(
name|dev
argument_list|)
operator|&&
operator|!
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|PFIT_CONTROL
argument_list|,
name|dev_priv
operator|->
name|savePFIT_CONTROL
argument_list|)
expr_stmt|;
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|BLC_PWM_PCH_CTL1
argument_list|,
name|dev_priv
operator|->
name|saveBLC_PWM_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|BLC_PWM_PCH_CTL2
argument_list|,
name|dev_priv
operator|->
name|saveBLC_PWM_CTL2
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|BLC_PWM_CPU_CTL
argument_list|,
name|dev_priv
operator|->
name|saveBLC_CPU_PWM_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|BLC_PWM_CPU_CTL2
argument_list|,
name|dev_priv
operator|->
name|saveBLC_CPU_PWM_CTL2
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PCH_PP_ON_DELAYS
argument_list|,
name|dev_priv
operator|->
name|savePP_ON_DELAYS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PCH_PP_OFF_DELAYS
argument_list|,
name|dev_priv
operator|->
name|savePP_OFF_DELAYS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PCH_PP_DIVISOR
argument_list|,
name|dev_priv
operator|->
name|savePP_DIVISOR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PCH_PP_CONTROL
argument_list|,
name|dev_priv
operator|->
name|savePP_CONTROL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|RSTDBYCTL
argument_list|,
name|dev_priv
operator|->
name|saveMCHBAR_RENDER_STANDBY
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|I915_WRITE
argument_list|(
name|PFIT_PGM_RATIOS
argument_list|,
name|dev_priv
operator|->
name|savePFIT_PGM_RATIOS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|BLC_PWM_CTL
argument_list|,
name|dev_priv
operator|->
name|saveBLC_PWM_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|BLC_HIST_CTL
argument_list|,
name|dev_priv
operator|->
name|saveBLC_HIST_CTL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PP_ON_DELAYS
argument_list|,
name|dev_priv
operator|->
name|savePP_ON_DELAYS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PP_OFF_DELAYS
argument_list|,
name|dev_priv
operator|->
name|savePP_OFF_DELAYS
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PP_DIVISOR
argument_list|,
name|dev_priv
operator|->
name|savePP_DIVISOR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PP_CONTROL
argument_list|,
name|dev_priv
operator|->
name|savePP_CONTROL
argument_list|)
expr_stmt|;
block|}
comment|/* Display Port state */
if|if
condition|(
name|SUPPORTS_INTEGRATED_DP
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|DP_B
argument_list|,
name|dev_priv
operator|->
name|saveDP_B
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|DP_C
argument_list|,
name|dev_priv
operator|->
name|saveDP_C
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|DP_D
argument_list|,
name|dev_priv
operator|->
name|saveDP_D
argument_list|)
expr_stmt|;
block|}
comment|/* FIXME: restore TV& SDVO state */
comment|/* only restore FBC info on the platform that supports FBC*/
name|intel_disable_fbc
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|I915_HAS_FBC
argument_list|(
name|dev
argument_list|)
condition|)
block|{
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|ILK_DPFC_CB_BASE
argument_list|,
name|dev_priv
operator|->
name|saveDPFC_CB_BASE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_GM45
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|DPFC_CB_BASE
argument_list|,
name|dev_priv
operator|->
name|saveDPFC_CB_BASE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|I915_WRITE
argument_list|(
name|FBC_CFB_BASE
argument_list|,
name|dev_priv
operator|->
name|saveFBC_CFB_BASE
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|FBC_LL_BASE
argument_list|,
name|dev_priv
operator|->
name|saveFBC_LL_BASE
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|FBC_CONTROL2
argument_list|,
name|dev_priv
operator|->
name|saveFBC_CONTROL2
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|FBC_CONTROL
argument_list|,
name|dev_priv
operator|->
name|saveFBC_CONTROL
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* VGA state */
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
name|I915_WRITE
argument_list|(
name|CPU_VGACNTRL
argument_list|,
name|dev_priv
operator|->
name|saveVGACNTRL
argument_list|)
expr_stmt|;
else|else
name|I915_WRITE
argument_list|(
name|VGACNTRL
argument_list|,
name|dev_priv
operator|->
name|saveVGACNTRL
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|VGA0
argument_list|,
name|dev_priv
operator|->
name|saveVGA0
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|VGA1
argument_list|,
name|dev_priv
operator|->
name|saveVGA1
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|VGA_PD
argument_list|,
name|dev_priv
operator|->
name|saveVGA_PD
argument_list|)
expr_stmt|;
name|POSTING_READ
argument_list|(
name|VGA_PD
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|150
argument_list|)
expr_stmt|;
name|i915_restore_vga
argument_list|(
name|dev
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|i915_save_state
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|i
decl_stmt|;
name|dev_priv
operator|->
name|saveLBB
operator|=
name|pci_read_config
argument_list|(
name|dev
operator|->
name|device
argument_list|,
name|LBB
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Hardware status page */
name|dev_priv
operator|->
name|saveHWS
operator|=
name|I915_READ
argument_list|(
name|HWS_PGA
argument_list|)
expr_stmt|;
name|i915_save_display
argument_list|(
name|dev
argument_list|)
expr_stmt|;
comment|/* Interrupt state */
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|dev_priv
operator|->
name|saveDEIER
operator|=
name|I915_READ
argument_list|(
name|DEIER
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveDEIMR
operator|=
name|I915_READ
argument_list|(
name|DEIMR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveGTIER
operator|=
name|I915_READ
argument_list|(
name|GTIER
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveGTIMR
operator|=
name|I915_READ
argument_list|(
name|GTIMR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFDI_RXA_IMR
operator|=
name|I915_READ
argument_list|(
name|_FDI_RXA_IMR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveFDI_RXB_IMR
operator|=
name|I915_READ
argument_list|(
name|_FDI_RXB_IMR
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveMCHBAR_RENDER_STANDBY
operator|=
name|I915_READ
argument_list|(
name|RSTDBYCTL
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|savePCH_PORT_HOTPLUG
operator|=
name|I915_READ
argument_list|(
name|PCH_PORT_HOTPLUG
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dev_priv
operator|->
name|saveIER
operator|=
name|I915_READ
argument_list|(
name|IER
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveIMR
operator|=
name|I915_READ
argument_list|(
name|IMR
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IS_IRONLAKE_M
argument_list|(
name|dev
argument_list|)
condition|)
name|ironlake_disable_drps
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTEL_INFO
argument_list|(
name|dev
argument_list|)
operator|->
name|gen
operator|>=
literal|6
condition|)
name|gen6_disable_rps
argument_list|(
name|dev
argument_list|)
expr_stmt|;
comment|/* Cache mode state */
name|dev_priv
operator|->
name|saveCACHE_MODE_0
operator|=
name|I915_READ
argument_list|(
name|CACHE_MODE_0
argument_list|)
expr_stmt|;
comment|/* Memory Arbitration state */
name|dev_priv
operator|->
name|saveMI_ARB_STATE
operator|=
name|I915_READ
argument_list|(
name|MI_ARB_STATE
argument_list|)
expr_stmt|;
comment|/* Scratch space */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|dev_priv
operator|->
name|saveSWF0
index|[
name|i
index|]
operator|=
name|I915_READ
argument_list|(
name|SWF00
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|dev_priv
operator|->
name|saveSWF1
index|[
name|i
index|]
operator|=
name|I915_READ
argument_list|(
name|SWF10
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
name|dev_priv
operator|->
name|saveSWF2
index|[
name|i
index|]
operator|=
name|I915_READ
argument_list|(
name|SWF30
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|i915_restore_state
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|drm_i915_private
modifier|*
name|dev_priv
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|i
decl_stmt|;
name|pci_write_config
argument_list|(
name|dev
operator|->
name|device
argument_list|,
name|LBB
argument_list|,
name|dev_priv
operator|->
name|saveLBB
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Hardware status page */
name|I915_WRITE
argument_list|(
name|HWS_PGA
argument_list|,
name|dev_priv
operator|->
name|saveHWS
argument_list|)
expr_stmt|;
name|i915_restore_display
argument_list|(
name|dev
argument_list|)
expr_stmt|;
comment|/* Interrupt state */
if|if
condition|(
name|HAS_PCH_SPLIT
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|I915_WRITE
argument_list|(
name|DEIER
argument_list|,
name|dev_priv
operator|->
name|saveDEIER
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|DEIMR
argument_list|,
name|dev_priv
operator|->
name|saveDEIMR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|GTIER
argument_list|,
name|dev_priv
operator|->
name|saveGTIER
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|GTIMR
argument_list|,
name|dev_priv
operator|->
name|saveGTIMR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_FDI_RXA_IMR
argument_list|,
name|dev_priv
operator|->
name|saveFDI_RXA_IMR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|_FDI_RXB_IMR
argument_list|,
name|dev_priv
operator|->
name|saveFDI_RXB_IMR
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|PCH_PORT_HOTPLUG
argument_list|,
name|dev_priv
operator|->
name|savePCH_PORT_HOTPLUG
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|I915_WRITE
argument_list|(
name|IER
argument_list|,
name|dev_priv
operator|->
name|saveIER
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|IMR
argument_list|,
name|dev_priv
operator|->
name|saveIMR
argument_list|)
expr_stmt|;
block|}
comment|/* Cache mode state */
name|I915_WRITE
argument_list|(
name|CACHE_MODE_0
argument_list|,
name|dev_priv
operator|->
name|saveCACHE_MODE_0
operator||
literal|0xffff0000
argument_list|)
expr_stmt|;
comment|/* Memory arbitration state */
name|I915_WRITE
argument_list|(
name|MI_ARB_STATE
argument_list|,
name|dev_priv
operator|->
name|saveMI_ARB_STATE
operator||
literal|0xffff0000
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|I915_WRITE
argument_list|(
name|SWF00
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveSWF0
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|I915_WRITE
argument_list|(
name|SWF10
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveSWF1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
name|I915_WRITE
argument_list|(
name|SWF30
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
argument_list|,
name|dev_priv
operator|->
name|saveSWF2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|intel_iic_reset
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

