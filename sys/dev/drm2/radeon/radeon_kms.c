begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2008 Advanced Micro Devices, Inc.  * Copyright 2008 Red Hat Inc.  * Copyright 2009 Jerome Glisse.  *  * Permission is hereby granted, free of charge, to any person obtaining a  * copy of this software and associated documentation files (the "Software"),  * to deal in the Software without restriction, including without limitation  * the rights to use, copy, modify, merge, publish, distribute, sublicense,  * and/or sell copies of the Software, and to permit persons to whom the  * Software is furnished to do so, subject to the following conditions:  *  * The above copyright notice and this permission notice shall be included in  * all copies or substantial portions of the Software.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL  * THE COPYRIGHT HOLDER(S) OR AUTHOR(S) BE LIABLE FOR ANY CLAIM, DAMAGES OR  * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,  * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR  * OTHER DEALINGS IN THE SOFTWARE.  *  * Authors: Dave Airlie  *          Alex Deucher  *          Jerome Glisse  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/drm2/drmP.h>
end_include

begin_include
include|#
directive|include
file|"radeon.h"
end_include

begin_include
include|#
directive|include
file|<dev/drm2/radeon/radeon_drm.h>
end_include

begin_include
include|#
directive|include
file|"radeon_asic.h"
end_include

begin_include
include|#
directive|include
file|"radeon_kms.h"
end_include

begin_comment
comment|/**  * radeon_driver_unload_kms - Main unload function for KMS.  *  * @dev: drm dev pointer  *  * This is the main unload function for KMS (all asics).  * It calls radeon_modeset_fini() to tear down the  * displays, and radeon_device_fini() to tear down  * the rest of the device (CP, writeback, etc.).  * Returns 0 on success.  */
end_comment

begin_function
name|int
name|radeon_driver_unload_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
if|if
condition|(
name|rdev
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|radeon_acpi_fini
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|radeon_modeset_fini
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|radeon_device_fini
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|rdev
argument_list|,
name|DRM_MEM_DRIVER
argument_list|)
expr_stmt|;
name|dev
operator|->
name|dev_private
operator|=
name|NULL
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**  * radeon_driver_load_kms - Main load function for KMS.  *  * @dev: drm dev pointer  * @flags: device flags  *  * This is the main load function for KMS (all asics).  * It calls radeon_device_init() to set up the non-display  * parts of the chip (asic init, CP, writeback, etc.), and  * radeon_modeset_init() to set up the display parts  * (crtcs, encoders, hotplug detect, etc.).  * Returns 0 on success, error on failure.  */
end_comment

begin_function
name|int
name|radeon_driver_load_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|unsigned
name|long
name|flags
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
decl_stmt|;
name|int
name|r
decl_stmt|,
name|acpi_status
decl_stmt|;
name|rdev
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|radeon_device
argument_list|)
argument_list|,
name|DRM_MEM_DRIVER
argument_list|,
name|M_ZERO
operator||
name|M_WAITOK
argument_list|)
expr_stmt|;
if|if
condition|(
name|rdev
operator|==
name|NULL
condition|)
block|{
return|return
operator|-
name|ENOMEM
return|;
block|}
name|dev
operator|->
name|dev_private
operator|=
operator|(
name|void
operator|*
operator|)
name|rdev
expr_stmt|;
comment|/* update BUS flag */
if|if
condition|(
name|drm_device_is_agp
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|DRM_INFO
argument_list|(
literal|"RADEON_IS_AGP\n"
argument_list|)
expr_stmt|;
name|flags
operator||=
name|RADEON_IS_AGP
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|drm_device_is_pcie
argument_list|(
name|dev
argument_list|)
condition|)
block|{
name|DRM_INFO
argument_list|(
literal|"RADEON_IS_PCIE\n"
argument_list|)
expr_stmt|;
name|flags
operator||=
name|RADEON_IS_PCIE
expr_stmt|;
block|}
else|else
block|{
name|DRM_INFO
argument_list|(
literal|"RADEON_IS_PCI\n"
argument_list|)
expr_stmt|;
name|flags
operator||=
name|RADEON_IS_PCI
expr_stmt|;
block|}
comment|/* radeon_device_init should report only fatal error 	 * like memory allocation failure or iomapping failure, 	 * or memory manager initialization failure, it must 	 * properly initialize the GPU MC controller and permit 	 * VRAM allocation 	 */
name|r
operator|=
name|radeon_device_init
argument_list|(
name|rdev
argument_list|,
name|dev
argument_list|,
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
condition|)
block|{
name|dev_err
argument_list|(
name|dev
operator|->
name|device
argument_list|,
literal|"Fatal error during GPU init\n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
comment|/* Again modeset_init should fail only on fatal error 	 * otherwise it should provide enough functionalities 	 * for shadowfb to run 	 */
name|r
operator|=
name|radeon_modeset_init
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
condition|)
name|dev_err
argument_list|(
name|dev
operator|->
name|device
argument_list|,
literal|"Fatal error during modeset init\n"
argument_list|)
expr_stmt|;
comment|/* Call ACPI methods: require modeset init 	 * but failure is not fatal 	 */
if|if
condition|(
operator|!
name|r
condition|)
block|{
name|acpi_status
operator|=
name|radeon_acpi_init
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
if|if
condition|(
name|acpi_status
condition|)
name|dev_dbg
argument_list|(
name|dev
operator|->
name|device
argument_list|,
literal|"Error during ACPI methods call\n"
argument_list|)
expr_stmt|;
block|}
name|out
label|:
if|if
condition|(
name|r
condition|)
name|radeon_driver_unload_kms
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_comment
comment|/**  * radeon_set_filp_rights - Set filp right.  *  * @dev: drm dev pointer  * @owner: drm file  * @applier: drm file  * @value: value  *  * Sets the filp rights for the device (all asics).  */
end_comment

begin_function
specifier|static
name|void
name|radeon_set_filp_rights
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|struct
name|drm_file
modifier|*
modifier|*
name|owner
parameter_list|,
name|struct
name|drm_file
modifier|*
name|applier
parameter_list|,
name|uint32_t
modifier|*
name|value
parameter_list|)
block|{
name|DRM_LOCK
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|value
operator|==
literal|1
condition|)
block|{
comment|/* wants rights */
if|if
condition|(
operator|!
operator|*
name|owner
condition|)
operator|*
name|owner
operator|=
name|applier
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|value
operator|==
literal|0
condition|)
block|{
comment|/* revokes rights */
if|if
condition|(
operator|*
name|owner
operator|==
name|applier
condition|)
operator|*
name|owner
operator|=
name|NULL
expr_stmt|;
block|}
operator|*
name|value
operator|=
operator|*
name|owner
operator|==
name|applier
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|DRM_UNLOCK
argument_list|(
name|dev
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Userspace get information ioctl  */
end_comment

begin_comment
comment|/**  * radeon_info_ioctl - answer a device specific request.  *  * @rdev: radeon device pointer  * @data: request object  * @filp: drm filp  *  * This function is used to pass device specific parameters to the userspace  * drivers.  Examples include: pci device id, pipeline parms, tiling params,  * etc. (all asics).  * Returns 0 on success, -EINVAL on failure.  */
end_comment

begin_function
specifier|static
name|int
name|radeon_info_ioctl
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|struct
name|drm_file
modifier|*
name|filp
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|struct
name|drm_radeon_info
modifier|*
name|info
init|=
name|data
decl_stmt|;
name|struct
name|radeon_mode_info
modifier|*
name|minfo
init|=
operator|&
name|rdev
operator|->
name|mode_info
decl_stmt|;
name|uint32_t
name|value
decl_stmt|,
modifier|*
name|value_ptr
decl_stmt|;
name|uint64_t
name|value64
decl_stmt|,
modifier|*
name|value_ptr64
decl_stmt|;
name|struct
name|drm_crtc
modifier|*
name|crtc
decl_stmt|;
name|int
name|i
decl_stmt|,
name|found
decl_stmt|;
comment|/* TIMESTAMP is a 64-bit value, needs special handling. */
if|if
condition|(
name|info
operator|->
name|request
operator|==
name|RADEON_INFO_TIMESTAMP
condition|)
block|{
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R600
condition|)
block|{
name|value_ptr64
operator|=
operator|(
name|uint64_t
operator|*
operator|)
operator|(
operator|(
name|unsigned
name|long
operator|)
name|info
operator|->
name|value
operator|)
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
block|{
name|value64
operator|=
name|si_get_gpu_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|value64
operator|=
name|r600_get_gpu_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|DRM_COPY_TO_USER
argument_list|(
name|value_ptr64
argument_list|,
operator|&
name|value64
argument_list|,
sizeof|sizeof
argument_list|(
name|value64
argument_list|)
argument_list|)
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"copy_to_user %s:%u\n"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|-
name|EFAULT
return|;
block|}
return|return
literal|0
return|;
block|}
else|else
block|{
name|DRM_DEBUG_KMS
argument_list|(
literal|"timestamp is r6xx+ only!\n"
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
block|}
name|value_ptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|(
name|unsigned
name|long
operator|)
name|info
operator|->
name|value
operator|)
expr_stmt|;
if|if
condition|(
name|DRM_COPY_FROM_USER
argument_list|(
operator|&
name|value
argument_list|,
name|value_ptr
argument_list|,
sizeof|sizeof
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"copy_from_user %s:%u\n"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|-
name|EFAULT
return|;
block|}
switch|switch
condition|(
name|info
operator|->
name|request
condition|)
block|{
case|case
name|RADEON_INFO_DEVICE_ID
case|:
name|value
operator|=
name|dev
operator|->
name|pci_device
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_NUM_GB_PIPES
case|:
name|value
operator|=
name|rdev
operator|->
name|num_gb_pipes
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_NUM_Z_PIPES
case|:
name|value
operator|=
name|rdev
operator|->
name|num_z_pipes
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_ACCEL_WORKING
case|:
comment|/* xf86-video-ati 6.13.0 relies on this being false for evergreen */
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
operator|)
operator|&&
operator|(
name|rdev
operator|->
name|family
operator|<=
name|CHIP_HEMLOCK
operator|)
condition|)
name|value
operator|=
name|false
expr_stmt|;
else|else
name|value
operator|=
name|rdev
operator|->
name|accel_working
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_CRTC_FROM_ID
case|:
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|found
operator|=
literal|0
init|;
name|i
operator|<
name|rdev
operator|->
name|num_crtc
condition|;
name|i
operator|++
control|)
block|{
name|crtc
operator|=
operator|(
expr|struct
name|drm_crtc
operator|*
operator|)
name|minfo
operator|->
name|crtcs
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|crtc
operator|&&
name|crtc
operator|->
name|base
operator|.
name|id
operator|==
name|value
condition|)
block|{
name|struct
name|radeon_crtc
modifier|*
name|radeon_crtc
init|=
name|to_radeon_crtc
argument_list|(
name|crtc
argument_list|)
decl_stmt|;
name|value
operator|=
name|radeon_crtc
operator|->
name|crtc_id
expr_stmt|;
name|found
operator|=
literal|1
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
block|{
name|DRM_DEBUG_KMS
argument_list|(
literal|"unknown crtc id %d\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
break|break;
case|case
name|RADEON_INFO_ACCEL_WORKING2
case|:
name|value
operator|=
name|rdev
operator|->
name|accel_working
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_TILING_CONFIG
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|tile_config
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|tile_config
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|evergreen
operator|.
name|tile_config
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV770
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|rv770
operator|.
name|tile_config
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R600
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|r600
operator|.
name|tile_config
expr_stmt|;
else|else
block|{
name|DRM_DEBUG_KMS
argument_list|(
literal|"tiling config is r6xx+ only!\n"
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
break|break;
case|case
name|RADEON_INFO_WANT_HYPERZ
case|:
comment|/* The "value" here is both an input and output parameter. 		 * If the input value is 1, filp requests hyper-z access. 		 * If the input value is 0, filp revokes its hyper-z access. 		 * 		 * When returning, the value is 1 if filp owns hyper-z access, 		 * 0 otherwise. */
if|if
condition|(
name|value
operator|>=
literal|2
condition|)
block|{
name|DRM_DEBUG_KMS
argument_list|(
literal|"WANT_HYPERZ: invalid value %d\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
name|radeon_set_filp_rights
argument_list|(
name|dev
argument_list|,
operator|&
name|rdev
operator|->
name|hyperz_filp
argument_list|,
name|filp
argument_list|,
operator|&
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_WANT_CMASK
case|:
comment|/* The same logic as Hyper-Z. */
if|if
condition|(
name|value
operator|>=
literal|2
condition|)
block|{
name|DRM_DEBUG_KMS
argument_list|(
literal|"WANT_CMASK: invalid value %d\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
name|radeon_set_filp_rights
argument_list|(
name|dev
argument_list|,
operator|&
name|rdev
operator|->
name|cmask_filp
argument_list|,
name|filp
argument_list|,
operator|&
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_CLOCK_CRYSTAL_FREQ
case|:
comment|/* return clock value in KHz */
name|value
operator|=
name|rdev
operator|->
name|clock
operator|.
name|spll
operator|.
name|reference_freq
operator|*
literal|10
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_NUM_BACKENDS
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|max_backends_per_se
operator|*
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|max_shader_engines
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|max_backends_per_se
operator|*
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|max_shader_engines
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|evergreen
operator|.
name|max_backends
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV770
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|rv770
operator|.
name|max_backends
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R600
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|r600
operator|.
name|max_backends
expr_stmt|;
else|else
block|{
return|return
operator|-
name|EINVAL
return|;
block|}
break|break;
case|case
name|RADEON_INFO_NUM_TILE_PIPES
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|max_tile_pipes
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|max_tile_pipes
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|evergreen
operator|.
name|max_tile_pipes
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV770
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|rv770
operator|.
name|max_tile_pipes
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R600
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|r600
operator|.
name|max_tile_pipes
expr_stmt|;
else|else
block|{
return|return
operator|-
name|EINVAL
return|;
block|}
break|break;
case|case
name|RADEON_INFO_FUSION_GART_WORKING
case|:
name|value
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_BACKEND_MAP
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|backend_map
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|backend_map
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|evergreen
operator|.
name|backend_map
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV770
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|rv770
operator|.
name|backend_map
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R600
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|r600
operator|.
name|backend_map
expr_stmt|;
else|else
block|{
return|return
operator|-
name|EINVAL
return|;
block|}
break|break;
case|case
name|RADEON_INFO_VA_START
case|:
comment|/* this is where we report if vm is supported or not */
if|if
condition|(
name|rdev
operator|->
name|family
operator|<
name|CHIP_CAYMAN
condition|)
return|return
operator|-
name|EINVAL
return|;
name|value
operator|=
name|RADEON_VA_RESERVED_SIZE
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_IB_VM_MAX_SIZE
case|:
comment|/* this is where we report if vm is supported or not */
if|if
condition|(
name|rdev
operator|->
name|family
operator|<
name|CHIP_CAYMAN
condition|)
return|return
operator|-
name|EINVAL
return|;
name|value
operator|=
name|RADEON_IB_VM_MAX_SIZE
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_MAX_PIPES
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|max_cu_per_sh
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|max_pipes_per_simd
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|evergreen
operator|.
name|max_pipes
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV770
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|rv770
operator|.
name|max_pipes
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R600
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|r600
operator|.
name|max_pipes
expr_stmt|;
else|else
block|{
return|return
operator|-
name|EINVAL
return|;
block|}
break|break;
case|case
name|RADEON_INFO_MAX_SE
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|max_shader_engines
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|cayman
operator|.
name|max_shader_engines
expr_stmt|;
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CEDAR
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|evergreen
operator|.
name|num_ses
expr_stmt|;
else|else
name|value
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|RADEON_INFO_MAX_SH_PER_SE
case|:
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_TAHITI
condition|)
name|value
operator|=
name|rdev
operator|->
name|config
operator|.
name|si
operator|.
name|max_sh_per_se
expr_stmt|;
else|else
return|return
operator|-
name|EINVAL
return|;
break|break;
default|default:
name|DRM_DEBUG_KMS
argument_list|(
literal|"Invalid request %d\n"
argument_list|,
name|info
operator|->
name|request
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
if|if
condition|(
name|DRM_COPY_TO_USER
argument_list|(
name|value_ptr
argument_list|,
operator|&
name|value
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"copy_to_user %s:%u\n"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|-
name|EFAULT
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Outdated mess for old drm with Xorg being in charge (void function now).  */
end_comment

begin_comment
comment|/**  * radeon_driver_firstopen_kms - drm callback for first open  *  * @dev: drm dev pointer  *  * Nothing to be done for KMS (all asics).  * Returns 0 on success.  */
end_comment

begin_function
name|int
name|radeon_driver_firstopen_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**  * radeon_driver_firstopen_kms - drm callback for last close  *  * @dev: drm dev pointer  *  * Switch vga switcheroo state after last close (all asics).  */
end_comment

begin_function
name|void
name|radeon_driver_lastclose_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DUMBBELL_WIP
name|vga_switcheroo_process_delayed_switch
argument_list|()
expr_stmt|;
endif|#
directive|endif
comment|/* DUMBBELL_WIP */
block|}
end_function

begin_comment
comment|/**  * radeon_driver_open_kms - drm callback for open  *  * @dev: drm dev pointer  * @file_priv: drm file  *  * On device open, init vm on cayman+ (all asics).  * Returns 0 on success, error on failure.  */
end_comment

begin_function
name|int
name|radeon_driver_open_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|struct
name|drm_file
modifier|*
name|file_priv
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|file_priv
operator|->
name|driver_priv
operator|=
name|NULL
expr_stmt|;
comment|/* new gpu have virtual address space support */
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
condition|)
block|{
name|struct
name|radeon_fpriv
modifier|*
name|fpriv
decl_stmt|;
name|struct
name|radeon_bo_va
modifier|*
name|bo_va
decl_stmt|;
name|int
name|r
decl_stmt|;
name|fpriv
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|fpriv
argument_list|)
argument_list|,
name|DRM_MEM_DRIVER
argument_list|,
name|M_ZERO
operator||
name|M_WAITOK
argument_list|)
expr_stmt|;
if|if
condition|(
name|unlikely
argument_list|(
operator|!
name|fpriv
argument_list|)
condition|)
block|{
return|return
operator|-
name|ENOMEM
return|;
block|}
name|radeon_vm_init
argument_list|(
name|rdev
argument_list|,
operator|&
name|fpriv
operator|->
name|vm
argument_list|)
expr_stmt|;
comment|/* map the ib pool buffer read only into 		 * virtual address space */
name|bo_va
operator|=
name|radeon_vm_bo_add
argument_list|(
name|rdev
argument_list|,
operator|&
name|fpriv
operator|->
name|vm
argument_list|,
name|rdev
operator|->
name|ring_tmp_bo
operator|.
name|bo
argument_list|)
expr_stmt|;
name|r
operator|=
name|radeon_vm_bo_set_addr
argument_list|(
name|rdev
argument_list|,
name|bo_va
argument_list|,
name|RADEON_VA_IB_OFFSET
argument_list|,
name|RADEON_VM_PAGE_READABLE
operator||
name|RADEON_VM_PAGE_SNOOPED
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
condition|)
block|{
name|radeon_vm_fini
argument_list|(
name|rdev
argument_list|,
operator|&
name|fpriv
operator|->
name|vm
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|fpriv
argument_list|,
name|DRM_MEM_DRIVER
argument_list|)
expr_stmt|;
return|return
name|r
return|;
block|}
name|file_priv
operator|->
name|driver_priv
operator|=
name|fpriv
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**  * radeon_driver_postclose_kms - drm callback for post close  *  * @dev: drm dev pointer  * @file_priv: drm file  *  * On device post close, tear down vm on cayman+ (all asics).  */
end_comment

begin_function
name|void
name|radeon_driver_postclose_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|struct
name|drm_file
modifier|*
name|file_priv
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
comment|/* new gpu have virtual address space support */
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_CAYMAN
operator|&&
name|file_priv
operator|->
name|driver_priv
condition|)
block|{
name|struct
name|radeon_fpriv
modifier|*
name|fpriv
init|=
name|file_priv
operator|->
name|driver_priv
decl_stmt|;
name|struct
name|radeon_bo_va
modifier|*
name|bo_va
decl_stmt|;
name|int
name|r
decl_stmt|;
name|r
operator|=
name|radeon_bo_reserve
argument_list|(
name|rdev
operator|->
name|ring_tmp_bo
operator|.
name|bo
argument_list|,
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
block|{
name|bo_va
operator|=
name|radeon_vm_bo_find
argument_list|(
operator|&
name|fpriv
operator|->
name|vm
argument_list|,
name|rdev
operator|->
name|ring_tmp_bo
operator|.
name|bo
argument_list|)
expr_stmt|;
if|if
condition|(
name|bo_va
condition|)
name|radeon_vm_bo_rmv
argument_list|(
name|rdev
argument_list|,
name|bo_va
argument_list|)
expr_stmt|;
name|radeon_bo_unreserve
argument_list|(
name|rdev
operator|->
name|ring_tmp_bo
operator|.
name|bo
argument_list|)
expr_stmt|;
block|}
name|radeon_vm_fini
argument_list|(
name|rdev
argument_list|,
operator|&
name|fpriv
operator|->
name|vm
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|fpriv
argument_list|,
name|DRM_MEM_DRIVER
argument_list|)
expr_stmt|;
name|file_priv
operator|->
name|driver_priv
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * radeon_driver_preclose_kms - drm callback for pre close  *  * @dev: drm dev pointer  * @file_priv: drm file  *  * On device pre close, tear down hyperz and cmask filps on r1xx-r5xx  * (all asics).  */
end_comment

begin_function
name|void
name|radeon_driver_preclose_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|struct
name|drm_file
modifier|*
name|file_priv
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
if|if
condition|(
name|rdev
operator|->
name|hyperz_filp
operator|==
name|file_priv
condition|)
name|rdev
operator|->
name|hyperz_filp
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|cmask_filp
operator|==
name|file_priv
condition|)
name|rdev
operator|->
name|cmask_filp
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * VBlank related functions.  */
end_comment

begin_comment
comment|/**  * radeon_get_vblank_counter_kms - get frame count  *  * @dev: drm dev pointer  * @crtc: crtc to get the frame count from  *  * Gets the frame count on the requested crtc (all asics).  * Returns frame count on success, -EINVAL on failure.  */
end_comment

begin_function
name|u32
name|radeon_get_vblank_counter_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|int
name|crtc
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
if|if
condition|(
name|crtc
operator|<
literal|0
operator|||
name|crtc
operator|>=
name|rdev
operator|->
name|num_crtc
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"Invalid crtc %d\n"
argument_list|,
name|crtc
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
return|return
name|radeon_get_vblank_counter
argument_list|(
name|rdev
argument_list|,
name|crtc
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * radeon_enable_vblank_kms - enable vblank interrupt  *  * @dev: drm dev pointer  * @crtc: crtc to enable vblank interrupt for  *  * Enable the interrupt on the requested crtc (all asics).  * Returns 0 on success, -EINVAL on failure.  */
end_comment

begin_function
name|int
name|radeon_enable_vblank_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|int
name|crtc
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|int
name|r
decl_stmt|;
if|if
condition|(
name|crtc
operator|<
literal|0
operator|||
name|crtc
operator|>=
name|rdev
operator|->
name|num_crtc
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"Invalid crtc %d\n"
argument_list|,
name|crtc
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
name|mtx_lock
argument_list|(
operator|&
name|rdev
operator|->
name|irq
operator|.
name|lock
argument_list|)
expr_stmt|;
name|rdev
operator|->
name|irq
operator|.
name|crtc_vblank_int
index|[
name|crtc
index|]
operator|=
name|true
expr_stmt|;
name|r
operator|=
name|radeon_irq_set
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|mtx_unlock
argument_list|(
operator|&
name|rdev
operator|->
name|irq
operator|.
name|lock
argument_list|)
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_comment
comment|/**  * radeon_disable_vblank_kms - disable vblank interrupt  *  * @dev: drm dev pointer  * @crtc: crtc to disable vblank interrupt for  *  * Disable the interrupt on the requested crtc (all asics).  */
end_comment

begin_function
name|void
name|radeon_disable_vblank_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|int
name|crtc
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
if|if
condition|(
name|crtc
operator|<
literal|0
operator|||
name|crtc
operator|>=
name|rdev
operator|->
name|num_crtc
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"Invalid crtc %d\n"
argument_list|,
name|crtc
argument_list|)
expr_stmt|;
return|return;
block|}
name|mtx_lock
argument_list|(
operator|&
name|rdev
operator|->
name|irq
operator|.
name|lock
argument_list|)
expr_stmt|;
name|rdev
operator|->
name|irq
operator|.
name|crtc_vblank_int
index|[
name|crtc
index|]
operator|=
name|false
expr_stmt|;
name|radeon_irq_set
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|mtx_unlock
argument_list|(
operator|&
name|rdev
operator|->
name|irq
operator|.
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * radeon_get_vblank_timestamp_kms - get vblank timestamp  *  * @dev: drm dev pointer  * @crtc: crtc to get the timestamp for  * @max_error: max error  * @vblank_time: time value  * @flags: flags passed to the driver  *  * Gets the timestamp on the requested crtc based on the  * scanout position.  (all asics).  * Returns postive status flags on success, negative error on failure.  */
end_comment

begin_function
name|int
name|radeon_get_vblank_timestamp_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|int
name|crtc
parameter_list|,
name|int
modifier|*
name|max_error
parameter_list|,
name|struct
name|timeval
modifier|*
name|vblank_time
parameter_list|,
name|unsigned
name|flags
parameter_list|)
block|{
name|struct
name|drm_crtc
modifier|*
name|drmcrtc
decl_stmt|;
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
if|if
condition|(
name|crtc
operator|<
literal|0
operator|||
name|crtc
operator|>=
name|dev
operator|->
name|num_crtcs
condition|)
block|{
name|DRM_ERROR
argument_list|(
literal|"Invalid crtc %d\n"
argument_list|,
name|crtc
argument_list|)
expr_stmt|;
return|return
operator|-
name|EINVAL
return|;
block|}
comment|/* Get associated drm_crtc: */
name|drmcrtc
operator|=
operator|&
name|rdev
operator|->
name|mode_info
operator|.
name|crtcs
index|[
name|crtc
index|]
operator|->
name|base
expr_stmt|;
comment|/* Helper routine in DRM core does all the work: */
return|return
name|drm_calc_vbltimestamp_from_scanoutpos
argument_list|(
name|dev
argument_list|,
name|crtc
argument_list|,
name|max_error
argument_list|,
name|vblank_time
argument_list|,
name|flags
argument_list|,
name|drmcrtc
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * IOCTL.  */
end_comment

begin_function
name|int
name|radeon_dma_ioctl_kms
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|struct
name|drm_file
modifier|*
name|file_priv
parameter_list|)
block|{
comment|/* Not valid in KMS. */
return|return
operator|-
name|EINVAL
return|;
block|}
end_function

begin_define
define|#
directive|define
name|KMS_INVALID_IOCTL
parameter_list|(
name|name
parameter_list|)
define|\
value|static int								\ name(struct drm_device *dev, void *data, struct drm_file *file_priv)	\ {									\ 	DRM_ERROR("invalid ioctl with kms %s\n", __func__);		\ 	return -EINVAL;							\ }
end_define

begin_comment
comment|/*  * All these ioctls are invalid in kms world.  */
end_comment

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_init_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_start_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_stop_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_reset_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_idle_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_resume_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_engine_reset_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_fullscreen_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_swap_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_clear_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_vertex_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_indices_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_texture_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_stipple_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_indirect_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_vertex2_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_cmdbuf_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_getparam_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_flip_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_mem_alloc_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_mem_free_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_mem_init_heap_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_irq_emit_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_irq_wait_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_cp_setparam_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_surface_alloc_kms
argument_list|)
end_macro

begin_macro
name|KMS_INVALID_IOCTL
argument_list|(
argument|radeon_surface_free_kms
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|drm_ioctl_desc
name|radeon_ioctls_kms
index|[]
init|=
block|{
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CP_INIT
argument_list|,
name|radeon_cp_init_kms
argument_list|,
name|DRM_AUTH
operator||
name|DRM_MASTER
operator||
name|DRM_ROOT_ONLY
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CP_START
argument_list|,
name|radeon_cp_start_kms
argument_list|,
name|DRM_AUTH
operator||
name|DRM_MASTER
operator||
name|DRM_ROOT_ONLY
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CP_STOP
argument_list|,
name|radeon_cp_stop_kms
argument_list|,
name|DRM_AUTH
operator||
name|DRM_MASTER
operator||
name|DRM_ROOT_ONLY
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CP_RESET
argument_list|,
name|radeon_cp_reset_kms
argument_list|,
name|DRM_AUTH
operator||
name|DRM_MASTER
operator||
name|DRM_ROOT_ONLY
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CP_IDLE
argument_list|,
name|radeon_cp_idle_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CP_RESUME
argument_list|,
name|radeon_cp_resume_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_RESET
argument_list|,
name|radeon_engine_reset_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_FULLSCREEN
argument_list|,
name|radeon_fullscreen_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_SWAP
argument_list|,
name|radeon_cp_swap_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CLEAR
argument_list|,
name|radeon_cp_clear_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_VERTEX
argument_list|,
name|radeon_cp_vertex_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_INDICES
argument_list|,
name|radeon_cp_indices_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_TEXTURE
argument_list|,
name|radeon_cp_texture_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_STIPPLE
argument_list|,
name|radeon_cp_stipple_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_INDIRECT
argument_list|,
name|radeon_cp_indirect_kms
argument_list|,
name|DRM_AUTH
operator||
name|DRM_MASTER
operator||
name|DRM_ROOT_ONLY
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_VERTEX2
argument_list|,
name|radeon_cp_vertex2_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CMDBUF
argument_list|,
name|radeon_cp_cmdbuf_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GETPARAM
argument_list|,
name|radeon_cp_getparam_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_FLIP
argument_list|,
name|radeon_cp_flip_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_ALLOC
argument_list|,
name|radeon_mem_alloc_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_FREE
argument_list|,
name|radeon_mem_free_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_INIT_HEAP
argument_list|,
name|radeon_mem_init_heap_kms
argument_list|,
name|DRM_AUTH
operator||
name|DRM_MASTER
operator||
name|DRM_ROOT_ONLY
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_IRQ_EMIT
argument_list|,
name|radeon_irq_emit_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_IRQ_WAIT
argument_list|,
name|radeon_irq_wait_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_SETPARAM
argument_list|,
name|radeon_cp_setparam_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_SURF_ALLOC
argument_list|,
name|radeon_surface_alloc_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_SURF_FREE
argument_list|,
name|radeon_surface_free_kms
argument_list|,
name|DRM_AUTH
argument_list|)
block|,
comment|/* KMS */
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_INFO
argument_list|,
name|radeon_gem_info_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_CREATE
argument_list|,
name|radeon_gem_create_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_MMAP
argument_list|,
name|radeon_gem_mmap_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_SET_DOMAIN
argument_list|,
name|radeon_gem_set_domain_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_PREAD
argument_list|,
name|radeon_gem_pread_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_PWRITE
argument_list|,
name|radeon_gem_pwrite_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_WAIT_IDLE
argument_list|,
name|radeon_gem_wait_idle_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_CS
argument_list|,
name|radeon_cs_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_INFO
argument_list|,
name|radeon_info_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_SET_TILING
argument_list|,
name|radeon_gem_set_tiling_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_GET_TILING
argument_list|,
name|radeon_gem_get_tiling_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_BUSY
argument_list|,
name|radeon_gem_busy_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|,
name|DRM_IOCTL_DEF_DRV
argument_list|(
name|RADEON_GEM_VA
argument_list|,
name|radeon_gem_va_ioctl
argument_list|,
name|DRM_AUTH
operator||
name|DRM_UNLOCKED
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|radeon_max_kms_ioctl
init|=
name|DRM_ARRAY_SIZE
argument_list|(
name|radeon_ioctls_kms
argument_list|)
decl_stmt|;
end_decl_stmt

end_unit

