begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2008 Advanced Micro Devices, Inc.  * Copyright 2008 Red Hat Inc.  * Copyright 2009 Jerome Glisse.  *  * Permission is hereby granted, free of charge, to any person obtaining a  * copy of this software and associated documentation files (the "Software"),  * to deal in the Software without restriction, including without limitation  * the rights to use, copy, modify, merge, publish, distribute, sublicense,  * and/or sell copies of the Software, and to permit persons to whom the  * Software is furnished to do so, subject to the following conditions:  *  * The above copyright notice and this permission notice shall be included in  * all copies or substantial portions of the Software.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL  * THE COPYRIGHT HOLDER(S) OR AUTHOR(S) BE LIABLE FOR ANY CLAIM, DAMAGES OR  * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,  * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR  * OTHER DEALINGS IN THE SOFTWARE.  *  * Authors: Dave Airlie  *          Alex Deucher  *          Jerome Glisse  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/drm2/drmP.h>
end_include

begin_include
include|#
directive|include
file|<dev/drm2/radeon/radeon_drm.h>
end_include

begin_include
include|#
directive|include
file|"radeon_reg.h"
end_include

begin_include
include|#
directive|include
file|"radeon.h"
end_include

begin_include
include|#
directive|include
file|"radeon_asic.h"
end_include

begin_include
include|#
directive|include
file|"atom.h"
end_include

begin_comment
comment|/* 10 khz */
end_comment

begin_function
name|uint32_t
name|radeon_legacy_get_engine_clock
parameter_list|(
name|struct
name|radeon_device
modifier|*
name|rdev
parameter_list|)
block|{
name|struct
name|radeon_pll
modifier|*
name|spll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|spll
decl_stmt|;
name|uint32_t
name|fb_div
decl_stmt|,
name|ref_div
decl_stmt|,
name|post_div
decl_stmt|,
name|sclk
decl_stmt|;
name|fb_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
expr_stmt|;
name|fb_div
operator|=
operator|(
name|fb_div
operator|>>
name|RADEON_SPLL_FB_DIV_SHIFT
operator|)
operator|&
name|RADEON_SPLL_FB_DIV_MASK
expr_stmt|;
name|fb_div
operator|<<=
literal|1
expr_stmt|;
name|fb_div
operator|*=
name|spll
operator|->
name|reference_freq
expr_stmt|;
name|ref_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
operator|&
name|RADEON_M_SPLL_REF_DIV_MASK
expr_stmt|;
if|if
condition|(
name|ref_div
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|sclk
operator|=
name|fb_div
operator|/
name|ref_div
expr_stmt|;
name|post_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
operator|&
name|RADEON_SCLK_SRC_SEL_MASK
expr_stmt|;
if|if
condition|(
name|post_div
operator|==
literal|2
condition|)
name|sclk
operator|>>=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|post_div
operator|==
literal|3
condition|)
name|sclk
operator|>>=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|post_div
operator|==
literal|4
condition|)
name|sclk
operator|>>=
literal|3
expr_stmt|;
return|return
name|sclk
return|;
block|}
end_function

begin_comment
comment|/* 10 khz */
end_comment

begin_function
name|uint32_t
name|radeon_legacy_get_memory_clock
parameter_list|(
name|struct
name|radeon_device
modifier|*
name|rdev
parameter_list|)
block|{
name|struct
name|radeon_pll
modifier|*
name|mpll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|mpll
decl_stmt|;
name|uint32_t
name|fb_div
decl_stmt|,
name|ref_div
decl_stmt|,
name|post_div
decl_stmt|,
name|mclk
decl_stmt|;
name|fb_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
expr_stmt|;
name|fb_div
operator|=
operator|(
name|fb_div
operator|>>
name|RADEON_MPLL_FB_DIV_SHIFT
operator|)
operator|&
name|RADEON_MPLL_FB_DIV_MASK
expr_stmt|;
name|fb_div
operator|<<=
literal|1
expr_stmt|;
name|fb_div
operator|*=
name|mpll
operator|->
name|reference_freq
expr_stmt|;
name|ref_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
operator|&
name|RADEON_M_SPLL_REF_DIV_MASK
expr_stmt|;
if|if
condition|(
name|ref_div
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|mclk
operator|=
name|fb_div
operator|/
name|ref_div
expr_stmt|;
name|post_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|)
operator|&
literal|0x7
expr_stmt|;
if|if
condition|(
name|post_div
operator|==
literal|2
condition|)
name|mclk
operator|>>=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|post_div
operator|==
literal|3
condition|)
name|mclk
operator|>>=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|post_div
operator|==
literal|4
condition|)
name|mclk
operator|>>=
literal|3
expr_stmt|;
return|return
name|mclk
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_OF
end_ifdef

begin_comment
comment|/*  * Read XTAL (ref clock), SCLK and MCLK from Open Firmware device  * tree. Hopefully, ATI OF driver is kind enough to fill these  */
end_comment

begin_function
specifier|static
name|bool
name|radeon_read_clocks_OF
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|struct
name|device_node
modifier|*
name|dp
init|=
name|rdev
operator|->
name|pdev
operator|->
name|dev
operator|.
name|of_node
decl_stmt|;
specifier|const
name|u32
modifier|*
name|val
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|p1pll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|p1pll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|p2pll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|p2pll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|spll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|spll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|mpll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|mpll
decl_stmt|;
if|if
condition|(
name|dp
operator|==
name|NULL
condition|)
return|return
name|false
return|;
name|val
operator|=
name|of_get_property
argument_list|(
name|dp
argument_list|,
literal|"ATY,RefCLK"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|val
operator|||
operator|!
operator|*
name|val
condition|)
block|{
name|printk
argument_list|(
name|KERN_WARNING
literal|"radeonfb: No ATY,RefCLK property !\n"
argument_list|)
expr_stmt|;
return|return
name|false
return|;
block|}
name|p1pll
operator|->
name|reference_freq
operator|=
name|p2pll
operator|->
name|reference_freq
operator|=
operator|(
operator|*
name|val
operator|)
operator|/
literal|10
expr_stmt|;
name|p1pll
operator|->
name|reference_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PPLL_REF_DIV
argument_list|)
operator|&
literal|0x3ff
expr_stmt|;
if|if
condition|(
name|p1pll
operator|->
name|reference_div
operator|<
literal|2
condition|)
name|p1pll
operator|->
name|reference_div
operator|=
literal|12
expr_stmt|;
name|p2pll
operator|->
name|reference_div
operator|=
name|p1pll
operator|->
name|reference_div
expr_stmt|;
comment|/* These aren't in the device-tree */
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R420
condition|)
block|{
name|p1pll
operator|->
name|pll_in_min
operator|=
literal|100
expr_stmt|;
name|p1pll
operator|->
name|pll_in_max
operator|=
literal|1350
expr_stmt|;
name|p1pll
operator|->
name|pll_out_min
operator|=
literal|20000
expr_stmt|;
name|p1pll
operator|->
name|pll_out_max
operator|=
literal|50000
expr_stmt|;
name|p2pll
operator|->
name|pll_in_min
operator|=
literal|100
expr_stmt|;
name|p2pll
operator|->
name|pll_in_max
operator|=
literal|1350
expr_stmt|;
name|p2pll
operator|->
name|pll_out_min
operator|=
literal|20000
expr_stmt|;
name|p2pll
operator|->
name|pll_out_max
operator|=
literal|50000
expr_stmt|;
block|}
else|else
block|{
name|p1pll
operator|->
name|pll_in_min
operator|=
literal|40
expr_stmt|;
name|p1pll
operator|->
name|pll_in_max
operator|=
literal|500
expr_stmt|;
name|p1pll
operator|->
name|pll_out_min
operator|=
literal|12500
expr_stmt|;
name|p1pll
operator|->
name|pll_out_max
operator|=
literal|35000
expr_stmt|;
name|p2pll
operator|->
name|pll_in_min
operator|=
literal|40
expr_stmt|;
name|p2pll
operator|->
name|pll_in_max
operator|=
literal|500
expr_stmt|;
name|p2pll
operator|->
name|pll_out_min
operator|=
literal|12500
expr_stmt|;
name|p2pll
operator|->
name|pll_out_max
operator|=
literal|35000
expr_stmt|;
block|}
comment|/* not sure what the max should be in all cases */
name|rdev
operator|->
name|clock
operator|.
name|max_pixel_clock
operator|=
literal|35000
expr_stmt|;
name|spll
operator|->
name|reference_freq
operator|=
name|mpll
operator|->
name|reference_freq
operator|=
name|p1pll
operator|->
name|reference_freq
expr_stmt|;
name|spll
operator|->
name|reference_div
operator|=
name|mpll
operator|->
name|reference_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
operator|&
name|RADEON_M_SPLL_REF_DIV_MASK
expr_stmt|;
name|val
operator|=
name|of_get_property
argument_list|(
name|dp
argument_list|,
literal|"ATY,SCLK"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|&&
operator|*
name|val
condition|)
name|rdev
operator|->
name|clock
operator|.
name|default_sclk
operator|=
operator|(
operator|*
name|val
operator|)
operator|/
literal|10
expr_stmt|;
else|else
name|rdev
operator|->
name|clock
operator|.
name|default_sclk
operator|=
name|radeon_legacy_get_engine_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|val
operator|=
name|of_get_property
argument_list|(
name|dp
argument_list|,
literal|"ATY,MCLK"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|&&
operator|*
name|val
condition|)
name|rdev
operator|->
name|clock
operator|.
name|default_mclk
operator|=
operator|(
operator|*
name|val
operator|)
operator|/
literal|10
expr_stmt|;
else|else
name|rdev
operator|->
name|clock
operator|.
name|default_mclk
operator|=
name|radeon_legacy_get_memory_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|DRM_INFO
argument_list|(
literal|"Using device-tree clock info\n"
argument_list|)
expr_stmt|;
return|return
name|true
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_function
specifier|static
name|bool
name|radeon_read_clocks_OF
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
return|return
name|false
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_OF */
end_comment

begin_function
name|void
name|radeon_get_clock_info
parameter_list|(
name|struct
name|drm_device
modifier|*
name|dev
parameter_list|)
block|{
name|struct
name|radeon_device
modifier|*
name|rdev
init|=
name|dev
operator|->
name|dev_private
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|p1pll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|p1pll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|p2pll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|p2pll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|dcpll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|dcpll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|spll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|spll
decl_stmt|;
name|struct
name|radeon_pll
modifier|*
name|mpll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|mpll
decl_stmt|;
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|rdev
operator|->
name|is_atom_bios
condition|)
name|ret
operator|=
name|radeon_atom_get_clock_info
argument_list|(
name|dev
argument_list|)
expr_stmt|;
else|else
name|ret
operator|=
name|radeon_combios_get_clock_info
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
name|ret
operator|=
name|radeon_read_clocks_OF
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
block|{
if|if
condition|(
name|p1pll
operator|->
name|reference_div
operator|<
literal|2
condition|)
block|{
if|if
condition|(
operator|!
name|ASIC_IS_AVIVO
argument_list|(
name|rdev
argument_list|)
condition|)
block|{
name|u32
name|tmp
init|=
name|RREG32_PLL
argument_list|(
name|RADEON_PPLL_REF_DIV
argument_list|)
decl_stmt|;
if|if
condition|(
name|ASIC_IS_R300
argument_list|(
name|rdev
argument_list|)
condition|)
name|p1pll
operator|->
name|reference_div
operator|=
operator|(
name|tmp
operator|&
name|R300_PPLL_REF_DIV_ACC_MASK
operator|)
operator|>>
name|R300_PPLL_REF_DIV_ACC_SHIFT
expr_stmt|;
else|else
name|p1pll
operator|->
name|reference_div
operator|=
name|tmp
operator|&
name|RADEON_PPLL_REF_DIV_MASK
expr_stmt|;
if|if
condition|(
name|p1pll
operator|->
name|reference_div
operator|<
literal|2
condition|)
name|p1pll
operator|->
name|reference_div
operator|=
literal|12
expr_stmt|;
block|}
else|else
name|p1pll
operator|->
name|reference_div
operator|=
literal|12
expr_stmt|;
block|}
if|if
condition|(
name|p2pll
operator|->
name|reference_div
operator|<
literal|2
condition|)
name|p2pll
operator|->
name|reference_div
operator|=
literal|12
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|family
operator|<
name|CHIP_RS600
condition|)
block|{
if|if
condition|(
name|spll
operator|->
name|reference_div
operator|<
literal|2
condition|)
name|spll
operator|->
name|reference_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
operator|&
name|RADEON_M_SPLL_REF_DIV_MASK
expr_stmt|;
block|}
if|if
condition|(
name|mpll
operator|->
name|reference_div
operator|<
literal|2
condition|)
name|mpll
operator|->
name|reference_div
operator|=
name|spll
operator|->
name|reference_div
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|ASIC_IS_AVIVO
argument_list|(
name|rdev
argument_list|)
condition|)
block|{
comment|/* TODO FALLBACK */
block|}
else|else
block|{
name|DRM_INFO
argument_list|(
literal|"Using generic clock info\n"
argument_list|)
expr_stmt|;
comment|/* may need to be per card */
name|rdev
operator|->
name|clock
operator|.
name|max_pixel_clock
operator|=
literal|35000
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|flags
operator|&
name|RADEON_IS_IGP
condition|)
block|{
name|p1pll
operator|->
name|reference_freq
operator|=
literal|1432
expr_stmt|;
name|p2pll
operator|->
name|reference_freq
operator|=
literal|1432
expr_stmt|;
name|spll
operator|->
name|reference_freq
operator|=
literal|1432
expr_stmt|;
name|mpll
operator|->
name|reference_freq
operator|=
literal|1432
expr_stmt|;
block|}
else|else
block|{
name|p1pll
operator|->
name|reference_freq
operator|=
literal|2700
expr_stmt|;
name|p2pll
operator|->
name|reference_freq
operator|=
literal|2700
expr_stmt|;
name|spll
operator|->
name|reference_freq
operator|=
literal|2700
expr_stmt|;
name|mpll
operator|->
name|reference_freq
operator|=
literal|2700
expr_stmt|;
block|}
name|p1pll
operator|->
name|reference_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PPLL_REF_DIV
argument_list|)
operator|&
literal|0x3ff
expr_stmt|;
if|if
condition|(
name|p1pll
operator|->
name|reference_div
operator|<
literal|2
condition|)
name|p1pll
operator|->
name|reference_div
operator|=
literal|12
expr_stmt|;
name|p2pll
operator|->
name|reference_div
operator|=
name|p1pll
operator|->
name|reference_div
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_R420
condition|)
block|{
name|p1pll
operator|->
name|pll_in_min
operator|=
literal|100
expr_stmt|;
name|p1pll
operator|->
name|pll_in_max
operator|=
literal|1350
expr_stmt|;
name|p1pll
operator|->
name|pll_out_min
operator|=
literal|20000
expr_stmt|;
name|p1pll
operator|->
name|pll_out_max
operator|=
literal|50000
expr_stmt|;
name|p2pll
operator|->
name|pll_in_min
operator|=
literal|100
expr_stmt|;
name|p2pll
operator|->
name|pll_in_max
operator|=
literal|1350
expr_stmt|;
name|p2pll
operator|->
name|pll_out_min
operator|=
literal|20000
expr_stmt|;
name|p2pll
operator|->
name|pll_out_max
operator|=
literal|50000
expr_stmt|;
block|}
else|else
block|{
name|p1pll
operator|->
name|pll_in_min
operator|=
literal|40
expr_stmt|;
name|p1pll
operator|->
name|pll_in_max
operator|=
literal|500
expr_stmt|;
name|p1pll
operator|->
name|pll_out_min
operator|=
literal|12500
expr_stmt|;
name|p1pll
operator|->
name|pll_out_max
operator|=
literal|35000
expr_stmt|;
name|p2pll
operator|->
name|pll_in_min
operator|=
literal|40
expr_stmt|;
name|p2pll
operator|->
name|pll_in_max
operator|=
literal|500
expr_stmt|;
name|p2pll
operator|->
name|pll_out_min
operator|=
literal|12500
expr_stmt|;
name|p2pll
operator|->
name|pll_out_max
operator|=
literal|35000
expr_stmt|;
block|}
name|spll
operator|->
name|reference_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
operator|&
name|RADEON_M_SPLL_REF_DIV_MASK
expr_stmt|;
name|mpll
operator|->
name|reference_div
operator|=
name|spll
operator|->
name|reference_div
expr_stmt|;
name|rdev
operator|->
name|clock
operator|.
name|default_sclk
operator|=
name|radeon_legacy_get_engine_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|rdev
operator|->
name|clock
operator|.
name|default_mclk
operator|=
name|radeon_legacy_get_memory_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* pixel clocks */
if|if
condition|(
name|ASIC_IS_AVIVO
argument_list|(
name|rdev
argument_list|)
condition|)
block|{
name|p1pll
operator|->
name|min_post_div
operator|=
literal|2
expr_stmt|;
name|p1pll
operator|->
name|max_post_div
operator|=
literal|0x7f
expr_stmt|;
name|p1pll
operator|->
name|min_frac_feedback_div
operator|=
literal|0
expr_stmt|;
name|p1pll
operator|->
name|max_frac_feedback_div
operator|=
literal|9
expr_stmt|;
name|p2pll
operator|->
name|min_post_div
operator|=
literal|2
expr_stmt|;
name|p2pll
operator|->
name|max_post_div
operator|=
literal|0x7f
expr_stmt|;
name|p2pll
operator|->
name|min_frac_feedback_div
operator|=
literal|0
expr_stmt|;
name|p2pll
operator|->
name|max_frac_feedback_div
operator|=
literal|9
expr_stmt|;
block|}
else|else
block|{
name|p1pll
operator|->
name|min_post_div
operator|=
literal|1
expr_stmt|;
name|p1pll
operator|->
name|max_post_div
operator|=
literal|16
expr_stmt|;
name|p1pll
operator|->
name|min_frac_feedback_div
operator|=
literal|0
expr_stmt|;
name|p1pll
operator|->
name|max_frac_feedback_div
operator|=
literal|0
expr_stmt|;
name|p2pll
operator|->
name|min_post_div
operator|=
literal|1
expr_stmt|;
name|p2pll
operator|->
name|max_post_div
operator|=
literal|12
expr_stmt|;
name|p2pll
operator|->
name|min_frac_feedback_div
operator|=
literal|0
expr_stmt|;
name|p2pll
operator|->
name|max_frac_feedback_div
operator|=
literal|0
expr_stmt|;
block|}
comment|/* dcpll is DCE4 only */
name|dcpll
operator|->
name|min_post_div
operator|=
literal|2
expr_stmt|;
name|dcpll
operator|->
name|max_post_div
operator|=
literal|0x7f
expr_stmt|;
name|dcpll
operator|->
name|min_frac_feedback_div
operator|=
literal|0
expr_stmt|;
name|dcpll
operator|->
name|max_frac_feedback_div
operator|=
literal|9
expr_stmt|;
name|dcpll
operator|->
name|min_ref_div
operator|=
literal|2
expr_stmt|;
name|dcpll
operator|->
name|max_ref_div
operator|=
literal|0x3ff
expr_stmt|;
name|dcpll
operator|->
name|min_feedback_div
operator|=
literal|4
expr_stmt|;
name|dcpll
operator|->
name|max_feedback_div
operator|=
literal|0xfff
expr_stmt|;
name|dcpll
operator|->
name|best_vco
operator|=
literal|0
expr_stmt|;
name|p1pll
operator|->
name|min_ref_div
operator|=
literal|2
expr_stmt|;
name|p1pll
operator|->
name|max_ref_div
operator|=
literal|0x3ff
expr_stmt|;
name|p1pll
operator|->
name|min_feedback_div
operator|=
literal|4
expr_stmt|;
name|p1pll
operator|->
name|max_feedback_div
operator|=
literal|0x7ff
expr_stmt|;
name|p1pll
operator|->
name|best_vco
operator|=
literal|0
expr_stmt|;
name|p2pll
operator|->
name|min_ref_div
operator|=
literal|2
expr_stmt|;
name|p2pll
operator|->
name|max_ref_div
operator|=
literal|0x3ff
expr_stmt|;
name|p2pll
operator|->
name|min_feedback_div
operator|=
literal|4
expr_stmt|;
name|p2pll
operator|->
name|max_feedback_div
operator|=
literal|0x7ff
expr_stmt|;
name|p2pll
operator|->
name|best_vco
operator|=
literal|0
expr_stmt|;
comment|/* system clock */
name|spll
operator|->
name|min_post_div
operator|=
literal|1
expr_stmt|;
name|spll
operator|->
name|max_post_div
operator|=
literal|1
expr_stmt|;
name|spll
operator|->
name|min_ref_div
operator|=
literal|2
expr_stmt|;
name|spll
operator|->
name|max_ref_div
operator|=
literal|0xff
expr_stmt|;
name|spll
operator|->
name|min_feedback_div
operator|=
literal|4
expr_stmt|;
name|spll
operator|->
name|max_feedback_div
operator|=
literal|0xff
expr_stmt|;
name|spll
operator|->
name|best_vco
operator|=
literal|0
expr_stmt|;
comment|/* memory clock */
name|mpll
operator|->
name|min_post_div
operator|=
literal|1
expr_stmt|;
name|mpll
operator|->
name|max_post_div
operator|=
literal|1
expr_stmt|;
name|mpll
operator|->
name|min_ref_div
operator|=
literal|2
expr_stmt|;
name|mpll
operator|->
name|max_ref_div
operator|=
literal|0xff
expr_stmt|;
name|mpll
operator|->
name|min_feedback_div
operator|=
literal|4
expr_stmt|;
name|mpll
operator|->
name|max_feedback_div
operator|=
literal|0xff
expr_stmt|;
name|mpll
operator|->
name|best_vco
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|rdev
operator|->
name|clock
operator|.
name|default_sclk
condition|)
name|rdev
operator|->
name|clock
operator|.
name|default_sclk
operator|=
name|radeon_get_engine_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|rdev
operator|->
name|clock
operator|.
name|default_mclk
operator|)
operator|&&
name|rdev
operator|->
name|asic
operator|->
name|pm
operator|.
name|get_memory_clock
condition|)
name|rdev
operator|->
name|clock
operator|.
name|default_mclk
operator|=
name|radeon_get_memory_clock
argument_list|(
name|rdev
argument_list|)
expr_stmt|;
name|rdev
operator|->
name|pm
operator|.
name|current_sclk
operator|=
name|rdev
operator|->
name|clock
operator|.
name|default_sclk
expr_stmt|;
name|rdev
operator|->
name|pm
operator|.
name|current_mclk
operator|=
name|rdev
operator|->
name|clock
operator|.
name|default_mclk
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 10 khz */
end_comment

begin_function
specifier|static
name|uint32_t
name|calc_eng_mem_clock
parameter_list|(
name|struct
name|radeon_device
modifier|*
name|rdev
parameter_list|,
name|uint32_t
name|req_clock
parameter_list|,
name|int
modifier|*
name|fb_div
parameter_list|,
name|int
modifier|*
name|post_div
parameter_list|)
block|{
name|struct
name|radeon_pll
modifier|*
name|spll
init|=
operator|&
name|rdev
operator|->
name|clock
operator|.
name|spll
decl_stmt|;
name|int
name|ref_div
init|=
name|spll
operator|->
name|reference_div
decl_stmt|;
if|if
condition|(
operator|!
name|ref_div
condition|)
name|ref_div
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
operator|&
name|RADEON_M_SPLL_REF_DIV_MASK
expr_stmt|;
if|if
condition|(
name|req_clock
operator|<
literal|15000
condition|)
block|{
operator|*
name|post_div
operator|=
literal|8
expr_stmt|;
name|req_clock
operator|*=
literal|8
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|req_clock
operator|<
literal|30000
condition|)
block|{
operator|*
name|post_div
operator|=
literal|4
expr_stmt|;
name|req_clock
operator|*=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|req_clock
operator|<
literal|60000
condition|)
block|{
operator|*
name|post_div
operator|=
literal|2
expr_stmt|;
name|req_clock
operator|*=
literal|2
expr_stmt|;
block|}
else|else
operator|*
name|post_div
operator|=
literal|1
expr_stmt|;
name|req_clock
operator|*=
name|ref_div
expr_stmt|;
name|req_clock
operator|+=
name|spll
operator|->
name|reference_freq
expr_stmt|;
name|req_clock
operator|/=
operator|(
literal|2
operator|*
name|spll
operator|->
name|reference_freq
operator|)
expr_stmt|;
operator|*
name|fb_div
operator|=
name|req_clock
operator|&
literal|0xff
expr_stmt|;
name|req_clock
operator|=
operator|(
name|req_clock
operator|&
literal|0xffff
operator|)
operator|<<
literal|1
expr_stmt|;
name|req_clock
operator|*=
name|spll
operator|->
name|reference_freq
expr_stmt|;
name|req_clock
operator|/=
name|ref_div
expr_stmt|;
name|req_clock
operator|/=
operator|*
name|post_div
expr_stmt|;
return|return
name|req_clock
return|;
block|}
end_function

begin_comment
comment|/* 10 khz */
end_comment

begin_function
name|void
name|radeon_legacy_set_engine_clock
parameter_list|(
name|struct
name|radeon_device
modifier|*
name|rdev
parameter_list|,
name|uint32_t
name|eng_clock
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|int
name|fb_div
decl_stmt|,
name|post_div
decl_stmt|;
comment|/* XXX: wait for idle */
name|eng_clock
operator|=
name|calc_eng_mem_clock
argument_list|(
name|rdev
argument_list|,
name|eng_clock
argument_list|,
operator|&
name|fb_div
argument_list|,
operator|&
name|post_div
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_CLK_PIN_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_DONT_USE_XTALIN
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_CLK_PIN_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SCLK_SRC_SEL_MASK
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SPLL_SLEEP
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SPLL_RESET
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_SPLL_FB_DIV_MASK
operator|<<
name|RADEON_SPLL_FB_DIV_SHIFT
operator|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|fb_div
operator|&
name|RADEON_SPLL_FB_DIV_MASK
operator|)
operator|<<
name|RADEON_SPLL_FB_DIV_SHIFT
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_M_SPLL_REF_FB_DIV
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
comment|/* XXX: verify on different asics */
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SPLL_PVG_MASK
expr_stmt|;
if|if
condition|(
operator|(
name|eng_clock
operator|*
name|post_div
operator|)
operator|>=
literal|90000
condition|)
name|tmp
operator||=
operator|(
literal|0x7
operator|<<
name|RADEON_SPLL_PVG_SHIFT
operator|)
expr_stmt|;
else|else
name|tmp
operator||=
operator|(
literal|0x4
operator|<<
name|RADEON_SPLL_PVG_SHIFT
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SPLL_SLEEP
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SPLL_RESET
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SPLL_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SCLK_SRC_SEL_MASK
expr_stmt|;
switch|switch
condition|(
name|post_div
condition|)
block|{
case|case
literal|1
case|:
default|default:
name|tmp
operator||=
literal|1
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|tmp
operator||=
literal|2
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|tmp
operator||=
literal|3
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|tmp
operator||=
literal|4
expr_stmt|;
break|break;
block|}
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_CLK_PIN_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_DONT_USE_XTALIN
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_CLK_PIN_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_UDELAY
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|radeon_legacy_set_clock_gating
parameter_list|(
name|struct
name|radeon_device
modifier|*
name|rdev
parameter_list|,
name|int
name|enable
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
name|enable
condition|)
block|{
if|if
condition|(
name|rdev
operator|->
name|flags
operator|&
name|RADEON_SINGLE_CRTC
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|RREG32
argument_list|(
name|RADEON_CONFIG_CNTL
argument_list|)
operator|&
name|RADEON_CFG_ATI_REV_ID_MASK
operator|)
operator|>
name|RADEON_CFG_ATI_REV_A13
condition|)
block|{
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_RB
operator|)
expr_stmt|;
block|}
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_SE
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_RE
operator||
name|RADEON_SCLK_FORCE_PB
operator||
name|RADEON_SCLK_FORCE_TAM
operator||
name|RADEON_SCLK_FORCE_TDM
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ASIC_IS_R300
argument_list|(
name|rdev
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RS400
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RS480
operator|)
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_SCLK_FORCE_DISP2
operator||
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_E2
operator||
name|R300_SCLK_FORCE_VAP
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_VIP
operator||
name|R300_SCLK_FORCE_SR
operator||
name|R300_SCLK_FORCE_PX
operator||
name|R300_SCLK_FORCE_TX
operator||
name|R300_SCLK_FORCE_US
operator||
name|RADEON_SCLK_FORCE_TV_SCLK
operator||
name|R300_SCLK_FORCE_SU
operator||
name|RADEON_SCLK_FORCE_OV0
operator|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_DYN_STOP_LAT_MASK
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_VIP
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_MORE_MAX_DYN_STOP_LAT
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_PIXCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DAC_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_PIX2CLK_ALWAYS_ONb
operator||
name|RADEON_PIX2CLK_DAC_ALWAYS_ONb
operator||
name|RADEON_DISP_TVOUT_PIXCLK_TV_ALWAYS_ONb
operator||
name|R300_DVOCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_BLEND_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_GV_ALWAYS_ONb
operator||
name|R300_PIXCLK_DVO_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_LVDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_TMDS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TRANS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TVO_ALWAYS_ONb
operator||
name|R300_P2G2CLK_ALWAYS_ONb
operator||
name|R300_P2G2CLK_DAC_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV350
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|R300_SCLK_FORCE_TCL
operator||
name|R300_SCLK_FORCE_GA
operator||
name|R300_SCLK_FORCE_CBA
operator|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|R300_SCLK_TCL_MAX_DYN_STOP_LAT
operator||
name|R300_SCLK_GA_MAX_DYN_STOP_LAT
operator||
name|R300_SCLK_CBA_MAX_DYN_STOP_LAT
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_SCLK_FORCE_DISP2
operator||
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_E2
operator||
name|R300_SCLK_FORCE_VAP
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_VIP
operator||
name|R300_SCLK_FORCE_SR
operator||
name|R300_SCLK_FORCE_PX
operator||
name|R300_SCLK_FORCE_TX
operator||
name|R300_SCLK_FORCE_US
operator||
name|RADEON_SCLK_FORCE_TV_SCLK
operator||
name|R300_SCLK_FORCE_SU
operator||
name|RADEON_SCLK_FORCE_OV0
operator|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_DYN_STOP_LAT_MASK
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_MORE_MAX_DYN_STOP_LAT
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_PIXCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DAC_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_PIX2CLK_ALWAYS_ONb
operator||
name|RADEON_PIX2CLK_DAC_ALWAYS_ONb
operator||
name|RADEON_DISP_TVOUT_PIXCLK_TV_ALWAYS_ONb
operator||
name|R300_DVOCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_BLEND_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_GV_ALWAYS_ONb
operator||
name|R300_PIXCLK_DVO_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_LVDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_TMDS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TRANS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TVO_ALWAYS_ONb
operator||
name|R300_P2G2CLK_ALWAYS_ONb
operator||
name|R300_P2G2CLK_DAC_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_MCLK_MISC
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_MC_MCLK_DYN_ENABLE
operator||
name|RADEON_IO_MCLK_DYN_ENABLE
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_MCLK_MISC
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_FORCEON_MCLKA
operator||
name|RADEON_FORCEON_MCLKB
operator|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_FORCEON_YCLKA
operator||
name|RADEON_FORCEON_YCLKB
operator||
name|RADEON_FORCEON_MC
operator|)
expr_stmt|;
comment|/* Some releases of vbios have set DISABLE_MC_MCLKA 				   and DISABLE_MC_MCLKB bits in the vbios table.  Setting these 				   bits will cause H/W hang when reading video memory with dynamic clocking 				   enabled. */
if|if
condition|(
operator|(
name|tmp
operator|&
name|R300_DISABLE_MC_MCLKA
operator|)
operator|&&
operator|(
name|tmp
operator|&
name|R300_DISABLE_MC_MCLKB
operator|)
condition|)
block|{
comment|/* If both bits are set, then check the active channels */
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|)
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|mc
operator|.
name|vram_width
operator|==
literal|64
condition|)
block|{
if|if
condition|(
name|RREG32
argument_list|(
name|RADEON_MEM_CNTL
argument_list|)
operator|&
name|R300_MEM_USE_CD_CH_ONLY
condition|)
name|tmp
operator|&=
operator|~
name|R300_DISABLE_MC_MCLKB
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|R300_DISABLE_MC_MCLKA
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|&=
operator|~
operator|(
name|R300_DISABLE_MC_MCLKA
operator||
name|R300_DISABLE_MC_MCLKB
operator|)
expr_stmt|;
block|}
block|}
name|WREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|R300_SCLK_FORCE_VAP
operator|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_FORCE_CP
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|R300_SCLK_FORCE_TCL
operator||
name|R300_SCLK_FORCE_GA
operator||
name|R300_SCLK_FORCE_CBA
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_CLK_PWRMGT_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_ACTIVE_HILO_LAT_MASK
operator||
name|RADEON_DISP_DYN_STOP_LAT_MASK
operator||
name|RADEON_DYN_STOP_MODE_MASK
operator|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_ENGIN_DYNCLK_MODE
operator||
operator|(
literal|0x01
operator|<<
name|RADEON_ACTIVE_HILO_LAT_SHIFT
operator|)
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_CLK_PWRMGT_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_CLK_PIN_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_DYN_START_CNTL
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_CLK_PIN_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
comment|/* When DRI is enabled, setting DYN_STOP_LAT to zero can cause some R200 			   to lockup randomly, leave them as set by BIOS. 			 */
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
comment|/*tmp&= RADEON_SCLK_SRC_SEL_MASK; */
name|tmp
operator|&=
operator|~
name|RADEON_SCLK_FORCEON_MASK
expr_stmt|;
comment|/*RAGE_6::A11 A12 A12N1 A13, RV250::A11 A12, R300 */
if|if
condition|(
operator|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV250
operator|)
operator|&&
operator|(
operator|(
name|RREG32
argument_list|(
name|RADEON_CONFIG_CNTL
argument_list|)
operator|&
name|RADEON_CFG_ATI_REV_ID_MASK
operator|)
operator|<
name|RADEON_CFG_ATI_REV_A13
operator|)
operator|)
operator|||
operator|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV100
operator|)
operator|&&
operator|(
operator|(
name|RREG32
argument_list|(
name|RADEON_CONFIG_CNTL
argument_list|)
operator|&
name|RADEON_CFG_ATI_REV_ID_MASK
operator|)
operator|<=
name|RADEON_CFG_ATI_REV_A13
operator|)
operator|)
condition|)
block|{
name|tmp
operator||=
name|RADEON_SCLK_FORCE_CP
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_FORCE_VIP
expr_stmt|;
block|}
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV200
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV250
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV280
operator|)
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
comment|/* RV200::A11 A12 RV250::A11 A12 */
if|if
condition|(
operator|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV200
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV250
operator|)
operator|)
operator|&&
operator|(
operator|(
name|RREG32
argument_list|(
name|RADEON_CONFIG_CNTL
argument_list|)
operator|&
name|RADEON_CFG_ATI_REV_ID_MASK
operator|)
operator|<
name|RADEON_CFG_ATI_REV_A13
operator|)
condition|)
block|{
name|tmp
operator||=
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
block|}
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
block|}
comment|/* RV200::A11 A12, RV250::A11 A12 */
if|if
condition|(
operator|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV200
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV250
operator|)
operator|)
operator|&&
operator|(
operator|(
name|RREG32
argument_list|(
name|RADEON_CONFIG_CNTL
argument_list|)
operator|&
name|RADEON_CFG_ATI_REV_ID_MASK
operator|)
operator|<
name|RADEON_CFG_ATI_REV_A13
operator|)
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PLL_PWRMGT_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_TCL_BYPASS_DISABLE
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PLL_PWRMGT_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
comment|/*enable dynamic mode for display clocks (PIXCLK and PIX2CLK) */
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_PIX2CLK_ALWAYS_ONb
operator||
name|RADEON_PIX2CLK_DAC_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_BLEND_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_GV_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DIG_TMDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_LVDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_TMDS_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_PIXCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DAC_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|15
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Turn everything OFF (ForceON to everything) */
if|if
condition|(
name|rdev
operator|->
name|flags
operator|&
name|RADEON_SINGLE_CRTC
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_E2
operator||
name|RADEON_SCLK_FORCE_SE
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_VIP
operator||
name|RADEON_SCLK_FORCE_RE
operator||
name|RADEON_SCLK_FORCE_PB
operator||
name|RADEON_SCLK_FORCE_TAM
operator||
name|RADEON_SCLK_FORCE_TDM
operator||
name|RADEON_SCLK_FORCE_RB
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RS400
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RS480
operator|)
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_SCLK_FORCE_DISP2
operator||
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_E2
operator||
name|R300_SCLK_FORCE_VAP
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_VIP
operator||
name|R300_SCLK_FORCE_SR
operator||
name|R300_SCLK_FORCE_PX
operator||
name|R300_SCLK_FORCE_TX
operator||
name|R300_SCLK_FORCE_US
operator||
name|RADEON_SCLK_FORCE_TV_SCLK
operator||
name|R300_SCLK_FORCE_SU
operator||
name|RADEON_SCLK_FORCE_OV0
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_PIXCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DAC_ALWAYS_ONb
operator||
name|R300_DISP_DAC_PIXCLK_DAC_BLANK_OFF
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_PIX2CLK_ALWAYS_ONb
operator||
name|RADEON_PIX2CLK_DAC_ALWAYS_ONb
operator||
name|RADEON_DISP_TVOUT_PIXCLK_TV_ALWAYS_ONb
operator||
name|R300_DVOCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_BLEND_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_GV_ALWAYS_ONb
operator||
name|R300_PIXCLK_DVO_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_LVDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_TMDS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TRANS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TVO_ALWAYS_ONb
operator||
name|R300_P2G2CLK_ALWAYS_ONb
operator||
name|R300_P2G2CLK_DAC_ALWAYS_ONb
operator||
name|R300_DISP_DAC_PIXCLK_DAC2_BLANK_OFF
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|rdev
operator|->
name|family
operator|>=
name|CHIP_RV350
condition|)
block|{
comment|/* for RV350/M10, no delays are required. */
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|R300_SCLK_FORCE_TCL
operator||
name|R300_SCLK_FORCE_GA
operator||
name|R300_SCLK_FORCE_CBA
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_SCLK_FORCE_DISP2
operator||
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_E2
operator||
name|R300_SCLK_FORCE_VAP
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_VIP
operator||
name|R300_SCLK_FORCE_SR
operator||
name|R300_SCLK_FORCE_PX
operator||
name|R300_SCLK_FORCE_TX
operator||
name|R300_SCLK_FORCE_US
operator||
name|RADEON_SCLK_FORCE_TV_SCLK
operator||
name|R300_SCLK_FORCE_SU
operator||
name|RADEON_SCLK_FORCE_OV0
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_FORCEON_MCLKA
operator||
name|RADEON_FORCEON_MCLKB
operator||
name|RADEON_FORCEON_YCLKA
operator||
name|RADEON_FORCEON_YCLKB
operator||
name|RADEON_FORCEON_MC
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_PIXCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DAC_ALWAYS_ONb
operator||
name|R300_DISP_DAC_PIXCLK_DAC_BLANK_OFF
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_PIX2CLK_ALWAYS_ONb
operator||
name|RADEON_PIX2CLK_DAC_ALWAYS_ONb
operator||
name|RADEON_DISP_TVOUT_PIXCLK_TV_ALWAYS_ONb
operator||
name|R300_DVOCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_BLEND_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_GV_ALWAYS_ONb
operator||
name|R300_PIXCLK_DVO_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_LVDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_TMDS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TRANS_ALWAYS_ONb
operator||
name|R300_PIXCLK_TVO_ALWAYS_ONb
operator||
name|R300_P2G2CLK_ALWAYS_ONb
operator||
name|R300_P2G2CLK_DAC_ALWAYS_ONb
operator||
name|R300_DISP_DAC_PIXCLK_DAC2_BLANK_OFF
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|RADEON_SCLK_FORCE_CP
operator||
name|RADEON_SCLK_FORCE_E2
operator|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_FORCE_SE
expr_stmt|;
if|if
condition|(
name|rdev
operator|->
name|flags
operator|&
name|RADEON_SINGLE_CRTC
condition|)
block|{
name|tmp
operator||=
operator|(
name|RADEON_SCLK_FORCE_RB
operator||
name|RADEON_SCLK_FORCE_TDM
operator||
name|RADEON_SCLK_FORCE_TAM
operator||
name|RADEON_SCLK_FORCE_PB
operator||
name|RADEON_SCLK_FORCE_RE
operator||
name|RADEON_SCLK_FORCE_VIP
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_DISP2
operator||
name|RADEON_SCLK_FORCE_HDP
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_R300
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_R350
operator|)
condition|)
block|{
name|tmp
operator||=
operator|(
name|RADEON_SCLK_FORCE_HDP
operator||
name|RADEON_SCLK_FORCE_DISP1
operator||
name|RADEON_SCLK_FORCE_DISP2
operator||
name|RADEON_SCLK_FORCE_TOP
operator||
name|RADEON_SCLK_FORCE_IDCT
operator||
name|RADEON_SCLK_FORCE_VIP
operator|)
expr_stmt|;
block|}
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_R300
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_R350
operator|)
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|R300_SCLK_FORCE_TCL
operator||
name|R300_SCLK_FORCE_GA
operator||
name|R300_SCLK_FORCE_CBA
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|R300_SCLK_CNTL2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|16
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rdev
operator|->
name|flags
operator|&
name|RADEON_IS_IGP
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_FORCEON_MCLKA
operator||
name|RADEON_FORCEON_YCLKA
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_MCLK_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|16
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV200
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV250
operator|)
operator|||
operator|(
name|rdev
operator|->
name|family
operator|==
name|CHIP_RV280
operator|)
condition|)
block|{
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|RADEON_SCLK_MORE_FORCEON
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_SCLK_MORE_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|16
argument_list|)
expr_stmt|;
block|}
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_PIX2CLK_ALWAYS_ONb
operator||
name|RADEON_PIX2CLK_DAC_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_BLEND_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_GV_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DIG_TMDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_LVDS_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_TMDS_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_PIXCLKS_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DRM_MDELAY
argument_list|(
literal|16
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|RREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
name|RADEON_PIXCLK_ALWAYS_ONb
operator||
name|RADEON_PIXCLK_DAC_ALWAYS_ONb
operator|)
expr_stmt|;
name|WREG32_PLL
argument_list|(
name|RADEON_VCLK_ECP_CNTL
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

end_unit

