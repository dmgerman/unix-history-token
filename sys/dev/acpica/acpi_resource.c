begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2000 Michael Smith  * Copyright (c) 2000 BSDi  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  *	$FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|"opt_acpi.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/resource.h>
end_include

begin_include
include|#
directive|include
file|<sys/rman.h>
end_include

begin_include
include|#
directive|include
file|"acpi.h"
end_include

begin_include
include|#
directive|include
file|<dev/acpica/acpivar.h>
end_include

begin_comment
comment|/*  * Hooks for the ACPI CA debugging infrastructure  */
end_comment

begin_define
define|#
directive|define
name|_COMPONENT
value|ACPI_BUS
end_define

begin_macro
name|ACPI_MODULE_NAME
argument_list|(
literal|"RESOURCE"
argument_list|)
end_macro

begin_comment
comment|/*  * Fetch a device's resources and associate them with the device.  *  * Note that it might be nice to also locate ACPI-specific resource items, such  * as GPE bits.  *  * We really need to split the resource-fetching code out from the  * resource-parsing code, since we may want to use the parsing  * code for _PRS someday.  */
end_comment

begin_function
name|ACPI_STATUS
name|acpi_parse_resources
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|ACPI_HANDLE
name|handle
parameter_list|,
name|struct
name|acpi_parse_resource_set
modifier|*
name|set
parameter_list|)
block|{
name|ACPI_BUFFER
name|buf
decl_stmt|;
name|ACPI_RESOURCE
modifier|*
name|res
decl_stmt|;
name|char
modifier|*
name|curr
decl_stmt|,
modifier|*
name|last
decl_stmt|;
name|ACPI_STATUS
name|status
decl_stmt|;
name|void
modifier|*
name|context
decl_stmt|;
name|ACPI_FUNCTION_TRACE
argument_list|(
name|__func__
argument_list|)
expr_stmt|;
comment|/*      * Special-case some devices that abuse _PRS/_CRS to mean      * something other than "I consume this resource".      *      * XXX do we really need this?  It's only relevant once      *     we start always-allocating these resources, and even      *     then, the only special-cased device is likely to be      *     the PCI interrupt link.      */
comment|/*      * Fetch the device's current resources.      */
name|buf
operator|.
name|Length
operator|=
name|ACPI_ALLOCATE_BUFFER
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
operator|(
name|status
operator|=
name|AcpiGetCurrentResources
argument_list|(
name|handle
argument_list|,
operator|&
name|buf
argument_list|)
operator|)
argument_list|)
condition|)
block|{
if|if
condition|(
name|status
operator|!=
name|AE_NOT_FOUND
condition|)
name|printf
argument_list|(
literal|"can't fetch resources for %s - %s\n"
argument_list|,
name|acpi_name
argument_list|(
name|handle
argument_list|)
argument_list|,
name|AcpiFormatException
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|return_ACPI_STATUS
argument_list|(
name|status
argument_list|)
expr_stmt|;
block|}
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"%s - got %d bytes of resources\n"
operator|,
name|acpi_name
argument_list|(
name|handle
argument_list|)
operator|,
name|buf
operator|.
name|Length
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_init
argument_list|(
name|dev
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/*      * Iterate through the resources      */
name|curr
operator|=
name|buf
operator|.
name|Pointer
expr_stmt|;
name|last
operator|=
operator|(
name|char
operator|*
operator|)
name|buf
operator|.
name|Pointer
operator|+
name|buf
operator|.
name|Length
expr_stmt|;
while|while
condition|(
name|curr
operator|<
name|last
condition|)
block|{
name|res
operator|=
operator|(
name|ACPI_RESOURCE
operator|*
operator|)
name|curr
expr_stmt|;
name|curr
operator|+=
name|res
operator|->
name|Length
expr_stmt|;
comment|/* 	 * Handle the individual resource types 	 */
switch|switch
condition|(
name|res
operator|->
name|Id
condition|)
block|{
case|case
name|ACPI_RSTYPE_END_TAG
case|:
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"EndTag\n"
operator|)
argument_list|)
expr_stmt|;
name|curr
operator|=
name|last
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_FIXED_IO
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|RangeLength
operator|<=
literal|0
condition|)
break|break;
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"FixedIo 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|BaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_ioport
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|BaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_IO
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
operator|<=
literal|0
condition|)
break|break;
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
operator|==
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MaxBaseAddress
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Io 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_ioport
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Io 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MaxBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_iorange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MaxBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|Alignment
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_FIXED_MEM32
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeLength
operator|<=
literal|0
condition|)
break|break;
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"FixedMemory32 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_MEM32
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
operator|<=
literal|0
condition|)
break|break;
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
operator|==
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MaxBaseAddress
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Memory32 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Memory32 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MaxBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memoryrange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MaxBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|Alignment
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_MEM24
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
operator|<=
literal|0
condition|)
break|break;
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
operator|==
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MaxBaseAddress
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Memory24 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Memory24 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MaxBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memoryrange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MaxBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|Alignment
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_IRQ
case|:
comment|/* 	     * from 1.0b 6.4.2  	     * "This structure is repeated for each separate interrupt 	     * required" 	     */
name|set
operator|->
name|set_irq
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Irq
operator|.
name|Interrupts
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Irq
operator|.
name|NumberOfInterrupts
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_DMA
case|:
comment|/* 	     * from 1.0b 6.4.3  	     * "This structure is repeated for each separate dma channel 	     * required" 	     */
name|set
operator|->
name|set_drq
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Dma
operator|.
name|Channels
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Dma
operator|.
name|NumberOfChannels
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_START_DPF
case|:
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"start dependant functions\n"
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_start_dependant
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|StartDpf
operator|.
name|CompatibilityPriority
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_END_DPF
case|:
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"end dependant functions\n"
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_end_dependant
argument_list|(
name|dev
argument_list|,
name|context
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_ADDRESS32
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
operator|<=
literal|0
condition|)
break|break;
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|ProducerConsumer
operator|!=
name|ACPI_CONSUMER
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"ignored Address32 %s producer\n"
operator|,
operator|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|ResourceType
operator|==
name|ACPI_IO_RANGE
operator|)
condition|?
literal|"IO"
else|:
literal|"Memory"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|ResourceType
operator|!=
name|ACPI_MEMORY_RANGE
operator|)
operator|||
operator|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|ResourceType
operator|!=
name|ACPI_IO_RANGE
operator|)
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"ignored Address32 for non-memory, non-I/O\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressFixed
operator|==
name|ACPI_ADDRESS_FIXED
operator|)
operator|&&
operator|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MaxAddressFixed
operator|==
name|ACPI_ADDRESS_FIXED
operator|)
condition|)
block|{
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|ResourceType
operator|==
name|ACPI_MEMORY_RANGE
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address32/Memory 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address32/IO 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_ioport
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|ResourceType
operator|==
name|ACPI_MEMORY_RANGE
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address32/Memory 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MaxAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memoryrange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MaxAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|Granularity
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address32/IO 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MaxAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_iorange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|MaxAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|AddressLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address32
operator|.
name|Granularity
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|ACPI_RSTYPE_ADDRESS16
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
operator|<=
literal|0
condition|)
break|break;
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|ProducerConsumer
operator|!=
name|ACPI_CONSUMER
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"ignored Address16 %s producer\n"
operator|,
operator|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|ResourceType
operator|==
name|ACPI_IO_RANGE
operator|)
condition|?
literal|"IO"
else|:
literal|"Memory"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|ResourceType
operator|!=
name|ACPI_MEMORY_RANGE
operator|)
operator|||
operator|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|ResourceType
operator|!=
name|ACPI_IO_RANGE
operator|)
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"ignored Address16 for non-memory, non-I/O\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressFixed
operator|==
name|ACPI_ADDRESS_FIXED
operator|)
operator|&&
operator|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MaxAddressFixed
operator|==
name|ACPI_ADDRESS_FIXED
operator|)
condition|)
block|{
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|ResourceType
operator|==
name|ACPI_MEMORY_RANGE
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address16/Memory 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address16/IO 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_ioport
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|ResourceType
operator|==
name|ACPI_MEMORY_RANGE
condition|)
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address16/Memory 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MaxAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memoryrange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MaxAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|Granularity
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"Address16/IO 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MaxAddressRange
operator|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_iorange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MinAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|MaxAddressRange
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|AddressLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Address16
operator|.
name|Granularity
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|ACPI_RSTYPE_ADDRESS64
case|:
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"unimplemented Address64 resource\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_EXT_IRQ
case|:
comment|/* XXX special handling? */
name|set
operator|->
name|set_irq
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|ExtendedIrq
operator|.
name|Interrupts
argument_list|,
name|res
operator|->
name|Data
operator|.
name|ExtendedIrq
operator|.
name|NumberOfInterrupts
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_VENDOR
case|:
name|ACPI_DEBUG_PRINT
argument_list|(
operator|(
name|ACPI_DB_RESOURCES
operator|,
literal|"unimplemented VendorSpecific resource\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
name|AcpiOsFree
argument_list|(
name|buf
operator|.
name|Pointer
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_done
argument_list|(
name|dev
argument_list|,
name|context
argument_list|)
expr_stmt|;
name|return_ACPI_STATUS
argument_list|(
name|AE_OK
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Resource-set vectors used to attach _CRS-derived resources   * to an ACPI device.  */
end_comment

begin_function_decl
specifier|static
name|void
name|acpi_res_set_init
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_done
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_ioport
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_iorange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_memory
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_memoryrange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_irq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
modifier|*
name|irq
parameter_list|,
name|int
name|count
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_drq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
modifier|*
name|drq
parameter_list|,
name|int
name|count
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_start_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|int
name|preference
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_end_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|struct
name|acpi_parse_resource_set
name|acpi_res_parse_set
init|=
block|{
name|acpi_res_set_init
block|,
name|acpi_res_set_done
block|,
name|acpi_res_set_ioport
block|,
name|acpi_res_set_iorange
block|,
name|acpi_res_set_memory
block|,
name|acpi_res_set_memoryrange
block|,
name|acpi_res_set_irq
block|,
name|acpi_res_set_drq
block|,
name|acpi_res_set_start_dependant
block|,
name|acpi_res_set_end_dependant
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|acpi_res_context
block|{
name|int
name|ar_nio
decl_stmt|;
name|int
name|ar_nmem
decl_stmt|;
name|int
name|ar_nirq
decl_stmt|;
name|int
name|ar_ndrq
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|acpi_res_set_init
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
decl_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
name|AcpiOsAllocate
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|cp
argument_list|)
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|bzero
argument_list|(
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|cp
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|context
operator|=
name|cp
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_done
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|AcpiOsFree
argument_list|(
name|cp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_ioport
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_IOPORT
argument_list|,
name|cp
operator|->
name|ar_nio
operator|++
argument_list|,
name|base
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_iorange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"I/O range not supported\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_memory
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_MEMORY
argument_list|,
name|cp
operator|->
name|ar_nmem
operator|++
argument_list|,
name|base
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_memoryrange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"memory range not supported\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_irq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
modifier|*
name|irq
parameter_list|,
name|int
name|count
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|irq
operator|==
name|NULL
condition|)
return|return;
comment|/*This implements no resource relocation.*/
if|if
condition|(
name|count
operator|!=
literal|1
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_IRQ
argument_list|,
name|cp
operator|->
name|ar_nirq
operator|++
argument_list|,
operator|*
name|irq
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_drq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
modifier|*
name|drq
parameter_list|,
name|int
name|count
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|drq
operator|==
name|NULL
condition|)
return|return;
comment|/*This implements no resource relocation.*/
if|if
condition|(
name|count
operator|!=
literal|1
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_DRQ
argument_list|,
name|cp
operator|->
name|ar_ndrq
operator|++
argument_list|,
operator|*
name|drq
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_start_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|int
name|preference
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"dependant functions not supported\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_end_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
block|}
end_function

begin_comment
comment|/*  * Resource-owning placeholders.  *  * This code "owns" system resource objects that aren't  * otherwise useful to devices, and which shouldn't be  * considered "free".  *  * Note that some systems claim *all* of the physical address space  * with a PNP0C01 device, so we cannot correctly "own" system memory  * here (must be done in the SMAP handler on x86 systems, for  * example).  */
end_comment

begin_function_decl
specifier|static
name|int
name|acpi_sysresource_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|acpi_sysresource_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|device_method_t
name|acpi_sysresource_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|acpi_sysresource_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|acpi_sysresource_attach
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|acpi_sysresource_driver
init|=
block|{
literal|"acpi_sysresource"
block|,
name|acpi_sysresource_methods
block|,
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|acpi_sysresource_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|acpi_sysresource
argument_list|,
name|acpi
argument_list|,
name|acpi_sysresource_driver
argument_list|,
name|acpi_sysresource_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|int
name|acpi_sysresource_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
if|if
condition|(
name|acpi_disabled
argument_list|(
literal|"sysresource"
argument_list|)
condition|)
return|return
operator|(
name|ENXIO
operator|)
return|;
if|if
condition|(
name|acpi_MatchHid
argument_list|(
name|dev
argument_list|,
literal|"PNP0C02"
argument_list|)
condition|)
block|{
name|device_set_desc
argument_list|(
name|dev
argument_list|,
literal|"system resource"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
return|return
operator|(
name|ENXIO
operator|)
return|;
block|}
name|device_quiet
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|100
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|acpi_sysresource_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|struct
name|resource
modifier|*
name|res
decl_stmt|;
name|int
name|i
decl_stmt|,
name|rid
decl_stmt|;
comment|/*      * Suck up all the resources that might have been assigned to us.      * Note that it's impossible to tell the difference between a      * resource that someone else has claimed, and one that doesn't      * exist.      */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|++
control|)
block|{
name|rid
operator|=
name|i
expr_stmt|;
name|res
operator|=
name|bus_alloc_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_IOPORT
argument_list|,
operator|&
name|rid
argument_list|,
literal|0
argument_list|,
operator|~
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rid
operator|=
name|i
expr_stmt|;
name|res
operator|=
name|bus_alloc_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_MEMORY
argument_list|,
operator|&
name|rid
argument_list|,
literal|0
argument_list|,
operator|~
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rid
operator|=
name|i
expr_stmt|;
name|res
operator|=
name|bus_alloc_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_IRQ
argument_list|,
operator|&
name|rid
argument_list|,
literal|0
argument_list|,
operator|~
literal|0
argument_list|,
literal|1
argument_list|,
name|RF_SHAREABLE
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

