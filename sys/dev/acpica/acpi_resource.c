begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2000 Michael Smith  * Copyright (c) 2000 BSDi  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  *	$FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|"opt_acpi.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/resource.h>
end_include

begin_include
include|#
directive|include
file|"acpi.h"
end_include

begin_include
include|#
directive|include
file|<dev/acpica/acpivar.h>
end_include

begin_comment
comment|/*  * Hooks for the ACPI CA debugging infrastructure  */
end_comment

begin_define
define|#
directive|define
name|_COMPONENT
value|ACPI_BUS
end_define

begin_macro
name|MODULE_NAME
argument_list|(
literal|"RESOURCE"
argument_list|)
end_macro

begin_comment
comment|/*  * Fetch a device's resources and associate them with the device.  *  * Note that it might be nice to also locate ACPI-specific resource items, such  * as GPE bits.  */
end_comment

begin_function
name|ACPI_STATUS
name|acpi_parse_resources
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|ACPI_HANDLE
name|handle
parameter_list|,
name|struct
name|acpi_parse_resource_set
modifier|*
name|set
parameter_list|)
block|{
name|ACPI_BUFFER
name|buf
decl_stmt|;
name|ACPI_RESOURCE
modifier|*
name|res
decl_stmt|;
name|char
modifier|*
name|curr
decl_stmt|,
modifier|*
name|last
decl_stmt|;
name|ACPI_STATUS
name|status
decl_stmt|;
name|int
name|i
decl_stmt|;
name|void
modifier|*
name|context
decl_stmt|;
name|FUNCTION_TRACE
argument_list|(
name|__func__
argument_list|)
expr_stmt|;
comment|/*      * Fetch the device resources      */
if|if
condition|(
operator|(
operator|(
name|status
operator|=
name|acpi_GetIntoBuffer
argument_list|(
name|handle
argument_list|,
name|AcpiGetPossibleResources
argument_list|,
operator|&
name|buf
argument_list|)
operator|)
operator|!=
name|AE_OK
operator|)
operator|&&
operator|(
operator|(
name|status
operator|=
name|acpi_GetIntoBuffer
argument_list|(
name|handle
argument_list|,
name|AcpiGetCurrentResources
argument_list|,
operator|&
name|buf
argument_list|)
operator|)
operator|!=
name|AE_OK
operator|)
condition|)
block|{
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"can't fetch ACPI resources - %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|return_ACPI_STATUS
argument_list|(
name|status
argument_list|)
expr_stmt|;
block|}
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"got %d bytes of resources\n"
operator|,
name|buf
operator|.
name|Length
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_init
argument_list|(
name|dev
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/*      * Iterate through the resources      */
name|curr
operator|=
name|buf
operator|.
name|Pointer
expr_stmt|;
name|last
operator|=
operator|(
name|char
operator|*
operator|)
name|buf
operator|.
name|Pointer
operator|+
name|buf
operator|.
name|Length
expr_stmt|;
while|while
condition|(
name|curr
operator|<
name|last
condition|)
block|{
name|res
operator|=
operator|(
name|ACPI_RESOURCE
operator|*
operator|)
name|curr
expr_stmt|;
name|curr
operator|+=
name|res
operator|->
name|Length
expr_stmt|;
comment|/* 	 * Handle the individual resource types 	 */
switch|switch
condition|(
name|res
operator|->
name|Id
condition|)
block|{
case|case
name|ACPI_RSTYPE_END_TAG
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"EndTag\n"
operator|)
argument_list|)
expr_stmt|;
name|curr
operator|=
name|last
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_FIXED_IO
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"FixedIo 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|BaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_ioport
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|BaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedIo
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_IO
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
operator|==
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MaxBaseAddress
condition|)
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Io 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_ioport
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Io 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MaxBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_iorange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|MaxBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|RangeLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Io
operator|.
name|Alignment
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_FIXED_MEM32
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"FixedMemory32 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|FixedMemory32
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_MEM32
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
operator|==
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MaxBaseAddress
condition|)
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Memory32 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Memory32 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MaxBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memoryrange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|MaxBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|RangeLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory32
operator|.
name|Alignment
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_MEM24
case|:
if|if
condition|(
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
operator|==
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MaxBaseAddress
condition|)
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Memory24 0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memory
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Memory24 0x%x-0x%x/%d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MaxBaseAddress
operator|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_memoryrange
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MinBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|MaxBaseAddress
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|RangeLength
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Memory24
operator|.
name|Alignment
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_IRQ
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|res
operator|->
name|Data
operator|.
name|Irq
operator|.
name|NumberOfInterrupts
condition|;
name|i
operator|++
control|)
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Irq %d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Irq
operator|.
name|Interrupts
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_irq
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Irq
operator|.
name|Interrupts
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_DMA
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|res
operator|->
name|Data
operator|.
name|Dma
operator|.
name|NumberOfChannels
condition|;
name|i
operator|++
control|)
block|{
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"Drq %d\n"
operator|,
name|res
operator|->
name|Data
operator|.
name|Dma
operator|.
name|Channels
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_drq
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|Dma
operator|.
name|Channels
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_RSTYPE_START_DPF
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"start dependant functions"
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_start_dependant
argument_list|(
name|dev
argument_list|,
name|context
argument_list|,
name|res
operator|->
name|Data
operator|.
name|StartDpf
operator|.
name|CompatibilityPriority
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_END_DPF
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"end dependant functions"
operator|)
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_end_dependant
argument_list|(
name|dev
argument_list|,
name|context
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_ADDRESS32
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"unimplemented Address32 resource\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_ADDRESS16
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"unimplemented Address16 resource\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_EXT_IRQ
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"unimplemented ExtendedIrq resource\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_RSTYPE_VENDOR
case|:
name|DEBUG_PRINT
argument_list|(
name|TRACE_RESOURCES
argument_list|,
operator|(
literal|"unimplemented VendorSpecific resource\n"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
name|AcpiOsFree
argument_list|(
name|buf
operator|.
name|Pointer
argument_list|)
expr_stmt|;
name|set
operator|->
name|set_done
argument_list|(
name|dev
argument_list|,
name|context
argument_list|)
expr_stmt|;
name|return_ACPI_STATUS
argument_list|(
name|AE_OK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function_decl
specifier|static
name|void
name|acpi_res_set_init
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_done
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_ioport
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_iorange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_memory
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_memoryrange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_irq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|irq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_drq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|drq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_start_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|int
name|preference
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|acpi_res_set_end_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|struct
name|acpi_parse_resource_set
name|acpi_res_parse_set
init|=
block|{
name|acpi_res_set_init
block|,
name|acpi_res_set_done
block|,
name|acpi_res_set_ioport
block|,
name|acpi_res_set_iorange
block|,
name|acpi_res_set_memory
block|,
name|acpi_res_set_memoryrange
block|,
name|acpi_res_set_irq
block|,
name|acpi_res_set_drq
block|,
name|acpi_res_set_start_dependant
block|,
name|acpi_res_set_end_dependant
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|acpi_res_context
block|{
name|int
name|ar_nio
decl_stmt|;
name|int
name|ar_nmem
decl_stmt|;
name|int
name|ar_nirq
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|acpi_res_set_init
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
decl_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
name|AcpiOsAllocate
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|cp
argument_list|)
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|bzero
argument_list|(
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|cp
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|context
operator|=
name|cp
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_done
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|AcpiOsFree
argument_list|(
name|cp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_ioport
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_IOPORT
argument_list|,
name|cp
operator|->
name|ar_nio
operator|++
argument_list|,
name|base
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_iorange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"I/O range not supported\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_memory
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|base
parameter_list|,
name|u_int32_t
name|length
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_MEMORY
argument_list|,
name|cp
operator|->
name|ar_nmem
operator|++
argument_list|,
name|base
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_memoryrange
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|low
parameter_list|,
name|u_int32_t
name|high
parameter_list|,
name|u_int32_t
name|length
parameter_list|,
name|u_int32_t
name|align
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"memory range not supported\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_irq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|irq
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|bus_set_resource
argument_list|(
name|dev
argument_list|,
name|SYS_RES_IRQ
argument_list|,
name|cp
operator|->
name|ar_nirq
operator|++
argument_list|,
name|irq
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_drq
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|u_int32_t
name|drq
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"DRQ not supported\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_start_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|,
name|int
name|preference
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
name|device_printf
argument_list|(
name|dev
argument_list|,
literal|"dependant functions not supported"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|acpi_res_set_end_dependant
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|void
modifier|*
name|context
parameter_list|)
block|{
name|struct
name|acpi_res_context
modifier|*
name|cp
init|=
operator|(
expr|struct
name|acpi_res_context
operator|*
operator|)
name|context
decl_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
return|return;
block|}
end_function

end_unit

