begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002-2007 Neterion, Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<dev/nxge/include/xgehal-mgmt.h>
end_include

begin_include
include|#
directive|include
file|<dev/nxge/include/xgehal-driver.h>
end_include

begin_include
include|#
directive|include
file|<dev/nxge/include/xgehal-device.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|XGE_OS_HAS_SNPRINTF
end_ifdef

begin_define
define|#
directive|define
name|__hal_aux_snprintf
parameter_list|(
name|retbuf
parameter_list|,
name|bufsize
parameter_list|,
name|fmt
parameter_list|,
name|key
parameter_list|,
name|value
parameter_list|,
name|retsize
parameter_list|)
define|\
value|if (bufsize<= 0) return XGE_HAL_ERR_OUT_OF_SPACE; \ 	retsize = xge_os_snprintf(retbuf, bufsize, fmt, key, \ 	        XGE_HAL_AUX_SEPA, value); \ 	if (retsize< 0 || retsize>= bufsize) return XGE_HAL_ERR_OUT_OF_SPACE;
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|__hal_aux_snprintf
parameter_list|(
name|retbuf
parameter_list|,
name|bufsize
parameter_list|,
name|fmt
parameter_list|,
name|key
parameter_list|,
name|value
parameter_list|,
name|retsize
parameter_list|)
define|\
value|if (bufsize<= 0) return XGE_HAL_ERR_OUT_OF_SPACE; \ 	    retsize = xge_os_sprintf(retbuf, fmt, key, XGE_HAL_AUX_SEPA, value); \ 	xge_assert(retsize< bufsize); \ 	if (retsize< 0 || retsize>= bufsize) \ 	    return XGE_HAL_ERR_OUT_OF_SPACE;
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|__HAL_AUX_ENTRY_DECLARE
parameter_list|(
name|size
parameter_list|,
name|buf
parameter_list|)
define|\
value|int entrysize = 0, leftsize = size; \ 	char *ptr = buf;
end_define

begin_define
define|#
directive|define
name|__HAL_AUX_ENTRY
parameter_list|(
name|key
parameter_list|,
name|value
parameter_list|,
name|fmt
parameter_list|)
define|\
value|ptr += entrysize; leftsize -= entrysize; \ 	__hal_aux_snprintf(ptr, leftsize, "%s%c"fmt"\n", key, value, entrysize)
end_define

begin_define
define|#
directive|define
name|__HAL_AUX_ENTRY_END
parameter_list|(
name|bufsize
parameter_list|,
name|retsize
parameter_list|)
define|\
value|leftsize -= entrysize; \ 	*retsize = bufsize - leftsize;
end_define

begin_define
define|#
directive|define
name|__hal_aux_pci_link_info
parameter_list|(
name|name
parameter_list|,
name|index
parameter_list|,
name|var
parameter_list|)
value|{ \ 	    __HAL_AUX_ENTRY(name,           \ 	    (unsigned long long)pcim.link_info[index].var, "%llu") \ 	}
end_define

begin_define
define|#
directive|define
name|__hal_aux_pci_aggr_info
parameter_list|(
name|name
parameter_list|,
name|index
parameter_list|,
name|var
parameter_list|)
value|{ \ 	    __HAL_AUX_ENTRY(name,               \ 	    (unsigned long long)pcim.aggr_info[index].var, "%llu") \ 	}
end_define

begin_comment
comment|/**  * xge_hal_aux_bar0_read - Read and format Xframe BAR0 register.  * @devh: HAL device handle.  * @offset: Register offset in the BAR0 space.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read Xframe register from BAR0 space. The result is formatted as an ascii string.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_OUT_OF_SPACE - Buffer size is very small.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_INVALID_OFFSET - Register offset in the BAR space is not  * valid.  * XGE_HAL_ERR_INVALID_BAR_ID - BAR id is not valid.  *  * See also: xge_hal_mgmt_reg_read().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_bar0_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|unsigned
name|int
name|offset
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|u64
name|retval
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_reg_read
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|offset
argument_list|,
operator|&
name|retval
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
if|if
condition|(
name|bufsize
operator|<
name|XGE_OS_SPRINTF_STRLEN
condition|)
block|{
return|return
name|XGE_HAL_ERR_OUT_OF_SPACE
return|;
block|}
operator|*
name|retsize
operator|=
name|xge_os_sprintf
argument_list|(
name|retbuf
argument_list|,
literal|"0x%04X%c0x%08X%08X\n"
argument_list|,
name|offset
argument_list|,
name|XGE_HAL_AUX_SEPA
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|retval
operator|>>
literal|32
argument_list|)
argument_list|,
operator|(
name|u32
operator|)
name|retval
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_bar1_read - Read and format Xframe BAR1 register.  * @devh: HAL device handle.  * @offset: Register offset in the BAR1 space.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read Xframe register from BAR1 space. The result is formatted as ascii string.  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_OUT_OF_SPACE - Buffer size is very small.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_INVALID_OFFSET - Register offset in the BAR space is not  * valid.  * XGE_HAL_ERR_INVALID_BAR_ID - BAR id is not valid.  *  * See also: xge_hal_mgmt_reg_read().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_bar1_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|unsigned
name|int
name|offset
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|u64
name|retval
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_reg_read
argument_list|(
name|devh
argument_list|,
literal|1
argument_list|,
name|offset
argument_list|,
operator|&
name|retval
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
if|if
condition|(
name|bufsize
operator|<
name|XGE_OS_SPRINTF_STRLEN
condition|)
block|{
return|return
name|XGE_HAL_ERR_OUT_OF_SPACE
return|;
block|}
operator|*
name|retsize
operator|=
name|xge_os_sprintf
argument_list|(
name|retbuf
argument_list|,
literal|"0x%04X%c0x%08X%08X\n"
argument_list|,
name|offset
argument_list|,
name|XGE_HAL_AUX_SEPA
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|retval
operator|>>
literal|32
argument_list|)
argument_list|,
operator|(
name|u32
operator|)
name|retval
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_bar0_write - Write BAR0 register.  * @devh: HAL device handle.  * @offset: Register offset in the BAR0 space.  * @value: Regsister value (to write).  *  * Write BAR0 register.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_INVALID_OFFSET - Register offset in the BAR space is not  * valid.  * XGE_HAL_ERR_INVALID_BAR_ID - BAR id is not valid.  *  * See also: xge_hal_mgmt_reg_write().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_bar0_write
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|unsigned
name|int
name|offset
parameter_list|,
name|u64
name|value
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_reg_write
argument_list|(
name|devh
argument_list|,
literal|0
argument_list|,
name|offset
argument_list|,
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_about_read - Retrieve and format about info.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Retrieve about info (using xge_hal_mgmt_about()) and sprintf it  * into the provided @retbuf.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  * XGE_HAL_FAIL - Failed to retrieve the information.  *  * See also: xge_hal_mgmt_about(), xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_about_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_mgmt_about_info_t
name|about_info
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_about
argument_list|(
name|devh
argument_list|,
operator|&
name|about_info
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_about_info_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vendor"
argument_list|,
name|about_info
operator|.
name|vendor
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"device"
argument_list|,
name|about_info
operator|.
name|device
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"subsys_vendor"
argument_list|,
name|about_info
operator|.
name|subsys_vendor
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"subsys_device"
argument_list|,
name|about_info
operator|.
name|subsys_device
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"board_rev"
argument_list|,
name|about_info
operator|.
name|board_rev
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vendor_name"
argument_list|,
name|about_info
operator|.
name|vendor_name
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"chip_name"
argument_list|,
name|about_info
operator|.
name|chip_name
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"media"
argument_list|,
name|about_info
operator|.
name|media
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"hal_major"
argument_list|,
name|about_info
operator|.
name|hal_major
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"hal_minor"
argument_list|,
name|about_info
operator|.
name|hal_minor
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"hal_fix"
argument_list|,
name|about_info
operator|.
name|hal_fix
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"hal_build"
argument_list|,
name|about_info
operator|.
name|hal_build
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"ll_major"
argument_list|,
name|about_info
operator|.
name|ll_major
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"ll_minor"
argument_list|,
name|about_info
operator|.
name|ll_minor
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"ll_fix"
argument_list|,
name|about_info
operator|.
name|ll_fix
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"ll_build"
argument_list|,
name|about_info
operator|.
name|ll_build
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"transponder_temperature"
argument_list|,
name|about_info
operator|.
name|transponder_temperature
argument_list|,
literal|"%d C"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_stats_tmac_read - Read TMAC hardware statistics.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read TMAC hardware statistics. This is a subset of stats counters  * from xge_hal_stats_hw_info_t{}.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_mgmt_hw_stats{}, xge_hal_stats_hw_info_t{},  * xge_hal_aux_stats_pci_read(),  * xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_stats_tmac_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|xge_hal_device_check_id
argument_list|(
name|hldev
argument_list|)
operator|!=
name|XGE_HAL_CARD_TITAN
condition|)
block|{
name|xge_hal_mgmt_hw_stats_t
name|hw
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_hw_stats
argument_list|(
name|devh
argument_list|,
operator|&
name|hw
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_hw_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_data_octets"
argument_list|,
name|hw
operator|.
name|tmac_data_octets
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_frms"
argument_list|,
name|hw
operator|.
name|tmac_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_drop_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|tmac_drop_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_bcst_frms"
argument_list|,
name|hw
operator|.
name|tmac_bcst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_mcst_frms"
argument_list|,
name|hw
operator|.
name|tmac_mcst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_pause_ctrl_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|tmac_pause_ctrl_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_ucst_frms"
argument_list|,
name|hw
operator|.
name|tmac_ucst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_ttl_octets"
argument_list|,
name|hw
operator|.
name|tmac_ttl_octets
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_any_err_frms"
argument_list|,
name|hw
operator|.
name|tmac_any_err_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_nucst_frms"
argument_list|,
name|hw
operator|.
name|tmac_nucst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_ttl_less_fb_octets"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|tmac_ttl_less_fb_octets
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_vld_ip_octets"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|tmac_vld_ip_octets
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_drop_ip"
argument_list|,
name|hw
operator|.
name|tmac_drop_ip
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_vld_ip"
argument_list|,
name|hw
operator|.
name|tmac_vld_ip
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_rst_tcp"
argument_list|,
name|hw
operator|.
name|tmac_rst_tcp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_icmp"
argument_list|,
name|hw
operator|.
name|tmac_icmp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_tcp"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|tmac_tcp
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_0"
argument_list|,
name|hw
operator|.
name|reserved_0
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_udp"
argument_list|,
name|hw
operator|.
name|tmac_udp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|int
name|i
decl_stmt|;
name|xge_hal_mgmt_pcim_stats_t
name|pcim
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_pcim_stats
argument_list|(
name|devh
argument_list|,
operator|&
name|pcim
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_pcim_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAC_LINKS
condition|;
name|i
operator|++
control|)
block|{
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_frms"
argument_list|,
name|i
argument_list|,
name|tx_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_ttl_eth_octets"
argument_list|,
name|i
argument_list|,
name|tx_ttl_eth_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_data_octets"
argument_list|,
name|i
argument_list|,
name|tx_data_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_mcst_frms"
argument_list|,
name|i
argument_list|,
name|tx_mcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_bcst_frms"
argument_list|,
name|i
argument_list|,
name|tx_bcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_ucst_frms"
argument_list|,
name|i
argument_list|,
name|tx_ucst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_tagged_frms"
argument_list|,
name|i
argument_list|,
name|tx_tagged_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_vld_ip"
argument_list|,
name|i
argument_list|,
name|tx_vld_ip
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_vld_ip_octets"
argument_list|,
name|i
argument_list|,
name|tx_vld_ip_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_icmp"
argument_list|,
name|i
argument_list|,
name|tx_icmp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_tcp"
argument_list|,
name|i
argument_list|,
name|tx_tcp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_rst_tcp"
argument_list|,
name|i
argument_list|,
name|tx_rst_tcp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_udp"
argument_list|,
name|i
argument_list|,
name|tx_udp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_unknown_protocol"
argument_list|,
name|i
argument_list|,
name|tx_unknown_protocol
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_parse_error"
argument_list|,
name|i
argument_list|,
name|tx_parse_error
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_pause_ctrl_frms"
argument_list|,
name|i
argument_list|,
name|tx_pause_ctrl_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_lacpdu_frms"
argument_list|,
name|i
argument_list|,
name|tx_lacpdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_marker_pdu_frms"
argument_list|,
name|i
argument_list|,
name|tx_marker_pdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_marker_resp_pdu_frms"
argument_list|,
name|i
argument_list|,
name|tx_marker_resp_pdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_drop_ip"
argument_list|,
name|i
argument_list|,
name|tx_drop_ip
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_xgmii_char1_match"
argument_list|,
name|i
argument_list|,
name|tx_xgmii_char1_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_xgmii_char2_match"
argument_list|,
name|i
argument_list|,
name|tx_xgmii_char2_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_xgmii_column1_match"
argument_list|,
name|i
argument_list|,
name|tx_xgmii_column1_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_xgmii_column2_match"
argument_list|,
name|i
argument_list|,
name|tx_xgmii_column2_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_drop_frms"
argument_list|,
name|i
argument_list|,
name|tx_drop_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"tx_any_err_frms"
argument_list|,
name|i
argument_list|,
name|tx_any_err_frms
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAC_AGGREGATORS
condition|;
name|i
operator|++
control|)
block|{
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"tx_frms"
argument_list|,
name|i
argument_list|,
name|tx_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"tx_mcst_frms"
argument_list|,
name|i
argument_list|,
name|tx_mcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"tx_bcst_frms"
argument_list|,
name|i
argument_list|,
name|tx_bcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"tx_discarded_frms"
argument_list|,
name|i
argument_list|,
name|tx_discarded_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"tx_errored_frms"
argument_list|,
name|i
argument_list|,
name|tx_errored_frms
argument_list|)
expr_stmt|;
block|}
block|}
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_stats_rmac_read - Read RMAC hardware statistics.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read RMAC hardware statistics. This is a subset of stats counters  * from xge_hal_stats_hw_info_t{}.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_mgmt_hw_stats{}, xge_hal_stats_hw_info_t{},  * xge_hal_aux_stats_pci_read(), xge_hal_aux_stats_tmac_read(),  * xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_stats_rmac_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|xge_hal_device_check_id
argument_list|(
name|hldev
argument_list|)
operator|!=
name|XGE_HAL_CARD_TITAN
condition|)
block|{
name|xge_hal_mgmt_hw_stats_t
name|hw
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_hw_stats
argument_list|(
name|devh
argument_list|,
operator|&
name|hw
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_hw_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_data_octets"
argument_list|,
name|hw
operator|.
name|rmac_data_octets
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vld_frms"
argument_list|,
name|hw
operator|.
name|rmac_vld_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_fcs_err_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_fcs_err_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"mac_drop_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_drop_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vld_bcst_frms"
argument_list|,
name|hw
operator|.
name|rmac_vld_bcst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vld_mcst_frms"
argument_list|,
name|hw
operator|.
name|rmac_vld_mcst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_out_rng_len_err_frms"
argument_list|,
name|hw
operator|.
name|rmac_out_rng_len_err_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_in_rng_len_err_frms"
argument_list|,
name|hw
operator|.
name|rmac_in_rng_len_err_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_long_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_long_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pause_ctrl_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_pause_ctrl_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_unsup_ctrl_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_unsup_ctrl_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_accepted_ucst_frms"
argument_list|,
name|hw
operator|.
name|rmac_accepted_ucst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_octets"
argument_list|,
name|hw
operator|.
name|rmac_ttl_octets
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_discarded_frms"
argument_list|,
name|hw
operator|.
name|rmac_discarded_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_accepted_nucst_frms"
argument_list|,
name|hw
operator|.
name|rmac_accepted_nucst_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_1"
argument_list|,
name|hw
operator|.
name|reserved_1
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_drop_events"
argument_list|,
name|hw
operator|.
name|rmac_drop_events
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_less_fb_octets"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_less_fb_octets
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_2"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|reserved_2
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_usized_frms"
argument_list|,
name|hw
operator|.
name|rmac_usized_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_3"
argument_list|,
name|hw
operator|.
name|reserved_3
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frag_frms"
argument_list|,
name|hw
operator|.
name|rmac_frag_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_osized_frms"
argument_list|,
name|hw
operator|.
name|rmac_osized_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_4"
argument_list|,
name|hw
operator|.
name|reserved_4
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_jabber_frms"
argument_list|,
name|hw
operator|.
name|rmac_jabber_frms
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_64_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_64_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_65_127_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_65_127_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_5"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|reserved_5
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_128_255_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_128_255_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_256_511_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_256_511_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_6"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|reserved_6
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_512_1023_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_512_1023_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_1024_1518_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_1024_1518_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ip"
argument_list|,
name|hw
operator|.
name|rmac_ip
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_7"
argument_list|,
name|hw
operator|.
name|reserved_7
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ip_octets"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ip_octets
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_drop_ip"
argument_list|,
name|hw
operator|.
name|rmac_drop_ip
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_hdr_err_ip"
argument_list|,
name|hw
operator|.
name|rmac_hdr_err_ip
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_8"
argument_list|,
name|hw
operator|.
name|reserved_8
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_icmp"
argument_list|,
name|hw
operator|.
name|rmac_icmp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_tcp"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_tcp
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_err_drp_udp"
argument_list|,
name|hw
operator|.
name|rmac_err_drp_udp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_udp"
argument_list|,
name|hw
operator|.
name|rmac_udp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_xgmii_err_sym"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_xgmii_err_sym
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q0"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q0
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q1"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q1
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q2"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q2
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q3"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q3
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q4"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q4
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q5"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q5
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q6"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q6
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frms_q7"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_frms_q7
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q3"
argument_list|,
name|hw
operator|.
name|rmac_full_q3
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q2"
argument_list|,
name|hw
operator|.
name|rmac_full_q2
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q1"
argument_list|,
name|hw
operator|.
name|rmac_full_q1
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q0"
argument_list|,
name|hw
operator|.
name|rmac_full_q0
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q7"
argument_list|,
name|hw
operator|.
name|rmac_full_q7
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q6"
argument_list|,
name|hw
operator|.
name|rmac_full_q6
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q5"
argument_list|,
name|hw
operator|.
name|rmac_full_q5
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_full_q4"
argument_list|,
name|hw
operator|.
name|rmac_full_q4
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"reserved_9"
argument_list|,
name|hw
operator|.
name|reserved_9
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pause_cnt"
argument_list|,
name|hw
operator|.
name|rmac_pause_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_xgmii_data_err_cnt"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_xgmii_data_err_cnt
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_xgmii_ctrl_err_cnt"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_xgmii_ctrl_err_cnt
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_err_tcp"
argument_list|,
name|hw
operator|.
name|rmac_err_tcp
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_accepted_ip"
argument_list|,
name|hw
operator|.
name|rmac_accepted_ip
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|int
name|i
decl_stmt|;
name|xge_hal_mgmt_pcim_stats_t
name|pcim
decl_stmt|;
name|status
operator|=
name|xge_hal_mgmt_pcim_stats
argument_list|(
name|devh
argument_list|,
operator|&
name|pcim
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_pcim_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAC_LINKS
condition|;
name|i
operator|++
control|)
block|{
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_vld_frms"
argument_list|,
name|i
argument_list|,
name|rx_vld_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_offld_frms"
argument_list|,
name|i
argument_list|,
name|rx_offld_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_eth_octets"
argument_list|,
name|i
argument_list|,
name|rx_ttl_eth_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_data_octets"
argument_list|,
name|i
argument_list|,
name|rx_data_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_offld_octets"
argument_list|,
name|i
argument_list|,
name|rx_offld_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_vld_mcst_frms"
argument_list|,
name|i
argument_list|,
name|rx_vld_mcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_vld_bcst_frms"
argument_list|,
name|i
argument_list|,
name|rx_vld_bcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_accepted_ucst_frms"
argument_list|,
name|i
argument_list|,
name|rx_accepted_ucst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_accepted_nucst_frms"
argument_list|,
name|i
argument_list|,
name|rx_accepted_nucst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_tagged_frms"
argument_list|,
name|i
argument_list|,
name|rx_tagged_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_long_frms"
argument_list|,
name|i
argument_list|,
name|rx_long_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_usized_frms"
argument_list|,
name|i
argument_list|,
name|rx_usized_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_osized_frms"
argument_list|,
name|i
argument_list|,
name|rx_osized_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_frag_frms"
argument_list|,
name|i
argument_list|,
name|rx_frag_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_jabber_frms"
argument_list|,
name|i
argument_list|,
name|rx_jabber_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_64_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_64_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_65_127_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_65_127_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_128_255_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_128_255_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_256_511_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_256_511_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_512_1023_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_512_1023_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_1024_1518_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_1024_1518_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_1519_4095_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_1519_4095_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_40956_8191_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_40956_8191_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_8192_max_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_8192_max_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ttl_gt_max_frms"
argument_list|,
name|i
argument_list|,
name|rx_ttl_gt_max_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ip"
argument_list|,
name|i
argument_list|,
name|rx_ip
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ip_octets"
argument_list|,
name|i
argument_list|,
name|rx_ip_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_hdr_err_ip"
argument_list|,
name|i
argument_list|,
name|rx_hdr_err_ip
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_icmp"
argument_list|,
name|i
argument_list|,
name|rx_icmp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_tcp"
argument_list|,
name|i
argument_list|,
name|rx_tcp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_udp"
argument_list|,
name|i
argument_list|,
name|rx_udp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_err_tcp"
argument_list|,
name|i
argument_list|,
name|rx_err_tcp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_pause_cnt"
argument_list|,
name|i
argument_list|,
name|rx_pause_cnt
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_pause_ctrl_frms"
argument_list|,
name|i
argument_list|,
name|rx_pause_ctrl_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_unsup_ctrl_frms"
argument_list|,
name|i
argument_list|,
name|rx_pause_cnt
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_in_rng_len_err_frms"
argument_list|,
name|i
argument_list|,
name|rx_in_rng_len_err_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_out_rng_len_err_frms"
argument_list|,
name|i
argument_list|,
name|rx_out_rng_len_err_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_drop_frms"
argument_list|,
name|i
argument_list|,
name|rx_drop_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_discarded_frms"
argument_list|,
name|i
argument_list|,
name|rx_discarded_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_drop_ip"
argument_list|,
name|i
argument_list|,
name|rx_drop_ip
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_err_drp_udp"
argument_list|,
name|i
argument_list|,
name|rx_err_drp_udp
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_lacpdu_frms"
argument_list|,
name|i
argument_list|,
name|rx_lacpdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_marker_pdu_frms"
argument_list|,
name|i
argument_list|,
name|rx_marker_pdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_marker_resp_pdu_frms"
argument_list|,
name|i
argument_list|,
name|rx_marker_resp_pdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_unknown_pdu_frms"
argument_list|,
name|i
argument_list|,
name|rx_unknown_pdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_illegal_pdu_frms"
argument_list|,
name|i
argument_list|,
name|rx_illegal_pdu_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_fcs_discard"
argument_list|,
name|i
argument_list|,
name|rx_fcs_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_len_discard"
argument_list|,
name|i
argument_list|,
name|rx_len_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_pf_discard"
argument_list|,
name|i
argument_list|,
name|rx_pf_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_trash_discard"
argument_list|,
name|i
argument_list|,
name|rx_trash_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_rts_discard"
argument_list|,
name|i
argument_list|,
name|rx_trash_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_wol_discard"
argument_list|,
name|i
argument_list|,
name|rx_wol_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_red_discard"
argument_list|,
name|i
argument_list|,
name|rx_red_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_ingm_full_discard"
argument_list|,
name|i
argument_list|,
name|rx_ingm_full_discard
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_data_err_cnt"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_data_err_cnt
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_ctrl_err_cnt"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_ctrl_err_cnt
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_err_sym"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_err_sym
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_char1_match"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_char1_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_char2_match"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_char2_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_column1_match"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_column1_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_xgmii_column2_match"
argument_list|,
name|i
argument_list|,
name|rx_xgmii_column2_match
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_local_fault"
argument_list|,
name|i
argument_list|,
name|rx_local_fault
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_remote_fault"
argument_list|,
name|i
argument_list|,
name|rx_remote_fault
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_queue_full"
argument_list|,
name|i
argument_list|,
name|rx_queue_full
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAC_AGGREGATORS
condition|;
name|i
operator|++
control|)
block|{
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"rx_frms"
argument_list|,
name|i
argument_list|,
name|rx_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_link_info
argument_list|(
literal|"rx_data_octets"
argument_list|,
name|i
argument_list|,
name|rx_data_octets
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"rx_mcst_frms"
argument_list|,
name|i
argument_list|,
name|rx_mcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"rx_bcst_frms"
argument_list|,
name|i
argument_list|,
name|rx_bcst_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"rx_discarded_frms"
argument_list|,
name|i
argument_list|,
name|rx_discarded_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"rx_errored_frms"
argument_list|,
name|i
argument_list|,
name|rx_errored_frms
argument_list|)
expr_stmt|;
name|__hal_aux_pci_aggr_info
argument_list|(
literal|"rx_unknown_protocol_frms"
argument_list|,
name|i
argument_list|,
name|rx_unknown_protocol_frms
argument_list|)
expr_stmt|;
block|}
block|}
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_stats_herc_enchanced - Get Hercules hardware statistics.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read Hercules device hardware statistics.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_mgmt_hw_stats{}, xge_hal_stats_hw_info_t{},  * xge_hal_aux_stats_tmac_read(), xge_hal_aux_stats_rmac_read(),  * xge_hal_aux_device_dump(). */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_stats_herc_enchanced
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_mgmt_hw_stats_t
name|hw
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|xge_hal_device_check_id
argument_list|(
name|hldev
argument_list|)
operator|==
name|XGE_HAL_CARD_TITAN
condition|)
block|{
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
name|status
operator|=
name|xge_hal_mgmt_hw_stats
argument_list|(
name|devh
argument_list|,
operator|&
name|hw
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_hw_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_frms_oflow"
argument_list|,
name|hw
operator|.
name|tmac_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_data_octets_oflow"
argument_list|,
name|hw
operator|.
name|tmac_data_octets_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_mcst_frms_oflow"
argument_list|,
name|hw
operator|.
name|tmac_mcst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_bcst_frms_oflow"
argument_list|,
name|hw
operator|.
name|tmac_bcst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_ttl_octets_oflow"
argument_list|,
name|hw
operator|.
name|tmac_ttl_octets_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_ucst_frms_oflow"
argument_list|,
name|hw
operator|.
name|tmac_ucst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_nucst_frms_oflow"
argument_list|,
name|hw
operator|.
name|tmac_nucst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_any_err_frms_oflow"
argument_list|,
name|hw
operator|.
name|tmac_any_err_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_vlan_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|tmac_vlan_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_vld_ip_oflow"
argument_list|,
name|hw
operator|.
name|tmac_vld_ip_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_drop_ip_oflow"
argument_list|,
name|hw
operator|.
name|tmac_drop_ip_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_icmp_oflow"
argument_list|,
name|hw
operator|.
name|tmac_icmp_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_rst_tcp_oflow"
argument_list|,
name|hw
operator|.
name|tmac_rst_tcp_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_udp_oflow"
argument_list|,
name|hw
operator|.
name|tmac_udp_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tpa_unknown_protocol"
argument_list|,
name|hw
operator|.
name|tpa_unknown_protocol
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tpa_parse_failure"
argument_list|,
name|hw
operator|.
name|tpa_parse_failure
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vld_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_vld_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_data_octets_oflow"
argument_list|,
name|hw
operator|.
name|rmac_data_octets_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vld_mcst_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_vld_mcst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vld_bcst_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_vld_bcst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_octets_oflow"
argument_list|,
name|hw
operator|.
name|rmac_ttl_octets_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_accepted_ucst_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_accepted_ucst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_accepted_nucst_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_accepted_nucst_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_discarded_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_discarded_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_drop_events_oflow"
argument_list|,
name|hw
operator|.
name|rmac_drop_events_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_usized_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_usized_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_osized_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_osized_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_frag_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_frag_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_jabber_frms_oflow"
argument_list|,
name|hw
operator|.
name|rmac_jabber_frms_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ip_oflow"
argument_list|,
name|hw
operator|.
name|rmac_ip_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_drop_ip_oflow"
argument_list|,
name|hw
operator|.
name|rmac_drop_ip_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_icmp_oflow"
argument_list|,
name|hw
operator|.
name|rmac_icmp_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_udp_oflow"
argument_list|,
name|hw
operator|.
name|rmac_udp_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_err_drp_udp_oflow"
argument_list|,
name|hw
operator|.
name|rmac_err_drp_udp_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pause_cnt_oflow"
argument_list|,
name|hw
operator|.
name|rmac_pause_cnt_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_1519_4095_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_1519_4095_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_4096_8191_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_4096_8191_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_8192_max_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_8192_max_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ttl_gt_max_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_ttl_gt_max_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_osized_alt_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_osized_alt_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_jabber_alt_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_jabber_alt_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_gt_max_alt_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_gt_max_alt_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_vlan_frms"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|hw
operator|.
name|rmac_vlan_frms
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_fcs_discard"
argument_list|,
name|hw
operator|.
name|rmac_fcs_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_len_discard"
argument_list|,
name|hw
operator|.
name|rmac_len_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_da_discard"
argument_list|,
name|hw
operator|.
name|rmac_da_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pf_discard"
argument_list|,
name|hw
operator|.
name|rmac_pf_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_rts_discard"
argument_list|,
name|hw
operator|.
name|rmac_rts_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_red_discard"
argument_list|,
name|hw
operator|.
name|rmac_red_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_ingm_full_discard"
argument_list|,
name|hw
operator|.
name|rmac_ingm_full_discard
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_accepted_ip_oflow"
argument_list|,
name|hw
operator|.
name|rmac_accepted_ip_oflow
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"link_fault_cnt"
argument_list|,
name|hw
operator|.
name|link_fault_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_stats_rmac_read - Read PCI hardware statistics.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read PCI statistics counters, including number of PCI read and  * write transactions, PCI retries, discards, etc.  * This is a subset of stats counters from xge_hal_stats_hw_info_t{}.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_mgmt_hw_stats{}, xge_hal_stats_hw_info_t{},  * xge_hal_aux_stats_tmac_read(), xge_hal_aux_stats_rmac_read(),  * xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_stats_pci_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_mgmt_hw_stats_t
name|hw
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|xge_hal_device_check_id
argument_list|(
name|hldev
argument_list|)
operator|==
name|XGE_HAL_CARD_TITAN
condition|)
block|{
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
name|status
operator|=
name|xge_hal_mgmt_hw_stats
argument_list|(
name|devh
argument_list|,
operator|&
name|hw
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_hw_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"new_rd_req_cnt"
argument_list|,
name|hw
operator|.
name|new_rd_req_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rd_req_cnt"
argument_list|,
name|hw
operator|.
name|rd_req_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rd_rtry_cnt"
argument_list|,
name|hw
operator|.
name|rd_rtry_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"new_rd_req_rtry_cnt"
argument_list|,
name|hw
operator|.
name|new_rd_req_rtry_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"wr_req_cnt"
argument_list|,
name|hw
operator|.
name|wr_req_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"wr_rtry_rd_ack_cnt"
argument_list|,
name|hw
operator|.
name|wr_rtry_rd_ack_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"new_wr_req_rtry_cnt"
argument_list|,
name|hw
operator|.
name|new_wr_req_rtry_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"new_wr_req_cnt"
argument_list|,
name|hw
operator|.
name|new_wr_req_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"wr_disc_cnt"
argument_list|,
name|hw
operator|.
name|wr_disc_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"wr_rtry_cnt"
argument_list|,
name|hw
operator|.
name|wr_rtry_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txp_wr_cnt"
argument_list|,
name|hw
operator|.
name|txp_wr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rd_rtry_wr_ack_cnt"
argument_list|,
name|hw
operator|.
name|rd_rtry_wr_ack_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txd_wr_cnt"
argument_list|,
name|hw
operator|.
name|txd_wr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txd_rd_cnt"
argument_list|,
name|hw
operator|.
name|txd_rd_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxd_wr_cnt"
argument_list|,
name|hw
operator|.
name|rxd_wr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxd_rd_cnt"
argument_list|,
name|hw
operator|.
name|rxd_rd_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxf_wr_cnt"
argument_list|,
name|hw
operator|.
name|rxf_wr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txf_rd_cnt"
argument_list|,
name|hw
operator|.
name|txf_rd_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_stats_hal_read - Read HAL (layer) statistics.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read HAL statistics.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  * XGE_HAL_INF_STATS_IS_NOT_READY - Statistics information is not  * currently available.  *  * See also: xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_stats_hal_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_list_t
modifier|*
name|item
decl_stmt|;
name|xge_hal_channel_t
modifier|*
name|channel
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_mgmt_device_stats_t
name|devstat
decl_stmt|;
name|xge_hal_mgmt_channel_stats_t
name|chstat
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_device_stats
argument_list|(
name|hldev
argument_list|,
operator|&
name|devstat
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_device_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
if|if
condition|(
operator|!
name|hldev
operator|->
name|config
operator|.
name|bimodal_interrupts
condition|)
block|{
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rx_traffic_intr_cnt"
argument_list|,
name|devstat
operator|.
name|rx_traffic_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tx_traffic_intr_cnt"
argument_list|,
name|devstat
operator|.
name|tx_traffic_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txpic_intr_cnt"
argument_list|,
name|devstat
operator|.
name|txpic_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txdma_intr_cnt"
argument_list|,
name|devstat
operator|.
name|txdma_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txmac_intr_cnt"
argument_list|,
name|devstat
operator|.
name|txmac_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"txxgxs_intr_cnt"
argument_list|,
name|devstat
operator|.
name|txxgxs_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxpic_intr_cnt"
argument_list|,
name|devstat
operator|.
name|rxpic_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxdma_intr_cnt"
argument_list|,
name|devstat
operator|.
name|rxdma_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxmac_intr_cnt"
argument_list|,
name|devstat
operator|.
name|rxmac_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxxgxs_intr_cnt"
argument_list|,
name|devstat
operator|.
name|rxxgxs_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"mc_intr_cnt"
argument_list|,
name|devstat
operator|.
name|mc_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"not_xge_intr_cnt"
argument_list|,
name|devstat
operator|.
name|not_xge_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"not_traffic_intr_cnt"
argument_list|,
name|devstat
operator|.
name|not_traffic_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"traffic_intr_cnt"
argument_list|,
name|devstat
operator|.
name|traffic_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"total_intr_cnt"
argument_list|,
name|devstat
operator|.
name|total_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"soft_reset_cnt"
argument_list|,
name|devstat
operator|.
name|soft_reset_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|config
operator|.
name|rxufca_hi_lim
operator|!=
name|hldev
operator|->
name|config
operator|.
name|rxufca_lo_lim
operator|&&
name|hldev
operator|->
name|config
operator|.
name|rxufca_lo_lim
operator|!=
literal|0
condition|)
block|{
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxufca_lo_adjust_cnt"
argument_list|,
name|devstat
operator|.
name|rxufca_lo_adjust_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxufca_hi_adjust_cnt"
argument_list|,
name|devstat
operator|.
name|rxufca_hi_adjust_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hldev
operator|->
name|config
operator|.
name|bimodal_interrupts
condition|)
block|{
name|__HAL_AUX_ENTRY
argument_list|(
literal|"bimodal_lo_adjust_cnt"
argument_list|,
name|devstat
operator|.
name|bimodal_lo_adjust_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"bimodal_hi_adjust_cnt"
argument_list|,
name|devstat
operator|.
name|bimodal_hi_adjust_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|XGE_HAL_CONFIG_LRO
argument_list|)
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tot_frms_lroised"
argument_list|,
name|devstat
operator|.
name|tot_frms_lroised
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tot_lro_sessions"
argument_list|,
name|devstat
operator|.
name|tot_lro_sessions
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"lro_frm_len_exceed_cnt"
argument_list|,
name|devstat
operator|.
name|lro_frm_len_exceed_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"lro_sg_exceed_cnt"
argument_list|,
name|devstat
operator|.
name|lro_sg_exceed_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"lro_out_of_seq_pkt_cnt"
argument_list|,
name|devstat
operator|.
name|lro_out_of_seq_pkt_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"lro_dup_pkt_cnt"
argument_list|,
name|devstat
operator|.
name|lro_dup_pkt_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* for each opened rx channel */
name|xge_list_for_each
argument_list|(
argument|item
argument_list|,
argument|&hldev->ring_channels
argument_list|)
block|{
name|char
name|key
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|channel
operator|=
name|xge_container_of
argument_list|(
name|item
argument_list|,
name|xge_hal_channel_t
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_channel_stats
argument_list|(
name|channel
argument_list|,
operator|&
name|chstat
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_channel_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"ring%d_"
argument_list|,
name|channel
operator|->
name|post_qid
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"full_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|full_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"usage_max"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|usage_max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"usage_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|usage_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_free_swaps_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|reserve_free_swaps_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|hldev
operator|->
name|config
operator|.
name|bimodal_interrupts
condition|)
block|{
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"avg_compl_per_intr_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|avg_compl_per_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_compl_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_compl_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"bump_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|ring_bump_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
comment|/* for each opened tx channel */
name|xge_list_for_each
argument_list|(
argument|item
argument_list|,
argument|&hldev->fifo_channels
argument_list|)
block|{
name|char
name|key
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|channel
operator|=
name|xge_container_of
argument_list|(
name|item
argument_list|,
name|xge_hal_channel_t
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_channel_stats
argument_list|(
name|channel
argument_list|,
operator|&
name|chstat
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_channel_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"fifo%d_"
argument_list|,
name|channel
operator|->
name|post_qid
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"full_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|full_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"usage_max"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|usage_max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"usage_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|usage_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_free_swaps_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|reserve_free_swaps_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"avg_compl_per_intr_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|avg_compl_per_intr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_compl_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_compl_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_posts"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_posts
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_posts_many"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_posts_many
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"copied_frags"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|copied_frags
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"copied_buffers"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|copied_buffers
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_buffers"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_buffers
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"avg_buffers_per_post"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|avg_buffers_per_post
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"avg_buffer_size"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|avg_buffer_size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"avg_post_size"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|avg_post_size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_posts_dtrs_many"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_posts_dtrs_many
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_posts_frags_many"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_posts_frags_many
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_posts_dang_dtrs"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_posts_dang_dtrs
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"total_posts_dang_frags"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|chstat
operator|.
name|total_posts_dang_frags
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_stats_sw_dev_read - Read software device statistics.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read software-maintained device statistics.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  * XGE_HAL_INF_STATS_IS_NOT_READY - Statistics information is not  * currently available.  *  * See also: xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_stats_sw_dev_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_mgmt_sw_stats_t
name|sw_dev_err_stats
decl_stmt|;
name|int
name|t_code
decl_stmt|;
name|char
name|buf
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_sw_stats
argument_list|(
name|hldev
argument_list|,
operator|&
name|sw_dev_err_stats
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_sw_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"sm_err_cnt"
argument_list|,
name|sw_dev_err_stats
operator|.
name|sm_err_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"single_ecc_err_cnt"
argument_list|,
name|sw_dev_err_stats
operator|.
name|single_ecc_err_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"double_ecc_err_cnt"
argument_list|,
name|sw_dev_err_stats
operator|.
name|double_ecc_err_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"ecc_err_cnt"
argument_list|,
name|sw_dev_err_stats
operator|.
name|ecc_err_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"parity_err_cnt"
argument_list|,
name|sw_dev_err_stats
operator|.
name|parity_err_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"serr_cnt"
argument_list|,
name|sw_dev_err_stats
operator|.
name|serr_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
for|for
control|(
name|t_code
operator|=
literal|1
init|;
name|t_code
operator|<
literal|16
condition|;
name|t_code
operator|++
control|)
block|{
name|int
name|t_code_cnt
init|=
name|sw_dev_err_stats
operator|.
name|rxd_t_code_err_cnt
index|[
name|t_code
index|]
decl_stmt|;
if|if
condition|(
name|t_code_cnt
condition|)
block|{
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|buf
argument_list|,
literal|"rxd_t_code_%d"
argument_list|,
name|t_code
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|buf
argument_list|,
name|t_code_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|t_code_cnt
operator|=
name|sw_dev_err_stats
operator|.
name|txd_t_code_err_cnt
index|[
name|t_code
index|]
expr_stmt|;
if|if
condition|(
name|t_code_cnt
condition|)
block|{
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|buf
argument_list|,
literal|"txd_t_code_%d"
argument_list|,
name|t_code
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|buf
argument_list|,
name|t_code_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"alarm_transceiver_temp_high"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|alarm_transceiver_temp_high
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"alarm_transceiver_temp_low"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|alarm_transceiver_temp_low
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"alarm_laser_bias_current_high"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|alarm_laser_bias_current_high
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"alarm_laser_bias_current_low"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|alarm_laser_bias_current_low
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"alarm_laser_output_power_high"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|alarm_laser_output_power_high
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"alarm_laser_output_power_low"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|alarm_laser_output_power_low
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"warn_transceiver_temp_high"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|warn_transceiver_temp_high
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"warn_transceiver_temp_low"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|warn_transceiver_temp_low
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"warn_laser_bias_current_high"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|warn_laser_bias_current_high
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"warn_laser_bias_current_low"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|warn_laser_bias_current_low
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"warn_laser_output_power_high"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|warn_laser_output_power_high
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"warn_laser_output_power_low"
argument_list|,
name|sw_dev_err_stats
operator|.
name|stats_xpak
operator|.
name|warn_laser_output_power_low
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_pci_config_read - Retrieve and format PCI Configuration  * info.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Retrieve about info (using xge_hal_mgmt_pci_config()) and sprintf it  * into the provided @retbuf.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_mgmt_pci_config(), xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_pci_config_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_mgmt_pci_config_t
name|pci_config
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_pci_config
argument_list|(
name|devh
argument_list|,
operator|&
name|pci_config
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_mgmt_pci_config_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vendor_id"
argument_list|,
name|pci_config
operator|.
name|vendor_id
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"device_id"
argument_list|,
name|pci_config
operator|.
name|device_id
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"command"
argument_list|,
name|pci_config
operator|.
name|command
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"status"
argument_list|,
name|pci_config
operator|.
name|status
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"revision"
argument_list|,
name|pci_config
operator|.
name|revision
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pciClass1"
argument_list|,
name|pci_config
operator|.
name|pciClass
index|[
literal|0
index|]
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pciClass2"
argument_list|,
name|pci_config
operator|.
name|pciClass
index|[
literal|1
index|]
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pciClass3"
argument_list|,
name|pci_config
operator|.
name|pciClass
index|[
literal|2
index|]
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"cache_line_size"
argument_list|,
name|pci_config
operator|.
name|cache_line_size
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"latency_timer"
argument_list|,
name|pci_config
operator|.
name|latency_timer
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"header_type"
argument_list|,
name|pci_config
operator|.
name|header_type
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"bist"
argument_list|,
name|pci_config
operator|.
name|bist
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"base_addr0_lo"
argument_list|,
name|pci_config
operator|.
name|base_addr0_lo
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"base_addr0_hi"
argument_list|,
name|pci_config
operator|.
name|base_addr0_hi
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"base_addr1_lo"
argument_list|,
name|pci_config
operator|.
name|base_addr1_lo
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"base_addr1_hi"
argument_list|,
name|pci_config
operator|.
name|base_addr1_hi
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"not_Implemented1"
argument_list|,
name|pci_config
operator|.
name|not_Implemented1
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"not_Implemented2"
argument_list|,
name|pci_config
operator|.
name|not_Implemented2
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"cardbus_cis_pointer"
argument_list|,
name|pci_config
operator|.
name|cardbus_cis_pointer
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"subsystem_vendor_id"
argument_list|,
name|pci_config
operator|.
name|subsystem_vendor_id
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"subsystem_id"
argument_list|,
name|pci_config
operator|.
name|subsystem_id
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rom_base"
argument_list|,
name|pci_config
operator|.
name|rom_base
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"capabilities_pointer"
argument_list|,
name|pci_config
operator|.
name|capabilities_pointer
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"interrupt_line"
argument_list|,
name|pci_config
operator|.
name|interrupt_line
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"interrupt_pin"
argument_list|,
name|pci_config
operator|.
name|interrupt_pin
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"min_grant"
argument_list|,
name|pci_config
operator|.
name|min_grant
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"max_latency"
argument_list|,
name|pci_config
operator|.
name|max_latency
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_cap_id"
argument_list|,
name|pci_config
operator|.
name|msi_cap_id
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_next_ptr"
argument_list|,
name|pci_config
operator|.
name|msi_next_ptr
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_control"
argument_list|,
name|pci_config
operator|.
name|msi_control
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_lower_address"
argument_list|,
name|pci_config
operator|.
name|msi_lower_address
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_higher_address"
argument_list|,
name|pci_config
operator|.
name|msi_higher_address
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_data"
argument_list|,
name|pci_config
operator|.
name|msi_data
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"msi_unused"
argument_list|,
name|pci_config
operator|.
name|msi_unused
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vpd_cap_id"
argument_list|,
name|pci_config
operator|.
name|vpd_cap_id
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vpd_next_cap"
argument_list|,
name|pci_config
operator|.
name|vpd_next_cap
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vpd_addr"
argument_list|,
name|pci_config
operator|.
name|vpd_addr
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"vpd_data"
argument_list|,
name|pci_config
operator|.
name|vpd_data
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pcix_cap"
argument_list|,
name|pci_config
operator|.
name|pcix_cap
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pcix_next_cap"
argument_list|,
name|pci_config
operator|.
name|pcix_next_cap
argument_list|,
literal|"0x%02X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pcix_command"
argument_list|,
name|pci_config
operator|.
name|pcix_command
argument_list|,
literal|"0x%04X"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pcix_status"
argument_list|,
name|pci_config
operator|.
name|pcix_status
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
if|if
condition|(
name|xge_hal_device_check_id
argument_list|(
name|devh
argument_list|)
operator|==
name|XGE_HAL_CARD_HERC
condition|)
block|{
name|char
name|key
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|XGE_HAL_PCI_XFRAME_CONFIG_SPACE_SIZE
operator|-
literal|0x68
operator|)
operator|/
literal|4
condition|;
name|i
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"%03x:"
argument_list|,
literal|4
operator|*
name|i
operator|+
literal|0x68
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|pci_config
operator|.
name|rsvd_b1
operator|+
name|i
operator|)
argument_list|,
literal|"0x%08X"
argument_list|)
expr_stmt|;
block|}
block|}
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_channel_read - Read channels information.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read HAL statistics.  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_OUT_OF_SPACE - Buffer size is very small.  * See also: xge_hal_aux_device_dump().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_channel_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_list_t
modifier|*
name|item
decl_stmt|;
name|xge_hal_channel_t
modifier|*
name|channel
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|hldev
operator|->
name|magic
operator|!=
name|XGE_HAL_MAGIC
condition|)
block|{
return|return
name|XGE_HAL_ERR_INVALID_DEVICE
return|;
block|}
comment|/* for each opened rx channel */
name|xge_list_for_each
argument_list|(
argument|item
argument_list|,
argument|&hldev->ring_channels
argument_list|)
block|{
name|char
name|key
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|channel
operator|=
name|xge_container_of
argument_list|(
name|item
argument_list|,
name|xge_hal_channel_t
argument_list|,
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|->
name|is_open
operator|!=
literal|1
condition|)
continue|continue;
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"ring%d_"
argument_list|,
name|channel
operator|->
name|post_qid
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|type
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"length"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|length
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"is_open"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|is_open
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_initial"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_initial
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_max"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_length"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_length
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_top"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_top
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_threshold"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_threshold
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"free_length"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|free_length
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"post_index"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|post_index
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"compl_index"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|compl_index
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"per_dtr_space"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|per_dtr_space
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"usage_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|usage_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
comment|/* for each opened tx channel */
name|xge_list_for_each
argument_list|(
argument|item
argument_list|,
argument|&hldev->fifo_channels
argument_list|)
block|{
name|char
name|key
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|channel
operator|=
name|xge_container_of
argument_list|(
name|item
argument_list|,
name|xge_hal_channel_t
argument_list|,
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|->
name|is_open
operator|!=
literal|1
condition|)
continue|continue;
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"fifo%d_"
argument_list|,
name|channel
operator|->
name|post_qid
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|type
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"length"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|length
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"is_open"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|is_open
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_initial"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_initial
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_max"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_length"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_length
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_top"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_top
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"reserve_threshold"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|reserve_threshold
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"free_length"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|free_length
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"post_index"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|post_index
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"compl_index"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|compl_index
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"per_dtr_space"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|per_dtr_space
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"usage_cnt"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|channel
operator|->
name|usage_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_device_dump - Dump driver "about" info and device state.  * @devh: HAL device handle.  *  * Dump driver& device "about" info and device state,  * including all BAR0 registers, hardware and software statistics, PCI  * configuration space.  * See also: xge_hal_aux_about_read(), xge_hal_mgmt_reg_read(),  * xge_hal_aux_pci_config_read(), xge_hal_aux_stats_sw_dev_read(),  * xge_hal_aux_stats_tmac_read(), xge_hal_aux_stats_rmac_read(),  * xge_hal_aux_channel_read(), xge_hal_aux_stats_hal_read().  * Returns:  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_OUT_OF_SPACE - Buffer size is very small.  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_device_dump
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|)
block|{
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|xge_hal_status_e
name|status
decl_stmt|;
name|int
name|retsize
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|u64
name|retval
decl_stmt|;
name|xge_assert
argument_list|(
name|hldev
operator|->
name|dump_buf
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|xge_os_println
argument_list|(
literal|"********* xge DEVICE DUMP BEGIN **********"
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_about_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
for|for
control|(
name|offset
operator|=
literal|0
init|;
name|offset
operator|<
literal|1574
condition|;
name|offset
operator|++
control|)
block|{
name|status
operator|=
name|xge_hal_mgmt_reg_read
argument_list|(
name|hldev
argument_list|,
literal|0
argument_list|,
name|offset
operator|*
literal|8
argument_list|,
operator|&
name|retval
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
if|if
condition|(
operator|!
name|retval
condition|)
continue|continue;
name|xge_os_printf
argument_list|(
literal|"0x%04x 0x%08x%08x"
argument_list|,
name|offset
operator|*
literal|8
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|retval
operator|>>
literal|32
argument_list|)
argument_list|,
operator|(
name|u32
operator|)
name|retval
argument_list|)
expr_stmt|;
block|}
name|xge_os_println
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_pci_config_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_stats_tmac_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_stats_rmac_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_stats_pci_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|xge_hal_device_check_id
argument_list|(
name|hldev
argument_list|)
operator|==
name|XGE_HAL_CARD_HERC
condition|)
block|{
name|status
operator|=
name|xge_hal_aux_stats_herc_enchanced
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|xge_hal_aux_stats_sw_dev_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_channel_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_aux_stats_hal_read
argument_list|(
name|hldev
argument_list|,
name|XGE_HAL_DUMP_BUF_SIZE
argument_list|,
name|hldev
operator|->
name|dump_buf
argument_list|,
operator|&
name|retsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|xge_os_println
argument_list|(
name|hldev
operator|->
name|dump_buf
argument_list|)
expr_stmt|;
name|xge_os_println
argument_list|(
literal|"********* XFRAME DEVICE DUMP END **********"
argument_list|)
expr_stmt|;
name|error
label|:
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_driver_config_read - Read Driver configuration.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read driver configuration,  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_aux_device_config_read().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_driver_config_read
parameter_list|(
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_driver_config_t
name|drv_config
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
name|status
operator|=
name|xge_hal_mgmt_driver_config
argument_list|(
operator|&
name|drv_config
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_driver_config_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"queue size initial"
argument_list|,
name|drv_config
operator|.
name|queue_size_initial
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"queue size max"
argument_list|,
name|drv_config
operator|.
name|queue_size_max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

begin_comment
comment|/**  * xge_hal_aux_device_config_read - Read device configuration.  * @devh: HAL device handle.  * @bufsize: Buffer size.  * @retbuf: Buffer pointer.  * @retsize: Size of the result. Cannot be greater than @bufsize.  *  * Read device configuration,  *  * Returns: XGE_HAL_OK - success.  * XGE_HAL_ERR_INVALID_DEVICE - Device is not valid.  * XGE_HAL_ERR_VERSION_CONFLICT - Version it not maching.  *  * See also: xge_hal_aux_driver_config_read().  */
end_comment

begin_function
name|xge_hal_status_e
name|xge_hal_aux_device_config_read
parameter_list|(
name|xge_hal_device_h
name|devh
parameter_list|,
name|int
name|bufsize
parameter_list|,
name|char
modifier|*
name|retbuf
parameter_list|,
name|int
modifier|*
name|retsize
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|xge_hal_status_e
name|status
decl_stmt|;
name|xge_hal_device_config_t
modifier|*
name|dev_config
decl_stmt|;
name|xge_hal_device_t
modifier|*
name|hldev
init|=
operator|(
name|xge_hal_device_t
operator|*
operator|)
name|devh
decl_stmt|;
name|char
name|key
index|[
name|XGE_OS_SPRINTF_STRLEN
index|]
decl_stmt|;
name|__HAL_AUX_ENTRY_DECLARE
argument_list|(
name|bufsize
argument_list|,
name|retbuf
argument_list|)
expr_stmt|;
name|dev_config
operator|=
operator|(
name|xge_hal_device_config_t
operator|*
operator|)
name|xge_os_malloc
argument_list|(
name|hldev
operator|->
name|pdev
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_device_config_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dev_config
operator|==
name|NULL
condition|)
block|{
return|return
name|XGE_HAL_FAIL
return|;
block|}
name|status
operator|=
name|xge_hal_mgmt_device_config
argument_list|(
name|devh
argument_list|,
name|dev_config
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_device_config_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|XGE_HAL_OK
condition|)
block|{
name|xge_os_free
argument_list|(
name|hldev
operator|->
name|pdev
argument_list|,
name|dev_config
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_device_config_t
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"mtu"
argument_list|,
name|dev_config
operator|->
name|mtu
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"isr_polling_count"
argument_list|,
name|dev_config
operator|->
name|isr_polling_cnt
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"latency_timer"
argument_list|,
name|dev_config
operator|->
name|latency_timer
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"max_splits_trans"
argument_list|,
name|dev_config
operator|->
name|max_splits_trans
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"mmrb_count"
argument_list|,
name|dev_config
operator|->
name|mmrb_count
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"shared_splits"
argument_list|,
name|dev_config
operator|->
name|shared_splits
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"stats_refresh_time_sec"
argument_list|,
name|dev_config
operator|->
name|stats_refresh_time_sec
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"pci_freq_mherz"
argument_list|,
name|dev_config
operator|->
name|pci_freq_mherz
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"intr_mode"
argument_list|,
name|dev_config
operator|->
name|intr_mode
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"ring_memblock_size"
argument_list|,
name|dev_config
operator|->
name|ring
operator|.
name|memblock_size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"sched_timer_us"
argument_list|,
name|dev_config
operator|->
name|sched_timer_us
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"sched_timer_one_shot"
argument_list|,
name|dev_config
operator|->
name|sched_timer_one_shot
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxufca_intr_thres"
argument_list|,
name|dev_config
operator|->
name|rxufca_intr_thres
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxufca_lo_lim"
argument_list|,
name|dev_config
operator|->
name|rxufca_lo_lim
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxufca_hi_lim"
argument_list|,
name|dev_config
operator|->
name|rxufca_hi_lim
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rxufca_lbolt_period"
argument_list|,
name|dev_config
operator|->
name|rxufca_lbolt_period
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAX_RING_NUM
condition|;
name|i
operator|++
control|)
block|{
name|xge_hal_ring_queue_t
modifier|*
name|ring
init|=
operator|&
name|dev_config
operator|->
name|ring
operator|.
name|queue
index|[
name|i
index|]
decl_stmt|;
name|xge_hal_rti_config_t
modifier|*
name|rti
init|=
operator|&
name|ring
operator|->
name|rti
decl_stmt|;
if|if
condition|(
operator|!
name|ring
operator|->
name|configured
condition|)
continue|continue;
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"ring%d_"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"inital"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|initial
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"max"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"buffer_mode"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|buffer_mode
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"dram_size_mb"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|dram_size_mb
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"backoff_interval_us"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|backoff_interval_us
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"max_frame_len"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|max_frm_len
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"priority"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|priority
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"rth_en"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|rth_en
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"no_snoop_bits"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|no_snoop_bits
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"indicate_max_pkts"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|ring
operator|->
name|indicate_max_pkts
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"urange_a"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|urange_a
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_a"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|ufc_a
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"urange_b"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|urange_b
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_b"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|ufc_b
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"urange_c"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|urange_c
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_c"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|ufc_c
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|ufc_d
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"timer_val_us"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|rti
operator|->
name|timer_val_us
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|{
name|xge_hal_mac_config_t
modifier|*
name|mac
init|=
operator|&
name|dev_config
operator|->
name|mac
decl_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"tmac_util_period"
argument_list|,
name|mac
operator|->
name|tmac_util_period
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_util_period"
argument_list|,
name|mac
operator|->
name|rmac_util_period
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_bcast_en"
argument_list|,
name|mac
operator|->
name|rmac_bcast_en
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pause_gen_en"
argument_list|,
name|mac
operator|->
name|rmac_pause_gen_en
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pause_rcv_en"
argument_list|,
name|mac
operator|->
name|rmac_pause_rcv_en
argument_list|,
literal|"%d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rmac_pause_time"
argument_list|,
name|mac
operator|->
name|rmac_pause_time
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"mc_pause_threshold_q0q3"
argument_list|,
name|mac
operator|->
name|mc_pause_threshold_q0q3
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"mc_pause_threshold_q4q7"
argument_list|,
name|mac
operator|->
name|mc_pause_threshold_q4q7
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"fifo_max_frags"
argument_list|,
name|dev_config
operator|->
name|fifo
operator|.
name|max_frags
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"fifo_reserve_threshold"
argument_list|,
name|dev_config
operator|->
name|fifo
operator|.
name|reserve_threshold
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"fifo_memblock_size"
argument_list|,
name|dev_config
operator|->
name|fifo
operator|.
name|memblock_size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XGE_HAL_ALIGN_XMIT
name|__HAL_AUX_ENTRY
argument_list|(
literal|"fifo_alignment_size"
argument_list|,
name|dev_config
operator|->
name|fifo
operator|.
name|alignment_size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
endif|#
directive|endif
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAX_FIFO_NUM
condition|;
name|i
operator|++
control|)
block|{
name|int
name|j
decl_stmt|;
name|xge_hal_fifo_queue_t
modifier|*
name|fifo
init|=
operator|&
name|dev_config
operator|->
name|fifo
operator|.
name|queue
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|fifo
operator|->
name|configured
condition|)
continue|continue;
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"fifo%d_"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"initial"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|fifo
operator|->
name|initial
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"max"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|fifo
operator|->
name|max
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"intr"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|fifo
operator|->
name|intr
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"no_snoop_bits"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|fifo
operator|->
name|no_snoop_bits
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|XGE_HAL_MAX_FIFO_TTI_NUM
condition|;
name|j
operator|++
control|)
block|{
name|xge_hal_tti_config_t
modifier|*
name|tti
init|=
operator|&
name|dev_config
operator|->
name|fifo
operator|.
name|queue
index|[
name|i
index|]
operator|.
name|tti
index|[
name|j
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|tti
operator|->
name|enabled
condition|)
continue|continue;
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"fifo%d_tti%02d_"
argument_list|,
name|i
argument_list|,
name|i
operator|*
name|XGE_HAL_MAX_FIFO_TTI_NUM
operator|+
name|j
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"urange_a"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|urange_a
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"ufc_a"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_a
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"urange_b"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|urange_b
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"ufc_b"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_b
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"urange_c"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|urange_c
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"ufc_c"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_c
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"ufc_d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_d
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"timer_val_us"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|timer_val_us
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|12
argument_list|,
literal|"timer_ci_en"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|timer_ci_en
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* and bimodal TTIs */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XGE_HAL_MAX_RING_NUM
condition|;
name|i
operator|++
control|)
block|{
name|xge_hal_tti_config_t
modifier|*
name|tti
init|=
operator|&
name|hldev
operator|->
name|bimodal_tti
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|tti
operator|->
name|enabled
condition|)
continue|continue;
operator|(
name|void
operator|)
name|xge_os_sprintf
argument_list|(
name|key
argument_list|,
literal|"tti%02d_"
argument_list|,
name|XGE_HAL_MAX_FIFO_TTI_RING_0
operator|+
name|i
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"urange_a"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|urange_a
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_a"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_a
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"urange_b"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|urange_b
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_b"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_b
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"urange_c"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|urange_c
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_c"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_c
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"ufc_d"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|ufc_d
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"timer_val_us"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|timer_val_us
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"timer_ac_en"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|timer_ac_en
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|xge_os_strcpy
argument_list|(
name|key
operator|+
literal|6
argument_list|,
literal|"timer_ci_en"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
name|key
argument_list|,
name|tti
operator|->
name|timer_ci_en
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
name|__HAL_AUX_ENTRY
argument_list|(
literal|"dump_on_serr"
argument_list|,
name|dev_config
operator|->
name|dump_on_serr
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"dump_on_eccerr"
argument_list|,
name|dev_config
operator|->
name|dump_on_eccerr
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"dump_on_parityerr"
argument_list|,
name|dev_config
operator|->
name|dump_on_parityerr
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rth_en"
argument_list|,
name|dev_config
operator|->
name|rth_en
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY
argument_list|(
literal|"rth_bucket_size"
argument_list|,
name|dev_config
operator|->
name|rth_bucket_size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|__HAL_AUX_ENTRY_END
argument_list|(
name|bufsize
argument_list|,
name|retsize
argument_list|)
expr_stmt|;
name|xge_os_free
argument_list|(
name|hldev
operator|->
name|pdev
argument_list|,
name|dev_config
argument_list|,
sizeof|sizeof
argument_list|(
name|xge_hal_device_config_t
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|XGE_HAL_OK
return|;
block|}
end_function

end_unit

