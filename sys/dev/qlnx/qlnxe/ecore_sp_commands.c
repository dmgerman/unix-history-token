begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2017-2018 Cavium, Inc.   * All rights reserved.  *  *  Redistribution and use in source and binary forms, with or without  *  modification, are permitted provided that the following conditions  *  are met:  *  *  1. Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  *  2. Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in the  *     documentation and/or other materials provided with the distribution.  *  *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"  *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE  *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  *  POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * File : ecore_sp_commands.c  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"bcm_osal.h"
end_include

begin_include
include|#
directive|include
file|"ecore.h"
end_include

begin_include
include|#
directive|include
file|"ecore_status.h"
end_include

begin_include
include|#
directive|include
file|"ecore_chain.h"
end_include

begin_include
include|#
directive|include
file|"ecore_spq.h"
end_include

begin_include
include|#
directive|include
file|"ecore_init_fw_funcs.h"
end_include

begin_include
include|#
directive|include
file|"ecore_cxt.h"
end_include

begin_include
include|#
directive|include
file|"ecore_sp_commands.h"
end_include

begin_include
include|#
directive|include
file|"ecore_gtt_reg_addr.h"
end_include

begin_include
include|#
directive|include
file|"ecore_iro.h"
end_include

begin_include
include|#
directive|include
file|"reg_addr.h"
end_include

begin_include
include|#
directive|include
file|"ecore_int.h"
end_include

begin_include
include|#
directive|include
file|"ecore_hw.h"
end_include

begin_include
include|#
directive|include
file|"ecore_dcbx.h"
end_include

begin_include
include|#
directive|include
file|"ecore_sriov.h"
end_include

begin_include
include|#
directive|include
file|"ecore_vf.h"
end_include

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_init_request
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_spq_entry
modifier|*
modifier|*
name|pp_ent
parameter_list|,
name|u8
name|cmd
parameter_list|,
name|u8
name|protocol
parameter_list|,
name|struct
name|ecore_sp_init_data
modifier|*
name|p_data
parameter_list|)
block|{
name|u32
name|opaque_cid
init|=
name|p_data
operator|->
name|opaque_fid
operator|<<
literal|16
operator||
name|p_data
operator|->
name|cid
decl_stmt|;
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
decl_stmt|;
if|if
condition|(
operator|!
name|pp_ent
condition|)
return|return
name|ECORE_INVAL
return|;
comment|/* Get an SPQ entry */
name|rc
operator|=
name|ecore_spq_get_entry
argument_list|(
name|p_hwfn
argument_list|,
name|pp_ent
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
comment|/* Fill the SPQ entry */
name|p_ent
operator|=
operator|*
name|pp_ent
expr_stmt|;
name|p_ent
operator|->
name|elem
operator|.
name|hdr
operator|.
name|cid
operator|=
name|OSAL_CPU_TO_LE32
argument_list|(
name|opaque_cid
argument_list|)
expr_stmt|;
name|p_ent
operator|->
name|elem
operator|.
name|hdr
operator|.
name|cmd_id
operator|=
name|cmd
expr_stmt|;
name|p_ent
operator|->
name|elem
operator|.
name|hdr
operator|.
name|protocol_id
operator|=
name|protocol
expr_stmt|;
name|p_ent
operator|->
name|priority
operator|=
name|ECORE_SPQ_PRIORITY_NORMAL
expr_stmt|;
name|p_ent
operator|->
name|comp_mode
operator|=
name|p_data
operator|->
name|comp_mode
expr_stmt|;
name|p_ent
operator|->
name|comp_done
operator|.
name|done
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|p_ent
operator|->
name|comp_mode
condition|)
block|{
case|case
name|ECORE_SPQ_MODE_EBLOCK
case|:
name|p_ent
operator|->
name|comp_cb
operator|.
name|cookie
operator|=
operator|&
name|p_ent
operator|->
name|comp_done
expr_stmt|;
break|break;
case|case
name|ECORE_SPQ_MODE_BLOCK
case|:
if|if
condition|(
operator|!
name|p_data
operator|->
name|p_comp_data
condition|)
return|return
name|ECORE_INVAL
return|;
name|p_ent
operator|->
name|comp_cb
operator|.
name|cookie
operator|=
name|p_data
operator|->
name|p_comp_data
operator|->
name|cookie
expr_stmt|;
break|break;
case|case
name|ECORE_SPQ_MODE_CB
case|:
if|if
condition|(
operator|!
name|p_data
operator|->
name|p_comp_data
condition|)
name|p_ent
operator|->
name|comp_cb
operator|.
name|function
operator|=
name|OSAL_NULL
expr_stmt|;
else|else
name|p_ent
operator|->
name|comp_cb
operator|=
operator|*
name|p_data
operator|->
name|p_comp_data
expr_stmt|;
break|break;
default|default:
name|DP_NOTICE
argument_list|(
name|p_hwfn
argument_list|,
name|true
argument_list|,
literal|"Unknown SPQE completion mode %d\n"
argument_list|,
name|p_ent
operator|->
name|comp_mode
argument_list|)
expr_stmt|;
return|return
name|ECORE_INVAL
return|;
block|}
name|DP_VERBOSE
argument_list|(
name|p_hwfn
argument_list|,
name|ECORE_MSG_SPQ
argument_list|,
literal|"Initialized: CID %08x cmd %02x protocol %02x data_addr %lu comp_mode [%s]\n"
argument_list|,
name|opaque_cid
argument_list|,
name|cmd
argument_list|,
name|protocol
argument_list|,
operator|(
name|unsigned
name|long
operator|)
operator|&
name|p_ent
operator|->
name|ramrod
argument_list|,
name|D_TRINE
argument_list|(
name|p_ent
operator|->
name|comp_mode
argument_list|,
name|ECORE_SPQ_MODE_EBLOCK
argument_list|,
name|ECORE_SPQ_MODE_BLOCK
argument_list|,
literal|"MODE_EBLOCK"
argument_list|,
literal|"MODE_BLOCK"
argument_list|,
literal|"MODE_CB"
argument_list|)
argument_list|)
expr_stmt|;
name|OSAL_MEMSET
argument_list|(
operator|&
name|p_ent
operator|->
name|ramrod
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|p_ent
operator|->
name|ramrod
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ECORE_SUCCESS
return|;
block|}
end_function

begin_function
specifier|static
name|enum
name|tunnel_clss
name|ecore_tunn_clss_to_fw_clss
parameter_list|(
name|u8
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|ECORE_TUNN_CLSS_MAC_VLAN
case|:
return|return
name|TUNNEL_CLSS_MAC_VLAN
return|;
case|case
name|ECORE_TUNN_CLSS_MAC_VNI
case|:
return|return
name|TUNNEL_CLSS_MAC_VNI
return|;
case|case
name|ECORE_TUNN_CLSS_INNER_MAC_VLAN
case|:
return|return
name|TUNNEL_CLSS_INNER_MAC_VLAN
return|;
case|case
name|ECORE_TUNN_CLSS_INNER_MAC_VNI
case|:
return|return
name|TUNNEL_CLSS_INNER_MAC_VNI
return|;
case|case
name|ECORE_TUNN_CLSS_MAC_VLAN_DUAL_STAGE
case|:
return|return
name|TUNNEL_CLSS_MAC_VLAN_DUAL_STAGE
return|;
default|default:
return|return
name|TUNNEL_CLSS_MAC_VLAN
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_set_pf_update_tunn_mode
parameter_list|(
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tun
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_src
parameter_list|,
name|bool
name|b_pf_start
parameter_list|)
block|{
if|if
condition|(
name|p_src
operator|->
name|vxlan
operator|.
name|b_update_mode
operator|||
name|b_pf_start
condition|)
name|p_tun
operator|->
name|vxlan
operator|.
name|b_mode_enabled
operator|=
name|p_src
operator|->
name|vxlan
operator|.
name|b_mode_enabled
expr_stmt|;
if|if
condition|(
name|p_src
operator|->
name|l2_gre
operator|.
name|b_update_mode
operator|||
name|b_pf_start
condition|)
name|p_tun
operator|->
name|l2_gre
operator|.
name|b_mode_enabled
operator|=
name|p_src
operator|->
name|l2_gre
operator|.
name|b_mode_enabled
expr_stmt|;
if|if
condition|(
name|p_src
operator|->
name|ip_gre
operator|.
name|b_update_mode
operator|||
name|b_pf_start
condition|)
name|p_tun
operator|->
name|ip_gre
operator|.
name|b_mode_enabled
operator|=
name|p_src
operator|->
name|ip_gre
operator|.
name|b_mode_enabled
expr_stmt|;
if|if
condition|(
name|p_src
operator|->
name|l2_geneve
operator|.
name|b_update_mode
operator|||
name|b_pf_start
condition|)
name|p_tun
operator|->
name|l2_geneve
operator|.
name|b_mode_enabled
operator|=
name|p_src
operator|->
name|l2_geneve
operator|.
name|b_mode_enabled
expr_stmt|;
if|if
condition|(
name|p_src
operator|->
name|ip_geneve
operator|.
name|b_update_mode
operator|||
name|b_pf_start
condition|)
name|p_tun
operator|->
name|ip_geneve
operator|.
name|b_mode_enabled
operator|=
name|p_src
operator|->
name|ip_geneve
operator|.
name|b_mode_enabled
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_set_tunn_cls_info
parameter_list|(
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tun
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_src
parameter_list|)
block|{
name|enum
name|tunnel_clss
name|type
decl_stmt|;
name|p_tun
operator|->
name|b_update_rx_cls
operator|=
name|p_src
operator|->
name|b_update_rx_cls
expr_stmt|;
name|p_tun
operator|->
name|b_update_tx_cls
operator|=
name|p_src
operator|->
name|b_update_tx_cls
expr_stmt|;
name|type
operator|=
name|ecore_tunn_clss_to_fw_clss
argument_list|(
name|p_src
operator|->
name|vxlan
operator|.
name|tun_cls
argument_list|)
expr_stmt|;
name|p_tun
operator|->
name|vxlan
operator|.
name|tun_cls
operator|=
operator|(
expr|enum
name|ecore_tunn_clss
operator|)
name|type
expr_stmt|;
name|type
operator|=
name|ecore_tunn_clss_to_fw_clss
argument_list|(
name|p_src
operator|->
name|l2_gre
operator|.
name|tun_cls
argument_list|)
expr_stmt|;
name|p_tun
operator|->
name|l2_gre
operator|.
name|tun_cls
operator|=
operator|(
expr|enum
name|ecore_tunn_clss
operator|)
name|type
expr_stmt|;
name|type
operator|=
name|ecore_tunn_clss_to_fw_clss
argument_list|(
name|p_src
operator|->
name|ip_gre
operator|.
name|tun_cls
argument_list|)
expr_stmt|;
name|p_tun
operator|->
name|ip_gre
operator|.
name|tun_cls
operator|=
operator|(
expr|enum
name|ecore_tunn_clss
operator|)
name|type
expr_stmt|;
name|type
operator|=
name|ecore_tunn_clss_to_fw_clss
argument_list|(
name|p_src
operator|->
name|l2_geneve
operator|.
name|tun_cls
argument_list|)
expr_stmt|;
name|p_tun
operator|->
name|l2_geneve
operator|.
name|tun_cls
operator|=
operator|(
expr|enum
name|ecore_tunn_clss
operator|)
name|type
expr_stmt|;
name|type
operator|=
name|ecore_tunn_clss_to_fw_clss
argument_list|(
name|p_src
operator|->
name|ip_geneve
operator|.
name|tun_cls
argument_list|)
expr_stmt|;
name|p_tun
operator|->
name|ip_geneve
operator|.
name|tun_cls
operator|=
operator|(
expr|enum
name|ecore_tunn_clss
operator|)
name|type
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_set_tunn_ports
parameter_list|(
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tun
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_src
parameter_list|)
block|{
name|p_tun
operator|->
name|geneve_port
operator|.
name|b_update_port
operator|=
name|p_src
operator|->
name|geneve_port
operator|.
name|b_update_port
expr_stmt|;
name|p_tun
operator|->
name|vxlan_port
operator|.
name|b_update_port
operator|=
name|p_src
operator|->
name|vxlan_port
operator|.
name|b_update_port
expr_stmt|;
if|if
condition|(
name|p_src
operator|->
name|geneve_port
operator|.
name|b_update_port
condition|)
name|p_tun
operator|->
name|geneve_port
operator|.
name|port
operator|=
name|p_src
operator|->
name|geneve_port
operator|.
name|port
expr_stmt|;
if|if
condition|(
name|p_src
operator|->
name|vxlan_port
operator|.
name|b_update_port
condition|)
name|p_tun
operator|->
name|vxlan_port
operator|.
name|port
operator|=
name|p_src
operator|->
name|vxlan_port
operator|.
name|port
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|__ecore_set_ramrod_tunnel_param
parameter_list|(
name|u8
modifier|*
name|p_tunn_cls
parameter_list|,
name|struct
name|ecore_tunn_update_type
modifier|*
name|tun_type
parameter_list|)
block|{
operator|*
name|p_tunn_cls
operator|=
name|tun_type
operator|->
name|tun_cls
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_set_ramrod_tunnel_param
parameter_list|(
name|u8
modifier|*
name|p_tunn_cls
parameter_list|,
name|struct
name|ecore_tunn_update_type
modifier|*
name|tun_type
parameter_list|,
name|u8
modifier|*
name|p_update_port
parameter_list|,
name|__le16
modifier|*
name|p_port
parameter_list|,
name|struct
name|ecore_tunn_update_udp_port
modifier|*
name|p_udp_port
parameter_list|)
block|{
name|__ecore_set_ramrod_tunnel_param
argument_list|(
name|p_tunn_cls
argument_list|,
name|tun_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_udp_port
operator|->
name|b_update_port
condition|)
block|{
operator|*
name|p_update_port
operator|=
literal|1
expr_stmt|;
operator|*
name|p_port
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
name|p_udp_port
operator|->
name|port
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_tunn_set_pf_update_params
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_src
parameter_list|,
name|struct
name|pf_update_tunnel_config
modifier|*
name|p_tunn_cfg
parameter_list|)
block|{
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tun
init|=
operator|&
name|p_hwfn
operator|->
name|p_dev
operator|->
name|tunnel
decl_stmt|;
name|ecore_set_pf_update_tunn_mode
argument_list|(
name|p_tun
argument_list|,
name|p_src
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ecore_set_tunn_cls_info
argument_list|(
name|p_tun
argument_list|,
name|p_src
argument_list|)
expr_stmt|;
name|ecore_set_tunn_ports
argument_list|(
name|p_tun
argument_list|,
name|p_src
argument_list|)
expr_stmt|;
name|ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_vxlan
argument_list|,
operator|&
name|p_tun
operator|->
name|vxlan
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|set_vxlan_udp_port_flg
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|vxlan_udp_port
argument_list|,
operator|&
name|p_tun
operator|->
name|vxlan_port
argument_list|)
expr_stmt|;
name|ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_l2geneve
argument_list|,
operator|&
name|p_tun
operator|->
name|l2_geneve
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|set_geneve_udp_port_flg
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|geneve_udp_port
argument_list|,
operator|&
name|p_tun
operator|->
name|geneve_port
argument_list|)
expr_stmt|;
name|__ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_ipgeneve
argument_list|,
operator|&
name|p_tun
operator|->
name|ip_geneve
argument_list|)
expr_stmt|;
name|__ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_l2gre
argument_list|,
operator|&
name|p_tun
operator|->
name|l2_gre
argument_list|)
expr_stmt|;
name|__ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_ipgre
argument_list|,
operator|&
name|p_tun
operator|->
name|ip_gre
argument_list|)
expr_stmt|;
name|p_tunn_cfg
operator|->
name|update_rx_pf_clss
operator|=
name|p_tun
operator|->
name|b_update_rx_cls
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_set_hw_tunn_mode
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_ptt
modifier|*
name|p_ptt
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tun
parameter_list|)
block|{
name|ecore_set_gre_enable
argument_list|(
name|p_hwfn
argument_list|,
name|p_ptt
argument_list|,
name|p_tun
operator|->
name|l2_gre
operator|.
name|b_mode_enabled
argument_list|,
name|p_tun
operator|->
name|ip_gre
operator|.
name|b_mode_enabled
argument_list|)
expr_stmt|;
name|ecore_set_vxlan_enable
argument_list|(
name|p_hwfn
argument_list|,
name|p_ptt
argument_list|,
name|p_tun
operator|->
name|vxlan
operator|.
name|b_mode_enabled
argument_list|)
expr_stmt|;
name|ecore_set_geneve_enable
argument_list|(
name|p_hwfn
argument_list|,
name|p_ptt
argument_list|,
name|p_tun
operator|->
name|l2_geneve
operator|.
name|b_mode_enabled
argument_list|,
name|p_tun
operator|->
name|ip_geneve
operator|.
name|b_mode_enabled
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_set_hw_tunn_mode_port
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tunn
parameter_list|)
block|{
if|if
condition|(
name|ECORE_IS_BB_A0
argument_list|(
name|p_hwfn
operator|->
name|p_dev
argument_list|)
condition|)
block|{
name|DP_NOTICE
argument_list|(
name|p_hwfn
argument_list|,
name|true
argument_list|,
literal|"A0 chip: tunnel hw config is not supported\n"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|p_tunn
operator|->
name|vxlan_port
operator|.
name|b_update_port
condition|)
name|ecore_set_vxlan_dest_port
argument_list|(
name|p_hwfn
argument_list|,
name|p_hwfn
operator|->
name|p_main_ptt
argument_list|,
name|p_tunn
operator|->
name|vxlan_port
operator|.
name|port
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_tunn
operator|->
name|geneve_port
operator|.
name|b_update_port
condition|)
name|ecore_set_geneve_dest_port
argument_list|(
name|p_hwfn
argument_list|,
name|p_hwfn
operator|->
name|p_main_ptt
argument_list|,
name|p_tunn
operator|->
name|geneve_port
operator|.
name|port
argument_list|)
expr_stmt|;
name|ecore_set_hw_tunn_mode
argument_list|(
name|p_hwfn
argument_list|,
name|p_hwfn
operator|->
name|p_main_ptt
argument_list|,
name|p_tunn
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ecore_tunn_set_pf_start_params
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_src
parameter_list|,
name|struct
name|pf_start_tunnel_config
modifier|*
name|p_tunn_cfg
parameter_list|)
block|{
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tun
init|=
operator|&
name|p_hwfn
operator|->
name|p_dev
operator|->
name|tunnel
decl_stmt|;
if|if
condition|(
name|ECORE_IS_BB_A0
argument_list|(
name|p_hwfn
operator|->
name|p_dev
argument_list|)
condition|)
block|{
name|DP_NOTICE
argument_list|(
name|p_hwfn
argument_list|,
name|true
argument_list|,
literal|"A0 chip: tunnel pf start config is not supported\n"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|p_src
condition|)
return|return;
name|ecore_set_pf_update_tunn_mode
argument_list|(
name|p_tun
argument_list|,
name|p_src
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|ecore_set_tunn_cls_info
argument_list|(
name|p_tun
argument_list|,
name|p_src
argument_list|)
expr_stmt|;
name|ecore_set_tunn_ports
argument_list|(
name|p_tun
argument_list|,
name|p_src
argument_list|)
expr_stmt|;
name|ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_vxlan
argument_list|,
operator|&
name|p_tun
operator|->
name|vxlan
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|set_vxlan_udp_port_flg
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|vxlan_udp_port
argument_list|,
operator|&
name|p_tun
operator|->
name|vxlan_port
argument_list|)
expr_stmt|;
name|ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_l2geneve
argument_list|,
operator|&
name|p_tun
operator|->
name|l2_geneve
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|set_geneve_udp_port_flg
argument_list|,
operator|&
name|p_tunn_cfg
operator|->
name|geneve_udp_port
argument_list|,
operator|&
name|p_tun
operator|->
name|geneve_port
argument_list|)
expr_stmt|;
name|__ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_ipgeneve
argument_list|,
operator|&
name|p_tun
operator|->
name|ip_geneve
argument_list|)
expr_stmt|;
name|__ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_l2gre
argument_list|,
operator|&
name|p_tun
operator|->
name|l2_gre
argument_list|)
expr_stmt|;
name|__ecore_set_ramrod_tunnel_param
argument_list|(
operator|&
name|p_tunn_cfg
operator|->
name|tunnel_clss_ipgre
argument_list|,
operator|&
name|p_tun
operator|->
name|ip_gre
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_pf_start
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tunn
parameter_list|,
name|enum
name|ecore_mf_mode
name|mode
parameter_list|,
name|bool
name|allow_npar_tx_switch
parameter_list|)
block|{
name|struct
name|pf_start_ramrod_data
modifier|*
name|p_ramrod
init|=
name|OSAL_NULL
decl_stmt|;
name|u16
name|sb
init|=
name|ecore_int_get_sp_sb_id
argument_list|(
name|p_hwfn
argument_list|)
decl_stmt|;
name|u8
name|sb_index
init|=
name|p_hwfn
operator|->
name|p_eq
operator|->
name|eq_sb_index
decl_stmt|;
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|struct
name|ecore_sp_init_data
name|init_data
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
init|=
name|ECORE_NOTIMPL
decl_stmt|;
name|u8
name|page_cnt
decl_stmt|;
comment|/* update initial eq producer */
name|ecore_eq_prod_update
argument_list|(
name|p_hwfn
argument_list|,
name|ecore_chain_get_prod_idx
argument_list|(
operator|&
name|p_hwfn
operator|->
name|p_eq
operator|->
name|chain
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Initialize the SPQ entry for the ramrod */
name|OSAL_MEMSET
argument_list|(
operator|&
name|init_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|init_data
argument_list|)
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|cid
operator|=
name|ecore_spq_get_cid
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|opaque_fid
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|opaque_fid
expr_stmt|;
name|init_data
operator|.
name|comp_mode
operator|=
name|ECORE_SPQ_MODE_EBLOCK
expr_stmt|;
name|rc
operator|=
name|ecore_sp_init_request
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_ent
argument_list|,
name|COMMON_RAMROD_PF_START
argument_list|,
name|PROTOCOLID_COMMON
argument_list|,
operator|&
name|init_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
comment|/* Fill the ramrod data */
name|p_ramrod
operator|=
operator|&
name|p_ent
operator|->
name|ramrod
operator|.
name|pf_start
expr_stmt|;
name|p_ramrod
operator|->
name|event_ring_sb_id
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
name|sb
argument_list|)
expr_stmt|;
name|p_ramrod
operator|->
name|event_ring_sb_index
operator|=
name|sb_index
expr_stmt|;
name|p_ramrod
operator|->
name|path_id
operator|=
name|ECORE_PATH_ID
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
comment|/* For easier debugging */
name|p_ramrod
operator|->
name|dont_log_ramrods
operator|=
literal|0
expr_stmt|;
name|p_ramrod
operator|->
name|log_type_mask
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
literal|0x8f
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|ECORE_MF_DEFAULT
case|:
case|case
name|ECORE_MF_NPAR
case|:
name|p_ramrod
operator|->
name|mf_mode
operator|=
name|MF_NPAR
expr_stmt|;
break|break;
case|case
name|ECORE_MF_OVLAN
case|:
name|p_ramrod
operator|->
name|mf_mode
operator|=
name|MF_OVLAN
expr_stmt|;
break|break;
default|default:
name|DP_NOTICE
argument_list|(
name|p_hwfn
argument_list|,
name|true
argument_list|,
literal|"Unsupported MF mode, init as DEFAULT\n"
argument_list|)
expr_stmt|;
name|p_ramrod
operator|->
name|mf_mode
operator|=
name|MF_NPAR
expr_stmt|;
block|}
name|p_ramrod
operator|->
name|outer_tag
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|ovlan
expr_stmt|;
comment|/* Place EQ address in RAMROD */
name|DMA_REGPAIR_LE
argument_list|(
name|p_ramrod
operator|->
name|event_ring_pbl_addr
argument_list|,
name|p_hwfn
operator|->
name|p_eq
operator|->
name|chain
operator|.
name|pbl_sp
operator|.
name|p_phys_table
argument_list|)
expr_stmt|;
name|page_cnt
operator|=
operator|(
name|u8
operator|)
name|ecore_chain_get_page_cnt
argument_list|(
operator|&
name|p_hwfn
operator|->
name|p_eq
operator|->
name|chain
argument_list|)
expr_stmt|;
name|p_ramrod
operator|->
name|event_ring_num_pages
operator|=
name|page_cnt
expr_stmt|;
name|DMA_REGPAIR_LE
argument_list|(
name|p_ramrod
operator|->
name|consolid_q_pbl_addr
argument_list|,
name|p_hwfn
operator|->
name|p_consq
operator|->
name|chain
operator|.
name|pbl_sp
operator|.
name|p_phys_table
argument_list|)
expr_stmt|;
name|ecore_tunn_set_pf_start_params
argument_list|(
name|p_hwfn
argument_list|,
name|p_tunn
argument_list|,
operator|&
name|p_ramrod
operator|->
name|tunnel_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_MF_SI
argument_list|(
name|p_hwfn
argument_list|)
condition|)
name|p_ramrod
operator|->
name|allow_npar_tx_switching
operator|=
name|allow_npar_tx_switch
expr_stmt|;
switch|switch
condition|(
name|p_hwfn
operator|->
name|hw_info
operator|.
name|personality
condition|)
block|{
case|case
name|ECORE_PCI_ETH
case|:
name|p_ramrod
operator|->
name|personality
operator|=
name|PERSONALITY_ETH
expr_stmt|;
break|break;
case|case
name|ECORE_PCI_FCOE
case|:
name|p_ramrod
operator|->
name|personality
operator|=
name|PERSONALITY_FCOE
expr_stmt|;
break|break;
case|case
name|ECORE_PCI_ISCSI
case|:
name|p_ramrod
operator|->
name|personality
operator|=
name|PERSONALITY_ISCSI
expr_stmt|;
break|break;
case|case
name|ECORE_PCI_ETH_IWARP
case|:
case|case
name|ECORE_PCI_ETH_ROCE
case|:
case|case
name|ECORE_PCI_ETH_RDMA
case|:
name|p_ramrod
operator|->
name|personality
operator|=
name|PERSONALITY_RDMA_AND_ETH
expr_stmt|;
break|break;
default|default:
name|DP_NOTICE
argument_list|(
name|p_hwfn
argument_list|,
name|true
argument_list|,
literal|"Unknown personality %d\n"
argument_list|,
name|p_hwfn
operator|->
name|hw_info
operator|.
name|personality
argument_list|)
expr_stmt|;
name|p_ramrod
operator|->
name|personality
operator|=
name|PERSONALITY_ETH
expr_stmt|;
block|}
if|if
condition|(
name|p_hwfn
operator|->
name|p_dev
operator|->
name|p_iov_info
condition|)
block|{
name|struct
name|ecore_hw_sriov_info
modifier|*
name|p_iov
init|=
name|p_hwfn
operator|->
name|p_dev
operator|->
name|p_iov_info
decl_stmt|;
name|p_ramrod
operator|->
name|base_vf_id
operator|=
operator|(
name|u8
operator|)
name|p_iov
operator|->
name|first_vf_in_pf
expr_stmt|;
name|p_ramrod
operator|->
name|num_vfs
operator|=
operator|(
name|u8
operator|)
name|p_iov
operator|->
name|total_vfs
expr_stmt|;
block|}
comment|/* @@@TBD - update also the "ROCE_VER_KEY" entries when the FW RoCE HSI 	 * version is available. 	 */
name|p_ramrod
operator|->
name|hsi_fp_ver
operator|.
name|major_ver_arr
index|[
name|ETH_VER_KEY
index|]
operator|=
name|ETH_HSI_VER_MAJOR
expr_stmt|;
name|p_ramrod
operator|->
name|hsi_fp_ver
operator|.
name|minor_ver_arr
index|[
name|ETH_VER_KEY
index|]
operator|=
name|ETH_HSI_VER_MINOR
expr_stmt|;
name|DP_VERBOSE
argument_list|(
name|p_hwfn
argument_list|,
name|ECORE_MSG_SPQ
argument_list|,
literal|"Setting event_ring_sb [id %04x index %02x], outer_tag [%d]\n"
argument_list|,
name|sb
argument_list|,
name|sb_index
argument_list|,
name|p_ramrod
operator|->
name|outer_tag
argument_list|)
expr_stmt|;
name|rc
operator|=
name|ecore_spq_post
argument_list|(
name|p_hwfn
argument_list|,
name|p_ent
argument_list|,
name|OSAL_NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_tunn
condition|)
name|ecore_set_hw_tunn_mode_port
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_hwfn
operator|->
name|p_dev
operator|->
name|tunnel
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
end_function

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_pf_update
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|)
block|{
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|struct
name|ecore_sp_init_data
name|init_data
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
init|=
name|ECORE_NOTIMPL
decl_stmt|;
comment|/* Get SPQ entry */
name|OSAL_MEMSET
argument_list|(
operator|&
name|init_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|init_data
argument_list|)
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|cid
operator|=
name|ecore_spq_get_cid
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|opaque_fid
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|opaque_fid
expr_stmt|;
name|init_data
operator|.
name|comp_mode
operator|=
name|ECORE_SPQ_MODE_CB
expr_stmt|;
name|rc
operator|=
name|ecore_sp_init_request
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_ent
argument_list|,
name|COMMON_RAMROD_PF_UPDATE
argument_list|,
name|PROTOCOLID_COMMON
argument_list|,
operator|&
name|init_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
name|ecore_dcbx_set_pf_update_params
argument_list|(
operator|&
name|p_hwfn
operator|->
name|p_dcbx_info
operator|->
name|results
argument_list|,
operator|&
name|p_ent
operator|->
name|ramrod
operator|.
name|pf_update
argument_list|)
expr_stmt|;
return|return
name|ecore_spq_post
argument_list|(
name|p_hwfn
argument_list|,
name|p_ent
argument_list|,
name|OSAL_NULL
argument_list|)
return|;
block|}
end_function

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_rl_update
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_rl_update_params
modifier|*
name|params
parameter_list|)
block|{
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
init|=
name|ECORE_NOTIMPL
decl_stmt|;
name|struct
name|rl_update_ramrod_data
modifier|*
name|rl_update
decl_stmt|;
name|struct
name|ecore_sp_init_data
name|init_data
decl_stmt|;
comment|/* Get SPQ entry */
name|OSAL_MEMSET
argument_list|(
operator|&
name|init_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|init_data
argument_list|)
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|cid
operator|=
name|ecore_spq_get_cid
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|opaque_fid
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|opaque_fid
expr_stmt|;
name|init_data
operator|.
name|comp_mode
operator|=
name|ECORE_SPQ_MODE_EBLOCK
expr_stmt|;
name|rc
operator|=
name|ecore_sp_init_request
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_ent
argument_list|,
name|COMMON_RAMROD_RL_UPDATE
argument_list|,
name|PROTOCOLID_COMMON
argument_list|,
operator|&
name|init_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
name|rl_update
operator|=
operator|&
name|p_ent
operator|->
name|ramrod
operator|.
name|rl_update
expr_stmt|;
name|rl_update
operator|->
name|qcn_update_param_flg
operator|=
name|params
operator|->
name|qcn_update_param_flg
expr_stmt|;
name|rl_update
operator|->
name|dcqcn_update_param_flg
operator|=
name|params
operator|->
name|dcqcn_update_param_flg
expr_stmt|;
name|rl_update
operator|->
name|rl_init_flg
operator|=
name|params
operator|->
name|rl_init_flg
expr_stmt|;
name|rl_update
operator|->
name|rl_start_flg
operator|=
name|params
operator|->
name|rl_start_flg
expr_stmt|;
name|rl_update
operator|->
name|rl_stop_flg
operator|=
name|params
operator|->
name|rl_stop_flg
expr_stmt|;
name|rl_update
operator|->
name|rl_id_first
operator|=
name|params
operator|->
name|rl_id_first
expr_stmt|;
name|rl_update
operator|->
name|rl_id_last
operator|=
name|params
operator|->
name|rl_id_last
expr_stmt|;
name|rl_update
operator|->
name|rl_dc_qcn_flg
operator|=
name|params
operator|->
name|rl_dc_qcn_flg
expr_stmt|;
name|rl_update
operator|->
name|rl_bc_rate
operator|=
name|OSAL_CPU_TO_LE32
argument_list|(
name|params
operator|->
name|rl_bc_rate
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|rl_max_rate
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
name|params
operator|->
name|rl_max_rate
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|rl_r_ai
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
name|params
operator|->
name|rl_r_ai
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|rl_r_hai
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
name|params
operator|->
name|rl_r_hai
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|dcqcn_g
operator|=
name|OSAL_CPU_TO_LE16
argument_list|(
name|params
operator|->
name|dcqcn_g
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|dcqcn_k_us
operator|=
name|OSAL_CPU_TO_LE32
argument_list|(
name|params
operator|->
name|dcqcn_k_us
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|dcqcn_timeuot_us
operator|=
name|OSAL_CPU_TO_LE32
argument_list|(
name|params
operator|->
name|dcqcn_timeuot_us
argument_list|)
expr_stmt|;
name|rl_update
operator|->
name|qcn_timeuot_us
operator|=
name|OSAL_CPU_TO_LE32
argument_list|(
name|params
operator|->
name|qcn_timeuot_us
argument_list|)
expr_stmt|;
return|return
name|ecore_spq_post
argument_list|(
name|p_hwfn
argument_list|,
name|p_ent
argument_list|,
name|OSAL_NULL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Set pf update ramrod command params */
end_comment

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_pf_update_tunn_cfg
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|,
name|struct
name|ecore_tunnel_info
modifier|*
name|p_tunn
parameter_list|,
name|enum
name|spq_mode
name|comp_mode
parameter_list|,
name|struct
name|ecore_spq_comp_cb
modifier|*
name|p_comp_data
parameter_list|)
block|{
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|struct
name|ecore_sp_init_data
name|init_data
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
init|=
name|ECORE_NOTIMPL
decl_stmt|;
if|if
condition|(
name|IS_VF
argument_list|(
name|p_hwfn
operator|->
name|p_dev
argument_list|)
condition|)
return|return
name|ecore_vf_pf_tunnel_param_update
argument_list|(
name|p_hwfn
argument_list|,
name|p_tunn
argument_list|)
return|;
if|if
condition|(
name|ECORE_IS_BB_A0
argument_list|(
name|p_hwfn
operator|->
name|p_dev
argument_list|)
condition|)
block|{
name|DP_NOTICE
argument_list|(
name|p_hwfn
argument_list|,
name|true
argument_list|,
literal|"A0 chip: tunnel pf update config is not supported\n"
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
if|if
condition|(
operator|!
name|p_tunn
condition|)
return|return
name|ECORE_INVAL
return|;
comment|/* Get SPQ entry */
name|OSAL_MEMSET
argument_list|(
operator|&
name|init_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|init_data
argument_list|)
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|cid
operator|=
name|ecore_spq_get_cid
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|opaque_fid
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|opaque_fid
expr_stmt|;
name|init_data
operator|.
name|comp_mode
operator|=
name|comp_mode
expr_stmt|;
name|init_data
operator|.
name|p_comp_data
operator|=
name|p_comp_data
expr_stmt|;
name|rc
operator|=
name|ecore_sp_init_request
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_ent
argument_list|,
name|COMMON_RAMROD_PF_UPDATE
argument_list|,
name|PROTOCOLID_COMMON
argument_list|,
operator|&
name|init_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
name|ecore_tunn_set_pf_update_params
argument_list|(
name|p_hwfn
argument_list|,
name|p_tunn
argument_list|,
operator|&
name|p_ent
operator|->
name|ramrod
operator|.
name|pf_update
operator|.
name|tunnel_config
argument_list|)
expr_stmt|;
name|rc
operator|=
name|ecore_spq_post
argument_list|(
name|p_hwfn
argument_list|,
name|p_ent
argument_list|,
name|OSAL_NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
name|ecore_set_hw_tunn_mode_port
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_hwfn
operator|->
name|p_dev
operator|->
name|tunnel
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
end_function

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_pf_stop
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|)
block|{
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|struct
name|ecore_sp_init_data
name|init_data
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
init|=
name|ECORE_NOTIMPL
decl_stmt|;
comment|/* Get SPQ entry */
name|OSAL_MEMSET
argument_list|(
operator|&
name|init_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|init_data
argument_list|)
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|cid
operator|=
name|ecore_spq_get_cid
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|opaque_fid
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|opaque_fid
expr_stmt|;
name|init_data
operator|.
name|comp_mode
operator|=
name|ECORE_SPQ_MODE_EBLOCK
expr_stmt|;
name|rc
operator|=
name|ecore_sp_init_request
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_ent
argument_list|,
name|COMMON_RAMROD_PF_STOP
argument_list|,
name|PROTOCOLID_COMMON
argument_list|,
operator|&
name|init_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
return|return
name|ecore_spq_post
argument_list|(
name|p_hwfn
argument_list|,
name|p_ent
argument_list|,
name|OSAL_NULL
argument_list|)
return|;
block|}
end_function

begin_function
name|enum
name|_ecore_status_t
name|ecore_sp_heartbeat_ramrod
parameter_list|(
name|struct
name|ecore_hwfn
modifier|*
name|p_hwfn
parameter_list|)
block|{
name|struct
name|ecore_spq_entry
modifier|*
name|p_ent
init|=
name|OSAL_NULL
decl_stmt|;
name|struct
name|ecore_sp_init_data
name|init_data
decl_stmt|;
name|enum
name|_ecore_status_t
name|rc
decl_stmt|;
comment|/* Get SPQ entry */
name|OSAL_MEMSET
argument_list|(
operator|&
name|init_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|init_data
argument_list|)
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|cid
operator|=
name|ecore_spq_get_cid
argument_list|(
name|p_hwfn
argument_list|)
expr_stmt|;
name|init_data
operator|.
name|opaque_fid
operator|=
name|p_hwfn
operator|->
name|hw_info
operator|.
name|opaque_fid
expr_stmt|;
name|init_data
operator|.
name|comp_mode
operator|=
name|ECORE_SPQ_MODE_EBLOCK
expr_stmt|;
name|rc
operator|=
name|ecore_sp_init_request
argument_list|(
name|p_hwfn
argument_list|,
operator|&
name|p_ent
argument_list|,
name|COMMON_RAMROD_EMPTY
argument_list|,
name|PROTOCOLID_COMMON
argument_list|,
operator|&
name|init_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|!=
name|ECORE_SUCCESS
condition|)
return|return
name|rc
return|;
return|return
name|ecore_spq_post
argument_list|(
name|p_hwfn
argument_list|,
name|p_ent
argument_list|,
name|OSAL_NULL
argument_list|)
return|;
block|}
end_function

end_unit

