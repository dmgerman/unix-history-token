begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.  * Copyright (c) 2005 Sun Microsystems, Inc. All rights reserved.  * Copyright (c) 2005, 2006, 2007 Cisco Systems.  All rights reserved.  * Copyright (c) 2005, 2006, 2007, 2008, 2014 Mellanox Technologies. All rights reserved.  * Copyright (c) 2004 Voltaire, Inc. All rights reserved.  *  * This software is available to you under a choice of one of two  * licenses.  You may choose to be licensed under the terms of the GNU  * General Public License (GPL) Version 2, available from the file  * COPYING in the main directory of this source tree, or the  * OpenIB.org BSD license below:  *  *     Redistribution and use in source and binary forms, with or  *     without modification, are permitted provided that the following  *     conditions are met:  *  *      - Redistributions of source code must retain the above  *        copyright notice, this list of conditions and the following  *        disclaimer.  *  *      - Redistributions in binary form must reproduce the above  *        copyright notice, this list of conditions and the following  *        disclaimer in the documentation and/or other materials  *        provided with the distribution.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN  * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  * SOFTWARE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|MLX4_H
end_ifndef

begin_define
define|#
directive|define
name|MLX4_H
end_define

begin_include
include|#
directive|include
file|<linux/mutex.h>
end_include

begin_include
include|#
directive|include
file|<linux/radix-tree.h>
end_include

begin_include
include|#
directive|include
file|<linux/rbtree.h>
end_include

begin_include
include|#
directive|include
file|<linux/timer.h>
end_include

begin_include
include|#
directive|include
file|<linux/semaphore.h>
end_include

begin_include
include|#
directive|include
file|<linux/workqueue.h>
end_include

begin_include
include|#
directive|include
file|<linux/device.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx4/device.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx4/driver.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx4/doorbell.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx4/cmd.h>
end_include

begin_define
define|#
directive|define
name|DRV_NAME
value|"mlx4_core"
end_define

begin_define
define|#
directive|define
name|PFX
value|DRV_NAME ": "
end_define

begin_define
define|#
directive|define
name|DRV_VERSION
value|"2.1.6"
end_define

begin_define
define|#
directive|define
name|DRV_RELDATE
value|"Sep 30 2016"
end_define

begin_define
define|#
directive|define
name|DRV_STACK_NAME
value|"Linux-MLNX_OFED"
end_define

begin_define
define|#
directive|define
name|DRV_STACK_VERSION
value|"2.1"
end_define

begin_define
define|#
directive|define
name|DRV_NAME_FOR_FW
value|DRV_STACK_NAME","DRV_STACK_VERSION
end_define

begin_define
define|#
directive|define
name|MLX4_FS_UDP_UC_EN
value|(1<< 1)
end_define

begin_define
define|#
directive|define
name|MLX4_FS_TCP_UC_EN
value|(1<< 2)
end_define

begin_define
define|#
directive|define
name|MLX4_FS_NUM_OF_L2_ADDR
value|8
end_define

begin_define
define|#
directive|define
name|MLX4_FS_MGM_LOG_ENTRY_SIZE
value|7
end_define

begin_define
define|#
directive|define
name|MLX4_FS_NUM_MCG
value|(1<< 17)
end_define

begin_struct
struct|struct
name|mlx4_set_port_prio2tc_context
block|{
name|u8
name|prio2tc
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_port_scheduler_tc_cfg_be
block|{
name|__be16
name|pg
decl_stmt|;
name|__be16
name|bw_precentage
decl_stmt|;
name|__be16
name|max_bw_units
decl_stmt|;
comment|/* 3-100Mbps, 4-1Gbps, other values - reserved */
name|__be16
name|max_bw_value
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_set_port_scheduler_context
block|{
name|struct
name|mlx4_port_scheduler_tc_cfg_be
name|tc
index|[
name|MLX4_NUM_TC
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX4_HCR_BASE
init|=
literal|0x80680
block|,
name|MLX4_HCR_SIZE
init|=
literal|0x0001c
block|,
name|MLX4_CLR_INT_SIZE
init|=
literal|0x00008
block|,
name|MLX4_SLAVE_COMM_BASE
init|=
literal|0x0
block|,
name|MLX4_COMM_PAGESIZE
init|=
literal|0x1000
block|,
name|MLX4_CLOCK_SIZE
init|=
literal|0x00008
block|}
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX4_DEFAULT_MGM_LOG_ENTRY_SIZE
init|=
literal|10
block|,
name|MLX4_MIN_MGM_LOG_ENTRY_SIZE
init|=
literal|7
block|,
name|MLX4_MAX_MGM_LOG_ENTRY_SIZE
init|=
literal|12
block|,
name|MLX4_MAX_QP_PER_MGM
init|=
literal|4
operator|*
operator|(
operator|(
literal|1
operator|<<
name|MLX4_MAX_MGM_LOG_ENTRY_SIZE
operator|)
operator|/
literal|16
operator|-
literal|2
operator|)
block|, }
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX4_NUM_PDS
init|=
literal|1
operator|<<
literal|15
block|}
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX4_CMPT_TYPE_QP
init|=
literal|0
block|,
name|MLX4_CMPT_TYPE_SRQ
init|=
literal|1
block|,
name|MLX4_CMPT_TYPE_CQ
init|=
literal|2
block|,
name|MLX4_CMPT_TYPE_EQ
init|=
literal|3
block|,
name|MLX4_CMPT_NUM_TYPE
block|}
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX4_CMPT_SHIFT
init|=
literal|24
block|,
name|MLX4_NUM_CMPTS
init|=
name|MLX4_CMPT_NUM_TYPE
operator|<<
name|MLX4_CMPT_SHIFT
block|}
enum|;
end_enum

begin_enum
enum|enum
name|mlx4_mpt_state
block|{
name|MLX4_MPT_DISABLED
init|=
literal|0
block|,
name|MLX4_MPT_EN_HW
block|,
name|MLX4_MPT_EN_SW
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|MLX4_COMM_TIME
value|10000
end_define

begin_enum
enum|enum
block|{
name|MLX4_COMM_CMD_RESET
block|,
name|MLX4_COMM_CMD_VHCR0
block|,
name|MLX4_COMM_CMD_VHCR1
block|,
name|MLX4_COMM_CMD_VHCR2
block|,
name|MLX4_COMM_CMD_VHCR_EN
block|,
name|MLX4_COMM_CMD_VHCR_POST
block|,
name|MLX4_COMM_CMD_FLR
init|=
literal|254
block|}
enum|;
end_enum

begin_comment
comment|/*The flag indicates that the slave should delay the RESET cmd*/
end_comment

begin_define
define|#
directive|define
name|MLX4_DELAY_RESET_SLAVE
value|0xbbbbbbb
end_define

begin_comment
comment|/*indicates how many retries will be done if we are in the middle of FLR*/
end_comment

begin_define
define|#
directive|define
name|NUM_OF_RESET_RETRIES
value|10
end_define

begin_define
define|#
directive|define
name|SLEEP_TIME_IN_RESET
value|(2 * 1000)
end_define

begin_enum
enum|enum
name|mlx4_resource
block|{
name|RES_QP
block|,
name|RES_CQ
block|,
name|RES_SRQ
block|,
name|RES_XRCD
block|,
name|RES_MPT
block|,
name|RES_MTT
block|,
name|RES_MAC
block|,
name|RES_VLAN
block|,
name|RES_NPORT_ID
block|,
name|RES_COUNTER
block|,
name|RES_FS_RULE
block|,
name|RES_EQ
block|,
name|MLX4_NUM_OF_RESOURCE_TYPE
block|}
enum|;
end_enum

begin_enum
enum|enum
name|mlx4_alloc_mode
block|{
name|RES_OP_RESERVE
block|,
name|RES_OP_RESERVE_AND_MAP
block|,
name|RES_OP_MAP_ICM
block|, }
enum|;
end_enum

begin_enum
enum|enum
name|mlx4_res_tracker_free_type
block|{
name|RES_TR_FREE_ALL
block|,
name|RES_TR_FREE_SLAVES_ONLY
block|,
name|RES_TR_FREE_STRUCTS_ONLY
block|, }
enum|;
end_enum

begin_comment
comment|/*  *Virtual HCR structures.  * mlx4_vhcr is the sw representation, in machine endianness  *  * mlx4_vhcr_cmd is the formalized structure, the one that is passed  * to FW to go through communication channel.  * It is big endian, and has the same structure as the physical HCR  * used by command interface  */
end_comment

begin_struct
struct|struct
name|mlx4_vhcr
block|{
name|u64
name|in_param
decl_stmt|;
name|u64
name|out_param
decl_stmt|;
name|u32
name|in_modifier
decl_stmt|;
name|u32
name|errno
decl_stmt|;
name|u16
name|op
decl_stmt|;
name|u16
name|token
decl_stmt|;
name|u8
name|op_modifier
decl_stmt|;
name|u8
name|e_bit
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_vhcr_cmd
block|{
name|__be64
name|in_param
decl_stmt|;
name|__be32
name|in_modifier
decl_stmt|;
name|u32
name|reserved1
decl_stmt|;
name|__be64
name|out_param
decl_stmt|;
name|__be16
name|token
decl_stmt|;
name|u16
name|reserved
decl_stmt|;
name|u8
name|status
decl_stmt|;
name|u8
name|flags
decl_stmt|;
name|__be16
name|opcode
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_cmd_info
block|{
name|u16
name|opcode
decl_stmt|;
name|bool
name|has_inbox
decl_stmt|;
name|bool
name|has_outbox
decl_stmt|;
name|bool
name|out_is_imm
decl_stmt|;
name|bool
name|encode_slave_id
decl_stmt|;
name|bool
name|skip_err_print
decl_stmt|;
name|int
function_decl|(
modifier|*
name|verify
function_decl|)
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|)
function_decl|;
name|int
function_decl|(
modifier|*
name|wrapper
function_decl|)
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX4_DEBUG_MASK_CMD_TIME
init|=
literal|0x100
block|, }
enum|;
end_enum

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_MLX4_DEBUG
end_ifdef

begin_decl_stmt
specifier|extern
name|int
name|mlx4_debug_level
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* CONFIG_MLX4_DEBUG */
end_comment

begin_define
define|#
directive|define
name|mlx4_debug_level
value|(0)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_MLX4_DEBUG */
end_comment

begin_define
define|#
directive|define
name|mlx4_dbg
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|do {									\ 	if (mlx4_debug_level)						\ 		dev_printk(KERN_DEBUG,&mdev->pdev->dev, format, ##arg); \ } while (0)
end_define

begin_define
define|#
directive|define
name|mlx4_err
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|dev_err(&mdev->pdev->dev, format, ##arg)
end_define

begin_define
define|#
directive|define
name|mlx4_info
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|dev_info(&mdev->pdev->dev, format, ##arg)
end_define

begin_define
define|#
directive|define
name|mlx4_warn
parameter_list|(
name|mdev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|dev_warn(&mdev->pdev->dev, format, ##arg)
end_define

begin_decl_stmt
specifier|extern
name|int
name|mlx4_log_num_mgm_entry_size
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|log_mtts_per_seg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|mlx4_blck_lb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|mlx4_set_4k_mtu
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MLX4_MAX_NUM_SLAVES
value|(MLX4_MAX_NUM_PF + MLX4_MAX_NUM_VF)
end_define

begin_define
define|#
directive|define
name|ALL_SLAVES
value|0xff
end_define

begin_struct
struct|struct
name|mlx4_bitmap
block|{
name|u32
name|last
decl_stmt|;
name|u32
name|top
decl_stmt|;
name|u32
name|max
decl_stmt|;
name|u32
name|reserved_top
decl_stmt|;
name|u32
name|mask
decl_stmt|;
name|u32
name|avail
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|unsigned
name|long
modifier|*
name|table
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_buddy
block|{
name|unsigned
name|long
modifier|*
modifier|*
name|bits
decl_stmt|;
name|unsigned
name|int
modifier|*
name|num_free
decl_stmt|;
name|u32
name|max_order
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
block|}
struct|;
end_struct

begin_struct_decl
struct_decl|struct
name|mlx4_icm
struct_decl|;
end_struct_decl

begin_struct
struct|struct
name|mlx4_icm_table
block|{
name|u64
name|virt
decl_stmt|;
name|int
name|num_icm
decl_stmt|;
name|u32
name|num_obj
decl_stmt|;
name|int
name|obj_size
decl_stmt|;
name|int
name|lowmem
decl_stmt|;
name|int
name|coherent
decl_stmt|;
name|struct
name|mutex
name|mutex
decl_stmt|;
name|struct
name|mlx4_icm
modifier|*
modifier|*
name|icm
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_MPT_FLAG_SW_OWNS
value|(0xfUL<< 28)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_FLAG_FREE
value|(0x3UL<< 28)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_FLAG_MIO
value|(1<< 17)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_FLAG_BIND_ENABLE
value|(1<< 15)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_FLAG_PHYSICAL
value|(1<<  9)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_FLAG_REGION
value|(1<<  8)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_PD_FLAG_FAST_REG
value|(1<< 27)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_PD_FLAG_RAE
value|(1<< 28)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_PD_FLAG_EN_INV
value|(3<< 24)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_QP_FLAG_BOUND_QP
value|(1<< 7)
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_STATUS_SW
value|0xF0
end_define

begin_define
define|#
directive|define
name|MLX4_MPT_STATUS_HW
value|0x00
end_define

begin_comment
comment|/*  * Must be packed because mtt_seg is 64 bits but only aligned to 32 bits.  */
end_comment

begin_struct
struct|struct
name|mlx4_mpt_entry
block|{
name|__be32
name|flags
decl_stmt|;
name|__be32
name|qpn
decl_stmt|;
name|__be32
name|key
decl_stmt|;
name|__be32
name|pd_flags
decl_stmt|;
name|__be64
name|start
decl_stmt|;
name|__be64
name|length
decl_stmt|;
name|__be32
name|lkey
decl_stmt|;
name|__be32
name|win_cnt
decl_stmt|;
name|u8
name|reserved1
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|mtt_rep
decl_stmt|;
name|__be64
name|mtt_addr
decl_stmt|;
name|__be32
name|mtt_sz
decl_stmt|;
name|__be32
name|entity_size
decl_stmt|;
name|__be32
name|first_byte_offset
decl_stmt|;
block|}
name|__packed
struct|;
end_struct

begin_comment
comment|/*  * Must be packed because start is 64 bits but only aligned to 32 bits.  */
end_comment

begin_struct
struct|struct
name|mlx4_eq_context
block|{
name|__be32
name|flags
decl_stmt|;
name|u16
name|reserved1
index|[
literal|3
index|]
decl_stmt|;
name|__be16
name|page_offset
decl_stmt|;
name|u8
name|log_eq_size
decl_stmt|;
name|u8
name|reserved2
index|[
literal|4
index|]
decl_stmt|;
name|u8
name|eq_period
decl_stmt|;
name|u8
name|reserved3
decl_stmt|;
name|u8
name|eq_max_count
decl_stmt|;
name|u8
name|reserved4
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|intr
decl_stmt|;
name|u8
name|log_page_size
decl_stmt|;
name|u8
name|reserved5
index|[
literal|2
index|]
decl_stmt|;
name|u8
name|mtt_base_addr_h
decl_stmt|;
name|__be32
name|mtt_base_addr_l
decl_stmt|;
name|u32
name|reserved6
index|[
literal|2
index|]
decl_stmt|;
name|__be32
name|consumer_index
decl_stmt|;
name|__be32
name|producer_index
decl_stmt|;
name|u32
name|reserved7
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_cq_context
block|{
name|__be32
name|flags
decl_stmt|;
name|u16
name|reserved1
index|[
literal|3
index|]
decl_stmt|;
name|__be16
name|page_offset
decl_stmt|;
name|__be32
name|logsize_usrpage
decl_stmt|;
name|__be16
name|cq_period
decl_stmt|;
name|__be16
name|cq_max_count
decl_stmt|;
name|u8
name|reserved2
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|comp_eqn
decl_stmt|;
name|u8
name|log_page_size
decl_stmt|;
name|u8
name|reserved3
index|[
literal|2
index|]
decl_stmt|;
name|u8
name|mtt_base_addr_h
decl_stmt|;
name|__be32
name|mtt_base_addr_l
decl_stmt|;
name|__be32
name|last_notified_index
decl_stmt|;
name|__be32
name|solicit_producer_index
decl_stmt|;
name|__be32
name|consumer_index
decl_stmt|;
name|__be32
name|producer_index
decl_stmt|;
name|u32
name|reserved4
index|[
literal|2
index|]
decl_stmt|;
name|__be64
name|db_rec_addr
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_srq_context
block|{
name|__be32
name|state_logsize_srqn
decl_stmt|;
name|u8
name|logstride
decl_stmt|;
name|u8
name|reserved1
decl_stmt|;
name|__be16
name|xrcd
decl_stmt|;
name|__be32
name|pg_offset_cqn
decl_stmt|;
name|u32
name|reserved2
decl_stmt|;
name|u8
name|log_page_size
decl_stmt|;
name|u8
name|reserved3
index|[
literal|2
index|]
decl_stmt|;
name|u8
name|mtt_base_addr_h
decl_stmt|;
name|__be32
name|mtt_base_addr_l
decl_stmt|;
name|__be32
name|pd
decl_stmt|;
name|__be16
name|limit_watermark
decl_stmt|;
name|__be16
name|wqe_cnt
decl_stmt|;
name|u16
name|reserved4
decl_stmt|;
name|__be16
name|wqe_counter
decl_stmt|;
name|u32
name|reserved5
decl_stmt|;
name|__be64
name|db_rec_addr
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_eq
block|{
name|struct
name|mlx4_dev
modifier|*
name|dev
decl_stmt|;
name|void
name|__iomem
modifier|*
name|doorbell
decl_stmt|;
name|int
name|eqn
decl_stmt|;
name|u32
name|cons_index
decl_stmt|;
name|u16
name|irq
decl_stmt|;
name|u16
name|have_irq
decl_stmt|;
name|int
name|nent
decl_stmt|;
name|struct
name|mlx4_buf_list
modifier|*
name|page_list
decl_stmt|;
name|struct
name|mlx4_mtt
name|mtt
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_slave_eqe
block|{
name|u8
name|type
decl_stmt|;
name|u8
name|port
decl_stmt|;
name|u32
name|param
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_slave_event_eq_info
block|{
name|int
name|eqn
decl_stmt|;
name|u16
name|token
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_profile
block|{
name|int
name|num_qp
decl_stmt|;
name|int
name|rdmarc_per_qp
decl_stmt|;
name|int
name|num_srq
decl_stmt|;
name|int
name|num_cq
decl_stmt|;
name|int
name|num_mcg
decl_stmt|;
name|int
name|num_mpt
decl_stmt|;
name|unsigned
name|num_mtt_segs
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_fw
block|{
name|u64
name|clr_int_base
decl_stmt|;
name|u64
name|catas_offset
decl_stmt|;
name|u64
name|comm_base
decl_stmt|;
name|u64
name|clock_offset
decl_stmt|;
name|struct
name|mlx4_icm
modifier|*
name|fw_icm
decl_stmt|;
name|struct
name|mlx4_icm
modifier|*
name|aux_icm
decl_stmt|;
name|u32
name|catas_size
decl_stmt|;
name|u16
name|fw_pages
decl_stmt|;
name|u8
name|clr_int_bar
decl_stmt|;
name|u8
name|catas_bar
decl_stmt|;
name|u8
name|comm_bar
decl_stmt|;
name|u8
name|clock_bar
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_comm
block|{
name|u32
name|slave_write
decl_stmt|;
name|u32
name|slave_read
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX4_MCAST_CONFIG
init|=
literal|0
block|,
name|MLX4_MCAST_DISABLE
init|=
literal|1
block|,
name|MLX4_MCAST_ENABLE
init|=
literal|2
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|VLAN_FLTR_SIZE
value|128
end_define

begin_struct
struct|struct
name|mlx4_vlan_fltr
block|{
name|__be32
name|entry
index|[
name|VLAN_FLTR_SIZE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_mcast_entry
block|{
name|struct
name|list_head
name|list
decl_stmt|;
name|u64
name|addr
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_promisc_qp
block|{
name|struct
name|list_head
name|list
decl_stmt|;
name|u32
name|qpn
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_steer_index
block|{
name|struct
name|list_head
name|list
decl_stmt|;
name|unsigned
name|int
name|index
decl_stmt|;
name|struct
name|list_head
name|duplicates
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_EVENT_TYPES_NUM
value|64
end_define

begin_struct
struct|struct
name|mlx4_slave_state
block|{
name|u8
name|comm_toggle
decl_stmt|;
name|u8
name|last_cmd
decl_stmt|;
name|u8
name|init_port_mask
decl_stmt|;
name|bool
name|active
decl_stmt|;
name|bool
name|old_vlan_api
decl_stmt|;
name|u8
name|function
decl_stmt|;
name|dma_addr_t
name|vhcr_dma
decl_stmt|;
name|u16
name|mtu
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|__be32
name|ib_cap_mask
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|struct
name|mlx4_slave_eqe
name|eq
index|[
name|MLX4_MFUNC_MAX_EQES
index|]
decl_stmt|;
name|struct
name|list_head
name|mcast_filters
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|struct
name|mlx4_vlan_fltr
modifier|*
name|vlan_filter
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
comment|/* event type to eq number lookup */
name|struct
name|mlx4_slave_event_eq_info
name|event_eq
index|[
name|MLX4_EVENT_TYPES_NUM
index|]
decl_stmt|;
name|u16
name|eq_pi
decl_stmt|;
name|u16
name|eq_ci
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
comment|/*initialized via the kzalloc*/
name|u8
name|is_slave_going_down
decl_stmt|;
name|u32
name|cookie
decl_stmt|;
name|enum
name|slave_port_state
name|port_state
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_VGT
value|4095
end_define

begin_define
define|#
directive|define
name|NO_INDX
value|(-1)
end_define

begin_struct
struct|struct
name|mlx4_vport_state
block|{
name|u64
name|mac
decl_stmt|;
name|u16
name|default_vlan
decl_stmt|;
name|u8
name|default_qos
decl_stmt|;
name|u32
name|tx_rate
decl_stmt|;
name|bool
name|spoofchk
decl_stmt|;
name|u32
name|link_state
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_vf_admin_state
block|{
name|struct
name|mlx4_vport_state
name|vport
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_vport_oper_state
block|{
name|struct
name|mlx4_vport_state
name|state
decl_stmt|;
name|int
name|mac_idx
decl_stmt|;
name|int
name|vlan_idx
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_vf_oper_state
block|{
name|struct
name|mlx4_vport_oper_state
name|vport
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|slave_list
block|{
name|struct
name|mutex
name|mutex
decl_stmt|;
name|struct
name|list_head
name|res_list
index|[
name|MLX4_NUM_OF_RESOURCE_TYPE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|resource_allocator
block|{
name|spinlock_t
name|alloc_lock
decl_stmt|;
union|union
block|{
name|int
name|res_reserved
decl_stmt|;
name|int
name|res_port_rsvd
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
block|}
union|;
union|union
block|{
name|int
name|res_free
decl_stmt|;
name|int
name|res_port_free
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
block|}
union|;
name|int
modifier|*
name|quota
decl_stmt|;
name|int
modifier|*
name|allocated
decl_stmt|;
name|int
modifier|*
name|guaranteed
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_resource_tracker
block|{
name|spinlock_t
name|lock
decl_stmt|;
comment|/* tree for each resources */
name|struct
name|rb_root
name|res_tree
index|[
name|MLX4_NUM_OF_RESOURCE_TYPE
index|]
decl_stmt|;
comment|/* num_of_slave's lists, one per slave */
name|struct
name|slave_list
modifier|*
name|slave_list
decl_stmt|;
name|struct
name|resource_allocator
name|res_alloc
index|[
name|MLX4_NUM_OF_RESOURCE_TYPE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SLAVE_EVENT_EQ_SIZE
value|128
end_define

begin_struct
struct|struct
name|mlx4_slave_event_eq
block|{
name|u32
name|eqn
decl_stmt|;
name|u32
name|cons
decl_stmt|;
name|u32
name|prod
decl_stmt|;
name|spinlock_t
name|event_lock
decl_stmt|;
name|struct
name|mlx4_eqe
name|event_eqe
index|[
name|SLAVE_EVENT_EQ_SIZE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_master_qp0_state
block|{
name|int
name|proxy_qp0_active
decl_stmt|;
name|int
name|qp0_active
decl_stmt|;
name|int
name|port_active
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_mfunc_master_ctx
block|{
name|struct
name|mlx4_slave_state
modifier|*
name|slave_state
decl_stmt|;
name|struct
name|mlx4_vf_admin_state
modifier|*
name|vf_admin
decl_stmt|;
name|struct
name|mlx4_vf_oper_state
modifier|*
name|vf_oper
decl_stmt|;
name|struct
name|mlx4_master_qp0_state
name|qp0_state
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|int
name|init_port_ref
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|u16
name|max_mtu
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|int
name|disable_mcast_ref
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|struct
name|mlx4_resource_tracker
name|res_tracker
decl_stmt|;
name|struct
name|workqueue_struct
modifier|*
name|comm_wq
decl_stmt|;
name|struct
name|work_struct
name|comm_work
decl_stmt|;
name|struct
name|work_struct
name|arm_comm_work
decl_stmt|;
name|struct
name|work_struct
name|slave_event_work
decl_stmt|;
name|struct
name|work_struct
name|slave_flr_event_work
decl_stmt|;
name|spinlock_t
name|slave_state_lock
decl_stmt|;
name|__be32
name|comm_arm_bit_vector
index|[
literal|4
index|]
decl_stmt|;
name|struct
name|mlx4_eqe
name|cmd_eqe
decl_stmt|;
name|struct
name|mlx4_slave_event_eq
name|slave_eq
decl_stmt|;
name|struct
name|mutex
name|gen_eqe_mutex
index|[
name|MLX4_MFUNC_MAX
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_mfunc
block|{
name|struct
name|mlx4_comm
name|__iomem
modifier|*
name|comm
decl_stmt|;
name|struct
name|mlx4_vhcr_cmd
modifier|*
name|vhcr
decl_stmt|;
name|dma_addr_t
name|vhcr_dma
decl_stmt|;
name|struct
name|mlx4_mfunc_master_ctx
name|master
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MGM_QPN_MASK
value|0x00FFFFFF
end_define

begin_define
define|#
directive|define
name|MGM_BLCK_LB_BIT
value|30
end_define

begin_struct
struct|struct
name|mlx4_mgm
block|{
name|__be32
name|next_gid_index
decl_stmt|;
name|__be32
name|members_count
decl_stmt|;
name|u32
name|reserved
index|[
literal|2
index|]
decl_stmt|;
name|u8
name|gid
index|[
literal|16
index|]
decl_stmt|;
name|__be32
name|qp
index|[
name|MLX4_MAX_QP_PER_MGM
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_cmd
block|{
name|struct
name|pci_pool
modifier|*
name|pool
decl_stmt|;
name|void
name|__iomem
modifier|*
name|hcr
decl_stmt|;
name|struct
name|mutex
name|hcr_mutex
decl_stmt|;
name|struct
name|mutex
name|slave_cmd_mutex
decl_stmt|;
name|struct
name|semaphore
name|poll_sem
decl_stmt|;
name|struct
name|semaphore
name|event_sem
decl_stmt|;
name|int
name|max_cmds
decl_stmt|;
name|spinlock_t
name|context_lock
decl_stmt|;
name|int
name|free_head
decl_stmt|;
name|struct
name|mlx4_cmd_context
modifier|*
name|context
decl_stmt|;
name|u16
name|token_mask
decl_stmt|;
name|u8
name|use_events
decl_stmt|;
name|u8
name|toggle
decl_stmt|;
name|u8
name|comm_toggle
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX4_VF_IMMED_VLAN_FLAG_VLAN
init|=
literal|1
operator|<<
literal|0
block|,
name|MLX4_VF_IMMED_VLAN_FLAG_QOS
init|=
literal|1
operator|<<
literal|1
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx4_vf_immed_vlan_work
block|{
name|struct
name|work_struct
name|work
decl_stmt|;
name|struct
name|mlx4_priv
modifier|*
name|priv
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|int
name|slave
decl_stmt|;
name|int
name|vlan_ix
decl_stmt|;
name|int
name|orig_vlan_ix
decl_stmt|;
name|u8
name|port
decl_stmt|;
name|u8
name|qos
decl_stmt|;
name|u16
name|vlan_id
decl_stmt|;
name|u16
name|orig_vlan_id
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_uar_table
block|{
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_mr_table
block|{
name|struct
name|mlx4_bitmap
name|mpt_bitmap
decl_stmt|;
name|struct
name|mlx4_buddy
name|mtt_buddy
decl_stmt|;
name|u64
name|mtt_base
decl_stmt|;
name|u64
name|mpt_base
decl_stmt|;
name|struct
name|mlx4_icm_table
name|mtt_table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|dmpt_table
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_cq_table
block|{
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|rwlock_t
name|cq_table_lock
decl_stmt|;
name|struct
name|radix_tree_root
name|tree
decl_stmt|;
name|struct
name|mlx4_icm_table
name|table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|cmpt_table
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_eq_table
block|{
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
name|char
modifier|*
name|irq_names
decl_stmt|;
name|void
name|__iomem
modifier|*
name|clr_int
decl_stmt|;
name|void
name|__iomem
modifier|*
modifier|*
name|uar_map
decl_stmt|;
name|u32
name|clr_mask
decl_stmt|;
name|struct
name|mlx4_eq
modifier|*
name|eq
decl_stmt|;
name|struct
name|mlx4_icm_table
name|table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|cmpt_table
decl_stmt|;
name|int
name|have_irq
decl_stmt|;
name|u8
name|inta_pin
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_srq_table
block|{
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|struct
name|radix_tree_root
name|tree
decl_stmt|;
name|struct
name|mlx4_icm_table
name|table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|cmpt_table
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_qp_table
block|{
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
name|u32
name|rdmarc_base
decl_stmt|;
name|int
name|rdmarc_shift
decl_stmt|;
name|spinlock_t
name|lock
decl_stmt|;
name|struct
name|mlx4_icm_table
name|qp_table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|auxc_table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|altc_table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|rdmarc_table
decl_stmt|;
name|struct
name|mlx4_icm_table
name|cmpt_table
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_mcg_table
block|{
name|struct
name|mutex
name|mutex
decl_stmt|;
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
name|struct
name|mlx4_icm_table
name|table
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_catas_err
block|{
name|u32
name|__iomem
modifier|*
name|map
decl_stmt|;
name|struct
name|timer_list
name|timer
decl_stmt|;
name|struct
name|list_head
name|list
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_MAX_MAC_NUM
value|128
end_define

begin_define
define|#
directive|define
name|MLX4_MAC_TABLE_SIZE
value|(MLX4_MAX_MAC_NUM<< 3)
end_define

begin_struct
struct|struct
name|mlx4_mac_table
block|{
name|__be64
name|entries
index|[
name|MLX4_MAX_MAC_NUM
index|]
decl_stmt|;
name|int
name|refs
index|[
name|MLX4_MAX_MAC_NUM
index|]
decl_stmt|;
name|struct
name|mutex
name|mutex
decl_stmt|;
name|int
name|total
decl_stmt|;
name|int
name|max
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX4_MAX_VLAN_NUM
value|128
end_define

begin_define
define|#
directive|define
name|MLX4_VLAN_TABLE_SIZE
value|(MLX4_MAX_VLAN_NUM<< 2)
end_define

begin_struct
struct|struct
name|mlx4_vlan_table
block|{
name|__be32
name|entries
index|[
name|MLX4_MAX_VLAN_NUM
index|]
decl_stmt|;
name|int
name|refs
index|[
name|MLX4_MAX_VLAN_NUM
index|]
decl_stmt|;
name|struct
name|mutex
name|mutex
decl_stmt|;
name|int
name|total
decl_stmt|;
name|int
name|max
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SET_PORT_GEN_ALL_VALID
value|0x7
end_define

begin_define
define|#
directive|define
name|SET_PORT_PROMISC_SHIFT
value|31
end_define

begin_define
define|#
directive|define
name|SET_PORT_MC_PROMISC_SHIFT
value|30
end_define

begin_enum
enum|enum
block|{
name|MCAST_DIRECT_ONLY
init|=
literal|0
block|,
name|MCAST_DIRECT
init|=
literal|1
block|,
name|MCAST_DEFAULT
init|=
literal|2
block|}
enum|;
end_enum

begin_struct
struct|struct
name|mlx4_set_port_general_context
block|{
name|u8
name|reserved
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|flags
decl_stmt|;
name|u16
name|reserved2
decl_stmt|;
name|__be16
name|mtu
decl_stmt|;
name|u8
name|pptx
decl_stmt|;
name|u8
name|pfctx
decl_stmt|;
name|u16
name|reserved3
decl_stmt|;
name|u8
name|pprx
decl_stmt|;
name|u8
name|pfcrx
decl_stmt|;
name|u16
name|reserved4
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_set_port_rqp_calc_context
block|{
name|__be32
name|base_qpn
decl_stmt|;
name|u8
name|rererved
decl_stmt|;
name|u8
name|n_mac
decl_stmt|;
name|u8
name|n_vlan
decl_stmt|;
name|u8
name|n_prio
decl_stmt|;
name|u8
name|reserved2
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|mac_miss
decl_stmt|;
name|u8
name|intra_no_vlan
decl_stmt|;
name|u8
name|no_vlan
decl_stmt|;
name|u8
name|intra_vlan_miss
decl_stmt|;
name|u8
name|vlan_miss
decl_stmt|;
name|u8
name|reserved3
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|no_vlan_prio
decl_stmt|;
name|__be32
name|promisc
decl_stmt|;
name|__be32
name|mcast
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_hca_info
block|{
name|struct
name|mlx4_dev
modifier|*
name|dev
decl_stmt|;
name|struct
name|device_attribute
name|firmware_attr
decl_stmt|;
name|struct
name|device_attribute
name|hca_attr
decl_stmt|;
name|struct
name|device_attribute
name|board_attr
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_port_info
block|{
name|struct
name|mlx4_dev
modifier|*
name|dev
decl_stmt|;
name|int
name|port
decl_stmt|;
name|char
name|dev_name
index|[
literal|16
index|]
decl_stmt|;
name|struct
name|device_attribute
name|port_attr
decl_stmt|;
name|enum
name|mlx4_port_type
name|tmp_type
decl_stmt|;
name|char
name|dev_mtu_name
index|[
literal|16
index|]
decl_stmt|;
name|struct
name|device_attribute
name|port_mtu_attr
decl_stmt|;
name|struct
name|mlx4_mac_table
name|mac_table
decl_stmt|;
name|struct
name|mlx4_vlan_table
name|vlan_table
decl_stmt|;
name|int
name|base_qpn
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_sense
block|{
name|struct
name|mlx4_dev
modifier|*
name|dev
decl_stmt|;
name|u8
name|do_sense_port
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|u8
name|sense_allowed
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|struct
name|delayed_work
name|sense_poll
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_msix_ctl
block|{
name|u64
name|pool_bm
decl_stmt|;
name|struct
name|mutex
name|pool_lock
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_steer
block|{
name|struct
name|list_head
name|promisc_qps
index|[
name|MLX4_NUM_STEERS
index|]
decl_stmt|;
name|struct
name|list_head
name|steer_entries
index|[
name|MLX4_NUM_STEERS
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX4_PCI_DEV_IS_VF
init|=
literal|1
operator|<<
literal|0
block|,
name|MLX4_PCI_DEV_FORCE_SENSE_PORT
init|=
literal|1
operator|<<
literal|1
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx4_roce_gid_entry
block|{
name|u8
name|raw
index|[
literal|16
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|counter_index
block|{
name|struct
name|list_head
name|list
decl_stmt|;
name|u32
name|index
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx4_counters
block|{
name|struct
name|mlx4_bitmap
name|bitmap
decl_stmt|;
name|struct
name|list_head
name|global_port_list
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
name|struct
name|list_head
name|vf_list
index|[
name|MLX4_MAX_NUM_VF
index|]
index|[
name|MLX4_MAX_PORTS
index|]
decl_stmt|;
name|struct
name|mutex
name|mutex
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX4_NO_RR
init|=
literal|0
block|,
name|MLX4_USE_RR
init|=
literal|1
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx4_priv
block|{
name|struct
name|mlx4_dev
name|dev
decl_stmt|;
name|struct
name|list_head
name|dev_list
decl_stmt|;
name|struct
name|list_head
name|ctx_list
decl_stmt|;
name|spinlock_t
name|ctx_lock
decl_stmt|;
name|int
name|pci_dev_data
decl_stmt|;
name|struct
name|list_head
name|pgdir_list
decl_stmt|;
name|struct
name|mutex
name|pgdir_mutex
decl_stmt|;
name|struct
name|mlx4_fw
name|fw
decl_stmt|;
name|struct
name|mlx4_cmd
name|cmd
decl_stmt|;
name|struct
name|mlx4_mfunc
name|mfunc
decl_stmt|;
name|struct
name|mlx4_bitmap
name|pd_bitmap
decl_stmt|;
name|struct
name|mlx4_bitmap
name|xrcd_bitmap
decl_stmt|;
name|struct
name|mlx4_uar_table
name|uar_table
decl_stmt|;
name|struct
name|mlx4_mr_table
name|mr_table
decl_stmt|;
name|struct
name|mlx4_cq_table
name|cq_table
decl_stmt|;
name|struct
name|mlx4_eq_table
name|eq_table
decl_stmt|;
name|struct
name|mlx4_srq_table
name|srq_table
decl_stmt|;
name|struct
name|mlx4_qp_table
name|qp_table
decl_stmt|;
name|struct
name|mlx4_mcg_table
name|mcg_table
decl_stmt|;
name|struct
name|mlx4_counters
name|counters_table
decl_stmt|;
name|struct
name|mlx4_catas_err
name|catas_err
decl_stmt|;
name|void
name|__iomem
modifier|*
name|clr_base
decl_stmt|;
name|struct
name|mlx4_uar
name|driver_uar
decl_stmt|;
name|void
name|__iomem
modifier|*
name|kar
decl_stmt|;
name|struct
name|mlx4_port_info
name|port
index|[
name|MLX4_MAX_PORTS
operator|+
literal|1
index|]
decl_stmt|;
name|struct
name|mlx4_hca_info
name|hca_info
decl_stmt|;
name|struct
name|mlx4_sense
name|sense
decl_stmt|;
name|struct
name|mutex
name|port_mutex
decl_stmt|;
name|struct
name|mlx4_msix_ctl
name|msix_ctl
decl_stmt|;
name|struct
name|mlx4_steer
modifier|*
name|steer
decl_stmt|;
name|struct
name|list_head
name|bf_list
decl_stmt|;
name|struct
name|mutex
name|bf_mutex
decl_stmt|;
name|struct
name|io_mapping
modifier|*
name|bf_mapping
decl_stmt|;
name|void
name|__iomem
modifier|*
name|clock_mapping
decl_stmt|;
name|int
name|reserved_mtts
decl_stmt|;
name|int
name|fs_hash_mode
decl_stmt|;
name|u8
name|virt2phys_pkey
index|[
name|MLX4_MFUNC_MAX
index|]
index|[
name|MLX4_MAX_PORTS
index|]
index|[
name|MLX4_MAX_PORT_PKEYS
index|]
decl_stmt|;
name|__be64
name|slave_node_guids
index|[
name|MLX4_MFUNC_MAX
index|]
decl_stmt|;
name|struct
name|mlx4_roce_gid_entry
name|roce_gids
index|[
name|MLX4_MAX_PORTS
index|]
index|[
literal|128
index|]
decl_stmt|;
name|atomic_t
name|opreq_count
decl_stmt|;
name|struct
name|work_struct
name|opreq_task
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|struct
name|mlx4_priv
modifier|*
name|mlx4_priv
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|dev
argument_list|,
expr|struct
name|mlx4_priv
argument_list|,
name|dev
argument_list|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|MLX4_SENSE_RANGE
value|(HZ * 3)
end_define

begin_decl_stmt
specifier|extern
name|struct
name|workqueue_struct
modifier|*
name|mlx4_wq
decl_stmt|;
end_decl_stmt

begin_function_decl
name|u32
name|mlx4_bitmap_alloc
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_bitmap_free
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|,
name|u32
name|obj
parameter_list|,
name|int
name|use_rr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u32
name|mlx4_bitmap_alloc_range
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|,
name|int
name|cnt
parameter_list|,
name|int
name|align
parameter_list|,
name|u32
name|skip_mask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_bitmap_free_range
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|,
name|u32
name|obj
parameter_list|,
name|int
name|cnt
parameter_list|,
name|int
name|use_rr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u32
name|mlx4_bitmap_avail
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_bitmap_init
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|,
name|u32
name|num
parameter_list|,
name|u32
name|mask
parameter_list|,
name|u32
name|reserved_bot
parameter_list|,
name|u32
name|resetrved_top
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_bitmap_cleanup
parameter_list|(
name|struct
name|mlx4_bitmap
modifier|*
name|bitmap
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_reset
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_alloc_eq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_free_eq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_pd_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_xrcd_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_uar_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_mr_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_eq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_cq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_qp_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_srq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_mcg_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_pd_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_xrcd_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_uar_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_mr_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_eq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_cq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_qp_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_srq_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cleanup_mcg_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_qp_alloc_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|qpn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_qp_free_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|qpn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_cq_alloc_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
modifier|*
name|cqn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_cq_free_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|cqn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_srq_alloc_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
modifier|*
name|srqn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_srq_free_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|srqn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_mpt_reserve
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_mpt_release
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_mpt_alloc_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_mpt_free_icm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u32
name|__mlx4_alloc_mtt_range
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|order
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_free_mtt_range
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|first_seg
parameter_list|,
name|int
name|order
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_WRITE_MTT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SYNC_TPT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SW2HW_MPT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_HW2SW_MPT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_MPT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SW2HW_EQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_DMA_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_qp_reserve_range
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|cnt
parameter_list|,
name|int
name|align
parameter_list|,
name|int
modifier|*
name|base
parameter_list|,
name|u8
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_qp_release_range
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|base_qpn
parameter_list|,
name|int
name|cnt
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_register_mac
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u64
name|mac
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_unregister_mac
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u64
name|mac
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_write_mtt
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_mtt
modifier|*
name|mtt
parameter_list|,
name|int
name|start_index
parameter_list|,
name|int
name|npages
parameter_list|,
name|u64
modifier|*
name|page_list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_counter_alloc
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|int
name|port
parameter_list|,
name|u32
modifier|*
name|idx
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_counter_free
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|int
name|port
parameter_list|,
name|u32
name|idx
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_slave_counters_free
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_clear_if_stat
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|counter_index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u8
name|mlx4_get_default_counter_index
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|int
name|port
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_xrcd_alloc
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
modifier|*
name|xrcdn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_xrcd_free
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|xrcdn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_start_catas_poll
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_stop_catas_poll
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_catas_init
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_restart_one
parameter_list|(
name|struct
name|pci_dev
modifier|*
name|pdev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_register_device
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_unregister_device
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_dispatch_event
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|enum
name|mlx4_dev_event
name|type
parameter_list|,
name|unsigned
name|long
name|param
parameter_list|)
function_decl|;
end_function_decl

begin_struct_decl
struct_decl|struct
name|mlx4_dev_cap
struct_decl|;
end_struct_decl

begin_struct_decl
struct_decl|struct
name|mlx4_init_hca_param
struct_decl|;
end_struct_decl

begin_function_decl
name|u64
name|mlx4_make_profile
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_profile
modifier|*
name|request
parameter_list|,
name|struct
name|mlx4_dev_cap
modifier|*
name|dev_cap
parameter_list|,
name|struct
name|mlx4_init_hca_param
modifier|*
name|init_hca
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_master_comm_channel
parameter_list|(
name|struct
name|work_struct
modifier|*
name|work
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_master_arm_comm_channel
parameter_list|(
name|struct
name|work_struct
modifier|*
name|work
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_gen_slave_eqe
parameter_list|(
name|struct
name|work_struct
modifier|*
name|work
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_master_handle_slave_flr
parameter_list|(
name|struct
name|work_struct
modifier|*
name|work
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ALLOC_RES_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_FREE_RES_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_MAP_EQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_COMM_INT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_HW2SW_EQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_EQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SW2HW_CQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_HW2SW_CQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_CQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_MODIFY_CQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SW2HW_SRQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_HW2SW_SRQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_SRQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_ARM_SRQ_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_GEN_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_RST2INIT_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_INIT2INIT_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_INIT2RTR_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_RTR2RTS_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_RTS2RTS_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SQERR2RTS_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_2ERR_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_RTS2SQD_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SQD2SQD_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SQD2RTS_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_2RST_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_QP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_GEN_EQE
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_eqe
modifier|*
name|eqe
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_cmd_init
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cmd_cleanup
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_multi_func_init
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_multi_func_cleanup
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cmd_event
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u16
name|token
parameter_list|,
name|u8
name|status
parameter_list|,
name|u64
name|out_param
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_cmd_use_events
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cmd_use_polling
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_comm_cmd
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|cmd
parameter_list|,
name|u16
name|param
parameter_list|,
name|unsigned
name|long
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cq_completion
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|cqn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_cq_event
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|cqn
parameter_list|,
name|int
name|event_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_qp_event
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|qpn
parameter_list|,
name|int
name|event_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_srq_event
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u32
name|srqn
parameter_list|,
name|int
name|event_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_handle_catas_err
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SENSE_PORT
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|port
parameter_list|,
name|enum
name|mlx4_port_type
modifier|*
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_do_sense_ports
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|enum
name|mlx4_port_type
modifier|*
name|stype
parameter_list|,
name|enum
name|mlx4_port_type
modifier|*
name|defaults
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_start_sense
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_stop_sense
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_sense_init
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_check_port_params
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|enum
name|mlx4_port_type
modifier|*
name|port_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_change_port_types
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|enum
name|mlx4_port_type
modifier|*
name|port_types
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_init_mac_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_mac_table
modifier|*
name|table
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_init_vlan_table
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_vlan_table
modifier|*
name|table
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx4_unregister_vlan
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u16
name|vlan
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|__mlx4_register_vlan
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u16
name|vlan
parameter_list|,
name|int
modifier|*
name|index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SET_PORT
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|pkey_tbl_sz
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* resource tracker functions*/
end_comment

begin_function_decl
name|int
name|mlx4_get_slave_from_resource_id
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|enum
name|mlx4_resource
name|resource_type
parameter_list|,
name|u64
name|resource_id
parameter_list|,
name|int
modifier|*
name|slave
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_delete_all_resources_for_slave
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_init_resource_tracker
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_free_resource_tracker
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|enum
name|mlx4_res_tracker_free_type
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_FW_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SET_PORT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_INIT_PORT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_CLOSE_PORT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_DEV_CAP_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_PORT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_get_port_ib_caps
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|__be32
modifier|*
name|caps
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_get_slave_pkey_gid_tbl_len
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
modifier|*
name|gid_tbl_len
parameter_list|,
name|int
modifier|*
name|pkey_tbl_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QP_ATTACH_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_PROMISC_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_qp_detach_common
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_qp
modifier|*
name|qp
parameter_list|,
name|u8
name|gid
index|[
literal|16
index|]
parameter_list|,
name|enum
name|mlx4_protocol
name|prot
parameter_list|,
name|enum
name|mlx4_steer_type
name|steer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_qp_attach_common
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_qp
modifier|*
name|qp
parameter_list|,
name|u8
name|gid
index|[
literal|16
index|]
parameter_list|,
name|int
name|block_mcast_loopback
parameter_list|,
name|enum
name|mlx4_protocol
name|prot
parameter_list|,
name|enum
name|mlx4_steer_type
name|steer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_trans_to_dmfs_attach
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_qp
modifier|*
name|qp
parameter_list|,
name|u8
name|gid
index|[
literal|16
index|]
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|block_mcast_loopback
parameter_list|,
name|enum
name|mlx4_protocol
name|prot
parameter_list|,
name|u64
modifier|*
name|reg_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SET_MCAST_FLTR
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u64
name|mac
parameter_list|,
name|u64
name|clear
parameter_list|,
name|u8
name|mode
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SET_MCAST_FLTR_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_SET_VLAN_FLTR_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_common_set_vlan_fltr
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|function
parameter_list|,
name|int
name|port
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_DUMP_ETH_STATS_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_PKEY_TABLE_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QUERY_IF_STAT_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QP_FLOW_STEERING_ATTACH_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_QP_FLOW_STEERING_DETACH_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_MOD_STAT_CFG_wrapper
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|,
name|struct
name|mlx4_vhcr
modifier|*
name|vhcr
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|inbox
parameter_list|,
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|outbox
parameter_list|,
name|struct
name|mlx4_cmd_info
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_get_mgm_entry_size
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_get_qp_per_mgm
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
specifier|inline
name|void
name|set_param_l
parameter_list|(
name|u64
modifier|*
name|arg
parameter_list|,
name|u32
name|val
parameter_list|)
block|{
operator|*
name|arg
operator|=
operator|(
operator|*
name|arg
operator|&
literal|0xffffffff00000000ULL
operator|)
operator||
operator|(
name|u64
operator|)
name|val
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
name|set_param_h
parameter_list|(
name|u64
modifier|*
name|arg
parameter_list|,
name|u32
name|val
parameter_list|)
block|{
operator|*
name|arg
operator|=
operator|(
operator|*
name|arg
operator|&
literal|0xffffffff
operator|)
operator||
operator|(
operator|(
name|u64
operator|)
name|val
operator|<<
literal|32
operator|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|u32
name|get_param_l
parameter_list|(
name|u64
modifier|*
name|arg
parameter_list|)
block|{
return|return
call|(
name|u32
call|)
argument_list|(
operator|*
name|arg
operator|&
literal|0xffffffff
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|u32
name|get_param_h
parameter_list|(
name|u64
modifier|*
name|arg
parameter_list|)
block|{
return|return
call|(
name|u32
call|)
argument_list|(
operator|*
name|arg
operator|>>
literal|32
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|spinlock_t
modifier|*
name|mlx4_tlock
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
block|{
return|return
operator|&
name|mlx4_priv
argument_list|(
name|dev
argument_list|)
operator|->
name|mfunc
operator|.
name|master
operator|.
name|res_tracker
operator|.
name|lock
return|;
block|}
end_function

begin_define
define|#
directive|define
name|NOT_MASKED_PD_BITS
value|17
end_define

begin_function_decl
name|void
name|sys_tune_init
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|sys_tune_fini
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_init_quotas
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_get_slave_num_gids
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx4_get_base_gid_ix
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|int
name|slave
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx4_vf_immed_vlan_work_handler
parameter_list|(
name|struct
name|work_struct
modifier|*
name|_work
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* MLX4_H */
end_comment

end_unit

