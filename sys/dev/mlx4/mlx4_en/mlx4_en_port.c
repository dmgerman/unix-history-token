begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2007, 2014 Mellanox Technologies. All rights reserved.  *  * This software is available to you under a choice of one of two  * licenses.  You may choose to be licensed under the terms of the GNU  * General Public License (GPL) Version 2, available from the file  * COPYING in the main directory of this source tree, or the  * OpenIB.org BSD license below:  *  *     Redistribution and use in source and binary forms, with or  *     without modification, are permitted provided that the following  *     conditions are met:  *  *      - Redistributions of source code must retain the above  *        copyright notice, this list of conditions and the following  *        disclaimer.  *  *      - Redistributions in binary form must reproduce the above  *        copyright notice, this list of conditions and the following  *        disclaimer in the documentation and/or other materials  *        provided with the distribution.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN  * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  * SOFTWARE.  *  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<linux/if_vlan.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx4/device.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx4/cmd.h>
end_include

begin_include
include|#
directive|include
file|"en_port.h"
end_include

begin_include
include|#
directive|include
file|"en.h"
end_include

begin_define
define|#
directive|define
name|EN_IFQ_MIN_INTERVAL
value|3000
end_define

begin_function
name|int
name|mlx4_SET_VLAN_FLTR
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|mlx4_en_priv
modifier|*
name|priv
parameter_list|)
block|{
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|struct
name|mlx4_set_vlan_fltr_mbox
modifier|*
name|filter
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|int
name|index
init|=
literal|0
decl_stmt|;
name|u32
name|entry
decl_stmt|;
name|int
name|err
init|=
literal|0
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|filter
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|memset
argument_list|(
name|filter
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|filter
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|VLAN_FLTR_SIZE
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|entry
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|32
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|test_bit
argument_list|(
name|index
argument_list|,
name|priv
operator|->
name|active_vlans
argument_list|)
condition|)
name|entry
operator||=
literal|1
operator|<<
name|j
expr_stmt|;
name|index
operator|++
expr_stmt|;
block|}
name|filter
operator|->
name|entry
index|[
name|i
index|]
operator|=
name|cpu_to_be32
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|mlx4_cmd
argument_list|(
name|dev
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|priv
operator|->
name|port
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_SET_VLAN_FLTR
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_WRAPPED
argument_list|)
expr_stmt|;
name|mlx4_free_cmd_mailbox
argument_list|(
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|int
name|mlx4_en_QUERY_PORT
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|)
block|{
name|struct
name|mlx4_en_query_port_context
modifier|*
name|qport_context
decl_stmt|;
name|struct
name|mlx4_en_priv
modifier|*
name|priv
init|=
name|netdev_priv
argument_list|(
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
argument_list|)
decl_stmt|;
name|struct
name|mlx4_en_port_state
modifier|*
name|state
init|=
operator|&
name|priv
operator|->
name|port_state
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|int
name|err
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|memset
argument_list|(
name|mailbox
operator|->
name|buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|qport_context
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|port
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_QUERY_PORT
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_WRAPPED
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|qport_context
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
comment|/* This command is always accessed from Ethtool context 	 * already synchronized, no need in locking */
name|state
operator|->
name|link_state
operator|=
operator|!
operator|!
operator|(
name|qport_context
operator|->
name|link_up
operator|&
name|MLX4_EN_LINK_UP_MASK
operator|)
expr_stmt|;
switch|switch
condition|(
name|qport_context
operator|->
name|link_speed
operator|&
name|MLX4_EN_SPEED_MASK
condition|)
block|{
case|case
name|MLX4_EN_1G_SPEED
case|:
name|state
operator|->
name|link_speed
operator|=
literal|1000
expr_stmt|;
break|break;
case|case
name|MLX4_EN_10G_SPEED_XAUI
case|:
case|case
name|MLX4_EN_10G_SPEED_XFI
case|:
name|state
operator|->
name|link_speed
operator|=
literal|10000
expr_stmt|;
break|break;
case|case
name|MLX4_EN_20G_SPEED
case|:
name|state
operator|->
name|link_speed
operator|=
literal|20000
expr_stmt|;
break|break;
case|case
name|MLX4_EN_40G_SPEED
case|:
name|state
operator|->
name|link_speed
operator|=
literal|40000
expr_stmt|;
break|break;
case|case
name|MLX4_EN_56G_SPEED
case|:
name|state
operator|->
name|link_speed
operator|=
literal|56000
expr_stmt|;
break|break;
default|default:
name|state
operator|->
name|link_speed
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|state
operator|->
name|transciver
operator|=
name|qport_context
operator|->
name|transceiver
expr_stmt|;
name|state
operator|->
name|autoneg
operator|=
operator|!
operator|!
operator|(
name|qport_context
operator|->
name|autoneg
operator|&
name|MLX4_EN_AUTONEG_MASK
operator|)
expr_stmt|;
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|int
name|mlx4_en_DUMP_ETH_STATS
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u8
name|reset
parameter_list|)
block|{
name|struct
name|mlx4_en_stat_out_mbox
modifier|*
name|mlx4_en_stats
decl_stmt|;
name|struct
name|mlx4_en_stat_out_flow_control_mbox
modifier|*
name|flowstats
decl_stmt|;
name|struct
name|mlx4_en_priv
modifier|*
name|priv
init|=
name|netdev_priv
argument_list|(
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
argument_list|)
decl_stmt|;
name|struct
name|mlx4_en_vport_stats
modifier|*
name|vport_stats
init|=
operator|&
name|priv
operator|->
name|vport_stats
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
init|=
name|NULL
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox_flow
init|=
name|NULL
decl_stmt|;
name|u64
name|in_mod
init|=
name|reset
operator|<<
literal|8
operator||
name|port
decl_stmt|;
name|int
name|err
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|do_if_stat
init|=
literal|1
decl_stmt|;
name|unsigned
name|long
name|period
init|=
call|(
name|unsigned
name|long
call|)
argument_list|(
name|jiffies
operator|-
name|priv
operator|->
name|last_ifq_jiffies
argument_list|)
decl_stmt|;
name|struct
name|mlx4_en_vport_stats
name|tmp_vport_stats
decl_stmt|;
name|struct
name|net_device
modifier|*
name|dev
decl_stmt|;
if|if
condition|(
name|jiffies_to_msecs
argument_list|(
name|period
argument_list|)
operator|<
name|EN_IFQ_MIN_INTERVAL
operator|||
name|priv
operator|->
name|counter_index
operator|==
literal|0xff
condition|)
name|do_if_stat
operator|=
literal|0
expr_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
block|{
name|err
operator|=
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
expr_stmt|;
goto|goto
name|mailbox_out
goto|;
block|}
name|mailbox_flow
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox_flow
argument_list|)
condition|)
block|{
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
name|err
operator|=
name|PTR_ERR
argument_list|(
name|mailbox_flow
argument_list|)
expr_stmt|;
goto|goto
name|mailbox_out
goto|;
block|}
comment|/* 0xffs indicates invalid value */
name|memset
argument_list|(
name|mailbox_flow
operator|->
name|buf
argument_list|,
literal|0xff
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|flowstats
argument_list|)
operator|*
name|MLX4_NUM_PRIORITIES
argument_list|)
expr_stmt|;
if|if
condition|(
name|mdev
operator|->
name|dev
operator|->
name|caps
operator|.
name|flags2
operator|&
name|MLX4_DEV_CAP_FLAG2_FLOWSTATS_EN
condition|)
block|{
name|memset
argument_list|(
name|mailbox_flow
operator|->
name|buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|flowstats
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox_flow
operator|->
name|dma
argument_list|,
name|in_mod
operator||
literal|1
operator|<<
literal|12
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_DUMP_ETH_STATS
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_NATIVE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
block|}
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|in_mod
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_DUMP_ETH_STATS
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_NATIVE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|mlx4_en_stats
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|spin_lock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|rx_chksum_good
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|rx_chksum_none
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|priv
operator|->
name|rx_ring_num
condition|;
name|i
operator|++
control|)
block|{
name|priv
operator|->
name|port_stats
operator|.
name|rx_chksum_good
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|->
name|csum_ok
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|rx_chksum_none
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|->
name|csum_none
expr_stmt|;
block|}
name|priv
operator|->
name|port_stats
operator|.
name|tx_chksum_offload
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|queue_stopped
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|wake_queue
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|oversized_packets
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|tso_packets
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|defrag_attempts
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|priv
operator|->
name|tx_ring_num
condition|;
name|i
operator|++
control|)
block|{
name|priv
operator|->
name|port_stats
operator|.
name|tx_chksum_offload
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|->
name|tx_csum
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|queue_stopped
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|->
name|queue_stopped
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|wake_queue
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|->
name|wake_queue
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|oversized_packets
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|->
name|oversized_packets
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|tso_packets
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|->
name|tso_packets
expr_stmt|;
name|priv
operator|->
name|port_stats
operator|.
name|defrag_attempts
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|->
name|defrag_attempts
expr_stmt|;
block|}
comment|/* RX Statistics */
name|priv
operator|->
name|pkstats
operator|.
name|rx_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_bytes
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_multicast_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_broadcast_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_errors
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|PCS
argument_list|)
operator|+
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RJBBR
argument_list|)
operator|+
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RCRC
argument_list|)
operator|+
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RRUNT
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RInRangeLengthErr
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROutRangeLengthErr
argument_list|)
operator|+
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RSHORT
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RGIANT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_dropped
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RdropOvflw
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_length_errors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RdropLength
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_over_errors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RdropOvflw
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_crc_errors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RCRC
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_jabbers
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RJBBR
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_in_range_length_error
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RInRangeLengthErr
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_out_range_length_error
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROutRangeLengthErr
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_lt_64_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R64_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_127_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R127_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_255_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R255_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_511_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R511_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_1023_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1023_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_1518_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1518_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_1522_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1522_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_1548_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R1548_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_gt_1548_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|R2MTU_novlan
argument_list|)
expr_stmt|;
comment|/* Tx Stats */
name|priv
operator|->
name|pkstats
operator|.
name|tx_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_bytes
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_multicast_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_broadcast_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TBCAST_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_errors
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TGIANT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_dropped
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TDROP
argument_list|)
operator|-
name|priv
operator|->
name|pkstats
operator|.
name|tx_errors
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_lt_64_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T64_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_127_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T127_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_255_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T255_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_511_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T511_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_1023_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1023_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_1518_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1518_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_1522_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1522_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_1548_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T1548_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_gt_1548_bytes_packets
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|T2MTU_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|1
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|2
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|2
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|3
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|3
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|4
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|4
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|5
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|5
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|6
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|6
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|7
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_7
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|7
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_prio_7
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|8
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|8
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|ROCT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|1
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|2
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|2
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|3
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|3
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|4
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|4
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|5
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|5
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|6
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|6
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|7
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_7
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|7
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_prio_7
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|8
index|]
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|8
index|]
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TOCT_novlan
argument_list|)
expr_stmt|;
name|flowstats
operator|=
name|mailbox_flow
operator|->
name|buf
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MLX4_NUM_PRIORITIES
condition|;
name|i
operator|++
control|)
block|{
name|priv
operator|->
name|flowstats
index|[
name|i
index|]
operator|.
name|rx_pause
operator|=
name|be64_to_cpu
argument_list|(
name|flowstats
index|[
name|i
index|]
operator|.
name|rx_pause
argument_list|)
expr_stmt|;
name|priv
operator|->
name|flowstats
index|[
name|i
index|]
operator|.
name|rx_pause_duration
operator|=
name|be64_to_cpu
argument_list|(
name|flowstats
index|[
name|i
index|]
operator|.
name|rx_pause_duration
argument_list|)
expr_stmt|;
name|priv
operator|->
name|flowstats
index|[
name|i
index|]
operator|.
name|rx_pause_transition
operator|=
name|be64_to_cpu
argument_list|(
name|flowstats
index|[
name|i
index|]
operator|.
name|rx_pause_transition
argument_list|)
expr_stmt|;
name|priv
operator|->
name|flowstats
index|[
name|i
index|]
operator|.
name|tx_pause
operator|=
name|be64_to_cpu
argument_list|(
name|flowstats
index|[
name|i
index|]
operator|.
name|tx_pause
argument_list|)
expr_stmt|;
name|priv
operator|->
name|flowstats
index|[
name|i
index|]
operator|.
name|tx_pause_duration
operator|=
name|be64_to_cpu
argument_list|(
name|flowstats
index|[
name|i
index|]
operator|.
name|tx_pause_duration
argument_list|)
expr_stmt|;
name|priv
operator|->
name|flowstats
index|[
name|i
index|]
operator|.
name|tx_pause_transition
operator|=
name|be64_to_cpu
argument_list|(
name|flowstats
index|[
name|i
index|]
operator|.
name|tx_pause_transition
argument_list|)
expr_stmt|;
block|}
name|memset
argument_list|(
operator|&
name|tmp_vport_stats
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tmp_vport_stats
argument_list|)
argument_list|)
expr_stmt|;
name|spin_unlock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_get_vport_ethtool_stats
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|port
argument_list|,
operator|&
name|tmp_vport_stats
argument_list|,
name|reset
argument_list|)
expr_stmt|;
name|spin_lock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
block|{
comment|/* ethtool stats format */
name|vport_stats
operator|->
name|rx_unicast_packets
operator|=
name|tmp_vport_stats
operator|.
name|rx_unicast_packets
expr_stmt|;
name|vport_stats
operator|->
name|rx_unicast_bytes
operator|=
name|tmp_vport_stats
operator|.
name|rx_unicast_bytes
expr_stmt|;
name|vport_stats
operator|->
name|rx_multicast_packets
operator|=
name|tmp_vport_stats
operator|.
name|rx_multicast_packets
expr_stmt|;
name|vport_stats
operator|->
name|rx_multicast_bytes
operator|=
name|tmp_vport_stats
operator|.
name|rx_multicast_bytes
expr_stmt|;
name|vport_stats
operator|->
name|rx_broadcast_packets
operator|=
name|tmp_vport_stats
operator|.
name|rx_broadcast_packets
expr_stmt|;
name|vport_stats
operator|->
name|rx_broadcast_bytes
operator|=
name|tmp_vport_stats
operator|.
name|rx_broadcast_bytes
expr_stmt|;
name|vport_stats
operator|->
name|rx_dropped
operator|=
name|tmp_vport_stats
operator|.
name|rx_dropped
expr_stmt|;
name|vport_stats
operator|->
name|rx_errors
operator|=
name|tmp_vport_stats
operator|.
name|rx_errors
expr_stmt|;
name|vport_stats
operator|->
name|tx_unicast_packets
operator|=
name|tmp_vport_stats
operator|.
name|tx_unicast_packets
expr_stmt|;
name|vport_stats
operator|->
name|tx_unicast_bytes
operator|=
name|tmp_vport_stats
operator|.
name|tx_unicast_bytes
expr_stmt|;
name|vport_stats
operator|->
name|tx_multicast_packets
operator|=
name|tmp_vport_stats
operator|.
name|tx_multicast_packets
expr_stmt|;
name|vport_stats
operator|->
name|tx_multicast_bytes
operator|=
name|tmp_vport_stats
operator|.
name|tx_multicast_bytes
expr_stmt|;
name|vport_stats
operator|->
name|tx_broadcast_packets
operator|=
name|tmp_vport_stats
operator|.
name|tx_broadcast_packets
expr_stmt|;
name|vport_stats
operator|->
name|tx_broadcast_bytes
operator|=
name|tmp_vport_stats
operator|.
name|tx_broadcast_bytes
expr_stmt|;
name|vport_stats
operator|->
name|tx_errors
operator|=
name|tmp_vport_stats
operator|.
name|tx_errors
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|mlx4_is_mfunc
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
condition|)
block|{
comment|/* netdevice stats format */
if|#
directive|if
name|__FreeBSD_version
operator|>=
literal|1100000
if|if
condition|(
name|reset
operator|==
literal|0
condition|)
block|{
name|dev
operator|=
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_IPACKETS
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|rx_packets
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|rx_packets
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_OPACKETS
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|tx_packets
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|tx_packets
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_IBYTES
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|rx_bytes
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|rx_bytes
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_OBYTES
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|tx_bytes
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|tx_bytes
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_IERRORS
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|rx_errors
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|rx_errors
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_IQDROPS
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|rx_dropped
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|rx_dropped
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_IMCASTS
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|rx_multicast_packets
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|rx_multicast_packets
argument_list|)
expr_stmt|;
name|if_inc_counter
argument_list|(
name|dev
argument_list|,
name|IFCOUNTER_OMCASTS
argument_list|,
name|priv
operator|->
name|pkstats
operator|.
name|tx_multicast_packets
operator|-
name|priv
operator|->
name|pkstats_last
operator|.
name|tx_multicast_packets
argument_list|)
expr_stmt|;
block|}
name|priv
operator|->
name|pkstats_last
operator|=
name|priv
operator|->
name|pkstats
expr_stmt|;
else|#
directive|else
name|dev
operator|=
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
expr_stmt|;
name|dev
operator|->
name|if_ipackets
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|rx_packets
expr_stmt|;
name|dev
operator|->
name|if_opackets
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|tx_packets
expr_stmt|;
name|dev
operator|->
name|if_ibytes
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|rx_bytes
expr_stmt|;
name|dev
operator|->
name|if_obytes
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|tx_bytes
expr_stmt|;
name|dev
operator|->
name|if_ierrors
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|rx_errors
expr_stmt|;
name|dev
operator|->
name|if_iqdrops
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|rx_dropped
expr_stmt|;
name|dev
operator|->
name|if_imcasts
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|rx_multicast_packets
expr_stmt|;
name|dev
operator|->
name|if_omcasts
operator|=
name|priv
operator|->
name|pkstats
operator|.
name|tx_multicast_packets
expr_stmt|;
name|dev
operator|->
name|if_collisions
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
block|}
name|spin_unlock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox_flow
argument_list|)
expr_stmt|;
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
name|mailbox_out
label|:
if|if
condition|(
name|do_if_stat
condition|)
name|priv
operator|->
name|last_ifq_jiffies
operator|=
name|jiffies
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

end_unit

