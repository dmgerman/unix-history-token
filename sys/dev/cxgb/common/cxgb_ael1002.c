begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**************************************************************************  Copyright (c) 2007-2009, Chelsio Inc. All rights reserved.  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:   1. Redistributions of source code must retain the above copyright notice,     this list of conditions and the following disclaimer.   2. Neither the name of the Chelsio Corporation nor the names of its     contributors may be used to endorse or promote products derived from     this software without specific prior written permission.  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  ***************************************************************************/
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<cxgb_include.h>
end_include

begin_undef
undef|#
directive|undef
name|msleep
end_undef

begin_define
define|#
directive|define
name|msleep
value|t3_os_sleep
end_define

begin_enum
enum|enum
block|{
name|PMD_RSD
init|=
literal|10
block|,
comment|/* PMA/PMD receive signal detect register */
name|PCS_STAT1_X
init|=
literal|24
block|,
comment|/* 10GBASE-X PCS status 1 register */
name|PCS_STAT1_R
init|=
literal|32
block|,
comment|/* 10GBASE-R PCS status 1 register */
name|XS_LN_STAT
init|=
literal|24
comment|/* XS lane status register */
block|}
enum|;
end_enum

begin_enum
enum|enum
block|{
name|AEL100X_TX_DISABLE
init|=
literal|9
block|,
name|AEL100X_TX_CONFIG1
init|=
literal|0xc002
block|,
name|AEL1002_PWR_DOWN_HI
init|=
literal|0xc011
block|,
name|AEL1002_PWR_DOWN_LO
init|=
literal|0xc012
block|,
name|AEL1002_XFI_EQL
init|=
literal|0xc015
block|,
name|AEL1002_LB_EN
init|=
literal|0xc017
block|,
name|AEL_OPT_SETTINGS
init|=
literal|0xc017
block|,
name|AEL_I2C_CTRL
init|=
literal|0xc30a
block|,
name|AEL_I2C_DATA
init|=
literal|0xc30b
block|,
name|AEL_I2C_STAT
init|=
literal|0xc30c
block|,
name|AEL2005_GPIO_CTRL
init|=
literal|0xc214
block|,
name|AEL2005_GPIO_STAT
init|=
literal|0xc215
block|,
name|AEL2020_GPIO_INTR
init|=
literal|0xc103
block|,
name|AEL2020_GPIO_CTRL
init|=
literal|0xc108
block|,
name|AEL2020_GPIO_STAT
init|=
literal|0xc10c
block|,
name|AEL2020_GPIO_CFG
init|=
literal|0xc110
block|,
name|AEL2020_GPIO_SDA
init|=
literal|0
block|,
name|AEL2020_GPIO_MODDET
init|=
literal|1
block|,
name|AEL2020_GPIO_0
init|=
literal|3
block|,
name|AEL2020_GPIO_1
init|=
literal|2
block|,
name|AEL2020_GPIO_LSTAT
init|=
name|AEL2020_GPIO_1
block|, }
enum|;
end_enum

begin_enum
enum|enum
block|{
name|edc_none
block|,
name|edc_sr
block|,
name|edc_twinax
block|}
enum|;
end_enum

begin_comment
comment|/* PHY module I2C device address */
end_comment

begin_enum
enum|enum
block|{
name|MODULE_DEV_ADDR
init|=
literal|0xa0
block|,
name|SFF_DEV_ADDR
init|=
literal|0xa2
block|, }
enum|;
end_enum

begin_comment
comment|/* PHY transceiver type */
end_comment

begin_enum
enum|enum
block|{
name|phy_transtype_unknown
init|=
literal|0
block|,
name|phy_transtype_sfp
init|=
literal|3
block|,
name|phy_transtype_xfp
init|=
literal|6
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|AEL2005_MODDET_IRQ
value|4
end_define

begin_struct
struct|struct
name|reg_val
block|{
name|unsigned
name|short
name|mmd_addr
decl_stmt|;
name|unsigned
name|short
name|reg_addr
decl_stmt|;
name|unsigned
name|short
name|clear_bits
decl_stmt|;
name|unsigned
name|short
name|set_bits
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|int
name|ael2xxx_get_module_type
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|delay_ms
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|int
name|set_phy_regs
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
specifier|const
name|struct
name|reg_val
modifier|*
name|rv
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
for|for
control|(
name|err
operator|=
literal|0
init|;
name|rv
operator|->
name|mmd_addr
operator|&&
operator|!
name|err
condition|;
name|rv
operator|++
control|)
block|{
if|if
condition|(
name|rv
operator|->
name|clear_bits
operator|==
literal|0xffff
condition|)
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|rv
operator|->
name|mmd_addr
argument_list|,
name|rv
operator|->
name|reg_addr
argument_list|,
name|rv
operator|->
name|set_bits
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|t3_mdio_change_bits
argument_list|(
name|phy
argument_list|,
name|rv
operator|->
name|mmd_addr
argument_list|,
name|rv
operator|->
name|reg_addr
argument_list|,
name|rv
operator|->
name|clear_bits
argument_list|,
name|rv
operator|->
name|set_bits
argument_list|)
expr_stmt|;
block|}
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ael100x_txon
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|int
name|tx_on_gpio
init|=
name|phy
operator|->
name|addr
operator|==
literal|0
condition|?
name|F_GPIO7_OUT_VAL
else|:
name|F_GPIO2_OUT_VAL
decl_stmt|;
name|msleep
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|t3_set_reg_field
argument_list|(
name|phy
operator|->
name|adapter
argument_list|,
name|A_T3DBG_GPIO_EN
argument_list|,
literal|0
argument_list|,
name|tx_on_gpio
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|30
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Read an 8-bit word from a device attached to the PHY's i2c bus.  */
end_comment

begin_function
specifier|static
name|int
name|ael_i2c_rd
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|dev_addr
parameter_list|,
name|int
name|word_addr
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|err
decl_stmt|;
name|unsigned
name|int
name|stat
decl_stmt|,
name|data
decl_stmt|;
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_I2C_CTRL
argument_list|,
operator|(
name|dev_addr
operator|<<
literal|8
operator|)
operator||
operator|(
literal|1
operator|<<
literal|8
operator|)
operator||
name|word_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|200
condition|;
name|i
operator|++
control|)
block|{
name|msleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_I2C_STAT
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
if|if
condition|(
operator|(
name|stat
operator|&
literal|3
operator|)
operator|==
literal|1
condition|)
block|{
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_I2C_DATA
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
return|return
name|data
operator|>>
literal|8
return|;
block|}
block|}
name|CH_WARN
argument_list|(
name|phy
operator|->
name|adapter
argument_list|,
literal|"PHY %u i2c read of dev.addr %x.%x timed out\n"
argument_list|,
name|phy
operator|->
name|addr
argument_list|,
name|dev_addr
argument_list|,
name|word_addr
argument_list|)
expr_stmt|;
return|return
operator|-
name|ETIMEDOUT
return|;
block|}
end_function

begin_comment
comment|/*  * Write an 8-bit word to a device attached to the PHY's i2c bus.  */
end_comment

begin_function
specifier|static
name|int
name|ael_i2c_wr
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|dev_addr
parameter_list|,
name|int
name|word_addr
parameter_list|,
name|int
name|data
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|err
decl_stmt|;
name|unsigned
name|int
name|stat
decl_stmt|;
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_I2C_DATA
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_I2C_CTRL
argument_list|,
operator|(
name|dev_addr
operator|<<
literal|8
operator|)
operator||
name|word_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|200
condition|;
name|i
operator|++
control|)
block|{
name|msleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_I2C_STAT
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
if|if
condition|(
operator|(
name|stat
operator|&
literal|3
operator|)
operator|==
literal|1
condition|)
return|return
literal|0
return|;
block|}
name|CH_WARN
argument_list|(
name|phy
operator|->
name|adapter
argument_list|,
literal|"PHY %u i2c Write of dev.addr %x.%x = %#x timed out\n"
argument_list|,
name|phy
operator|->
name|addr
argument_list|,
name|dev_addr
argument_list|,
name|word_addr
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
operator|-
name|ETIMEDOUT
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|get_phytrans_type
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|phy_transtype_unknown
return|;
return|return
name|v
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael_laser_down
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|enable
parameter_list|)
block|{
name|int
name|v
decl_stmt|,
name|dev_addr
decl_stmt|;
name|v
operator|=
name|get_phytrans_type
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
if|if
condition|(
name|v
operator|==
name|phy_transtype_sfp
condition|)
block|{
comment|/* Check SFF Soft TX disable is supported */
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|93
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
name|v
operator|&=
literal|0x40
expr_stmt|;
if|if
condition|(
operator|!
name|v
condition|)
return|return
name|v
return|;
name|dev_addr
operator|=
name|SFF_DEV_ADDR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|v
operator|==
name|phy_transtype_xfp
condition|)
name|dev_addr
operator|=
name|MODULE_DEV_ADDR
expr_stmt|;
else|else
return|return
name|v
return|;
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|dev_addr
argument_list|,
literal|110
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
if|if
condition|(
name|enable
condition|)
name|v
operator||=
literal|0x40
expr_stmt|;
else|else
name|v
operator|&=
operator|~
literal|0x40
expr_stmt|;
name|v
operator|=
name|ael_i2c_wr
argument_list|(
name|phy
argument_list|,
name|dev_addr
argument_list|,
literal|110
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael1002_power_down
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|enable
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL100X_TX_DISABLE
argument_list|,
operator|!
operator|!
name|enable
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|err
operator|=
name|t3_mdio_change_bits
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|MII_BMCR
argument_list|,
name|BMCR_PDOWN
argument_list|,
name|enable
condition|?
name|BMCR_PDOWN
else|:
literal|0
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael1002_get_module_type
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|delay_ms
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
if|if
condition|(
name|delay_ms
condition|)
name|msleep
argument_list|(
name|delay_ms
argument_list|)
expr_stmt|;
name|v
operator|=
name|ael2xxx_get_module_type
argument_list|(
name|phy
argument_list|,
name|delay_ms
argument_list|)
expr_stmt|;
return|return
operator|(
name|v
operator|==
operator|-
name|ETIMEDOUT
condition|?
name|phy_modtype_none
else|:
name|v
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael1002_reset
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|wait
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|ael1002_power_down
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL100X_TX_CONFIG1
argument_list|,
literal|1
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL1002_PWR_DOWN_HI
argument_list|,
literal|0
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL1002_PWR_DOWN_LO
argument_list|,
literal|0
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL1002_XFI_EQL
argument_list|,
literal|0x18
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|t3_mdio_change_bits
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL1002_LB_EN
argument_list|,
literal|0
argument_list|,
literal|1
operator|<<
literal|5
argument_list|)
operator|)
condition|)
return|return
name|err
return|;
name|err
operator|=
name|ael1002_get_module_type
argument_list|(
name|phy
argument_list|,
literal|300
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|>=
literal|0
condition|)
name|phy
operator|->
name|modtype
operator|=
name|err
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael1002_intr_noop
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Get link status for a 10GBASE-R device.  */
end_comment

begin_function
specifier|static
name|int
name|get_link_status_r
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
modifier|*
name|link_ok
parameter_list|,
name|int
modifier|*
name|speed
parameter_list|,
name|int
modifier|*
name|duplex
parameter_list|,
name|int
modifier|*
name|fc
parameter_list|)
block|{
if|if
condition|(
name|link_ok
condition|)
block|{
name|unsigned
name|int
name|stat0
decl_stmt|,
name|stat1
decl_stmt|,
name|stat2
decl_stmt|;
name|int
name|err
init|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|PMD_RSD
argument_list|,
operator|&
name|stat0
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PCS
argument_list|,
name|PCS_STAT1_R
argument_list|,
operator|&
name|stat1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_XGXS
argument_list|,
name|XS_LN_STAT
argument_list|,
operator|&
name|stat2
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
operator|*
name|link_ok
operator|=
operator|(
name|stat0
operator|&
name|stat1
operator|&
operator|(
name|stat2
operator|>>
literal|12
operator|)
operator|)
operator|&
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|speed
condition|)
operator|*
name|speed
operator|=
name|SPEED_10000
expr_stmt|;
if|if
condition|(
name|duplex
condition|)
operator|*
name|duplex
operator|=
name|DUPLEX_FULL
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|C99_NOT_SUPPORTED
end_ifdef

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|ael1002_ops
init|=
block|{
name|ael1002_reset
block|,
name|ael1002_intr_noop
block|,
name|ael1002_intr_noop
block|,
name|ael1002_intr_noop
block|,
name|ael1002_intr_noop
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|get_link_status_r
block|,
name|ael1002_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|ael1002_ops
init|=
block|{
operator|.
name|reset
operator|=
name|ael1002_reset
block|,
operator|.
name|intr_enable
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|intr_disable
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|intr_clear
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|intr_handler
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|get_link_status
operator|=
name|get_link_status_r
block|,
operator|.
name|power_down
operator|=
name|ael1002_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|t3_ael1002_phy_prep
parameter_list|(
name|pinfo_t
modifier|*
name|pinfo
parameter_list|,
name|int
name|phy_addr
parameter_list|,
specifier|const
name|struct
name|mdio_ops
modifier|*
name|mdio_ops
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
name|struct
name|cphy
modifier|*
name|phy
init|=
operator|&
name|pinfo
operator|->
name|phy
decl_stmt|;
name|cphy_init
argument_list|(
name|phy
argument_list|,
name|pinfo
operator|->
name|adapter
argument_list|,
name|pinfo
argument_list|,
name|phy_addr
argument_list|,
operator|&
name|ael1002_ops
argument_list|,
name|mdio_ops
argument_list|,
name|SUPPORTED_10000baseT_Full
operator||
name|SUPPORTED_AUI
operator||
name|SUPPORTED_FIBRE
argument_list|,
literal|"10GBASE-R"
argument_list|)
expr_stmt|;
name|ael100x_txon
argument_list|(
name|phy
argument_list|)
expr_stmt|;
name|ael_laser_down
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|err
operator|=
name|ael1002_get_module_type
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|>=
literal|0
condition|)
name|phy
operator|->
name|modtype
operator|=
name|err
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael1006_reset
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|wait
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
name|err
operator|=
name|t3_phy_reset
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|wait
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|t3_set_reg_field
argument_list|(
name|phy
operator|->
name|adapter
argument_list|,
name|A_T3DBG_GPIO_EN
argument_list|,
name|F_GPIO6_OUT_VAL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|t3_set_reg_field
argument_list|(
name|phy
operator|->
name|adapter
argument_list|,
name|A_T3DBG_GPIO_EN
argument_list|,
name|F_GPIO6_OUT_VAL
argument_list|,
name|F_GPIO6_OUT_VAL
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|err
operator|=
name|t3_phy_reset
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|wait
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|err
operator|=
name|t3_mdio_change_bits
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|MII_BMCR
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|err
operator|=
name|t3_mdio_change_bits
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|MII_BMCR
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|C99_NOT_SUPPORTED
end_ifdef

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|ael1006_ops
init|=
block|{
name|ael1006_reset
block|,
name|t3_phy_lasi_intr_enable
block|,
name|t3_phy_lasi_intr_disable
block|,
name|t3_phy_lasi_intr_clear
block|,
name|t3_phy_lasi_intr_handler
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|get_link_status_r
block|,
name|ael1002_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|ael1006_ops
init|=
block|{
operator|.
name|reset
operator|=
name|ael1006_reset
block|,
operator|.
name|intr_enable
operator|=
name|t3_phy_lasi_intr_enable
block|,
operator|.
name|intr_disable
operator|=
name|t3_phy_lasi_intr_disable
block|,
operator|.
name|intr_clear
operator|=
name|t3_phy_lasi_intr_clear
block|,
operator|.
name|intr_handler
operator|=
name|t3_phy_lasi_intr_handler
block|,
operator|.
name|get_link_status
operator|=
name|get_link_status_r
block|,
operator|.
name|power_down
operator|=
name|ael1002_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|t3_ael1006_phy_prep
parameter_list|(
name|pinfo_t
modifier|*
name|pinfo
parameter_list|,
name|int
name|phy_addr
parameter_list|,
specifier|const
name|struct
name|mdio_ops
modifier|*
name|mdio_ops
parameter_list|)
block|{
name|struct
name|cphy
modifier|*
name|phy
init|=
operator|&
name|pinfo
operator|->
name|phy
decl_stmt|;
name|cphy_init
argument_list|(
name|phy
argument_list|,
name|pinfo
operator|->
name|adapter
argument_list|,
name|pinfo
argument_list|,
name|phy_addr
argument_list|,
operator|&
name|ael1006_ops
argument_list|,
name|mdio_ops
argument_list|,
name|SUPPORTED_10000baseT_Full
operator||
name|SUPPORTED_AUI
operator||
name|SUPPORTED_FIBRE
argument_list|,
literal|"10GBASE-SR"
argument_list|)
expr_stmt|;
name|phy
operator|->
name|modtype
operator|=
name|phy_modtype_sr
expr_stmt|;
name|ael100x_txon
argument_list|(
name|phy
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Decode our module type.  */
end_comment

begin_function
specifier|static
name|int
name|ael2xxx_get_module_type
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|delay_ms
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
if|if
condition|(
name|delay_ms
condition|)
name|msleep
argument_list|(
name|delay_ms
argument_list|)
expr_stmt|;
name|v
operator|=
name|get_phytrans_type
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|==
name|phy_transtype_sfp
condition|)
block|{
comment|/* SFP: see SFF-8472 for below */
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
if|if
condition|(
name|v
operator|==
literal|0x1
condition|)
return|return
name|phy_modtype_twinax
return|;
if|if
condition|(
name|v
operator|==
literal|0x10
condition|)
return|return
name|phy_modtype_sr
return|;
if|if
condition|(
name|v
operator|==
literal|0x20
condition|)
return|return
name|phy_modtype_lr
return|;
if|if
condition|(
name|v
operator|==
literal|0x40
condition|)
return|return
name|phy_modtype_lrm
return|;
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
if|if
condition|(
name|v
operator|!=
literal|4
condition|)
return|return
name|phy_modtype_unknown
return|;
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
if|if
condition|(
name|v
operator|&
literal|0x80
condition|)
block|{
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|0x12
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
return|return
name|v
operator|>
literal|10
condition|?
name|phy_modtype_twinax_long
else|:
name|phy_modtype_twinax
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|v
operator|==
name|phy_transtype_xfp
condition|)
block|{
comment|/* XFP: See INF-8077i for details. */
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|127
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
if|if
condition|(
name|v
operator|!=
literal|1
condition|)
block|{
comment|/* XXX: set page select to table 1 yourself */
return|return
name|phy_modtype_unknown
return|;
block|}
name|v
operator|=
name|ael_i2c_rd
argument_list|(
name|phy
argument_list|,
name|MODULE_DEV_ADDR
argument_list|,
literal|131
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
return|return
name|v
return|;
name|v
operator|&=
literal|0xf0
expr_stmt|;
if|if
condition|(
name|v
operator|==
literal|0x10
condition|)
return|return
name|phy_modtype_lrm
return|;
if|if
condition|(
name|v
operator|==
literal|0x40
condition|)
return|return
name|phy_modtype_lr
return|;
if|if
condition|(
name|v
operator|==
literal|0x80
condition|)
return|return
name|phy_modtype_sr
return|;
block|}
return|return
name|phy_modtype_unknown
return|;
block|}
end_function

begin_comment
comment|/*  * Code to support the Aeluros/NetLogic 2005 10Gb PHY.  */
end_comment

begin_function
specifier|static
name|int
name|ael2005_setup_sr_edc
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
specifier|static
name|struct
name|reg_val
name|regs
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc003
block|,
literal|0xffff
block|,
literal|0x181
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc010
block|,
literal|0xffff
block|,
literal|0x448a
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc04a
block|,
literal|0xffff
block|,
literal|0x5200
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|u16
name|sr_edc
index|[]
init|=
block|{
literal|0xcc00
block|,
literal|0x2ff4
block|,
literal|0xcc01
block|,
literal|0x3cd4
block|,
literal|0xcc02
block|,
literal|0x2015
block|,
literal|0xcc03
block|,
literal|0x3105
block|,
literal|0xcc04
block|,
literal|0x6524
block|,
literal|0xcc05
block|,
literal|0x27ff
block|,
literal|0xcc06
block|,
literal|0x300f
block|,
literal|0xcc07
block|,
literal|0x2c8b
block|,
literal|0xcc08
block|,
literal|0x300b
block|,
literal|0xcc09
block|,
literal|0x4009
block|,
literal|0xcc0a
block|,
literal|0x400e
block|,
literal|0xcc0b
block|,
literal|0x2f72
block|,
literal|0xcc0c
block|,
literal|0x3002
block|,
literal|0xcc0d
block|,
literal|0x1002
block|,
literal|0xcc0e
block|,
literal|0x2172
block|,
literal|0xcc0f
block|,
literal|0x3012
block|,
literal|0xcc10
block|,
literal|0x1002
block|,
literal|0xcc11
block|,
literal|0x25d2
block|,
literal|0xcc12
block|,
literal|0x3012
block|,
literal|0xcc13
block|,
literal|0x1002
block|,
literal|0xcc14
block|,
literal|0xd01e
block|,
literal|0xcc15
block|,
literal|0x27d2
block|,
literal|0xcc16
block|,
literal|0x3012
block|,
literal|0xcc17
block|,
literal|0x1002
block|,
literal|0xcc18
block|,
literal|0x2004
block|,
literal|0xcc19
block|,
literal|0x3c84
block|,
literal|0xcc1a
block|,
literal|0x6436
block|,
literal|0xcc1b
block|,
literal|0x2007
block|,
literal|0xcc1c
block|,
literal|0x3f87
block|,
literal|0xcc1d
block|,
literal|0x8676
block|,
literal|0xcc1e
block|,
literal|0x40b7
block|,
literal|0xcc1f
block|,
literal|0xa746
block|,
literal|0xcc20
block|,
literal|0x4047
block|,
literal|0xcc21
block|,
literal|0x5673
block|,
literal|0xcc22
block|,
literal|0x2982
block|,
literal|0xcc23
block|,
literal|0x3002
block|,
literal|0xcc24
block|,
literal|0x13d2
block|,
literal|0xcc25
block|,
literal|0x8bbd
block|,
literal|0xcc26
block|,
literal|0x2862
block|,
literal|0xcc27
block|,
literal|0x3012
block|,
literal|0xcc28
block|,
literal|0x1002
block|,
literal|0xcc29
block|,
literal|0x2092
block|,
literal|0xcc2a
block|,
literal|0x3012
block|,
literal|0xcc2b
block|,
literal|0x1002
block|,
literal|0xcc2c
block|,
literal|0x5cc3
block|,
literal|0xcc2d
block|,
literal|0x314
block|,
literal|0xcc2e
block|,
literal|0x2942
block|,
literal|0xcc2f
block|,
literal|0x3002
block|,
literal|0xcc30
block|,
literal|0x1002
block|,
literal|0xcc31
block|,
literal|0xd019
block|,
literal|0xcc32
block|,
literal|0x2032
block|,
literal|0xcc33
block|,
literal|0x3012
block|,
literal|0xcc34
block|,
literal|0x1002
block|,
literal|0xcc35
block|,
literal|0x2a04
block|,
literal|0xcc36
block|,
literal|0x3c74
block|,
literal|0xcc37
block|,
literal|0x6435
block|,
literal|0xcc38
block|,
literal|0x2fa4
block|,
literal|0xcc39
block|,
literal|0x3cd4
block|,
literal|0xcc3a
block|,
literal|0x6624
block|,
literal|0xcc3b
block|,
literal|0x5563
block|,
literal|0xcc3c
block|,
literal|0x2d42
block|,
literal|0xcc3d
block|,
literal|0x3002
block|,
literal|0xcc3e
block|,
literal|0x13d2
block|,
literal|0xcc3f
block|,
literal|0x464d
block|,
literal|0xcc40
block|,
literal|0x2862
block|,
literal|0xcc41
block|,
literal|0x3012
block|,
literal|0xcc42
block|,
literal|0x1002
block|,
literal|0xcc43
block|,
literal|0x2032
block|,
literal|0xcc44
block|,
literal|0x3012
block|,
literal|0xcc45
block|,
literal|0x1002
block|,
literal|0xcc46
block|,
literal|0x2fb4
block|,
literal|0xcc47
block|,
literal|0x3cd4
block|,
literal|0xcc48
block|,
literal|0x6624
block|,
literal|0xcc49
block|,
literal|0x5563
block|,
literal|0xcc4a
block|,
literal|0x2d42
block|,
literal|0xcc4b
block|,
literal|0x3002
block|,
literal|0xcc4c
block|,
literal|0x13d2
block|,
literal|0xcc4d
block|,
literal|0x2ed2
block|,
literal|0xcc4e
block|,
literal|0x3002
block|,
literal|0xcc4f
block|,
literal|0x1002
block|,
literal|0xcc50
block|,
literal|0x2fd2
block|,
literal|0xcc51
block|,
literal|0x3002
block|,
literal|0xcc52
block|,
literal|0x1002
block|,
literal|0xcc53
block|,
literal|0x004
block|,
literal|0xcc54
block|,
literal|0x2942
block|,
literal|0xcc55
block|,
literal|0x3002
block|,
literal|0xcc56
block|,
literal|0x1002
block|,
literal|0xcc57
block|,
literal|0x2092
block|,
literal|0xcc58
block|,
literal|0x3012
block|,
literal|0xcc59
block|,
literal|0x1002
block|,
literal|0xcc5a
block|,
literal|0x5cc3
block|,
literal|0xcc5b
block|,
literal|0x317
block|,
literal|0xcc5c
block|,
literal|0x2f72
block|,
literal|0xcc5d
block|,
literal|0x3002
block|,
literal|0xcc5e
block|,
literal|0x1002
block|,
literal|0xcc5f
block|,
literal|0x2942
block|,
literal|0xcc60
block|,
literal|0x3002
block|,
literal|0xcc61
block|,
literal|0x1002
block|,
literal|0xcc62
block|,
literal|0x22cd
block|,
literal|0xcc63
block|,
literal|0x301d
block|,
literal|0xcc64
block|,
literal|0x2862
block|,
literal|0xcc65
block|,
literal|0x3012
block|,
literal|0xcc66
block|,
literal|0x1002
block|,
literal|0xcc67
block|,
literal|0x2ed2
block|,
literal|0xcc68
block|,
literal|0x3002
block|,
literal|0xcc69
block|,
literal|0x1002
block|,
literal|0xcc6a
block|,
literal|0x2d72
block|,
literal|0xcc6b
block|,
literal|0x3002
block|,
literal|0xcc6c
block|,
literal|0x1002
block|,
literal|0xcc6d
block|,
literal|0x628f
block|,
literal|0xcc6e
block|,
literal|0x2112
block|,
literal|0xcc6f
block|,
literal|0x3012
block|,
literal|0xcc70
block|,
literal|0x1002
block|,
literal|0xcc71
block|,
literal|0x5aa3
block|,
literal|0xcc72
block|,
literal|0x2dc2
block|,
literal|0xcc73
block|,
literal|0x3002
block|,
literal|0xcc74
block|,
literal|0x1312
block|,
literal|0xcc75
block|,
literal|0x6f72
block|,
literal|0xcc76
block|,
literal|0x1002
block|,
literal|0xcc77
block|,
literal|0x2807
block|,
literal|0xcc78
block|,
literal|0x31a7
block|,
literal|0xcc79
block|,
literal|0x20c4
block|,
literal|0xcc7a
block|,
literal|0x3c24
block|,
literal|0xcc7b
block|,
literal|0x6724
block|,
literal|0xcc7c
block|,
literal|0x1002
block|,
literal|0xcc7d
block|,
literal|0x2807
block|,
literal|0xcc7e
block|,
literal|0x3187
block|,
literal|0xcc7f
block|,
literal|0x20c4
block|,
literal|0xcc80
block|,
literal|0x3c24
block|,
literal|0xcc81
block|,
literal|0x6724
block|,
literal|0xcc82
block|,
literal|0x1002
block|,
literal|0xcc83
block|,
literal|0x2514
block|,
literal|0xcc84
block|,
literal|0x3c64
block|,
literal|0xcc85
block|,
literal|0x6436
block|,
literal|0xcc86
block|,
literal|0xdff4
block|,
literal|0xcc87
block|,
literal|0x6436
block|,
literal|0xcc88
block|,
literal|0x1002
block|,
literal|0xcc89
block|,
literal|0x40a4
block|,
literal|0xcc8a
block|,
literal|0x643c
block|,
literal|0xcc8b
block|,
literal|0x4016
block|,
literal|0xcc8c
block|,
literal|0x8c6c
block|,
literal|0xcc8d
block|,
literal|0x2b24
block|,
literal|0xcc8e
block|,
literal|0x3c24
block|,
literal|0xcc8f
block|,
literal|0x6435
block|,
literal|0xcc90
block|,
literal|0x1002
block|,
literal|0xcc91
block|,
literal|0x2b24
block|,
literal|0xcc92
block|,
literal|0x3c24
block|,
literal|0xcc93
block|,
literal|0x643a
block|,
literal|0xcc94
block|,
literal|0x4025
block|,
literal|0xcc95
block|,
literal|0x8a5a
block|,
literal|0xcc96
block|,
literal|0x1002
block|,
literal|0xcc97
block|,
literal|0x2731
block|,
literal|0xcc98
block|,
literal|0x3011
block|,
literal|0xcc99
block|,
literal|0x1001
block|,
literal|0xcc9a
block|,
literal|0xc7a0
block|,
literal|0xcc9b
block|,
literal|0x100
block|,
literal|0xcc9c
block|,
literal|0xc502
block|,
literal|0xcc9d
block|,
literal|0x53ac
block|,
literal|0xcc9e
block|,
literal|0xc503
block|,
literal|0xcc9f
block|,
literal|0xd5d5
block|,
literal|0xcca0
block|,
literal|0xc600
block|,
literal|0xcca1
block|,
literal|0x2a6d
block|,
literal|0xcca2
block|,
literal|0xc601
block|,
literal|0xcca3
block|,
literal|0x2a4c
block|,
literal|0xcca4
block|,
literal|0xc602
block|,
literal|0xcca5
block|,
literal|0x111
block|,
literal|0xcca6
block|,
literal|0xc60c
block|,
literal|0xcca7
block|,
literal|0x5900
block|,
literal|0xcca8
block|,
literal|0xc710
block|,
literal|0xcca9
block|,
literal|0x700
block|,
literal|0xccaa
block|,
literal|0xc718
block|,
literal|0xccab
block|,
literal|0x700
block|,
literal|0xccac
block|,
literal|0xc720
block|,
literal|0xccad
block|,
literal|0x4700
block|,
literal|0xccae
block|,
literal|0xc801
block|,
literal|0xccaf
block|,
literal|0x7f50
block|,
literal|0xccb0
block|,
literal|0xc802
block|,
literal|0xccb1
block|,
literal|0x7760
block|,
literal|0xccb2
block|,
literal|0xc803
block|,
literal|0xccb3
block|,
literal|0x7fce
block|,
literal|0xccb4
block|,
literal|0xc804
block|,
literal|0xccb5
block|,
literal|0x5700
block|,
literal|0xccb6
block|,
literal|0xc805
block|,
literal|0xccb7
block|,
literal|0x5f11
block|,
literal|0xccb8
block|,
literal|0xc806
block|,
literal|0xccb9
block|,
literal|0x4751
block|,
literal|0xccba
block|,
literal|0xc807
block|,
literal|0xccbb
block|,
literal|0x57e1
block|,
literal|0xccbc
block|,
literal|0xc808
block|,
literal|0xccbd
block|,
literal|0x2700
block|,
literal|0xccbe
block|,
literal|0xc809
block|,
literal|0xccbf
block|,
literal|0x000
block|,
literal|0xccc0
block|,
literal|0xc821
block|,
literal|0xccc1
block|,
literal|0x002
block|,
literal|0xccc2
block|,
literal|0xc822
block|,
literal|0xccc3
block|,
literal|0x014
block|,
literal|0xccc4
block|,
literal|0xc832
block|,
literal|0xccc5
block|,
literal|0x1186
block|,
literal|0xccc6
block|,
literal|0xc847
block|,
literal|0xccc7
block|,
literal|0x1e02
block|,
literal|0xccc8
block|,
literal|0xc013
block|,
literal|0xccc9
block|,
literal|0xf341
block|,
literal|0xccca
block|,
literal|0xc01a
block|,
literal|0xcccb
block|,
literal|0x446
block|,
literal|0xcccc
block|,
literal|0xc024
block|,
literal|0xcccd
block|,
literal|0x1000
block|,
literal|0xccce
block|,
literal|0xc025
block|,
literal|0xcccf
block|,
literal|0xa00
block|,
literal|0xccd0
block|,
literal|0xc026
block|,
literal|0xccd1
block|,
literal|0xc0c
block|,
literal|0xccd2
block|,
literal|0xc027
block|,
literal|0xccd3
block|,
literal|0xc0c
block|,
literal|0xccd4
block|,
literal|0xc029
block|,
literal|0xccd5
block|,
literal|0x0a0
block|,
literal|0xccd6
block|,
literal|0xc030
block|,
literal|0xccd7
block|,
literal|0xa00
block|,
literal|0xccd8
block|,
literal|0xc03c
block|,
literal|0xccd9
block|,
literal|0x01c
block|,
literal|0xccda
block|,
literal|0xc005
block|,
literal|0xccdb
block|,
literal|0x7a06
block|,
literal|0xccdc
block|,
literal|0x000
block|,
literal|0xccdd
block|,
literal|0x2731
block|,
literal|0xccde
block|,
literal|0x3011
block|,
literal|0xccdf
block|,
literal|0x1001
block|,
literal|0xcce0
block|,
literal|0xc620
block|,
literal|0xcce1
block|,
literal|0x000
block|,
literal|0xcce2
block|,
literal|0xc621
block|,
literal|0xcce3
block|,
literal|0x03f
block|,
literal|0xcce4
block|,
literal|0xc622
block|,
literal|0xcce5
block|,
literal|0x000
block|,
literal|0xcce6
block|,
literal|0xc623
block|,
literal|0xcce7
block|,
literal|0x000
block|,
literal|0xcce8
block|,
literal|0xc624
block|,
literal|0xcce9
block|,
literal|0x000
block|,
literal|0xccea
block|,
literal|0xc625
block|,
literal|0xcceb
block|,
literal|0x000
block|,
literal|0xccec
block|,
literal|0xc627
block|,
literal|0xcced
block|,
literal|0x000
block|,
literal|0xccee
block|,
literal|0xc628
block|,
literal|0xccef
block|,
literal|0x000
block|,
literal|0xccf0
block|,
literal|0xc62c
block|,
literal|0xccf1
block|,
literal|0x000
block|,
literal|0xccf2
block|,
literal|0x000
block|,
literal|0xccf3
block|,
literal|0x2806
block|,
literal|0xccf4
block|,
literal|0x3cb6
block|,
literal|0xccf5
block|,
literal|0xc161
block|,
literal|0xccf6
block|,
literal|0x6134
block|,
literal|0xccf7
block|,
literal|0x6135
block|,
literal|0xccf8
block|,
literal|0x5443
block|,
literal|0xccf9
block|,
literal|0x303
block|,
literal|0xccfa
block|,
literal|0x6524
block|,
literal|0xccfb
block|,
literal|0x00b
block|,
literal|0xccfc
block|,
literal|0x1002
block|,
literal|0xccfd
block|,
literal|0x2104
block|,
literal|0xccfe
block|,
literal|0x3c24
block|,
literal|0xccff
block|,
literal|0x2105
block|,
literal|0xcd00
block|,
literal|0x3805
block|,
literal|0xcd01
block|,
literal|0x6524
block|,
literal|0xcd02
block|,
literal|0xdff4
block|,
literal|0xcd03
block|,
literal|0x4005
block|,
literal|0xcd04
block|,
literal|0x6524
block|,
literal|0xcd05
block|,
literal|0x1002
block|,
literal|0xcd06
block|,
literal|0x5dd3
block|,
literal|0xcd07
block|,
literal|0x306
block|,
literal|0xcd08
block|,
literal|0x2ff7
block|,
literal|0xcd09
block|,
literal|0x38f7
block|,
literal|0xcd0a
block|,
literal|0x60b7
block|,
literal|0xcd0b
block|,
literal|0xdffd
block|,
literal|0xcd0c
block|,
literal|0x00a
block|,
literal|0xcd0d
block|,
literal|0x1002
block|,
literal|0xcd0e
block|,
literal|0
block|}
decl_stmt|;
name|int
name|i
decl_stmt|,
name|err
decl_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|50
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ARRAY_SIZE
argument_list|(
name|sr_edc
argument_list|)
operator|&&
operator|!
name|err
condition|;
name|i
operator|+=
literal|2
control|)
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|sr_edc
index|[
name|i
index|]
argument_list|,
name|sr_edc
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|phy
operator|->
name|priv
operator|=
name|edc_sr
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_setup_twinax_edc
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|modtype
parameter_list|)
block|{
specifier|static
name|struct
name|reg_val
name|regs
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc04a
block|,
literal|0xffff
block|,
literal|0x5a00
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|struct
name|reg_val
name|preemphasis
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc014
block|,
literal|0xffff
block|,
literal|0xfe16
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc015
block|,
literal|0xffff
block|,
literal|0xa000
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|u16
name|twinax_edc
index|[]
init|=
block|{
literal|0xcc00
block|,
literal|0x4009
block|,
literal|0xcc01
block|,
literal|0x27ff
block|,
literal|0xcc02
block|,
literal|0x300f
block|,
literal|0xcc03
block|,
literal|0x40aa
block|,
literal|0xcc04
block|,
literal|0x401c
block|,
literal|0xcc05
block|,
literal|0x401e
block|,
literal|0xcc06
block|,
literal|0x2ff4
block|,
literal|0xcc07
block|,
literal|0x3cd4
block|,
literal|0xcc08
block|,
literal|0x2035
block|,
literal|0xcc09
block|,
literal|0x3145
block|,
literal|0xcc0a
block|,
literal|0x6524
block|,
literal|0xcc0b
block|,
literal|0x26a2
block|,
literal|0xcc0c
block|,
literal|0x3012
block|,
literal|0xcc0d
block|,
literal|0x1002
block|,
literal|0xcc0e
block|,
literal|0x29c2
block|,
literal|0xcc0f
block|,
literal|0x3002
block|,
literal|0xcc10
block|,
literal|0x1002
block|,
literal|0xcc11
block|,
literal|0x2072
block|,
literal|0xcc12
block|,
literal|0x3012
block|,
literal|0xcc13
block|,
literal|0x1002
block|,
literal|0xcc14
block|,
literal|0x22cd
block|,
literal|0xcc15
block|,
literal|0x301d
block|,
literal|0xcc16
block|,
literal|0x2e52
block|,
literal|0xcc17
block|,
literal|0x3012
block|,
literal|0xcc18
block|,
literal|0x1002
block|,
literal|0xcc19
block|,
literal|0x28e2
block|,
literal|0xcc1a
block|,
literal|0x3002
block|,
literal|0xcc1b
block|,
literal|0x1002
block|,
literal|0xcc1c
block|,
literal|0x628f
block|,
literal|0xcc1d
block|,
literal|0x2ac2
block|,
literal|0xcc1e
block|,
literal|0x3012
block|,
literal|0xcc1f
block|,
literal|0x1002
block|,
literal|0xcc20
block|,
literal|0x5553
block|,
literal|0xcc21
block|,
literal|0x2ae2
block|,
literal|0xcc22
block|,
literal|0x3002
block|,
literal|0xcc23
block|,
literal|0x1302
block|,
literal|0xcc24
block|,
literal|0x401e
block|,
literal|0xcc25
block|,
literal|0x2be2
block|,
literal|0xcc26
block|,
literal|0x3012
block|,
literal|0xcc27
block|,
literal|0x1002
block|,
literal|0xcc28
block|,
literal|0x2da2
block|,
literal|0xcc29
block|,
literal|0x3012
block|,
literal|0xcc2a
block|,
literal|0x1002
block|,
literal|0xcc2b
block|,
literal|0x2ba2
block|,
literal|0xcc2c
block|,
literal|0x3002
block|,
literal|0xcc2d
block|,
literal|0x1002
block|,
literal|0xcc2e
block|,
literal|0x5ee3
block|,
literal|0xcc2f
block|,
literal|0x305
block|,
literal|0xcc30
block|,
literal|0x400e
block|,
literal|0xcc31
block|,
literal|0x2bc2
block|,
literal|0xcc32
block|,
literal|0x3002
block|,
literal|0xcc33
block|,
literal|0x1002
block|,
literal|0xcc34
block|,
literal|0x2b82
block|,
literal|0xcc35
block|,
literal|0x3012
block|,
literal|0xcc36
block|,
literal|0x1002
block|,
literal|0xcc37
block|,
literal|0x5663
block|,
literal|0xcc38
block|,
literal|0x302
block|,
literal|0xcc39
block|,
literal|0x401e
block|,
literal|0xcc3a
block|,
literal|0x6f72
block|,
literal|0xcc3b
block|,
literal|0x1002
block|,
literal|0xcc3c
block|,
literal|0x628f
block|,
literal|0xcc3d
block|,
literal|0x2be2
block|,
literal|0xcc3e
block|,
literal|0x3012
block|,
literal|0xcc3f
block|,
literal|0x1002
block|,
literal|0xcc40
block|,
literal|0x22cd
block|,
literal|0xcc41
block|,
literal|0x301d
block|,
literal|0xcc42
block|,
literal|0x2e52
block|,
literal|0xcc43
block|,
literal|0x3012
block|,
literal|0xcc44
block|,
literal|0x1002
block|,
literal|0xcc45
block|,
literal|0x2522
block|,
literal|0xcc46
block|,
literal|0x3012
block|,
literal|0xcc47
block|,
literal|0x1002
block|,
literal|0xcc48
block|,
literal|0x2da2
block|,
literal|0xcc49
block|,
literal|0x3012
block|,
literal|0xcc4a
block|,
literal|0x1002
block|,
literal|0xcc4b
block|,
literal|0x2ca2
block|,
literal|0xcc4c
block|,
literal|0x3012
block|,
literal|0xcc4d
block|,
literal|0x1002
block|,
literal|0xcc4e
block|,
literal|0x2fa4
block|,
literal|0xcc4f
block|,
literal|0x3cd4
block|,
literal|0xcc50
block|,
literal|0x6624
block|,
literal|0xcc51
block|,
literal|0x410b
block|,
literal|0xcc52
block|,
literal|0x56b3
block|,
literal|0xcc53
block|,
literal|0x3c4
block|,
literal|0xcc54
block|,
literal|0x2fb2
block|,
literal|0xcc55
block|,
literal|0x3002
block|,
literal|0xcc56
block|,
literal|0x1002
block|,
literal|0xcc57
block|,
literal|0x220b
block|,
literal|0xcc58
block|,
literal|0x303b
block|,
literal|0xcc59
block|,
literal|0x56b3
block|,
literal|0xcc5a
block|,
literal|0x3c3
block|,
literal|0xcc5b
block|,
literal|0x866b
block|,
literal|0xcc5c
block|,
literal|0x400c
block|,
literal|0xcc5d
block|,
literal|0x23a2
block|,
literal|0xcc5e
block|,
literal|0x3012
block|,
literal|0xcc5f
block|,
literal|0x1002
block|,
literal|0xcc60
block|,
literal|0x2da2
block|,
literal|0xcc61
block|,
literal|0x3012
block|,
literal|0xcc62
block|,
literal|0x1002
block|,
literal|0xcc63
block|,
literal|0x2ca2
block|,
literal|0xcc64
block|,
literal|0x3012
block|,
literal|0xcc65
block|,
literal|0x1002
block|,
literal|0xcc66
block|,
literal|0x2fb4
block|,
literal|0xcc67
block|,
literal|0x3cd4
block|,
literal|0xcc68
block|,
literal|0x6624
block|,
literal|0xcc69
block|,
literal|0x56b3
block|,
literal|0xcc6a
block|,
literal|0x3c3
block|,
literal|0xcc6b
block|,
literal|0x866b
block|,
literal|0xcc6c
block|,
literal|0x401c
block|,
literal|0xcc6d
block|,
literal|0x2205
block|,
literal|0xcc6e
block|,
literal|0x3035
block|,
literal|0xcc6f
block|,
literal|0x5b53
block|,
literal|0xcc70
block|,
literal|0x2c52
block|,
literal|0xcc71
block|,
literal|0x3002
block|,
literal|0xcc72
block|,
literal|0x13c2
block|,
literal|0xcc73
block|,
literal|0x5cc3
block|,
literal|0xcc74
block|,
literal|0x317
block|,
literal|0xcc75
block|,
literal|0x2522
block|,
literal|0xcc76
block|,
literal|0x3012
block|,
literal|0xcc77
block|,
literal|0x1002
block|,
literal|0xcc78
block|,
literal|0x2da2
block|,
literal|0xcc79
block|,
literal|0x3012
block|,
literal|0xcc7a
block|,
literal|0x1002
block|,
literal|0xcc7b
block|,
literal|0x2b82
block|,
literal|0xcc7c
block|,
literal|0x3012
block|,
literal|0xcc7d
block|,
literal|0x1002
block|,
literal|0xcc7e
block|,
literal|0x5663
block|,
literal|0xcc7f
block|,
literal|0x303
block|,
literal|0xcc80
block|,
literal|0x401e
block|,
literal|0xcc81
block|,
literal|0x004
block|,
literal|0xcc82
block|,
literal|0x2c42
block|,
literal|0xcc83
block|,
literal|0x3012
block|,
literal|0xcc84
block|,
literal|0x1002
block|,
literal|0xcc85
block|,
literal|0x6f72
block|,
literal|0xcc86
block|,
literal|0x1002
block|,
literal|0xcc87
block|,
literal|0x628f
block|,
literal|0xcc88
block|,
literal|0x2304
block|,
literal|0xcc89
block|,
literal|0x3c84
block|,
literal|0xcc8a
block|,
literal|0x6436
block|,
literal|0xcc8b
block|,
literal|0xdff4
block|,
literal|0xcc8c
block|,
literal|0x6436
block|,
literal|0xcc8d
block|,
literal|0x2ff5
block|,
literal|0xcc8e
block|,
literal|0x3005
block|,
literal|0xcc8f
block|,
literal|0x8656
block|,
literal|0xcc90
block|,
literal|0xdfba
block|,
literal|0xcc91
block|,
literal|0x56a3
block|,
literal|0xcc92
block|,
literal|0xd05a
block|,
literal|0xcc93
block|,
literal|0x21c2
block|,
literal|0xcc94
block|,
literal|0x3012
block|,
literal|0xcc95
block|,
literal|0x1392
block|,
literal|0xcc96
block|,
literal|0xd05a
block|,
literal|0xcc97
block|,
literal|0x56a3
block|,
literal|0xcc98
block|,
literal|0xdfba
block|,
literal|0xcc99
block|,
literal|0x383
block|,
literal|0xcc9a
block|,
literal|0x6f72
block|,
literal|0xcc9b
block|,
literal|0x1002
block|,
literal|0xcc9c
block|,
literal|0x28c5
block|,
literal|0xcc9d
block|,
literal|0x3005
block|,
literal|0xcc9e
block|,
literal|0x4178
block|,
literal|0xcc9f
block|,
literal|0x5653
block|,
literal|0xcca0
block|,
literal|0x384
block|,
literal|0xcca1
block|,
literal|0x22b2
block|,
literal|0xcca2
block|,
literal|0x3012
block|,
literal|0xcca3
block|,
literal|0x1002
block|,
literal|0xcca4
block|,
literal|0x2be5
block|,
literal|0xcca5
block|,
literal|0x3005
block|,
literal|0xcca6
block|,
literal|0x41e8
block|,
literal|0xcca7
block|,
literal|0x5653
block|,
literal|0xcca8
block|,
literal|0x382
block|,
literal|0xcca9
block|,
literal|0x002
block|,
literal|0xccaa
block|,
literal|0x4258
block|,
literal|0xccab
block|,
literal|0x2474
block|,
literal|0xccac
block|,
literal|0x3c84
block|,
literal|0xccad
block|,
literal|0x6437
block|,
literal|0xccae
block|,
literal|0xdff4
block|,
literal|0xccaf
block|,
literal|0x6437
block|,
literal|0xccb0
block|,
literal|0x2ff5
block|,
literal|0xccb1
block|,
literal|0x3c05
block|,
literal|0xccb2
block|,
literal|0x8757
block|,
literal|0xccb3
block|,
literal|0xb888
block|,
literal|0xccb4
block|,
literal|0x9787
block|,
literal|0xccb5
block|,
literal|0xdff4
block|,
literal|0xccb6
block|,
literal|0x6724
block|,
literal|0xccb7
block|,
literal|0x866a
block|,
literal|0xccb8
block|,
literal|0x6f72
block|,
literal|0xccb9
block|,
literal|0x1002
block|,
literal|0xccba
block|,
literal|0x2d01
block|,
literal|0xccbb
block|,
literal|0x3011
block|,
literal|0xccbc
block|,
literal|0x1001
block|,
literal|0xccbd
block|,
literal|0xc620
block|,
literal|0xccbe
block|,
literal|0x14e5
block|,
literal|0xccbf
block|,
literal|0xc621
block|,
literal|0xccc0
block|,
literal|0xc53d
block|,
literal|0xccc1
block|,
literal|0xc622
block|,
literal|0xccc2
block|,
literal|0x3cbe
block|,
literal|0xccc3
block|,
literal|0xc623
block|,
literal|0xccc4
block|,
literal|0x4452
block|,
literal|0xccc5
block|,
literal|0xc624
block|,
literal|0xccc6
block|,
literal|0xc5c5
block|,
literal|0xccc7
block|,
literal|0xc625
block|,
literal|0xccc8
block|,
literal|0xe01e
block|,
literal|0xccc9
block|,
literal|0xc627
block|,
literal|0xccca
block|,
literal|0x000
block|,
literal|0xcccb
block|,
literal|0xc628
block|,
literal|0xcccc
block|,
literal|0x000
block|,
literal|0xcccd
block|,
literal|0xc62b
block|,
literal|0xccce
block|,
literal|0x000
block|,
literal|0xcccf
block|,
literal|0xc62c
block|,
literal|0xccd0
block|,
literal|0x000
block|,
literal|0xccd1
block|,
literal|0x000
block|,
literal|0xccd2
block|,
literal|0x2d01
block|,
literal|0xccd3
block|,
literal|0x3011
block|,
literal|0xccd4
block|,
literal|0x1001
block|,
literal|0xccd5
block|,
literal|0xc620
block|,
literal|0xccd6
block|,
literal|0x000
block|,
literal|0xccd7
block|,
literal|0xc621
block|,
literal|0xccd8
block|,
literal|0x000
block|,
literal|0xccd9
block|,
literal|0xc622
block|,
literal|0xccda
block|,
literal|0x0ce
block|,
literal|0xccdb
block|,
literal|0xc623
block|,
literal|0xccdc
block|,
literal|0x07f
block|,
literal|0xccdd
block|,
literal|0xc624
block|,
literal|0xccde
block|,
literal|0x032
block|,
literal|0xccdf
block|,
literal|0xc625
block|,
literal|0xcce0
block|,
literal|0x000
block|,
literal|0xcce1
block|,
literal|0xc627
block|,
literal|0xcce2
block|,
literal|0x000
block|,
literal|0xcce3
block|,
literal|0xc628
block|,
literal|0xcce4
block|,
literal|0x000
block|,
literal|0xcce5
block|,
literal|0xc62b
block|,
literal|0xcce6
block|,
literal|0x000
block|,
literal|0xcce7
block|,
literal|0xc62c
block|,
literal|0xcce8
block|,
literal|0x000
block|,
literal|0xcce9
block|,
literal|0x000
block|,
literal|0xccea
block|,
literal|0x2d01
block|,
literal|0xcceb
block|,
literal|0x3011
block|,
literal|0xccec
block|,
literal|0x1001
block|,
literal|0xcced
block|,
literal|0xc502
block|,
literal|0xccee
block|,
literal|0x609f
block|,
literal|0xccef
block|,
literal|0xc600
block|,
literal|0xccf0
block|,
literal|0x2a6e
block|,
literal|0xccf1
block|,
literal|0xc601
block|,
literal|0xccf2
block|,
literal|0x2a2c
block|,
literal|0xccf3
block|,
literal|0xc60c
block|,
literal|0xccf4
block|,
literal|0x5400
block|,
literal|0xccf5
block|,
literal|0xc710
block|,
literal|0xccf6
block|,
literal|0x700
block|,
literal|0xccf7
block|,
literal|0xc718
block|,
literal|0xccf8
block|,
literal|0x700
block|,
literal|0xccf9
block|,
literal|0xc720
block|,
literal|0xccfa
block|,
literal|0x4700
block|,
literal|0xccfb
block|,
literal|0xc728
block|,
literal|0xccfc
block|,
literal|0x700
block|,
literal|0xccfd
block|,
literal|0xc729
block|,
literal|0xccfe
block|,
literal|0x1207
block|,
literal|0xccff
block|,
literal|0xc801
block|,
literal|0xcd00
block|,
literal|0x7f50
block|,
literal|0xcd01
block|,
literal|0xc802
block|,
literal|0xcd02
block|,
literal|0x7760
block|,
literal|0xcd03
block|,
literal|0xc803
block|,
literal|0xcd04
block|,
literal|0x7fce
block|,
literal|0xcd05
block|,
literal|0xc804
block|,
literal|0xcd06
block|,
literal|0x520e
block|,
literal|0xcd07
block|,
literal|0xc805
block|,
literal|0xcd08
block|,
literal|0x5c11
block|,
literal|0xcd09
block|,
literal|0xc806
block|,
literal|0xcd0a
block|,
literal|0x3c51
block|,
literal|0xcd0b
block|,
literal|0xc807
block|,
literal|0xcd0c
block|,
literal|0x4061
block|,
literal|0xcd0d
block|,
literal|0xc808
block|,
literal|0xcd0e
block|,
literal|0x49c1
block|,
literal|0xcd0f
block|,
literal|0xc809
block|,
literal|0xcd10
block|,
literal|0x3840
block|,
literal|0xcd11
block|,
literal|0xc80a
block|,
literal|0xcd12
block|,
literal|0x000
block|,
literal|0xcd13
block|,
literal|0xc821
block|,
literal|0xcd14
block|,
literal|0x002
block|,
literal|0xcd15
block|,
literal|0xc822
block|,
literal|0xcd16
block|,
literal|0x046
block|,
literal|0xcd17
block|,
literal|0xc844
block|,
literal|0xcd18
block|,
literal|0x182f
block|,
literal|0xcd19
block|,
literal|0xc013
block|,
literal|0xcd1a
block|,
literal|0xf341
block|,
literal|0xcd1b
block|,
literal|0xc01a
block|,
literal|0xcd1c
block|,
literal|0x446
block|,
literal|0xcd1d
block|,
literal|0xc024
block|,
literal|0xcd1e
block|,
literal|0x1000
block|,
literal|0xcd1f
block|,
literal|0xc025
block|,
literal|0xcd20
block|,
literal|0xa00
block|,
literal|0xcd21
block|,
literal|0xc026
block|,
literal|0xcd22
block|,
literal|0xc0c
block|,
literal|0xcd23
block|,
literal|0xc027
block|,
literal|0xcd24
block|,
literal|0xc0c
block|,
literal|0xcd25
block|,
literal|0xc029
block|,
literal|0xcd26
block|,
literal|0x0a0
block|,
literal|0xcd27
block|,
literal|0xc030
block|,
literal|0xcd28
block|,
literal|0xa00
block|,
literal|0xcd29
block|,
literal|0xc03c
block|,
literal|0xcd2a
block|,
literal|0x01c
block|,
literal|0xcd2b
block|,
literal|0x000
block|,
literal|0xcd2c
block|,
literal|0x2b84
block|,
literal|0xcd2d
block|,
literal|0x3c74
block|,
literal|0xcd2e
block|,
literal|0x6435
block|,
literal|0xcd2f
block|,
literal|0xdff4
block|,
literal|0xcd30
block|,
literal|0x6435
block|,
literal|0xcd31
block|,
literal|0x2806
block|,
literal|0xcd32
block|,
literal|0x3006
block|,
literal|0xcd33
block|,
literal|0x8565
block|,
literal|0xcd34
block|,
literal|0x2b24
block|,
literal|0xcd35
block|,
literal|0x3c24
block|,
literal|0xcd36
block|,
literal|0x6436
block|,
literal|0xcd37
block|,
literal|0x1002
block|,
literal|0xcd38
block|,
literal|0x2b24
block|,
literal|0xcd39
block|,
literal|0x3c24
block|,
literal|0xcd3a
block|,
literal|0x6436
block|,
literal|0xcd3b
block|,
literal|0x4045
block|,
literal|0xcd3c
block|,
literal|0x8656
block|,
literal|0xcd3d
block|,
literal|0x1002
block|,
literal|0xcd3e
block|,
literal|0x2807
block|,
literal|0xcd3f
block|,
literal|0x31a7
block|,
literal|0xcd40
block|,
literal|0x20c4
block|,
literal|0xcd41
block|,
literal|0x3c24
block|,
literal|0xcd42
block|,
literal|0x6724
block|,
literal|0xcd43
block|,
literal|0x1002
block|,
literal|0xcd44
block|,
literal|0x2807
block|,
literal|0xcd45
block|,
literal|0x3187
block|,
literal|0xcd46
block|,
literal|0x20c4
block|,
literal|0xcd47
block|,
literal|0x3c24
block|,
literal|0xcd48
block|,
literal|0x6724
block|,
literal|0xcd49
block|,
literal|0x1002
block|,
literal|0xcd4a
block|,
literal|0x2514
block|,
literal|0xcd4b
block|,
literal|0x3c64
block|,
literal|0xcd4c
block|,
literal|0x6436
block|,
literal|0xcd4d
block|,
literal|0xdff4
block|,
literal|0xcd4e
block|,
literal|0x6436
block|,
literal|0xcd4f
block|,
literal|0x1002
block|,
literal|0xcd50
block|,
literal|0x2806
block|,
literal|0xcd51
block|,
literal|0x3cb6
block|,
literal|0xcd52
block|,
literal|0xc161
block|,
literal|0xcd53
block|,
literal|0x6134
block|,
literal|0xcd54
block|,
literal|0x6135
block|,
literal|0xcd55
block|,
literal|0x5443
block|,
literal|0xcd56
block|,
literal|0x303
block|,
literal|0xcd57
block|,
literal|0x6524
block|,
literal|0xcd58
block|,
literal|0x00b
block|,
literal|0xcd59
block|,
literal|0x1002
block|,
literal|0xcd5a
block|,
literal|0xd019
block|,
literal|0xcd5b
block|,
literal|0x2104
block|,
literal|0xcd5c
block|,
literal|0x3c24
block|,
literal|0xcd5d
block|,
literal|0x2105
block|,
literal|0xcd5e
block|,
literal|0x3805
block|,
literal|0xcd5f
block|,
literal|0x6524
block|,
literal|0xcd60
block|,
literal|0xdff4
block|,
literal|0xcd61
block|,
literal|0x4005
block|,
literal|0xcd62
block|,
literal|0x6524
block|,
literal|0xcd63
block|,
literal|0x2e8d
block|,
literal|0xcd64
block|,
literal|0x303d
block|,
literal|0xcd65
block|,
literal|0x5dd3
block|,
literal|0xcd66
block|,
literal|0x306
block|,
literal|0xcd67
block|,
literal|0x2ff7
block|,
literal|0xcd68
block|,
literal|0x38f7
block|,
literal|0xcd69
block|,
literal|0x60b7
block|,
literal|0xcd6a
block|,
literal|0xdffd
block|,
literal|0xcd6b
block|,
literal|0x00a
block|,
literal|0xcd6c
block|,
literal|0x1002
block|,
literal|0xcd6d
block|,
literal|0
block|}
decl_stmt|;
name|int
name|i
decl_stmt|,
name|err
decl_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
operator|&&
name|modtype
operator|==
name|phy_modtype_twinax_long
condition|)
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|preemphasis
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|50
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ARRAY_SIZE
argument_list|(
name|twinax_edc
argument_list|)
operator|&&
operator|!
name|err
condition|;
name|i
operator|+=
literal|2
control|)
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|twinax_edc
index|[
name|i
index|]
argument_list|,
name|twinax_edc
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|phy
operator|->
name|priv
operator|=
name|edc_twinax
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_get_module_type
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|delay_ms
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
name|unsigned
name|int
name|stat
decl_stmt|;
name|v
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2005_GPIO_CTRL
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
condition|)
return|return
name|v
return|;
if|if
condition|(
name|stat
operator|&
operator|(
literal|1
operator|<<
literal|8
operator|)
condition|)
comment|/* module absent */
return|return
name|phy_modtype_none
return|;
return|return
name|ael2xxx_get_module_type
argument_list|(
name|phy
argument_list|,
name|delay_ms
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_intr_enable
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|int
name|err
init|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2005_GPIO_CTRL
argument_list|,
literal|0x200
argument_list|)
decl_stmt|;
return|return
name|err
condition|?
name|err
else|:
name|t3_phy_lasi_intr_enable
argument_list|(
name|phy
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_intr_disable
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|int
name|err
init|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2005_GPIO_CTRL
argument_list|,
literal|0x100
argument_list|)
decl_stmt|;
return|return
name|err
condition|?
name|err
else|:
name|t3_phy_lasi_intr_disable
argument_list|(
name|phy
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_intr_clear
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|int
name|err
init|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2005_GPIO_CTRL
argument_list|,
literal|0xd00
argument_list|)
decl_stmt|;
return|return
name|err
condition|?
name|err
else|:
name|t3_phy_lasi_intr_clear
argument_list|(
name|phy
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_reset
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|wait
parameter_list|)
block|{
specifier|static
name|struct
name|reg_val
name|regs0
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc001
block|,
literal|0
block|,
literal|1
operator|<<
literal|5
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc017
block|,
literal|0
block|,
literal|1
operator|<<
literal|5
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc013
block|,
literal|0xffff
block|,
literal|0xf341
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc210
block|,
literal|0xffff
block|,
literal|0x8000
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc210
block|,
literal|0xffff
block|,
literal|0x8100
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc210
block|,
literal|0xffff
block|,
literal|0x8000
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc210
block|,
literal|0xffff
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|struct
name|reg_val
name|regs1
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xca00
block|,
literal|0xffff
block|,
literal|0x0080
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xca12
block|,
literal|0xffff
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
name|int
name|err
decl_stmt|;
name|unsigned
name|int
name|lasi_ctrl
decl_stmt|;
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|LASI_CTRL
argument_list|,
operator|&
name|lasi_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|err
operator|=
name|t3_phy_reset
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|phy
operator|->
name|priv
operator|=
name|edc_none
expr_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|err
operator|=
name|ael2005_get_module_type
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|<
literal|0
condition|)
return|return
name|err
return|;
name|phy
operator|->
name|modtype
operator|=
operator|(
name|u8
operator|)
name|err
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|phy_modtype_none
condition|)
name|err
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|err
operator|==
name|phy_modtype_twinax
operator|||
name|err
operator|==
name|phy_modtype_twinax_long
condition|)
name|err
operator|=
name|ael2005_setup_twinax_edc
argument_list|(
name|phy
argument_list|,
name|err
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|ael2005_setup_sr_edc
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs1
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
comment|/* reset wipes out interrupts, reenable them if they were on */
if|if
condition|(
name|lasi_ctrl
operator|&
literal|1
condition|)
name|err
operator|=
name|ael2005_intr_enable
argument_list|(
name|phy
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ael2005_intr_handler
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|unsigned
name|int
name|stat
decl_stmt|;
name|int
name|ret
decl_stmt|,
name|edc_needed
decl_stmt|,
name|cause
init|=
literal|0
decl_stmt|;
name|ret
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2005_GPIO_STAT
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
if|if
condition|(
name|stat
operator|&
name|AEL2005_MODDET_IRQ
condition|)
block|{
name|ret
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2005_GPIO_CTRL
argument_list|,
literal|0xd00
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
comment|/* modules have max 300 ms init time after hot plug */
name|ret
operator|=
name|ael2005_get_module_type
argument_list|(
name|phy
argument_list|,
literal|300
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
return|return
name|ret
return|;
name|phy
operator|->
name|modtype
operator|=
operator|(
name|u8
operator|)
name|ret
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|phy_modtype_none
condition|)
name|edc_needed
operator|=
name|phy
operator|->
name|priv
expr_stmt|;
comment|/* on unplug retain EDC */
elseif|else
if|if
condition|(
name|ret
operator|==
name|phy_modtype_twinax
operator|||
name|ret
operator|==
name|phy_modtype_twinax_long
condition|)
name|edc_needed
operator|=
name|edc_twinax
expr_stmt|;
else|else
name|edc_needed
operator|=
name|edc_sr
expr_stmt|;
if|if
condition|(
name|edc_needed
operator|!=
name|phy
operator|->
name|priv
condition|)
block|{
name|ret
operator|=
name|ael2005_reset
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|ret
condition|?
name|ret
else|:
name|cphy_cause_module_change
return|;
block|}
name|cause
operator|=
name|cphy_cause_module_change
expr_stmt|;
block|}
name|ret
operator|=
name|t3_phy_lasi_intr_handler
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
return|return
name|ret
return|;
name|ret
operator||=
name|cause
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
name|ret
operator||=
name|cphy_cause_link_change
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|ael2005_ops
init|=
block|{
ifdef|#
directive|ifdef
name|C99_NOT_SUPPORTED
name|ael2005_reset
block|,
name|ael2005_intr_enable
block|,
name|ael2005_intr_disable
block|,
name|ael2005_intr_clear
block|,
name|ael2005_intr_handler
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|get_link_status_r
block|,
name|ael1002_power_down
block|,
else|#
directive|else
operator|.
name|reset
operator|=
name|ael2005_reset
block|,
operator|.
name|intr_enable
operator|=
name|ael2005_intr_enable
block|,
operator|.
name|intr_disable
operator|=
name|ael2005_intr_disable
block|,
operator|.
name|intr_clear
operator|=
name|ael2005_intr_clear
block|,
operator|.
name|intr_handler
operator|=
name|ael2005_intr_handler
block|,
operator|.
name|get_link_status
operator|=
name|get_link_status_r
block|,
operator|.
name|power_down
operator|=
name|ael1002_power_down
block|,
endif|#
directive|endif
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|t3_ael2005_phy_prep
parameter_list|(
name|pinfo_t
modifier|*
name|pinfo
parameter_list|,
name|int
name|phy_addr
parameter_list|,
specifier|const
name|struct
name|mdio_ops
modifier|*
name|mdio_ops
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
name|struct
name|cphy
modifier|*
name|phy
init|=
operator|&
name|pinfo
operator|->
name|phy
decl_stmt|;
name|cphy_init
argument_list|(
name|phy
argument_list|,
name|pinfo
operator|->
name|adapter
argument_list|,
name|pinfo
argument_list|,
name|phy_addr
argument_list|,
operator|&
name|ael2005_ops
argument_list|,
name|mdio_ops
argument_list|,
name|SUPPORTED_10000baseT_Full
operator||
name|SUPPORTED_AUI
operator||
name|SUPPORTED_FIBRE
operator||
name|SUPPORTED_IRQ
argument_list|,
literal|"10GBASE-R"
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|ael_laser_down
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|err
operator|=
name|ael2005_get_module_type
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|>=
literal|0
condition|)
name|phy
operator|->
name|modtype
operator|=
name|err
expr_stmt|;
return|return
name|t3_mdio_change_bits
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL_OPT_SETTINGS
argument_list|,
literal|0
argument_list|,
literal|1
operator|<<
literal|5
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Setup EDC and other parameters for operation with an optical module.  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_setup_sr_edc
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
specifier|static
name|struct
name|reg_val
name|regs
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xcc01
block|,
literal|0xffff
block|,
literal|0x488a
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xcb1b
block|,
literal|0xffff
block|,
literal|0x0200
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xcb1c
block|,
literal|0xffff
block|,
literal|0x00f0
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xcc06
block|,
literal|0xffff
block|,
literal|0x00e0
block|}
block|,
comment|/* end */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
name|int
name|err
decl_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|50
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|phy
operator|->
name|priv
operator|=
name|edc_sr
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Setup EDC and other parameters for operation with an TWINAX module.  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_setup_twinax_edc
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|modtype
parameter_list|)
block|{
specifier|static
name|struct
name|reg_val
name|uCclock40MHz
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xff28
block|,
literal|0xffff
block|,
literal|0x4001
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xff2a
block|,
literal|0xffff
block|,
literal|0x0002
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|struct
name|reg_val
name|uCclockActivate
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xd000
block|,
literal|0xffff
block|,
literal|0x5200
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|struct
name|reg_val
name|uCactivate
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xd080
block|,
literal|0xffff
block|,
literal|0x0100
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xd092
block|,
literal|0xffff
block|,
literal|0x0000
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
specifier|static
name|u16
name|twinax_edc
index|[]
init|=
block|{
literal|0xd800
block|,
literal|0x4009
block|,
literal|0xd801
block|,
literal|0x2fff
block|,
literal|0xd802
block|,
literal|0x300f
block|,
literal|0xd803
block|,
literal|0x40aa
block|,
literal|0xd804
block|,
literal|0x401c
block|,
literal|0xd805
block|,
literal|0x401e
block|,
literal|0xd806
block|,
literal|0x2ff4
block|,
literal|0xd807
block|,
literal|0x3dc4
block|,
literal|0xd808
block|,
literal|0x2035
block|,
literal|0xd809
block|,
literal|0x3035
block|,
literal|0xd80a
block|,
literal|0x6524
block|,
literal|0xd80b
block|,
literal|0x2cb2
block|,
literal|0xd80c
block|,
literal|0x3012
block|,
literal|0xd80d
block|,
literal|0x1002
block|,
literal|0xd80e
block|,
literal|0x26e2
block|,
literal|0xd80f
block|,
literal|0x3022
block|,
literal|0xd810
block|,
literal|0x1002
block|,
literal|0xd811
block|,
literal|0x27d2
block|,
literal|0xd812
block|,
literal|0x3022
block|,
literal|0xd813
block|,
literal|0x1002
block|,
literal|0xd814
block|,
literal|0x2822
block|,
literal|0xd815
block|,
literal|0x3012
block|,
literal|0xd816
block|,
literal|0x1002
block|,
literal|0xd817
block|,
literal|0x2492
block|,
literal|0xd818
block|,
literal|0x3022
block|,
literal|0xd819
block|,
literal|0x1002
block|,
literal|0xd81a
block|,
literal|0x2772
block|,
literal|0xd81b
block|,
literal|0x3012
block|,
literal|0xd81c
block|,
literal|0x1002
block|,
literal|0xd81d
block|,
literal|0x23d2
block|,
literal|0xd81e
block|,
literal|0x3022
block|,
literal|0xd81f
block|,
literal|0x1002
block|,
literal|0xd820
block|,
literal|0x22cd
block|,
literal|0xd821
block|,
literal|0x301d
block|,
literal|0xd822
block|,
literal|0x27f2
block|,
literal|0xd823
block|,
literal|0x3022
block|,
literal|0xd824
block|,
literal|0x1002
block|,
literal|0xd825
block|,
literal|0x5553
block|,
literal|0xd826
block|,
literal|0x0307
block|,
literal|0xd827
block|,
literal|0x2522
block|,
literal|0xd828
block|,
literal|0x3022
block|,
literal|0xd829
block|,
literal|0x1002
block|,
literal|0xd82a
block|,
literal|0x2142
block|,
literal|0xd82b
block|,
literal|0x3012
block|,
literal|0xd82c
block|,
literal|0x1002
block|,
literal|0xd82d
block|,
literal|0x4016
block|,
literal|0xd82e
block|,
literal|0x5e63
block|,
literal|0xd82f
block|,
literal|0x0344
block|,
literal|0xd830
block|,
literal|0x2142
block|,
literal|0xd831
block|,
literal|0x3012
block|,
literal|0xd832
block|,
literal|0x1002
block|,
literal|0xd833
block|,
literal|0x400e
block|,
literal|0xd834
block|,
literal|0x2522
block|,
literal|0xd835
block|,
literal|0x3022
block|,
literal|0xd836
block|,
literal|0x1002
block|,
literal|0xd837
block|,
literal|0x2b52
block|,
literal|0xd838
block|,
literal|0x3012
block|,
literal|0xd839
block|,
literal|0x1002
block|,
literal|0xd83a
block|,
literal|0x2742
block|,
literal|0xd83b
block|,
literal|0x3022
block|,
literal|0xd83c
block|,
literal|0x1002
block|,
literal|0xd83d
block|,
literal|0x25e2
block|,
literal|0xd83e
block|,
literal|0x3022
block|,
literal|0xd83f
block|,
literal|0x1002
block|,
literal|0xd840
block|,
literal|0x2fa4
block|,
literal|0xd841
block|,
literal|0x3dc4
block|,
literal|0xd842
block|,
literal|0x6624
block|,
literal|0xd843
block|,
literal|0x414b
block|,
literal|0xd844
block|,
literal|0x56b3
block|,
literal|0xd845
block|,
literal|0x03c6
block|,
literal|0xd846
block|,
literal|0x866b
block|,
literal|0xd847
block|,
literal|0x400c
block|,
literal|0xd848
block|,
literal|0x2712
block|,
literal|0xd849
block|,
literal|0x3012
block|,
literal|0xd84a
block|,
literal|0x1002
block|,
literal|0xd84b
block|,
literal|0x2c4b
block|,
literal|0xd84c
block|,
literal|0x309b
block|,
literal|0xd84d
block|,
literal|0x56b3
block|,
literal|0xd84e
block|,
literal|0x03c3
block|,
literal|0xd84f
block|,
literal|0x866b
block|,
literal|0xd850
block|,
literal|0x400c
block|,
literal|0xd851
block|,
literal|0x2272
block|,
literal|0xd852
block|,
literal|0x3022
block|,
literal|0xd853
block|,
literal|0x1002
block|,
literal|0xd854
block|,
literal|0x2742
block|,
literal|0xd855
block|,
literal|0x3022
block|,
literal|0xd856
block|,
literal|0x1002
block|,
literal|0xd857
block|,
literal|0x25e2
block|,
literal|0xd858
block|,
literal|0x3022
block|,
literal|0xd859
block|,
literal|0x1002
block|,
literal|0xd85a
block|,
literal|0x2fb4
block|,
literal|0xd85b
block|,
literal|0x3dc4
block|,
literal|0xd85c
block|,
literal|0x6624
block|,
literal|0xd85d
block|,
literal|0x56b3
block|,
literal|0xd85e
block|,
literal|0x03c3
block|,
literal|0xd85f
block|,
literal|0x866b
block|,
literal|0xd860
block|,
literal|0x401c
block|,
literal|0xd861
block|,
literal|0x2c45
block|,
literal|0xd862
block|,
literal|0x3095
block|,
literal|0xd863
block|,
literal|0x5b53
block|,
literal|0xd864
block|,
literal|0x2372
block|,
literal|0xd865
block|,
literal|0x3012
block|,
literal|0xd866
block|,
literal|0x13c2
block|,
literal|0xd867
block|,
literal|0x5cc3
block|,
literal|0xd868
block|,
literal|0x2712
block|,
literal|0xd869
block|,
literal|0x3012
block|,
literal|0xd86a
block|,
literal|0x1312
block|,
literal|0xd86b
block|,
literal|0x2b52
block|,
literal|0xd86c
block|,
literal|0x3012
block|,
literal|0xd86d
block|,
literal|0x1002
block|,
literal|0xd86e
block|,
literal|0x2742
block|,
literal|0xd86f
block|,
literal|0x3022
block|,
literal|0xd870
block|,
literal|0x1002
block|,
literal|0xd871
block|,
literal|0x2582
block|,
literal|0xd872
block|,
literal|0x3022
block|,
literal|0xd873
block|,
literal|0x1002
block|,
literal|0xd874
block|,
literal|0x2142
block|,
literal|0xd875
block|,
literal|0x3012
block|,
literal|0xd876
block|,
literal|0x1002
block|,
literal|0xd877
block|,
literal|0x628f
block|,
literal|0xd878
block|,
literal|0x2985
block|,
literal|0xd879
block|,
literal|0x33a5
block|,
literal|0xd87a
block|,
literal|0x25e2
block|,
literal|0xd87b
block|,
literal|0x3022
block|,
literal|0xd87c
block|,
literal|0x1002
block|,
literal|0xd87d
block|,
literal|0x5653
block|,
literal|0xd87e
block|,
literal|0x03d2
block|,
literal|0xd87f
block|,
literal|0x401e
block|,
literal|0xd880
block|,
literal|0x6f72
block|,
literal|0xd881
block|,
literal|0x1002
block|,
literal|0xd882
block|,
literal|0x628f
block|,
literal|0xd883
block|,
literal|0x2304
block|,
literal|0xd884
block|,
literal|0x3c84
block|,
literal|0xd885
block|,
literal|0x6436
block|,
literal|0xd886
block|,
literal|0xdff4
block|,
literal|0xd887
block|,
literal|0x6436
block|,
literal|0xd888
block|,
literal|0x2ff5
block|,
literal|0xd889
block|,
literal|0x3005
block|,
literal|0xd88a
block|,
literal|0x8656
block|,
literal|0xd88b
block|,
literal|0xdfba
block|,
literal|0xd88c
block|,
literal|0x56a3
block|,
literal|0xd88d
block|,
literal|0xd05a
block|,
literal|0xd88e
block|,
literal|0x2972
block|,
literal|0xd88f
block|,
literal|0x3012
block|,
literal|0xd890
block|,
literal|0x1392
block|,
literal|0xd891
block|,
literal|0xd05a
block|,
literal|0xd892
block|,
literal|0x56a3
block|,
literal|0xd893
block|,
literal|0xdfba
block|,
literal|0xd894
block|,
literal|0x0383
block|,
literal|0xd895
block|,
literal|0x6f72
block|,
literal|0xd896
block|,
literal|0x1002
block|,
literal|0xd897
block|,
literal|0x2b45
block|,
literal|0xd898
block|,
literal|0x3005
block|,
literal|0xd899
block|,
literal|0x4178
block|,
literal|0xd89a
block|,
literal|0x5653
block|,
literal|0xd89b
block|,
literal|0x0384
block|,
literal|0xd89c
block|,
literal|0x2a62
block|,
literal|0xd89d
block|,
literal|0x3012
block|,
literal|0xd89e
block|,
literal|0x1002
block|,
literal|0xd89f
block|,
literal|0x2f05
block|,
literal|0xd8a0
block|,
literal|0x3005
block|,
literal|0xd8a1
block|,
literal|0x41c8
block|,
literal|0xd8a2
block|,
literal|0x5653
block|,
literal|0xd8a3
block|,
literal|0x0382
block|,
literal|0xd8a4
block|,
literal|0x0002
block|,
literal|0xd8a5
block|,
literal|0x4218
block|,
literal|0xd8a6
block|,
literal|0x2474
block|,
literal|0xd8a7
block|,
literal|0x3c84
block|,
literal|0xd8a8
block|,
literal|0x6437
block|,
literal|0xd8a9
block|,
literal|0xdff4
block|,
literal|0xd8aa
block|,
literal|0x6437
block|,
literal|0xd8ab
block|,
literal|0x2ff5
block|,
literal|0xd8ac
block|,
literal|0x3c05
block|,
literal|0xd8ad
block|,
literal|0x8757
block|,
literal|0xd8ae
block|,
literal|0xb888
block|,
literal|0xd8af
block|,
literal|0x9787
block|,
literal|0xd8b0
block|,
literal|0xdff4
block|,
literal|0xd8b1
block|,
literal|0x6724
block|,
literal|0xd8b2
block|,
literal|0x866a
block|,
literal|0xd8b3
block|,
literal|0x6f72
block|,
literal|0xd8b4
block|,
literal|0x1002
block|,
literal|0xd8b5
block|,
literal|0x2641
block|,
literal|0xd8b6
block|,
literal|0x3021
block|,
literal|0xd8b7
block|,
literal|0x1001
block|,
literal|0xd8b8
block|,
literal|0xc620
block|,
literal|0xd8b9
block|,
literal|0x0000
block|,
literal|0xd8ba
block|,
literal|0xc621
block|,
literal|0xd8bb
block|,
literal|0x0000
block|,
literal|0xd8bc
block|,
literal|0xc622
block|,
literal|0xd8bd
block|,
literal|0x00ce
block|,
literal|0xd8be
block|,
literal|0xc623
block|,
literal|0xd8bf
block|,
literal|0x007f
block|,
literal|0xd8c0
block|,
literal|0xc624
block|,
literal|0xd8c1
block|,
literal|0x0032
block|,
literal|0xd8c2
block|,
literal|0xc625
block|,
literal|0xd8c3
block|,
literal|0x0000
block|,
literal|0xd8c4
block|,
literal|0xc627
block|,
literal|0xd8c5
block|,
literal|0x0000
block|,
literal|0xd8c6
block|,
literal|0xc628
block|,
literal|0xd8c7
block|,
literal|0x0000
block|,
literal|0xd8c8
block|,
literal|0xc62c
block|,
literal|0xd8c9
block|,
literal|0x0000
block|,
literal|0xd8ca
block|,
literal|0x0000
block|,
literal|0xd8cb
block|,
literal|0x2641
block|,
literal|0xd8cc
block|,
literal|0x3021
block|,
literal|0xd8cd
block|,
literal|0x1001
block|,
literal|0xd8ce
block|,
literal|0xc502
block|,
literal|0xd8cf
block|,
literal|0x53ac
block|,
literal|0xd8d0
block|,
literal|0xc503
block|,
literal|0xd8d1
block|,
literal|0x2cd3
block|,
literal|0xd8d2
block|,
literal|0xc600
block|,
literal|0xd8d3
block|,
literal|0x2a6e
block|,
literal|0xd8d4
block|,
literal|0xc601
block|,
literal|0xd8d5
block|,
literal|0x2a2c
block|,
literal|0xd8d6
block|,
literal|0xc605
block|,
literal|0xd8d7
block|,
literal|0x5557
block|,
literal|0xd8d8
block|,
literal|0xc60c
block|,
literal|0xd8d9
block|,
literal|0x5400
block|,
literal|0xd8da
block|,
literal|0xc710
block|,
literal|0xd8db
block|,
literal|0x0700
block|,
literal|0xd8dc
block|,
literal|0xc711
block|,
literal|0xd8dd
block|,
literal|0x0f06
block|,
literal|0xd8de
block|,
literal|0xc718
block|,
literal|0xd8df
block|,
literal|0x0700
block|,
literal|0xd8e0
block|,
literal|0xc719
block|,
literal|0xd8e1
block|,
literal|0x0f06
block|,
literal|0xd8e2
block|,
literal|0xc720
block|,
literal|0xd8e3
block|,
literal|0x4700
block|,
literal|0xd8e4
block|,
literal|0xc721
block|,
literal|0xd8e5
block|,
literal|0x0f06
block|,
literal|0xd8e6
block|,
literal|0xc728
block|,
literal|0xd8e7
block|,
literal|0x0700
block|,
literal|0xd8e8
block|,
literal|0xc729
block|,
literal|0xd8e9
block|,
literal|0x1207
block|,
literal|0xd8ea
block|,
literal|0xc801
block|,
literal|0xd8eb
block|,
literal|0x7f50
block|,
literal|0xd8ec
block|,
literal|0xc802
block|,
literal|0xd8ed
block|,
literal|0x7760
block|,
literal|0xd8ee
block|,
literal|0xc803
block|,
literal|0xd8ef
block|,
literal|0x7fce
block|,
literal|0xd8f0
block|,
literal|0xc804
block|,
literal|0xd8f1
block|,
literal|0x520e
block|,
literal|0xd8f2
block|,
literal|0xc805
block|,
literal|0xd8f3
block|,
literal|0x5c11
block|,
literal|0xd8f4
block|,
literal|0xc806
block|,
literal|0xd8f5
block|,
literal|0x3c51
block|,
literal|0xd8f6
block|,
literal|0xc807
block|,
literal|0xd8f7
block|,
literal|0x4061
block|,
literal|0xd8f8
block|,
literal|0xc808
block|,
literal|0xd8f9
block|,
literal|0x49c1
block|,
literal|0xd8fa
block|,
literal|0xc809
block|,
literal|0xd8fb
block|,
literal|0x3840
block|,
literal|0xd8fc
block|,
literal|0xc80a
block|,
literal|0xd8fd
block|,
literal|0x0000
block|,
literal|0xd8fe
block|,
literal|0xc821
block|,
literal|0xd8ff
block|,
literal|0x0002
block|,
literal|0xd900
block|,
literal|0xc822
block|,
literal|0xd901
block|,
literal|0x0046
block|,
literal|0xd902
block|,
literal|0xc844
block|,
literal|0xd903
block|,
literal|0x182f
block|,
literal|0xd904
block|,
literal|0xc013
block|,
literal|0xd905
block|,
literal|0xf341
block|,
literal|0xd906
block|,
literal|0xc084
block|,
literal|0xd907
block|,
literal|0x0030
block|,
literal|0xd908
block|,
literal|0xc904
block|,
literal|0xd909
block|,
literal|0x1401
block|,
literal|0xd90a
block|,
literal|0xcb0c
block|,
literal|0xd90b
block|,
literal|0x0004
block|,
literal|0xd90c
block|,
literal|0xcb0e
block|,
literal|0xd90d
block|,
literal|0xa00a
block|,
literal|0xd90e
block|,
literal|0xcb0f
block|,
literal|0xd90f
block|,
literal|0xc0c0
block|,
literal|0xd910
block|,
literal|0xcb10
block|,
literal|0xd911
block|,
literal|0xc0c0
block|,
literal|0xd912
block|,
literal|0xcb11
block|,
literal|0xd913
block|,
literal|0x00a0
block|,
literal|0xd914
block|,
literal|0xcb12
block|,
literal|0xd915
block|,
literal|0x0007
block|,
literal|0xd916
block|,
literal|0xc241
block|,
literal|0xd917
block|,
literal|0xa000
block|,
literal|0xd918
block|,
literal|0xc243
block|,
literal|0xd919
block|,
literal|0x7fe0
block|,
literal|0xd91a
block|,
literal|0xc604
block|,
literal|0xd91b
block|,
literal|0x000e
block|,
literal|0xd91c
block|,
literal|0xc609
block|,
literal|0xd91d
block|,
literal|0x00f5
block|,
literal|0xd91e
block|,
literal|0xc611
block|,
literal|0xd91f
block|,
literal|0x000e
block|,
literal|0xd920
block|,
literal|0xc660
block|,
literal|0xd921
block|,
literal|0x9600
block|,
literal|0xd922
block|,
literal|0xc687
block|,
literal|0xd923
block|,
literal|0x0004
block|,
literal|0xd924
block|,
literal|0xc60a
block|,
literal|0xd925
block|,
literal|0x04f5
block|,
literal|0xd926
block|,
literal|0x0000
block|,
literal|0xd927
block|,
literal|0x2641
block|,
literal|0xd928
block|,
literal|0x3021
block|,
literal|0xd929
block|,
literal|0x1001
block|,
literal|0xd92a
block|,
literal|0xc620
block|,
literal|0xd92b
block|,
literal|0x14e5
block|,
literal|0xd92c
block|,
literal|0xc621
block|,
literal|0xd92d
block|,
literal|0xc53d
block|,
literal|0xd92e
block|,
literal|0xc622
block|,
literal|0xd92f
block|,
literal|0x3cbe
block|,
literal|0xd930
block|,
literal|0xc623
block|,
literal|0xd931
block|,
literal|0x4452
block|,
literal|0xd932
block|,
literal|0xc624
block|,
literal|0xd933
block|,
literal|0xc5c5
block|,
literal|0xd934
block|,
literal|0xc625
block|,
literal|0xd935
block|,
literal|0xe01e
block|,
literal|0xd936
block|,
literal|0xc627
block|,
literal|0xd937
block|,
literal|0x0000
block|,
literal|0xd938
block|,
literal|0xc628
block|,
literal|0xd939
block|,
literal|0x0000
block|,
literal|0xd93a
block|,
literal|0xc62c
block|,
literal|0xd93b
block|,
literal|0x0000
block|,
literal|0xd93c
block|,
literal|0x0000
block|,
literal|0xd93d
block|,
literal|0x2b84
block|,
literal|0xd93e
block|,
literal|0x3c74
block|,
literal|0xd93f
block|,
literal|0x6435
block|,
literal|0xd940
block|,
literal|0xdff4
block|,
literal|0xd941
block|,
literal|0x6435
block|,
literal|0xd942
block|,
literal|0x2806
block|,
literal|0xd943
block|,
literal|0x3006
block|,
literal|0xd944
block|,
literal|0x8565
block|,
literal|0xd945
block|,
literal|0x2b24
block|,
literal|0xd946
block|,
literal|0x3c24
block|,
literal|0xd947
block|,
literal|0x6436
block|,
literal|0xd948
block|,
literal|0x1002
block|,
literal|0xd949
block|,
literal|0x2b24
block|,
literal|0xd94a
block|,
literal|0x3c24
block|,
literal|0xd94b
block|,
literal|0x6436
block|,
literal|0xd94c
block|,
literal|0x4045
block|,
literal|0xd94d
block|,
literal|0x8656
block|,
literal|0xd94e
block|,
literal|0x5663
block|,
literal|0xd94f
block|,
literal|0x0302
block|,
literal|0xd950
block|,
literal|0x401e
block|,
literal|0xd951
block|,
literal|0x1002
block|,
literal|0xd952
block|,
literal|0x2807
block|,
literal|0xd953
block|,
literal|0x31a7
block|,
literal|0xd954
block|,
literal|0x20c4
block|,
literal|0xd955
block|,
literal|0x3c24
block|,
literal|0xd956
block|,
literal|0x6724
block|,
literal|0xd957
block|,
literal|0x1002
block|,
literal|0xd958
block|,
literal|0x2807
block|,
literal|0xd959
block|,
literal|0x3187
block|,
literal|0xd95a
block|,
literal|0x20c4
block|,
literal|0xd95b
block|,
literal|0x3c24
block|,
literal|0xd95c
block|,
literal|0x6724
block|,
literal|0xd95d
block|,
literal|0x1002
block|,
literal|0xd95e
block|,
literal|0x24f4
block|,
literal|0xd95f
block|,
literal|0x3c64
block|,
literal|0xd960
block|,
literal|0x6436
block|,
literal|0xd961
block|,
literal|0xdff4
block|,
literal|0xd962
block|,
literal|0x6436
block|,
literal|0xd963
block|,
literal|0x1002
block|,
literal|0xd964
block|,
literal|0x2006
block|,
literal|0xd965
block|,
literal|0x3d76
block|,
literal|0xd966
block|,
literal|0xc161
block|,
literal|0xd967
block|,
literal|0x6134
block|,
literal|0xd968
block|,
literal|0x6135
block|,
literal|0xd969
block|,
literal|0x5443
block|,
literal|0xd96a
block|,
literal|0x0303
block|,
literal|0xd96b
block|,
literal|0x6524
block|,
literal|0xd96c
block|,
literal|0x00fb
block|,
literal|0xd96d
block|,
literal|0x1002
block|,
literal|0xd96e
block|,
literal|0x20d4
block|,
literal|0xd96f
block|,
literal|0x3c24
block|,
literal|0xd970
block|,
literal|0x2025
block|,
literal|0xd971
block|,
literal|0x3005
block|,
literal|0xd972
block|,
literal|0x6524
block|,
literal|0xd973
block|,
literal|0x1002
block|,
literal|0xd974
block|,
literal|0xd019
block|,
literal|0xd975
block|,
literal|0x2104
block|,
literal|0xd976
block|,
literal|0x3c24
block|,
literal|0xd977
block|,
literal|0x2105
block|,
literal|0xd978
block|,
literal|0x3805
block|,
literal|0xd979
block|,
literal|0x6524
block|,
literal|0xd97a
block|,
literal|0xdff4
block|,
literal|0xd97b
block|,
literal|0x4005
block|,
literal|0xd97c
block|,
literal|0x6524
block|,
literal|0xd97d
block|,
literal|0x2e8d
block|,
literal|0xd97e
block|,
literal|0x303d
block|,
literal|0xd97f
block|,
literal|0x2408
block|,
literal|0xd980
block|,
literal|0x35d8
block|,
literal|0xd981
block|,
literal|0x5dd3
block|,
literal|0xd982
block|,
literal|0x0307
block|,
literal|0xd983
block|,
literal|0x8887
block|,
literal|0xd984
block|,
literal|0x63a7
block|,
literal|0xd985
block|,
literal|0x8887
block|,
literal|0xd986
block|,
literal|0x63a7
block|,
literal|0xd987
block|,
literal|0xdffd
block|,
literal|0xd988
block|,
literal|0x00f9
block|,
literal|0xd989
block|,
literal|0x1002
block|,
literal|0xd98a
block|,
literal|0x0000
block|, 	}
decl_stmt|;
name|int
name|i
decl_stmt|,
name|err
decl_stmt|;
comment|/* set uC clock and activate it */
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|uCclock40MHz
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|500
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|uCclockActivate
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|500
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ARRAY_SIZE
argument_list|(
name|twinax_edc
argument_list|)
operator|&&
operator|!
name|err
condition|;
name|i
operator|+=
literal|2
control|)
name|err
operator|=
name|mdio_write
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|twinax_edc
index|[
name|i
index|]
argument_list|,
name|twinax_edc
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
comment|/* activate uC */
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|uCactivate
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|phy
operator|->
name|priv
operator|=
name|edc_twinax
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_comment
comment|/*  * Return Module Type.  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_get_module_type
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|delay_ms
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
name|unsigned
name|int
name|stat
decl_stmt|;
name|v
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2020_GPIO_STAT
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
condition|)
return|return
name|v
return|;
if|if
condition|(
name|stat
operator|&
operator|(
literal|0x1
operator|<<
operator|(
name|AEL2020_GPIO_MODDET
operator|*
literal|4
operator|)
operator|)
condition|)
block|{
comment|/* module absent */
return|return
name|phy_modtype_none
return|;
block|}
return|return
name|ael2xxx_get_module_type
argument_list|(
name|phy
argument_list|,
name|delay_ms
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Enable PHY interrupts.  We enable "Module Detection" interrupts (on any  * state transition) and then generic Link Alarm Status Interrupt (LASI).  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_intr_enable
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|struct
name|reg_val
name|regs
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
name|AEL2020_GPIO_CFG
operator|+
name|AEL2020_GPIO_LSTAT
block|,
literal|0xffff
block|,
literal|0x4
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
name|AEL2020_GPIO_CTRL
block|,
literal|0xffff
block|,
literal|0x8
operator|<<
operator|(
name|AEL2020_GPIO_LSTAT
operator|*
literal|4
operator|)
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
name|AEL2020_GPIO_CTRL
block|,
literal|0xffff
block|,
literal|0x2
operator|<<
operator|(
name|AEL2020_GPIO_MODDET
operator|*
literal|4
operator|)
block|}
block|,
comment|/* end */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
name|int
name|err
decl_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|phy
operator|->
name|caps
operator||=
name|POLL_LINK_1ST_TIME
expr_stmt|;
comment|/* enable standard Link Alarm Status Interrupts */
name|err
operator|=
name|t3_phy_lasi_intr_enable
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Disable PHY interrupts.  The mirror of the above ...  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_intr_disable
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|struct
name|reg_val
name|regs
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
name|AEL2020_GPIO_CTRL
block|,
literal|0xffff
block|,
literal|0xb
operator|<<
operator|(
name|AEL2020_GPIO_LSTAT
operator|*
literal|4
operator|)
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
name|AEL2020_GPIO_CTRL
block|,
literal|0xffff
block|,
literal|0x1
operator|<<
operator|(
name|AEL2020_GPIO_MODDET
operator|*
literal|4
operator|)
block|}
block|,
comment|/* end */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
name|int
name|err
decl_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
comment|/* disable standard Link Alarm Status Interrupts */
return|return
name|t3_phy_lasi_intr_disable
argument_list|(
name|phy
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Clear PHY interrupt state.  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_intr_clear
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|unsigned
name|int
name|stat
decl_stmt|;
name|int
name|err
init|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2020_GPIO_INTR
argument_list|,
operator|&
name|stat
argument_list|)
decl_stmt|;
return|return
name|err
condition|?
name|err
else|:
name|t3_phy_lasi_intr_clear
argument_list|(
name|phy
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Common register settings for the AEL2020 when it comes out of reset.  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|reg_val
name|ael2020_reset_regs
index|[]
init|=
block|{
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xc003
block|,
literal|0xffff
block|,
literal|0x3101
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xcd40
block|,
literal|0xffff
block|,
literal|0x0001
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xff02
block|,
literal|0xffff
block|,
literal|0x0023
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xff03
block|,
literal|0xffff
block|,
literal|0x0000
block|}
block|,
block|{
name|MDIO_DEV_PMA_PMD
block|,
literal|0xff04
block|,
literal|0xffff
block|,
literal|0x0000
block|}
block|,
comment|/* end */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Reset the PHY and put it into a canonical operating state.  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_reset
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|wait
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
name|unsigned
name|int
name|lasi_ctrl
decl_stmt|;
comment|/* grab current interrupt state */
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|LASI_CTRL
argument_list|,
operator|&
name|lasi_ctrl
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|err
operator|=
name|t3_phy_reset
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
literal|125
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|msleep
argument_list|(
literal|100
argument_list|)
expr_stmt|;
comment|/* basic initialization for all module types */
name|phy
operator|->
name|priv
operator|=
name|edc_none
expr_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|ael2020_reset_regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
comment|/* determine module type and perform appropriate initialization */
name|err
operator|=
name|ael2020_get_module_type
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|<
literal|0
condition|)
return|return
name|err
return|;
name|phy
operator|->
name|modtype
operator|=
operator|(
name|u8
operator|)
name|err
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|phy_modtype_none
condition|)
name|err
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|err
operator|==
name|phy_modtype_twinax
operator|||
name|err
operator|==
name|phy_modtype_twinax_long
condition|)
name|err
operator|=
name|ael2020_setup_twinax_edc
argument_list|(
name|phy
argument_list|,
name|err
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|ael2020_setup_sr_edc
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
comment|/* reset wipes out interrupts, reenable them if they were on */
if|if
condition|(
name|lasi_ctrl
operator|&
literal|1
condition|)
name|err
operator|=
name|ael2020_intr_enable
argument_list|(
name|phy
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_comment
comment|/*  * Handle a PHY interrupt.  */
end_comment

begin_function
specifier|static
name|int
name|ael2020_intr_handler
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|)
block|{
name|unsigned
name|int
name|stat
decl_stmt|;
name|int
name|ret
decl_stmt|,
name|edc_needed
decl_stmt|,
name|cause
init|=
literal|0
decl_stmt|;
name|ret
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|AEL2020_GPIO_INTR
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
if|if
condition|(
name|stat
operator|&
operator|(
literal|0x1
operator|<<
name|AEL2020_GPIO_MODDET
operator|)
condition|)
block|{
comment|/* modules have max 300 ms init time after hot plug */
name|ret
operator|=
name|ael2020_get_module_type
argument_list|(
name|phy
argument_list|,
literal|300
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
return|return
name|ret
return|;
name|phy
operator|->
name|modtype
operator|=
operator|(
name|u8
operator|)
name|ret
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|phy_modtype_none
condition|)
name|edc_needed
operator|=
name|phy
operator|->
name|priv
expr_stmt|;
comment|/* on unplug retain EDC */
elseif|else
if|if
condition|(
name|ret
operator|==
name|phy_modtype_twinax
operator|||
name|ret
operator|==
name|phy_modtype_twinax_long
condition|)
name|edc_needed
operator|=
name|edc_twinax
expr_stmt|;
else|else
name|edc_needed
operator|=
name|edc_sr
expr_stmt|;
if|if
condition|(
name|edc_needed
operator|!=
name|phy
operator|->
name|priv
condition|)
block|{
name|ret
operator|=
name|ael2020_reset
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|ret
condition|?
name|ret
else|:
name|cphy_cause_module_change
return|;
block|}
name|cause
operator|=
name|cphy_cause_module_change
expr_stmt|;
block|}
name|ret
operator|=
name|t3_phy_lasi_intr_handler
argument_list|(
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
return|return
name|ret
return|;
name|ret
operator||=
name|cause
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
name|ret
operator||=
name|cphy_cause_link_change
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|ael2020_ops
init|=
block|{
ifdef|#
directive|ifdef
name|C99_NOT_SUPPORTED
name|ael2020_reset
block|,
name|ael2020_intr_enable
block|,
name|ael2020_intr_disable
block|,
name|ael2020_intr_clear
block|,
name|ael2020_intr_handler
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|get_link_status_r
block|,
name|ael1002_power_down
block|,
else|#
directive|else
operator|.
name|reset
operator|=
name|ael2020_reset
block|,
operator|.
name|intr_enable
operator|=
name|ael2020_intr_enable
block|,
operator|.
name|intr_disable
operator|=
name|ael2020_intr_disable
block|,
operator|.
name|intr_clear
operator|=
name|ael2020_intr_clear
block|,
operator|.
name|intr_handler
operator|=
name|ael2020_intr_handler
block|,
operator|.
name|get_link_status
operator|=
name|get_link_status_r
block|,
operator|.
name|power_down
operator|=
name|ael1002_power_down
block|,
endif|#
directive|endif
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|t3_ael2020_phy_prep
parameter_list|(
name|pinfo_t
modifier|*
name|pinfo
parameter_list|,
name|int
name|phy_addr
parameter_list|,
specifier|const
name|struct
name|mdio_ops
modifier|*
name|mdio_ops
parameter_list|)
block|{
name|int
name|err
decl_stmt|;
name|struct
name|cphy
modifier|*
name|phy
init|=
operator|&
name|pinfo
operator|->
name|phy
decl_stmt|;
name|cphy_init
argument_list|(
name|phy
argument_list|,
name|pinfo
operator|->
name|adapter
argument_list|,
name|pinfo
argument_list|,
name|phy_addr
argument_list|,
operator|&
name|ael2020_ops
argument_list|,
name|mdio_ops
argument_list|,
name|SUPPORTED_10000baseT_Full
operator||
name|SUPPORTED_AUI
operator||
name|SUPPORTED_FIBRE
operator||
name|SUPPORTED_IRQ
argument_list|,
literal|"10GBASE-R"
argument_list|)
expr_stmt|;
name|msleep
argument_list|(
literal|125
argument_list|)
expr_stmt|;
name|err
operator|=
name|set_phy_regs
argument_list|(
name|phy
argument_list|,
name|ael2020_reset_regs
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
name|err
operator|=
name|ael2020_get_module_type
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|>=
literal|0
condition|)
name|phy
operator|->
name|modtype
operator|=
name|err
expr_stmt|;
name|ael_laser_down
argument_list|(
name|phy
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Get link status for a 10GBASE-X device.  */
end_comment

begin_function
specifier|static
name|int
name|get_link_status_x
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
modifier|*
name|link_ok
parameter_list|,
name|int
modifier|*
name|speed
parameter_list|,
name|int
modifier|*
name|duplex
parameter_list|,
name|int
modifier|*
name|fc
parameter_list|)
block|{
if|if
condition|(
name|link_ok
condition|)
block|{
name|unsigned
name|int
name|stat0
decl_stmt|,
name|stat1
decl_stmt|,
name|stat2
decl_stmt|;
name|int
name|err
init|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|PMD_RSD
argument_list|,
operator|&
name|stat0
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PCS
argument_list|,
name|PCS_STAT1_X
argument_list|,
operator|&
name|stat1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
condition|)
name|err
operator|=
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_XGXS
argument_list|,
name|XS_LN_STAT
argument_list|,
operator|&
name|stat2
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
operator|*
name|link_ok
operator|=
operator|(
name|stat0
operator|&
operator|(
name|stat1
operator|>>
literal|12
operator|)
operator|&
operator|(
name|stat2
operator|>>
literal|12
operator|)
operator|)
operator|&
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|speed
condition|)
operator|*
name|speed
operator|=
name|SPEED_10000
expr_stmt|;
if|if
condition|(
name|duplex
condition|)
operator|*
name|duplex
operator|=
name|DUPLEX_FULL
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|C99_NOT_SUPPORTED
end_ifdef

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|qt2045_ops
init|=
block|{
name|ael1006_reset
block|,
name|t3_phy_lasi_intr_enable
block|,
name|t3_phy_lasi_intr_disable
block|,
name|t3_phy_lasi_intr_clear
block|,
name|t3_phy_lasi_intr_handler
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|get_link_status_x
block|,
name|ael1002_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|qt2045_ops
init|=
block|{
operator|.
name|reset
operator|=
name|ael1006_reset
block|,
operator|.
name|intr_enable
operator|=
name|t3_phy_lasi_intr_enable
block|,
operator|.
name|intr_disable
operator|=
name|t3_phy_lasi_intr_disable
block|,
operator|.
name|intr_clear
operator|=
name|t3_phy_lasi_intr_clear
block|,
operator|.
name|intr_handler
operator|=
name|t3_phy_lasi_intr_handler
block|,
operator|.
name|get_link_status
operator|=
name|get_link_status_x
block|,
operator|.
name|power_down
operator|=
name|ael1002_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|t3_qt2045_phy_prep
parameter_list|(
name|pinfo_t
modifier|*
name|pinfo
parameter_list|,
name|int
name|phy_addr
parameter_list|,
specifier|const
name|struct
name|mdio_ops
modifier|*
name|mdio_ops
parameter_list|)
block|{
name|unsigned
name|int
name|stat
decl_stmt|;
name|struct
name|cphy
modifier|*
name|phy
init|=
operator|&
name|pinfo
operator|->
name|phy
decl_stmt|;
name|cphy_init
argument_list|(
name|phy
argument_list|,
name|pinfo
operator|->
name|adapter
argument_list|,
name|pinfo
argument_list|,
name|phy_addr
argument_list|,
operator|&
name|qt2045_ops
argument_list|,
name|mdio_ops
argument_list|,
name|SUPPORTED_10000baseT_Full
operator||
name|SUPPORTED_AUI
operator||
name|SUPPORTED_TP
argument_list|,
literal|"10GBASE-CX4"
argument_list|)
expr_stmt|;
comment|/* 	 * Some cards where the PHY is supposed to be at address 0 actually 	 * have it at 1. 	 */
if|if
condition|(
operator|!
name|phy_addr
operator|&&
operator|!
name|mdio_read
argument_list|(
name|phy
argument_list|,
name|MDIO_DEV_PMA_PMD
argument_list|,
name|MII_BMSR
argument_list|,
operator|&
name|stat
argument_list|)
operator|&&
name|stat
operator|==
literal|0xffff
condition|)
name|phy
operator|->
name|addr
operator|=
literal|1
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|xaui_direct_reset
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|wait
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|xaui_direct_get_link_status
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
modifier|*
name|link_ok
parameter_list|,
name|int
modifier|*
name|speed
parameter_list|,
name|int
modifier|*
name|duplex
parameter_list|,
name|int
modifier|*
name|fc
parameter_list|)
block|{
if|if
condition|(
name|link_ok
condition|)
block|{
name|unsigned
name|int
name|status
decl_stmt|;
name|adapter_t
modifier|*
name|adapter
init|=
name|phy
operator|->
name|adapter
decl_stmt|;
name|status
operator|=
name|t3_read_reg
argument_list|(
name|adapter
argument_list|,
name|XGM_REG
argument_list|(
name|A_XGM_SERDES_STAT0
argument_list|,
name|phy
operator|->
name|addr
argument_list|)
argument_list|)
operator||
name|t3_read_reg
argument_list|(
name|adapter
argument_list|,
name|XGM_REG
argument_list|(
name|A_XGM_SERDES_STAT1
argument_list|,
name|phy
operator|->
name|addr
argument_list|)
argument_list|)
operator||
name|t3_read_reg
argument_list|(
name|adapter
argument_list|,
name|XGM_REG
argument_list|(
name|A_XGM_SERDES_STAT2
argument_list|,
name|phy
operator|->
name|addr
argument_list|)
argument_list|)
operator||
name|t3_read_reg
argument_list|(
name|adapter
argument_list|,
name|XGM_REG
argument_list|(
name|A_XGM_SERDES_STAT3
argument_list|,
name|phy
operator|->
name|addr
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|link_ok
operator|=
operator|!
operator|(
name|status
operator|&
name|F_LOWSIG0
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|speed
condition|)
operator|*
name|speed
operator|=
name|SPEED_10000
expr_stmt|;
if|if
condition|(
name|duplex
condition|)
operator|*
name|duplex
operator|=
name|DUPLEX_FULL
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|xaui_direct_power_down
parameter_list|(
name|struct
name|cphy
modifier|*
name|phy
parameter_list|,
name|int
name|enable
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|C99_NOT_SUPPORTED
end_ifdef

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|xaui_direct_ops
init|=
block|{
name|xaui_direct_reset
block|,
name|ael1002_intr_noop
block|,
name|ael1002_intr_noop
block|,
name|ael1002_intr_noop
block|,
name|ael1002_intr_noop
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|xaui_direct_get_link_status
block|,
name|xaui_direct_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_decl_stmt
specifier|static
name|struct
name|cphy_ops
name|xaui_direct_ops
init|=
block|{
operator|.
name|reset
operator|=
name|xaui_direct_reset
block|,
operator|.
name|intr_enable
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|intr_disable
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|intr_clear
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|intr_handler
operator|=
name|ael1002_intr_noop
block|,
operator|.
name|get_link_status
operator|=
name|xaui_direct_get_link_status
block|,
operator|.
name|power_down
operator|=
name|xaui_direct_power_down
block|, }
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|t3_xaui_direct_phy_prep
parameter_list|(
name|pinfo_t
modifier|*
name|pinfo
parameter_list|,
name|int
name|phy_addr
parameter_list|,
specifier|const
name|struct
name|mdio_ops
modifier|*
name|mdio_ops
parameter_list|)
block|{
name|cphy_init
argument_list|(
operator|&
name|pinfo
operator|->
name|phy
argument_list|,
name|pinfo
operator|->
name|adapter
argument_list|,
name|pinfo
argument_list|,
name|phy_addr
argument_list|,
operator|&
name|xaui_direct_ops
argument_list|,
name|mdio_ops
argument_list|,
name|SUPPORTED_10000baseT_Full
operator||
name|SUPPORTED_AUI
operator||
name|SUPPORTED_TP
argument_list|,
literal|"10GBASE-CX4"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

