begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $FreeBSD$  */
end_comment

begin_struct
struct|struct
name|scd_mbx
block|{
name|short
name|retry
decl_stmt|;
name|short
name|nblk
decl_stmt|;
name|int
name|sz
decl_stmt|;
name|u_long
name|skip
decl_stmt|;
name|struct
name|bio
modifier|*
name|bp
decl_stmt|;
name|short
name|count
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scd_data
block|{
name|char
name|double_speed
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|short
name|flags
decl_stmt|;
name|int
name|blksize
decl_stmt|;
name|u_long
name|disksize
decl_stmt|;
name|int
name|openflag
decl_stmt|;
struct|struct
block|{
name|unsigned
name|int
name|adr
range|:
literal|4
decl_stmt|;
name|unsigned
name|int
name|ctl
range|:
literal|4
decl_stmt|;
comment|/* xcdplayer needs this */
name|unsigned
name|char
name|start_msf
index|[
literal|3
index|]
decl_stmt|;
block|}
name|toc
index|[
name|MAX_TRACKS
index|]
struct|;
name|short
name|first_track
decl_stmt|;
name|short
name|last_track
decl_stmt|;
name|struct
name|ioc_play_msf
name|last_play
decl_stmt|;
name|short
name|audio_status
decl_stmt|;
name|struct
name|bio_queue_head
name|head
decl_stmt|;
comment|/* head of bio queue */
name|struct
name|scd_mbx
name|mbx
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scd_softc
block|{
name|device_t
name|dev
decl_stmt|;
name|struct
name|cdev
modifier|*
name|scd_dev_t
decl_stmt|;
name|int
name|debug
decl_stmt|;
name|struct
name|resource
modifier|*
name|port
decl_stmt|;
name|int
name|port_rid
decl_stmt|;
name|int
name|port_type
decl_stmt|;
name|bus_space_tag_t
name|port_bst
decl_stmt|;
name|bus_space_handle_t
name|port_bsh
decl_stmt|;
name|struct
name|mtx
name|mtx
decl_stmt|;
name|struct
name|callout_handle
name|ch
decl_stmt|;
name|int
name|ch_state
decl_stmt|;
name|struct
name|scd_mbx
modifier|*
name|ch_mbxsave
decl_stmt|;
name|struct
name|scd_data
name|data
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SCD_LOCK
parameter_list|(
name|_sc
parameter_list|)
value|splx(&(_sc)->mtx
end_define

begin_define
define|#
directive|define
name|SCD_UNLOCK
parameter_list|(
name|_sc
parameter_list|)
value|splx(&(_sc)->mtx
end_define

begin_define
define|#
directive|define
name|SCD_READ
parameter_list|(
name|_sc
parameter_list|,
name|_reg
parameter_list|)
define|\
value|bus_space_read_1(_sc->port_bst, _sc->port_bsh, _reg)
end_define

begin_define
define|#
directive|define
name|SCD_READ_MULTI
parameter_list|(
name|_sc
parameter_list|,
name|_reg
parameter_list|,
name|_addr
parameter_list|,
name|_count
parameter_list|)
define|\
value|bus_space_read_multi_1(_sc->port_bst, _sc->port_bsh, _reg, _addr, _count)
end_define

begin_define
define|#
directive|define
name|SCD_WRITE
parameter_list|(
name|_sc
parameter_list|,
name|_reg
parameter_list|,
name|_val
parameter_list|)
define|\
value|bus_space_write_1(_sc->port_bst, _sc->port_bsh, _reg, _val)
end_define

begin_function_decl
name|int
name|scd_probe
parameter_list|(
name|struct
name|scd_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scd_attach
parameter_list|(
name|struct
name|scd_softc
modifier|*
parameter_list|)
function_decl|;
end_function_decl

end_unit

