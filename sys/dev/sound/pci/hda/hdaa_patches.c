begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2006 Stephane E. Potvin<sepotvin@videotron.ca>  * Copyright (c) 2006 Ariff Abdullah<ariff@FreeBSD.org>  * Copyright (c) 2008-2012 Alexander Motin<mav@FreeBSD.org>  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * Intel High Definition Audio (Audio function quirks) driver for FreeBSD.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_KERNEL_OPTION_HEADERS
end_ifdef

begin_include
include|#
directive|include
file|"opt_snd.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<dev/sound/pcm/sound.h>
end_include

begin_include
include|#
directive|include
file|<sys/ctype.h>
end_include

begin_include
include|#
directive|include
file|<dev/sound/pci/hda/hdac.h>
end_include

begin_include
include|#
directive|include
file|<dev/sound/pci/hda/hdaa.h>
end_include

begin_include
include|#
directive|include
file|<dev/sound/pci/hda/hda_reg.h>
end_include

begin_expr_stmt
name|SND_DECLARE_FILE
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_struct
specifier|static
specifier|const
struct|struct
block|{
name|uint32_t
name|model
decl_stmt|;
name|uint32_t
name|id
decl_stmt|;
name|uint32_t
name|subsystemid
decl_stmt|;
name|uint32_t
name|set
decl_stmt|,
name|unset
decl_stmt|;
name|uint32_t
name|gpio
decl_stmt|;
block|}
name|hdac_quirks
index|[]
init|=
block|{
comment|/* 	 * XXX Force stereo quirk. Monoural recording / playback 	 *     on few codecs (especially ALC880) seems broken or 	 *     perhaps unsupported. 	 */
block|{
name|HDA_MATCH_ALL
block|,
name|HDA_MATCH_ALL
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_FORCESTEREO
operator||
name|HDAA_QUIRK_IVREF
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|ACER_ALL_SUBVENDOR
block|,
name|HDA_MATCH_ALL
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|ASUS_G2K_SUBVENDOR
block|,
name|HDA_CODEC_ALC660
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|ASUS_M5200_SUBVENDOR
block|,
name|HDA_CODEC_ALC880
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|ASUS_A7M_SUBVENDOR
block|,
name|HDA_CODEC_ALC880
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|ASUS_A7T_SUBVENDOR
block|,
name|HDA_CODEC_ALC882
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|ASUS_W2J_SUBVENDOR
block|,
name|HDA_CODEC_ALC882
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|ASUS_U5F_SUBVENDOR
block|,
name|HDA_CODEC_AD1986A
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_EAPDINV
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|ASUS_A8X_SUBVENDOR
block|,
name|HDA_CODEC_AD1986A
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_EAPDINV
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|ASUS_F3JC_SUBVENDOR
block|,
name|HDA_CODEC_ALC861
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_OVREF
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|UNIWILL_9075_SUBVENDOR
block|,
name|HDA_CODEC_ALC861
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_OVREF
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/*{ ASUS_M2N_SUBVENDOR, HDA_CODEC_AD1988, HDA_MATCH_ALL, 	    HDAA_QUIRK_IVREF80, HDAA_QUIRK_IVREF50 | HDAA_QUIRK_IVREF100, 	    0 },*/
block|{
name|MEDION_MD95257_SUBVENDOR
block|,
name|HDA_CODEC_ALC880
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|1
argument_list|)
block|}
block|,
block|{
name|LENOVO_3KN100_SUBVENDOR
block|,
name|HDA_CODEC_AD1986A
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_EAPDINV
operator||
name|HDAA_QUIRK_SENSEINV
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SAMSUNG_Q1_SUBVENDOR
block|,
name|HDA_CODEC_AD1986A
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_EAPDINV
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|APPLE_MB3_SUBVENDOR
block|,
name|HDA_CODEC_ALC885
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_OVREF50
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|APPLE_INTEL_MAC
block|,
name|HDA_CODEC_STAC9221
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
operator||
name|HDAA_GPIO_SET
argument_list|(
literal|1
argument_list|)
block|}
block|,
block|{
name|APPLE_MACBOOKAIR31
block|,
name|HDA_CODEC_CS4206
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|1
argument_list|)
operator||
name|HDAA_GPIO_SET
argument_list|(
literal|3
argument_list|)
block|}
block|,
block|{
name|APPLE_MACBOOKPRO55
block|,
name|HDA_CODEC_CS4206
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|1
argument_list|)
operator||
name|HDAA_GPIO_SET
argument_list|(
literal|3
argument_list|)
block|}
block|,
block|{
name|APPLE_MACBOOKPRO71
block|,
name|HDA_CODEC_CS4206
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|1
argument_list|)
operator||
name|HDAA_GPIO_SET
argument_list|(
literal|3
argument_list|)
block|}
block|,
block|{
name|HDA_INTEL_MACBOOKPRO92
block|,
name|HDA_CODEC_CS4206
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|1
argument_list|)
operator||
name|HDAA_GPIO_SET
argument_list|(
literal|3
argument_list|)
block|}
block|,
block|{
name|DELL_D630_SUBVENDOR
block|,
name|HDA_CODEC_STAC9205X
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|DELL_V1400_SUBVENDOR
block|,
name|HDA_CODEC_STAC9228X
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|2
argument_list|)
block|}
block|,
block|{
name|DELL_V1500_SUBVENDOR
block|,
name|HDA_CODEC_STAC9205X
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
literal|0
block|,
name|HDAA_GPIO_SET
argument_list|(
literal|0
argument_list|)
block|}
block|,
block|{
name|HDA_MATCH_ALL
block|,
name|HDA_CODEC_AD1988
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_IVREF80
block|,
name|HDAA_QUIRK_IVREF50
operator||
name|HDAA_QUIRK_IVREF100
block|,
literal|0
block|}
block|,
block|{
name|HDA_MATCH_ALL
block|,
name|HDA_CODEC_AD1988B
block|,
name|HDA_MATCH_ALL
block|,
name|HDAA_QUIRK_IVREF80
block|,
name|HDAA_QUIRK_IVREF50
operator||
name|HDAA_QUIRK_IVREF100
block|,
literal|0
block|}
block|,
block|{
name|HDA_MATCH_ALL
block|,
name|HDA_CODEC_CX20549
block|,
name|HDA_MATCH_ALL
block|,
literal|0
block|,
name|HDAA_QUIRK_FORCESTEREO
block|,
literal|0
block|}
block|,
comment|/* Mac Pro 1,1 requires ovref for proper volume level. */
block|{
literal|0x00000000
block|,
name|HDA_CODEC_ALC885
block|,
literal|0x106b0c00
block|,
literal|0
block|,
name|HDAA_QUIRK_OVREF
block|,
literal|0
block|}
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|hdac_pin_patch
parameter_list|(
name|struct
name|hdaa_widget
modifier|*
name|w
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|patch
init|=
name|NULL
decl_stmt|;
name|uint32_t
name|config
decl_stmt|,
name|orig
decl_stmt|,
name|id
decl_stmt|,
name|subid
decl_stmt|;
name|nid_t
name|nid
init|=
name|w
operator|->
name|nid
decl_stmt|;
name|config
operator|=
name|orig
operator|=
name|w
operator|->
name|wclass
operator|.
name|pin
operator|.
name|config
expr_stmt|;
name|id
operator|=
name|hdaa_codec_id
argument_list|(
name|w
operator|->
name|devinfo
argument_list|)
expr_stmt|;
name|subid
operator|=
name|hdaa_card_id
argument_list|(
name|w
operator|->
name|devinfo
argument_list|)
expr_stmt|;
comment|/* XXX: Old patches require complete review. 	 * Now they may create more problem then solve due to 	 * incorrect associations. 	 */
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC880
operator|&&
name|subid
operator|==
name|LG_LW20_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|26
case|:
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_LINE_IN
expr_stmt|;
break|break;
case|case
literal|27
case|:
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_HP_OUT
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC880
operator|&&
operator|(
name|subid
operator|==
name|CLEVO_D900T_SUBVENDOR
operator|||
name|subid
operator|==
name|ASUS_M5200_SUBVENDOR
operator|)
condition|)
block|{
comment|/* 		 * Super broken BIOS 		 */
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|24
case|:
comment|/* MIC1 */
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
expr_stmt|;
break|break;
case|case
literal|25
case|:
comment|/* XXX MIC2 */
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
expr_stmt|;
break|break;
case|case
literal|26
case|:
comment|/* LINE1 */
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_LINE_IN
expr_stmt|;
break|break;
case|case
literal|27
case|:
comment|/* XXX LINE2 */
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_LINE_IN
expr_stmt|;
break|break;
case|case
literal|28
case|:
comment|/* CD */
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_DEVICE_CD
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC883
operator|&&
operator|(
name|subid
operator|==
name|MSI_MS034A_SUBVENDOR
operator|||
name|HDA_DEV_MATCH
argument_list|(
name|ACER_ALL_SUBVENDOR
argument_list|,
name|subid
argument_list|)
operator|)
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|25
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_FIXED
operator|)
expr_stmt|;
break|break;
case|case
literal|28
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_CD
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_FIXED
operator|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_CX20549
operator|&&
name|subid
operator|==
name|HP_V3000_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|18
case|:
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_NONE
expr_stmt|;
break|break;
case|case
literal|20
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_FIXED
operator|)
expr_stmt|;
break|break;
case|case
literal|21
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_CD
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_FIXED
operator|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_CX20551
operator|&&
name|subid
operator|==
name|HP_DV5000_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|20
case|:
case|case
literal|21
case|:
name|config
operator|&=
operator|~
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
expr_stmt|;
name|config
operator||=
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_NONE
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC861
operator|&&
name|subid
operator|==
name|ASUS_W6F_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|11
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_LINE_OUT
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_FIXED
operator|)
expr_stmt|;
break|break;
case|case
literal|12
case|:
case|case
literal|14
case|:
case|case
literal|16
case|:
case|case
literal|31
case|:
case|case
literal|32
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_FIXED
operator|)
expr_stmt|;
break|break;
case|case
literal|15
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_HP_OUT
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_JACK
operator|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC861
operator|&&
name|subid
operator|==
name|UNIWILL_9075_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|15
case|:
name|config
operator|&=
operator|~
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
expr_stmt|;
name|config
operator||=
operator|(
name|HDA_CONFIG_DEFAULTCONF_DEVICE_HP_OUT
operator||
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_JACK
operator|)
expr_stmt|;
break|break;
block|}
block|}
comment|/* New patches */
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_AD1984A
operator|&&
name|subid
operator|==
name|LENOVO_X300_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|17
case|:
comment|/* Headphones with redirection */
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
case|case
literal|20
case|:
comment|/* Two mics together */
name|patch
operator|=
literal|"as=2 seq=15"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_AD1986A
operator|&&
operator|(
name|subid
operator|==
name|ASUS_M2NPVMX_SUBVENDOR
operator|||
name|subid
operator|==
name|ASUS_A8NVMCSM_SUBVENDOR
operator|||
name|subid
operator|==
name|ASUS_P5PL2_SUBVENDOR
operator|)
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|26
case|:
comment|/* Headphones with redirection */
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
case|case
literal|28
case|:
comment|/* 5.1 out => 2.0 out + 1 input */
name|patch
operator|=
literal|"device=Line-in as=8 seq=1"
expr_stmt|;
break|break;
case|case
literal|29
case|:
comment|/* Can't use this as input, as the only available mic 			  * preamplifier is busy by front panel mic (nid 31). 			  * If you want to use this rear connector as mic input, 			  * you have to disable the front panel one. */
name|patch
operator|=
literal|"as=0"
expr_stmt|;
break|break;
case|case
literal|31
case|:
comment|/* Lot of inputs configured with as=15 and unusable */
name|patch
operator|=
literal|"as=8 seq=3"
expr_stmt|;
break|break;
case|case
literal|32
case|:
name|patch
operator|=
literal|"as=8 seq=4"
expr_stmt|;
break|break;
case|case
literal|34
case|:
name|patch
operator|=
literal|"as=8 seq=5"
expr_stmt|;
break|break;
case|case
literal|36
case|:
name|patch
operator|=
literal|"as=8 seq=6"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC260
operator|&&
name|HDA_DEV_MATCH
argument_list|(
name|SONY_S5_SUBVENDOR
argument_list|,
name|subid
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|16
case|:
name|patch
operator|=
literal|"seq=15 device=Headphones"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC268
condition|)
block|{
if|if
condition|(
name|subid
operator|==
name|ACER_T5320_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|20
case|:
comment|/* Headphones Jack */
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_CX20561
operator|&&
name|subid
operator|==
name|LENOVO_B450_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|22
case|:
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_CX20561
operator|&&
name|subid
operator|==
name|LENOVO_T400_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|22
case|:
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
case|case
literal|26
case|:
name|patch
operator|=
literal|"as=1 seq=0"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_CX20590
operator|&&
operator|(
name|subid
operator|==
name|LENOVO_X1_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_X220_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_T420_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_T520_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_G580_SUBVENDOR
operator|)
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|25
case|:
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
comment|/* 		 * Group onboard mic and headphone mic 		 * together.  Fixes onboard mic. 		 */
case|case
literal|27
case|:
name|patch
operator|=
literal|"as=2 seq=15"
expr_stmt|;
break|break;
case|case
literal|35
case|:
name|patch
operator|=
literal|"as=2"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC269
operator|&&
operator|(
name|subid
operator|==
name|LENOVO_X1CRBN_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_T430_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_T430S_SUBVENDOR
operator|||
name|subid
operator|==
name|LENOVO_T530_SUBVENDOR
operator|)
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|21
case|:
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC269
operator|&&
name|subid
operator|==
name|ASUS_UX31A_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|33
case|:
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC892
operator|&&
name|subid
operator|==
name|INTEL_DH87RL_SUBVENDOR
condition|)
block|{
switch|switch
condition|(
name|nid
condition|)
block|{
case|case
literal|27
case|:
name|patch
operator|=
literal|"as=1 seq=15"
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|patch
operator|!=
name|NULL
condition|)
name|config
operator|=
name|hdaa_widget_pin_patch
argument_list|(
name|config
argument_list|,
name|patch
argument_list|)
expr_stmt|;
name|HDA_BOOTVERBOSE
argument_list|(
argument|if (config != orig) 			device_printf(w->devinfo->dev,
literal|"Patching pin config nid=%u 0x%08x -> 0x%08x\n"
argument|, 			    nid, orig, config);
argument_list|)
empty_stmt|;
name|w
operator|->
name|wclass
operator|.
name|pin
operator|.
name|config
operator|=
name|config
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|hdaa_widget_patch
parameter_list|(
name|struct
name|hdaa_widget
modifier|*
name|w
parameter_list|)
block|{
name|struct
name|hdaa_devinfo
modifier|*
name|devinfo
init|=
name|w
operator|->
name|devinfo
decl_stmt|;
name|uint32_t
name|orig
decl_stmt|;
name|nid_t
name|beeper
init|=
operator|-
literal|1
decl_stmt|;
name|orig
operator|=
name|w
operator|->
name|param
operator|.
name|widget_cap
expr_stmt|;
comment|/* On some codecs beeper is an input pin, but it is not recordable 	   alone. Also most of BIOSes does not declare beeper pin. 	   Change beeper pin node type to beeper to help parser. */
switch|switch
condition|(
name|hdaa_codec_id
argument_list|(
name|devinfo
argument_list|)
condition|)
block|{
case|case
name|HDA_CODEC_AD1882
case|:
case|case
name|HDA_CODEC_AD1883
case|:
case|case
name|HDA_CODEC_AD1984
case|:
case|case
name|HDA_CODEC_AD1984A
case|:
case|case
name|HDA_CODEC_AD1984B
case|:
case|case
name|HDA_CODEC_AD1987
case|:
case|case
name|HDA_CODEC_AD1988
case|:
case|case
name|HDA_CODEC_AD1988B
case|:
case|case
name|HDA_CODEC_AD1989B
case|:
name|beeper
operator|=
literal|26
expr_stmt|;
break|break;
case|case
name|HDA_CODEC_ALC260
case|:
name|beeper
operator|=
literal|23
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|hda_get_vendor_id
argument_list|(
name|devinfo
operator|->
name|dev
argument_list|)
operator|==
name|REALTEK_VENDORID
operator|&&
name|hdaa_codec_id
argument_list|(
name|devinfo
argument_list|)
operator|!=
name|HDA_CODEC_ALC260
condition|)
name|beeper
operator|=
literal|29
expr_stmt|;
if|if
condition|(
name|w
operator|->
name|nid
operator|==
name|beeper
condition|)
block|{
name|w
operator|->
name|param
operator|.
name|widget_cap
operator|&=
operator|~
name|HDA_PARAM_AUDIO_WIDGET_CAP_TYPE_MASK
expr_stmt|;
name|w
operator|->
name|param
operator|.
name|widget_cap
operator||=
name|HDA_PARAM_AUDIO_WIDGET_CAP_TYPE_BEEP_WIDGET
operator|<<
name|HDA_PARAM_AUDIO_WIDGET_CAP_TYPE_SHIFT
expr_stmt|;
name|w
operator|->
name|waspin
operator|=
literal|1
expr_stmt|;
block|}
comment|/* 	 * Clear "digital" flag from digital mic input, as its signal then goes 	 * to "analog" mixer and this separation just limits functionaity. 	 */
if|if
condition|(
name|hdaa_codec_id
argument_list|(
name|devinfo
argument_list|)
operator|==
name|HDA_CODEC_AD1984A
operator|&&
name|w
operator|->
name|nid
operator|==
literal|23
condition|)
name|w
operator|->
name|param
operator|.
name|widget_cap
operator|&=
operator|~
name|HDA_PARAM_AUDIO_WIDGET_CAP_DIGITAL_MASK
expr_stmt|;
name|HDA_BOOTVERBOSE
argument_list|(
argument|if (w->param.widget_cap != orig) { 			device_printf(w->devinfo->dev,
literal|"Patching widget caps nid=%u 0x%08x -> 0x%08x\n"
argument|, 			    w->nid, orig, w->param.widget_cap); 		}
argument_list|)
empty_stmt|;
if|if
condition|(
name|w
operator|->
name|type
operator|==
name|HDA_PARAM_AUDIO_WIDGET_CAP_TYPE_PIN_COMPLEX
condition|)
name|hdac_pin_patch
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|hdaa_patch
parameter_list|(
name|struct
name|hdaa_devinfo
modifier|*
name|devinfo
parameter_list|)
block|{
name|struct
name|hdaa_widget
modifier|*
name|w
decl_stmt|;
name|uint32_t
name|id
decl_stmt|,
name|subid
decl_stmt|,
name|subsystemid
decl_stmt|;
name|int
name|i
decl_stmt|;
name|id
operator|=
name|hdaa_codec_id
argument_list|(
name|devinfo
argument_list|)
expr_stmt|;
name|subid
operator|=
name|hdaa_card_id
argument_list|(
name|devinfo
argument_list|)
expr_stmt|;
name|subsystemid
operator|=
name|hda_get_subsystem_id
argument_list|(
name|devinfo
operator|->
name|dev
argument_list|)
expr_stmt|;
comment|/* 	 * Quirks 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nitems
argument_list|(
name|hdac_quirks
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|HDA_DEV_MATCH
argument_list|(
name|hdac_quirks
index|[
name|i
index|]
operator|.
name|model
argument_list|,
name|subid
argument_list|)
operator|&&
name|HDA_DEV_MATCH
argument_list|(
name|hdac_quirks
index|[
name|i
index|]
operator|.
name|id
argument_list|,
name|id
argument_list|)
operator|&&
name|HDA_DEV_MATCH
argument_list|(
name|hdac_quirks
index|[
name|i
index|]
operator|.
name|subsystemid
argument_list|,
name|subsystemid
argument_list|)
operator|)
condition|)
continue|continue;
name|devinfo
operator|->
name|quirks
operator||=
name|hdac_quirks
index|[
name|i
index|]
operator|.
name|set
expr_stmt|;
name|devinfo
operator|->
name|quirks
operator|&=
operator|~
operator|(
name|hdac_quirks
index|[
name|i
index|]
operator|.
name|unset
operator|)
expr_stmt|;
name|devinfo
operator|->
name|gpio
operator|=
name|hdac_quirks
index|[
name|i
index|]
operator|.
name|gpio
expr_stmt|;
block|}
comment|/* Apply per-widget patch. */
for|for
control|(
name|i
operator|=
name|devinfo
operator|->
name|startnode
init|;
name|i
operator|<
name|devinfo
operator|->
name|endnode
condition|;
name|i
operator|++
control|)
block|{
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|==
name|NULL
condition|)
continue|continue;
name|hdaa_widget_patch
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|id
condition|)
block|{
case|case
name|HDA_CODEC_AD1983
case|:
comment|/* 		 * This CODEC has several possible usages, but none 		 * fit the parser best. Help parser to choose better. 		 */
comment|/* Disable direct unmixed playback to get pcm volume. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|11
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
comment|/* Disable mic and line selectors. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|12
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|13
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
comment|/* Disable recording from mono playback mix. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|20
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|HDA_CODEC_AD1986A
case|:
comment|/* 		 * This CODEC has overcomplicated input mixing. 		 * Make some cleaning there. 		 */
comment|/* Disable input mono mixer. Not needed and not supported. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|43
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|enable
operator|=
literal|0
expr_stmt|;
comment|/* Disable any with any input mixing mesh. Use separately. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|39
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|enable
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|40
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|enable
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|41
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|enable
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|42
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|enable
operator|=
literal|0
expr_stmt|;
comment|/* Disable duplicate mixer node connector. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|15
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
comment|/* There is only one mic preamplifier, use it effectively. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|31
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|w
operator|->
name|wclass
operator|.
name|pin
operator|.
name|config
operator|&
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator|)
operator|==
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
condition|)
block|{
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|15
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|32
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|w
operator|->
name|wclass
operator|.
name|pin
operator|.
name|config
operator|&
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MASK
operator|)
operator|==
name|HDA_CONFIG_DEFAULTCONF_DEVICE_MIC_IN
condition|)
block|{
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|15
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
name|subid
operator|==
name|ASUS_A8X_SUBVENDOR
condition|)
block|{
comment|/* 			 * This is just plain ridiculous.. There 			 * are several A8 series that share the same 			 * pci id but works differently (EAPD). 			 */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|26
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
operator|&&
name|w
operator|->
name|type
operator|==
name|HDA_PARAM_AUDIO_WIDGET_CAP_TYPE_PIN_COMPLEX
operator|&&
operator|(
name|w
operator|->
name|wclass
operator|.
name|pin
operator|.
name|config
operator|&
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_MASK
operator|)
operator|!=
name|HDA_CONFIG_DEFAULTCONF_CONNECTIVITY_NONE
condition|)
name|devinfo
operator|->
name|quirks
operator|&=
operator|~
name|HDAA_QUIRK_EAPDINV
expr_stmt|;
block|}
break|break;
case|case
name|HDA_CODEC_AD1981HD
case|:
comment|/* 		 * This CODEC has very unusual design with several 		 * points inappropriate for the present parser. 		 */
comment|/* Disable recording from mono playback mix. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|21
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
comment|/* Disable rear to front mic mixer, use separately. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|31
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|enable
operator|=
literal|0
expr_stmt|;
comment|/* Disable direct playback, use mixer. */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|9
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|24
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|HDA_CODEC_ALC269
case|:
comment|/* 		 * ASUS EeePC 1001px has strange variant of ALC269 CODEC, 		 * that mutes speaker if unused mixer at NID 15 is muted. 		 * Probably CODEC incorrectly reports internal connections. 		 * Hide that muter from the driver.  There are several CODECs 		 * sharing this ID and I have not enough information about 		 * them to implement more universal solution. 		 */
if|if
condition|(
name|subid
operator|==
literal|0x84371043
condition|)
block|{
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|15
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|param
operator|.
name|inamp_cap
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
name|HDA_CODEC_CX20582
case|:
case|case
name|HDA_CODEC_CX20583
case|:
case|case
name|HDA_CODEC_CX20584
case|:
case|case
name|HDA_CODEC_CX20585
case|:
case|case
name|HDA_CODEC_CX20590
case|:
comment|/* 		 * These codecs have extra connectivity on record side 		 * too reach for the present parser. 		 */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|20
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|21
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|22
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|connsenable
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|HDA_CODEC_VT1708S_0
case|:
case|case
name|HDA_CODEC_VT1708S_1
case|:
case|case
name|HDA_CODEC_VT1708S_2
case|:
case|case
name|HDA_CODEC_VT1708S_3
case|:
case|case
name|HDA_CODEC_VT1708S_4
case|:
case|case
name|HDA_CODEC_VT1708S_5
case|:
case|case
name|HDA_CODEC_VT1708S_6
case|:
case|case
name|HDA_CODEC_VT1708S_7
case|:
comment|/* 		 * These codecs have hidden mic boost controls. 		 */
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|26
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|param
operator|.
name|inamp_cap
operator|=
operator|(
literal|40
operator|<<
name|HDA_PARAM_OUTPUT_AMP_CAP_STEPSIZE_SHIFT
operator|)
operator||
operator|(
literal|3
operator|<<
name|HDA_PARAM_OUTPUT_AMP_CAP_NUMSTEPS_SHIFT
operator|)
operator||
operator|(
literal|0
operator|<<
name|HDA_PARAM_OUTPUT_AMP_CAP_OFFSET_SHIFT
operator|)
expr_stmt|;
name|w
operator|=
name|hdaa_widget_get
argument_list|(
name|devinfo
argument_list|,
literal|30
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|NULL
condition|)
name|w
operator|->
name|param
operator|.
name|inamp_cap
operator|=
operator|(
literal|40
operator|<<
name|HDA_PARAM_OUTPUT_AMP_CAP_STEPSIZE_SHIFT
operator|)
operator||
operator|(
literal|3
operator|<<
name|HDA_PARAM_OUTPUT_AMP_CAP_NUMSTEPS_SHIFT
operator|)
operator||
operator|(
literal|0
operator|<<
name|HDA_PARAM_OUTPUT_AMP_CAP_OFFSET_SHIFT
operator|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
name|void
name|hdaa_patch_direct
parameter_list|(
name|struct
name|hdaa_devinfo
modifier|*
name|devinfo
parameter_list|)
block|{
name|device_t
name|dev
init|=
name|devinfo
operator|->
name|dev
decl_stmt|;
name|uint32_t
name|id
decl_stmt|,
name|subid
decl_stmt|,
name|val
decl_stmt|;
name|id
operator|=
name|hdaa_codec_id
argument_list|(
name|devinfo
argument_list|)
expr_stmt|;
name|subid
operator|=
name|hdaa_card_id
argument_list|(
name|devinfo
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|id
condition|)
block|{
case|case
name|HDA_CODEC_VT1708S_0
case|:
case|case
name|HDA_CODEC_VT1708S_1
case|:
case|case
name|HDA_CODEC_VT1708S_2
case|:
case|case
name|HDA_CODEC_VT1708S_3
case|:
case|case
name|HDA_CODEC_VT1708S_4
case|:
case|case
name|HDA_CODEC_VT1708S_5
case|:
case|case
name|HDA_CODEC_VT1708S_6
case|:
case|case
name|HDA_CODEC_VT1708S_7
case|:
comment|/* Enable Mic Boost Volume controls. */
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_12BIT
argument_list|(
literal|0
argument_list|,
name|devinfo
operator|->
name|nid
argument_list|,
literal|0xf98
argument_list|,
literal|0x01
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fall though */
case|case
name|HDA_CODEC_VT1818S
case|:
comment|/* Don't bypass mixer. */
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_12BIT
argument_list|(
literal|0
argument_list|,
name|devinfo
operator|->
name|nid
argument_list|,
literal|0xf88
argument_list|,
literal|0xc0
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|subid
operator|==
name|APPLE_INTEL_MAC
condition|)
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_12BIT
argument_list|(
literal|0
argument_list|,
name|devinfo
operator|->
name|nid
argument_list|,
literal|0x7e7
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
name|HDA_CODEC_ALC269
condition|)
block|{
if|if
condition|(
name|subid
operator|==
literal|0x16e31043
operator|||
name|subid
operator|==
literal|0x831a1043
operator|||
name|subid
operator|==
literal|0x834a1043
operator|||
name|subid
operator|==
literal|0x83981043
operator|||
name|subid
operator|==
literal|0x83ce1043
condition|)
block|{
comment|/* 			 * The ditital mics on some Asus laptops produce 			 * differential signals instead of expected stereo. 			 * That results in silence if downmix it to mono. 			 * To workaround, make codec to handle signal as mono. 			 */
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_SET_COEFF_INDEX
argument_list|(
literal|0
argument_list|,
literal|0x20
argument_list|,
literal|0x07
argument_list|)
argument_list|)
expr_stmt|;
name|val
operator|=
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_GET_PROCESSING_COEFF
argument_list|(
literal|0
argument_list|,
literal|0x20
argument_list|)
argument_list|)
expr_stmt|;
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_SET_COEFF_INDEX
argument_list|(
literal|0
argument_list|,
literal|0x20
argument_list|,
literal|0x07
argument_list|)
argument_list|)
expr_stmt|;
name|hda_command
argument_list|(
name|dev
argument_list|,
name|HDA_CMD_SET_PROCESSING_COEFF
argument_list|(
literal|0
argument_list|,
literal|0x20
argument_list|,
name|val
operator||
literal|0x80
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

end_unit

