begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2009 Yahoo! Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* Debugging tables for MPT2 */
end_comment

begin_comment
comment|/* TODO Move headers to mpsvar */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/selinfo.h>
end_include

begin_include
include|#
directive|include
file|<sys/module.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<sys/conf.h>
end_include

begin_include
include|#
directive|include
file|<sys/bio.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/uio.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_include
include|#
directive|include
file|<sys/kthread.h>
end_include

begin_include
include|#
directive|include
file|<sys/taskqueue.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/resource.h>
end_include

begin_include
include|#
directive|include
file|<sys/rman.h>
end_include

begin_include
include|#
directive|include
file|<cam/scsi/scsi_all.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpi/mpi2_type.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpi/mpi2.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpi/mpi2_ioc.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpi/mpi2_cnfg.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpi/mpi2_init.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpi/mpi2_tool.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mps_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mpsvar.h>
end_include

begin_include
include|#
directive|include
file|<dev/mps/mps_table.h>
end_include

begin_function
name|char
modifier|*
name|mps_describe_table
parameter_list|(
name|struct
name|mps_table_lookup
modifier|*
name|table
parameter_list|,
name|u_int
name|code
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|table
index|[
name|i
index|]
operator|.
name|string
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|table
index|[
name|i
index|]
operator|.
name|code
operator|==
name|code
condition|)
return|return
operator|(
name|table
index|[
name|i
index|]
operator|.
name|string
operator|)
return|;
block|}
return|return
operator|(
name|table
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|string
operator|)
return|;
block|}
end_function

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_event_names
index|[]
init|=
block|{
block|{
literal|"LogData"
block|,
literal|0x01
block|}
block|,
block|{
literal|"StateChange"
block|,
literal|0x02
block|}
block|,
block|{
literal|"HardResetReceived"
block|,
literal|0x05
block|}
block|,
block|{
literal|"EventChange"
block|,
literal|0x0a
block|}
block|,
block|{
literal|"TaskSetFull"
block|,
literal|0x0e
block|}
block|,
block|{
literal|"SasDeviceStatusChange"
block|,
literal|0x0f
block|}
block|,
block|{
literal|"IrOperationStatus"
block|,
literal|0x14
block|}
block|,
block|{
literal|"SasDiscovery"
block|,
literal|0x16
block|}
block|,
block|{
literal|"SasBroadcastPrimitive"
block|,
literal|0x17
block|}
block|,
block|{
literal|"SasInitDeviceStatusChange"
block|,
literal|0x18
block|}
block|,
block|{
literal|"SasInitTableOverflow"
block|,
literal|0x19
block|}
block|,
block|{
literal|"SasTopologyChangeList"
block|,
literal|0x1c
block|}
block|,
block|{
literal|"SasEnclDeviceStatusChange"
block|,
literal|0x1d
block|}
block|,
block|{
literal|"IrVolume"
block|,
literal|0x1e
block|}
block|,
block|{
literal|"IrPhysicalDisk"
block|,
literal|0x1f
block|}
block|,
block|{
literal|"IrConfigurationChangeList"
block|,
literal|0x20
block|}
block|,
block|{
literal|"LogEntryAdded"
block|,
literal|0x21
block|}
block|,
block|{
literal|"SasPhyCounter"
block|,
literal|0x22
block|}
block|,
block|{
literal|"GpioInterrupt"
block|,
literal|0x23
block|}
block|,
block|{
literal|"HbdPhyEvent"
block|,
literal|0x24
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Unknown Event"
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_phystatus_names
index|[]
init|=
block|{
block|{
literal|"NewTargetAdded"
block|,
literal|0x01
block|}
block|,
block|{
literal|"TargetGone"
block|,
literal|0x02
block|}
block|,
block|{
literal|"PHYLinkStatusChange"
block|,
literal|0x03
block|}
block|,
block|{
literal|"PHYLinkStatusUnchanged"
block|,
literal|0x04
block|}
block|,
block|{
literal|"TargetMissing"
block|,
literal|0x05
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Unknown Status"
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_linkrate_names
index|[]
init|=
block|{
block|{
literal|"PHY disabled"
block|,
literal|0x01
block|}
block|,
block|{
literal|"Speed Negotiation Failed"
block|,
literal|0x02
block|}
block|,
block|{
literal|"SATA OOB Complete"
block|,
literal|0x03
block|}
block|,
block|{
literal|"SATA Port Selector"
block|,
literal|0x04
block|}
block|,
block|{
literal|"SMP Reset in Progress"
block|,
literal|0x05
block|}
block|,
block|{
literal|"1.5Gbps"
block|,
literal|0x08
block|}
block|,
block|{
literal|"3.0Gbps"
block|,
literal|0x09
block|}
block|,
block|{
literal|"6.0Gbps"
block|,
literal|0x0a
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"LinkRate Unknown"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_sasdev0_devtype
index|[]
init|=
block|{
block|{
literal|"End Device"
block|,
literal|0x01
block|}
block|,
block|{
literal|"Edge Expander"
block|,
literal|0x02
block|}
block|,
block|{
literal|"Fanout Expander"
block|,
literal|0x03
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"No Device"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_phyinfo_reason_names
index|[]
init|=
block|{
block|{
literal|"Power On"
block|,
literal|0x01
block|}
block|,
block|{
literal|"Hard Reset"
block|,
literal|0x02
block|}
block|,
block|{
literal|"SMP Phy Control Link Reset"
block|,
literal|0x03
block|}
block|,
block|{
literal|"Loss DWORD Sync"
block|,
literal|0x04
block|}
block|,
block|{
literal|"Multiplex Sequence"
block|,
literal|0x05
block|}
block|,
block|{
literal|"I-T Nexus Loss Timer"
block|,
literal|0x06
block|}
block|,
block|{
literal|"Break Timeout Timer"
block|,
literal|0x07
block|}
block|,
block|{
literal|"PHY Test Function"
block|,
literal|0x08
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Unknown Reason"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_whoinit_names
index|[]
init|=
block|{
block|{
literal|"System BIOS"
block|,
literal|0x01
block|}
block|,
block|{
literal|"ROM BIOS"
block|,
literal|0x02
block|}
block|,
block|{
literal|"PCI Peer"
block|,
literal|0x03
block|}
block|,
block|{
literal|"Host Driver"
block|,
literal|0x04
block|}
block|,
block|{
literal|"Manufacturing"
block|,
literal|0x05
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Not Initialized"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_sasdisc_reason
index|[]
init|=
block|{
block|{
literal|"Discovery Started"
block|,
literal|0x01
block|}
block|,
block|{
literal|"Discovery Complete"
block|,
literal|0x02
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Unknown"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_sastopo_exp
index|[]
init|=
block|{
block|{
literal|"Added"
block|,
literal|0x01
block|}
block|,
block|{
literal|"Not Responding"
block|,
literal|0x02
block|}
block|,
block|{
literal|"Responding"
block|,
literal|0x03
block|}
block|,
block|{
literal|"Delay Not Responding"
block|,
literal|0x04
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Unknown"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mps_table_lookup
name|mps_sasdev_reason
index|[]
init|=
block|{
block|{
literal|"SMART Data"
block|,
literal|0x05
block|}
block|,
block|{
literal|"Unsupported"
block|,
literal|0x07
block|}
block|,
block|{
literal|"Internal Device Reset"
block|,
literal|0x08
block|}
block|,
block|{
literal|"Task Abort Internal"
block|,
literal|0x09
block|}
block|,
block|{
literal|"Abort Task Set Internal"
block|,
literal|0x0a
block|}
block|,
block|{
literal|"Clear Task Set Internal"
block|,
literal|0x0b
block|}
block|,
block|{
literal|"Query Task Internal"
block|,
literal|0x0c
block|}
block|,
block|{
literal|"Async Notification"
block|,
literal|0x0d
block|}
block|,
block|{
literal|"Cmp Internal Device Reset"
block|,
literal|0x0e
block|}
block|,
block|{
literal|"Cmp Task Abort Internal"
block|,
literal|0x0f
block|}
block|,
block|{
literal|"Sata Init Failure"
block|,
literal|0x10
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|"Unknown"
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|mps_describe_devinfo
parameter_list|(
name|uint32_t
name|devinfo
parameter_list|,
name|char
modifier|*
name|string
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|snprintf
argument_list|(
name|string
argument_list|,
name|len
argument_list|,
literal|"%b,%s"
argument_list|,
name|devinfo
argument_list|,
literal|"\20"
literal|"\4SataHost"
literal|"\5SmpInit"
literal|"\6StpInit"
literal|"\7SspInit"
literal|"\10SataDev"
literal|"\11SmpTarg"
literal|"\12StpTarg"
literal|"\13SspTarg"
literal|"\14Direct"
literal|"\15LsiDev"
literal|"\16AtapiDev"
literal|"\17SepDev"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sasdev0_devtype
argument_list|,
name|devinfo
operator|&
literal|0x03
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_iocfacts
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_IOC_FACTS_REPLY
modifier|*
name|facts
parameter_list|)
block|{
name|MPS_PRINTFIELD_START
argument_list|(
name|sc
argument_list|,
literal|"IOCFacts"
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MsgVersion
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|HeaderVersion
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|IOCNumber
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|IOCExceptions
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxChainDepth
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"WhoInit: %s\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_whoinit_names
argument_list|,
name|facts
operator|->
name|WhoInit
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|NumberOfPorts
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|RequestCredit
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|ProductID
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"IOCCapabilities: %b\n"
argument_list|,
name|facts
operator|->
name|IOCCapabilities
argument_list|,
literal|"\20"
literal|"\3ScsiTaskFull"
literal|"\4DiagTrace"
literal|"\5SnapBuf"
literal|"\6ExtBuf"
literal|"\7EEDP"
literal|"\10BiDirTarg"
literal|"\11Multicast"
literal|"\14TransRetry"
literal|"\15IR"
literal|"\16EventReplay"
literal|"\17RaidAccel"
literal|"\20MSIXIndex"
literal|"\21HostDisc"
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"FWVersion= %d-%d-%d-%d\n"
argument_list|,
name|facts
operator|->
name|FWVersion
operator|.
name|Struct
operator|.
name|Major
argument_list|,
name|facts
operator|->
name|FWVersion
operator|.
name|Struct
operator|.
name|Minor
argument_list|,
name|facts
operator|->
name|FWVersion
operator|.
name|Struct
operator|.
name|Unit
argument_list|,
name|facts
operator|->
name|FWVersion
operator|.
name|Struct
operator|.
name|Dev
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|IOCRequestFrameSize
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxInitiators
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxTargets
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxSasExpanders
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxEnclosures
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"ProtocolFlags: %b\n"
argument_list|,
name|facts
operator|->
name|ProtocolFlags
argument_list|,
literal|"\20"
literal|"\1ScsiTarg"
literal|"\2ScsiInit"
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|HighPriorityCredit
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxReplyDescriptorPostQueueDepth
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|ReplyFrameSize
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxVolumes
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxDevHandle
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxPersistentEntries
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_portfacts
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_PORT_FACTS_REPLY
modifier|*
name|facts
parameter_list|)
block|{
name|MPS_PRINTFIELD_START
argument_list|(
name|sc
argument_list|,
literal|"PortFacts"
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|PortNumber
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|PortType
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|facts
argument_list|,
name|MaxPostedCmdBuffers
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_event
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_EVENT_NOTIFICATION_REPLY
modifier|*
name|event
parameter_list|)
block|{
name|MPS_EVENTFIELD_START
argument_list|(
name|sc
argument_list|,
literal|"EventReply"
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|event
argument_list|,
name|EventDataLength
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|event
argument_list|,
name|AckRequired
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"Event: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_event_names
argument_list|,
name|event
operator|->
name|Event
argument_list|)
argument_list|,
name|event
operator|->
name|Event
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|event
argument_list|,
name|EventContext
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_sasdev0
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_CONFIG_PAGE_SAS_DEV_0
modifier|*
name|buf
parameter_list|)
block|{
name|MPS_PRINTFIELD_START
argument_list|(
name|sc
argument_list|,
literal|"SAS Device Page 0"
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|Slot
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|EnclosureHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"SASAddress: 0x%jx\n"
argument_list|,
name|mps_to_u64
argument_list|(
operator|&
name|buf
operator|->
name|SASAddress
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ParentDevHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|PhyNum
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AccessStatus
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|DevHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AttachedPhyIdentifier
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ZoneGroup
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"DeviceInfo: %b,%s\n"
argument_list|,
name|buf
operator|->
name|DeviceInfo
argument_list|,
literal|"\20"
literal|"\4SataHost"
literal|"\5SmpInit"
literal|"\6StpInit"
literal|"\7SspInit"
literal|"\10SataDev"
literal|"\11SmpTarg"
literal|"\12StpTarg"
literal|"\13SspTarg"
literal|"\14Direct"
literal|"\15LsiDev"
literal|"\16AtapiDev"
literal|"\17SepDev"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sasdev0_devtype
argument_list|,
name|buf
operator|->
name|DeviceInfo
operator|&
literal|0x03
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|Flags
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|PhysicalPort
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|MaxPortConnections
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"DeviceName: 0x%jx\n"
argument_list|,
name|mps_to_u64
argument_list|(
operator|&
name|buf
operator|->
name|DeviceName
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|PortGroups
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|DmaGroup
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ControlGroup
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_evt_sas
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_EVENT_NOTIFICATION_REPLY
modifier|*
name|event
parameter_list|)
block|{
name|mps_print_event
argument_list|(
name|sc
argument_list|,
name|event
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|Event
condition|)
block|{
case|case
name|MPI2_EVENT_SAS_DISCOVERY
case|:
block|{
name|MPI2_EVENT_DATA_SAS_DISCOVERY
modifier|*
name|data
decl_stmt|;
name|data
operator|=
operator|(
name|MPI2_EVENT_DATA_SAS_DISCOVERY
operator|*
operator|)
operator|&
name|event
operator|->
name|EventData
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"Flags: %b\n"
argument_list|,
name|data
operator|->
name|Flags
argument_list|,
literal|"\20"
literal|"\1InProgress"
literal|"\2DeviceChange"
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"ReasonCode: %s\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sasdisc_reason
argument_list|,
name|data
operator|->
name|ReasonCode
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|PhysicalPort
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"DiscoveryStatus: %b\n"
argument_list|,
name|data
operator|->
name|DiscoveryStatus
argument_list|,
literal|"\20"
literal|"\1Loop"
literal|"\2UnaddressableDev"
literal|"\3DupSasAddr"
literal|"\5SmpTimeout"
literal|"\6ExpRouteFull"
literal|"\7RouteIndexError"
literal|"\10SmpFailed"
literal|"\11SmpCrcError"
literal|"\12SubSubLink"
literal|"\13TableTableLink"
literal|"\14UnsupDevice"
literal|"\15TableSubLink"
literal|"\16MultiDomain"
literal|"\17MultiSub"
literal|"\20MultiSubSub"
literal|"\34DownstreamInit"
literal|"\35MaxPhys"
literal|"\36MaxTargs"
literal|"\37MaxExpanders"
literal|"\40MaxEnclosures"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|MPI2_EVENT_SAS_TOPOLOGY_CHANGE_LIST
case|:
block|{
name|MPI2_EVENT_DATA_SAS_TOPOLOGY_CHANGE_LIST
modifier|*
name|data
decl_stmt|;
name|MPI2_EVENT_SAS_TOPO_PHY_ENTRY
modifier|*
name|phy
decl_stmt|;
name|int
name|i
decl_stmt|,
name|phynum
decl_stmt|;
name|data
operator|=
operator|(
name|MPI2_EVENT_DATA_SAS_TOPOLOGY_CHANGE_LIST
operator|*
operator|)
operator|&
name|event
operator|->
name|EventData
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|EnclosureHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|ExpanderDevHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|NumPhys
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|NumEntries
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|StartPhyNum
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"ExpStatus: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sastopo_exp
argument_list|,
name|data
operator|->
name|ExpStatus
argument_list|)
argument_list|,
name|data
operator|->
name|ExpStatus
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|PhysicalPort
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|data
operator|->
name|NumEntries
condition|;
name|i
operator|++
control|)
block|{
name|phy
operator|=
operator|&
name|data
operator|->
name|PHY
index|[
name|i
index|]
expr_stmt|;
name|phynum
operator|=
name|data
operator|->
name|StartPhyNum
operator|+
name|i
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"PHY[%d].AttachedDevHandle: 0x%04x\n"
argument_list|,
name|phynum
argument_list|,
name|phy
operator|->
name|AttachedDevHandle
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"PHY[%d].LinkRate: %s (0x%x)\n"
argument_list|,
name|phynum
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
operator|(
name|phy
operator|->
name|LinkRate
operator|>>
literal|4
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|phy
operator|->
name|LinkRate
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"PHY[%d].PhyStatus: %s\n"
argument_list|,
name|phynum
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_phystatus_names
argument_list|,
name|phy
operator|->
name|PhyStatus
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|MPI2_EVENT_SAS_ENCL_DEVICE_STATUS_CHANGE
case|:
block|{
name|MPI2_EVENT_DATA_SAS_ENCL_DEV_STATUS_CHANGE
modifier|*
name|data
decl_stmt|;
name|data
operator|=
operator|(
name|MPI2_EVENT_DATA_SAS_ENCL_DEV_STATUS_CHANGE
operator|*
operator|)
operator|&
name|event
operator|->
name|EventData
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|EnclosureHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"ReasonCode: %s\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sastopo_exp
argument_list|,
name|data
operator|->
name|ReasonCode
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|PhysicalPort
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|NumSlots
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|StartSlot
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|PhyBits
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|MPI2_EVENT_SAS_DEVICE_STATUS_CHANGE
case|:
block|{
name|MPI2_EVENT_DATA_SAS_DEVICE_STATUS_CHANGE
modifier|*
name|data
decl_stmt|;
name|data
operator|=
operator|(
name|MPI2_EVENT_DATA_SAS_DEVICE_STATUS_CHANGE
operator|*
operator|)
operator|&
name|event
operator|->
name|EventData
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|TaskTag
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"ReasonCode: %s\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sasdev_reason
argument_list|,
name|data
operator|->
name|ReasonCode
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|ASC
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|ASCQ
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_EVENTFIELD
argument_list|(
name|sc
argument_list|,
name|data
argument_list|,
name|DevHandle
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_EVENT
argument_list|,
literal|"SASAddress: 0x%jx\n"
argument_list|,
name|mps_to_u64
argument_list|(
operator|&
name|data
operator|->
name|SASAddress
argument_list|)
argument_list|)
expr_stmt|;
block|}
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|void
name|mps_print_expander1
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_CONFIG_PAGE_EXPANDER_1
modifier|*
name|buf
parameter_list|)
block|{
name|MPS_PRINTFIELD_START
argument_list|(
name|sc
argument_list|,
literal|"SAS Expander Page 1 #%d"
argument_list|,
name|buf
operator|->
name|Phy
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|PhysicalPort
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|NumPhys
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|Phy
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|NumTableEntriesProgrammed
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"ProgrammedLinkRate: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
operator|(
name|buf
operator|->
name|ProgrammedLinkRate
operator|>>
literal|4
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|ProgrammedLinkRate
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"HwLinkRate: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
operator|(
name|buf
operator|->
name|HwLinkRate
operator|>>
literal|4
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|HwLinkRate
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AttachedDevHandle
argument_list|,
literal|0x
operator|%
literal|04x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"PhyInfo Reason: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_phyinfo_reason_names
argument_list|,
operator|(
name|buf
operator|->
name|PhyInfo
operator|>>
literal|16
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|PhyInfo
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"AttachedDeviceInfo: %b,%s\n"
argument_list|,
name|buf
operator|->
name|AttachedDeviceInfo
argument_list|,
literal|"\20"
literal|"\4SATAhost"
literal|"\5SMPinit"
literal|"\6STPinit"
literal|"\7SSPinit"
literal|"\10SATAdev"
literal|"\11SMPtarg"
literal|"\12STPtarg"
literal|"\13SSPtarg"
literal|"\14Direct"
literal|"\15LSIdev"
literal|"\16ATAPIdev"
literal|"\17SEPdev"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_sasdev0_devtype
argument_list|,
name|buf
operator|->
name|AttachedDeviceInfo
operator|&
literal|0x03
argument_list|)
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ExpanderDevHandle
argument_list|,
literal|0x
operator|%
literal|04x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ChangeCount
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"NegotiatedLinkRate: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
name|buf
operator|->
name|NegotiatedLinkRate
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|NegotiatedLinkRate
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|PhyIdentifier
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AttachedPhyIdentifier
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|DiscoveryInfo
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AttachedPhyInfo
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"AttachedPhyInfo Reason: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_phyinfo_reason_names
argument_list|,
name|buf
operator|->
name|AttachedPhyInfo
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|AttachedPhyInfo
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ZoneGroup
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|SelfConfigStatus
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_sasphy0
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|MPI2_CONFIG_PAGE_SAS_PHY_0
modifier|*
name|buf
parameter_list|)
block|{
name|MPS_PRINTFIELD_START
argument_list|(
name|sc
argument_list|,
literal|"SAS PHY Page 0"
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|OwnerDevHandle
argument_list|,
literal|0x
operator|%
literal|04x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AttachedDevHandle
argument_list|,
literal|0x
operator|%
literal|04x
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|AttachedPhyIdentifier
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"AttachedPhyInfo Reason: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_phyinfo_reason_names
argument_list|,
name|buf
operator|->
name|AttachedPhyInfo
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|AttachedPhyInfo
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"ProgrammedLinkRate: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
operator|(
name|buf
operator|->
name|ProgrammedLinkRate
operator|>>
literal|4
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|ProgrammedLinkRate
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"HwLinkRate: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
operator|(
name|buf
operator|->
name|HwLinkRate
operator|>>
literal|4
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|HwLinkRate
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|ChangeCount
argument_list|,
operator|%
name|d
argument_list|)
expr_stmt|;
name|MPS_PRINTFIELD
argument_list|(
name|sc
argument_list|,
name|buf
argument_list|,
name|Flags
argument_list|,
literal|0x
operator|%
name|x
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"PhyInfo Reason: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_phyinfo_reason_names
argument_list|,
operator|(
name|buf
operator|->
name|PhyInfo
operator|>>
literal|16
operator|)
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|PhyInfo
argument_list|)
expr_stmt|;
name|mps_dprint_field
argument_list|(
name|sc
argument_list|,
name|MPS_INFO
argument_list|,
literal|"NegotiatedLinkRate: %s (0x%x)\n"
argument_list|,
name|mps_describe_table
argument_list|(
name|mps_linkrate_names
argument_list|,
name|buf
operator|->
name|NegotiatedLinkRate
operator|&
literal|0xf
argument_list|)
argument_list|,
name|buf
operator|->
name|NegotiatedLinkRate
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mps_print_sgl
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|mps_command
modifier|*
name|cm
parameter_list|,
name|int
name|offset
parameter_list|)
block|{
name|MPI2_SGE_SIMPLE64
modifier|*
name|sge
decl_stmt|;
name|MPI2_SGE_CHAIN32
modifier|*
name|sgc
decl_stmt|;
name|MPI2_REQUEST_HEADER
modifier|*
name|req
decl_stmt|;
name|struct
name|mps_chain
modifier|*
name|chain
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|frame
decl_stmt|;
name|u_int
name|i
init|=
literal|0
decl_stmt|,
name|flags
decl_stmt|;
name|req
operator|=
operator|(
name|MPI2_REQUEST_HEADER
operator|*
operator|)
name|cm
operator|->
name|cm_req
expr_stmt|;
name|frame
operator|=
operator|(
name|char
operator|*
operator|)
name|cm
operator|->
name|cm_req
expr_stmt|;
name|sge
operator|=
operator|(
name|MPI2_SGE_SIMPLE64
operator|*
operator|)
operator|&
name|frame
index|[
name|offset
operator|*
literal|4
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"SGL for command %p\n"
argument_list|,
name|cm
argument_list|)
expr_stmt|;
name|hexdump
argument_list|(
name|frame
argument_list|,
literal|128
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
while|while
condition|(
name|frame
operator|!=
name|NULL
condition|)
block|{
name|flags
operator|=
name|le32toh
argument_list|(
name|sge
operator|->
name|FlagsLength
argument_list|)
operator|>>
name|MPI2_SGE_FLAGS_SHIFT
expr_stmt|;
name|printf
argument_list|(
literal|"seg%d flags=0x%02x len=0x%06x addr=0x%016jx\n"
argument_list|,
name|i
argument_list|,
name|flags
argument_list|,
name|le32toh
argument_list|(
name|sge
operator|->
name|FlagsLength
argument_list|)
operator|&
literal|0xffffff
argument_list|,
name|mps_to_u64
argument_list|(
operator|&
name|sge
operator|->
name|Address
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
operator|(
name|MPI2_SGE_FLAGS_END_OF_LIST
operator||
name|MPI2_SGE_FLAGS_END_OF_BUFFER
operator|)
condition|)
break|break;
name|sge
operator|++
expr_stmt|;
name|i
operator|++
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|MPI2_SGE_FLAGS_LAST_ELEMENT
condition|)
block|{
name|sgc
operator|=
operator|(
name|MPI2_SGE_CHAIN32
operator|*
operator|)
name|sge
expr_stmt|;
name|printf
argument_list|(
literal|"chain flags=0x%x len=0x%x Offset=0x%x "
literal|"Address=0x%x\n"
argument_list|,
name|sgc
operator|->
name|Flags
argument_list|,
name|le16toh
argument_list|(
name|sgc
operator|->
name|Length
argument_list|)
argument_list|,
name|sgc
operator|->
name|NextChainOffset
argument_list|,
name|le32toh
argument_list|(
name|sgc
operator|->
name|Address
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|chain
operator|==
name|NULL
condition|)
name|chain
operator|=
name|TAILQ_FIRST
argument_list|(
operator|&
name|cm
operator|->
name|cm_chain_list
argument_list|)
expr_stmt|;
else|else
name|chain
operator|=
name|TAILQ_NEXT
argument_list|(
name|chain
argument_list|,
name|chain_link
argument_list|)
expr_stmt|;
name|frame
operator|=
operator|(
name|char
operator|*
operator|)
name|chain
operator|->
name|chain
expr_stmt|;
name|sge
operator|=
operator|(
name|MPI2_SGE_SIMPLE64
operator|*
operator|)
name|frame
expr_stmt|;
name|hexdump
argument_list|(
name|frame
argument_list|,
literal|128
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|mps_print_scsiio_cmd
parameter_list|(
name|struct
name|mps_softc
modifier|*
name|sc
parameter_list|,
name|struct
name|mps_command
modifier|*
name|cm
parameter_list|)
block|{
name|MPI2_SCSI_IO_REQUEST
modifier|*
name|req
decl_stmt|;
name|req
operator|=
operator|(
name|MPI2_SCSI_IO_REQUEST
operator|*
operator|)
name|cm
operator|->
name|cm_req
expr_stmt|;
name|mps_print_sgl
argument_list|(
name|sc
argument_list|,
name|cm
argument_list|,
name|req
operator|->
name|SGLOffset0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

