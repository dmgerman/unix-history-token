begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2017 Chelsio Communications, Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|"common/common.h"
end_include

begin_include
include|#
directive|include
file|"common/t4_regs.h"
end_include

begin_include
include|#
directive|include
file|"cudbg.h"
end_include

begin_include
include|#
directive|include
file|"cudbg_lib_common.h"
end_include

begin_include
include|#
directive|include
file|"cudbg_entity.h"
end_include

begin_function_decl
name|int
name|collect_wtp_data
parameter_list|(
name|struct
name|cudbg_init
modifier|*
name|pdbg_init
parameter_list|,
name|struct
name|cudbg_buffer
modifier|*
name|dbg_buff
parameter_list|,
name|struct
name|cudbg_error
modifier|*
name|cudbg_err
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*SGE_DEBUG Registers.*/
end_comment

begin_define
define|#
directive|define
name|TP_MIB_SIZE
value|0x5e
end_define

begin_struct
struct|struct
name|sge_debug_reg_data
block|{
comment|/*indx0*/
name|u32
name|reserved1
range|:
literal|4
decl_stmt|;
name|u32
name|reserved2
range|:
literal|4
decl_stmt|;
name|u32
name|debug_uP_SOP_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_uP_EOP_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CIM_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CIM_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CIM_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CIM_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx1*/
name|u32
name|reserved3
range|:
literal|32
decl_stmt|;
comment|/*indx2*/
name|u32
name|debug_T_Rx_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_T_Rx_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_T_Rx_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_T_Rx_EOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Rx_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Rx_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Rx_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Rx_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx3*/
name|u32
name|reserved4
range|:
literal|32
decl_stmt|;
comment|/*indx4*/
name|u32
name|debug_UD_Rx_SOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_EOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_SOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_EOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_UD_Rx_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx5*/
name|u32
name|reserved5
range|:
literal|32
decl_stmt|;
comment|/*indx6*/
name|u32
name|debug_U_Tx_SOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_EOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_SOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_EOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_U_Tx_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx7*/
name|u32
name|reserved6
range|:
literal|32
decl_stmt|;
comment|/*indx8*/
name|u32
name|debug_PC_Rsp_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Rsp_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Rsp_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Rsp_EOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Req_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Req_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Req_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PC_Req_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx9*/
name|u32
name|reserved7
range|:
literal|32
decl_stmt|;
comment|/*indx10*/
name|u32
name|debug_PD_Req_SOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_EOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_SOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_EOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx11*/
name|u32
name|reserved8
range|:
literal|32
decl_stmt|;
comment|/*indx12*/
name|u32
name|debug_PD_Rsp_SOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_EOP3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_SOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_EOP2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Rsp_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx13*/
name|u32
name|reserved9
range|:
literal|32
decl_stmt|;
comment|/*indx14*/
name|u32
name|debug_CPLSW_TP_Rx_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_TP_Rx_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_TP_Rx_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_TP_Rx_EOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_CIM_SOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_CIM_EOP1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_CIM_SOP0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_CPLSW_CIM_EOP0_cnt
range|:
literal|4
decl_stmt|;
comment|/*indx15*/
name|u32
name|reserved10
range|:
literal|32
decl_stmt|;
comment|/*indx16*/
name|u32
name|debug_PD_Req_Rd3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Rd2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Rd1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Rd0_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Int3_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Int2_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Int1_cnt
range|:
literal|4
decl_stmt|;
name|u32
name|debug_PD_Req_Int0_cnt
range|:
literal|4
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|tp_mib_type
name|tp_mib
index|[]
init|=
block|{
block|{
literal|"tp_mib_mac_in_err_0"
block|,
literal|0x0
block|}
block|,
block|{
literal|"tp_mib_mac_in_err_1"
block|,
literal|0x1
block|}
block|,
block|{
literal|"tp_mib_mac_in_err_2"
block|,
literal|0x2
block|}
block|,
block|{
literal|"tp_mib_mac_in_err_3"
block|,
literal|0x3
block|}
block|,
block|{
literal|"tp_mib_hdr_in_err_0"
block|,
literal|0x4
block|}
block|,
block|{
literal|"tp_mib_hdr_in_err_1"
block|,
literal|0x5
block|}
block|,
block|{
literal|"tp_mib_hdr_in_err_2"
block|,
literal|0x6
block|}
block|,
block|{
literal|"tp_mib_hdr_in_err_3"
block|,
literal|0x7
block|}
block|,
block|{
literal|"tp_mib_tcp_in_err_0"
block|,
literal|0x8
block|}
block|,
block|{
literal|"tp_mib_tcp_in_err_1"
block|,
literal|0x9
block|}
block|,
block|{
literal|"tp_mib_tcp_in_err_2"
block|,
literal|0xa
block|}
block|,
block|{
literal|"tp_mib_tcp_in_err_3"
block|,
literal|0xb
block|}
block|,
block|{
literal|"tp_mib_tcp_out_rst"
block|,
literal|0xc
block|}
block|,
block|{
literal|"tp_mib_tcp_in_seg_hi"
block|,
literal|0x10
block|}
block|,
block|{
literal|"tp_mib_tcp_in_seg_lo"
block|,
literal|0x11
block|}
block|,
block|{
literal|"tp_mib_tcp_out_seg_hi"
block|,
literal|0x12
block|}
block|,
block|{
literal|"tp_mib_tcp_out_seg_lo"
block|,
literal|0x13
block|}
block|,
block|{
literal|"tp_mib_tcp_rxt_seg_hi"
block|,
literal|0x14
block|}
block|,
block|{
literal|"tp_mib_tcp_rxt_seg_lo"
block|,
literal|0x15
block|}
block|,
block|{
literal|"tp_mib_tnl_cng_drop_0"
block|,
literal|0x18
block|}
block|,
block|{
literal|"tp_mib_tnl_cng_drop_1"
block|,
literal|0x19
block|}
block|,
block|{
literal|"tp_mib_tnl_cng_drop_2"
block|,
literal|0x1a
block|}
block|,
block|{
literal|"tp_mib_tnl_cng_drop_3"
block|,
literal|0x1b
block|}
block|,
block|{
literal|"tp_mib_ofd_chn_drop_0"
block|,
literal|0x1c
block|}
block|,
block|{
literal|"tp_mib_ofd_chn_drop_1"
block|,
literal|0x1d
block|}
block|,
block|{
literal|"tp_mib_ofd_chn_drop_2"
block|,
literal|0x1e
block|}
block|,
block|{
literal|"tp_mib_ofd_chn_drop_3"
block|,
literal|0x1f
block|}
block|,
block|{
literal|"tp_mib_tnl_out_pkt_0"
block|,
literal|0x20
block|}
block|,
block|{
literal|"tp_mib_tnl_out_pkt_1"
block|,
literal|0x21
block|}
block|,
block|{
literal|"tp_mib_tnl_out_pkt_2"
block|,
literal|0x22
block|}
block|,
block|{
literal|"tp_mib_tnl_out_pkt_3"
block|,
literal|0x23
block|}
block|,
block|{
literal|"tp_mib_tnl_in_pkt_0"
block|,
literal|0x24
block|}
block|,
block|{
literal|"tp_mib_tnl_in_pkt_1"
block|,
literal|0x25
block|}
block|,
block|{
literal|"tp_mib_tnl_in_pkt_2"
block|,
literal|0x26
block|}
block|,
block|{
literal|"tp_mib_tnl_in_pkt_3"
block|,
literal|0x27
block|}
block|,
block|{
literal|"tp_mib_tcp_v6in_err_0"
block|,
literal|0x28
block|}
block|,
block|{
literal|"tp_mib_tcp_v6in_err_1"
block|,
literal|0x29
block|}
block|,
block|{
literal|"tp_mib_tcp_v6in_err_2"
block|,
literal|0x2a
block|}
block|,
block|{
literal|"tp_mib_tcp_v6in_err_3"
block|,
literal|0x2b
block|}
block|,
block|{
literal|"tp_mib_tcp_v6out_rst"
block|,
literal|0x2c
block|}
block|,
block|{
literal|"tp_mib_tcp_v6in_seg_hi"
block|,
literal|0x30
block|}
block|,
block|{
literal|"tp_mib_tcp_v6in_seg_lo"
block|,
literal|0x31
block|}
block|,
block|{
literal|"tp_mib_tcp_v6out_seg_hi"
block|,
literal|0x32
block|}
block|,
block|{
literal|"tp_mib_tcp_v6out_seg_lo"
block|,
literal|0x33
block|}
block|,
block|{
literal|"tp_mib_tcp_v6rxt_seg_hi"
block|,
literal|0x34
block|}
block|,
block|{
literal|"tp_mib_tcp_v6rxt_seg_lo"
block|,
literal|0x35
block|}
block|,
block|{
literal|"tp_mib_ofd_arp_drop"
block|,
literal|0x36
block|}
block|,
block|{
literal|"tp_mib_ofd_dfr_drop"
block|,
literal|0x37
block|}
block|,
block|{
literal|"tp_mib_cpl_in_req_0"
block|,
literal|0x38
block|}
block|,
block|{
literal|"tp_mib_cpl_in_req_1"
block|,
literal|0x39
block|}
block|,
block|{
literal|"tp_mib_cpl_in_req_2"
block|,
literal|0x3a
block|}
block|,
block|{
literal|"tp_mib_cpl_in_req_3"
block|,
literal|0x3b
block|}
block|,
block|{
literal|"tp_mib_cpl_out_rsp_0"
block|,
literal|0x3c
block|}
block|,
block|{
literal|"tp_mib_cpl_out_rsp_1"
block|,
literal|0x3d
block|}
block|,
block|{
literal|"tp_mib_cpl_out_rsp_2"
block|,
literal|0x3e
block|}
block|,
block|{
literal|"tp_mib_cpl_out_rsp_3"
block|,
literal|0x3f
block|}
block|,
block|{
literal|"tp_mib_tnl_lpbk_0"
block|,
literal|0x40
block|}
block|,
block|{
literal|"tp_mib_tnl_lpbk_1"
block|,
literal|0x41
block|}
block|,
block|{
literal|"tp_mib_tnl_lpbk_2"
block|,
literal|0x42
block|}
block|,
block|{
literal|"tp_mib_tnl_lpbk_3"
block|,
literal|0x43
block|}
block|,
block|{
literal|"tp_mib_tnl_drop_0"
block|,
literal|0x44
block|}
block|,
block|{
literal|"tp_mib_tnl_drop_1"
block|,
literal|0x45
block|}
block|,
block|{
literal|"tp_mib_tnl_drop_2"
block|,
literal|0x46
block|}
block|,
block|{
literal|"tp_mib_tnl_drop_3"
block|,
literal|0x47
block|}
block|,
block|{
literal|"tp_mib_fcoe_ddp_0"
block|,
literal|0x48
block|}
block|,
block|{
literal|"tp_mib_fcoe_ddp_1"
block|,
literal|0x49
block|}
block|,
block|{
literal|"tp_mib_fcoe_ddp_2"
block|,
literal|0x4a
block|}
block|,
block|{
literal|"tp_mib_fcoe_ddp_3"
block|,
literal|0x4b
block|}
block|,
block|{
literal|"tp_mib_fcoe_drop_0"
block|,
literal|0x4c
block|}
block|,
block|{
literal|"tp_mib_fcoe_drop_1"
block|,
literal|0x4d
block|}
block|,
block|{
literal|"tp_mib_fcoe_drop_2"
block|,
literal|0x4e
block|}
block|,
block|{
literal|"tp_mib_fcoe_drop_3"
block|,
literal|0x4f
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_0_hi"
block|,
literal|0x50
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_0_lo"
block|,
literal|0x51
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_1_hi"
block|,
literal|0x52
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_1_lo"
block|,
literal|0x53
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_2_hi"
block|,
literal|0x54
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_2_lo"
block|,
literal|0x55
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_3_hi"
block|,
literal|0x56
block|}
block|,
block|{
literal|"tp_mib_fcoe_byte_3_lo"
block|,
literal|0x57
block|}
block|,
block|{
literal|"tp_mib_ofd_vln_drop_0"
block|,
literal|0x58
block|}
block|,
block|{
literal|"tp_mib_ofd_vln_drop_1"
block|,
literal|0x59
block|}
block|,
block|{
literal|"tp_mib_ofd_vln_drop_2"
block|,
literal|0x5a
block|}
block|,
block|{
literal|"tp_mib_ofd_vln_drop_3"
block|,
literal|0x5b
block|}
block|,
block|{
literal|"tp_mib_usm_pkts"
block|,
literal|0x5c
block|}
block|,
block|{
literal|"tp_mib_usm_drop"
block|,
literal|0x5d
block|}
block|,
block|{
literal|"tp_mib_usm_bytes_hi"
block|,
literal|0x5e
block|}
block|,
block|{
literal|"tp_mib_usm_bytes_lo"
block|,
literal|0x5f
block|}
block|,
block|{
literal|"tp_mib_tid_del"
block|,
literal|0x60
block|}
block|,
block|{
literal|"tp_mib_tid_inv"
block|,
literal|0x61
block|}
block|,
block|{
literal|"tp_mib_tid_act"
block|,
literal|0x62
block|}
block|,
block|{
literal|"tp_mib_tid_pas"
block|,
literal|0x63
block|}
block|,
block|{
literal|"tp_mib_rqe_dfr_mod"
block|,
literal|0x64
block|}
block|,
block|{
literal|"tp_mib_rqe_dfr_pkt"
block|,
literal|0x65
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|u32
name|read_sge_debug_data
parameter_list|(
name|struct
name|cudbg_init
modifier|*
name|pdbg_init
parameter_list|,
name|u32
modifier|*
name|sge_dbg_reg
parameter_list|)
block|{
name|struct
name|adapter
modifier|*
name|padap
init|=
name|pdbg_init
operator|->
name|adap
decl_stmt|;
name|u32
name|value
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|15
condition|;
name|i
operator|++
control|)
block|{
name|t4_write_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_INDEX
argument_list|,
operator|(
name|u32
operator|)
name|i
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_LOW
argument_list|)
expr_stmt|;
comment|/*printf("LOW	 0x%08x\n", value);*/
name|sge_dbg_reg
index|[
operator|(
name|i
operator|<<
literal|1
operator|)
operator||
literal|1
index|]
operator|=
name|HTONL_NIBBLE
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH
argument_list|)
expr_stmt|;
comment|/*printf("HIGH	 0x%08x\n", value);*/
name|sge_dbg_reg
index|[
operator|(
name|i
operator|<<
literal|1
operator|)
index|]
operator|=
name|HTONL_NIBBLE
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|u32
name|read_tp_mib_data
parameter_list|(
name|struct
name|cudbg_init
modifier|*
name|pdbg_init
parameter_list|,
name|struct
name|tp_mib_data
modifier|*
modifier|*
name|ppTp_Mib
parameter_list|)
block|{
name|struct
name|adapter
modifier|*
name|padap
init|=
name|pdbg_init
operator|->
name|adap
decl_stmt|;
name|u32
name|i
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TP_MIB_SIZE
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_mib_read
argument_list|(
name|padap
argument_list|,
operator|&
name|tp_mib
index|[
name|i
index|]
operator|.
name|value
argument_list|,
literal|1
argument_list|,
operator|(
name|u32
operator|)
name|tp_mib
index|[
name|i
index|]
operator|.
name|addr
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
operator|*
name|ppTp_Mib
operator|=
operator|(
expr|struct
name|tp_mib_data
operator|*
operator|)
operator|&
name|tp_mib
index|[
literal|0
index|]
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|t5_wtp_data
parameter_list|(
name|struct
name|cudbg_init
modifier|*
name|pdbg_init
parameter_list|,
name|struct
name|cudbg_buffer
modifier|*
name|dbg_buff
parameter_list|,
name|struct
name|cudbg_error
modifier|*
name|cudbg_err
parameter_list|)
block|{
name|struct
name|adapter
modifier|*
name|padap
init|=
name|pdbg_init
operator|->
name|adap
decl_stmt|;
name|struct
name|sge_debug_reg_data
modifier|*
name|sge_dbg_reg
init|=
name|NULL
decl_stmt|;
name|struct
name|cudbg_buffer
name|scratch_buff
decl_stmt|;
name|struct
name|tp_mib_data
modifier|*
name|ptp_mib
init|=
name|NULL
decl_stmt|;
name|struct
name|wtp_data
modifier|*
name|wtp
decl_stmt|;
name|u32
name|Sge_Dbg
index|[
literal|32
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
name|u32
name|value
init|=
literal|0
decl_stmt|;
name|u32
name|i
init|=
literal|0
decl_stmt|;
name|u32
name|drop
init|=
literal|0
decl_stmt|;
name|u32
name|err
init|=
literal|0
decl_stmt|;
name|u32
name|offset
decl_stmt|;
name|int
name|rc
init|=
literal|0
decl_stmt|;
name|rc
operator|=
name|get_scratch_buff
argument_list|(
name|dbg_buff
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wtp_data
argument_list|)
argument_list|,
operator|&
name|scratch_buff
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
goto|goto
name|err
goto|;
name|offset
operator|=
name|scratch_buff
operator|.
name|offset
expr_stmt|;
name|wtp
operator|=
operator|(
expr|struct
name|wtp_data
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|scratch_buff
operator|.
name|data
operator|+
name|offset
operator|)
expr_stmt|;
name|read_sge_debug_data
argument_list|(
name|pdbg_init
argument_list|,
name|Sge_Dbg
argument_list|)
expr_stmt|;
name|read_tp_mib_data
argument_list|(
name|pdbg_init
argument_list|,
operator|&
name|ptp_mib
argument_list|)
expr_stmt|;
name|sge_dbg_reg
operator|=
operator|(
expr|struct
name|sge_debug_reg_data
operator|*
operator|)
operator|&
name|Sge_Dbg
index|[
literal|0
index|]
expr_stmt|;
comment|/*#######################################################################*/
comment|/*# TX PATH, starting from pcie*/
comment|/*#######################################################################*/
comment|/* Get Reqests of commmands from SGE to PCIE*/
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Req_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Req_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Req_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Req_EOP1_cnt
expr_stmt|;
comment|/* Get Reqests of commmands from PCIE to core*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_CMDR_REQ_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_core_cmd_req
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_cmd_req
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
comment|/* there is no EOP for this, so we fake it.*/
name|wtp
operator|->
name|pcie_core_cmd_req
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_cmd_req
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
comment|/* Get DMA stats*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_T5_DMA_STAT3
operator|+
operator|(
name|i
operator|*
literal|0x10
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_t5_dma_stat3
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|wtp
operator|->
name|pcie_t5_dma_stat3
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
comment|/* Get SGE debug data high index 6*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_6
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_6
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
comment|/* Get SGE debug data high index 3*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_3
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_index_3
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
comment|/* Get ULP SE CNT CHx*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_ULP_TX_SE_CNT_CH0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|ulp_se_cnt_chx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|ulp_se_cnt_chx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
block|}
comment|/* Get MAC PORTx PKT COUNT*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x3081c
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_pkt_count
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_pkt_count
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_pkt_count
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_pkt_count
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
comment|/* Get mac portx aFramesTransmittedok*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x30a80
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_aframestra_ok
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_aframestra_ok
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
comment|/* Get command respones from core to PCIE*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_CMDR_RSP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|core_pcie_cmd_rsp
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|core_pcie_cmd_rsp
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|core_pcie_cmd_rsp
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|core_pcie_cmd_rsp
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
comment|/*Get command Resposes from PCIE to SGE*/
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_EOP1_cnt
expr_stmt|;
comment|/* Get commands sent from SGE to CIM/uP*/
name|wtp
operator|->
name|sge_cim
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_cim
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_cim
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_cim
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_EOP1_cnt
expr_stmt|;
comment|/* Get Reqests of data from PCIE by SGE*/
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_SOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_SOP3_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_EOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|eop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_EOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|utx_sge_dma_req
operator|.
name|eop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_UD_Rx_EOP3_cnt
expr_stmt|;
comment|/* Get Reqests of data from PCIE by SGE*/
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd3_cnt
expr_stmt|;
comment|/*no EOP's, so fake it.*/
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|eop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_dma_req
operator|.
name|eop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Rd3_cnt
expr_stmt|;
comment|/* Get Reqests of data from PCIE to core*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_DMAR_REQ_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
comment|/* There is no eop so fake it.*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|pcie_core_dma_req
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
comment|/* Get data responses from core to PCIE*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_DMAR_RSP_SOP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_DMAR_RSP_EOP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|core_pcie_dma_rsp
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
comment|/* Get PCIE_DATA to SGE*/
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_SOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_SOP3_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_EOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|eop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_EOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_dma_rsp
operator|.
name|eop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Rsp_EOP3_cnt
expr_stmt|;
comment|/*Get SGE to ULP_TX*/
name|wtp
operator|->
name|sge_utx
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_SOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_SOP3_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_EOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|eop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_EOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_utx
operator|.
name|eop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_U_Tx_EOP3_cnt
expr_stmt|;
comment|/* Get ULP_TX to TP*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_ULP_TX_SE_CNT_CH0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|utx_tp
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|utx_tp
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
block|}
comment|/* Get TP_DBG_CSIDE registers*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_CSIDE_RX0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|utx_tpcside
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|utx_tpcside
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
name|wtp
operator|->
name|tpcside_rxpld
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 20:23*/
name|wtp
operator|->
name|tpcside_rxpld
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 16:19*/
name|wtp
operator|->
name|tpcside_rxarb
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 12:15*/
name|wtp
operator|->
name|tpcside_rxarb
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 8:11*/
name|wtp
operator|->
name|tpcside_rxcpl
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 4:7*/
name|wtp
operator|->
name|tpcside_rxcpl
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 0:3*/
block|}
comment|/* TP_DBG_ESIDE*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_ESIDE_PKT0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tpeside_mps
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|tpeside_mps
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
name|wtp
operator|->
name|tpeside_pm
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 20:23*/
name|wtp
operator|->
name|tpeside_pm
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 16:19*/
name|wtp
operator|->
name|mps_tpeside
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 12:15*/
name|wtp
operator|->
name|mps_tpeside
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 8:11*/
name|wtp
operator|->
name|tpeside_pld
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 4:7*/
name|wtp
operator|->
name|tpeside_pld
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 0:3*/
block|}
comment|/*PCIE CMD STAT2*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x5988
operator|+
operator|(
name|i
operator|*
literal|0x10
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat2
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat2
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
block|}
comment|/*PCIE cmd stat3*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x598c
operator|+
operator|(
name|i
operator|*
literal|0x10
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat3
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat3
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
block|}
comment|/* ULP_RX input/output*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_ULP_RX_SE_CNT_CH0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pmrx_ulprx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 4:7*/
name|wtp
operator|->
name|pmrx_ulprx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 0:3*/
name|wtp
operator|->
name|ulprx_tpcside
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|ulprx_tpcside
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
block|}
comment|/* Get the MPS input from TP*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_TX_SE_CNT_TP01
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tp_mps
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|tp_mps
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|tp_mps
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31 								    */
name|wtp
operator|->
name|tp_mps
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23 								    */
block|}
name|drop
operator|=
name|ptp_mib
operator|->
name|TP_MIB_OFD_ARP_DROP
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_DFR_DROP
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_DROP_2
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_DROP_3
operator|.
name|value
expr_stmt|;
name|wtp
operator|->
name|tp_mps
operator|.
name|drops
operator|=
name|drop
expr_stmt|;
comment|/* Get the MPS output to the MAC's*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_TX_SE_CNT_MAC01
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mps_xgm
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|mps_xgm
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|mps_xgm
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31 								     */
name|wtp
operator|->
name|mps_xgm
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23 								     */
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_TX_PORT_DROP_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
block|}
name|wtp
operator|->
name|mps_xgm
operator|.
name|drops
operator|=
operator|(
name|drop
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/* Get the SOP/EOP counters into and out of MAC. [JHANEL] I think this 	 * is*/
comment|/* clear on read, so you have to read both TX and RX path at same 	 * time.*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MAC_PORT_PKT_COUNT
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tx_xgm_xgm
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
name|wtp
operator|->
name|tx_xgm_xgm
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|rx_xgm_xgm
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|rx_xgm_xgm
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
block|}
comment|/* Get the MAC's output to the wire*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MAC_PORT_AFRAMESTRANSMITTEDOK
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|xgm_wire
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|)
expr_stmt|;
name|wtp
operator|->
name|xgm_wire
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|)
expr_stmt|;
comment|/* No EOP for XGMAC, so fake 						   it.*/
block|}
comment|/*########################################################################*/
comment|/*# RX PATH, starting from wire*/
comment|/*########################################################################*/
comment|/* Add up the wire input to the MAC*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MAC_PORT_AFRAMESRECEIVEDOK
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|wire_xgm
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|)
expr_stmt|;
name|wtp
operator|->
name|wire_xgm
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|)
expr_stmt|;
comment|/* No EOP for XGMAC, so fake 						   it.*/
block|}
comment|/* Already read the rx_xgm_xgm when reading TX path.*/
comment|/* Add up SOP/EOP's on all 8 MPS buffer channels*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_RX_SE_CNT_IN0
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|xgm_mps
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bits 8:15*/
name|wtp
operator|->
name|xgm_mps
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bits 0:7*/
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_RX_CLS_DROP_CNT0
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
comment|/* typo in JHANEL's code.*/
name|drop
operator|+=
operator|(
name|value
operator|&
literal|0xFFFF
operator|)
operator|+
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFFFF
operator|)
expr_stmt|;
block|}
name|wtp
operator|->
name|xgm_mps
operator|.
name|cls_drop
operator|=
name|drop
operator|&
literal|0xFF
expr_stmt|;
comment|/* Add up the overflow drops on all 4 ports.*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_LB_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_LB_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_LB_PORT_DROP_FRAMES
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
block|}
name|wtp
operator|->
name|xgm_mps
operator|.
name|drop
operator|=
operator|(
name|drop
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/* Add up the MPS errors that should result in dropped packets*/
name|err
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LEN_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LEN_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_SYM_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_SYM_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LESS_64B_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
operator|(
name|A_MPS_PORT_STAT_RX_PORT_LESS_64B_L
operator|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|wtp
operator|->
name|xgm_mps
operator|.
name|err
operator|=
operator|(
name|err
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_RX_SE_CNT_OUT01
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mps_tp
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|mps_tp
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|mps_tp
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31 								    */
name|wtp
operator|->
name|mps_tp
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23 								    */
block|}
name|drop
operator|=
name|ptp_mib
operator|->
name|TP_MIB_TNL_CNG_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_CNG_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_CNG_DROP_2
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_CNG_DROP_3
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_CHN_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_CHN_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_CHN_DROP_2
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_CHN_DROP_3
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_FCOE_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_FCOE_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_FCOE_DROP_2
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_FCOE_DROP_3
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_VLN_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_VLN_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_VLN_DROP_2
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_VLN_DROP_3
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_USM_DROP
operator|.
name|value
expr_stmt|;
name|wtp
operator|->
name|mps_tp
operator|.
name|drops
operator|=
name|drop
expr_stmt|;
comment|/* Get TP_DBG_CSIDE_TX registers*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_CSIDE_RX0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tpcside_csw
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|tpcside_csw
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
name|wtp
operator|->
name|tpcside_pm
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 20:23*/
name|wtp
operator|->
name|tpcside_pm
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 16:19*/
name|wtp
operator|->
name|tpcside_uturn
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 12:15*/
name|wtp
operator|->
name|tpcside_uturn
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 8:11*/
name|wtp
operator|->
name|tpcside_txcpl
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 4:7*/
name|wtp
operator|->
name|tpcside_txcpl
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 0:3*/
block|}
comment|/* TP to CPL_SWITCH*/
name|wtp
operator|->
name|tp_csw
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CPLSW_TP_Rx_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|tp_csw
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CPLSW_TP_Rx_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|tp_csw
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CPLSW_TP_Rx_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|tp_csw
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CPLSW_TP_Rx_EOP1_cnt
expr_stmt|;
comment|/* TP/CPL_SWITCH to SGE*/
name|wtp
operator|->
name|csw_sge
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_T_Rx_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|csw_sge
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_T_Rx_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|csw_sge
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_T_Rx_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|csw_sge
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_T_Rx_EOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_SOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_SOP3_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_EOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|eop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_EOP2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie
operator|.
name|eop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_EOP3_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int3_cnt
expr_stmt|;
comment|/* NO EOP, so fake it.*/
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|eop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|eop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int3_cnt
expr_stmt|;
comment|/*Get PCIE DMA1 STAT2*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_T5_DMA_STAT2
operator|+
operator|(
name|i
operator|*
literal|0x10
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2_core
operator|.
name|sop
index|[
name|i
index|]
operator|+=
name|value
operator|&
literal|0x0F
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2_core
operator|.
name|eop
index|[
name|i
index|]
operator|+=
name|value
operator|&
literal|0x0F
expr_stmt|;
block|}
comment|/* Get mac porrx aFramesTransmittedok*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x30a88
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_aframestra_ok
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_aframestra_ok
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
name|value
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
comment|/*Get SGE debug data high index 7*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_7
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
comment|/*Get SGE debug data high index 1*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_1
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
comment|/*Get TP debug CSIDE Tx registers*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_CSIDE_TX0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|utx_tpcside_tx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31 								   */
name|wtp
operator|->
name|utx_tpcside_tx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
block|}
comment|/*Get SGE debug data high index 9*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_9
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_work_req_pkt
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_work_req_pkt
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
comment|/*Get LE DB response count*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_LE_DB_REQ_RSP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|le_db_rsp_cnt
operator|.
name|sop
operator|=
name|value
operator|&
literal|0xF
expr_stmt|;
name|wtp
operator|->
name|le_db_rsp_cnt
operator|.
name|eop
operator|=
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xF
expr_stmt|;
comment|/*Get TP debug Eside PKTx*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_ESIDE_PKT0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tp_dbg_eside_pktx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
name|wtp
operator|->
name|tp_dbg_eside_pktx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
block|}
comment|/* Get data responses from core to PCIE*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_DMAW_SOP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_DMAW_EOP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|pcie_core_dmaw
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_DMAI_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|sop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|sop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
comment|/* no eop for interrups, just fake it.*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|eop
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|wtp
operator|->
name|pcie_core_dmai
operator|.
name|eop
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
name|rc
operator|=
name|write_compression_hdr
argument_list|(
operator|&
name|scratch_buff
argument_list|,
name|dbg_buff
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
goto|goto
name|err1
goto|;
name|rc
operator|=
name|compress_buff
argument_list|(
operator|&
name|scratch_buff
argument_list|,
name|dbg_buff
argument_list|)
expr_stmt|;
name|err1
label|:
name|release_scratch_buff
argument_list|(
operator|&
name|scratch_buff
argument_list|,
name|dbg_buff
argument_list|)
expr_stmt|;
name|err
label|:
return|return
name|rc
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|t6_wtp_data
parameter_list|(
name|struct
name|cudbg_init
modifier|*
name|pdbg_init
parameter_list|,
name|struct
name|cudbg_buffer
modifier|*
name|dbg_buff
parameter_list|,
name|struct
name|cudbg_error
modifier|*
name|cudbg_err
parameter_list|)
block|{
name|struct
name|adapter
modifier|*
name|padap
init|=
name|pdbg_init
operator|->
name|adap
decl_stmt|;
name|struct
name|sge_debug_reg_data
modifier|*
name|sge_dbg_reg
init|=
name|NULL
decl_stmt|;
name|struct
name|cudbg_buffer
name|scratch_buff
decl_stmt|;
name|struct
name|tp_mib_data
modifier|*
name|ptp_mib
init|=
name|NULL
decl_stmt|;
name|struct
name|wtp_data
modifier|*
name|wtp
decl_stmt|;
name|u32
name|Sge_Dbg
index|[
literal|32
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
name|u32
name|value
init|=
literal|0
decl_stmt|;
name|u32
name|i
init|=
literal|0
decl_stmt|;
name|u32
name|drop
init|=
literal|0
decl_stmt|;
name|u32
name|err
init|=
literal|0
decl_stmt|;
name|u32
name|offset
decl_stmt|;
name|int
name|rc
init|=
literal|0
decl_stmt|;
name|rc
operator|=
name|get_scratch_buff
argument_list|(
name|dbg_buff
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wtp_data
argument_list|)
argument_list|,
operator|&
name|scratch_buff
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
goto|goto
name|err
goto|;
name|offset
operator|=
name|scratch_buff
operator|.
name|offset
expr_stmt|;
name|wtp
operator|=
operator|(
expr|struct
name|wtp_data
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|scratch_buff
operator|.
name|data
operator|+
name|offset
operator|)
expr_stmt|;
name|read_sge_debug_data
argument_list|(
name|pdbg_init
argument_list|,
name|Sge_Dbg
argument_list|)
expr_stmt|;
name|read_tp_mib_data
argument_list|(
name|pdbg_init
argument_list|,
operator|&
name|ptp_mib
argument_list|)
expr_stmt|;
name|sge_dbg_reg
operator|=
operator|(
expr|struct
name|sge_debug_reg_data
operator|*
operator|)
operator|&
name|Sge_Dbg
index|[
literal|0
index|]
expr_stmt|;
comment|/*# TX PATH*/
comment|/*PCIE CMD STAT2*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_T5_CMD_STAT2
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat2
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat2
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_7
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_cmd_req
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_T5_CMD_STAT3
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat3
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|wtp
operator|->
name|pcie_cmd_stat3
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
comment|/*Get command Resposes from PCIE to SGE*/
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|pcie_sge_cmd_rsp
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PC_Rsp_EOP0_cnt
expr_stmt|;
comment|/* Get commands sent from SGE to CIM/uP*/
name|wtp
operator|->
name|sge_cim
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_SOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_cim
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_SOP1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_cim
operator|.
name|eop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_EOP0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_cim
operator|.
name|eop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_CIM_EOP1_cnt
expr_stmt|;
comment|/*Get SGE debug data high index 9*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_9
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_work_req_pkt
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_work_req_pkt
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_T5_DMA_STAT2
operator|+
operator|(
name|i
operator|*
literal|0x10
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2_core
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0x0F
expr_stmt|;
name|wtp
operator|->
name|pcie_dma1_stat2_core
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0x0F
expr_stmt|;
block|}
comment|/* Get DMA0 stats3*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_PCIE_T5_DMA_STAT3
operator|+
operator|(
name|i
operator|*
literal|0x10
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pcie_t5_dma_stat3
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xFF
expr_stmt|;
name|wtp
operator|->
name|pcie_t5_dma_stat3
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
comment|/* Get ULP SE CNT CHx*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_ULP_TX_SE_CNT_CH0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|ulp_se_cnt_chx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|ulp_se_cnt_chx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
block|}
comment|/* Get TP_DBG_CSIDE registers*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_CSIDE_RX0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|utx_tpcside
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|utx_tpcside
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
name|wtp
operator|->
name|tpcside_rxarb
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 12:15*/
name|wtp
operator|->
name|tpcside_rxarb
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 8:11*/
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_ESIDE_PKT0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tpeside_mps
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|tpeside_mps
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_TX_SE_CNT_TP01
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tp_mps
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|tp_mps
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|tp_mps
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31 								    */
name|wtp
operator|->
name|tp_mps
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23 								    */
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_TX_SE_CNT_MAC01
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mps_xgm
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|mps_xgm
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|mps_xgm
operator|.
name|sop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31 								     */
name|wtp
operator|->
name|mps_xgm
operator|.
name|eop
index|[
operator|(
name|i
operator|*
literal|2
operator|)
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23 								     */
block|}
comment|/* Get MAC PORTx PKT COUNT*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x3081c
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_pkt_count
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_pkt_count
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_pkt_count
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_pkt_count
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x30f20
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_aframestra_ok
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
name|wtp
operator|->
name|mac_portx_aframestra_ok
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
block|}
comment|/*MAC_PORT_MTIP_1G10G_TX_etherStatsPkts*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x30f60
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_portx_etherstatspkts
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
name|wtp
operator|->
name|mac_portx_etherstatspkts
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
block|}
comment|/*RX path*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_7
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx7
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
comment|/*Get SGE debug data high index 1*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_1
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx1
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_SGE_DEBUG_DATA_HIGH_INDEX_9
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|20
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
name|wtp
operator|->
name|sge_debug_data_high_indx9
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0x0F
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_CSIDE_TX0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|utx_tpcside_tx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31 								   */
name|wtp
operator|->
name|utx_tpcside_tx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
block|}
comment|/*ULP_RX input/output*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_ULP_RX_SE_CNT_CH0
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|pmrx_ulprx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 4:7*/
name|wtp
operator|->
name|pmrx_ulprx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 0:3*/
name|wtp
operator|->
name|ulprx_tpcside
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|28
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 28:31*/
name|wtp
operator|->
name|ulprx_tpcside
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
comment|/*bits 24:27*/
block|}
comment|/*Get LE DB response count*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
name|A_LE_DB_REQ_RSP_CNT
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|le_db_rsp_cnt
operator|.
name|sop
operator|=
name|value
operator|&
literal|0xF
expr_stmt|;
name|wtp
operator|->
name|le_db_rsp_cnt
operator|.
name|eop
operator|=
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xF
expr_stmt|;
comment|/*Get TP debug Eside PKTx*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|t4_tp_pio_read
argument_list|(
name|padap
argument_list|,
operator|&
name|value
argument_list|,
literal|1
argument_list|,
call|(
name|u32
call|)
argument_list|(
name|A_TP_DBG_ESIDE_PKT0
operator|+
name|i
argument_list|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|tp_dbg_eside_pktx
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|12
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
name|wtp
operator|->
name|tp_dbg_eside_pktx
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xF
operator|)
expr_stmt|;
block|}
name|drop
operator|=
literal|0
expr_stmt|;
comment|/*MPS_RX_SE_CNT_OUT01*/
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_RX_SE_CNT_OUT01
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mps_tp
operator|.
name|sop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 8:15*/
name|wtp
operator|->
name|mps_tp
operator|.
name|eop
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 0:7*/
name|wtp
operator|->
name|mps_tp
operator|.
name|sop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 24:31*/
name|wtp
operator|->
name|mps_tp
operator|.
name|eop
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bit 16:23*/
name|drop
operator|=
name|ptp_mib
operator|->
name|TP_MIB_TNL_CNG_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_TNL_CNG_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_CHN_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_CHN_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_FCOE_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_FCOE_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_VLN_DROP_0
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_OFD_VLN_DROP_1
operator|.
name|value
expr_stmt|;
name|drop
operator|+=
name|ptp_mib
operator|->
name|TP_MIB_USM_DROP
operator|.
name|value
expr_stmt|;
name|wtp
operator|->
name|mps_tp
operator|.
name|drops
operator|=
name|drop
expr_stmt|;
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_RX_SE_CNT_IN0
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|xgm_mps
operator|.
name|sop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bits 8:15*/
name|wtp
operator|->
name|xgm_mps
operator|.
name|eop
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|value
operator|>>
literal|0
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/*bits 0:7*/
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_RX_CLS_DROP_CNT0
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
operator|(
name|value
operator|&
literal|0xFFFF
operator|)
operator|+
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0xFFFF
operator|)
expr_stmt|;
block|}
name|wtp
operator|->
name|xgm_mps
operator|.
name|cls_drop
operator|=
name|drop
operator|&
literal|0xFF
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x30e20
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_aframestra_ok
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_aframestra_ok
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
block|}
comment|/*MAC_PORT_MTIP_1G10G_RX_etherStatsPkts*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
literal|0x30e60
operator|+
operator|(
operator|(
name|i
operator|*
literal|4
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_etherstatspkts
operator|.
name|sop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
name|wtp
operator|->
name|mac_porrx_etherstatspkts
operator|.
name|eop
index|[
name|i
index|]
operator|=
name|value
operator|&
literal|0xff
expr_stmt|;
block|}
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|0
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int0_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|1
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int1_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|2
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int2_cnt
expr_stmt|;
name|wtp
operator|->
name|sge_pcie_ints
operator|.
name|sop
index|[
literal|3
index|]
operator|=
name|sge_dbg_reg
operator|->
name|debug_PD_Req_Int3_cnt
expr_stmt|;
comment|/* Add up the overflow drops on all 4 ports.*/
name|drop
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_LB_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_DROP_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|2
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_LB_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|A_MPS_STAT_RX_BG_0_MAC_TRUNC_FRAME_L
operator|+
operator|(
name|i
operator|<<
literal|3
operator|)
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_LB_PORT_DROP_FRAMES
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|drop
operator|+=
name|value
expr_stmt|;
block|}
name|wtp
operator|->
name|xgm_mps
operator|.
name|drop
operator|=
operator|(
name|drop
operator|&
literal|0xFF
operator|)
expr_stmt|;
comment|/* Add up the MPS errors that should result in dropped packets*/
name|err
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_MTU_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_CRC_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LEN_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LEN_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_SYM_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_SYM_ERROR_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LESS_64B_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|t4_read_reg
argument_list|(
name|padap
argument_list|,
operator|(
name|T5_PORT0_REG
argument_list|(
name|A_MPS_PORT_STAT_RX_PORT_LESS_64B_L
argument_list|)
operator|+
operator|(
name|i
operator|*
name|T5_PORT_STRIDE
operator|)
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
block|}
name|wtp
operator|->
name|xgm_mps
operator|.
name|err
operator|=
operator|(
name|err
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|rc
operator|=
name|write_compression_hdr
argument_list|(
operator|&
name|scratch_buff
argument_list|,
name|dbg_buff
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
goto|goto
name|err1
goto|;
name|rc
operator|=
name|compress_buff
argument_list|(
operator|&
name|scratch_buff
argument_list|,
name|dbg_buff
argument_list|)
expr_stmt|;
name|err1
label|:
name|release_scratch_buff
argument_list|(
operator|&
name|scratch_buff
argument_list|,
name|dbg_buff
argument_list|)
expr_stmt|;
name|err
label|:
return|return
name|rc
return|;
block|}
end_function

begin_function
name|int
name|collect_wtp_data
parameter_list|(
name|struct
name|cudbg_init
modifier|*
name|pdbg_init
parameter_list|,
name|struct
name|cudbg_buffer
modifier|*
name|dbg_buff
parameter_list|,
name|struct
name|cudbg_error
modifier|*
name|cudbg_err
parameter_list|)
block|{
name|struct
name|adapter
modifier|*
name|padap
init|=
name|pdbg_init
operator|->
name|adap
decl_stmt|;
name|int
name|rc
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|is_t5
argument_list|(
name|padap
argument_list|)
condition|)
name|rc
operator|=
name|t5_wtp_data
argument_list|(
name|pdbg_init
argument_list|,
name|dbg_buff
argument_list|,
name|cudbg_err
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|is_t6
argument_list|(
name|padap
argument_list|)
condition|)
name|rc
operator|=
name|t6_wtp_data
argument_list|(
name|pdbg_init
argument_list|,
name|dbg_buff
argument_list|,
name|cudbg_err
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
end_function

end_unit

