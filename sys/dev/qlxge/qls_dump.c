begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2013-2014 Qlogic Corporation  * All rights reserved.  *  *  Redistribution and use in source and binary forms, with or without  *  modification, are permitted provided that the following conditions  *  are met:  *  *  1. Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  *  2. Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in the  *     documentation and/or other materials provided with the distribution.  *  *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"  *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE  *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  *  POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * File: qls_dump.c  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"qls_os.h"
end_include

begin_include
include|#
directive|include
file|"qls_hw.h"
end_include

begin_include
include|#
directive|include
file|"qls_def.h"
end_include

begin_include
include|#
directive|include
file|"qls_glbl.h"
end_include

begin_include
include|#
directive|include
file|"qls_dump.h"
end_include

begin_decl_stmt
name|qls_mpi_coredump_t
name|ql_mpi_coredump
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|Q81_CORE_SEG_NUM
value|1
end_define

begin_define
define|#
directive|define
name|Q81_TEST_LOGIC_SEG_NUM
value|2
end_define

begin_define
define|#
directive|define
name|Q81_RMII_SEG_NUM
value|3
end_define

begin_define
define|#
directive|define
name|Q81_FCMAC1_SEG_NUM
value|4
end_define

begin_define
define|#
directive|define
name|Q81_FCMAC2_SEG_NUM
value|5
end_define

begin_define
define|#
directive|define
name|Q81_FC1_MBOX_SEG_NUM
value|6
end_define

begin_define
define|#
directive|define
name|Q81_IDE_SEG_NUM
value|7
end_define

begin_define
define|#
directive|define
name|Q81_NIC1_MBOX_SEG_NUM
value|8
end_define

begin_define
define|#
directive|define
name|Q81_SMBUS_SEG_NUM
value|9
end_define

begin_define
define|#
directive|define
name|Q81_FC2_MBOX_SEG_NUM
value|10
end_define

begin_define
define|#
directive|define
name|Q81_NIC2_MBOX_SEG_NUM
value|11
end_define

begin_define
define|#
directive|define
name|Q81_I2C_SEG_NUM
value|12
end_define

begin_define
define|#
directive|define
name|Q81_MEMC_SEG_NUM
value|13
end_define

begin_define
define|#
directive|define
name|Q81_PBUS_SEG_NUM
value|14
end_define

begin_define
define|#
directive|define
name|Q81_MDE_SEG_NUM
value|15
end_define

begin_define
define|#
directive|define
name|Q81_NIC1_CONTROL_SEG_NUM
value|16
end_define

begin_define
define|#
directive|define
name|Q81_NIC2_CONTROL_SEG_NUM
value|17
end_define

begin_define
define|#
directive|define
name|Q81_NIC1_XGMAC_SEG_NUM
value|18
end_define

begin_define
define|#
directive|define
name|Q81_NIC2_XGMAC_SEG_NUM
value|19
end_define

begin_define
define|#
directive|define
name|Q81_WCS_RAM_SEG_NUM
value|20
end_define

begin_define
define|#
directive|define
name|Q81_MEMC_RAM_SEG_NUM
value|21
end_define

begin_define
define|#
directive|define
name|Q81_XAUI1_AN_SEG_NUM
value|22
end_define

begin_define
define|#
directive|define
name|Q81_XAUI1_HSS_PCS_SEG_NUM
value|23
end_define

begin_define
define|#
directive|define
name|Q81_XFI1_AN_SEG_NUM
value|24
end_define

begin_define
define|#
directive|define
name|Q81_XFI1_TRAIN_SEG_NUM
value|25
end_define

begin_define
define|#
directive|define
name|Q81_XFI1_HSS_PCS_SEG_NUM
value|26
end_define

begin_define
define|#
directive|define
name|Q81_XFI1_HSS_TX_SEG_NUM
value|27
end_define

begin_define
define|#
directive|define
name|Q81_XFI1_HSS_RX_SEG_NUM
value|28
end_define

begin_define
define|#
directive|define
name|Q81_XFI1_HSS_PLL_SEG_NUM
value|29
end_define

begin_define
define|#
directive|define
name|Q81_INTR_STATES_SEG_NUM
value|31
end_define

begin_define
define|#
directive|define
name|Q81_ETS_SEG_NUM
value|34
end_define

begin_define
define|#
directive|define
name|Q81_PROBE_DUMP_SEG_NUM
value|35
end_define

begin_define
define|#
directive|define
name|Q81_ROUTING_INDEX_SEG_NUM
value|36
end_define

begin_define
define|#
directive|define
name|Q81_MAC_PROTOCOL_SEG_NUM
value|37
end_define

begin_define
define|#
directive|define
name|Q81_XAUI2_AN_SEG_NUM
value|38
end_define

begin_define
define|#
directive|define
name|Q81_XAUI2_HSS_PCS_SEG_NUM
value|39
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_AN_SEG_NUM
value|40
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_TRAIN_SEG_NUM
value|41
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_HSS_PCS_SEG_NUM
value|42
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_HSS_TX_SEG_NUM
value|43
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_HSS_RX_SEG_NUM
value|44
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_HSS_PLL_SEG_NUM
value|45
end_define

begin_define
define|#
directive|define
name|Q81_WQC1_SEG_NUM
value|46
end_define

begin_define
define|#
directive|define
name|Q81_CQC1_SEG_NUM
value|47
end_define

begin_define
define|#
directive|define
name|Q81_WQC2_SEG_NUM
value|48
end_define

begin_define
define|#
directive|define
name|Q81_CQC2_SEG_NUM
value|49
end_define

begin_define
define|#
directive|define
name|Q81_SEM_REGS_SEG_NUM
value|50
end_define

begin_enum
enum|enum
block|{
name|Q81_PAUSE_SRC_LO
init|=
literal|0x00000100
block|,
name|Q81_PAUSE_SRC_HI
init|=
literal|0x00000104
block|,
name|Q81_GLOBAL_CFG
init|=
literal|0x00000108
block|,
name|Q81_GLOBAL_CFG_RESET
init|=
operator|(
literal|1
operator|<<
literal|0
operator|)
block|,
comment|/*Control*/
name|Q81_GLOBAL_CFG_JUMBO
init|=
operator|(
literal|1
operator|<<
literal|6
operator|)
block|,
comment|/*Control*/
name|Q81_GLOBAL_CFG_TX_STAT_EN
init|=
operator|(
literal|1
operator|<<
literal|10
operator|)
block|,
comment|/*Control*/
name|Q81_GLOBAL_CFG_RX_STAT_EN
init|=
operator|(
literal|1
operator|<<
literal|11
operator|)
block|,
comment|/*Control*/
name|Q81_TX_CFG
init|=
literal|0x0000010c
block|,
name|Q81_TX_CFG_RESET
init|=
operator|(
literal|1
operator|<<
literal|0
operator|)
block|,
comment|/*Control*/
name|Q81_TX_CFG_EN
init|=
operator|(
literal|1
operator|<<
literal|1
operator|)
block|,
comment|/*Control*/
name|Q81_TX_CFG_PREAM
init|=
operator|(
literal|1
operator|<<
literal|2
operator|)
block|,
comment|/*Control*/
name|Q81_RX_CFG
init|=
literal|0x00000110
block|,
name|Q81_RX_CFG_RESET
init|=
operator|(
literal|1
operator|<<
literal|0
operator|)
block|,
comment|/*Control*/
name|Q81_RX_CFG_EN
init|=
operator|(
literal|1
operator|<<
literal|1
operator|)
block|,
comment|/*Control*/
name|Q81_RX_CFG_PREAM
init|=
operator|(
literal|1
operator|<<
literal|2
operator|)
block|,
comment|/*Control*/
name|Q81_FLOW_CTL
init|=
literal|0x0000011c
block|,
name|Q81_PAUSE_OPCODE
init|=
literal|0x00000120
block|,
name|Q81_PAUSE_TIMER
init|=
literal|0x00000124
block|,
name|Q81_PAUSE_FRM_DEST_LO
init|=
literal|0x00000128
block|,
name|Q81_PAUSE_FRM_DEST_HI
init|=
literal|0x0000012c
block|,
name|Q81_MAC_TX_PARAMS
init|=
literal|0x00000134
block|,
name|Q81_MAC_TX_PARAMS_JUMBO
init|=
operator|(
literal|1
operator|<<
literal|31
operator|)
block|,
comment|/*Control*/
name|Q81_MAC_TX_PARAMS_SIZE_SHIFT
init|=
literal|16
block|,
comment|/*Control*/
name|Q81_MAC_RX_PARAMS
init|=
literal|0x00000138
block|,
name|Q81_MAC_SYS_INT
init|=
literal|0x00000144
block|,
name|Q81_MAC_SYS_INT_MASK
init|=
literal|0x00000148
block|,
name|Q81_MAC_MGMT_INT
init|=
literal|0x0000014c
block|,
name|Q81_MAC_MGMT_IN_MASK
init|=
literal|0x00000150
block|,
name|Q81_EXT_ARB_MODE
init|=
literal|0x000001fc
block|,
name|Q81_TX_PKTS
init|=
literal|0x00000200
block|,
name|Q81_TX_PKTS_LO
init|=
literal|0x00000204
block|,
name|Q81_TX_BYTES
init|=
literal|0x00000208
block|,
name|Q81_TX_BYTES_LO
init|=
literal|0x0000020C
block|,
name|Q81_TX_MCAST_PKTS
init|=
literal|0x00000210
block|,
name|Q81_TX_MCAST_PKTS_LO
init|=
literal|0x00000214
block|,
name|Q81_TX_BCAST_PKTS
init|=
literal|0x00000218
block|,
name|Q81_TX_BCAST_PKTS_LO
init|=
literal|0x0000021C
block|,
name|Q81_TX_UCAST_PKTS
init|=
literal|0x00000220
block|,
name|Q81_TX_UCAST_PKTS_LO
init|=
literal|0x00000224
block|,
name|Q81_TX_CTL_PKTS
init|=
literal|0x00000228
block|,
name|Q81_TX_CTL_PKTS_LO
init|=
literal|0x0000022c
block|,
name|Q81_TX_PAUSE_PKTS
init|=
literal|0x00000230
block|,
name|Q81_TX_PAUSE_PKTS_LO
init|=
literal|0x00000234
block|,
name|Q81_TX_64_PKT
init|=
literal|0x00000238
block|,
name|Q81_TX_64_PKT_LO
init|=
literal|0x0000023c
block|,
name|Q81_TX_65_TO_127_PKT
init|=
literal|0x00000240
block|,
name|Q81_TX_65_TO_127_PKT_LO
init|=
literal|0x00000244
block|,
name|Q81_TX_128_TO_255_PKT
init|=
literal|0x00000248
block|,
name|Q81_TX_128_TO_255_PKT_LO
init|=
literal|0x0000024c
block|,
name|Q81_TX_256_511_PKT
init|=
literal|0x00000250
block|,
name|Q81_TX_256_511_PKT_LO
init|=
literal|0x00000254
block|,
name|Q81_TX_512_TO_1023_PKT
init|=
literal|0x00000258
block|,
name|Q81_TX_512_TO_1023_PKT_LO
init|=
literal|0x0000025c
block|,
name|Q81_TX_1024_TO_1518_PKT
init|=
literal|0x00000260
block|,
name|Q81_TX_1024_TO_1518_PKT_LO
init|=
literal|0x00000264
block|,
name|Q81_TX_1519_TO_MAX_PKT
init|=
literal|0x00000268
block|,
name|Q81_TX_1519_TO_MAX_PKT_LO
init|=
literal|0x0000026c
block|,
name|Q81_TX_UNDERSIZE_PKT
init|=
literal|0x00000270
block|,
name|Q81_TX_UNDERSIZE_PKT_LO
init|=
literal|0x00000274
block|,
name|Q81_TX_OVERSIZE_PKT
init|=
literal|0x00000278
block|,
name|Q81_TX_OVERSIZE_PKT_LO
init|=
literal|0x0000027c
block|,
name|Q81_RX_HALF_FULL_DET
init|=
literal|0x000002a0
block|,
name|Q81_TX_HALF_FULL_DET_LO
init|=
literal|0x000002a4
block|,
name|Q81_RX_OVERFLOW_DET
init|=
literal|0x000002a8
block|,
name|Q81_TX_OVERFLOW_DET_LO
init|=
literal|0x000002ac
block|,
name|Q81_RX_HALF_FULL_MASK
init|=
literal|0x000002b0
block|,
name|Q81_TX_HALF_FULL_MASK_LO
init|=
literal|0x000002b4
block|,
name|Q81_RX_OVERFLOW_MASK
init|=
literal|0x000002b8
block|,
name|Q81_TX_OVERFLOW_MASK_LO
init|=
literal|0x000002bc
block|,
name|Q81_STAT_CNT_CTL
init|=
literal|0x000002c0
block|,
name|Q81_STAT_CNT_CTL_CLEAR_TX
init|=
operator|(
literal|1
operator|<<
literal|0
operator|)
block|,
comment|/*Control*/
name|Q81_STAT_CNT_CTL_CLEAR_RX
init|=
operator|(
literal|1
operator|<<
literal|1
operator|)
block|,
comment|/*Control*/
name|Q81_AUX_RX_HALF_FULL_DET
init|=
literal|0x000002d0
block|,
name|Q81_AUX_TX_HALF_FULL_DET
init|=
literal|0x000002d4
block|,
name|Q81_AUX_RX_OVERFLOW_DET
init|=
literal|0x000002d8
block|,
name|Q81_AUX_TX_OVERFLOW_DET
init|=
literal|0x000002dc
block|,
name|Q81_AUX_RX_HALF_FULL_MASK
init|=
literal|0x000002f0
block|,
name|Q81_AUX_TX_HALF_FULL_MASK
init|=
literal|0x000002f4
block|,
name|Q81_AUX_RX_OVERFLOW_MASK
init|=
literal|0x000002f8
block|,
name|Q81_AUX_TX_OVERFLOW_MASK
init|=
literal|0x000002fc
block|,
name|Q81_RX_BYTES
init|=
literal|0x00000300
block|,
name|Q81_RX_BYTES_LO
init|=
literal|0x00000304
block|,
name|Q81_RX_BYTES_OK
init|=
literal|0x00000308
block|,
name|Q81_RX_BYTES_OK_LO
init|=
literal|0x0000030c
block|,
name|Q81_RX_PKTS
init|=
literal|0x00000310
block|,
name|Q81_RX_PKTS_LO
init|=
literal|0x00000314
block|,
name|Q81_RX_PKTS_OK
init|=
literal|0x00000318
block|,
name|Q81_RX_PKTS_OK_LO
init|=
literal|0x0000031c
block|,
name|Q81_RX_BCAST_PKTS
init|=
literal|0x00000320
block|,
name|Q81_RX_BCAST_PKTS_LO
init|=
literal|0x00000324
block|,
name|Q81_RX_MCAST_PKTS
init|=
literal|0x00000328
block|,
name|Q81_RX_MCAST_PKTS_LO
init|=
literal|0x0000032c
block|,
name|Q81_RX_UCAST_PKTS
init|=
literal|0x00000330
block|,
name|Q81_RX_UCAST_PKTS_LO
init|=
literal|0x00000334
block|,
name|Q81_RX_UNDERSIZE_PKTS
init|=
literal|0x00000338
block|,
name|Q81_RX_UNDERSIZE_PKTS_LO
init|=
literal|0x0000033c
block|,
name|Q81_RX_OVERSIZE_PKTS
init|=
literal|0x00000340
block|,
name|Q81_RX_OVERSIZE_PKTS_LO
init|=
literal|0x00000344
block|,
name|Q81_RX_JABBER_PKTS
init|=
literal|0x00000348
block|,
name|Q81_RX_JABBER_PKTS_LO
init|=
literal|0x0000034c
block|,
name|Q81_RX_UNDERSIZE_FCERR_PKTS
init|=
literal|0x00000350
block|,
name|Q81_RX_UNDERSIZE_FCERR_PKTS_LO
init|=
literal|0x00000354
block|,
name|Q81_RX_DROP_EVENTS
init|=
literal|0x00000358
block|,
name|Q81_RX_DROP_EVENTS_LO
init|=
literal|0x0000035c
block|,
name|Q81_RX_FCERR_PKTS
init|=
literal|0x00000360
block|,
name|Q81_RX_FCERR_PKTS_LO
init|=
literal|0x00000364
block|,
name|Q81_RX_ALIGN_ERR
init|=
literal|0x00000368
block|,
name|Q81_RX_ALIGN_ERR_LO
init|=
literal|0x0000036c
block|,
name|Q81_RX_SYMBOL_ERR
init|=
literal|0x00000370
block|,
name|Q81_RX_SYMBOL_ERR_LO
init|=
literal|0x00000374
block|,
name|Q81_RX_MAC_ERR
init|=
literal|0x00000378
block|,
name|Q81_RX_MAC_ERR_LO
init|=
literal|0x0000037c
block|,
name|Q81_RX_CTL_PKTS
init|=
literal|0x00000380
block|,
name|Q81_RX_CTL_PKTS_LO
init|=
literal|0x00000384
block|,
name|Q81_RX_PAUSE_PKTS
init|=
literal|0x00000388
block|,
name|Q81_RX_PAUSE_PKTS_LO
init|=
literal|0x0000038c
block|,
name|Q81_RX_64_PKTS
init|=
literal|0x00000390
block|,
name|Q81_RX_64_PKTS_LO
init|=
literal|0x00000394
block|,
name|Q81_RX_65_TO_127_PKTS
init|=
literal|0x00000398
block|,
name|Q81_RX_65_TO_127_PKTS_LO
init|=
literal|0x0000039c
block|,
name|Q81_RX_128_255_PKTS
init|=
literal|0x000003a0
block|,
name|Q81_RX_128_255_PKTS_LO
init|=
literal|0x000003a4
block|,
name|Q81_RX_256_511_PKTS
init|=
literal|0x000003a8
block|,
name|Q81_RX_256_511_PKTS_LO
init|=
literal|0x000003ac
block|,
name|Q81_RX_512_TO_1023_PKTS
init|=
literal|0x000003b0
block|,
name|Q81_RX_512_TO_1023_PKTS_LO
init|=
literal|0x000003b4
block|,
name|Q81_RX_1024_TO_1518_PKTS
init|=
literal|0x000003b8
block|,
name|Q81_RX_1024_TO_1518_PKTS_LO
init|=
literal|0x000003bc
block|,
name|Q81_RX_1519_TO_MAX_PKTS
init|=
literal|0x000003c0
block|,
name|Q81_RX_1519_TO_MAX_PKTS_LO
init|=
literal|0x000003c4
block|,
name|Q81_RX_LEN_ERR_PKTS
init|=
literal|0x000003c8
block|,
name|Q81_RX_LEN_ERR_PKTS_LO
init|=
literal|0x000003cc
block|,
name|Q81_MDIO_TX_DATA
init|=
literal|0x00000400
block|,
name|Q81_MDIO_RX_DATA
init|=
literal|0x00000410
block|,
name|Q81_MDIO_CMD
init|=
literal|0x00000420
block|,
name|Q81_MDIO_PHY_ADDR
init|=
literal|0x00000430
block|,
name|Q81_MDIO_PORT
init|=
literal|0x00000440
block|,
name|Q81_MDIO_STATUS
init|=
literal|0x00000450
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES0
init|=
literal|0x00000500
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES0_LO
init|=
literal|0x00000504
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES1
init|=
literal|0x00000508
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES1_LO
init|=
literal|0x0000050C
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES2
init|=
literal|0x00000510
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES2_LO
init|=
literal|0x00000514
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES3
init|=
literal|0x00000518
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES3_LO
init|=
literal|0x0000051C
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES4
init|=
literal|0x00000520
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES4_LO
init|=
literal|0x00000524
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES5
init|=
literal|0x00000528
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES5_LO
init|=
literal|0x0000052C
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES6
init|=
literal|0x00000530
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES6_LO
init|=
literal|0x00000534
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES7
init|=
literal|0x00000538
block|,
name|Q81_TX_CBFC_PAUSE_FRAMES7_LO
init|=
literal|0x0000053C
block|,
name|Q81_TX_FCOE_PKTS
init|=
literal|0x00000540
block|,
name|Q81_TX_FCOE_PKTS_LO
init|=
literal|0x00000544
block|,
name|Q81_TX_MGMT_PKTS
init|=
literal|0x00000548
block|,
name|Q81_TX_MGMT_PKTS_LO
init|=
literal|0x0000054C
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES0
init|=
literal|0x00000568
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES0_LO
init|=
literal|0x0000056C
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES1
init|=
literal|0x00000570
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES1_LO
init|=
literal|0x00000574
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES2
init|=
literal|0x00000578
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES2_LO
init|=
literal|0x0000057C
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES3
init|=
literal|0x00000580
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES3_LO
init|=
literal|0x00000584
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES4
init|=
literal|0x00000588
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES4_LO
init|=
literal|0x0000058C
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES5
init|=
literal|0x00000590
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES5_LO
init|=
literal|0x00000594
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES6
init|=
literal|0x00000598
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES6_LO
init|=
literal|0x0000059C
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES7
init|=
literal|0x000005A0
block|,
name|Q81_RX_CBFC_PAUSE_FRAMES7_LO
init|=
literal|0x000005A4
block|,
name|Q81_RX_FCOE_PKTS
init|=
literal|0x000005A8
block|,
name|Q81_RX_FCOE_PKTS_LO
init|=
literal|0x000005AC
block|,
name|Q81_RX_MGMT_PKTS
init|=
literal|0x000005B0
block|,
name|Q81_RX_MGMT_PKTS_LO
init|=
literal|0x000005B4
block|,
name|Q81_RX_NIC_FIFO_DROP
init|=
literal|0x000005B8
block|,
name|Q81_RX_NIC_FIFO_DROP_LO
init|=
literal|0x000005BC
block|,
name|Q81_RX_FCOE_FIFO_DROP
init|=
literal|0x000005C0
block|,
name|Q81_RX_FCOE_FIFO_DROP_LO
init|=
literal|0x000005C4
block|,
name|Q81_RX_MGMT_FIFO_DROP
init|=
literal|0x000005C8
block|,
name|Q81_RX_MGMT_FIFO_DROP_LO
init|=
literal|0x000005CC
block|,
name|Q81_RX_PKTS_PRIORITY0
init|=
literal|0x00000600
block|,
name|Q81_RX_PKTS_PRIORITY0_LO
init|=
literal|0x00000604
block|,
name|Q81_RX_PKTS_PRIORITY1
init|=
literal|0x00000608
block|,
name|Q81_RX_PKTS_PRIORITY1_LO
init|=
literal|0x0000060C
block|,
name|Q81_RX_PKTS_PRIORITY2
init|=
literal|0x00000610
block|,
name|Q81_RX_PKTS_PRIORITY2_LO
init|=
literal|0x00000614
block|,
name|Q81_RX_PKTS_PRIORITY3
init|=
literal|0x00000618
block|,
name|Q81_RX_PKTS_PRIORITY3_LO
init|=
literal|0x0000061C
block|,
name|Q81_RX_PKTS_PRIORITY4
init|=
literal|0x00000620
block|,
name|Q81_RX_PKTS_PRIORITY4_LO
init|=
literal|0x00000624
block|,
name|Q81_RX_PKTS_PRIORITY5
init|=
literal|0x00000628
block|,
name|Q81_RX_PKTS_PRIORITY5_LO
init|=
literal|0x0000062C
block|,
name|Q81_RX_PKTS_PRIORITY6
init|=
literal|0x00000630
block|,
name|Q81_RX_PKTS_PRIORITY6_LO
init|=
literal|0x00000634
block|,
name|Q81_RX_PKTS_PRIORITY7
init|=
literal|0x00000638
block|,
name|Q81_RX_PKTS_PRIORITY7_LO
init|=
literal|0x0000063C
block|,
name|Q81_RX_OCTETS_PRIORITY0
init|=
literal|0x00000640
block|,
name|Q81_RX_OCTETS_PRIORITY0_LO
init|=
literal|0x00000644
block|,
name|Q81_RX_OCTETS_PRIORITY1
init|=
literal|0x00000648
block|,
name|Q81_RX_OCTETS_PRIORITY1_LO
init|=
literal|0x0000064C
block|,
name|Q81_RX_OCTETS_PRIORITY2
init|=
literal|0x00000650
block|,
name|Q81_RX_OCTETS_PRIORITY2_LO
init|=
literal|0x00000654
block|,
name|Q81_RX_OCTETS_PRIORITY3
init|=
literal|0x00000658
block|,
name|Q81_RX_OCTETS_PRIORITY3_LO
init|=
literal|0x0000065C
block|,
name|Q81_RX_OCTETS_PRIORITY4
init|=
literal|0x00000660
block|,
name|Q81_RX_OCTETS_PRIORITY4_LO
init|=
literal|0x00000664
block|,
name|Q81_RX_OCTETS_PRIORITY5
init|=
literal|0x00000668
block|,
name|Q81_RX_OCTETS_PRIORITY5_LO
init|=
literal|0x0000066C
block|,
name|Q81_RX_OCTETS_PRIORITY6
init|=
literal|0x00000670
block|,
name|Q81_RX_OCTETS_PRIORITY6_LO
init|=
literal|0x00000674
block|,
name|Q81_RX_OCTETS_PRIORITY7
init|=
literal|0x00000678
block|,
name|Q81_RX_OCTETS_PRIORITY7_LO
init|=
literal|0x0000067C
block|,
name|Q81_TX_PKTS_PRIORITY0
init|=
literal|0x00000680
block|,
name|Q81_TX_PKTS_PRIORITY0_LO
init|=
literal|0x00000684
block|,
name|Q81_TX_PKTS_PRIORITY1
init|=
literal|0x00000688
block|,
name|Q81_TX_PKTS_PRIORITY1_LO
init|=
literal|0x0000068C
block|,
name|Q81_TX_PKTS_PRIORITY2
init|=
literal|0x00000690
block|,
name|Q81_TX_PKTS_PRIORITY2_LO
init|=
literal|0x00000694
block|,
name|Q81_TX_PKTS_PRIORITY3
init|=
literal|0x00000698
block|,
name|Q81_TX_PKTS_PRIORITY3_LO
init|=
literal|0x0000069C
block|,
name|Q81_TX_PKTS_PRIORITY4
init|=
literal|0x000006A0
block|,
name|Q81_TX_PKTS_PRIORITY4_LO
init|=
literal|0x000006A4
block|,
name|Q81_TX_PKTS_PRIORITY5
init|=
literal|0x000006A8
block|,
name|Q81_TX_PKTS_PRIORITY5_LO
init|=
literal|0x000006AC
block|,
name|Q81_TX_PKTS_PRIORITY6
init|=
literal|0x000006B0
block|,
name|Q81_TX_PKTS_PRIORITY6_LO
init|=
literal|0x000006B4
block|,
name|Q81_TX_PKTS_PRIORITY7
init|=
literal|0x000006B8
block|,
name|Q81_TX_PKTS_PRIORITY7_LO
init|=
literal|0x000006BC
block|,
name|Q81_TX_OCTETS_PRIORITY0
init|=
literal|0x000006C0
block|,
name|Q81_TX_OCTETS_PRIORITY0_LO
init|=
literal|0x000006C4
block|,
name|Q81_TX_OCTETS_PRIORITY1
init|=
literal|0x000006C8
block|,
name|Q81_TX_OCTETS_PRIORITY1_LO
init|=
literal|0x000006CC
block|,
name|Q81_TX_OCTETS_PRIORITY2
init|=
literal|0x000006D0
block|,
name|Q81_TX_OCTETS_PRIORITY2_LO
init|=
literal|0x000006D4
block|,
name|Q81_TX_OCTETS_PRIORITY3
init|=
literal|0x000006D8
block|,
name|Q81_TX_OCTETS_PRIORITY3_LO
init|=
literal|0x000006DC
block|,
name|Q81_TX_OCTETS_PRIORITY4
init|=
literal|0x000006E0
block|,
name|Q81_TX_OCTETS_PRIORITY4_LO
init|=
literal|0x000006E4
block|,
name|Q81_TX_OCTETS_PRIORITY5
init|=
literal|0x000006E8
block|,
name|Q81_TX_OCTETS_PRIORITY5_LO
init|=
literal|0x000006EC
block|,
name|Q81_TX_OCTETS_PRIORITY6
init|=
literal|0x000006F0
block|,
name|Q81_TX_OCTETS_PRIORITY6_LO
init|=
literal|0x000006F4
block|,
name|Q81_TX_OCTETS_PRIORITY7
init|=
literal|0x000006F8
block|,
name|Q81_TX_OCTETS_PRIORITY7_LO
init|=
literal|0x000006FC
block|,
name|Q81_RX_DISCARD_PRIORITY0
init|=
literal|0x00000700
block|,
name|Q81_RX_DISCARD_PRIORITY0_LO
init|=
literal|0x00000704
block|,
name|Q81_RX_DISCARD_PRIORITY1
init|=
literal|0x00000708
block|,
name|Q81_RX_DISCARD_PRIORITY1_LO
init|=
literal|0x0000070C
block|,
name|Q81_RX_DISCARD_PRIORITY2
init|=
literal|0x00000710
block|,
name|Q81_RX_DISCARD_PRIORITY2_LO
init|=
literal|0x00000714
block|,
name|Q81_RX_DISCARD_PRIORITY3
init|=
literal|0x00000718
block|,
name|Q81_RX_DISCARD_PRIORITY3_LO
init|=
literal|0x0000071C
block|,
name|Q81_RX_DISCARD_PRIORITY4
init|=
literal|0x00000720
block|,
name|Q81_RX_DISCARD_PRIORITY4_LO
init|=
literal|0x00000724
block|,
name|Q81_RX_DISCARD_PRIORITY5
init|=
literal|0x00000728
block|,
name|Q81_RX_DISCARD_PRIORITY5_LO
init|=
literal|0x0000072C
block|,
name|Q81_RX_DISCARD_PRIORITY6
init|=
literal|0x00000730
block|,
name|Q81_RX_DISCARD_PRIORITY6_LO
init|=
literal|0x00000734
block|,
name|Q81_RX_DISCARD_PRIORITY7
init|=
literal|0x00000738
block|,
name|Q81_RX_DISCARD_PRIORITY7_LO
init|=
literal|0x0000073C
block|}
enum|;
end_enum

begin_function
specifier|static
name|void
name|qls_mpid_seg_hdr
parameter_list|(
name|qls_mpid_seg_hdr_t
modifier|*
name|seg_hdr
parameter_list|,
name|uint32_t
name|seg_num
parameter_list|,
name|uint32_t
name|seg_size
parameter_list|,
name|unsigned
name|char
modifier|*
name|desc
parameter_list|)
block|{
name|memset
argument_list|(
name|seg_hdr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
argument_list|)
expr_stmt|;
name|seg_hdr
operator|->
name|cookie
operator|=
name|Q81_MPID_COOKIE
expr_stmt|;
name|seg_hdr
operator|->
name|seg_num
operator|=
name|seg_num
expr_stmt|;
name|seg_hdr
operator|->
name|seg_size
operator|=
name|seg_size
expr_stmt|;
name|memcpy
argument_list|(
name|seg_hdr
operator|->
name|desc
argument_list|,
name|desc
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|seg_hdr
operator|->
name|desc
argument_list|)
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_wait_reg_rdy
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
name|bit
parameter_list|,
name|uint32_t
name|err_bit
parameter_list|)
block|{
name|uint32_t
name|data
decl_stmt|;
name|int
name|count
init|=
literal|10
decl_stmt|;
while|while
condition|(
name|count
condition|)
block|{
name|data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|reg
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|&
name|err_bit
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
elseif|else
if|if
condition|(
name|data
operator|&
name|bit
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|qls_mdelay
argument_list|(
name|__func__
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|count
operator|--
expr_stmt|;
block|}
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_rd_mpi_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_ADDR
argument_list|,
name|Q81_CTL_PROC_ADDR_RDY
argument_list|,
name|Q81_CTL_PROC_ADDR_ERR
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_mpi_reg
goto|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_ADDR
argument_list|,
name|reg
operator||
name|Q81_CTL_PROC_ADDR_READ
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_ADDR
argument_list|,
name|Q81_CTL_PROC_ADDR_RDY
argument_list|,
name|Q81_CTL_PROC_ADDR_ERR
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_mpi_reg
goto|;
operator|*
name|data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_DATA
argument_list|)
expr_stmt|;
name|exit_qls_rd_mpi_reg
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_wr_mpi_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
name|data
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_ADDR
argument_list|,
name|Q81_CTL_PROC_ADDR_RDY
argument_list|,
name|Q81_CTL_PROC_ADDR_ERR
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_wr_mpi_reg
goto|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_DATA
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_ADDR
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_PROC_ADDR
argument_list|,
name|Q81_CTL_PROC_ADDR_RDY
argument_list|,
name|Q81_CTL_PROC_ADDR_ERR
argument_list|)
expr_stmt|;
name|exit_qls_wr_mpi_reg
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|Q81_TEST_LOGIC_FUNC_PORT_CONFIG
value|0x1002
end_define

begin_define
define|#
directive|define
name|Q81_INVALID_NUM
value|0xFFFFFFFF
end_define

begin_define
define|#
directive|define
name|Q81_NIC1_FUNC_ENABLE
value|0x00000001
end_define

begin_define
define|#
directive|define
name|Q81_NIC1_FUNC_MASK
value|0x0000000e
end_define

begin_define
define|#
directive|define
name|Q81_NIC1_FUNC_SHIFT
value|1
end_define

begin_define
define|#
directive|define
name|Q81_NIC2_FUNC_ENABLE
value|0x00000010
end_define

begin_define
define|#
directive|define
name|Q81_NIC2_FUNC_MASK
value|0x000000e0
end_define

begin_define
define|#
directive|define
name|Q81_NIC2_FUNC_SHIFT
value|5
end_define

begin_define
define|#
directive|define
name|Q81_FUNCTION_SHIFT
value|6
end_define

begin_function
specifier|static
name|uint32_t
name|qls_get_other_fnum
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|uint32_t
name|o_func
decl_stmt|;
name|uint32_t
name|test_logic
decl_stmt|;
name|uint32_t
name|nic1_fnum
init|=
name|Q81_INVALID_NUM
decl_stmt|;
name|uint32_t
name|nic2_fnum
init|=
name|Q81_INVALID_NUM
decl_stmt|;
name|ret
operator|=
name|qls_rd_mpi_reg
argument_list|(
name|ha
argument_list|,
name|Q81_TEST_LOGIC_FUNC_PORT_CONFIG
argument_list|,
operator|&
name|test_logic
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
operator|(
name|Q81_INVALID_NUM
operator|)
return|;
if|if
condition|(
name|test_logic
operator|&
name|Q81_NIC1_FUNC_ENABLE
condition|)
name|nic1_fnum
operator|=
operator|(
name|test_logic
operator|&
name|Q81_NIC1_FUNC_MASK
operator|)
operator|>>
name|Q81_NIC1_FUNC_SHIFT
expr_stmt|;
if|if
condition|(
name|test_logic
operator|&
name|Q81_NIC2_FUNC_ENABLE
condition|)
name|nic2_fnum
operator|=
operator|(
name|test_logic
operator|&
name|Q81_NIC2_FUNC_MASK
operator|)
operator|>>
name|Q81_NIC2_FUNC_SHIFT
expr_stmt|;
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|==
literal|0
condition|)
name|o_func
operator|=
name|nic2_fnum
expr_stmt|;
else|else
name|o_func
operator|=
name|nic1_fnum
expr_stmt|;
return|return
operator|(
name|o_func
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|uint32_t
name|qls_rd_ofunc_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|)
block|{
name|uint32_t
name|ofunc
decl_stmt|;
name|uint32_t
name|data
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|ofunc
operator|=
name|qls_get_other_fnum
argument_list|(
name|ha
argument_list|)
expr_stmt|;
if|if
condition|(
name|ofunc
operator|==
name|Q81_INVALID_NUM
condition|)
return|return
operator|(
name|Q81_INVALID_NUM
operator|)
return|;
name|reg
operator|=
name|Q81_CTL_PROC_ADDR_REG_BLOCK
operator||
operator|(
name|ofunc
operator|<<
name|Q81_FUNCTION_SHIFT
operator|)
operator||
name|reg
expr_stmt|;
name|ret
operator|=
name|qls_rd_mpi_reg
argument_list|(
name|ha
argument_list|,
name|reg
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
return|return
operator|(
name|Q81_INVALID_NUM
operator|)
return|;
return|return
operator|(
name|data
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|qls_wr_ofunc_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
name|value
parameter_list|)
block|{
name|uint32_t
name|ofunc
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|ofunc
operator|=
name|qls_get_other_fnum
argument_list|(
name|ha
argument_list|)
expr_stmt|;
if|if
condition|(
name|ofunc
operator|==
name|Q81_INVALID_NUM
condition|)
return|return;
name|reg
operator|=
name|Q81_CTL_PROC_ADDR_REG_BLOCK
operator||
operator|(
name|ofunc
operator|<<
name|Q81_FUNCTION_SHIFT
operator|)
operator||
name|reg
expr_stmt|;
name|ret
operator|=
name|qls_wr_mpi_reg
argument_list|(
name|ha
argument_list|,
name|reg
argument_list|,
name|value
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_wait_ofunc_reg_rdy
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
name|bit
parameter_list|,
name|uint32_t
name|err_bit
parameter_list|)
block|{
name|uint32_t
name|data
decl_stmt|;
name|int
name|count
init|=
literal|10
decl_stmt|;
while|while
condition|(
name|count
condition|)
block|{
name|data
operator|=
name|qls_rd_ofunc_reg
argument_list|(
name|ha
argument_list|,
name|reg
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|&
name|err_bit
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
elseif|else
if|if
condition|(
name|data
operator|&
name|bit
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|qls_mdelay
argument_list|(
name|__func__
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|count
operator|--
expr_stmt|;
block|}
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|Q81_XG_SERDES_ADDR_RDY
value|BIT_31
end_define

begin_define
define|#
directive|define
name|Q81_XG_SERDES_ADDR_READ
value|BIT_30
end_define

begin_function
specifier|static
name|int
name|qls_rd_ofunc_serdes_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
comment|/* wait for reg to come ready */
name|ret
operator|=
name|qls_wait_ofunc_reg_rdy
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_XG_SERDES_ADDR
operator|>>
literal|2
operator|)
argument_list|,
name|Q81_XG_SERDES_ADDR_RDY
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_ofunc_serdes_reg
goto|;
comment|/* set up for reg read */
name|qls_wr_ofunc_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_XG_SERDES_ADDR
operator|>>
literal|2
operator|)
argument_list|,
operator|(
name|reg
operator||
name|Q81_XG_SERDES_ADDR_READ
operator|)
argument_list|)
expr_stmt|;
comment|/* wait for reg to come ready */
name|ret
operator|=
name|qls_wait_ofunc_reg_rdy
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_XG_SERDES_ADDR
operator|>>
literal|2
operator|)
argument_list|,
name|Q81_XG_SERDES_ADDR_RDY
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_ofunc_serdes_reg
goto|;
comment|/* get the data */
operator|*
name|data
operator|=
name|qls_rd_ofunc_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_XG_SERDES_DATA
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|exit_qls_rd_ofunc_serdes_reg
label|:
return|return
name|ret
return|;
block|}
end_function

begin_define
define|#
directive|define
name|Q81_XGMAC_ADDR_RDY
value|BIT_31
end_define

begin_define
define|#
directive|define
name|Q81_XGMAC_ADDR_R
value|BIT_30
end_define

begin_define
define|#
directive|define
name|Q81_XGMAC_ADDR_XME
value|BIT_29
end_define

begin_function
specifier|static
name|int
name|qls_rd_ofunc_xgmac_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|ret
operator|=
name|qls_wait_ofunc_reg_rdy
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_XGMAC_ADDR
operator|>>
literal|2
operator|)
argument_list|,
name|Q81_XGMAC_ADDR_RDY
argument_list|,
name|Q81_XGMAC_ADDR_XME
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_ofunc_xgmac_reg
goto|;
name|qls_wr_ofunc_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_XGMAC_ADDR_RDY
operator|>>
literal|2
operator|)
argument_list|,
operator|(
name|reg
operator||
name|Q81_XGMAC_ADDR_R
operator|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_wait_ofunc_reg_rdy
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_XGMAC_ADDR
operator|>>
literal|2
operator|)
argument_list|,
name|Q81_XGMAC_ADDR_RDY
argument_list|,
name|Q81_XGMAC_ADDR_XME
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_ofunc_xgmac_reg
goto|;
operator|*
name|data
operator|=
name|qls_rd_ofunc_reg
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XGMAC_DATA
argument_list|)
expr_stmt|;
name|exit_qls_rd_ofunc_xgmac_reg
label|:
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_rd_serdes_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XG_SERDES_ADDR
argument_list|,
name|Q81_XG_SERDES_ADDR_RDY
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_serdes_reg
goto|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XG_SERDES_ADDR
argument_list|, \
operator|(
name|reg
operator||
name|Q81_XG_SERDES_ADDR_READ
operator|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XG_SERDES_ADDR
argument_list|,
name|Q81_XG_SERDES_ADDR_RDY
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_serdes_reg
goto|;
operator|*
name|data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XG_SERDES_DATA
argument_list|)
expr_stmt|;
name|exit_qls_rd_serdes_reg
label|:
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|qls_get_both_serdes
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|addr
parameter_list|,
name|uint32_t
modifier|*
name|dptr
parameter_list|,
name|uint32_t
modifier|*
name|ind_ptr
parameter_list|,
name|uint32_t
name|dvalid
parameter_list|,
name|uint32_t
name|ind_valid
parameter_list|)
block|{
name|int
name|ret
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|dvalid
condition|)
name|ret
operator|=
name|qls_rd_serdes_reg
argument_list|(
name|ha
argument_list|,
name|addr
argument_list|,
name|dptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
operator|*
name|dptr
operator|=
name|Q81_BAD_DATA
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|ind_valid
condition|)
name|ret
operator|=
name|qls_rd_ofunc_serdes_reg
argument_list|(
name|ha
argument_list|,
name|addr
argument_list|,
name|ind_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
operator|*
name|ind_ptr
operator|=
name|Q81_BAD_DATA
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|Q81_XFI1_POWERED_UP
value|0x00000005
end_define

begin_define
define|#
directive|define
name|Q81_XFI2_POWERED_UP
value|0x0000000A
end_define

begin_define
define|#
directive|define
name|Q81_XAUI_POWERED_UP
value|0x00000001
end_define

begin_function
specifier|static
name|int
name|qls_rd_serdes_regs
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|qls_mpi_coredump_t
modifier|*
name|mpi_dump
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|uint32_t
name|xfi_d_valid
decl_stmt|,
name|xfi_ind_valid
decl_stmt|,
name|xaui_d_valid
decl_stmt|,
name|xaui_ind_valid
decl_stmt|;
name|uint32_t
name|temp
decl_stmt|,
name|xaui_reg
decl_stmt|,
name|i
decl_stmt|;
name|uint32_t
modifier|*
name|dptr
decl_stmt|,
modifier|*
name|indptr
decl_stmt|;
name|xfi_d_valid
operator|=
name|xfi_ind_valid
operator|=
name|xaui_d_valid
operator|=
name|xaui_ind_valid
operator|=
literal|0
expr_stmt|;
name|xaui_reg
operator|=
literal|0x800
expr_stmt|;
name|ret
operator|=
name|qls_rd_ofunc_serdes_reg
argument_list|(
name|ha
argument_list|,
name|xaui_reg
argument_list|,
operator|&
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|temp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|temp
operator|&
name|Q81_XAUI_POWERED_UP
operator|)
operator|==
name|Q81_XAUI_POWERED_UP
condition|)
name|xaui_ind_valid
operator|=
literal|1
expr_stmt|;
name|ret
operator|=
name|qls_rd_serdes_reg
argument_list|(
name|ha
argument_list|,
name|xaui_reg
argument_list|,
operator|&
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|temp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|temp
operator|&
name|Q81_XAUI_POWERED_UP
operator|)
operator|==
name|Q81_XAUI_POWERED_UP
condition|)
name|xaui_d_valid
operator|=
literal|1
expr_stmt|;
name|ret
operator|=
name|qls_rd_serdes_reg
argument_list|(
name|ha
argument_list|,
literal|0x1E06
argument_list|,
operator|&
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|temp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|temp
operator|&
name|Q81_XFI1_POWERED_UP
operator|)
operator|==
name|Q81_XFI1_POWERED_UP
condition|)
block|{
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
name|xfi_ind_valid
operator|=
literal|1
expr_stmt|;
comment|/* NIC 2, so the indirect 						 (NIC1) xfi is up*/
else|else
name|xfi_d_valid
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|temp
operator|&
name|Q81_XFI2_POWERED_UP
operator|)
operator|==
name|Q81_XFI2_POWERED_UP
condition|)
block|{
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
name|xfi_d_valid
operator|=
literal|1
expr_stmt|;
comment|/* NIC 2, so the indirect (NIC1) 						xfi is up */
else|else
name|xfi_ind_valid
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xaui_an
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xaui_an
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xaui_an
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xaui_an
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|0x000000034
condition|;
name|i
operator|+=
literal|4
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xaui_d_valid
argument_list|,
name|xaui_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xaui_hss_pcs
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xaui_hss_pcs
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xaui_hss_pcs
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xaui_hss_pcs
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x800
init|;
name|i
operator|<=
literal|0x880
condition|;
name|i
operator|+=
literal|4
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xaui_d_valid
argument_list|,
name|xaui_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_an
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_an
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_an
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_an
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x1000
init|;
name|i
operator|<=
literal|0x1034
condition|;
name|i
operator|+=
literal|4
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xfi_d_valid
argument_list|,
name|xfi_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_train
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_train
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_train
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_train
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x1050
init|;
name|i
operator|<=
literal|0x107c
condition|;
name|i
operator|+=
literal|4
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xfi_d_valid
argument_list|,
name|xfi_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_pcs
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_pcs
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_pcs
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_pcs
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x1800
init|;
name|i
operator|<=
literal|0x1838
condition|;
name|i
operator|+=
literal|4
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xfi_d_valid
argument_list|,
name|xfi_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_tx
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_tx
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_tx
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_tx
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x1c00
init|;
name|i
operator|<=
literal|0x1c1f
condition|;
name|i
operator|++
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xfi_d_valid
argument_list|,
name|xfi_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_rx
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_rx
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_rx
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_rx
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x1c40
init|;
name|i
operator|<=
literal|0x1c5f
condition|;
name|i
operator|++
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xfi_d_valid
argument_list|,
name|xfi_ind_valid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_pll
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_pll
operator|)
expr_stmt|;
block|}
else|else
block|{
name|dptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes1_xfi_hss_pll
operator|)
expr_stmt|;
name|indptr
operator|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|&
name|mpi_dump
operator|->
name|serdes2_xfi_hss_pll
operator|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0x1e00
init|;
name|i
operator|<=
literal|0x1e1f
condition|;
name|i
operator|++
operator|,
name|dptr
operator|++
operator|,
name|indptr
operator|++
control|)
block|{
name|qls_get_both_serdes
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|dptr
argument_list|,
name|indptr
argument_list|,
name|xfi_d_valid
argument_list|,
name|xfi_ind_valid
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_unpause_mpi_risc
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|)
block|{
name|uint32_t
name|data
decl_stmt|;
name|data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_HOST_CMD_STATUS
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|data
operator|&
name|Q81_CTL_HCS_RISC_PAUSED
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_HOST_CMD_STATUS
argument_list|, \
name|Q81_CTL_HCS_CMD_CLR_RISC_PAUSE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_pause_mpi_risc
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|)
block|{
name|uint32_t
name|data
decl_stmt|;
name|int
name|count
init|=
literal|10
decl_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_HOST_CMD_STATUS
argument_list|, \
name|Q81_CTL_HCS_CMD_SET_RISC_PAUSE
argument_list|)
expr_stmt|;
do|do
block|{
name|data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_HOST_CMD_STATUS
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|&
name|Q81_CTL_HCS_RISC_PAUSED
condition|)
break|break;
name|qls_mdelay
argument_list|(
name|__func__
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|count
operator|--
expr_stmt|;
block|}
do|while
condition|(
name|count
condition|)
do|;
return|return
operator|(
operator|(
name|count
operator|==
literal|0
operator|)
condition|?
operator|-
literal|1
else|:
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|qls_get_intr_states
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_RX_RINGS
condition|;
name|i
operator|++
operator|,
name|buf
operator|++
control|)
block|{
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_INTR_ENABLE
argument_list|,
operator|(
literal|0x037f0300
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_INTR_ENABLE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|qls_rd_xgmac_reg
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|reg
parameter_list|,
name|uint32_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XGMAC_ADDR
argument_list|,
name|Q81_XGMAC_ADDR_RDY
argument_list|,
name|Q81_XGMAC_ADDR_XME
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_xgmac_reg
goto|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XGMAC_ADDR
argument_list|,
operator|(
name|reg
operator||
name|Q81_XGMAC_ADDR_R
operator|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_wait_reg_rdy
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XGMAC_ADDR
argument_list|,
name|Q81_XGMAC_ADDR_RDY
argument_list|,
name|Q81_XGMAC_ADDR_XME
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_rd_xgmac_reg
goto|;
operator|*
name|data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XGMAC_DATA
argument_list|)
expr_stmt|;
name|exit_qls_rd_xgmac_reg
label|:
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_rd_xgmac_regs
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|,
name|uint32_t
name|o_func
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Q81_XGMAC_REGISTER_END
condition|;
name|i
operator|+=
literal|4
operator|,
name|buf
operator|++
control|)
block|{
switch|switch
condition|(
name|i
condition|)
block|{
case|case
name|Q81_PAUSE_SRC_LO
case|:
case|case
name|Q81_PAUSE_SRC_HI
case|:
case|case
name|Q81_GLOBAL_CFG
case|:
case|case
name|Q81_TX_CFG
case|:
case|case
name|Q81_RX_CFG
case|:
case|case
name|Q81_FLOW_CTL
case|:
case|case
name|Q81_PAUSE_OPCODE
case|:
case|case
name|Q81_PAUSE_TIMER
case|:
case|case
name|Q81_PAUSE_FRM_DEST_LO
case|:
case|case
name|Q81_PAUSE_FRM_DEST_HI
case|:
case|case
name|Q81_MAC_TX_PARAMS
case|:
case|case
name|Q81_MAC_RX_PARAMS
case|:
case|case
name|Q81_MAC_SYS_INT
case|:
case|case
name|Q81_MAC_SYS_INT_MASK
case|:
case|case
name|Q81_MAC_MGMT_INT
case|:
case|case
name|Q81_MAC_MGMT_IN_MASK
case|:
case|case
name|Q81_EXT_ARB_MODE
case|:
case|case
name|Q81_TX_PKTS
case|:
case|case
name|Q81_TX_PKTS_LO
case|:
case|case
name|Q81_TX_BYTES
case|:
case|case
name|Q81_TX_BYTES_LO
case|:
case|case
name|Q81_TX_MCAST_PKTS
case|:
case|case
name|Q81_TX_MCAST_PKTS_LO
case|:
case|case
name|Q81_TX_BCAST_PKTS
case|:
case|case
name|Q81_TX_BCAST_PKTS_LO
case|:
case|case
name|Q81_TX_UCAST_PKTS
case|:
case|case
name|Q81_TX_UCAST_PKTS_LO
case|:
case|case
name|Q81_TX_CTL_PKTS
case|:
case|case
name|Q81_TX_CTL_PKTS_LO
case|:
case|case
name|Q81_TX_PAUSE_PKTS
case|:
case|case
name|Q81_TX_PAUSE_PKTS_LO
case|:
case|case
name|Q81_TX_64_PKT
case|:
case|case
name|Q81_TX_64_PKT_LO
case|:
case|case
name|Q81_TX_65_TO_127_PKT
case|:
case|case
name|Q81_TX_65_TO_127_PKT_LO
case|:
case|case
name|Q81_TX_128_TO_255_PKT
case|:
case|case
name|Q81_TX_128_TO_255_PKT_LO
case|:
case|case
name|Q81_TX_256_511_PKT
case|:
case|case
name|Q81_TX_256_511_PKT_LO
case|:
case|case
name|Q81_TX_512_TO_1023_PKT
case|:
case|case
name|Q81_TX_512_TO_1023_PKT_LO
case|:
case|case
name|Q81_TX_1024_TO_1518_PKT
case|:
case|case
name|Q81_TX_1024_TO_1518_PKT_LO
case|:
case|case
name|Q81_TX_1519_TO_MAX_PKT
case|:
case|case
name|Q81_TX_1519_TO_MAX_PKT_LO
case|:
case|case
name|Q81_TX_UNDERSIZE_PKT
case|:
case|case
name|Q81_TX_UNDERSIZE_PKT_LO
case|:
case|case
name|Q81_TX_OVERSIZE_PKT
case|:
case|case
name|Q81_TX_OVERSIZE_PKT_LO
case|:
case|case
name|Q81_RX_HALF_FULL_DET
case|:
case|case
name|Q81_TX_HALF_FULL_DET_LO
case|:
case|case
name|Q81_RX_OVERFLOW_DET
case|:
case|case
name|Q81_TX_OVERFLOW_DET_LO
case|:
case|case
name|Q81_RX_HALF_FULL_MASK
case|:
case|case
name|Q81_TX_HALF_FULL_MASK_LO
case|:
case|case
name|Q81_RX_OVERFLOW_MASK
case|:
case|case
name|Q81_TX_OVERFLOW_MASK_LO
case|:
case|case
name|Q81_STAT_CNT_CTL
case|:
case|case
name|Q81_AUX_RX_HALF_FULL_DET
case|:
case|case
name|Q81_AUX_TX_HALF_FULL_DET
case|:
case|case
name|Q81_AUX_RX_OVERFLOW_DET
case|:
case|case
name|Q81_AUX_TX_OVERFLOW_DET
case|:
case|case
name|Q81_AUX_RX_HALF_FULL_MASK
case|:
case|case
name|Q81_AUX_TX_HALF_FULL_MASK
case|:
case|case
name|Q81_AUX_RX_OVERFLOW_MASK
case|:
case|case
name|Q81_AUX_TX_OVERFLOW_MASK
case|:
case|case
name|Q81_RX_BYTES
case|:
case|case
name|Q81_RX_BYTES_LO
case|:
case|case
name|Q81_RX_BYTES_OK
case|:
case|case
name|Q81_RX_BYTES_OK_LO
case|:
case|case
name|Q81_RX_PKTS
case|:
case|case
name|Q81_RX_PKTS_LO
case|:
case|case
name|Q81_RX_PKTS_OK
case|:
case|case
name|Q81_RX_PKTS_OK_LO
case|:
case|case
name|Q81_RX_BCAST_PKTS
case|:
case|case
name|Q81_RX_BCAST_PKTS_LO
case|:
case|case
name|Q81_RX_MCAST_PKTS
case|:
case|case
name|Q81_RX_MCAST_PKTS_LO
case|:
case|case
name|Q81_RX_UCAST_PKTS
case|:
case|case
name|Q81_RX_UCAST_PKTS_LO
case|:
case|case
name|Q81_RX_UNDERSIZE_PKTS
case|:
case|case
name|Q81_RX_UNDERSIZE_PKTS_LO
case|:
case|case
name|Q81_RX_OVERSIZE_PKTS
case|:
case|case
name|Q81_RX_OVERSIZE_PKTS_LO
case|:
case|case
name|Q81_RX_JABBER_PKTS
case|:
case|case
name|Q81_RX_JABBER_PKTS_LO
case|:
case|case
name|Q81_RX_UNDERSIZE_FCERR_PKTS
case|:
case|case
name|Q81_RX_UNDERSIZE_FCERR_PKTS_LO
case|:
case|case
name|Q81_RX_DROP_EVENTS
case|:
case|case
name|Q81_RX_DROP_EVENTS_LO
case|:
case|case
name|Q81_RX_FCERR_PKTS
case|:
case|case
name|Q81_RX_FCERR_PKTS_LO
case|:
case|case
name|Q81_RX_ALIGN_ERR
case|:
case|case
name|Q81_RX_ALIGN_ERR_LO
case|:
case|case
name|Q81_RX_SYMBOL_ERR
case|:
case|case
name|Q81_RX_SYMBOL_ERR_LO
case|:
case|case
name|Q81_RX_MAC_ERR
case|:
case|case
name|Q81_RX_MAC_ERR_LO
case|:
case|case
name|Q81_RX_CTL_PKTS
case|:
case|case
name|Q81_RX_CTL_PKTS_LO
case|:
case|case
name|Q81_RX_PAUSE_PKTS
case|:
case|case
name|Q81_RX_PAUSE_PKTS_LO
case|:
case|case
name|Q81_RX_64_PKTS
case|:
case|case
name|Q81_RX_64_PKTS_LO
case|:
case|case
name|Q81_RX_65_TO_127_PKTS
case|:
case|case
name|Q81_RX_65_TO_127_PKTS_LO
case|:
case|case
name|Q81_RX_128_255_PKTS
case|:
case|case
name|Q81_RX_128_255_PKTS_LO
case|:
case|case
name|Q81_RX_256_511_PKTS
case|:
case|case
name|Q81_RX_256_511_PKTS_LO
case|:
case|case
name|Q81_RX_512_TO_1023_PKTS
case|:
case|case
name|Q81_RX_512_TO_1023_PKTS_LO
case|:
case|case
name|Q81_RX_1024_TO_1518_PKTS
case|:
case|case
name|Q81_RX_1024_TO_1518_PKTS_LO
case|:
case|case
name|Q81_RX_1519_TO_MAX_PKTS
case|:
case|case
name|Q81_RX_1519_TO_MAX_PKTS_LO
case|:
case|case
name|Q81_RX_LEN_ERR_PKTS
case|:
case|case
name|Q81_RX_LEN_ERR_PKTS_LO
case|:
case|case
name|Q81_MDIO_TX_DATA
case|:
case|case
name|Q81_MDIO_RX_DATA
case|:
case|case
name|Q81_MDIO_CMD
case|:
case|case
name|Q81_MDIO_PHY_ADDR
case|:
case|case
name|Q81_MDIO_PORT
case|:
case|case
name|Q81_MDIO_STATUS
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES0
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES0_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES1
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES1_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES2
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES2_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES3
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES3_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES4
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES4_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES5
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES5_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES6
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES6_LO
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES7
case|:
case|case
name|Q81_TX_CBFC_PAUSE_FRAMES7_LO
case|:
case|case
name|Q81_TX_FCOE_PKTS
case|:
case|case
name|Q81_TX_FCOE_PKTS_LO
case|:
case|case
name|Q81_TX_MGMT_PKTS
case|:
case|case
name|Q81_TX_MGMT_PKTS_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES0
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES0_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES1
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES1_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES2
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES2_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES3
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES3_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES4
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES4_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES5
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES5_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES6
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES6_LO
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES7
case|:
case|case
name|Q81_RX_CBFC_PAUSE_FRAMES7_LO
case|:
case|case
name|Q81_RX_FCOE_PKTS
case|:
case|case
name|Q81_RX_FCOE_PKTS_LO
case|:
case|case
name|Q81_RX_MGMT_PKTS
case|:
case|case
name|Q81_RX_MGMT_PKTS_LO
case|:
case|case
name|Q81_RX_NIC_FIFO_DROP
case|:
case|case
name|Q81_RX_NIC_FIFO_DROP_LO
case|:
case|case
name|Q81_RX_FCOE_FIFO_DROP
case|:
case|case
name|Q81_RX_FCOE_FIFO_DROP_LO
case|:
case|case
name|Q81_RX_MGMT_FIFO_DROP
case|:
case|case
name|Q81_RX_MGMT_FIFO_DROP_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY0
case|:
case|case
name|Q81_RX_PKTS_PRIORITY0_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY1
case|:
case|case
name|Q81_RX_PKTS_PRIORITY1_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY2
case|:
case|case
name|Q81_RX_PKTS_PRIORITY2_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY3
case|:
case|case
name|Q81_RX_PKTS_PRIORITY3_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY4
case|:
case|case
name|Q81_RX_PKTS_PRIORITY4_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY5
case|:
case|case
name|Q81_RX_PKTS_PRIORITY5_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY6
case|:
case|case
name|Q81_RX_PKTS_PRIORITY6_LO
case|:
case|case
name|Q81_RX_PKTS_PRIORITY7
case|:
case|case
name|Q81_RX_PKTS_PRIORITY7_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY0
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY0_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY1
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY1_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY2
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY2_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY3
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY3_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY4
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY4_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY5
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY5_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY6
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY6_LO
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY7
case|:
case|case
name|Q81_RX_OCTETS_PRIORITY7_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY0
case|:
case|case
name|Q81_TX_PKTS_PRIORITY0_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY1
case|:
case|case
name|Q81_TX_PKTS_PRIORITY1_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY2
case|:
case|case
name|Q81_TX_PKTS_PRIORITY2_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY3
case|:
case|case
name|Q81_TX_PKTS_PRIORITY3_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY4
case|:
case|case
name|Q81_TX_PKTS_PRIORITY4_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY5
case|:
case|case
name|Q81_TX_PKTS_PRIORITY5_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY6
case|:
case|case
name|Q81_TX_PKTS_PRIORITY6_LO
case|:
case|case
name|Q81_TX_PKTS_PRIORITY7
case|:
case|case
name|Q81_TX_PKTS_PRIORITY7_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY0
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY0_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY1
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY1_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY2
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY2_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY3
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY3_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY4
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY4_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY5
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY5_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY6
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY6_LO
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY7
case|:
case|case
name|Q81_TX_OCTETS_PRIORITY7_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY0
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY0_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY1
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY1_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY2
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY2_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY3
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY3_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY4
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY4_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY5
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY5_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY6
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY6_LO
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY7
case|:
case|case
name|Q81_RX_DISCARD_PRIORITY7_LO
case|:
if|if
condition|(
name|o_func
condition|)
name|ret
operator|=
name|qls_rd_ofunc_xgmac_reg
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|buf
argument_list|)
expr_stmt|;
else|else
name|ret
operator|=
name|qls_rd_xgmac_reg
argument_list|(
name|ha
argument_list|,
name|i
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
operator|*
name|buf
operator|=
name|Q81_BAD_DATA
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_get_mpi_regs
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|,
name|uint32_t
name|offset
parameter_list|,
name|uint32_t
name|count
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|ret
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
operator|,
name|buf
operator|++
control|)
block|{
name|ret
operator|=
name|qls_rd_mpi_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|offset
operator|+
name|i
operator|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
block|}
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_get_mpi_shadow_regs
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|int
name|ret
decl_stmt|;
define|#
directive|define
name|Q81_RISC_124
value|0x0000007c
define|#
directive|define
name|Q81_RISC_127
value|0x0000007f
define|#
directive|define
name|Q81_SHADOW_OFFSET
value|0xb0000000
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Q81_MPI_CORE_SH_REGS_CNT
condition|;
name|i
operator|++
operator|,
name|buf
operator|++
control|)
block|{
name|ret
operator|=
name|qls_wr_mpi_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_PROC_ADDR_RISC_INT_REG
operator||
name|Q81_RISC_124
operator|)
argument_list|,
operator|(
name|Q81_SHADOW_OFFSET
operator||
name|i
operator|<<
literal|20
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_get_mpi_shadow_regs
goto|;
name|ret
operator|=
name|qls_mpi_risc_rd_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|Q81_CTL_PROC_ADDR_RISC_INT_REG
operator||
name|Q81_RISC_127
operator|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
goto|goto
name|exit_qls_get_mpi_shadow_regs
goto|;
block|}
name|exit_qls_get_mpi_shadow_regs
label|:
return|return
name|ret
return|;
block|}
end_function

begin_define
define|#
directive|define
name|SYS_CLOCK
value|(0x00)
end_define

begin_define
define|#
directive|define
name|PCI_CLOCK
value|(0x80)
end_define

begin_define
define|#
directive|define
name|FC_CLOCK
value|(0x140)
end_define

begin_define
define|#
directive|define
name|XGM_CLOCK
value|(0x180)
end_define

begin_define
define|#
directive|define
name|Q81_ADDRESS_REGISTER_ENABLE
value|0x00010000
end_define

begin_define
define|#
directive|define
name|Q81_UP
value|0x00008000
end_define

begin_define
define|#
directive|define
name|Q81_MAX_MUX
value|0x40
end_define

begin_define
define|#
directive|define
name|Q81_MAX_MODULES
value|0x1F
end_define

begin_function
specifier|static
name|uint32_t
modifier|*
name|qls_get_probe
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
name|clock
parameter_list|,
name|uint8_t
modifier|*
name|valid
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
name|uint32_t
name|module
decl_stmt|,
name|mux_sel
decl_stmt|,
name|probe
decl_stmt|,
name|lo_val
decl_stmt|,
name|hi_val
decl_stmt|;
for|for
control|(
name|module
operator|=
literal|0
init|;
name|module
operator|<
name|Q81_MAX_MODULES
condition|;
name|module
operator|++
control|)
block|{
if|if
condition|(
name|valid
index|[
name|module
index|]
condition|)
block|{
for|for
control|(
name|mux_sel
operator|=
literal|0
init|;
name|mux_sel
operator|<
name|Q81_MAX_MUX
condition|;
name|mux_sel
operator|++
control|)
block|{
name|probe
operator|=
name|clock
operator||
name|Q81_ADDRESS_REGISTER_ENABLE
operator||
name|mux_sel
operator||
operator|(
name|module
operator|<<
literal|9
operator|)
expr_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XG_PROBE_MUX_ADDR
argument_list|,\
name|probe
argument_list|)
expr_stmt|;
name|lo_val
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,\
name|Q81_CTL_XG_PROBE_MUX_DATA
argument_list|)
expr_stmt|;
if|if
condition|(
name|mux_sel
operator|==
literal|0
condition|)
block|{
operator|*
name|buf
operator|=
name|probe
expr_stmt|;
name|buf
operator|++
expr_stmt|;
block|}
name|probe
operator||=
name|Q81_UP
expr_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_XG_PROBE_MUX_ADDR
argument_list|,\
name|probe
argument_list|)
expr_stmt|;
name|hi_val
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,\
name|Q81_CTL_XG_PROBE_MUX_DATA
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|lo_val
expr_stmt|;
name|buf
operator|++
expr_stmt|;
operator|*
name|buf
operator|=
name|hi_val
expr_stmt|;
name|buf
operator|++
expr_stmt|;
block|}
block|}
block|}
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qls_get_probe_dump
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
name|uint8_t
name|sys_clock_valid_modules
index|[
literal|0x20
index|]
init|=
block|{
literal|1
block|,
comment|// 0x00
literal|1
block|,
comment|// 0x01
literal|1
block|,
comment|// 0x02
literal|0
block|,
comment|// 0x03
literal|1
block|,
comment|// 0x04
literal|1
block|,
comment|// 0x05
literal|1
block|,
comment|// 0x06
literal|1
block|,
comment|// 0x07
literal|1
block|,
comment|// 0x08
literal|1
block|,
comment|// 0x09
literal|1
block|,
comment|// 0x0A
literal|1
block|,
comment|// 0x0B
literal|1
block|,
comment|// 0x0C
literal|1
block|,
comment|// 0x0D
literal|1
block|,
comment|// 0x0E
literal|0
block|,
comment|// 0x0F
literal|1
block|,
comment|// 0x10
literal|1
block|,
comment|// 0x11
literal|1
block|,
comment|// 0x12
literal|1
block|,
comment|// 0x13
literal|0
block|,
comment|// 0x14
literal|0
block|,
comment|// 0x15
literal|0
block|,
comment|// 0x16
literal|0
block|,
comment|// 0x17
literal|0
block|,
comment|// 0x18
literal|0
block|,
comment|// 0x19
literal|0
block|,
comment|// 0x1A
literal|0
block|,
comment|// 0x1B
literal|0
block|,
comment|// 0x1C
literal|0
block|,
comment|// 0x1D
literal|0
block|,
comment|// 0x1E
literal|0
comment|// 0x1F
block|}
decl_stmt|;
name|uint8_t
name|pci_clock_valid_modules
index|[
literal|0x20
index|]
init|=
block|{
literal|1
block|,
comment|// 0x00
literal|0
block|,
comment|// 0x01
literal|0
block|,
comment|// 0x02
literal|0
block|,
comment|// 0x03
literal|0
block|,
comment|// 0x04
literal|0
block|,
comment|// 0x05
literal|1
block|,
comment|// 0x06
literal|1
block|,
comment|// 0x07
literal|0
block|,
comment|// 0x08
literal|0
block|,
comment|// 0x09
literal|0
block|,
comment|// 0x0A
literal|0
block|,
comment|// 0x0B
literal|0
block|,
comment|// 0x0C
literal|0
block|,
comment|// 0x0D
literal|1
block|,
comment|// 0x0E
literal|0
block|,
comment|// 0x0F
literal|0
block|,
comment|// 0x10
literal|0
block|,
comment|// 0x11
literal|0
block|,
comment|// 0x12
literal|0
block|,
comment|// 0x13
literal|0
block|,
comment|// 0x14
literal|0
block|,
comment|// 0x15
literal|0
block|,
comment|// 0x16
literal|0
block|,
comment|// 0x17
literal|0
block|,
comment|// 0x18
literal|0
block|,
comment|// 0x19
literal|0
block|,
comment|// 0x1A
literal|0
block|,
comment|// 0x1B
literal|0
block|,
comment|// 0x1C
literal|0
block|,
comment|// 0x1D
literal|0
block|,
comment|// 0x1E
literal|0
comment|// 0x1F
block|}
decl_stmt|;
name|uint8_t
name|xgm_clock_valid_modules
index|[
literal|0x20
index|]
init|=
block|{
literal|1
block|,
comment|// 0x00
literal|0
block|,
comment|// 0x01
literal|0
block|,
comment|// 0x02
literal|1
block|,
comment|// 0x03
literal|0
block|,
comment|// 0x04
literal|0
block|,
comment|// 0x05
literal|0
block|,
comment|// 0x06
literal|0
block|,
comment|// 0x07
literal|1
block|,
comment|// 0x08
literal|1
block|,
comment|// 0x09
literal|0
block|,
comment|// 0x0A
literal|0
block|,
comment|// 0x0B
literal|1
block|,
comment|// 0x0C
literal|1
block|,
comment|// 0x0D
literal|1
block|,
comment|// 0x0E
literal|0
block|,
comment|// 0x0F
literal|1
block|,
comment|// 0x10
literal|1
block|,
comment|// 0x11
literal|0
block|,
comment|// 0x12
literal|0
block|,
comment|// 0x13
literal|0
block|,
comment|// 0x14
literal|0
block|,
comment|// 0x15
literal|0
block|,
comment|// 0x16
literal|0
block|,
comment|// 0x17
literal|0
block|,
comment|// 0x18
literal|0
block|,
comment|// 0x19
literal|0
block|,
comment|// 0x1A
literal|0
block|,
comment|// 0x1B
literal|0
block|,
comment|// 0x1C
literal|0
block|,
comment|// 0x1D
literal|0
block|,
comment|// 0x1E
literal|0
comment|// 0x1F
block|}
decl_stmt|;
name|uint8_t
name|fc_clock_valid_modules
index|[
literal|0x20
index|]
init|=
block|{
literal|1
block|,
comment|// 0x00
literal|0
block|,
comment|// 0x01
literal|0
block|,
comment|// 0x02
literal|0
block|,
comment|// 0x03
literal|0
block|,
comment|// 0x04
literal|0
block|,
comment|// 0x05
literal|0
block|,
comment|// 0x06
literal|0
block|,
comment|// 0x07
literal|0
block|,
comment|// 0x08
literal|0
block|,
comment|// 0x09
literal|0
block|,
comment|// 0x0A
literal|0
block|,
comment|// 0x0B
literal|1
block|,
comment|// 0x0C
literal|1
block|,
comment|// 0x0D
literal|0
block|,
comment|// 0x0E
literal|0
block|,
comment|// 0x0F
literal|0
block|,
comment|// 0x10
literal|0
block|,
comment|// 0x11
literal|0
block|,
comment|// 0x12
literal|0
block|,
comment|// 0x13
literal|0
block|,
comment|// 0x14
literal|0
block|,
comment|// 0x15
literal|0
block|,
comment|// 0x16
literal|0
block|,
comment|// 0x17
literal|0
block|,
comment|// 0x18
literal|0
block|,
comment|// 0x19
literal|0
block|,
comment|// 0x1A
literal|0
block|,
comment|// 0x1B
literal|0
block|,
comment|// 0x1C
literal|0
block|,
comment|// 0x1D
literal|0
block|,
comment|// 0x1E
literal|0
comment|// 0x1F
block|}
decl_stmt|;
name|qls_wr_mpi_reg
argument_list|(
name|ha
argument_list|,
literal|0x100e
argument_list|,
literal|0x18a20000
argument_list|)
expr_stmt|;
name|buf
operator|=
name|qls_get_probe
argument_list|(
name|ha
argument_list|,
name|SYS_CLOCK
argument_list|,
name|sys_clock_valid_modules
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|=
name|qls_get_probe
argument_list|(
name|ha
argument_list|,
name|PCI_CLOCK
argument_list|,
name|pci_clock_valid_modules
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|=
name|qls_get_probe
argument_list|(
name|ha
argument_list|,
name|XGM_CLOCK
argument_list|,
name|xgm_clock_valid_modules
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|=
name|qls_get_probe
argument_list|(
name|ha
argument_list|,
name|FC_CLOCK
argument_list|,
name|fc_clock_valid_modules
argument_list|,
name|buf
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|qls_get_ridx_registers
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
name|uint32_t
name|type
decl_stmt|,
name|idx
decl_stmt|,
name|idx_max
decl_stmt|;
name|uint32_t
name|r_idx
decl_stmt|;
name|uint32_t
name|r_data
decl_stmt|;
name|uint32_t
name|val
decl_stmt|;
for|for
control|(
name|type
operator|=
literal|0
init|;
name|type
operator|<
literal|4
condition|;
name|type
operator|++
control|)
block|{
if|if
condition|(
name|type
operator|<
literal|2
condition|)
name|idx_max
operator|=
literal|8
expr_stmt|;
else|else
name|idx_max
operator|=
literal|16
expr_stmt|;
for|for
control|(
name|idx
operator|=
literal|0
init|;
name|idx
operator|<
name|idx_max
condition|;
name|idx
operator|++
control|)
block|{
name|val
operator|=
literal|0x04000000
operator||
operator|(
name|type
operator|<<
literal|16
operator|)
operator||
operator|(
name|idx
operator|<<
literal|8
operator|)
expr_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_ROUTING_INDEX
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|r_idx
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|r_idx
operator|&
literal|0x40000000
operator|)
operator|==
literal|0
condition|)
name|r_idx
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_ROUTING_INDEX
argument_list|)
expr_stmt|;
name|r_data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_ROUTING_DATA
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|type
expr_stmt|;
name|buf
operator|++
expr_stmt|;
operator|*
name|buf
operator|=
name|idx
expr_stmt|;
name|buf
operator|++
expr_stmt|;
operator|*
name|buf
operator|=
name|r_idx
expr_stmt|;
name|buf
operator|++
expr_stmt|;
operator|*
name|buf
operator|=
name|r_data
expr_stmt|;
name|buf
operator|++
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|qls_get_mac_proto_regs
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
define|#
directive|define
name|Q81_RS_AND_ADR
value|0x06000000
define|#
directive|define
name|Q81_RS_ONLY
value|0x04000000
define|#
directive|define
name|Q81_NUM_TYPES
value|10
name|uint32_t
name|result_index
decl_stmt|,
name|result_data
decl_stmt|;
name|uint32_t
name|type
decl_stmt|;
name|uint32_t
name|index
decl_stmt|;
name|uint32_t
name|offset
decl_stmt|;
name|uint32_t
name|val
decl_stmt|;
name|uint32_t
name|initial_val
decl_stmt|;
name|uint32_t
name|max_index
decl_stmt|;
name|uint32_t
name|max_offset
decl_stmt|;
for|for
control|(
name|type
operator|=
literal|0
init|;
name|type
operator|<
name|Q81_NUM_TYPES
condition|;
name|type
operator|++
control|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
literal|0
case|:
comment|// CAM
name|initial_val
operator|=
name|Q81_RS_AND_ADR
expr_stmt|;
name|max_index
operator|=
literal|512
expr_stmt|;
name|max_offset
operator|=
literal|3
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|// Multicast MAC Address
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|32
expr_stmt|;
name|max_offset
operator|=
literal|2
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|// VLAN filter mask
case|case
literal|3
case|:
comment|// MC filter mask
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|4096
expr_stmt|;
name|max_offset
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|4
case|:
comment|// FC MAC addresses
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|4
expr_stmt|;
name|max_offset
operator|=
literal|2
expr_stmt|;
break|break;
case|case
literal|5
case|:
comment|// Mgmt MAC addresses
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|8
expr_stmt|;
name|max_offset
operator|=
literal|2
expr_stmt|;
break|break;
case|case
literal|6
case|:
comment|// Mgmt VLAN addresses
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|16
expr_stmt|;
name|max_offset
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|7
case|:
comment|// Mgmt IPv4 address
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|4
expr_stmt|;
name|max_offset
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|8
case|:
comment|// Mgmt IPv6 address
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|4
expr_stmt|;
name|max_offset
operator|=
literal|4
expr_stmt|;
break|break;
case|case
literal|9
case|:
comment|// Mgmt TCP/UDP Dest port
name|initial_val
operator|=
name|Q81_RS_ONLY
expr_stmt|;
name|max_index
operator|=
literal|4
expr_stmt|;
name|max_offset
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"Bad type!!! 0x%08x\n"
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|max_index
operator|=
literal|0
expr_stmt|;
name|max_offset
operator|=
literal|0
expr_stmt|;
break|break;
block|}
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
name|max_index
condition|;
name|index
operator|++
control|)
block|{
for|for
control|(
name|offset
operator|=
literal|0
init|;
name|offset
operator|<
name|max_offset
condition|;
name|offset
operator|++
control|)
block|{
name|val
operator|=
name|initial_val
operator||
operator|(
name|type
operator|<<
literal|16
operator|)
operator||
operator|(
name|index
operator|<<
literal|4
operator|)
operator||
operator|(
name|offset
operator|)
expr_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_MAC_PROTO_ADDR_INDEX
argument_list|,\
name|val
argument_list|)
expr_stmt|;
name|result_index
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|result_index
operator|&
literal|0x40000000
operator|)
operator|==
literal|0
condition|)
name|result_index
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|, \
name|Q81_CTL_MAC_PROTO_ADDR_INDEX
argument_list|)
expr_stmt|;
name|result_data
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,\
name|Q81_CTL_MAC_PROTO_ADDR_DATA
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|result_index
expr_stmt|;
name|buf
operator|++
expr_stmt|;
operator|*
name|buf
operator|=
name|result_data
expr_stmt|;
name|buf
operator|++
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|qls_get_ets_regs
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|,
name|uint32_t
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
operator|,
name|buf
operator|++
control|)
block|{
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_NIC_ENH_TX_SCHD
argument_list|, \
operator|(
operator|(
name|i
operator|<<
literal|29
operator|)
operator||
literal|0x08000000
operator|)
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_NIC_ENH_TX_SCHD
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
operator|,
name|buf
operator|++
control|)
block|{
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_CNA_ENH_TX_SCHD
argument_list|, \
operator|(
operator|(
name|i
operator|<<
literal|29
operator|)
operator||
literal|0x08000000
operator|)
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_CNA_ENH_TX_SCHD
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|int
name|qls_mpi_core_dump
parameter_list|(
name|qla_host_t
modifier|*
name|ha
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|int
name|i
decl_stmt|;
name|uint32_t
name|reg
decl_stmt|,
name|reg_val
decl_stmt|;
name|qls_mpi_coredump_t
modifier|*
name|mpi_dump
init|=
operator|&
name|ql_mpi_coredump
decl_stmt|;
name|ret
operator|=
name|qls_pause_mpi_risc
argument_list|(
name|ha
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
block|{
name|printf
argument_list|(
literal|"Failed RISC pause. Status = 0x%.08x\n"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|memset
argument_list|(
operator|&
operator|(
name|mpi_dump
operator|->
name|mpi_global_header
operator|)
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|qls_mpid_glbl_hdr_t
argument_list|)
argument_list|)
expr_stmt|;
name|mpi_dump
operator|->
name|mpi_global_header
operator|.
name|cookie
operator|=
name|Q81_MPID_COOKIE
expr_stmt|;
name|mpi_dump
operator|->
name|mpi_global_header
operator|.
name|hdr_size
operator|=
sizeof|sizeof
argument_list|(
name|qls_mpid_glbl_hdr_t
argument_list|)
expr_stmt|;
name|mpi_dump
operator|->
name|mpi_global_header
operator|.
name|img_size
operator|=
sizeof|sizeof
argument_list|(
name|qls_mpi_coredump_t
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|mpi_dump
operator|->
name|mpi_global_header
operator|.
name|id
argument_list|,
literal|"MPI Coredump"
argument_list|,
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|mpi_global_header
operator|.
name|id
argument_list|)
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|nic1_regs_seg_hdr
argument_list|,
name|Q81_NIC1_CONTROL_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|nic1_regs
argument_list|)
operator|)
argument_list|,
literal|"NIC1 Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|nic2_regs_seg_hdr
argument_list|,
name|Q81_NIC2_CONTROL_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|nic2_regs
argument_list|)
operator|)
argument_list|,
literal|"NIC2 Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xgmac1_seg_hdr
argument_list|,
name|Q81_NIC1_XGMAC_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|xgmac1
argument_list|)
operator|)
argument_list|,
literal|"NIC1 XGMac Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xgmac2_seg_hdr
argument_list|,
name|Q81_NIC2_XGMAC_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|xgmac2
argument_list|)
operator|)
argument_list|,
literal|"NIC2 XGMac Registers"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ha
operator|->
name|pci_func
operator|&
literal|1
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
name|mpi_dump
operator|->
name|nic2_regs
index|[
name|i
index|]
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|i
operator|*
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
name|mpi_dump
operator|->
name|nic1_regs
index|[
name|i
index|]
operator|=
name|qls_rd_ofunc_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|i
operator|*
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|)
operator|/
literal|4
argument_list|)
expr_stmt|;
name|qls_rd_xgmac_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|xgmac2
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|qls_rd_xgmac_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|xgmac1
index|[
literal|0
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
name|mpi_dump
operator|->
name|nic1_regs
index|[
name|i
index|]
operator|=
name|READ_REG32
argument_list|(
name|ha
argument_list|,
name|i
operator|*
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
name|mpi_dump
operator|->
name|nic2_regs
index|[
name|i
index|]
operator|=
name|qls_rd_ofunc_reg
argument_list|(
name|ha
argument_list|,
operator|(
name|i
operator|*
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|)
operator|/
literal|4
argument_list|)
expr_stmt|;
name|qls_rd_xgmac_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|xgmac1
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|qls_rd_xgmac_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|xgmac2
index|[
literal|0
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xaui1_an_hdr
argument_list|,
name|Q81_XAUI1_AN_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xaui_an
argument_list|)
operator|)
argument_list|,
literal|"XAUI1 AN Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xaui1_hss_pcs_hdr
argument_list|,
name|Q81_XAUI1_HSS_PCS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xaui_hss_pcs
argument_list|)
operator|)
argument_list|,
literal|"XAUI1 HSS PCS Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi1_an_hdr
argument_list|,
name|Q81_XFI1_AN_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xfi_an
argument_list|)
operator|)
argument_list|,
literal|"XFI1 AN Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi1_train_hdr
argument_list|,
name|Q81_XFI1_TRAIN_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xfi_train
argument_list|)
operator|)
argument_list|,
literal|"XFI1 TRAIN Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi1_hss_pcs_hdr
argument_list|,
name|Q81_XFI1_HSS_PCS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xfi_hss_pcs
argument_list|)
operator|)
argument_list|,
literal|"XFI1 HSS PCS Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi1_hss_tx_hdr
argument_list|,
name|Q81_XFI1_HSS_TX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xfi_hss_tx
argument_list|)
operator|)
argument_list|,
literal|"XFI1 HSS TX Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi1_hss_rx_hdr
argument_list|,
name|Q81_XFI1_HSS_RX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xfi_hss_rx
argument_list|)
operator|)
argument_list|,
literal|"XFI1 HSS RX Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi1_hss_pll_hdr
argument_list|,
name|Q81_XFI1_HSS_PLL_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes1_xfi_hss_pll
argument_list|)
operator|)
argument_list|,
literal|"XFI1 HSS PLL Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xaui2_an_hdr
argument_list|,
name|Q81_XAUI2_AN_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xaui_an
argument_list|)
operator|)
argument_list|,
literal|"XAUI2 AN Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xaui2_hss_pcs_hdr
argument_list|,
name|Q81_XAUI2_HSS_PCS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xaui_hss_pcs
argument_list|)
operator|)
argument_list|,
literal|"XAUI2 HSS PCS Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi2_an_hdr
argument_list|,
name|Q81_XFI2_AN_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xfi_an
argument_list|)
operator|)
argument_list|,
literal|"XFI2 AN Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi2_train_hdr
argument_list|,
name|Q81_XFI2_TRAIN_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xfi_train
argument_list|)
operator|)
argument_list|,
literal|"XFI2 TRAIN Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi2_hss_pcs_hdr
argument_list|,
name|Q81_XFI2_HSS_PCS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xfi_hss_pcs
argument_list|)
operator|)
argument_list|,
literal|"XFI2 HSS PCS Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi2_hss_tx_hdr
argument_list|,
name|Q81_XFI2_HSS_TX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xfi_hss_tx
argument_list|)
operator|)
argument_list|,
literal|"XFI2 HSS TX Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi2_hss_rx_hdr
argument_list|,
name|Q81_XFI2_HSS_RX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xfi_hss_rx
argument_list|)
operator|)
argument_list|,
literal|"XFI2 HSS RX Registers"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|xfi2_hss_pll_hdr
argument_list|,
name|Q81_XFI2_HSS_PLL_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|serdes2_xfi_hss_pll
argument_list|)
operator|)
argument_list|,
literal|"XFI2 HSS PLL Registers"
argument_list|)
expr_stmt|;
name|qls_rd_serdes_regs
argument_list|(
name|ha
argument_list|,
name|mpi_dump
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|core_regs_seg_hdr
argument_list|,
name|Q81_CORE_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|core_regs_seg_hdr
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|mpi_core_regs
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|mpi_core_sh_regs
argument_list|)
operator|)
argument_list|,
literal|"Core Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|mpi_core_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_MPI_CORE_REGS_ADDR
argument_list|,
name|Q81_MPI_CORE_REGS_CNT
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_shadow_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|mpi_core_sh_regs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|test_logic_regs_seg_hdr
argument_list|,
name|Q81_TEST_LOGIC_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|test_logic_regs
argument_list|)
operator|)
argument_list|,
literal|"Test Logic Regs"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|test_logic_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_TEST_REGS_ADDR
argument_list|,
name|Q81_TEST_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|rmii_regs_seg_hdr
argument_list|,
name|Q81_RMII_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|rmii_regs
argument_list|)
operator|)
argument_list|,
literal|"RMII Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|rmii_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_RMII_REGS_ADDR
argument_list|,
name|Q81_RMII_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|fcmac1_regs_seg_hdr
argument_list|,
name|Q81_FCMAC1_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|fcmac1_regs
argument_list|)
operator|)
argument_list|,
literal|"FCMAC1 Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|fcmac1_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_FCMAC1_REGS_ADDR
argument_list|,
name|Q81_FCMAC_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|fcmac2_regs_seg_hdr
argument_list|,
name|Q81_FCMAC2_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|fcmac2_regs
argument_list|)
operator|)
argument_list|,
literal|"FCMAC2 Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|fcmac2_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_FCMAC2_REGS_ADDR
argument_list|,
name|Q81_FCMAC_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|fc1_mbx_regs_seg_hdr
argument_list|,
name|Q81_FC1_MBOX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|fc1_mbx_regs
argument_list|)
operator|)
argument_list|,
literal|"FC1 MBox Regs"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|fc1_mbx_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_FC1_MBX_REGS_ADDR
argument_list|,
name|Q81_FC_MBX_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|ide_regs_seg_hdr
argument_list|,
name|Q81_IDE_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|ide_regs
argument_list|)
operator|)
argument_list|,
literal|"IDE Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|ide_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_IDE_REGS_ADDR
argument_list|,
name|Q81_IDE_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|nic1_mbx_regs_seg_hdr
argument_list|,
name|Q81_NIC1_MBOX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|nic1_mbx_regs
argument_list|)
operator|)
argument_list|,
literal|"NIC1 MBox Regs"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|nic1_mbx_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_NIC1_MBX_REGS_ADDR
argument_list|,
name|Q81_NIC_MBX_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|smbus_regs_seg_hdr
argument_list|,
name|Q81_SMBUS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|smbus_regs
argument_list|)
operator|)
argument_list|,
literal|"SMBus Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|smbus_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_SMBUS_REGS_ADDR
argument_list|,
name|Q81_SMBUS_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|fc2_mbx_regs_seg_hdr
argument_list|,
name|Q81_FC2_MBOX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|fc2_mbx_regs
argument_list|)
operator|)
argument_list|,
literal|"FC2 MBox Regs"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|fc2_mbx_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_FC2_MBX_REGS_ADDR
argument_list|,
name|Q81_FC_MBX_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|nic2_mbx_regs_seg_hdr
argument_list|,
name|Q81_NIC2_MBOX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|nic2_mbx_regs
argument_list|)
operator|)
argument_list|,
literal|"NIC2 MBox Regs"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|nic2_mbx_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_NIC2_MBX_REGS_ADDR
argument_list|,
name|Q81_NIC_MBX_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|i2c_regs_seg_hdr
argument_list|,
name|Q81_I2C_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|i2c_regs
argument_list|)
operator|)
argument_list|,
literal|"I2C Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|i2c_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_I2C_REGS_ADDR
argument_list|,
name|Q81_I2C_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|memc_regs_seg_hdr
argument_list|,
name|Q81_MEMC_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|memc_regs
argument_list|)
operator|)
argument_list|,
literal|"MEMC Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|memc_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_MEMC_REGS_ADDR
argument_list|,
name|Q81_MEMC_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|pbus_regs_seg_hdr
argument_list|,
name|Q81_PBUS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|pbus_regs
argument_list|)
operator|)
argument_list|,
literal|"PBUS Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|pbus_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_PBUS_REGS_ADDR
argument_list|,
name|Q81_PBUS_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|mde_regs_seg_hdr
argument_list|,
name|Q81_MDE_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|mde_regs
argument_list|)
operator|)
argument_list|,
literal|"MDE Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_mpi_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|mde_regs
index|[
literal|0
index|]
argument_list|,
name|Q81_MDE_REGS_ADDR
argument_list|,
name|Q81_MDE_REGS_CNT
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|intr_states_seg_hdr
argument_list|,
name|Q81_INTR_STATES_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|intr_states
argument_list|)
operator|)
argument_list|,
literal|"INTR States"
argument_list|)
expr_stmt|;
name|qls_get_intr_states
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|intr_states
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|probe_dump_seg_hdr
argument_list|,
name|Q81_PROBE_DUMP_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|probe_dump
argument_list|)
operator|)
argument_list|,
literal|"Probe Dump"
argument_list|)
expr_stmt|;
name|qls_get_probe_dump
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|probe_dump
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|routing_reg_seg_hdr
argument_list|,
name|Q81_ROUTING_INDEX_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|routing_regs
argument_list|)
operator|)
argument_list|,
literal|"Routing Regs"
argument_list|)
expr_stmt|;
name|qls_get_ridx_registers
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|routing_regs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|mac_prot_reg_seg_hdr
argument_list|,
name|Q81_MAC_PROTOCOL_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|mac_prot_regs
argument_list|)
operator|)
argument_list|,
literal|"MAC Prot Regs"
argument_list|)
expr_stmt|;
name|qls_get_mac_proto_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|mac_prot_regs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|ets_seg_hdr
argument_list|,
name|Q81_ETS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|ets
argument_list|)
operator|)
argument_list|,
literal|"ETS Registers"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_get_ets_regs
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|ets
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|sem_regs_seg_hdr
argument_list|,
name|Q81_SEM_REGS_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|sem_regs
argument_list|)
operator|)
argument_list|,
literal|"Sem Registers"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Q81_MAX_SEMAPHORE_FUNCTIONS
condition|;
name|i
operator|++
control|)
block|{
name|reg
operator|=
name|Q81_CTL_PROC_ADDR_REG_BLOCK
operator||
operator|(
name|i
operator|<<
name|Q81_FUNCTION_SHIFT
operator|)
operator||
operator|(
name|Q81_CTL_SEMAPHORE
operator|>>
literal|2
operator|)
expr_stmt|;
name|ret
operator|=
name|qls_mpi_risc_rd_reg
argument_list|(
name|ha
argument_list|,
name|reg
argument_list|,
operator|&
name|reg_val
argument_list|)
expr_stmt|;
name|mpi_dump
operator|->
name|sem_regs
index|[
name|i
index|]
operator|=
name|reg_val
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
name|mpi_dump
operator|->
name|sem_regs
index|[
name|i
index|]
operator|=
name|Q81_BAD_DATA
expr_stmt|;
block|}
name|ret
operator|=
name|qls_unpause_mpi_risc
argument_list|(
name|ha
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|printf
argument_list|(
literal|"Failed RISC unpause. Status = 0x%.08x\n"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_mpi_reset
argument_list|(
name|ha
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|printf
argument_list|(
literal|"Failed RISC reset. Status = 0x%.08x\n"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
name|WRITE_REG32
argument_list|(
name|ha
argument_list|,
name|Q81_CTL_FUNC_SPECIFIC
argument_list|,
literal|0x80008000
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|memc_ram_seg_hdr
argument_list|,
name|Q81_MEMC_RAM_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|memc_ram
argument_list|)
operator|)
argument_list|,
literal|"MEMC RAM"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_mbx_dump_risc_ram
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|memc_ram
index|[
literal|0
index|]
argument_list|,
name|Q81_MEMC_RAM_ADDR
argument_list|,
name|Q81_MEMC_RAM_CNT
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|printf
argument_list|(
literal|"Failed Dump of MEMC RAM. Status = 0x%.08x\n"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|code_ram_seg_hdr
argument_list|,
name|Q81_WCS_RAM_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|code_ram
argument_list|)
operator|)
argument_list|,
literal|"WCS RAM"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|qls_mbx_dump_risc_ram
argument_list|(
name|ha
argument_list|,
operator|&
name|mpi_dump
operator|->
name|memc_ram
index|[
literal|0
index|]
argument_list|,
name|Q81_CODE_RAM_ADDR
argument_list|,
name|Q81_CODE_RAM_CNT
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|printf
argument_list|(
literal|"Failed Dump of CODE RAM. Status = 0x%.08x\n"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|wqc1_seg_hdr
argument_list|,
name|Q81_WQC1_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|wqc1
argument_list|)
operator|)
argument_list|,
literal|"WQC 1"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|wqc2_seg_hdr
argument_list|,
name|Q81_WQC2_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|wqc2
argument_list|)
operator|)
argument_list|,
literal|"WQC 2"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|cqc1_seg_hdr
argument_list|,
name|Q81_CQC1_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|cqc1
argument_list|)
operator|)
argument_list|,
literal|"CQC 1"
argument_list|)
expr_stmt|;
name|qls_mpid_seg_hdr
argument_list|(
operator|&
name|mpi_dump
operator|->
name|cqc2_seg_hdr
argument_list|,
name|Q81_CQC2_SEG_NUM
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|qls_mpid_seg_hdr_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|mpi_dump
operator|->
name|cqc2
argument_list|)
operator|)
argument_list|,
literal|"CQC 2"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

