begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2013-2015, Mellanox Technologies, Ltd.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY AUTHOR AND CONTRIBUTORS `AS IS' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|MLX5_IB_H
end_ifndef

begin_define
define|#
directive|define
name|MLX5_IB_H
end_define

begin_include
include|#
directive|include
file|<linux/kernel.h>
end_include

begin_include
include|#
directive|include
file|<linux/sched.h>
end_include

begin_include
include|#
directive|include
file|<rdma/ib_verbs.h>
end_include

begin_include
include|#
directive|include
file|<rdma/ib_smi.h>
end_include

begin_include
include|#
directive|include
file|<rdma/ib_addr.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx5/device.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx5/driver.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx5/cq.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx5/qp.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx5/srq.h>
end_include

begin_include
include|#
directive|include
file|<linux/types.h>
end_include

begin_include
include|#
directive|include
file|<dev/mlx5/mlx5_core/transobj.h>
end_include

begin_define
define|#
directive|define
name|mlx5_ib_dbg
parameter_list|(
name|dev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|pr_debug("mlx5_dbg:%s:%s:%d:(pid %d): " format, (dev)->ib_dev.name, __func__,	\ 	 __LINE__, curthread->td_proc->p_pid, ##arg)
end_define

begin_define
define|#
directive|define
name|mlx5_ib_err
parameter_list|(
name|dev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|printf("mlx5_ib: ERR: ""mlx5_err:%s:%s:%d:(pid %d): " format, (dev)->ib_dev.name, __func__, \ 	__LINE__, curthread->td_proc->p_pid, ##arg)
end_define

begin_define
define|#
directive|define
name|mlx5_ib_warn
parameter_list|(
name|dev
parameter_list|,
name|format
parameter_list|,
name|arg
modifier|...
parameter_list|)
define|\
value|printf("mlx5_ib: WARN: ""mlx5_warn:%s:%s:%d:(pid %d): " format, (dev)->ib_dev.name, __func__, \ 	__LINE__, curthread->td_proc->p_pid, ##arg)
end_define

begin_define
define|#
directive|define
name|BF_ENABLE
value|0
end_define

begin_decl_stmt
specifier|extern
name|struct
name|workqueue_struct
modifier|*
name|mlx5_ib_wq
decl_stmt|;
end_decl_stmt

begin_enum
enum|enum
block|{
name|MLX5_IB_MMAP_CMD_SHIFT
init|=
literal|8
block|,
name|MLX5_IB_MMAP_CMD_MASK
init|=
literal|0xff
block|, }
enum|;
end_enum

begin_enum
enum|enum
name|mlx5_ib_mmap_cmd
block|{
name|MLX5_IB_MMAP_REGULAR_PAGE
init|=
literal|0
block|,
name|MLX5_IB_MMAP_GET_CONTIGUOUS_PAGES
init|=
literal|1
block|,
name|MLX5_IB_MMAP_WC_PAGE
init|=
literal|2
block|,
name|MLX5_IB_MMAP_NC_PAGE
init|=
literal|3
block|,
name|MLX5_IB_MMAP_MAP_DC_INFO_PAGE
init|=
literal|4
block|,
comment|/* Use EXP mmap commands until it is pushed to upstream */
name|MLX5_IB_EXP_MMAP_CORE_CLOCK
init|=
literal|0xFB
block|,
name|MLX5_IB_EXP_MMAP_GET_CONTIGUOUS_PAGES_CPU_NUMA
init|=
literal|0xFC
block|,
name|MLX5_IB_EXP_MMAP_GET_CONTIGUOUS_PAGES_DEV_NUMA
init|=
literal|0xFD
block|,
name|MLX5_IB_EXP_ALLOC_N_MMAP_WC
init|=
literal|0xFE
block|, }
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX5_RES_SCAT_DATA32_CQE
init|=
literal|0x1
block|,
name|MLX5_RES_SCAT_DATA64_CQE
init|=
literal|0x2
block|,
name|MLX5_REQ_SCAT_DATA32_CQE
init|=
literal|0x11
block|,
name|MLX5_REQ_SCAT_DATA64_CQE
init|=
literal|0x22
block|, }
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX5_DCT_CS_RES_64
init|=
literal|2
block|,
name|MLX5_CNAK_RX_POLL_CQ_QUOTA
init|=
literal|256
block|, }
enum|;
end_enum

begin_enum
enum|enum
name|mlx5_ib_latency_class
block|{
name|MLX5_IB_LATENCY_CLASS_LOW
block|,
name|MLX5_IB_LATENCY_CLASS_MEDIUM
block|,
name|MLX5_IB_LATENCY_CLASS_HIGH
block|,
name|MLX5_IB_LATENCY_CLASS_FAST_PATH
block|}
enum|;
end_enum

begin_enum
enum|enum
name|mlx5_ib_mad_ifc_flags
block|{
name|MLX5_MAD_IFC_IGNORE_MKEY
init|=
literal|1
block|,
name|MLX5_MAD_IFC_IGNORE_BKEY
init|=
literal|2
block|,
name|MLX5_MAD_IFC_NET_VIEW
init|=
literal|4
block|, }
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX5_CROSS_CHANNEL_UUAR
init|=
literal|0
block|, }
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX5_IB_MAX_CTX_DYNAMIC_UARS
init|=
literal|256
block|,
name|MLX5_IB_INVALID_UAR_INDEX
init|=
operator|-
literal|1U
block|}
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX5_MAX_SINGLE_STRIDE_LOG_NUM_BYTES
init|=
literal|13
block|,
name|MLX5_MIN_SINGLE_STRIDE_LOG_NUM_BYTES
init|=
literal|6
block|,
name|MLX5_MAX_SINGLE_WQE_LOG_NUM_STRIDES
init|=
literal|16
block|,
name|MLX5_MIN_SINGLE_WQE_LOG_NUM_STRIDES
init|=
literal|9
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx5_ib_ucontext
block|{
name|struct
name|ib_ucontext
name|ibucontext
decl_stmt|;
name|struct
name|list_head
name|db_page_list
decl_stmt|;
comment|/* protect doorbell record alloc/free 	 */
name|struct
name|mutex
name|db_page_mutex
decl_stmt|;
name|struct
name|mlx5_uuar_info
name|uuari
decl_stmt|;
name|u32
name|dynamic_wc_uar_index
index|[
name|MLX5_IB_MAX_CTX_DYNAMIC_UARS
index|]
decl_stmt|;
comment|/* Transport Domain number */
name|u32
name|tdn
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_ucontext
modifier|*
name|to_mucontext
parameter_list|(
name|struct
name|ib_ucontext
modifier|*
name|ibucontext
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibucontext
argument_list|,
expr|struct
name|mlx5_ib_ucontext
argument_list|,
name|ibucontext
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|mlx5_ib_pd
block|{
name|struct
name|ib_pd
name|ibpd
decl_stmt|;
name|u32
name|pdn
decl_stmt|;
name|u32
name|pa_lkey
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|wr_list
block|{
name|u16
name|opcode
decl_stmt|;
name|u16
name|next
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_swr_ctx
block|{
name|u64
name|wrid
decl_stmt|;
name|u32
name|wr_data
decl_stmt|;
name|struct
name|wr_list
name|w_list
decl_stmt|;
name|u32
name|wqe_head
decl_stmt|;
name|u8
name|sig_piped
decl_stmt|;
name|u8
name|rsvd
index|[
literal|11
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_rwr_ctx
block|{
name|u64
name|wrid
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_wq
block|{
union|union
block|{
name|struct
name|mlx5_swr_ctx
modifier|*
name|swr_ctx
decl_stmt|;
name|struct
name|mlx5_rwr_ctx
modifier|*
name|rwr_ctx
decl_stmt|;
block|}
union|;
name|u16
name|unsig_count
decl_stmt|;
comment|/* serialize post to the work queue 	 */
name|spinlock_t
name|lock
decl_stmt|;
name|int
name|wqe_cnt
decl_stmt|;
name|int
name|max_post
decl_stmt|;
name|int
name|max_gs
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|wqe_shift
decl_stmt|;
name|unsigned
name|head
decl_stmt|;
name|unsigned
name|tail
decl_stmt|;
name|u16
name|cur_post
decl_stmt|;
name|u16
name|last_poll
decl_stmt|;
name|void
modifier|*
name|qend
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX5_QP_USER
block|,
name|MLX5_QP_KERNEL
block|,
name|MLX5_QP_EMPTY
block|}
enum|;
end_enum

begin_enum
enum|enum
block|{
name|MLX5_WQ_USER
block|,
name|MLX5_WQ_KERNEL
block|}
enum|;
end_enum

begin_struct
struct|struct
name|mlx5_ib_sqd
block|{
name|struct
name|mlx5_ib_qp
modifier|*
name|qp
decl_stmt|;
name|struct
name|work_struct
name|work
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_mc_flows_list
block|{
name|struct
name|list_head
name|flows_list
decl_stmt|;
comment|/*Protect the flows_list*/
name|struct
name|mutex
name|lock
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_qp
block|{
name|struct
name|ib_qp
name|ibqp
decl_stmt|;
name|struct
name|mlx5_core_qp
name|mqp
decl_stmt|;
name|struct
name|mlx5_core_qp
name|mrq
decl_stmt|;
name|struct
name|mlx5_core_qp
name|msq
decl_stmt|;
name|u32
name|tisn
decl_stmt|;
name|u32
name|tirn
decl_stmt|;
name|struct
name|mlx5_buf
name|buf
decl_stmt|;
name|struct
name|mlx5_db
name|db
decl_stmt|;
name|struct
name|mlx5_ib_wq
name|rq
decl_stmt|;
name|u32
name|doorbell_qpn
decl_stmt|;
name|u8
name|sq_signal_bits
decl_stmt|;
name|u8
name|fm_cache
decl_stmt|;
name|int
name|sq_max_wqes_per_wr
decl_stmt|;
name|int
name|sq_spare_wqes
decl_stmt|;
name|struct
name|mlx5_ib_wq
name|sq
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
name|int
name|buf_size
decl_stmt|;
comment|/* Raw Ethernet QP's SQ is allocated seperately 	 * from the RQ's buffer in user-space. 	 */
name|struct
name|ib_umem
modifier|*
name|sq_umem
decl_stmt|;
name|int
name|sq_buf_size
decl_stmt|;
name|u64
name|sq_buf_addr
decl_stmt|;
name|int
name|allow_mp_wqe
decl_stmt|;
comment|/* serialize qp state modifications 	 */
name|struct
name|mutex
name|mutex
decl_stmt|;
name|u16
name|xrcdn
decl_stmt|;
name|u32
name|flags
decl_stmt|;
name|u8
name|port
decl_stmt|;
name|u8
name|alt_port
decl_stmt|;
name|u8
name|atomic_rd_en
decl_stmt|;
name|u8
name|resp_depth
decl_stmt|;
name|u8
name|state
decl_stmt|;
comment|/* Raw Ethernet QP's SQ and RQ states */
name|u8
name|rq_state
decl_stmt|;
name|u8
name|sq_state
decl_stmt|;
name|int
name|mlx_type
decl_stmt|;
name|int
name|wq_sig
decl_stmt|;
name|int
name|scat_cqe
decl_stmt|;
name|int
name|max_inline_data
decl_stmt|;
name|struct
name|mlx5_bf
modifier|*
name|bf
decl_stmt|;
name|int
name|has_rq
decl_stmt|;
comment|/* only for user space QPs. For kernel 	 * we have it from the bf object 	 */
name|int
name|uuarn
decl_stmt|;
name|int
name|create_type
decl_stmt|;
name|u32
name|pa_lkey
decl_stmt|;
comment|/* Store signature errors */
name|bool
name|signature_en
decl_stmt|;
name|struct
name|list_head
name|qps_list
decl_stmt|;
name|struct
name|list_head
name|cq_recv_list
decl_stmt|;
name|struct
name|list_head
name|cq_send_list
decl_stmt|;
name|struct
name|mlx5_ib_mc_flows_list
name|mc_flows_list
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_cq_buf
block|{
name|struct
name|mlx5_buf
name|buf
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
name|int
name|cqe_size
decl_stmt|;
name|int
name|nent
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
name|mlx5_ib_qp_flags
block|{
name|MLX5_IB_QP_BLOCK_MULTICAST_LOOPBACK
init|=
literal|1
operator|<<
literal|0
block|,
name|MLX5_IB_QP_SIGNATURE_HANDLING
init|=
literal|1
operator|<<
literal|1
block|,
name|MLX5_IB_QP_CAP_RX_END_PADDING
init|=
literal|1
operator|<<
literal|5
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx5_umr_wr
block|{
union|union
block|{
name|u64
name|virt_addr
decl_stmt|;
name|u64
name|offset
decl_stmt|;
block|}
name|target
union|;
name|struct
name|ib_pd
modifier|*
name|pd
decl_stmt|;
name|unsigned
name|int
name|page_shift
decl_stmt|;
name|unsigned
name|int
name|npages
decl_stmt|;
name|u64
name|length
decl_stmt|;
name|int
name|access_flags
decl_stmt|;
name|u32
name|mkey
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_shared_mr_info
block|{
name|int
name|mr_id
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_cq
block|{
name|struct
name|ib_cq
name|ibcq
decl_stmt|;
name|struct
name|mlx5_core_cq
name|mcq
decl_stmt|;
name|struct
name|mlx5_ib_cq_buf
name|buf
decl_stmt|;
name|struct
name|mlx5_db
name|db
decl_stmt|;
comment|/* serialize access to the CQ 	 */
name|spinlock_t
name|lock
decl_stmt|;
comment|/* protect resize cq 	 */
name|struct
name|mutex
name|resize_mutex
decl_stmt|;
name|struct
name|mlx5_ib_cq_buf
modifier|*
name|resize_buf
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|resize_umem
decl_stmt|;
name|int
name|cqe_size
decl_stmt|;
name|struct
name|list_head
name|list_send_qp
decl_stmt|;
name|struct
name|list_head
name|list_recv_qp
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_srq
block|{
name|struct
name|ib_srq
name|ibsrq
decl_stmt|;
name|struct
name|mlx5_core_srq
name|msrq
decl_stmt|;
name|struct
name|mlx5_buf
name|buf
decl_stmt|;
name|struct
name|mlx5_db
name|db
decl_stmt|;
name|u64
modifier|*
name|wrid
decl_stmt|;
comment|/* protect SRQ hanlding 	 */
name|spinlock_t
name|lock
decl_stmt|;
name|int
name|head
decl_stmt|;
name|int
name|tail
decl_stmt|;
name|u16
name|wqe_ctr
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
comment|/* serialize arming a SRQ 	 */
name|struct
name|mutex
name|mutex
decl_stmt|;
name|int
name|wq_sig
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_xrcd
block|{
name|struct
name|ib_xrcd
name|ibxrcd
decl_stmt|;
name|u32
name|xrcdn
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
name|mlx5_ib_mtt_access_flags
block|{
name|MLX5_IB_MTT_READ
init|=
operator|(
literal|1
operator|<<
literal|0
operator|)
block|,
name|MLX5_IB_MTT_WRITE
init|=
operator|(
literal|1
operator|<<
literal|1
operator|)
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|MLX5_IB_MTT_PRESENT
value|(MLX5_IB_MTT_READ | MLX5_IB_MTT_WRITE)
end_define

begin_struct
struct|struct
name|mlx5_ib_mr
block|{
name|struct
name|ib_mr
name|ibmr
decl_stmt|;
name|struct
name|mlx5_core_mr
name|mmr
decl_stmt|;
name|struct
name|ib_umem
modifier|*
name|umem
decl_stmt|;
name|struct
name|mlx5_shared_mr_info
modifier|*
name|smr_info
decl_stmt|;
name|struct
name|list_head
name|list
decl_stmt|;
name|int
name|order
decl_stmt|;
name|int
name|umred
decl_stmt|;
name|dma_addr_t
name|dma
decl_stmt|;
name|int
name|npages
decl_stmt|;
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
decl_stmt|;
name|struct
name|mlx5_create_mkey_mbox_out
name|out
decl_stmt|;
name|struct
name|mlx5_core_sig_ctx
modifier|*
name|sig
decl_stmt|;
name|u32
name|max_reg_descriptors
decl_stmt|;
name|u64
name|size
decl_stmt|;
name|u64
name|page_count
decl_stmt|;
name|struct
name|mlx5_ib_mr
modifier|*
modifier|*
name|children
decl_stmt|;
name|int
name|nchild
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_fast_reg_page_list
block|{
name|struct
name|ib_fast_reg_page_list
name|ibfrpl
decl_stmt|;
name|__be64
modifier|*
name|mapped_page_list
decl_stmt|;
name|dma_addr_t
name|map
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_umr_context
block|{
name|enum
name|ib_wc_status
name|status
decl_stmt|;
name|struct
name|completion
name|done
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|void
name|mlx5_ib_init_umr_context
parameter_list|(
name|struct
name|mlx5_ib_umr_context
modifier|*
name|context
parameter_list|)
block|{
name|context
operator|->
name|status
operator|=
operator|-
literal|1
expr_stmt|;
name|init_completion
argument_list|(
operator|&
name|context
operator|->
name|done
argument_list|)
expr_stmt|;
block|}
end_function

begin_struct
struct|struct
name|umr_common
block|{
name|struct
name|ib_pd
modifier|*
name|pd
decl_stmt|;
name|struct
name|ib_mr
modifier|*
name|mr
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
block|{
name|MLX5_FMR_INVALID
block|,
name|MLX5_FMR_VALID
block|,
name|MLX5_FMR_BUSY
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx5_ib_fmr
block|{
name|struct
name|ib_fmr
name|ibfmr
decl_stmt|;
name|struct
name|mlx5_core_mr
name|mr
decl_stmt|;
name|int
name|access_flags
decl_stmt|;
name|int
name|state
decl_stmt|;
comment|/* protect fmr state 	 */
name|spinlock_t
name|lock
decl_stmt|;
name|u64
name|wrid
decl_stmt|;
name|struct
name|ib_send_wr
name|wr
index|[
literal|2
index|]
decl_stmt|;
name|u8
name|page_shift
decl_stmt|;
name|struct
name|ib_fast_reg_page_list
name|page_list
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|cache_order
block|{
name|struct
name|kobject
name|kobj
decl_stmt|;
name|int
name|order
decl_stmt|;
name|int
name|index
decl_stmt|;
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_cache_ent
block|{
name|struct
name|list_head
name|head
decl_stmt|;
comment|/* sync access to the cahce entry 	 */
name|spinlock_t
name|lock
decl_stmt|;
name|u32
name|order
decl_stmt|;
name|u32
name|size
decl_stmt|;
name|u32
name|cur
decl_stmt|;
name|u32
name|miss
decl_stmt|;
name|u32
name|limit
decl_stmt|;
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
decl_stmt|;
name|struct
name|work_struct
name|work
decl_stmt|;
name|struct
name|delayed_work
name|dwork
decl_stmt|;
name|int
name|pending
decl_stmt|;
name|struct
name|cache_order
name|co
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_mr_cache
block|{
name|struct
name|workqueue_struct
modifier|*
name|wq
decl_stmt|;
name|struct
name|mlx5_cache_ent
name|ent
index|[
name|MAX_MR_CACHE_ENTRIES
index|]
decl_stmt|;
name|int
name|stopped
decl_stmt|;
name|struct
name|dentry
modifier|*
name|root
decl_stmt|;
name|int
name|last_add
decl_stmt|;
name|int
name|rel_timeout
decl_stmt|;
name|int
name|rel_imm
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_resources
block|{
name|struct
name|ib_cq
modifier|*
name|c0
decl_stmt|;
name|struct
name|ib_xrcd
modifier|*
name|x0
decl_stmt|;
name|struct
name|ib_xrcd
modifier|*
name|x1
decl_stmt|;
name|struct
name|ib_pd
modifier|*
name|p0
decl_stmt|;
name|struct
name|ib_srq
modifier|*
name|s0
decl_stmt|;
name|struct
name|ib_srq
modifier|*
name|s1
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_dc_tracer
block|{
name|struct
name|page
modifier|*
name|pg
decl_stmt|;
name|dma_addr_t
name|dma
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|order
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_dc_desc
block|{
name|dma_addr_t
name|dma
decl_stmt|;
name|void
modifier|*
name|buf
decl_stmt|;
block|}
struct|;
end_struct

begin_enum
enum|enum
name|mlx5_op
block|{
name|MLX5_WR_OP_MLX
init|=
literal|1
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|mlx5_mlx_wr
block|{
name|u8
name|sl
decl_stmt|;
name|u16
name|dlid
decl_stmt|;
name|int
name|icrc
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_send_wr
block|{
name|struct
name|ib_send_wr
name|wr
decl_stmt|;
union|union
block|{
name|struct
name|mlx5_mlx_wr
name|mlx
decl_stmt|;
block|}
name|sel
union|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_dc_data
block|{
name|struct
name|ib_mr
modifier|*
name|mr
decl_stmt|;
name|struct
name|ib_qp
modifier|*
name|dcqp
decl_stmt|;
name|struct
name|ib_cq
modifier|*
name|rcq
decl_stmt|;
name|struct
name|ib_cq
modifier|*
name|scq
decl_stmt|;
name|unsigned
name|int
name|rx_npages
decl_stmt|;
name|unsigned
name|int
name|tx_npages
decl_stmt|;
name|struct
name|mlx5_dc_desc
modifier|*
name|rxdesc
decl_stmt|;
name|struct
name|mlx5_dc_desc
modifier|*
name|txdesc
decl_stmt|;
name|unsigned
name|int
name|max_wqes
decl_stmt|;
name|unsigned
name|int
name|cur_send
decl_stmt|;
name|unsigned
name|int
name|last_send_completed
decl_stmt|;
name|int
name|tx_pending
decl_stmt|;
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
decl_stmt|;
name|int
name|port
decl_stmt|;
name|int
name|initialized
decl_stmt|;
name|struct
name|kobject
name|kobj
decl_stmt|;
name|unsigned
name|long
name|connects
decl_stmt|;
name|unsigned
name|long
name|cnaks
decl_stmt|;
name|unsigned
name|long
name|discards
decl_stmt|;
name|struct
name|ib_wc
name|wc_tbl
index|[
name|MLX5_CNAK_RX_POLL_CQ_QUOTA
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_port_sysfs_group
block|{
name|struct
name|kobject
name|kobj
decl_stmt|;
name|bool
name|enabled
decl_stmt|;
name|struct
name|attribute_group
name|counters
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MLX5_IB_GID_MAX
value|16
end_define

begin_struct
struct|struct
name|mlx5_ib_port
block|{
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
decl_stmt|;
name|u8
name|port_num
decl_stmt|;
comment|/* 0 based */
name|u8
name|port_gone
decl_stmt|;
comment|/* set when gone */
name|u16
name|q_cnt_id
decl_stmt|;
name|struct
name|mlx5_ib_port_sysfs_group
name|group
decl_stmt|;
name|union
name|ib_gid
name|gid_table
index|[
name|MLX5_IB_GID_MAX
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mlx5_ib_dev
block|{
name|struct
name|ib_device
name|ib_dev
decl_stmt|;
name|struct
name|mlx5_core_dev
modifier|*
name|mdev
decl_stmt|;
name|MLX5_DECLARE_DOORBELL_LOCK
argument_list|(
name|uar_lock
argument_list|)
expr_stmt|;
name|int
name|num_ports
decl_stmt|;
comment|/* serialize update of capability mask 	 */
name|struct
name|mutex
name|cap_mask_mutex
decl_stmt|;
name|bool
name|ib_active
decl_stmt|;
name|struct
name|umr_common
name|umrc
decl_stmt|;
comment|/* sync used page count stats 	 */
name|struct
name|mlx5_ib_resources
name|devr
decl_stmt|;
name|struct
name|mutex
name|slow_path_mutex
decl_stmt|;
name|int
name|enable_atomic_resp
decl_stmt|;
name|enum
name|ib_atomic_cap
name|atomic_cap
decl_stmt|;
name|struct
name|mlx5_mr_cache
name|cache
decl_stmt|;
name|struct
name|kobject
name|mr_cache
decl_stmt|;
comment|/* protect resources needed as part of reset flow */
name|spinlock_t
name|reset_flow_resource_lock
decl_stmt|;
name|struct
name|list_head
name|qp_list
decl_stmt|;
name|struct
name|timer_list
name|delay_timer
decl_stmt|;
name|int
name|fill_delay
decl_stmt|;
name|struct
name|mlx5_dc_tracer
name|dctr
decl_stmt|;
name|struct
name|mlx5_dc_data
name|dcd
index|[
name|MLX5_MAX_PORTS
index|]
decl_stmt|;
name|struct
name|kobject
modifier|*
name|dc_kobj
decl_stmt|;
comment|/* Array with num_ports elements */
name|struct
name|mlx5_ib_port
modifier|*
name|port
decl_stmt|;
name|struct
name|kobject
modifier|*
name|ports_parent
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_cq
modifier|*
name|to_mibcq
parameter_list|(
name|struct
name|mlx5_core_cq
modifier|*
name|mcq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|mcq
argument_list|,
expr|struct
name|mlx5_ib_cq
argument_list|,
name|mcq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_xrcd
modifier|*
name|to_mxrcd
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|ibxrcd
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibxrcd
argument_list|,
expr|struct
name|mlx5_ib_xrcd
argument_list|,
name|ibxrcd
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_dev
modifier|*
name|to_mdev
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibdev
argument_list|,
expr|struct
name|mlx5_ib_dev
argument_list|,
name|ib_dev
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_fmr
modifier|*
name|to_mfmr
parameter_list|(
name|struct
name|ib_fmr
modifier|*
name|ibfmr
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibfmr
argument_list|,
expr|struct
name|mlx5_ib_fmr
argument_list|,
name|ibfmr
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_cq
modifier|*
name|to_mcq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibcq
argument_list|,
expr|struct
name|mlx5_ib_cq
argument_list|,
name|ibcq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_qp
modifier|*
name|to_mibqp
parameter_list|(
name|struct
name|mlx5_core_qp
modifier|*
name|mqp
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|mqp
argument_list|,
expr|struct
name|mlx5_ib_qp
argument_list|,
name|mqp
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_qp
modifier|*
name|sq_to_mibqp
parameter_list|(
name|struct
name|mlx5_core_qp
modifier|*
name|msq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|msq
argument_list|,
expr|struct
name|mlx5_ib_qp
argument_list|,
name|msq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_qp
modifier|*
name|rq_to_mibqp
parameter_list|(
name|struct
name|mlx5_core_qp
modifier|*
name|mrq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|mrq
argument_list|,
expr|struct
name|mlx5_ib_qp
argument_list|,
name|mrq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_mr
modifier|*
name|to_mibmr
parameter_list|(
name|struct
name|mlx5_core_mr
modifier|*
name|mmr
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|mmr
argument_list|,
expr|struct
name|mlx5_ib_mr
argument_list|,
name|mmr
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_pd
modifier|*
name|to_mpd
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|ibpd
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibpd
argument_list|,
expr|struct
name|mlx5_ib_pd
argument_list|,
name|ibpd
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_srq
modifier|*
name|to_msrq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibsrq
argument_list|,
expr|struct
name|mlx5_ib_srq
argument_list|,
name|ibsrq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_qp
modifier|*
name|to_mqp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibqp
argument_list|,
expr|struct
name|mlx5_ib_qp
argument_list|,
name|ibqp
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_srq
modifier|*
name|to_mibsrq
parameter_list|(
name|struct
name|mlx5_core_srq
modifier|*
name|msrq
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|msrq
argument_list|,
expr|struct
name|mlx5_ib_srq
argument_list|,
name|msrq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_mr
modifier|*
name|to_mmr
parameter_list|(
name|struct
name|ib_mr
modifier|*
name|ibmr
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibmr
argument_list|,
expr|struct
name|mlx5_ib_mr
argument_list|,
name|ibmr
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_fast_reg_page_list
modifier|*
name|to_mfrpl
parameter_list|(
name|struct
name|ib_fast_reg_page_list
modifier|*
name|ibfrpl
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibfrpl
argument_list|,
expr|struct
name|mlx5_ib_fast_reg_page_list
argument_list|,
name|ibfrpl
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|mlx5_ib_ah
block|{
name|struct
name|ib_ah
name|ibah
decl_stmt|;
name|struct
name|mlx5_av
name|av
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
specifier|inline
name|struct
name|mlx5_ib_ah
modifier|*
name|to_mah
parameter_list|(
name|struct
name|ib_ah
modifier|*
name|ibah
parameter_list|)
block|{
return|return
name|container_of
argument_list|(
name|ibah
argument_list|,
expr|struct
name|mlx5_ib_ah
argument_list|,
name|ibah
argument_list|)
return|;
block|}
end_function

begin_function_decl
name|int
name|mlx5_ib_db_map_user
parameter_list|(
name|struct
name|mlx5_ib_ucontext
modifier|*
name|context
parameter_list|,
name|uintptr_t
name|virt
parameter_list|,
name|struct
name|mlx5_db
modifier|*
name|db
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_db_unmap_user
parameter_list|(
name|struct
name|mlx5_ib_ucontext
modifier|*
name|context
parameter_list|,
name|struct
name|mlx5_db
modifier|*
name|db
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|__mlx5_ib_cq_clean
parameter_list|(
name|struct
name|mlx5_ib_cq
modifier|*
name|cq
parameter_list|,
name|u32
name|qpn
parameter_list|,
name|struct
name|mlx5_ib_srq
modifier|*
name|srq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_cq_clean
parameter_list|(
name|struct
name|mlx5_ib_cq
modifier|*
name|cq
parameter_list|,
name|u32
name|qpn
parameter_list|,
name|struct
name|mlx5_ib_srq
modifier|*
name|srq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_free_srq_wqe
parameter_list|(
name|struct
name|mlx5_ib_srq
modifier|*
name|srq
parameter_list|,
name|int
name|wqe_index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_MAD_IFC
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|int
name|ignore_mkey
parameter_list|,
name|int
name|ignore_bkey
parameter_list|,
name|u8
name|port
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|in_wc
parameter_list|,
name|struct
name|ib_grh
modifier|*
name|in_grh
parameter_list|,
name|void
modifier|*
name|in_mad
parameter_list|,
name|void
modifier|*
name|response_mad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_ah
modifier|*
name|create_ib_ah
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|ib_ah_attr
modifier|*
name|ah_attr
parameter_list|,
name|struct
name|mlx5_ib_ah
modifier|*
name|ah
parameter_list|,
name|enum
name|rdma_link_layer
name|ll
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_ah
modifier|*
name|mlx5_ib_create_ah
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_ah_attr
modifier|*
name|ah_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_query_ah
parameter_list|(
name|struct
name|ib_ah
modifier|*
name|ibah
parameter_list|,
name|struct
name|ib_ah_attr
modifier|*
name|ah_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_destroy_ah
parameter_list|(
name|struct
name|ib_ah
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_srq
modifier|*
name|mlx5_ib_create_srq
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_srq_init_attr
modifier|*
name|init_attr
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_modify_srq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|,
name|struct
name|ib_srq_attr
modifier|*
name|attr
parameter_list|,
name|enum
name|ib_srq_attr_mask
name|attr_mask
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_query_srq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|,
name|struct
name|ib_srq_attr
modifier|*
name|srq_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_destroy_srq
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|srq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_post_srq_recv
parameter_list|(
name|struct
name|ib_srq
modifier|*
name|ibsrq
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
name|wr
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
modifier|*
name|bad_wr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_qp
modifier|*
name|mlx5_ib_create_qp
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_qp_init_attr
modifier|*
name|init_attr
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_modify_qp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_qp_attr
modifier|*
name|attr
parameter_list|,
name|int
name|attr_mask
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_query_qp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_qp_attr
modifier|*
name|qp_attr
parameter_list|,
name|int
name|qp_attr_mask
parameter_list|,
name|struct
name|ib_qp_init_attr
modifier|*
name|qp_init_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_destroy_qp
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|qp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_post_send
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_send_wr
modifier|*
name|wr
parameter_list|,
name|struct
name|ib_send_wr
modifier|*
modifier|*
name|bad_wr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_post_recv
parameter_list|(
name|struct
name|ib_qp
modifier|*
name|ibqp
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
name|wr
parameter_list|,
name|struct
name|ib_recv_wr
modifier|*
modifier|*
name|bad_wr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
modifier|*
name|mlx5_get_send_wqe
parameter_list|(
name|struct
name|mlx5_ib_qp
modifier|*
name|qp
parameter_list|,
name|int
name|n
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_cq
modifier|*
name|mlx5_ib_create_cq
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|struct
name|ib_cq_init_attr
modifier|*
name|attr
parameter_list|,
name|struct
name|ib_ucontext
modifier|*
name|context
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_destroy_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|cq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_poll_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|,
name|int
name|num_entries
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|wc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_arm_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|,
name|enum
name|ib_cq_notify_flags
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_modify_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|cq
parameter_list|,
name|struct
name|ib_cq_attr
modifier|*
name|attr
parameter_list|,
name|int
name|cq_attr_mask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_resize_cq
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|,
name|int
name|entries
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx5_ib_get_dma_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|int
name|acc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx5_ib_reg_user_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|u64
name|start
parameter_list|,
name|u64
name|length
parameter_list|,
name|u64
name|virt_addr
parameter_list|,
name|int
name|access_flags
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|,
name|int
name|mr_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx5_ib_reg_phys_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|struct
name|ib_phys_buf
modifier|*
name|buffer_list
parameter_list|,
name|int
name|num_phys_buf
parameter_list|,
name|int
name|access_flags
parameter_list|,
name|u64
modifier|*
name|virt_addr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_dereg_mr
parameter_list|(
name|struct
name|ib_mr
modifier|*
name|ibmr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_destroy_mr
parameter_list|(
name|struct
name|ib_mr
modifier|*
name|ibmr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_mr
modifier|*
name|mlx5_ib_alloc_fast_reg_mr
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|int
name|max_page_list_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_fast_reg_page_list
modifier|*
name|mlx5_ib_alloc_fast_reg_page_list
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|int
name|page_list_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_free_fast_reg_page_list
parameter_list|(
name|struct
name|ib_fast_reg_page_list
modifier|*
name|page_list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_fmr
modifier|*
name|mlx5_ib_fmr_alloc
parameter_list|(
name|struct
name|ib_pd
modifier|*
name|pd
parameter_list|,
name|int
name|acc
parameter_list|,
name|struct
name|ib_fmr_attr
modifier|*
name|fmr_attr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_map_phys_fmr
parameter_list|(
name|struct
name|ib_fmr
modifier|*
name|ibfmr
parameter_list|,
name|u64
modifier|*
name|page_list
parameter_list|,
name|int
name|npages
parameter_list|,
name|u64
name|iova
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_unmap_fmr
parameter_list|(
name|struct
name|list_head
modifier|*
name|fmr_list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_fmr_dealloc
parameter_list|(
name|struct
name|ib_fmr
modifier|*
name|ibfmr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_process_mad
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|int
name|mad_flags
parameter_list|,
name|u8
name|port_num
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|in_wc
parameter_list|,
name|struct
name|ib_grh
modifier|*
name|in_grh
parameter_list|,
name|struct
name|ib_mad
modifier|*
name|in_mad
parameter_list|,
name|struct
name|ib_mad
modifier|*
name|out_mad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|ib_xrcd
modifier|*
name|mlx5_ib_alloc_xrcd
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|struct
name|ib_ucontext
modifier|*
name|context
parameter_list|,
name|struct
name|ib_udata
modifier|*
name|udata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_dealloc_xrcd
parameter_list|(
name|struct
name|ib_xrcd
modifier|*
name|xrcd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_get_buf_offset
parameter_list|(
name|u64
name|addr
parameter_list|,
name|int
name|page_shift
parameter_list|,
name|u32
modifier|*
name|offset
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_ext_port_caps
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_smp_attr_node_info_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|struct
name|ib_smp
modifier|*
name|out_mad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_system_image_guid_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|__be64
modifier|*
name|sys_image_guid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_max_pkeys_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u16
modifier|*
name|max_pkeys
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_vendor_id_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u32
modifier|*
name|vendor_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_pkey_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u16
name|index
parameter_list|,
name|u16
modifier|*
name|pkey
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_node_desc_mad_ifc
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|char
modifier|*
name|node_desc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_node_guid_mad_ifc
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|u64
modifier|*
name|node_guid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_gids_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|index
parameter_list|,
name|union
name|ib_gid
modifier|*
name|gid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_port_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|struct
name|ib_port_attr
modifier|*
name|props
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_query_port
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|struct
name|ib_port_attr
modifier|*
name|props
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_init_fmr
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_cleanup_fmr
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_cont_pages
parameter_list|(
name|struct
name|ib_umem
modifier|*
name|umem
parameter_list|,
name|u64
name|addr
parameter_list|,
name|int
modifier|*
name|count
parameter_list|,
name|int
modifier|*
name|shift
parameter_list|,
name|int
modifier|*
name|ncont
parameter_list|,
name|int
modifier|*
name|order
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_populate_pas
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|ib_umem
modifier|*
name|umem
parameter_list|,
name|int
name|page_shift
parameter_list|,
name|__be64
modifier|*
name|pas
parameter_list|,
name|int
name|umr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_ib_copy_pas
parameter_list|(
name|u64
modifier|*
name|old
parameter_list|,
name|u64
modifier|*
name|new
parameter_list|,
name|int
name|step
parameter_list|,
name|int
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_ib_get_cqe_size
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|struct
name|ib_cq
modifier|*
name|ibcq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_mr_cache_init
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_mr_cache_cleanup
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_mr_ib_cont_pages
parameter_list|(
name|struct
name|ib_umem
modifier|*
name|umem
parameter_list|,
name|u64
name|addr
parameter_list|,
name|int
modifier|*
name|count
parameter_list|,
name|int
modifier|*
name|shift
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|mlx5_umr_cq_handler
parameter_list|(
name|struct
name|ib_cq
modifier|*
name|cq
parameter_list|,
name|void
modifier|*
name|cq_context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_query_port_roce
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|struct
name|ib_port_attr
modifier|*
name|props
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|__be16
name|mlx5_get_roce_udp_sport
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|index
parameter_list|,
name|__be16
name|ah_udp_s_port
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_get_roce_gid_type
parameter_list|(
name|struct
name|mlx5_ib_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|index
parameter_list|,
name|int
modifier|*
name|gid_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|net_device
modifier|*
name|mlx5_ib_get_netdev
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ib_dev
parameter_list|,
name|u8
name|port
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|modify_gid_roce
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ib_dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|unsigned
name|int
name|index
parameter_list|,
specifier|const
name|union
name|ib_gid
modifier|*
name|gid
parameter_list|,
name|struct
name|net_device
modifier|*
name|ndev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|query_gid_roce
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ib_dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|int
name|index
parameter_list|,
name|union
name|ib_gid
modifier|*
name|gid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|mlx5_process_mad_mad_ifc
parameter_list|(
name|struct
name|ib_device
modifier|*
name|ibdev
parameter_list|,
name|int
name|mad_flags
parameter_list|,
name|u8
name|port_num
parameter_list|,
name|struct
name|ib_wc
modifier|*
name|in_wc
parameter_list|,
name|struct
name|ib_grh
modifier|*
name|in_grh
parameter_list|,
name|struct
name|ib_mad
modifier|*
name|in_mad
parameter_list|,
name|struct
name|ib_mad
modifier|*
name|out_mad
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
specifier|inline
name|void
name|init_query_mad
parameter_list|(
name|struct
name|ib_smp
modifier|*
name|mad
parameter_list|)
block|{
name|mad
operator|->
name|base_version
operator|=
literal|1
expr_stmt|;
name|mad
operator|->
name|mgmt_class
operator|=
name|IB_MGMT_CLASS_SUBN_LID_ROUTED
expr_stmt|;
name|mad
operator|->
name|class_version
operator|=
literal|1
expr_stmt|;
name|mad
operator|->
name|method
operator|=
name|IB_MGMT_METHOD_GET
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|u8
name|convert_access
parameter_list|(
name|int
name|acc
parameter_list|)
block|{
return|return
operator|(
name|acc
operator|&
name|IB_ACCESS_REMOTE_ATOMIC
condition|?
name|MLX5_PERM_ATOMIC
else|:
literal|0
operator|)
operator||
operator|(
name|acc
operator|&
name|IB_ACCESS_REMOTE_WRITE
condition|?
name|MLX5_PERM_REMOTE_WRITE
else|:
literal|0
operator|)
operator||
operator|(
name|acc
operator|&
name|IB_ACCESS_REMOTE_READ
condition|?
name|MLX5_PERM_REMOTE_READ
else|:
literal|0
operator|)
operator||
operator|(
name|acc
operator|&
name|IB_ACCESS_LOCAL_WRITE
condition|?
name|MLX5_PERM_LOCAL_WRITE
else|:
literal|0
operator|)
operator||
name|MLX5_PERM_LOCAL_READ
return|;
block|}
end_function

begin_define
define|#
directive|define
name|MLX5_MAX_UMR_SHIFT
value|16
end_define

begin_define
define|#
directive|define
name|MLX5_MAX_UMR_PAGES
value|(1<< MLX5_MAX_UMR_SHIFT)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* MLX5_IB_H */
end_comment

end_unit

