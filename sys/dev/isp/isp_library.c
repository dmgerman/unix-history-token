begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  *  Copyright (c) 1997-2009 by Matthew Jacob  *  All rights reserved.  *  *  Redistribution and use in source and binary forms, with or without  *  modification, are permitted provided that the following conditions  *  are met:  *  *  1. Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  *  2. Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in the  *     documentation and/or other materials provided with the distribution.  *  *  THIS SOFTWARE IS PROVIDED BY AUTHOR AND CONTRIBUTORS ``AS IS'' AND  *  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  *  ARE DISCLAIMED.  IN NO EVENT SHALL AUTHOR OR CONTRIBUTORS BE LIABLE  *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  *  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  *  OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  *  HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  *  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  *  OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  *  SUCH DAMAGE.  *  */
end_comment

begin_comment
comment|/*  * Qlogic Host Adapter Internal Library Functions  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__NetBSD__
end_ifdef

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__KERNEL_RCSID
argument_list|(
literal|0
argument_list|,
literal|"$NetBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/ic/isp_netbsd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__FreeBSD__
end_ifdef

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<dev/isp/isp_freebsd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__OpenBSD__
end_ifdef

begin_include
include|#
directive|include
file|<dev/ic/isp_openbsd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__linux__
end_ifdef

begin_include
include|#
directive|include
file|"isp_linux.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__svr4__
end_ifdef

begin_include
include|#
directive|include
file|"isp_solaris.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|const
name|char
modifier|*
name|isp_class3_roles
index|[
literal|4
index|]
init|=
block|{
literal|"None"
block|,
literal|"Target"
block|,
literal|"Initiator"
block|,
literal|"Target/Initiator"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Command shipping- finish off first queue entry and do dma mapping and additional segments as needed.  *  * Called with the first queue entry at least partially filled out.  */
end_comment

begin_function
name|int
name|isp_send_cmd
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|void
modifier|*
name|fqe
parameter_list|,
name|void
modifier|*
name|segp
parameter_list|,
name|uint32_t
name|nsegs
parameter_list|,
name|uint32_t
name|totalcnt
parameter_list|,
name|isp_ddir_t
name|ddir
parameter_list|)
block|{
name|uint8_t
name|storage
index|[
name|QENTRY_LEN
index|]
decl_stmt|;
name|uint8_t
name|type
decl_stmt|,
name|nqe
decl_stmt|;
name|uint32_t
name|seg
decl_stmt|,
name|curseg
decl_stmt|,
name|seglim
decl_stmt|,
name|nxt
decl_stmt|,
name|nxtnxt
decl_stmt|,
name|ddf
decl_stmt|;
name|ispds_t
modifier|*
name|dsp
init|=
name|NULL
decl_stmt|;
name|ispds64_t
modifier|*
name|dsp64
init|=
name|NULL
decl_stmt|;
name|void
modifier|*
name|qe0
decl_stmt|,
modifier|*
name|qe1
decl_stmt|;
name|qe0
operator|=
name|isp_getrqentry
argument_list|(
name|isp
argument_list|)
expr_stmt|;
if|if
condition|(
name|qe0
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
name|CMD_EAGAIN
operator|)
return|;
block|}
name|nxt
operator|=
name|ISP_NXT_QENTRY
argument_list|(
name|isp
operator|->
name|isp_reqidx
argument_list|,
name|RQUEST_QUEUE_LEN
argument_list|(
name|isp
argument_list|)
argument_list|)
expr_stmt|;
name|type
operator|=
operator|(
operator|(
name|isphdr_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|rqs_entry_type
expr_stmt|;
name|nqe
operator|=
literal|1
expr_stmt|;
comment|/* 	 * If we have no data to transmit, just copy the first IOCB and start it up. 	 */
if|if
condition|(
name|ddir
operator|==
name|ISP_NOXFR
condition|)
block|{
if|if
condition|(
name|type
operator|==
name|RQSTYPE_T2RQS
operator|||
name|type
operator|==
name|RQSTYPE_T3RQS
condition|)
block|{
name|ddf
operator|=
name|CT2_NO_DATA
expr_stmt|;
block|}
else|else
block|{
name|ddf
operator|=
literal|0
expr_stmt|;
block|}
goto|goto
name|copy_and_sync
goto|;
block|}
comment|/* 	 * First figure out how many pieces of data to transfer and what kind and how many we can put into the first queue entry. 	 */
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|RQSTYPE_REQUEST
case|:
name|ddf
operator|=
operator|(
name|ddir
operator|==
name|ISP_TO_DEVICE
operator|)
condition|?
name|REQFLAG_DATA_OUT
else|:
name|REQFLAG_DATA_IN
expr_stmt|;
name|dsp
operator|=
operator|(
operator|(
name|ispreq_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_dataseg
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG
expr_stmt|;
break|break;
case|case
name|RQSTYPE_CMDONLY
case|:
name|ddf
operator|=
operator|(
name|ddir
operator|==
name|ISP_TO_DEVICE
operator|)
condition|?
name|REQFLAG_DATA_OUT
else|:
name|REQFLAG_DATA_IN
expr_stmt|;
name|seglim
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|RQSTYPE_T2RQS
case|:
name|ddf
operator|=
operator|(
name|ddir
operator|==
name|ISP_TO_DEVICE
operator|)
condition|?
name|REQFLAG_DATA_OUT
else|:
name|REQFLAG_DATA_IN
expr_stmt|;
name|dsp
operator|=
operator|(
operator|(
name|ispreqt2_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_dataseg
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG_T2
expr_stmt|;
break|break;
case|case
name|RQSTYPE_A64
case|:
name|ddf
operator|=
operator|(
name|ddir
operator|==
name|ISP_TO_DEVICE
operator|)
condition|?
name|REQFLAG_DATA_OUT
else|:
name|REQFLAG_DATA_IN
expr_stmt|;
name|dsp64
operator|=
operator|(
operator|(
name|ispreqt3_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_dataseg
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG_T3
expr_stmt|;
break|break;
case|case
name|RQSTYPE_T3RQS
case|:
name|ddf
operator|=
operator|(
name|ddir
operator|==
name|ISP_TO_DEVICE
operator|)
condition|?
name|REQFLAG_DATA_OUT
else|:
name|REQFLAG_DATA_IN
expr_stmt|;
name|dsp64
operator|=
operator|(
operator|(
name|ispreqt3_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_dataseg
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG_T3
expr_stmt|;
break|break;
case|case
name|RQSTYPE_T7RQS
case|:
name|ddf
operator|=
operator|(
name|ddir
operator|==
name|ISP_TO_DEVICE
operator|)
condition|?
name|FCP_CMND_DATA_WRITE
else|:
name|FCP_CMND_DATA_READ
expr_stmt|;
name|dsp64
operator|=
operator|&
operator|(
operator|(
name|ispreqt7_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_dataseg
expr_stmt|;
name|seglim
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|CMD_COMPLETE
operator|)
return|;
block|}
if|if
condition|(
name|seglim
operator|>
name|nsegs
condition|)
block|{
name|seglim
operator|=
name|nsegs
expr_stmt|;
block|}
for|for
control|(
name|seg
operator|=
name|curseg
operator|=
literal|0
init|;
name|curseg
operator|<
name|seglim
condition|;
name|curseg
operator|++
control|)
block|{
if|if
condition|(
name|dsp64
condition|)
block|{
name|XS_GET_DMA64_SEG
argument_list|(
name|dsp64
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XS_GET_DMA_SEG
argument_list|(
name|dsp
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 	 * Second, start building additional continuation segments as needed. 	 */
while|while
condition|(
name|seg
operator|<
name|nsegs
condition|)
block|{
name|nxtnxt
operator|=
name|ISP_NXT_QENTRY
argument_list|(
name|nxt
argument_list|,
name|RQUEST_QUEUE_LEN
argument_list|(
name|isp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|nxtnxt
operator|==
name|isp
operator|->
name|isp_reqodx
condition|)
block|{
return|return
operator|(
name|CMD_EAGAIN
operator|)
return|;
block|}
name|ISP_MEMZERO
argument_list|(
name|storage
argument_list|,
name|QENTRY_LEN
argument_list|)
expr_stmt|;
name|qe1
operator|=
name|ISP_QUEUE_ENTRY
argument_list|(
name|isp
operator|->
name|isp_rquest
argument_list|,
name|nxt
argument_list|)
expr_stmt|;
name|nxt
operator|=
name|nxtnxt
expr_stmt|;
if|if
condition|(
name|dsp64
condition|)
block|{
name|ispcontreq64_t
modifier|*
name|crq
init|=
operator|(
name|ispcontreq64_t
operator|*
operator|)
name|storage
decl_stmt|;
name|seglim
operator|=
name|ISP_CDSEG64
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_A64_CONT
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_count
operator|=
literal|1
expr_stmt|;
name|dsp64
operator|=
name|crq
operator|->
name|req_dataseg
expr_stmt|;
block|}
else|else
block|{
name|ispcontreq_t
modifier|*
name|crq
init|=
operator|(
name|ispcontreq_t
operator|*
operator|)
name|storage
decl_stmt|;
name|seglim
operator|=
name|ISP_CDSEG
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_DATASEG
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_count
operator|=
literal|1
expr_stmt|;
name|dsp
operator|=
name|crq
operator|->
name|req_dataseg
expr_stmt|;
block|}
if|if
condition|(
name|seg
operator|+
name|seglim
operator|>
name|nsegs
condition|)
block|{
name|seglim
operator|=
name|nsegs
operator|-
name|seg
expr_stmt|;
block|}
for|for
control|(
name|curseg
operator|=
literal|0
init|;
name|curseg
operator|<
name|seglim
condition|;
name|curseg
operator|++
control|)
block|{
if|if
condition|(
name|dsp64
condition|)
block|{
name|XS_GET_DMA64_SEG
argument_list|(
name|dsp64
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XS_GET_DMA_SEG
argument_list|(
name|dsp
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|dsp64
condition|)
block|{
name|isp_put_cont64_req
argument_list|(
name|isp
argument_list|,
operator|(
name|ispcontreq64_t
operator|*
operator|)
name|storage
argument_list|,
name|qe1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp_put_cont_req
argument_list|(
name|isp
argument_list|,
operator|(
name|ispcontreq_t
operator|*
operator|)
name|storage
argument_list|,
name|qe1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|isp
operator|->
name|isp_dblev
operator|&
name|ISP_LOGDEBUG1
condition|)
block|{
name|isp_print_bytes
argument_list|(
name|isp
argument_list|,
literal|"additional queue entry"
argument_list|,
name|QENTRY_LEN
argument_list|,
name|storage
argument_list|)
expr_stmt|;
block|}
name|nqe
operator|++
expr_stmt|;
block|}
name|copy_and_sync
label|:
operator|(
operator|(
name|isphdr_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|rqs_entry_count
operator|=
name|nqe
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|RQSTYPE_REQUEST
case|:
operator|(
operator|(
name|ispreq_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_flags
operator||=
name|ddf
expr_stmt|;
comment|/* 		 * This is historical and not clear whether really needed. 		 */
if|if
condition|(
name|nsegs
operator|==
literal|0
condition|)
block|{
name|nsegs
operator|=
literal|1
expr_stmt|;
block|}
operator|(
operator|(
name|ispreq_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_seg_count
operator|=
name|nsegs
expr_stmt|;
name|isp_put_request
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
break|break;
case|case
name|RQSTYPE_CMDONLY
case|:
operator|(
operator|(
name|ispreq_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_flags
operator||=
name|ddf
expr_stmt|;
comment|/* 		 * This is historical and not clear whether really needed. 		 */
if|if
condition|(
name|nsegs
operator|==
literal|0
condition|)
block|{
name|nsegs
operator|=
literal|1
expr_stmt|;
block|}
operator|(
operator|(
name|ispextreq_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_seg_count
operator|=
name|nsegs
expr_stmt|;
name|isp_put_extended_request
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
break|break;
case|case
name|RQSTYPE_T2RQS
case|:
operator|(
operator|(
name|ispreqt2_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_flags
operator||=
name|ddf
expr_stmt|;
operator|(
operator|(
name|ispreqt2_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_seg_count
operator|=
name|nsegs
expr_stmt|;
operator|(
operator|(
name|ispreqt2_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_totalcnt
operator|=
name|totalcnt
expr_stmt|;
if|if
condition|(
name|ISP_CAP_2KLOGIN
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|isp_put_request_t2e
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp_put_request_t2
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|RQSTYPE_A64
case|:
case|case
name|RQSTYPE_T3RQS
case|:
operator|(
operator|(
name|ispreqt3_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_flags
operator||=
name|ddf
expr_stmt|;
operator|(
operator|(
name|ispreqt3_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_seg_count
operator|=
name|nsegs
expr_stmt|;
operator|(
operator|(
name|ispreqt3_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_totalcnt
operator|=
name|totalcnt
expr_stmt|;
if|if
condition|(
name|ISP_CAP_2KLOGIN
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|isp_put_request_t3e
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp_put_request_t3
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|RQSTYPE_T7RQS
case|:
operator|(
operator|(
name|ispreqt7_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_alen_datadir
operator|=
name|ddf
expr_stmt|;
operator|(
operator|(
name|ispreqt7_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_seg_count
operator|=
name|nsegs
expr_stmt|;
operator|(
operator|(
name|ispreqt7_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|req_dl
operator|=
name|totalcnt
expr_stmt|;
name|isp_put_request_t7
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|CMD_COMPLETE
operator|)
return|;
block|}
if|if
condition|(
name|isp
operator|->
name|isp_dblev
operator|&
name|ISP_LOGDEBUG1
condition|)
block|{
name|isp_print_bytes
argument_list|(
name|isp
argument_list|,
literal|"first queue entry"
argument_list|,
name|QENTRY_LEN
argument_list|,
name|fqe
argument_list|)
expr_stmt|;
block|}
name|ISP_ADD_REQUEST
argument_list|(
name|isp
argument_list|,
name|nxt
argument_list|)
expr_stmt|;
return|return
operator|(
name|CMD_QUEUED
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isp_save_xs
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|XS_T
modifier|*
name|xs
parameter_list|,
name|uint32_t
modifier|*
name|handlep
parameter_list|)
block|{
name|uint16_t
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|j
operator|=
name|isp
operator|->
name|isp_lasthdls
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|isp
operator|->
name|isp_maxcmds
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|isp
operator|->
name|isp_xflist
index|[
name|j
index|]
operator|==
name|NULL
condition|)
block|{
break|break;
block|}
if|if
condition|(
operator|++
name|j
operator|==
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
name|j
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
name|i
operator|==
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|isp
operator|->
name|isp_xflist
index|[
name|j
index|]
operator|=
name|xs
expr_stmt|;
operator|*
name|handlep
operator|=
name|j
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|++
name|j
operator|==
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
name|j
operator|=
literal|0
expr_stmt|;
block|}
name|isp
operator|->
name|isp_lasthdls
operator|=
operator|(
name|uint32_t
operator|)
name|j
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|XS_T
modifier|*
name|isp_find_xs
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|uint32_t
name|handle
parameter_list|)
block|{
if|if
condition|(
name|handle
operator|<
literal|1
operator|||
name|handle
operator|>
operator|(
name|uint32_t
operator|)
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
name|isp
operator|->
name|isp_xflist
index|[
name|handle
operator|-
literal|1
index|]
operator|)
return|;
block|}
block|}
end_function

begin_function
name|uint32_t
name|isp_find_handle
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|XS_T
modifier|*
name|xs
parameter_list|)
block|{
name|uint16_t
name|i
decl_stmt|;
if|if
condition|(
name|xs
operator|!=
name|NULL
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|isp
operator|->
name|isp_maxcmds
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|isp
operator|->
name|isp_xflist
index|[
name|i
index|]
operator|==
name|xs
condition|)
block|{
return|return
operator|(
call|(
name|uint32_t
call|)
argument_list|(
name|i
operator|+
literal|1
argument_list|)
operator|)
return|;
block|}
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|isp_handle_index
parameter_list|(
name|uint32_t
name|handle
parameter_list|)
block|{
return|return
operator|(
name|handle
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|void
name|isp_destroy_handle
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|uint32_t
name|handle
parameter_list|)
block|{
if|if
condition|(
name|handle
operator|>
literal|0
operator|&&
name|handle
operator|<=
operator|(
name|uint32_t
operator|)
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
name|isp
operator|->
name|isp_xflist
index|[
name|handle
operator|-
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Make sure we have space to put something on the request queue.  * Return a pointer to that entry if we do. A side effect of this  * function is to update the output index. The input index  * stays the same.  */
end_comment

begin_function
name|void
modifier|*
name|isp_getrqentry
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|)
block|{
name|isp
operator|->
name|isp_reqodx
operator|=
name|ISP_READ
argument_list|(
name|isp
argument_list|,
name|isp
operator|->
name|isp_rqstoutrp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_NXT_QENTRY
argument_list|(
name|isp
operator|->
name|isp_reqidx
argument_list|,
name|RQUEST_QUEUE_LEN
argument_list|(
name|isp
argument_list|)
argument_list|)
operator|==
name|isp
operator|->
name|isp_reqodx
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|ISP_QUEUE_ENTRY
argument_list|(
name|isp
operator|->
name|isp_rquest
argument_list|,
name|isp
operator|->
name|isp_reqidx
argument_list|)
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|TBA
value|(4 * (((QENTRY_LEN>> 2) * 3) + 1) + 1)
end_define

begin_function
name|void
name|isp_print_qentry
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
specifier|const
name|char
modifier|*
name|msg
parameter_list|,
name|int
name|idx
parameter_list|,
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|char
name|buf
index|[
name|TBA
index|]
decl_stmt|;
name|int
name|amt
decl_stmt|,
name|i
decl_stmt|,
name|j
decl_stmt|;
name|uint8_t
modifier|*
name|ptr
init|=
name|arg
decl_stmt|;
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGALL
argument_list|,
literal|"%s index %d=>"
argument_list|,
name|msg
argument_list|,
name|idx
argument_list|)
expr_stmt|;
for|for
control|(
name|buf
index|[
literal|0
index|]
operator|=
literal|0
operator|,
name|amt
operator|=
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|ISP_SNPRINTF
argument_list|(
name|buf
argument_list|,
name|TBA
argument_list|,
literal|"  "
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
operator|(
name|QENTRY_LEN
operator|>>
literal|2
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|ISP_SNPRINTF
argument_list|(
name|buf
argument_list|,
name|TBA
argument_list|,
literal|"%s %02x"
argument_list|,
name|buf
argument_list|,
name|ptr
index|[
name|amt
operator|++
index|]
operator|&
literal|0xff
argument_list|)
expr_stmt|;
block|}
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGALL
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_print_bytes
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
specifier|const
name|char
modifier|*
name|msg
parameter_list|,
name|int
name|amt
parameter_list|,
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|;
name|uint8_t
modifier|*
name|ptr
init|=
name|arg
decl_stmt|;
name|int
name|off
decl_stmt|;
if|if
condition|(
name|msg
condition|)
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGALL
argument_list|,
literal|"%s:"
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|off
operator|=
literal|0
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|off
operator|<
name|amt
condition|)
block|{
name|int
name|j
decl_stmt|,
name|to
decl_stmt|;
name|to
operator|=
name|off
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|16
condition|;
name|j
operator|++
control|)
block|{
name|ISP_SNPRINTF
argument_list|(
name|buf
argument_list|,
literal|128
argument_list|,
literal|"%s %02x"
argument_list|,
name|buf
argument_list|,
name|ptr
index|[
name|off
operator|++
index|]
operator|&
literal|0xff
argument_list|)
expr_stmt|;
if|if
condition|(
name|off
operator|==
name|amt
condition|)
block|{
break|break;
block|}
block|}
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGALL
argument_list|,
literal|"0x%08x:%s"
argument_list|,
name|to
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Do the common path to try and ensure that link is up, we've scanned  * the fabric (if we're on a fabric), and that we've synchronized this  * all with our own database and done the appropriate logins.  *  * We repeatedly check for firmware state and loop state after each  * action because things may have changed while we were doing this.  * Any failure or change of state causes us to return a nonzero value.  *  * We assume we enter here with any locks held.  */
end_comment

begin_function
name|int
name|isp_fc_runstate
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|int
name|tval
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcp
operator|->
name|role
operator|==
name|ISP_ROLE_NONE
condition|)
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|fcp
operator|->
name|isp_fwstate
operator|<
name|FW_READY
operator|||
name|fcp
operator|->
name|isp_loopstate
operator|<
name|LOOP_PDB_RCVD
condition|)
block|{
if|if
condition|(
name|isp_control
argument_list|(
name|isp
argument_list|,
name|ISPCTL_FCLINK_TEST
argument_list|,
name|chan
argument_list|,
name|tval
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGSANCFG
argument_list|,
literal|"isp_fc_runstate: linktest failed for channel %d"
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|fcp
operator|->
name|isp_fwstate
operator|!=
name|FW_READY
operator|||
name|fcp
operator|->
name|isp_loopstate
operator|<
name|LOOP_PDB_RCVD
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGSANCFG
argument_list|,
literal|"isp_fc_runstate: f/w not ready for channel %d"
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
if|if
condition|(
operator|(
name|fcp
operator|->
name|role
operator|&
name|ISP_ROLE_INITIATOR
operator|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|isp_control
argument_list|(
name|isp
argument_list|,
name|ISPCTL_SCAN_LOOP
argument_list|,
name|chan
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGSANCFG
argument_list|,
literal|"isp_fc_runstate: scan loop fails on channel %d"
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
name|LOOP_PDB_RCVD
operator|)
return|;
block|}
if|if
condition|(
name|isp_control
argument_list|(
name|isp
argument_list|,
name|ISPCTL_SCAN_FABRIC
argument_list|,
name|chan
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGSANCFG
argument_list|,
literal|"isp_fc_runstate: scan fabric fails on channel %d"
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
name|LOOP_LSCAN_DONE
operator|)
return|;
block|}
if|if
condition|(
name|isp_control
argument_list|(
name|isp
argument_list|,
name|ISPCTL_PDB_SYNC
argument_list|,
name|chan
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGSANCFG
argument_list|,
literal|"isp_fc_runstate: pdb_sync fails on channel %d"
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
name|LOOP_FSCAN_DONE
operator|)
return|;
block|}
if|if
condition|(
name|fcp
operator|->
name|isp_fwstate
operator|!=
name|FW_READY
operator|||
name|fcp
operator|->
name|isp_loopstate
operator|!=
name|LOOP_READY
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGSANCFG
argument_list|,
literal|"isp_fc_runstate: f/w not ready again on channel %d"
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Fibre Channel Support routines  */
end_comment

begin_function
name|void
name|isp_dump_portdb
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
init|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_FC_TARG
condition|;
name|i
operator|++
control|)
block|{
name|char
name|mb
index|[
literal|4
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|dbs
index|[
literal|8
index|]
init|=
block|{
literal|"NIL "
block|,
literal|"PROB"
block|,
literal|"DEAD"
block|,
literal|"CHGD"
block|,
literal|"NEW "
block|,
literal|"PVLD"
block|,
literal|"ZOMB"
block|,
literal|"VLD "
block|}
decl_stmt|;
specifier|const
name|char
modifier|*
name|roles
index|[
literal|4
index|]
init|=
block|{
literal|" UNK"
block|,
literal|" TGT"
block|,
literal|" INI"
block|,
literal|"TINI"
block|}
decl_stmt|;
name|fcportdb_t
modifier|*
name|lp
init|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|lp
operator|->
name|state
operator|==
name|FC_PORTDB_STATE_NIL
operator|&&
name|lp
operator|->
name|target_mode
operator|==
literal|0
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|lp
operator|->
name|dev_map_idx
condition|)
block|{
name|ISP_SNPRINTF
argument_list|(
name|mb
argument_list|,
sizeof|sizeof
argument_list|(
name|mb
argument_list|)
argument_list|,
literal|"%3d"
argument_list|,
operator|(
operator|(
name|int
operator|)
name|lp
operator|->
name|dev_map_idx
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_SNPRINTF
argument_list|(
name|mb
argument_list|,
sizeof|sizeof
argument_list|(
name|mb
argument_list|)
argument_list|,
literal|"---"
argument_list|)
expr_stmt|;
block|}
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGALL
argument_list|,
literal|"Chan %d [%d]: hdl 0x%x %s al%d tgt %s %s 0x%06x =>%s 0x%06x; WWNN 0x%08x%08x WWPN 0x%08x%08x"
argument_list|,
name|chan
argument_list|,
name|i
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|dbs
index|[
name|lp
operator|->
name|state
index|]
argument_list|,
name|lp
operator|->
name|autologin
argument_list|,
name|mb
argument_list|,
name|roles
index|[
name|lp
operator|->
name|roles
index|]
argument_list|,
name|lp
operator|->
name|portid
argument_list|,
name|roles
index|[
name|lp
operator|->
name|new_roles
index|]
argument_list|,
name|lp
operator|->
name|new_portid
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|lp
operator|->
name|node_wwn
operator|>>
literal|32
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|lp
operator|->
name|node_wwn
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|lp
operator|->
name|port_wwn
operator|>>
literal|32
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|lp
operator|->
name|port_wwn
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|isp_fc_fw_statename
parameter_list|(
name|int
name|state
parameter_list|)
block|{
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|FW_CONFIG_WAIT
case|:
return|return
literal|"Config Wait"
return|;
case|case
name|FW_WAIT_AL_PA
case|:
return|return
literal|"Waiting for AL_PA"
return|;
case|case
name|FW_WAIT_LOGIN
case|:
return|return
literal|"Wait Login"
return|;
case|case
name|FW_READY
case|:
return|return
literal|"Ready"
return|;
case|case
name|FW_LOSS_OF_SYNC
case|:
return|return
literal|"Loss Of Sync"
return|;
case|case
name|FW_ERROR
case|:
return|return
literal|"Error"
return|;
case|case
name|FW_REINIT
case|:
return|return
literal|"Re-Init"
return|;
case|case
name|FW_NON_PART
case|:
return|return
literal|"Nonparticipating"
return|;
default|default:
return|return
literal|"?????"
return|;
block|}
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|isp_fc_loop_statename
parameter_list|(
name|int
name|state
parameter_list|)
block|{
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|LOOP_NIL
case|:
return|return
literal|"NIL"
return|;
case|case
name|LOOP_LIP_RCVD
case|:
return|return
literal|"LIP Received"
return|;
case|case
name|LOOP_PDB_RCVD
case|:
return|return
literal|"PDB Received"
return|;
case|case
name|LOOP_SCANNING_LOOP
case|:
return|return
literal|"Scanning"
return|;
case|case
name|LOOP_LSCAN_DONE
case|:
return|return
literal|"Loop Scan Done"
return|;
case|case
name|LOOP_SCANNING_FABRIC
case|:
return|return
literal|"Scanning Fabric"
return|;
case|case
name|LOOP_FSCAN_DONE
case|:
return|return
literal|"Fabric Scan Done"
return|;
case|case
name|LOOP_SYNCING_PDB
case|:
return|return
literal|"Syncing PDB"
return|;
case|case
name|LOOP_READY
case|:
return|return
literal|"Ready"
return|;
default|default:
return|return
literal|"?????"
return|;
block|}
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|isp_fc_toponame
parameter_list|(
name|fcparam
modifier|*
name|fcp
parameter_list|)
block|{
if|if
condition|(
name|fcp
operator|->
name|isp_fwstate
operator|!=
name|FW_READY
condition|)
block|{
return|return
literal|"Unavailable"
return|;
block|}
switch|switch
condition|(
name|fcp
operator|->
name|isp_topo
condition|)
block|{
case|case
name|TOPO_NL_PORT
case|:
return|return
literal|"Private Loop"
return|;
case|case
name|TOPO_FL_PORT
case|:
return|return
literal|"FL Port"
return|;
case|case
name|TOPO_N_PORT
case|:
return|return
literal|"N-Port to N-Port"
return|;
case|case
name|TOPO_F_PORT
case|:
return|return
literal|"F Port"
return|;
case|case
name|TOPO_PTP_STUB
case|:
return|return
literal|"F Port (no FLOGI_ACC response)"
return|;
default|default:
return|return
literal|"?????"
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Change Roles  */
end_comment

begin_function
name|int
name|isp_fc_change_role
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|int
name|new_role
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
init|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
decl_stmt|;
if|if
condition|(
name|chan
operator|>=
name|isp
operator|->
name|isp_nchan
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: bad channel %d"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENXIO
operator|)
return|;
block|}
if|if
condition|(
name|chan
operator|==
literal|0
condition|)
block|{
ifdef|#
directive|ifdef
name|ISP_TARGET_MODE
name|isp_del_all_wwn_entries
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|isp_clear_commands
argument_list|(
name|isp
argument_list|)
expr_stmt|;
name|isp_reset
argument_list|(
name|isp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|isp
operator|->
name|isp_state
operator|!=
name|ISP_RESETSTATE
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGERR
argument_list|,
literal|"%s: cannot reset card"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|fcp
operator|->
name|role
operator|=
name|new_role
expr_stmt|;
name|isp_init
argument_list|(
name|isp
argument_list|)
expr_stmt|;
if|if
condition|(
name|isp
operator|->
name|isp_state
operator|!=
name|ISP_INITSTATE
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGERR
argument_list|,
literal|"%s: cannot init card"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|isp
operator|->
name|isp_state
operator|=
name|ISP_RUNSTATE
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|ISP_CAP_MULTI_ID
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|mbreg_t
name|mbs
decl_stmt|;
name|vp_modify_t
modifier|*
name|vp
decl_stmt|;
name|uint8_t
name|qe
index|[
name|QENTRY_LEN
index|]
decl_stmt|,
modifier|*
name|scp
decl_stmt|;
name|ISP_MEMZERO
argument_list|(
name|qe
argument_list|,
name|QENTRY_LEN
argument_list|)
expr_stmt|;
comment|/* Acquire Scratch */
if|if
condition|(
name|FC_SCRATCH_ACQUIRE
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
condition|)
block|{
return|return
operator|(
name|EBUSY
operator|)
return|;
block|}
name|scp
operator|=
name|fcp
operator|->
name|isp_scratch
expr_stmt|;
comment|/* 		 * Build a VP MODIFY command in memory 		 */
name|vp
operator|=
operator|(
name|vp_modify_t
operator|*
operator|)
name|qe
expr_stmt|;
name|vp
operator|->
name|vp_mod_hdr
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_VP_MODIFY
expr_stmt|;
name|vp
operator|->
name|vp_mod_hdr
operator|.
name|rqs_entry_count
operator|=
literal|1
expr_stmt|;
name|vp
operator|->
name|vp_mod_cnt
operator|=
literal|1
expr_stmt|;
name|vp
operator|->
name|vp_mod_idx0
operator|=
name|chan
expr_stmt|;
name|vp
operator|->
name|vp_mod_cmd
operator|=
name|VP_MODIFY_ENA
expr_stmt|;
name|vp
operator|->
name|vp_mod_ports
index|[
literal|0
index|]
operator|.
name|options
operator|=
name|ICB2400_VPOPT_ENABLED
expr_stmt|;
if|if
condition|(
name|new_role
operator|&
name|ISP_ROLE_INITIATOR
condition|)
block|{
name|vp
operator|->
name|vp_mod_ports
index|[
literal|0
index|]
operator|.
name|options
operator||=
name|ICB2400_VPOPT_INI_ENABLE
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|new_role
operator|&
name|ISP_ROLE_TARGET
operator|)
operator|==
literal|0
condition|)
block|{
name|vp
operator|->
name|vp_mod_ports
index|[
literal|0
index|]
operator|.
name|options
operator||=
name|ICB2400_VPOPT_TGT_DISABLE
expr_stmt|;
block|}
name|MAKE_NODE_NAME_FROM_WWN
argument_list|(
name|vp
operator|->
name|vp_mod_ports
index|[
literal|0
index|]
operator|.
name|wwpn
argument_list|,
name|fcp
operator|->
name|isp_wwpn
argument_list|)
expr_stmt|;
name|MAKE_NODE_NAME_FROM_WWN
argument_list|(
name|vp
operator|->
name|vp_mod_ports
index|[
literal|0
index|]
operator|.
name|wwnn
argument_list|,
name|fcp
operator|->
name|isp_wwnn
argument_list|)
expr_stmt|;
name|isp_put_vp_modify
argument_list|(
name|isp
argument_list|,
name|vp
argument_list|,
operator|(
name|vp_modify_t
operator|*
operator|)
name|scp
argument_list|)
expr_stmt|;
comment|/* 		 * Build a EXEC IOCB A64 command that points to the VP MODIFY command 		 */
name|MBSINIT
argument_list|(
operator|&
name|mbs
argument_list|,
name|MBOX_EXEC_COMMAND_IOCB_A64
argument_list|,
name|MBLOGALL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mbs
operator|.
name|param
index|[
literal|1
index|]
operator|=
name|QENTRY_LEN
expr_stmt|;
name|mbs
operator|.
name|param
index|[
literal|2
index|]
operator|=
name|DMA_WD1
argument_list|(
name|fcp
operator|->
name|isp_scdma
argument_list|)
expr_stmt|;
name|mbs
operator|.
name|param
index|[
literal|3
index|]
operator|=
name|DMA_WD0
argument_list|(
name|fcp
operator|->
name|isp_scdma
argument_list|)
expr_stmt|;
name|mbs
operator|.
name|param
index|[
literal|6
index|]
operator|=
name|DMA_WD3
argument_list|(
name|fcp
operator|->
name|isp_scdma
argument_list|)
expr_stmt|;
name|mbs
operator|.
name|param
index|[
literal|7
index|]
operator|=
name|DMA_WD2
argument_list|(
name|fcp
operator|->
name|isp_scdma
argument_list|)
expr_stmt|;
name|MEMORYBARRIER
argument_list|(
name|isp
argument_list|,
name|SYNC_SFORDEV
argument_list|,
literal|0
argument_list|,
literal|2
operator|*
name|QENTRY_LEN
argument_list|)
expr_stmt|;
name|isp_control
argument_list|(
name|isp
argument_list|,
name|ISPCTL_RUN_MBOXCMD
argument_list|,
operator|&
name|mbs
argument_list|)
expr_stmt|;
if|if
condition|(
name|mbs
operator|.
name|param
index|[
literal|0
index|]
operator|!=
name|MBOX_COMMAND_COMPLETE
condition|)
block|{
name|FC_SCRATCH_RELEASE
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|MEMORYBARRIER
argument_list|(
name|isp
argument_list|,
name|SYNC_SFORCPU
argument_list|,
name|QENTRY_LEN
argument_list|,
name|QENTRY_LEN
argument_list|)
expr_stmt|;
name|isp_get_vp_modify
argument_list|(
name|isp
argument_list|,
operator|(
name|vp_modify_t
operator|*
operator|)
operator|&
name|scp
index|[
name|QENTRY_LEN
index|]
argument_list|,
name|vp
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|ISP_TARGET_MODE
name|isp_del_all_wwn_entries
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* 		 * Release Scratch 		 */
name|FC_SCRATCH_RELEASE
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
if|if
condition|(
name|vp
operator|->
name|vp_mod_status
operator|!=
name|VP_STS_OK
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGERR
argument_list|,
literal|"%s: VP_MODIFY of Chan %d failed with status %d"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
name|vp
operator|->
name|vp_mod_status
argument_list|)
expr_stmt|;
return|return
operator|(
name|EIO
operator|)
return|;
block|}
name|fcp
operator|->
name|role
operator|=
name|new_role
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
name|EINVAL
operator|)
return|;
block|}
block|}
end_function

begin_function
name|void
name|isp_clear_commands
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|)
block|{
name|XS_T
modifier|*
name|xs
decl_stmt|;
name|uint32_t
name|tmp
decl_stmt|,
name|handle
decl_stmt|;
ifdef|#
directive|ifdef
name|ISP_TARGET_MODE
name|isp_notify_t
name|notify
decl_stmt|;
endif|#
directive|endif
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|isp
operator|->
name|isp_xflist
operator|&&
name|tmp
operator|<
name|isp
operator|->
name|isp_maxcmds
condition|;
name|tmp
operator|++
control|)
block|{
name|xs
operator|=
name|isp
operator|->
name|isp_xflist
index|[
name|tmp
index|]
expr_stmt|;
if|if
condition|(
name|xs
operator|==
name|NULL
condition|)
block|{
continue|continue;
block|}
name|handle
operator|=
name|isp_find_handle
argument_list|(
name|isp
argument_list|,
name|xs
argument_list|)
expr_stmt|;
if|if
condition|(
name|handle
operator|==
literal|0
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|XS_XFRLEN
argument_list|(
name|xs
argument_list|)
condition|)
block|{
name|ISP_DMAFREE
argument_list|(
name|isp
argument_list|,
name|xs
argument_list|,
name|handle
argument_list|)
expr_stmt|;
name|XS_SET_RESID
argument_list|(
name|xs
argument_list|,
name|XS_XFRLEN
argument_list|(
name|xs
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XS_SET_RESID
argument_list|(
name|xs
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|isp_destroy_handle
argument_list|(
name|isp
argument_list|,
name|handle
argument_list|)
expr_stmt|;
name|XS_SETERR
argument_list|(
name|xs
argument_list|,
name|HBA_BUSRESET
argument_list|)
expr_stmt|;
name|isp_done
argument_list|(
name|xs
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|ISP_TARGET_MODE
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|isp
operator|->
name|isp_tgtlist
operator|&&
name|tmp
operator|<
name|isp
operator|->
name|isp_maxcmds
condition|;
name|tmp
operator|++
control|)
block|{
name|uint8_t
name|local
index|[
name|QENTRY_LEN
index|]
decl_stmt|;
name|xs
operator|=
name|isp
operator|->
name|isp_tgtlist
index|[
name|tmp
index|]
expr_stmt|;
if|if
condition|(
name|xs
operator|==
name|NULL
condition|)
block|{
continue|continue;
block|}
name|handle
operator|=
name|isp_find_tgt_handle
argument_list|(
name|isp
argument_list|,
name|xs
argument_list|)
expr_stmt|;
if|if
condition|(
name|handle
operator|==
literal|0
condition|)
block|{
continue|continue;
block|}
name|ISP_DMAFREE
argument_list|(
name|isp
argument_list|,
name|xs
argument_list|,
name|handle
argument_list|)
expr_stmt|;
name|ISP_MEMZERO
argument_list|(
name|local
argument_list|,
name|QENTRY_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_24XX
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ct7_entry_t
modifier|*
name|ctio
init|=
operator|(
name|ct7_entry_t
operator|*
operator|)
name|local
decl_stmt|;
name|ctio
operator|->
name|ct_syshandle
operator|=
name|handle
expr_stmt|;
name|ctio
operator|->
name|ct_nphdl
operator|=
name|CT_HBA_RESET
expr_stmt|;
name|ctio
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_CTIO7
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_FC
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ct2_entry_t
modifier|*
name|ctio
init|=
operator|(
name|ct2_entry_t
operator|*
operator|)
name|local
decl_stmt|;
name|ctio
operator|->
name|ct_syshandle
operator|=
name|handle
expr_stmt|;
name|ctio
operator|->
name|ct_status
operator|=
name|CT_HBA_RESET
expr_stmt|;
name|ctio
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_CTIO2
expr_stmt|;
block|}
else|else
block|{
name|ct_entry_t
modifier|*
name|ctio
init|=
operator|(
name|ct_entry_t
operator|*
operator|)
name|local
decl_stmt|;
name|ctio
operator|->
name|ct_syshandle
operator|=
name|handle
operator|&
literal|0xffff
expr_stmt|;
name|ctio
operator|->
name|ct_status
operator|=
name|CT_HBA_RESET
operator|&
literal|0xff
expr_stmt|;
name|ctio
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_CTIO
expr_stmt|;
block|}
name|isp_async
argument_list|(
name|isp
argument_list|,
name|ISPASYNC_TARGET_ACTION
argument_list|,
name|local
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|isp
operator|->
name|isp_nchan
condition|;
name|tmp
operator|++
control|)
block|{
name|ISP_MEMZERO
argument_list|(
operator|&
name|notify
argument_list|,
sizeof|sizeof
argument_list|(
name|isp_notify_t
argument_list|)
argument_list|)
expr_stmt|;
name|notify
operator|.
name|nt_ncode
operator|=
name|NT_HBA_RESET
expr_stmt|;
name|notify
operator|.
name|nt_hba
operator|=
name|isp
expr_stmt|;
name|notify
operator|.
name|nt_wwn
operator|=
name|INI_ANY
expr_stmt|;
name|notify
operator|.
name|nt_nphdl
operator|=
name|NIL_HANDLE
expr_stmt|;
name|notify
operator|.
name|nt_sid
operator|=
name|PORT_ANY
expr_stmt|;
name|notify
operator|.
name|nt_did
operator|=
name|PORT_ANY
expr_stmt|;
name|notify
operator|.
name|nt_tgt
operator|=
name|TGT_ANY
expr_stmt|;
name|notify
operator|.
name|nt_channel
operator|=
name|tmp
expr_stmt|;
name|notify
operator|.
name|nt_lun
operator|=
name|LUN_ANY
expr_stmt|;
name|notify
operator|.
name|nt_tagval
operator|=
name|TAG_ANY
expr_stmt|;
name|isp_async
argument_list|(
name|isp
argument_list|,
name|ISPASYNC_TARGET_NOTIFY
argument_list|,
operator|&
name|notify
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isp_shutdown
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|)
block|{
if|if
condition|(
name|IS_FC
argument_list|(
name|isp
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_24XX
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU2400_ICR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU2400_HCCR
argument_list|,
name|HCCR_2400_CMD_PAUSE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU_ICR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|HCCR
argument_list|,
name|HCCR_CMD_PAUSE
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU2100_CSR
argument_list|,
name|BIU2100_FPM0_REGS
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|FPM_DIAG_CONFIG
argument_list|,
name|FPM_SOFT_RESET
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU2100_CSR
argument_list|,
name|BIU2100_FB_REGS
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|FBM_CMD
argument_list|,
name|FBMCMD_FIFO_RESET_ALL
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU2100_CSR
argument_list|,
name|BIU2100_RISC_REGS
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|BIU_ICR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ISP_WRITE
argument_list|(
name|isp
argument_list|,
name|HCCR
argument_list|,
name|HCCR_CMD_PAUSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Functions to move stuff to a form that the QLogic RISC engine understands  * and functions to move stuff back to a form the processor understands.  *  * Each platform is required to provide the 8, 16 and 32 bit  * swizzle and unswizzle macros (ISP_IOX{PUT|GET}_{8,16,32})  *  * The assumption is that swizzling and unswizzling is mostly done 'in place'  * (with a few exceptions for efficiency).  */
end_comment

begin_define
define|#
directive|define
name|ISP_IS_SBUS
parameter_list|(
name|isp
parameter_list|)
value|(ISP_SBUS_SUPPORTED&& (isp)->isp_bustype == ISP_BT_SBUS)
end_define

begin_define
define|#
directive|define
name|ASIZE
parameter_list|(
name|x
parameter_list|)
value|(sizeof (x) / sizeof (x[0]))
end_define

begin_comment
comment|/*  * Swizzle/Copy Functions  */
end_comment

begin_function
name|void
name|isp_put_hdr
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isphdr_t
modifier|*
name|hpsrc
parameter_list|,
name|isphdr_t
modifier|*
name|hpdst
parameter_list|)
block|{
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_entry_type
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_entry_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_entry_count
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_entry_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_seqno
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_flags
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_seqno
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_entry_type
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_entry_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_entry_count
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_entry_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_seqno
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_seqno
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|hpsrc
operator|->
name|rqs_flags
argument_list|,
operator|&
name|hpdst
operator|->
name|rqs_flags
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_hdr
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isphdr_t
modifier|*
name|hpsrc
parameter_list|,
name|isphdr_t
modifier|*
name|hpdst
parameter_list|)
block|{
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_entry_type
argument_list|,
name|hpdst
operator|->
name|rqs_entry_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_entry_count
argument_list|,
name|hpdst
operator|->
name|rqs_entry_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_seqno
argument_list|,
name|hpdst
operator|->
name|rqs_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_flags
argument_list|,
name|hpdst
operator|->
name|rqs_seqno
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_entry_type
argument_list|,
name|hpdst
operator|->
name|rqs_entry_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_entry_count
argument_list|,
name|hpdst
operator|->
name|rqs_entry_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_seqno
argument_list|,
name|hpdst
operator|->
name|rqs_seqno
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hpsrc
operator|->
name|rqs_flags
argument_list|,
name|hpdst
operator|->
name|rqs_flags
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|isp_get_response_type
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isphdr_t
modifier|*
name|hp
parameter_list|)
block|{
name|uint8_t
name|type
decl_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hp
operator|->
name|rqs_entry_count
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|hp
operator|->
name|rqs_entry_type
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
operator|(
name|int
operator|)
name|type
operator|)
return|;
block|}
end_function

begin_function
name|void
name|isp_put_request
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispreq_t
modifier|*
name|rqsrc
parameter_list|,
name|ispreq_t
modifier|*
name|rqdst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|rqsrc
operator|->
name|req_header
argument_list|,
operator|&
name|rqdst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_handle
argument_list|,
operator|&
name|rqdst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_lun_trn
argument_list|,
operator|&
name|rqdst
operator|->
name|req_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_target
argument_list|,
operator|&
name|rqdst
operator|->
name|req_lun_trn
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_lun_trn
argument_list|,
operator|&
name|rqdst
operator|->
name|req_lun_trn
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_target
argument_list|,
operator|&
name|rqdst
operator|->
name|req_target
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_cdblen
argument_list|,
operator|&
name|rqdst
operator|->
name|req_cdblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_flags
argument_list|,
operator|&
name|rqdst
operator|->
name|req_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_time
argument_list|,
operator|&
name|rqdst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_seg_count
argument_list|,
operator|&
name|rqdst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|rqsrc
operator|->
name|req_cdb
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|rqdst
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|rqdst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|rqsrc
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|rqdst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_marker
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_marker_t
modifier|*
name|src
parameter_list|,
name|isp_marker_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|mrk_header
argument_list|,
operator|&
name|dst
operator|->
name|mrk_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_handle
argument_list|,
operator|&
name|dst
operator|->
name|mrk_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|mrk_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_target
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_target
argument_list|,
operator|&
name|dst
operator|->
name|mrk_target
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_modifier
argument_list|,
operator|&
name|dst
operator|->
name|mrk_modifier
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_flags
argument_list|,
operator|&
name|dst
operator|->
name|mrk_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_lun
argument_list|,
operator|&
name|dst
operator|->
name|mrk_lun
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|mrk_reserved1
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved1
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_marker_24xx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_marker_24xx_t
modifier|*
name|src
parameter_list|,
name|isp_marker_24xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|mrk_header
argument_list|,
operator|&
name|dst
operator|->
name|mrk_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_handle
argument_list|,
operator|&
name|dst
operator|->
name|mrk_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|mrk_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_modifier
argument_list|,
operator|&
name|dst
operator|->
name|mrk_modifier
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_vphdl
argument_list|,
operator|&
name|dst
operator|->
name|mrk_vphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|mrk_lun
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_lun
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|mrk_lun
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|mrk_reserved3
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|mrk_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|mrk_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_request_t2
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispreqt2_t
modifier|*
name|src
parameter_list|,
name|ispreqt2_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_handle
argument_list|,
operator|&
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_lun_trn
argument_list|,
operator|&
name|dst
operator|->
name|req_lun_trn
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_target
argument_list|,
operator|&
name|dst
operator|->
name|req_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_scclun
argument_list|,
operator|&
name|dst
operator|->
name|req_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_flags
argument_list|,
operator|&
name|dst
operator|->
name|req_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_reserved
argument_list|,
operator|&
name|dst
operator|->
name|req_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_time
argument_list|,
operator|&
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|req_cdb
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_totalcnt
argument_list|,
operator|&
name|dst
operator|->
name|req_totalcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_request_t2e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispreqt2e_t
modifier|*
name|src
parameter_list|,
name|ispreqt2e_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_handle
argument_list|,
operator|&
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_target
argument_list|,
operator|&
name|dst
operator|->
name|req_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_scclun
argument_list|,
operator|&
name|dst
operator|->
name|req_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_flags
argument_list|,
operator|&
name|dst
operator|->
name|req_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_reserved
argument_list|,
operator|&
name|dst
operator|->
name|req_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_time
argument_list|,
operator|&
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|req_cdb
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_totalcnt
argument_list|,
operator|&
name|dst
operator|->
name|req_totalcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_request_t3
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispreqt3_t
modifier|*
name|src
parameter_list|,
name|ispreqt3_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_handle
argument_list|,
operator|&
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_lun_trn
argument_list|,
operator|&
name|dst
operator|->
name|req_lun_trn
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_target
argument_list|,
operator|&
name|dst
operator|->
name|req_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_scclun
argument_list|,
operator|&
name|dst
operator|->
name|req_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_flags
argument_list|,
operator|&
name|dst
operator|->
name|req_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_reserved
argument_list|,
operator|&
name|dst
operator|->
name|req_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_time
argument_list|,
operator|&
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|req_cdb
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_totalcnt
argument_list|,
operator|&
name|dst
operator|->
name|req_totalcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_request_t3e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispreqt3e_t
modifier|*
name|src
parameter_list|,
name|ispreqt3e_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_handle
argument_list|,
operator|&
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_target
argument_list|,
operator|&
name|dst
operator|->
name|req_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_scclun
argument_list|,
operator|&
name|dst
operator|->
name|req_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_flags
argument_list|,
operator|&
name|dst
operator|->
name|req_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_reserved
argument_list|,
operator|&
name|dst
operator|->
name|req_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_time
argument_list|,
operator|&
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|req_cdb
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_totalcnt
argument_list|,
operator|&
name|dst
operator|->
name|req_totalcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_extended_request
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispextreq_t
modifier|*
name|src
parameter_list|,
name|ispextreq_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_handle
argument_list|,
operator|&
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_lun_trn
argument_list|,
operator|&
name|dst
operator|->
name|req_target
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_target
argument_list|,
operator|&
name|dst
operator|->
name|req_lun_trn
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_lun_trn
argument_list|,
operator|&
name|dst
operator|->
name|req_lun_trn
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_target
argument_list|,
operator|&
name|dst
operator|->
name|req_target
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_cdblen
argument_list|,
operator|&
name|dst
operator|->
name|req_cdblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_flags
argument_list|,
operator|&
name|dst
operator|->
name|req_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_time
argument_list|,
operator|&
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|req_cdb
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|req_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_request_t7
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispreqt7_t
modifier|*
name|src
parameter_list|,
name|ispreqt7_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint32_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_handle
argument_list|,
operator|&
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|req_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_time
argument_list|,
operator|&
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|req_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_reserved
argument_list|,
operator|&
name|dst
operator|->
name|req_reserved
argument_list|)
expr_stmt|;
name|a
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|src
operator|->
name|req_lun
expr_stmt|;
name|b
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|dst
operator|->
name|req_lun
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|ASIZE
argument_list|(
name|src
operator|->
name|req_lun
argument_list|)
operator|>>
literal|2
operator|)
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|b
operator|++
operator|=
name|ISP_SWAP32
argument_list|(
name|isp
argument_list|,
operator|*
name|a
operator|++
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_alen_datadir
argument_list|,
operator|&
name|dst
operator|->
name|req_alen_datadir
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_task_management
argument_list|,
operator|&
name|dst
operator|->
name|req_task_management
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_task_attribute
argument_list|,
operator|&
name|dst
operator|->
name|req_task_attribute
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_crn
argument_list|,
operator|&
name|dst
operator|->
name|req_crn
argument_list|)
expr_stmt|;
name|a
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|src
operator|->
name|req_cdb
expr_stmt|;
name|b
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|dst
operator|->
name|req_cdb
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|ASIZE
argument_list|(
name|src
operator|->
name|req_cdb
argument_list|)
operator|>>
literal|2
operator|)
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|b
operator|++
operator|=
name|ISP_SWAP32
argument_list|(
name|isp
argument_list|,
operator|*
name|a
operator|++
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dl
argument_list|,
operator|&
name|dst
operator|->
name|req_dl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_tidlo
argument_list|,
operator|&
name|dst
operator|->
name|req_tidlo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_tidhi
argument_list|,
operator|&
name|dst
operator|->
name|req_tidhi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|req_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_24xx_tmf
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp24xx_tmf_t
modifier|*
name|src
parameter_list|,
name|isp24xx_tmf_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint32_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|tmf_header
argument_list|,
operator|&
name|dst
operator|->
name|tmf_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_handle
argument_list|,
operator|&
name|dst
operator|->
name|tmf_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|tmf_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_delay
argument_list|,
operator|&
name|dst
operator|->
name|tmf_delay
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_timeout
argument_list|,
operator|&
name|dst
operator|->
name|tmf_timeout
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|tmf_reserved0
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_reserved0
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|tmf_reserved0
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|a
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|src
operator|->
name|tmf_lun
expr_stmt|;
name|b
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|dst
operator|->
name|tmf_lun
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|ASIZE
argument_list|(
name|src
operator|->
name|tmf_lun
argument_list|)
operator|>>
literal|2
operator|)
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|b
operator|++
operator|=
name|ISP_SWAP32
argument_list|(
name|isp
argument_list|,
operator|*
name|a
operator|++
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_flags
argument_list|,
operator|&
name|dst
operator|->
name|tmf_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|tmf_reserved1
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_reserved1
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|tmf_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_tidlo
argument_list|,
operator|&
name|dst
operator|->
name|tmf_tidlo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_tidhi
argument_list|,
operator|&
name|dst
operator|->
name|tmf_tidhi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|tmf_vpidx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|tmf_reserved2
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|tmf_reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|tmf_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_24xx_abrt
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp24xx_abrt_t
modifier|*
name|src
parameter_list|,
name|isp24xx_abrt_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_header
argument_list|,
operator|&
name|dst
operator|->
name|abrt_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_handle
argument_list|,
operator|&
name|dst
operator|->
name|abrt_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|abrt_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_options
argument_list|,
operator|&
name|dst
operator|->
name|abrt_options
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_cmd_handle
argument_list|,
operator|&
name|dst
operator|->
name|abrt_cmd_handle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|abrt_reserved
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_reserved
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|abrt_reserved
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_tidlo
argument_list|,
operator|&
name|dst
operator|->
name|abrt_tidlo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_tidhi
argument_list|,
operator|&
name|dst
operator|->
name|abrt_tidhi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|abrt_vpidx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|abrt_reserved1
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abrt_reserved1
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|abrt_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_cont_req
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispcontreq_t
modifier|*
name|src
parameter_list|,
name|ispcontreq_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_CDSEG
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_cont64_req
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispcontreq64_t
modifier|*
name|src
parameter_list|,
name|ispcontreq64_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_CDSEG64
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|req_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ispstatusreq_t
modifier|*
name|src
parameter_list|,
name|ispstatusreq_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_handle
argument_list|,
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_scsi_status
argument_list|,
name|dst
operator|->
name|req_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_completion_status
argument_list|,
name|dst
operator|->
name|req_completion_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_state_flags
argument_list|,
name|dst
operator|->
name|req_state_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_status_flags
argument_list|,
name|dst
operator|->
name|req_status_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_time
argument_list|,
name|dst
operator|->
name|req_time
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_sense_len
argument_list|,
name|dst
operator|->
name|req_sense_len
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_resid
argument_list|,
name|dst
operator|->
name|req_resid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_response
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|req_response
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_sense_data
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|req_sense_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_24xx_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp24xx_statusreq_t
modifier|*
name|src
parameter_list|,
name|isp24xx_statusreq_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint32_t
modifier|*
name|s
decl_stmt|,
modifier|*
name|d
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_header
argument_list|,
operator|&
name|dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_handle
argument_list|,
name|dst
operator|->
name|req_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_completion_status
argument_list|,
name|dst
operator|->
name|req_completion_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_oxid
argument_list|,
name|dst
operator|->
name|req_oxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_resid
argument_list|,
name|dst
operator|->
name|req_resid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_reserved0
argument_list|,
name|dst
operator|->
name|req_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_state_flags
argument_list|,
name|dst
operator|->
name|req_state_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_reserved1
argument_list|,
name|dst
operator|->
name|req_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_scsi_status
argument_list|,
name|dst
operator|->
name|req_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_fcp_residual
argument_list|,
name|dst
operator|->
name|req_fcp_residual
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_sense_len
argument_list|,
name|dst
operator|->
name|req_sense_len
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|req_response_len
argument_list|,
name|dst
operator|->
name|req_response_len
argument_list|)
expr_stmt|;
name|s
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|src
operator|->
name|req_rsp_sense
expr_stmt|;
name|d
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|dst
operator|->
name|req_rsp_sense
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|ASIZE
argument_list|(
name|src
operator|->
name|req_rsp_sense
argument_list|)
operator|>>
literal|2
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|d
index|[
name|i
index|]
operator|=
name|ISP_SWAP32
argument_list|(
name|isp
argument_list|,
name|s
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_24xx_abrt
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp24xx_abrt_t
modifier|*
name|src
parameter_list|,
name|isp24xx_abrt_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_header
argument_list|,
operator|&
name|dst
operator|->
name|abrt_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_handle
argument_list|,
name|dst
operator|->
name|abrt_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_nphdl
argument_list|,
name|dst
operator|->
name|abrt_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_options
argument_list|,
name|dst
operator|->
name|abrt_options
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_cmd_handle
argument_list|,
name|dst
operator|->
name|abrt_cmd_handle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|abrt_reserved
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_reserved
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|abrt_reserved
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_tidlo
argument_list|,
name|dst
operator|->
name|abrt_tidlo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_tidhi
argument_list|,
name|dst
operator|->
name|abrt_tidhi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_vpidx
argument_list|,
name|dst
operator|->
name|abrt_vpidx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|abrt_reserved1
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abrt_reserved1
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|abrt_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_rio2
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_rio2_t
modifier|*
name|r2src
parameter_list|,
name|isp_rio2_t
modifier|*
name|r2dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|r2src
operator|->
name|req_header
argument_list|,
operator|&
name|r2dst
operator|->
name|req_header
argument_list|)
expr_stmt|;
if|if
condition|(
name|r2dst
operator|->
name|req_header
operator|.
name|rqs_seqno
operator|>
literal|30
condition|)
block|{
name|r2dst
operator|->
name|req_header
operator|.
name|rqs_seqno
operator|=
literal|30
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|r2dst
operator|->
name|req_header
operator|.
name|rqs_seqno
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|r2src
operator|->
name|req_handles
index|[
name|i
index|]
argument_list|,
name|r2dst
operator|->
name|req_handles
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|i
operator|<
literal|30
condition|)
block|{
name|r2dst
operator|->
name|req_handles
index|[
name|i
operator|++
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_icb
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_icb_t
modifier|*
name|src
parameter_list|,
name|isp_icb_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_version
argument_list|,
operator|&
name|dst
operator|->
name|icb_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|icb_version
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_version
argument_list|,
operator|&
name|dst
operator|->
name|icb_version
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|icb_reserved0
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_fwoptions
argument_list|,
operator|&
name|dst
operator|->
name|icb_fwoptions
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_maxfrmlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_maxfrmlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_maxalloc
argument_list|,
operator|&
name|dst
operator|->
name|icb_maxalloc
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_execthrottle
argument_list|,
operator|&
name|dst
operator|->
name|icb_execthrottle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_retry_count
argument_list|,
operator|&
name|dst
operator|->
name|icb_retry_delay
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_retry_delay
argument_list|,
operator|&
name|dst
operator|->
name|icb_retry_count
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_retry_count
argument_list|,
operator|&
name|dst
operator|->
name|icb_retry_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_retry_delay
argument_list|,
operator|&
name|dst
operator|->
name|icb_retry_delay
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_portname
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_hardaddr
argument_list|,
operator|&
name|dst
operator|->
name|icb_hardaddr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_iqdevtype
argument_list|,
operator|&
name|dst
operator|->
name|icb_logintime
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_logintime
argument_list|,
operator|&
name|dst
operator|->
name|icb_iqdevtype
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_iqdevtype
argument_list|,
operator|&
name|dst
operator|->
name|icb_iqdevtype
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_logintime
argument_list|,
operator|&
name|dst
operator|->
name|icb_logintime
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_nodename
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rqstout
argument_list|,
operator|&
name|dst
operator|->
name|icb_rqstout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rspnsin
argument_list|,
operator|&
name|dst
operator|->
name|icb_rspnsin
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rqstqlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_rqstqlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rsltqlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_rsltqlen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rqstaddr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_rqstaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_respaddr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_respaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_lunenables
argument_list|,
operator|&
name|dst
operator|->
name|icb_lunenables
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_ccnt
argument_list|,
operator|&
name|dst
operator|->
name|icb_icnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_icnt
argument_list|,
operator|&
name|dst
operator|->
name|icb_ccnt
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_ccnt
argument_list|,
operator|&
name|dst
operator|->
name|icb_ccnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_icnt
argument_list|,
operator|&
name|dst
operator|->
name|icb_icnt
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_lunetimeout
argument_list|,
operator|&
name|dst
operator|->
name|icb_lunetimeout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|icb_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_xfwoptions
argument_list|,
operator|&
name|dst
operator|->
name|icb_xfwoptions
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_racctimer
argument_list|,
operator|&
name|dst
operator|->
name|icb_idelaytimer
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_idelaytimer
argument_list|,
operator|&
name|dst
operator|->
name|icb_racctimer
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_racctimer
argument_list|,
operator|&
name|dst
operator|->
name|icb_racctimer
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_idelaytimer
argument_list|,
operator|&
name|dst
operator|->
name|icb_idelaytimer
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_zfwoptions
argument_list|,
operator|&
name|dst
operator|->
name|icb_zfwoptions
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_icb_2400
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_icb_2400_t
modifier|*
name|src
parameter_list|,
name|isp_icb_2400_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_version
argument_list|,
operator|&
name|dst
operator|->
name|icb_version
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|icb_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_maxfrmlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_maxfrmlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_execthrottle
argument_list|,
operator|&
name|dst
operator|->
name|icb_execthrottle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_xchgcnt
argument_list|,
operator|&
name|dst
operator|->
name|icb_xchgcnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_hardaddr
argument_list|,
operator|&
name|dst
operator|->
name|icb_hardaddr
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_portname
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_nodename
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rspnsin
argument_list|,
operator|&
name|dst
operator|->
name|icb_rspnsin
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rqstout
argument_list|,
operator|&
name|dst
operator|->
name|icb_rqstout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_retry_count
argument_list|,
operator|&
name|dst
operator|->
name|icb_retry_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_priout
argument_list|,
operator|&
name|dst
operator|->
name|icb_priout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rsltqlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_rsltqlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rqstqlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_rqstqlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_ldn_nols
argument_list|,
operator|&
name|dst
operator|->
name|icb_ldn_nols
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_prqstqlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_prqstqlen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_rqstaddr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_rqstaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_respaddr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_respaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_priaddr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_priaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_reserved1
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_atio_in
argument_list|,
operator|&
name|dst
operator|->
name|icb_atio_in
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_atioqlen
argument_list|,
operator|&
name|dst
operator|->
name|icb_atioqlen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_atioqaddr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_atioqaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_idelaytimer
argument_list|,
operator|&
name|dst
operator|->
name|icb_idelaytimer
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_logintime
argument_list|,
operator|&
name|dst
operator|->
name|icb_logintime
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_fwoptions1
argument_list|,
operator|&
name|dst
operator|->
name|icb_fwoptions1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_fwoptions2
argument_list|,
operator|&
name|dst
operator|->
name|icb_fwoptions2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_fwoptions3
argument_list|,
operator|&
name|dst
operator|->
name|icb_fwoptions3
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|12
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|icb_reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|icb_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_icb_2400_vpinfo
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_icb_2400_vpinfo_t
modifier|*
name|src
parameter_list|,
name|isp_icb_2400_vpinfo_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_count
argument_list|,
operator|&
name|dst
operator|->
name|vp_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_global_options
argument_list|,
operator|&
name|dst
operator|->
name|vp_global_options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_vp_port_info
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|vp_port_info_t
modifier|*
name|src
parameter_list|,
name|vp_port_info_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_port_status
argument_list|,
operator|&
name|dst
operator|->
name|vp_port_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_port_options
argument_list|,
operator|&
name|dst
operator|->
name|vp_port_options
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_port_loopid
argument_list|,
operator|&
name|dst
operator|->
name|vp_port_loopid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_port_portname
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_port_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_port_nodename
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_port_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
comment|/* we never *put* portid_lo/portid_hi */
block|}
end_function

begin_function
name|void
name|isp_get_vp_port_info
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|vp_port_info_t
modifier|*
name|src
parameter_list|,
name|vp_port_info_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_status
argument_list|,
name|dst
operator|->
name|vp_port_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_options
argument_list|,
name|dst
operator|->
name|vp_port_options
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_loopid
argument_list|,
name|dst
operator|->
name|vp_port_loopid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_port_portname
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_portname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|vp_port_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_port_nodename
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_nodename
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|vp_port_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_portid_lo
argument_list|,
name|dst
operator|->
name|vp_port_portid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_port_portid_hi
argument_list|,
name|dst
operator|->
name|vp_port_portid_hi
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_vp_ctrl_info
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|vp_ctrl_info_t
modifier|*
name|src
parameter_list|,
name|vp_ctrl_info_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_hdr
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_handle
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_index_fail
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_index_fail
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_status
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_command
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_command
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_vp_count
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_vp_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_ctrl_idmap
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_idmap
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_idmap
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_ctrl_reserved
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_ctrl_idmap
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_idmap
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_vp_ctrl_info
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|vp_ctrl_info_t
modifier|*
name|src
parameter_list|,
name|vp_ctrl_info_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_hdr
argument_list|,
operator|&
name|dst
operator|->
name|vp_ctrl_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_handle
argument_list|,
name|dst
operator|->
name|vp_ctrl_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_index_fail
argument_list|,
name|dst
operator|->
name|vp_ctrl_index_fail
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_status
argument_list|,
name|dst
operator|->
name|vp_ctrl_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_command
argument_list|,
name|dst
operator|->
name|vp_ctrl_command
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_vp_count
argument_list|,
name|dst
operator|->
name|vp_ctrl_vp_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_ctrl_idmap
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_idmap
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|vp_ctrl_idmap
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_ctrl_reserved
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_ctrl_reserved
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|vp_ctrl_reserved
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_vp_modify
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|vp_modify_t
modifier|*
name|src
parameter_list|,
name|vp_modify_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_hdr
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_hdl
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_hdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_status
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_cmd
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_cmd
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_cnt
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_idx0
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_idx0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_idx1
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_idx1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_ports
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|options
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|options
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|loopid
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|loopid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|reserved1
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|reserved1
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwpn
argument_list|)
condition|;
name|j
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwpn
index|[
name|j
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwpn
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwnn
argument_list|)
condition|;
name|j
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwnn
index|[
name|j
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwnn
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_reserved2
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|vp_mod_reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_vp_modify
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|vp_modify_t
modifier|*
name|src
parameter_list|,
name|vp_modify_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_hdr
argument_list|,
operator|&
name|dst
operator|->
name|vp_mod_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_hdl
argument_list|,
name|dst
operator|->
name|vp_mod_hdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_reserved0
argument_list|,
name|dst
operator|->
name|vp_mod_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_status
argument_list|,
name|dst
operator|->
name|vp_mod_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_cmd
argument_list|,
name|dst
operator|->
name|vp_mod_cmd
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_cnt
argument_list|,
name|dst
operator|->
name|vp_mod_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_idx0
argument_list|,
name|dst
operator|->
name|vp_mod_idx0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_idx1
argument_list|,
name|dst
operator|->
name|vp_mod_idx1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_ports
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|options
argument_list|,
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|options
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|loopid
argument_list|,
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|loopid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|reserved1
argument_list|,
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|reserved1
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwpn
argument_list|)
condition|;
name|j
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwpn
index|[
name|j
index|]
argument_list|,
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwpn
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwnn
argument_list|)
condition|;
name|j
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwnn
index|[
name|j
index|]
argument_list|,
name|dst
operator|->
name|vp_mod_ports
index|[
name|i
index|]
operator|.
name|wwnn
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|vp_mod_reserved2
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|vp_mod_reserved2
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|vp_mod_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_pdb_21xx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_pdb_21xx_t
modifier|*
name|src
parameter_list|,
name|isp_pdb_21xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_options
argument_list|,
name|dst
operator|->
name|pdb_options
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_mstate
argument_list|,
name|dst
operator|->
name|pdb_mstate
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_sstate
argument_list|,
name|dst
operator|->
name|pdb_sstate
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_hardaddr_bits
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_hardaddr_bits
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_portid_bits
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_portid_bits
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_nodename
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_portname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_execthrottle
argument_list|,
name|dst
operator|->
name|pdb_execthrottle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_exec_count
argument_list|,
name|dst
operator|->
name|pdb_exec_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_retry_count
argument_list|,
name|dst
operator|->
name|pdb_retry_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_retry_delay
argument_list|,
name|dst
operator|->
name|pdb_retry_delay
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_resalloc
argument_list|,
name|dst
operator|->
name|pdb_resalloc
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_curalloc
argument_list|,
name|dst
operator|->
name|pdb_curalloc
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_qhead
argument_list|,
name|dst
operator|->
name|pdb_qhead
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_qtail
argument_list|,
name|dst
operator|->
name|pdb_qtail
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_tl_next
argument_list|,
name|dst
operator|->
name|pdb_tl_next
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_tl_last
argument_list|,
name|dst
operator|->
name|pdb_tl_last
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_features
argument_list|,
name|dst
operator|->
name|pdb_features
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_pconcurrnt
argument_list|,
name|dst
operator|->
name|pdb_pconcurrnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_roi
argument_list|,
name|dst
operator|->
name|pdb_roi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_target
argument_list|,
name|dst
operator|->
name|pdb_target
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_initiator
argument_list|,
name|dst
operator|->
name|pdb_initiator
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_rdsiz
argument_list|,
name|dst
operator|->
name|pdb_rdsiz
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_ncseq
argument_list|,
name|dst
operator|->
name|pdb_ncseq
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_noseq
argument_list|,
name|dst
operator|->
name|pdb_noseq
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_labrtflg
argument_list|,
name|dst
operator|->
name|pdb_labrtflg
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_lstopflg
argument_list|,
name|dst
operator|->
name|pdb_lstopflg
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_sqhead
argument_list|,
name|dst
operator|->
name|pdb_sqhead
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_sqtail
argument_list|,
name|dst
operator|->
name|pdb_sqtail
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_ptimer
argument_list|,
name|dst
operator|->
name|pdb_ptimer
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_nxt_seqid
argument_list|,
name|dst
operator|->
name|pdb_nxt_seqid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_fcount
argument_list|,
name|dst
operator|->
name|pdb_fcount
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_prli_len
argument_list|,
name|dst
operator|->
name|pdb_prli_len
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_prli_svc0
argument_list|,
name|dst
operator|->
name|pdb_prli_svc0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_prli_svc3
argument_list|,
name|dst
operator|->
name|pdb_prli_svc3
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_loopid
argument_list|,
name|dst
operator|->
name|pdb_loopid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_il_ptr
argument_list|,
name|dst
operator|->
name|pdb_il_ptr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_sl_ptr
argument_list|,
name|dst
operator|->
name|pdb_sl_ptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_pdb_24xx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_pdb_24xx_t
modifier|*
name|src
parameter_list|,
name|isp_pdb_24xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_flags
argument_list|,
name|dst
operator|->
name|pdb_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_curstate
argument_list|,
name|dst
operator|->
name|pdb_curstate
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_laststate
argument_list|,
name|dst
operator|->
name|pdb_laststate
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_hardaddr_bits
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_hardaddr_bits
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_portid_bits
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_portid_bits
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_retry_timer
argument_list|,
name|dst
operator|->
name|pdb_retry_timer
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_handle
argument_list|,
name|dst
operator|->
name|pdb_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_rcv_dsize
argument_list|,
name|dst
operator|->
name|pdb_rcv_dsize
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_reserved0
argument_list|,
name|dst
operator|->
name|pdb_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_prli_svc0
argument_list|,
name|dst
operator|->
name|pdb_prli_svc0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_prli_svc3
argument_list|,
name|dst
operator|->
name|pdb_prli_svc3
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_nodename
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_portname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|24
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|pdb_reserved1
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|pdb_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * PLOGI/LOGO IOCB canonicalization  */
end_comment

begin_function
name|void
name|isp_get_plogx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_plogx_t
modifier|*
name|src
parameter_list|,
name|isp_plogx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_header
argument_list|,
operator|&
name|dst
operator|->
name|plogx_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_handle
argument_list|,
name|dst
operator|->
name|plogx_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_status
argument_list|,
name|dst
operator|->
name|plogx_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_nphdl
argument_list|,
name|dst
operator|->
name|plogx_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_flags
argument_list|,
name|dst
operator|->
name|plogx_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_vphdl
argument_list|,
name|dst
operator|->
name|plogx_vphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_portlo
argument_list|,
name|dst
operator|->
name|plogx_portlo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_rspsz_porthi
argument_list|,
name|dst
operator|->
name|plogx_rspsz_porthi
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|11
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|lo16
argument_list|,
name|dst
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|lo16
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|hi16
argument_list|,
name|dst
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|hi16
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_plogx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_plogx_t
modifier|*
name|src
parameter_list|,
name|isp_plogx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|plogx_header
argument_list|,
operator|&
name|dst
operator|->
name|plogx_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_handle
argument_list|,
operator|&
name|dst
operator|->
name|plogx_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_status
argument_list|,
operator|&
name|dst
operator|->
name|plogx_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|plogx_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_flags
argument_list|,
operator|&
name|dst
operator|->
name|plogx_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_vphdl
argument_list|,
operator|&
name|dst
operator|->
name|plogx_vphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_portlo
argument_list|,
operator|&
name|dst
operator|->
name|plogx_portlo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_rspsz_porthi
argument_list|,
operator|&
name|dst
operator|->
name|plogx_rspsz_porthi
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|11
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|lo16
argument_list|,
operator|&
name|dst
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|lo16
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|hi16
argument_list|,
operator|&
name|dst
operator|->
name|plogx_ioparm
index|[
name|i
index|]
operator|.
name|hi16
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Report ID canonicalization  */
end_comment

begin_function
name|void
name|isp_get_ridacq
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_ridacq_t
modifier|*
name|src
parameter_list|,
name|isp_ridacq_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_hdr
argument_list|,
operator|&
name|dst
operator|->
name|ridacq_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_handle
argument_list|,
name|dst
operator|->
name|ridacq_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_vp_port_lo
argument_list|,
name|dst
operator|->
name|ridacq_vp_port_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_vp_port_hi
argument_list|,
name|dst
operator|->
name|ridacq_vp_port_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_format
argument_list|,
name|dst
operator|->
name|ridacq_format
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|src
operator|->
name|ridacq_map
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|src
operator|->
name|ridacq_map
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_map
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|ridacq_map
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|src
operator|->
name|ridacq_reserved1
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|src
operator|->
name|ridacq_reserved1
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ridacq_reserved1
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|ridacq_reserved1
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dst
operator|->
name|ridacq_format
operator|==
literal|0
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|un
operator|.
name|type0
operator|.
name|ridacq_vp_acquired
argument_list|,
name|dst
operator|->
name|un
operator|.
name|type0
operator|.
name|ridacq_vp_acquired
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|un
operator|.
name|type0
operator|.
name|ridacq_vp_setup
argument_list|,
name|dst
operator|->
name|un
operator|.
name|type0
operator|.
name|ridacq_vp_setup
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|un
operator|.
name|type0
operator|.
name|ridacq_reserved0
argument_list|,
name|dst
operator|->
name|un
operator|.
name|type0
operator|.
name|ridacq_reserved0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|dst
operator|->
name|ridacq_format
operator|==
literal|1
condition|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|un
operator|.
name|type1
operator|.
name|ridacq_vp_count
argument_list|,
name|dst
operator|->
name|un
operator|.
name|type1
operator|.
name|ridacq_vp_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|un
operator|.
name|type1
operator|.
name|ridacq_vp_index
argument_list|,
name|dst
operator|->
name|un
operator|.
name|type1
operator|.
name|ridacq_vp_index
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|un
operator|.
name|type1
operator|.
name|ridacq_vp_status
argument_list|,
name|dst
operator|->
name|un
operator|.
name|type1
operator|.
name|ridacq_vp_status
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_MEMZERO
argument_list|(
operator|&
name|dst
operator|->
name|un
argument_list|,
sizeof|sizeof
argument_list|(
name|dst
operator|->
name|un
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * CT Passthru canonicalization  */
end_comment

begin_function
name|void
name|isp_get_ct_pt
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_ct_pt_t
modifier|*
name|src
parameter_list|,
name|isp_ct_pt_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_header
argument_list|,
operator|&
name|dst
operator|->
name|ctp_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_handle
argument_list|,
name|dst
operator|->
name|ctp_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_status
argument_list|,
name|dst
operator|->
name|ctp_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_nphdl
argument_list|,
name|dst
operator|->
name|ctp_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_cmd_cnt
argument_list|,
name|dst
operator|->
name|ctp_cmd_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_vpidx
argument_list|,
name|dst
operator|->
name|ctp_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_reserved0
argument_list|,
name|dst
operator|->
name|ctp_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_time
argument_list|,
name|dst
operator|->
name|ctp_time
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_reserved1
argument_list|,
name|dst
operator|->
name|ctp_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_rsp_cnt
argument_list|,
name|dst
operator|->
name|ctp_rsp_cnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_reserved2
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|ctp_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_rsp_bcnt
argument_list|,
name|dst
operator|->
name|ctp_rsp_bcnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_cmd_bcnt
argument_list|,
name|dst
operator|->
name|ctp_cmd_bcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
name|dst
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ms
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_ms_t
modifier|*
name|src
parameter_list|,
name|isp_ms_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_header
argument_list|,
operator|&
name|dst
operator|->
name|ms_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_handle
argument_list|,
name|dst
operator|->
name|ms_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_nphdl
argument_list|,
name|dst
operator|->
name|ms_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_status
argument_list|,
name|dst
operator|->
name|ms_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_flags
argument_list|,
name|dst
operator|->
name|ms_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_reserved1
argument_list|,
name|dst
operator|->
name|ms_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_time
argument_list|,
name|dst
operator|->
name|ms_time
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_cmd_cnt
argument_list|,
name|dst
operator|->
name|ms_cmd_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_tot_cnt
argument_list|,
name|dst
operator|->
name|ms_tot_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_type
argument_list|,
name|dst
operator|->
name|ms_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_r_ctl
argument_list|,
name|dst
operator|->
name|ms_r_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_rxid
argument_list|,
name|dst
operator|->
name|ms_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_reserved2
argument_list|,
name|dst
operator|->
name|ms_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_rsp_bcnt
argument_list|,
name|dst
operator|->
name|ms_rsp_bcnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_cmd_bcnt
argument_list|,
name|dst
operator|->
name|ms_cmd_bcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
name|dst
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_ct_pt
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_ct_pt_t
modifier|*
name|src
parameter_list|,
name|isp_ct_pt_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ctp_header
argument_list|,
operator|&
name|dst
operator|->
name|ctp_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_handle
argument_list|,
operator|&
name|dst
operator|->
name|ctp_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_status
argument_list|,
operator|&
name|dst
operator|->
name|ctp_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|ctp_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_cmd_cnt
argument_list|,
operator|&
name|dst
operator|->
name|ctp_cmd_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|ctp_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|ctp_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_time
argument_list|,
operator|&
name|dst
operator|->
name|ctp_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|ctp_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_rsp_cnt
argument_list|,
operator|&
name|dst
operator|->
name|ctp_rsp_cnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|ctp_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_rsp_bcnt
argument_list|,
operator|&
name|dst
operator|->
name|ctp_rsp_bcnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_cmd_bcnt
argument_list|,
operator|&
name|dst
operator|->
name|ctp_cmd_bcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|ctp_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_ms
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_ms_t
modifier|*
name|src
parameter_list|,
name|isp_ms_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ms_header
argument_list|,
operator|&
name|dst
operator|->
name|ms_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_handle
argument_list|,
operator|&
name|dst
operator|->
name|ms_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|ms_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_status
argument_list|,
operator|&
name|dst
operator|->
name|ms_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_flags
argument_list|,
operator|&
name|dst
operator|->
name|ms_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|ms_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_time
argument_list|,
operator|&
name|dst
operator|->
name|ms_time
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_cmd_cnt
argument_list|,
operator|&
name|dst
operator|->
name|ms_cmd_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_tot_cnt
argument_list|,
operator|&
name|dst
operator|->
name|ms_tot_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_type
argument_list|,
operator|&
name|dst
operator|->
name|ms_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_r_ctl
argument_list|,
operator|&
name|dst
operator|->
name|ms_r_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_rxid
argument_list|,
operator|&
name|dst
operator|->
name|ms_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|ms_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_rsp_bcnt
argument_list|,
operator|&
name|dst
operator|->
name|ms_rsp_bcnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_cmd_bcnt
argument_list|,
operator|&
name|dst
operator|->
name|ms_cmd_bcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|ms_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Generic SNS request - not particularly useful since the per-command data  * isn't always 16 bit words.  */
end_comment

begin_function
name|void
name|isp_put_sns_request
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_screq_t
modifier|*
name|src
parameter_list|,
name|sns_screq_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|nw
init|=
operator|(
name|int
operator|)
name|src
operator|->
name|snscb_sblen
decl_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_rblen
argument_list|,
operator|&
name|dst
operator|->
name|snscb_rblen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_sblen
argument_list|,
operator|&
name|dst
operator|->
name|snscb_sblen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nw
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_data
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_gid_ft_request
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_gid_ft_req_t
modifier|*
name|src
parameter_list|,
name|sns_gid_ft_req_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_rblen
argument_list|,
operator|&
name|dst
operator|->
name|snscb_rblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|0
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|1
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|2
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|3
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_sblen
argument_list|,
operator|&
name|dst
operator|->
name|snscb_sblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_cmd
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cmd
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_mword_div_2
argument_list|,
operator|&
name|dst
operator|->
name|snscb_mword_div_2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved3
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_fc4_type
argument_list|,
operator|&
name|dst
operator|->
name|snscb_fc4_type
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_gxn_id_request
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_gxn_id_req_t
modifier|*
name|src
parameter_list|,
name|sns_gxn_id_req_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_rblen
argument_list|,
operator|&
name|dst
operator|->
name|snscb_rblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|0
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|1
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|2
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_addr
index|[
literal|3
index|]
argument_list|,
operator|&
name|dst
operator|->
name|snscb_addr
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_sblen
argument_list|,
operator|&
name|dst
operator|->
name|snscb_sblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_cmd
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cmd
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_reserved3
argument_list|,
operator|&
name|dst
operator|->
name|snscb_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|snscb_portid
argument_list|,
operator|&
name|dst
operator|->
name|snscb_portid
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Generic SNS response - not particularly useful since the per-command data  * isn't always 16 bit words.  */
end_comment

begin_function
name|void
name|isp_get_sns_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_scrsp_t
modifier|*
name|src
parameter_list|,
name|sns_scrsp_t
modifier|*
name|dst
parameter_list|,
name|int
name|nwords
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_ct_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_cthdr
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cthdr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_port_type
argument_list|,
name|dst
operator|->
name|snscb_port_type
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_port_id
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_port_id
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_portname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nwords
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_data
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_gid_ft_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_gid_ft_rsp_t
modifier|*
name|src
parameter_list|,
name|sns_gid_ft_rsp_t
modifier|*
name|dst
parameter_list|,
name|int
name|nwords
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_ct_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_cthdr
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cthdr
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nwords
condition|;
name|i
operator|++
control|)
block|{
name|int
name|j
decl_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_ports
index|[
name|i
index|]
operator|.
name|control
argument_list|,
name|dst
operator|->
name|snscb_ports
index|[
name|i
index|]
operator|.
name|control
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_ports
index|[
name|i
index|]
operator|.
name|portid
index|[
name|j
index|]
argument_list|,
name|dst
operator|->
name|snscb_ports
index|[
name|i
index|]
operator|.
name|portid
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dst
operator|->
name|snscb_ports
index|[
name|i
index|]
operator|.
name|control
operator|&
literal|0x80
condition|)
block|{
break|break;
block|}
block|}
block|}
end_function

begin_function
name|void
name|isp_get_gxn_id_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_gxn_id_rsp_t
modifier|*
name|src
parameter_list|,
name|sns_gxn_id_rsp_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_ct_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_cthdr
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cthdr
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_wwn
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_wwn
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_gff_id_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_gff_id_rsp_t
modifier|*
name|src
parameter_list|,
name|sns_gff_id_rsp_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_ct_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_cthdr
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cthdr
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_fc4_features
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_fc4_features
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ga_nxt_response
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|sns_ga_nxt_rsp_t
modifier|*
name|src
parameter_list|,
name|sns_ga_nxt_rsp_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_ct_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_cthdr
argument_list|,
operator|&
name|dst
operator|->
name|snscb_cthdr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_port_type
argument_list|,
name|dst
operator|->
name|snscb_port_type
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_port_id
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_port_id
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_portname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_portname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_pnlen
argument_list|,
name|dst
operator|->
name|snscb_pnlen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|255
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_pname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_pname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_nodename
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_nodename
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_nnlen
argument_list|,
name|dst
operator|->
name|snscb_nnlen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|255
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_nname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_nname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_ipassoc
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_ipassoc
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_ipaddr
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_ipaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_svc_class
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_svc_class
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_fc4_types
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_fc4_types
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_fpname
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_fpname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_reserved
argument_list|,
name|dst
operator|->
name|snscb_reserved
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|snscb_hardaddr
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|snscb_hardaddr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_els
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|els_t
modifier|*
name|src
parameter_list|,
name|els_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_hdr
argument_list|,
operator|&
name|dst
operator|->
name|els_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_handle
argument_list|,
name|dst
operator|->
name|els_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_status
argument_list|,
name|dst
operator|->
name|els_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_nphdl
argument_list|,
name|dst
operator|->
name|els_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_xmit_dsd_count
argument_list|,
name|dst
operator|->
name|els_xmit_dsd_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_vphdl
argument_list|,
name|dst
operator|->
name|els_vphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_sof
argument_list|,
name|dst
operator|->
name|els_sof
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_rxid
argument_list|,
name|dst
operator|->
name|els_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_recv_dsd_count
argument_list|,
name|dst
operator|->
name|els_recv_dsd_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_opcode
argument_list|,
name|dst
operator|->
name|els_opcode
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_reserved2
argument_list|,
name|dst
operator|->
name|els_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_did_lo
argument_list|,
name|dst
operator|->
name|els_did_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_did_mid
argument_list|,
name|dst
operator|->
name|els_did_mid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_did_hi
argument_list|,
name|dst
operator|->
name|els_did_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_reserved2
argument_list|,
name|dst
operator|->
name|els_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_reserved3
argument_list|,
name|dst
operator|->
name|els_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_ctl_flags
argument_list|,
name|dst
operator|->
name|els_ctl_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_bytecnt
argument_list|,
name|dst
operator|->
name|els_bytecnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_subcode1
argument_list|,
name|dst
operator|->
name|els_subcode1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_subcode2
argument_list|,
name|dst
operator|->
name|els_subcode2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_reserved4
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|els_reserved4
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_els
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|els_t
modifier|*
name|src
parameter_list|,
name|els_t
modifier|*
name|dst
parameter_list|)
block|{
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|els_hdr
argument_list|,
operator|&
name|dst
operator|->
name|els_hdr
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_handle
argument_list|,
operator|&
name|dst
operator|->
name|els_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_status
argument_list|,
operator|&
name|dst
operator|->
name|els_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|els_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_dsd_count
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_dsd_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_vphdl
argument_list|,
operator|&
name|dst
operator|->
name|els_vphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_sof
argument_list|,
operator|&
name|dst
operator|->
name|els_sof
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_rxid
argument_list|,
operator|&
name|dst
operator|->
name|els_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_dsd_count
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_dsd_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_opcode
argument_list|,
operator|&
name|dst
operator|->
name|els_opcode
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|els_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_did_lo
argument_list|,
operator|&
name|dst
operator|->
name|els_did_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_did_mid
argument_list|,
operator|&
name|dst
operator|->
name|els_did_mid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_did_hi
argument_list|,
operator|&
name|dst
operator|->
name|els_did_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|els_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_reserved3
argument_list|,
operator|&
name|dst
operator|->
name|els_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_ctl_flags
argument_list|,
operator|&
name|dst
operator|->
name|els_ctl_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_bytecnt
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_bytecnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_bytecnt
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_bytecnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_dsd_length
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_dsd_length
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_dsd_a1500
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_dsd_a1500
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_dsd_a3116
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_dsd_a3116
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_dsd_a4732
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_dsd_a4732
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_xmit_dsd_a6348
argument_list|,
operator|&
name|dst
operator|->
name|els_xmit_dsd_a6348
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_dsd_length
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_dsd_length
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_dsd_a1500
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_dsd_a1500
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_dsd_a3116
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_dsd_a3116
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_dsd_a4732
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_dsd_a4732
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|els_recv_dsd_a6348
argument_list|,
operator|&
name|dst
operator|->
name|els_recv_dsd_a6348
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * FC Structure Canonicalization  */
end_comment

begin_function
name|void
name|isp_get_fc_hdr
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|fc_hdr_t
modifier|*
name|src
parameter_list|,
name|fc_hdr_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|r_ctl
argument_list|,
name|dst
operator|->
name|r_ctl
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|d_id
index|[
literal|0
index|]
argument_list|,
name|dst
operator|->
name|d_id
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|d_id
index|[
literal|1
index|]
argument_list|,
name|dst
operator|->
name|d_id
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|d_id
index|[
literal|2
index|]
argument_list|,
name|dst
operator|->
name|d_id
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|cs_ctl
argument_list|,
name|dst
operator|->
name|cs_ctl
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|s_id
index|[
literal|0
index|]
argument_list|,
name|dst
operator|->
name|s_id
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|s_id
index|[
literal|1
index|]
argument_list|,
name|dst
operator|->
name|s_id
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|s_id
index|[
literal|2
index|]
argument_list|,
name|dst
operator|->
name|s_id
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|type
argument_list|,
name|dst
operator|->
name|type
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|f_ctl
index|[
literal|0
index|]
argument_list|,
name|dst
operator|->
name|f_ctl
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|f_ctl
index|[
literal|1
index|]
argument_list|,
name|dst
operator|->
name|f_ctl
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|f_ctl
index|[
literal|2
index|]
argument_list|,
name|dst
operator|->
name|f_ctl
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|seq_id
argument_list|,
name|dst
operator|->
name|seq_id
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|df_ctl
argument_list|,
name|dst
operator|->
name|df_ctl
argument_list|)
expr_stmt|;
name|ISP_IOZGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|seq_cnt
argument_list|,
name|dst
operator|->
name|seq_cnt
argument_list|)
expr_stmt|;
name|ISP_IOZGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ox_id
argument_list|,
name|dst
operator|->
name|ox_id
argument_list|)
expr_stmt|;
name|ISP_IOZGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rx_id
argument_list|,
name|dst
operator|->
name|rx_id
argument_list|)
expr_stmt|;
name|ISP_IOZGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|parameter
argument_list|,
name|dst
operator|->
name|parameter
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_fcp_cmnd_iu
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|fcp_cmnd_iu_t
modifier|*
name|src
parameter_list|,
name|fcp_cmnd_iu_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|fcp_cmnd_lun
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|fcp_cmnd_lun
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|fcp_cmnd_crn
argument_list|,
name|dst
operator|->
name|fcp_cmnd_crn
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|fcp_cmnd_task_attribute
argument_list|,
name|dst
operator|->
name|fcp_cmnd_task_attribute
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|fcp_cmnd_task_management
argument_list|,
name|dst
operator|->
name|fcp_cmnd_task_management
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|fcp_cmnd_alen_datadir
argument_list|,
name|dst
operator|->
name|fcp_cmnd_alen_datadir
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|cdb_dl
operator|.
name|sf
operator|.
name|fcp_cmnd_cdb
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|cdb_dl
operator|.
name|sf
operator|.
name|fcp_cmnd_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOZGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|cdb_dl
operator|.
name|sf
operator|.
name|fcp_cmnd_dl
argument_list|,
name|dst
operator|->
name|cdb_dl
operator|.
name|sf
operator|.
name|fcp_cmnd_dl
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_rft_id
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|rft_id_t
modifier|*
name|src
parameter_list|,
name|rft_id_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_ct_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rftid_hdr
argument_list|,
operator|&
name|dst
operator|->
name|rftid_hdr
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rftid_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rftid_reserved
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rftid_portid
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|rftid_portid
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOZPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rftid_fc4types
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|rftid_fc4types
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ct_hdr
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct_hdr_t
modifier|*
name|src
parameter_list|,
name|ct_hdr_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_revision
argument_list|,
name|dst
operator|->
name|ct_revision
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_in_id
index|[
literal|0
index|]
argument_list|,
name|dst
operator|->
name|ct_in_id
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_in_id
index|[
literal|1
index|]
argument_list|,
name|dst
operator|->
name|ct_in_id
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_in_id
index|[
literal|2
index|]
argument_list|,
name|dst
operator|->
name|ct_in_id
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_fcs_type
argument_list|,
name|dst
operator|->
name|ct_fcs_type
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_fcs_subtype
argument_list|,
name|dst
operator|->
name|ct_fcs_subtype
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_options
argument_list|,
name|dst
operator|->
name|ct_options
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reserved0
argument_list|,
name|dst
operator|->
name|ct_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOZGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_cmd_resp
argument_list|,
name|dst
operator|->
name|ct_cmd_resp
argument_list|)
expr_stmt|;
name|ISP_IOZGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_bcnt_resid
argument_list|,
name|dst
operator|->
name|ct_bcnt_resid
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reserved1
argument_list|,
name|dst
operator|->
name|ct_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reason
argument_list|,
name|dst
operator|->
name|ct_reason
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_explanation
argument_list|,
name|dst
operator|->
name|ct_explanation
argument_list|)
expr_stmt|;
name|ISP_IOZGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_vunique
argument_list|,
name|dst
operator|->
name|ct_vunique
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_ct_hdr
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct_hdr_t
modifier|*
name|src
parameter_list|,
name|ct_hdr_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_revision
argument_list|,
operator|&
name|dst
operator|->
name|ct_revision
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_in_id
index|[
literal|0
index|]
argument_list|,
operator|&
name|dst
operator|->
name|ct_in_id
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_in_id
index|[
literal|1
index|]
argument_list|,
operator|&
name|dst
operator|->
name|ct_in_id
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_in_id
index|[
literal|2
index|]
argument_list|,
operator|&
name|dst
operator|->
name|ct_in_id
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_fcs_type
argument_list|,
operator|&
name|dst
operator|->
name|ct_fcs_type
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_fcs_subtype
argument_list|,
operator|&
name|dst
operator|->
name|ct_fcs_subtype
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_options
argument_list|,
operator|&
name|dst
operator|->
name|ct_options
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reserved0
argument_list|,
operator|&
name|dst
operator|->
name|ct_reserved0
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_cmd_resp
argument_list|,
operator|&
name|dst
operator|->
name|ct_cmd_resp
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_bcnt_resid
argument_list|,
operator|&
name|dst
operator|->
name|ct_bcnt_resid
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|ct_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reason
argument_list|,
operator|&
name|dst
operator|->
name|ct_reason
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_explanation
argument_list|,
operator|&
name|dst
operator|->
name|ct_explanation
argument_list|)
expr_stmt|;
name|ISP_IOZPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_vunique
argument_list|,
operator|&
name|dst
operator|->
name|ct_vunique
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|ISP_TARGET_MODE
end_ifdef

begin_comment
comment|/*  * Command shipping- finish off first queue entry and do dma mapping and  * additional segments as needed.  *  * Called with the first queue entry at least partially filled out.  */
end_comment

begin_function
name|int
name|isp_send_tgt_cmd
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|void
modifier|*
name|fqe
parameter_list|,
name|void
modifier|*
name|segp
parameter_list|,
name|uint32_t
name|nsegs
parameter_list|,
name|uint32_t
name|totalcnt
parameter_list|,
name|isp_ddir_t
name|ddir
parameter_list|,
name|void
modifier|*
name|snsptr
parameter_list|,
name|uint32_t
name|snslen
parameter_list|)
block|{
name|uint8_t
name|storage
index|[
name|QENTRY_LEN
index|]
decl_stmt|,
name|storage2
index|[
name|QENTRY_LEN
index|]
decl_stmt|;
name|uint8_t
name|type
decl_stmt|,
name|nqe
decl_stmt|;
name|uint32_t
name|seg
decl_stmt|,
name|curseg
decl_stmt|,
name|seglim
decl_stmt|,
name|nxt
decl_stmt|,
name|nxtnxt
decl_stmt|;
name|ispds_t
modifier|*
name|dsp
init|=
name|NULL
decl_stmt|;
name|ispds64_t
modifier|*
name|dsp64
init|=
name|NULL
decl_stmt|;
name|void
modifier|*
name|qe0
decl_stmt|,
modifier|*
name|qe1
decl_stmt|,
modifier|*
name|sqe
init|=
name|NULL
decl_stmt|;
name|qe0
operator|=
name|isp_getrqentry
argument_list|(
name|isp
argument_list|)
expr_stmt|;
if|if
condition|(
name|qe0
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
name|CMD_EAGAIN
operator|)
return|;
block|}
name|nxt
operator|=
name|ISP_NXT_QENTRY
argument_list|(
name|isp
operator|->
name|isp_reqidx
argument_list|,
name|RQUEST_QUEUE_LEN
argument_list|(
name|isp
argument_list|)
argument_list|)
expr_stmt|;
name|type
operator|=
operator|(
operator|(
name|isphdr_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|rqs_entry_type
expr_stmt|;
name|nqe
operator|=
literal|1
expr_stmt|;
name|seglim
operator|=
literal|0
expr_stmt|;
comment|/* 	 * If we have no data to transmit, just copy the first IOCB and start it up. 	 */
if|if
condition|(
name|ddir
operator|!=
name|ISP_NOXFR
condition|)
block|{
comment|/* 		 * First, figure out how many pieces of data to transfer and what kind and how many we can put into the first queue entry. 		 */
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|RQSTYPE_CTIO
case|:
name|dsp
operator|=
operator|(
operator|(
name|ct_entry_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|ct_dataseg
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG
expr_stmt|;
break|break;
case|case
name|RQSTYPE_CTIO2
case|:
case|case
name|RQSTYPE_CTIO3
case|:
block|{
name|ct2_entry_t
modifier|*
name|ct
init|=
name|fqe
decl_stmt|,
modifier|*
name|ct2
init|=
operator|(
name|ct2_entry_t
operator|*
operator|)
name|storage2
decl_stmt|;
name|uint16_t
name|swd
init|=
name|ct
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
operator|&
literal|0xff
decl_stmt|;
if|if
condition|(
operator|(
name|ct
operator|->
name|ct_flags
operator|&
name|CT2_SENDSTATUS
operator|)
operator|&&
operator|(
name|swd
operator|||
name|ct
operator|->
name|ct_resid
operator|)
condition|)
block|{
name|memcpy
argument_list|(
name|ct2
argument_list|,
name|ct
argument_list|,
name|QENTRY_LEN
argument_list|)
expr_stmt|;
comment|/* 				 * Clear fields from first CTIO2 that now need to be cleared 				 */
name|ct
operator|->
name|ct_header
operator|.
name|rqs_seqno
operator|=
literal|0
expr_stmt|;
name|ct
operator|->
name|ct_flags
operator|&=
operator|~
operator|(
name|CT2_SENDSTATUS
operator||
name|CT2_CCINCR
operator||
name|CT2_FASTPOST
operator|)
expr_stmt|;
name|ct
operator|->
name|ct_resid
operator|=
literal|0
expr_stmt|;
name|ct
operator|->
name|ct_syshandle
operator|=
literal|0
expr_stmt|;
name|ct
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
operator|=
literal|0
expr_stmt|;
comment|/* 				 * Reset fields in the second CTIO2 as appropriate. 				 */
name|ct2
operator|->
name|ct_flags
operator|&=
operator|~
operator|(
name|CT2_FLAG_MMASK
operator||
name|CT2_DATAMASK
operator||
name|CT2_FASTPOST
operator|)
expr_stmt|;
name|ct2
operator|->
name|ct_flags
operator||=
name|CT2_NO_DATA
operator||
name|CT2_FLAG_MODE1
expr_stmt|;
name|ct2
operator|->
name|ct_seg_count
operator|=
literal|0
expr_stmt|;
name|ct2
operator|->
name|ct_reloff
operator|=
literal|0
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ct2
operator|->
name|rsp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ct2
operator|->
name|rsp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|swd
operator|==
name|SCSI_CHECK
operator|&&
name|snsptr
operator|&&
name|snslen
condition|)
block|{
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
operator|=
name|min
argument_list|(
name|snslen
argument_list|,
name|MAXRESPLEN
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
argument_list|,
name|snsptr
argument_list|,
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|)
expr_stmt|;
name|swd
operator||=
name|CT2_SNSLEN_VALID
expr_stmt|;
block|}
if|if
condition|(
name|ct2
operator|->
name|ct_resid
operator|>
literal|0
condition|)
block|{
name|swd
operator||=
name|CT2_DATA_UNDER
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ct2
operator|->
name|ct_resid
operator|<
literal|0
condition|)
block|{
name|swd
operator||=
name|CT2_DATA_OVER
expr_stmt|;
block|}
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
operator|=
name|swd
expr_stmt|;
name|sqe
operator|=
name|storage2
expr_stmt|;
block|}
if|if
condition|(
name|type
operator|==
name|RQSTYPE_CTIO2
condition|)
block|{
name|dsp
operator|=
name|ct
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG_T2
expr_stmt|;
block|}
else|else
block|{
name|dsp64
operator|=
name|ct
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
expr_stmt|;
name|seglim
operator|=
name|ISP_RQDSEG_T3
expr_stmt|;
block|}
break|break;
block|}
case|case
name|RQSTYPE_CTIO7
case|:
block|{
name|ct7_entry_t
modifier|*
name|ct
init|=
name|fqe
decl_stmt|,
modifier|*
name|ct2
init|=
operator|(
name|ct7_entry_t
operator|*
operator|)
name|storage2
decl_stmt|;
name|uint16_t
name|swd
init|=
name|ct
operator|->
name|ct_scsi_status
operator|&
literal|0xff
decl_stmt|;
name|dsp64
operator|=
operator|&
name|ct
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
expr_stmt|;
name|seglim
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|ct
operator|->
name|ct_flags
operator|&
name|CT7_SENDSTATUS
operator|)
operator|&&
operator|(
name|swd
operator|||
name|ct
operator|->
name|ct_resid
operator|)
condition|)
block|{
name|memcpy
argument_list|(
name|ct2
argument_list|,
name|ct
argument_list|,
sizeof|sizeof
argument_list|(
name|ct7_entry_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 				 * Clear fields from first CTIO7 that now need to be cleared 				 */
name|ct
operator|->
name|ct_header
operator|.
name|rqs_seqno
operator|=
literal|0
expr_stmt|;
name|ct
operator|->
name|ct_flags
operator|&=
operator|~
name|CT7_SENDSTATUS
expr_stmt|;
name|ct
operator|->
name|ct_resid
operator|=
literal|0
expr_stmt|;
name|ct
operator|->
name|ct_syshandle
operator|=
literal|0
expr_stmt|;
name|ct
operator|->
name|ct_scsi_status
operator|=
literal|0
expr_stmt|;
comment|/* 				 * Reset fields in the second CTIO7 as appropriate. 				 */
name|ct2
operator|->
name|ct_flags
operator|&=
operator|~
operator|(
name|CT7_FLAG_MMASK
operator||
name|CT7_DATAMASK
operator|)
expr_stmt|;
name|ct2
operator|->
name|ct_flags
operator||=
name|CT7_NO_DATA
operator||
name|CT7_NO_DATA
operator||
name|CT7_FLAG_MODE1
expr_stmt|;
name|ct2
operator|->
name|ct_seg_count
operator|=
literal|0
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ct2
operator|->
name|rsp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ct2
operator|->
name|rsp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|swd
operator|==
name|SCSI_CHECK
operator|&&
name|snsptr
operator|&&
name|snslen
condition|)
block|{
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
operator|=
name|min
argument_list|(
name|snslen
argument_list|,
name|MAXRESPLEN_24XX
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
argument_list|,
name|snsptr
argument_list|,
name|ct2
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
name|swd
operator||=
operator|(
name|FCP_SNSLEN_VALID
operator|<<
literal|8
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|ct2
operator|->
name|ct_resid
operator|<
literal|0
condition|)
block|{
name|swd
operator||=
operator|(
name|FCP_RESID_OVERFLOW
operator|<<
literal|8
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ct2
operator|->
name|ct_resid
operator|>
literal|0
condition|)
block|{
name|swd
operator||=
operator|(
name|FCP_RESID_UNDERFLOW
operator|<<
literal|8
operator|)
expr_stmt|;
block|}
name|ct2
operator|->
name|ct_scsi_status
operator|=
name|swd
expr_stmt|;
name|sqe
operator|=
name|storage2
expr_stmt|;
block|}
break|break;
block|}
default|default:
return|return
operator|(
name|CMD_COMPLETE
operator|)
return|;
block|}
block|}
comment|/* 	 * Fill out the data transfer stuff in the first queue entry 	 */
if|if
condition|(
name|seglim
operator|>
name|nsegs
condition|)
block|{
name|seglim
operator|=
name|nsegs
expr_stmt|;
block|}
for|for
control|(
name|seg
operator|=
name|curseg
operator|=
literal|0
init|;
name|curseg
operator|<
name|seglim
condition|;
name|curseg
operator|++
control|)
block|{
if|if
condition|(
name|dsp64
condition|)
block|{
name|XS_GET_DMA64_SEG
argument_list|(
name|dsp64
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XS_GET_DMA_SEG
argument_list|(
name|dsp
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 	 * First, if we are sending status with data and we have a non-zero 	 * status or non-zero residual, we have to make a synthetic extra CTIO 	 * that contains the status that we'll ship separately (FC cards only). 	 */
comment|/* 	 * Second, start building additional continuation segments as needed. 	 */
while|while
condition|(
name|seg
operator|<
name|nsegs
condition|)
block|{
name|nxtnxt
operator|=
name|ISP_NXT_QENTRY
argument_list|(
name|nxt
argument_list|,
name|RQUEST_QUEUE_LEN
argument_list|(
name|isp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|nxtnxt
operator|==
name|isp
operator|->
name|isp_reqodx
condition|)
block|{
return|return
operator|(
name|CMD_EAGAIN
operator|)
return|;
block|}
name|ISP_MEMZERO
argument_list|(
name|storage
argument_list|,
name|QENTRY_LEN
argument_list|)
expr_stmt|;
name|qe1
operator|=
name|ISP_QUEUE_ENTRY
argument_list|(
name|isp
operator|->
name|isp_rquest
argument_list|,
name|nxt
argument_list|)
expr_stmt|;
name|nxt
operator|=
name|nxtnxt
expr_stmt|;
if|if
condition|(
name|dsp64
condition|)
block|{
name|ispcontreq64_t
modifier|*
name|crq
init|=
operator|(
name|ispcontreq64_t
operator|*
operator|)
name|storage
decl_stmt|;
name|seglim
operator|=
name|ISP_CDSEG64
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_A64_CONT
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_count
operator|=
literal|1
expr_stmt|;
name|dsp64
operator|=
name|crq
operator|->
name|req_dataseg
expr_stmt|;
block|}
else|else
block|{
name|ispcontreq_t
modifier|*
name|crq
init|=
operator|(
name|ispcontreq_t
operator|*
operator|)
name|storage
decl_stmt|;
name|seglim
operator|=
name|ISP_CDSEG
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_type
operator|=
name|RQSTYPE_DATASEG
expr_stmt|;
name|crq
operator|->
name|req_header
operator|.
name|rqs_entry_count
operator|=
literal|1
expr_stmt|;
name|dsp
operator|=
name|crq
operator|->
name|req_dataseg
expr_stmt|;
block|}
if|if
condition|(
name|seg
operator|+
name|seglim
operator|>
name|nsegs
condition|)
block|{
name|seglim
operator|=
name|nsegs
operator|-
name|seg
expr_stmt|;
block|}
for|for
control|(
name|curseg
operator|=
literal|0
init|;
name|curseg
operator|<
name|seglim
condition|;
name|curseg
operator|++
control|)
block|{
if|if
condition|(
name|dsp64
condition|)
block|{
name|XS_GET_DMA64_SEG
argument_list|(
name|dsp64
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XS_GET_DMA_SEG
argument_list|(
name|dsp
operator|++
argument_list|,
name|segp
argument_list|,
name|seg
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|dsp64
condition|)
block|{
name|isp_put_cont64_req
argument_list|(
name|isp
argument_list|,
operator|(
name|ispcontreq64_t
operator|*
operator|)
name|storage
argument_list|,
name|qe1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp_put_cont_req
argument_list|(
name|isp
argument_list|,
operator|(
name|ispcontreq_t
operator|*
operator|)
name|storage
argument_list|,
name|qe1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|isp
operator|->
name|isp_dblev
operator|&
name|ISP_LOGTDEBUG1
condition|)
block|{
name|isp_print_bytes
argument_list|(
name|isp
argument_list|,
literal|"additional queue entry"
argument_list|,
name|QENTRY_LEN
argument_list|,
name|storage
argument_list|)
expr_stmt|;
block|}
name|nqe
operator|++
expr_stmt|;
block|}
comment|/* 	 * If we have a synthetic queue entry to complete things, do it here. 	 */
if|if
condition|(
name|sqe
condition|)
block|{
name|nxtnxt
operator|=
name|ISP_NXT_QENTRY
argument_list|(
name|nxt
argument_list|,
name|RQUEST_QUEUE_LEN
argument_list|(
name|isp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|nxtnxt
operator|==
name|isp
operator|->
name|isp_reqodx
condition|)
block|{
return|return
operator|(
name|CMD_EAGAIN
operator|)
return|;
block|}
name|qe1
operator|=
name|ISP_QUEUE_ENTRY
argument_list|(
name|isp
operator|->
name|isp_rquest
argument_list|,
name|nxt
argument_list|)
expr_stmt|;
name|nxt
operator|=
name|nxtnxt
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|RQSTYPE_CTIO7
condition|)
block|{
name|isp_put_ctio7
argument_list|(
name|isp
argument_list|,
name|sqe
argument_list|,
name|qe1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp_put_ctio2
argument_list|(
name|isp
argument_list|,
name|sqe
argument_list|,
name|qe1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|isp
operator|->
name|isp_dblev
operator|&
name|ISP_LOGTDEBUG1
condition|)
block|{
name|isp_print_bytes
argument_list|(
name|isp
argument_list|,
literal|"synthetic final queue entry"
argument_list|,
name|QENTRY_LEN
argument_list|,
name|storage2
argument_list|)
expr_stmt|;
block|}
block|}
operator|(
operator|(
name|isphdr_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|rqs_entry_count
operator|=
name|nqe
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|RQSTYPE_CTIO
case|:
operator|(
operator|(
name|ct_entry_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|ct_seg_count
operator|=
name|nsegs
expr_stmt|;
name|isp_put_ctio
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
break|break;
case|case
name|RQSTYPE_CTIO2
case|:
case|case
name|RQSTYPE_CTIO3
case|:
operator|(
operator|(
name|ct2_entry_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|ct_seg_count
operator|=
name|nsegs
expr_stmt|;
if|if
condition|(
name|ISP_CAP_2KLOGIN
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|isp_put_ctio2e
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp_put_ctio2
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|RQSTYPE_CTIO7
case|:
operator|(
operator|(
name|ct7_entry_t
operator|*
operator|)
name|fqe
operator|)
operator|->
name|ct_seg_count
operator|=
name|nsegs
expr_stmt|;
name|isp_put_ctio7
argument_list|(
name|isp
argument_list|,
name|fqe
argument_list|,
name|qe0
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|CMD_COMPLETE
operator|)
return|;
block|}
if|if
condition|(
name|isp
operator|->
name|isp_dblev
operator|&
name|ISP_LOGTDEBUG1
condition|)
block|{
name|isp_print_bytes
argument_list|(
name|isp
argument_list|,
literal|"first queue entry"
argument_list|,
name|QENTRY_LEN
argument_list|,
name|fqe
argument_list|)
expr_stmt|;
block|}
name|ISP_ADD_REQUEST
argument_list|(
name|isp
argument_list|,
name|nxt
argument_list|)
expr_stmt|;
return|return
operator|(
name|CMD_QUEUED
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isp_save_xs_tgt
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|void
modifier|*
name|xs
parameter_list|,
name|uint32_t
modifier|*
name|handlep
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|int
operator|)
name|isp
operator|->
name|isp_maxcmds
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|isp
operator|->
name|isp_tgtlist
index|[
name|i
index|]
operator|==
name|NULL
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|isp
operator|->
name|isp_tgtlist
index|[
name|i
index|]
operator|=
name|xs
expr_stmt|;
operator|*
name|handlep
operator|=
operator|(
name|i
operator|+
literal|1
operator|)
operator||
literal|0x8000
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|isp_find_xs_tgt
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|uint32_t
name|handle
parameter_list|)
block|{
if|if
condition|(
name|handle
operator|==
literal|0
operator|||
name|IS_TARGET_HANDLE
argument_list|(
name|handle
argument_list|)
operator|==
literal|0
operator|||
operator|(
name|handle
operator|&
name|ISP_HANDLE_MASK
operator|)
operator|>
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGERR
argument_list|,
literal|"bad handle %u in isp_find_xs_tgt"
argument_list|,
name|handle
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
name|isp
operator|->
name|isp_tgtlist
index|[
operator|(
name|handle
operator|&
name|ISP_HANDLE_MASK
operator|)
operator|-
literal|1
index|]
operator|)
return|;
block|}
block|}
end_function

begin_function
name|uint32_t
name|isp_find_tgt_handle
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|void
modifier|*
name|xs
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|xs
operator|!=
name|NULL
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|isp
operator|->
name|isp_maxcmds
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|isp
operator|->
name|isp_tgtlist
index|[
name|i
index|]
operator|==
name|xs
condition|)
block|{
name|uint32_t
name|handle
init|=
name|i
decl_stmt|;
name|handle
operator|+=
literal|1
expr_stmt|;
name|handle
operator|&=
name|ISP_HANDLE_MASK
expr_stmt|;
name|handle
operator||=
literal|0x8000
expr_stmt|;
return|return
operator|(
name|handle
operator|)
return|;
block|}
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|isp_destroy_tgt_handle
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|uint32_t
name|handle
parameter_list|)
block|{
if|if
condition|(
name|handle
operator|==
literal|0
operator|||
name|IS_TARGET_HANDLE
argument_list|(
name|handle
argument_list|)
operator|==
literal|0
operator|||
operator|(
name|handle
operator|&
name|ISP_HANDLE_MASK
operator|)
operator|>
name|isp
operator|->
name|isp_maxcmds
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGERR
argument_list|,
literal|"bad handle in isp_destroy_tgt_handle"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|isp
operator|->
name|isp_tgtlist
index|[
operator|(
name|handle
operator|&
name|ISP_HANDLE_MASK
operator|)
operator|-
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Find target mode entries  */
end_comment

begin_function
name|int
name|isp_find_pdb_by_wwn
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|uint64_t
name|wwn
parameter_list|,
name|fcportdb_t
modifier|*
modifier|*
name|lptr
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|chan
operator|<
name|isp
operator|->
name|isp_nchan
condition|)
block|{
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_FC_TARG
condition|;
name|i
operator|++
control|)
block|{
name|fcportdb_t
modifier|*
name|lp
init|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|lp
operator|->
name|target_mode
operator|==
literal|0
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|lp
operator|->
name|port_wwn
operator|==
name|wwn
condition|)
block|{
operator|*
name|lptr
operator|=
name|lp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isp_find_pdb_by_loopid
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|uint32_t
name|loopid
parameter_list|,
name|fcportdb_t
modifier|*
modifier|*
name|lptr
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|chan
operator|<
name|isp
operator|->
name|isp_nchan
condition|)
block|{
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_FC_TARG
condition|;
name|i
operator|++
control|)
block|{
name|fcportdb_t
modifier|*
name|lp
init|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|lp
operator|->
name|target_mode
operator|==
literal|0
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|lp
operator|->
name|handle
operator|==
name|loopid
condition|)
block|{
operator|*
name|lptr
operator|=
name|lp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isp_find_pdb_by_sid
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|uint32_t
name|sid
parameter_list|,
name|fcportdb_t
modifier|*
modifier|*
name|lptr
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|chan
operator|>=
name|isp
operator|->
name|isp_nchan
condition|)
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_FC_TARG
condition|;
name|i
operator|++
control|)
block|{
name|fcportdb_t
modifier|*
name|lp
init|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|lp
operator|->
name|target_mode
operator|==
literal|0
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|lp
operator|->
name|portid
operator|==
name|sid
condition|)
block|{
operator|*
name|lptr
operator|=
name|lp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|isp_find_chan_by_did
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|uint32_t
name|did
parameter_list|,
name|uint16_t
modifier|*
name|cp
parameter_list|)
block|{
name|uint16_t
name|chan
decl_stmt|;
operator|*
name|cp
operator|=
name|ISP_NOCHAN
expr_stmt|;
for|for
control|(
name|chan
operator|=
literal|0
init|;
name|chan
operator|<
name|isp
operator|->
name|isp_nchan
condition|;
name|chan
operator|++
control|)
block|{
name|fcparam
modifier|*
name|fcp
init|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
decl_stmt|;
if|if
condition|(
operator|(
name|fcp
operator|->
name|role
operator|&
name|ISP_ROLE_TARGET
operator|)
operator|==
literal|0
operator|||
name|fcp
operator|->
name|isp_fwstate
operator|!=
name|FW_READY
operator|||
name|fcp
operator|->
name|isp_loopstate
operator|<
name|LOOP_PDB_RCVD
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|fcp
operator|->
name|isp_portid
operator|==
name|did
condition|)
block|{
operator|*
name|cp
operator|=
name|chan
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Add an initiator device to the port database  */
end_comment

begin_function
name|void
name|isp_add_wwn_entry
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|uint64_t
name|ini
parameter_list|,
name|uint16_t
name|nphdl
parameter_list|,
name|uint32_t
name|s_id
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|fcportdb_t
modifier|*
name|lp
decl_stmt|;
name|isp_notify_t
name|nt
decl_stmt|;
name|int
name|i
decl_stmt|;
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
if|if
condition|(
name|nphdl
operator|>=
name|MAX_NPORT_HANDLE
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d IID 0x%016llx bad N-Port handle 0x%04x Port ID 0x%06x"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|,
name|nphdl
argument_list|,
name|s_id
argument_list|)
expr_stmt|;
return|return;
block|}
name|lp
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
condition|)
block|{
name|lp
operator|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|-
literal|1
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* 		 * Make sure the addition of a new target mode entry doesn't duplicate entries 		 * with the same N-Port handles, the same portids or the same Port WWN. 		 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_FC_TARG
condition|;
name|i
operator|++
control|)
block|{
name|lp
operator|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|lp
operator|->
name|target_mode
operator|==
literal|0
condition|)
block|{
name|lp
operator|=
name|NULL
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|lp
operator|->
name|handle
operator|==
name|nphdl
condition|)
block|{
break|break;
block|}
if|if
condition|(
name|s_id
operator|!=
name|PORT_ANY
operator|&&
name|lp
operator|->
name|portid
operator|==
name|s_id
condition|)
block|{
break|break;
block|}
if|if
condition|(
name|VALID_INI
argument_list|(
name|ini
argument_list|)
operator|&&
name|lp
operator|->
name|port_wwn
operator|==
name|ini
condition|)
block|{
break|break;
block|}
name|lp
operator|=
name|NULL
expr_stmt|;
block|}
block|}
if|if
condition|(
name|lp
condition|)
block|{
name|int
name|something
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|lp
operator|->
name|handle
operator|!=
name|nphdl
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d attempt to re-enter N-port handle 0x%04x IID 0x%016llx Port ID 0x%06x finds IID 0x%016llx N-Port Handle 0x%04x Port ID 0x%06x"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
name|nphdl
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|,
name|s_id
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|lp
operator|->
name|port_wwn
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|lp
operator|->
name|portid
argument_list|)
expr_stmt|;
name|isp_dump_portdb
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|s_id
operator|!=
name|PORT_NONE
condition|)
block|{
if|if
condition|(
name|lp
operator|->
name|portid
operator|==
name|PORT_NONE
condition|)
block|{
name|lp
operator|->
name|portid
operator|=
name|s_id
expr_stmt|;
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGTINFO
argument_list|,
literal|"%s: Chan %d N-port handle 0x%04x gets Port ID 0x%06x"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
name|nphdl
argument_list|,
name|s_id
argument_list|)
expr_stmt|;
name|something
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|lp
operator|->
name|portid
operator|!=
name|s_id
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGTINFO
argument_list|,
literal|"%s: Chan %d N-port handle 0x%04x tries to change Port ID 0x%06x to 0x%06x"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
name|nphdl
argument_list|,
name|lp
operator|->
name|portid
argument_list|,
name|s_id
argument_list|)
expr_stmt|;
name|isp_dump_portdb
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
if|if
condition|(
name|VALID_INI
argument_list|(
name|ini
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|VALID_INI
argument_list|(
name|lp
operator|->
name|port_wwn
argument_list|)
condition|)
block|{
name|lp
operator|->
name|port_wwn
operator|=
name|ini
expr_stmt|;
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGTINFO
argument_list|,
literal|"%s: Chan %d N-port handle 0x%04x gets WWN 0x%016llxx"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
name|nphdl
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|)
expr_stmt|;
name|something
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|lp
operator|->
name|port_wwn
operator|!=
name|ini
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d N-port handle 0x%04x tries to change WWN 0x%016llx to 0x%016llx"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
name|nphdl
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|lp
operator|->
name|port_wwn
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|)
expr_stmt|;
name|isp_dump_portdb
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
if|if
condition|(
operator|!
name|something
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d IID 0x%016llx N-Port Handle 0x%04x Port ID 0x%06x reentered"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|lp
operator|->
name|port_wwn
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|lp
operator|->
name|portid
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
comment|/* 	 * Find a new spot 	 */
for|for
control|(
name|i
operator|=
name|MAX_FC_TARG
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
if|if
condition|(
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
operator|.
name|target_mode
operator|==
literal|1
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
operator|.
name|state
operator|==
name|FC_PORTDB_STATE_NIL
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|<
literal|0
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d IID 0x%016llx N-Port Handle 0x%04x Port ID 0x%06x- no room in port database"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|,
name|nphdl
argument_list|,
name|s_id
argument_list|)
expr_stmt|;
return|return;
block|}
name|lp
operator|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|i
index|]
expr_stmt|;
name|ISP_MEMZERO
argument_list|(
name|lp
argument_list|,
sizeof|sizeof
argument_list|(
name|fcportdb_t
argument_list|)
argument_list|)
expr_stmt|;
name|lp
operator|->
name|target_mode
operator|=
literal|1
expr_stmt|;
name|lp
operator|->
name|handle
operator|=
name|nphdl
expr_stmt|;
name|lp
operator|->
name|portid
operator|=
name|s_id
expr_stmt|;
name|lp
operator|->
name|port_wwn
operator|=
name|ini
expr_stmt|;
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|=
name|i
operator|+
literal|1
expr_stmt|;
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGTINFO
argument_list|,
literal|"%s: Chan %d IID 0x%016llx N-Port Handle 0x%04x Port ID 0x%06x vtgt %d added"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|,
name|nphdl
argument_list|,
name|s_id
argument_list|,
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|-
literal|1
argument_list|)
expr_stmt|;
name|ISP_MEMZERO
argument_list|(
operator|&
name|nt
argument_list|,
sizeof|sizeof
argument_list|(
name|nt
argument_list|)
argument_list|)
expr_stmt|;
name|nt
operator|.
name|nt_hba
operator|=
name|isp
expr_stmt|;
name|nt
operator|.
name|nt_wwn
operator|=
name|ini
expr_stmt|;
name|nt
operator|.
name|nt_tgt
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
operator|->
name|isp_wwpn
expr_stmt|;
name|nt
operator|.
name|nt_sid
operator|=
name|s_id
expr_stmt|;
name|nt
operator|.
name|nt_did
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
operator|->
name|isp_portid
expr_stmt|;
name|nt
operator|.
name|nt_nphdl
operator|=
name|nphdl
expr_stmt|;
name|nt
operator|.
name|nt_channel
operator|=
name|chan
expr_stmt|;
name|nt
operator|.
name|nt_ncode
operator|=
name|NT_ARRIVED
expr_stmt|;
name|isp_async
argument_list|(
name|isp
argument_list|,
name|ISPASYNC_TARGET_NOTIFY
argument_list|,
operator|&
name|nt
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Remove a target device to the port database  */
end_comment

begin_function
name|void
name|isp_del_wwn_entry
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|,
name|uint64_t
name|ini
parameter_list|,
name|uint16_t
name|nphdl
parameter_list|,
name|uint32_t
name|s_id
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|isp_notify_t
name|nt
decl_stmt|;
name|fcportdb_t
modifier|*
name|lp
decl_stmt|;
if|if
condition|(
name|nphdl
operator|>=
name|MAX_NPORT_HANDLE
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d IID 0x%016llx bad N-Port handle 0x%04x Port ID 0x%06x"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|,
name|nphdl
argument_list|,
name|s_id
argument_list|)
expr_stmt|;
return|return;
block|}
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|==
literal|0
condition|)
block|{
name|lp
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|lp
operator|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|-
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|lp
operator|->
name|target_mode
operator|==
literal|0
condition|)
block|{
name|lp
operator|=
name|NULL
expr_stmt|;
block|}
block|}
if|if
condition|(
name|lp
operator|==
name|NULL
condition|)
block|{
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d IID 0x%016llx N-Port Handle 0x%04x Port ID 0x%06x cannot be found to be cleared"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|ini
argument_list|,
name|nphdl
argument_list|,
name|s_id
argument_list|)
expr_stmt|;
name|isp_dump_portdb
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
return|return;
block|}
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGTINFO
argument_list|,
literal|"%s: Chan %d IID 0x%016llx N-Port Handle 0x%04x Port ID 0x%06x vtgt %d cleared"
argument_list|,
name|__func__
argument_list|,
name|chan
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|lp
operator|->
name|port_wwn
argument_list|,
name|nphdl
argument_list|,
name|lp
operator|->
name|portid
argument_list|,
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|-
literal|1
argument_list|)
expr_stmt|;
name|fcp
operator|->
name|isp_tgt_map
index|[
name|nphdl
index|]
operator|=
literal|0
expr_stmt|;
name|ISP_MEMZERO
argument_list|(
operator|&
name|nt
argument_list|,
sizeof|sizeof
argument_list|(
name|nt
argument_list|)
argument_list|)
expr_stmt|;
name|nt
operator|.
name|nt_hba
operator|=
name|isp
expr_stmt|;
name|nt
operator|.
name|nt_wwn
operator|=
name|lp
operator|->
name|port_wwn
expr_stmt|;
name|nt
operator|.
name|nt_tgt
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
operator|->
name|isp_wwpn
expr_stmt|;
name|nt
operator|.
name|nt_sid
operator|=
name|lp
operator|->
name|portid
expr_stmt|;
name|nt
operator|.
name|nt_did
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
operator|->
name|isp_portid
expr_stmt|;
name|nt
operator|.
name|nt_nphdl
operator|=
name|nphdl
expr_stmt|;
name|nt
operator|.
name|nt_channel
operator|=
name|chan
expr_stmt|;
name|nt
operator|.
name|nt_ncode
operator|=
name|NT_DEPARTED
expr_stmt|;
name|isp_async
argument_list|(
name|isp
argument_list|,
name|ISPASYNC_TARGET_NOTIFY
argument_list|,
operator|&
name|nt
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_del_all_wwn_entries
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|int
name|chan
parameter_list|)
block|{
name|fcparam
modifier|*
name|fcp
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|IS_FC
argument_list|(
name|isp
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* 	 * Handle iterations over all channels via recursion 	 */
if|if
condition|(
name|chan
operator|==
name|ISP_NOCHAN
condition|)
block|{
for|for
control|(
name|chan
operator|=
literal|0
init|;
name|chan
operator|<
name|isp
operator|->
name|isp_nchan
condition|;
name|chan
operator|++
control|)
block|{
name|isp_del_all_wwn_entries
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
if|if
condition|(
name|chan
operator|>
name|isp
operator|->
name|isp_nchan
condition|)
block|{
return|return;
block|}
name|fcp
operator|=
name|FCPARAM
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcp
operator|==
name|NULL
condition|)
block|{
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_NPORT_HANDLE
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|fcp
operator|->
name|isp_tgt_map
index|[
name|i
index|]
condition|)
block|{
name|fcportdb_t
modifier|*
name|lp
init|=
operator|&
name|fcp
operator|->
name|portdb
index|[
name|fcp
operator|->
name|isp_tgt_map
index|[
name|i
index|]
operator|-
literal|1
index|]
decl_stmt|;
name|isp_del_wwn_entry
argument_list|(
name|isp
argument_list|,
name|chan
argument_list|,
name|lp
operator|->
name|port_wwn
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|lp
operator|->
name|portid
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|isp_del_wwn_entries
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|isp_notify_t
modifier|*
name|mp
parameter_list|)
block|{
name|fcportdb_t
modifier|*
name|lp
decl_stmt|;
comment|/* 	 * Handle iterations over all channels via recursion 	 */
if|if
condition|(
name|mp
operator|->
name|nt_channel
operator|==
name|ISP_NOCHAN
condition|)
block|{
for|for
control|(
name|mp
operator|->
name|nt_channel
operator|=
literal|0
init|;
name|mp
operator|->
name|nt_channel
operator|<
name|isp
operator|->
name|isp_nchan
condition|;
name|mp
operator|->
name|nt_channel
operator|++
control|)
block|{
name|isp_del_wwn_entries
argument_list|(
name|isp
argument_list|,
name|mp
argument_list|)
expr_stmt|;
block|}
name|mp
operator|->
name|nt_channel
operator|=
name|ISP_NOCHAN
expr_stmt|;
return|return;
block|}
comment|/* 	 * We have an entry which is only partially identified. 	 * 	 * It's only known by WWN, N-Port handle, or Port ID. 	 * We need to find the actual entry so we can delete it. 	 */
if|if
condition|(
name|mp
operator|->
name|nt_nphdl
operator|!=
name|NIL_HANDLE
condition|)
block|{
if|if
condition|(
name|isp_find_pdb_by_loopid
argument_list|(
name|isp
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|mp
operator|->
name|nt_nphdl
argument_list|,
operator|&
name|lp
argument_list|)
condition|)
block|{
name|isp_del_wwn_entry
argument_list|(
name|isp
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|lp
operator|->
name|port_wwn
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|lp
operator|->
name|portid
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
if|if
condition|(
name|mp
operator|->
name|nt_wwn
operator|!=
name|INI_ANY
condition|)
block|{
if|if
condition|(
name|isp_find_pdb_by_wwn
argument_list|(
name|isp
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|mp
operator|->
name|nt_wwn
argument_list|,
operator|&
name|lp
argument_list|)
condition|)
block|{
name|isp_del_wwn_entry
argument_list|(
name|isp
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|lp
operator|->
name|port_wwn
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|lp
operator|->
name|portid
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
if|if
condition|(
name|mp
operator|->
name|nt_sid
operator|!=
name|PORT_ANY
operator|&&
name|mp
operator|->
name|nt_sid
operator|!=
name|PORT_NONE
condition|)
block|{
if|if
condition|(
name|isp_find_pdb_by_sid
argument_list|(
name|isp
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|mp
operator|->
name|nt_sid
argument_list|,
operator|&
name|lp
argument_list|)
condition|)
block|{
name|isp_del_wwn_entry
argument_list|(
name|isp
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|lp
operator|->
name|port_wwn
argument_list|,
name|lp
operator|->
name|handle
argument_list|,
name|lp
operator|->
name|portid
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|isp_prt
argument_list|(
name|isp
argument_list|,
name|ISP_LOGWARN
argument_list|,
literal|"%s: Chan %d unable to find entry to delete N-port handle 0x%04x initiator WWN 0x%016llx Port ID 0x%06x"
argument_list|,
name|__func__
argument_list|,
name|mp
operator|->
name|nt_channel
argument_list|,
name|mp
operator|->
name|nt_nphdl
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|mp
operator|->
name|nt_wwn
argument_list|,
name|mp
operator|->
name|nt_sid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_atio
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at_entry_t
modifier|*
name|src
parameter_list|,
name|at_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_header
argument_list|,
operator|&
name|dst
operator|->
name|at_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_reserved
argument_list|,
operator|&
name|dst
operator|->
name|at_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_handle
argument_list|,
operator|&
name|dst
operator|->
name|at_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_lun
argument_list|,
operator|&
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_iid
argument_list|,
operator|&
name|dst
operator|->
name|at_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_cdblen
argument_list|,
operator|&
name|dst
operator|->
name|at_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_tgt
argument_list|,
operator|&
name|dst
operator|->
name|at_cdblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_status
argument_list|,
operator|&
name|dst
operator|->
name|at_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_tag_val
argument_list|,
operator|&
name|dst
operator|->
name|at_tag_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_tag_type
argument_list|,
operator|&
name|dst
operator|->
name|at_tag_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_lun
argument_list|,
operator|&
name|dst
operator|->
name|at_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_iid
argument_list|,
operator|&
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_cdblen
argument_list|,
operator|&
name|dst
operator|->
name|at_cdblen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_tgt
argument_list|,
operator|&
name|dst
operator|->
name|at_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_status
argument_list|,
operator|&
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|at_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_tag_val
argument_list|,
operator|&
name|dst
operator|->
name|at_tag_val
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_tag_type
argument_list|,
operator|&
name|dst
operator|->
name|at_tag_type
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_flags
argument_list|,
operator|&
name|dst
operator|->
name|at_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ATIO_CDBLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QLTM_SENSELEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_sense
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_sense
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_atio
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at_entry_t
modifier|*
name|src
parameter_list|,
name|at_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_header
argument_list|,
operator|&
name|dst
operator|->
name|at_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_reserved
argument_list|,
name|dst
operator|->
name|at_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_handle
argument_list|,
name|dst
operator|->
name|at_handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_lun
argument_list|,
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_iid
argument_list|,
name|dst
operator|->
name|at_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_cdblen
argument_list|,
name|dst
operator|->
name|at_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_tgt
argument_list|,
name|dst
operator|->
name|at_cdblen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_status
argument_list|,
name|dst
operator|->
name|at_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_scsi_status
argument_list|,
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_tag_val
argument_list|,
name|dst
operator|->
name|at_tag_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_tag_type
argument_list|,
name|dst
operator|->
name|at_tag_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_lun
argument_list|,
name|dst
operator|->
name|at_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_iid
argument_list|,
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_cdblen
argument_list|,
name|dst
operator|->
name|at_cdblen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_tgt
argument_list|,
name|dst
operator|->
name|at_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_status
argument_list|,
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_scsi_status
argument_list|,
name|dst
operator|->
name|at_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_tag_val
argument_list|,
name|dst
operator|->
name|at_tag_val
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_tag_type
argument_list|,
name|dst
operator|->
name|at_tag_type
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_flags
argument_list|,
name|dst
operator|->
name|at_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ATIO_CDBLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QLTM_SENSELEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_sense
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_sense
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_atio2
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at2_entry_t
modifier|*
name|src
parameter_list|,
name|at2_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_header
argument_list|,
operator|&
name|dst
operator|->
name|at_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_reserved
argument_list|,
operator|&
name|dst
operator|->
name|at_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_lun
argument_list|,
operator|&
name|dst
operator|->
name|at_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_iid
argument_list|,
operator|&
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_rxid
argument_list|,
operator|&
name|dst
operator|->
name|at_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_flags
argument_list|,
operator|&
name|dst
operator|->
name|at_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_status
argument_list|,
operator|&
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_crn
argument_list|,
operator|&
name|dst
operator|->
name|at_crn
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_taskcodes
argument_list|,
operator|&
name|dst
operator|->
name|at_taskcodes
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_taskflags
argument_list|,
operator|&
name|dst
operator|->
name|at_taskflags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_execodes
argument_list|,
operator|&
name|dst
operator|->
name|at_execodes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ATIO2_CDBLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_datalen
argument_list|,
operator|&
name|dst
operator|->
name|at_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_scclun
argument_list|,
operator|&
name|dst
operator|->
name|at_scclun
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_oxid
argument_list|,
operator|&
name|dst
operator|->
name|at_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_atio2e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at2e_entry_t
modifier|*
name|src
parameter_list|,
name|at2e_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_header
argument_list|,
operator|&
name|dst
operator|->
name|at_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_reserved
argument_list|,
operator|&
name|dst
operator|->
name|at_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_iid
argument_list|,
operator|&
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_rxid
argument_list|,
operator|&
name|dst
operator|->
name|at_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_flags
argument_list|,
operator|&
name|dst
operator|->
name|at_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_status
argument_list|,
operator|&
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_crn
argument_list|,
operator|&
name|dst
operator|->
name|at_crn
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_taskcodes
argument_list|,
operator|&
name|dst
operator|->
name|at_taskcodes
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_taskflags
argument_list|,
operator|&
name|dst
operator|->
name|at_taskflags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_execodes
argument_list|,
operator|&
name|dst
operator|->
name|at_execodes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ATIO2_CDBLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_datalen
argument_list|,
operator|&
name|dst
operator|->
name|at_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_scclun
argument_list|,
operator|&
name|dst
operator|->
name|at_scclun
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|at_oxid
argument_list|,
operator|&
name|dst
operator|->
name|at_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_atio2
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at2_entry_t
modifier|*
name|src
parameter_list|,
name|at2_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_header
argument_list|,
operator|&
name|dst
operator|->
name|at_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_reserved
argument_list|,
name|dst
operator|->
name|at_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_lun
argument_list|,
name|dst
operator|->
name|at_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_iid
argument_list|,
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_rxid
argument_list|,
name|dst
operator|->
name|at_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_flags
argument_list|,
name|dst
operator|->
name|at_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_status
argument_list|,
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_crn
argument_list|,
name|dst
operator|->
name|at_crn
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_taskcodes
argument_list|,
name|dst
operator|->
name|at_taskcodes
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_taskflags
argument_list|,
name|dst
operator|->
name|at_taskflags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_execodes
argument_list|,
name|dst
operator|->
name|at_execodes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ATIO2_CDBLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_datalen
argument_list|,
name|dst
operator|->
name|at_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_scclun
argument_list|,
name|dst
operator|->
name|at_scclun
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_oxid
argument_list|,
name|dst
operator|->
name|at_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_atio2e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at2e_entry_t
modifier|*
name|src
parameter_list|,
name|at2e_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_header
argument_list|,
operator|&
name|dst
operator|->
name|at_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_reserved
argument_list|,
name|dst
operator|->
name|at_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_iid
argument_list|,
name|dst
operator|->
name|at_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_rxid
argument_list|,
name|dst
operator|->
name|at_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_flags
argument_list|,
name|dst
operator|->
name|at_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_status
argument_list|,
name|dst
operator|->
name|at_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_crn
argument_list|,
name|dst
operator|->
name|at_crn
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_taskcodes
argument_list|,
name|dst
operator|->
name|at_taskcodes
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_taskflags
argument_list|,
name|dst
operator|->
name|at_taskflags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_execodes
argument_list|,
name|dst
operator|->
name|at_execodes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ATIO2_CDBLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_cdb
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_datalen
argument_list|,
name|dst
operator|->
name|at_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_scclun
argument_list|,
name|dst
operator|->
name|at_scclun
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_wwpn
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|at_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_oxid
argument_list|,
name|dst
operator|->
name|at_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_atio7
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|at7_entry_t
modifier|*
name|src
parameter_list|,
name|at7_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_type
argument_list|,
name|dst
operator|->
name|at_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_count
argument_list|,
name|dst
operator|->
name|at_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_ta_len
argument_list|,
name|dst
operator|->
name|at_ta_len
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_rxid
argument_list|,
name|dst
operator|->
name|at_rxid
argument_list|)
expr_stmt|;
name|isp_get_fc_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_hdr
argument_list|,
operator|&
name|dst
operator|->
name|at_hdr
argument_list|)
expr_stmt|;
name|isp_get_fcp_cmnd_iu
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|at_cmnd
argument_list|,
operator|&
name|dst
operator|->
name|at_cmnd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_ctio
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct_entry_t
modifier|*
name|src
parameter_list|,
name|ct_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_syshandle
argument_list|,
operator|&
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_fwhandle
argument_list|,
operator|&
name|dst
operator|->
name|ct_fwhandle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_iid
argument_list|,
operator|&
name|dst
operator|->
name|ct_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_lun
argument_list|,
operator|&
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_tgt
argument_list|,
operator|&
name|dst
operator|->
name|ct_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|ct_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_status
argument_list|,
operator|&
name|dst
operator|->
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|ct_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_tag_type
argument_list|,
operator|&
name|dst
operator|->
name|ct_tag_val
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_tag_val
argument_list|,
operator|&
name|dst
operator|->
name|ct_tag_type
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_iid
argument_list|,
operator|&
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_lun
argument_list|,
operator|&
name|dst
operator|->
name|ct_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_tgt
argument_list|,
operator|&
name|dst
operator|->
name|ct_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|ct_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_status
argument_list|,
operator|&
name|dst
operator|->
name|ct_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_tag_type
argument_list|,
operator|&
name|dst
operator|->
name|ct_tag_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_tag_val
argument_list|,
operator|&
name|dst
operator|->
name|ct_tag_val
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_flags
argument_list|,
operator|&
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_xfrlen
argument_list|,
operator|&
name|dst
operator|->
name|ct_xfrlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_resid
argument_list|,
operator|&
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_timeout
argument_list|,
operator|&
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ctio
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct_entry_t
modifier|*
name|src
parameter_list|,
name|ct_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_syshandle
argument_list|,
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_fwhandle
argument_list|,
name|dst
operator|->
name|ct_fwhandle
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_lun
argument_list|,
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_iid
argument_list|,
name|dst
operator|->
name|ct_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reserved2
argument_list|,
name|dst
operator|->
name|ct_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_tgt
argument_list|,
name|dst
operator|->
name|ct_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_status
argument_list|,
name|dst
operator|->
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|ct_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_tag_val
argument_list|,
name|dst
operator|->
name|ct_tag_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_tag_type
argument_list|,
name|dst
operator|->
name|ct_tag_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_lun
argument_list|,
name|dst
operator|->
name|ct_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_iid
argument_list|,
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reserved2
argument_list|,
name|dst
operator|->
name|ct_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_tgt
argument_list|,
name|dst
operator|->
name|ct_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_status
argument_list|,
name|dst
operator|->
name|ct_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_tag_val
argument_list|,
name|dst
operator|->
name|ct_tag_val
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_tag_type
argument_list|,
name|dst
operator|->
name|ct_tag_type
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_flags
argument_list|,
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_xfrlen
argument_list|,
name|dst
operator|->
name|ct_xfrlen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_resid
argument_list|,
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_timeout
argument_list|,
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_seg_count
argument_list|,
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_ctio2
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct2_entry_t
modifier|*
name|src
parameter_list|,
name|ct2_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_syshandle
argument_list|,
operator|&
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_lun
argument_list|,
operator|&
name|dst
operator|->
name|ct_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_iid
argument_list|,
operator|&
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_rxid
argument_list|,
operator|&
name|dst
operator|->
name|ct_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_flags
argument_list|,
operator|&
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_timeout
argument_list|,
operator|&
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_resid
argument_list|,
operator|&
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reloff
argument_list|,
operator|&
name|dst
operator|->
name|ct_reloff
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|src
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE0
condition|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO2
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO3
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO4
condition|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|src
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE1
condition|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXRESPLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_ctio2e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct2e_entry_t
modifier|*
name|src
parameter_list|,
name|ct2e_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_syshandle
argument_list|,
operator|&
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_iid
argument_list|,
operator|&
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_rxid
argument_list|,
operator|&
name|dst
operator|->
name|ct_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_flags
argument_list|,
operator|&
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_timeout
argument_list|,
operator|&
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_resid
argument_list|,
operator|&
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reloff
argument_list|,
operator|&
name|dst
operator|->
name|ct_reloff
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|src
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE0
condition|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO2
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO3
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO4
condition|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|src
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE1
condition|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXRESPLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_ctio7
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct7_entry_t
modifier|*
name|src
parameter_list|,
name|ct7_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_syshandle
argument_list|,
operator|&
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|ct_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_timeout
argument_list|,
operator|&
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_seg_count
argument_list|,
operator|&
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|ct_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_xflags
argument_list|,
operator|&
name|dst
operator|->
name|ct_xflags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_iid_lo
argument_list|,
operator|&
name|dst
operator|->
name|ct_iid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_iid_hi
argument_list|,
operator|&
name|dst
operator|->
name|ct_iid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_reserved
argument_list|,
operator|&
name|dst
operator|->
name|ct_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_rxid
argument_list|,
operator|&
name|dst
operator|->
name|ct_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_senselen
argument_list|,
operator|&
name|dst
operator|->
name|ct_senselen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_flags
argument_list|,
operator|&
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_resid
argument_list|,
operator|&
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_oxid
argument_list|,
operator|&
name|dst
operator|->
name|ct_oxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|ct_scsi_status
argument_list|,
operator|&
name|dst
operator|->
name|ct_scsi_status
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT7_FLAG_MMASK
operator|)
operator|==
name|CT7_FLAG_MODE0
condition|)
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reloff
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reloff
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved0
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved1
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT7_FLAG_MMASK
operator|)
operator|==
name|CT7_FLAG_MODE1
condition|)
block|{
name|uint32_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|reserved
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|reserved
argument_list|)
expr_stmt|;
name|a
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
expr_stmt|;
name|b
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|ASIZE
argument_list|(
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
argument_list|)
operator|>>
literal|2
operator|)
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|b
operator|++
operator|=
name|ISP_SWAP32
argument_list|(
name|isp
argument_list|,
operator|*
name|a
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved0
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved1
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_basehi
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|,
operator|&
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ctio2
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct2_entry_t
modifier|*
name|src
parameter_list|,
name|ct2_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_syshandle
argument_list|,
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_lun
argument_list|,
name|dst
operator|->
name|ct_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_iid
argument_list|,
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_rxid
argument_list|,
name|dst
operator|->
name|ct_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_flags
argument_list|,
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_status
argument_list|,
name|dst
operator|->
name|ct_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_timeout
argument_list|,
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_seg_count
argument_list|,
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reloff
argument_list|,
name|dst
operator|->
name|ct_reloff
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_resid
argument_list|,
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE0
condition|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO2
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dst
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO3
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dst
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO4
condition|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE1
condition|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXRESPLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ctio2e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct2e_entry_t
modifier|*
name|src
parameter_list|,
name|ct2e_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_syshandle
argument_list|,
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_iid
argument_list|,
name|dst
operator|->
name|ct_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_rxid
argument_list|,
name|dst
operator|->
name|ct_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_flags
argument_list|,
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_status
argument_list|,
name|dst
operator|->
name|ct_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_timeout
argument_list|,
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_seg_count
argument_list|,
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reloff
argument_list|,
name|dst
operator|->
name|ct_reloff
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_resid
argument_list|,
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE0
condition|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO2
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T2
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dst
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO3
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISP_RQDSEG_T3
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dataseg64
index|[
name|i
index|]
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dst
operator|->
name|ct_header
operator|.
name|rqs_entry_type
operator|==
name|RQSTYPE_CTIO4
condition|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_segment
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|u
operator|.
name|ct_dslist
operator|.
name|ds_base
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT2_FLAG_MMASK
operator|)
operator|==
name|CT2_FLAG_MODE1
condition|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_senselen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_scsi_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXRESPLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_ctio7
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|ct7_entry_t
modifier|*
name|src
parameter_list|,
name|ct7_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_header
argument_list|,
operator|&
name|dst
operator|->
name|ct_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_syshandle
argument_list|,
name|dst
operator|->
name|ct_syshandle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_nphdl
argument_list|,
name|dst
operator|->
name|ct_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_timeout
argument_list|,
name|dst
operator|->
name|ct_timeout
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_seg_count
argument_list|,
name|dst
operator|->
name|ct_seg_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_vpidx
argument_list|,
name|dst
operator|->
name|ct_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_xflags
argument_list|,
name|dst
operator|->
name|ct_xflags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_iid_lo
argument_list|,
name|dst
operator|->
name|ct_iid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_iid_hi
argument_list|,
name|dst
operator|->
name|ct_iid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_reserved
argument_list|,
name|dst
operator|->
name|ct_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_rxid
argument_list|,
name|dst
operator|->
name|ct_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_senselen
argument_list|,
name|dst
operator|->
name|ct_senselen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_flags
argument_list|,
name|dst
operator|->
name|ct_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_resid
argument_list|,
name|dst
operator|->
name|ct_resid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_oxid
argument_list|,
name|dst
operator|->
name|ct_oxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|ct_scsi_status
argument_list|,
name|dst
operator|->
name|ct_scsi_status
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT7_FLAG_MMASK
operator|)
operator|==
name|CT7_FLAG_MODE0
condition|)
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reloff
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reloff
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved0
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ct_xfrlen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved1
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_basehi
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m0
operator|.
name|ds
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|dst
operator|->
name|ct_flags
operator|&
name|CT7_FLAG_MMASK
operator|)
operator|==
name|CT7_FLAG_MODE1
condition|)
block|{
name|uint32_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resplen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|reserved
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|reserved
argument_list|)
expr_stmt|;
name|a
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
expr_stmt|;
name|b
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXRESPLEN_24XX
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|ASIZE
argument_list|(
name|src
operator|->
name|rsp
operator|.
name|m1
operator|.
name|ct_resp
argument_list|)
operator|>>
literal|2
operator|)
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|b
operator|++
operator|=
name|ISP_SWAP32
argument_list|(
name|isp
argument_list|,
operator|*
name|a
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved0
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved0
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_datalen
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved1
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_base
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_basehi
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_basehi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|,
name|dst
operator|->
name|rsp
operator|.
name|m2
operator|.
name|ct_fcp_rsp_iudata
operator|.
name|ds_count
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_enable_lun
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|lun_entry_t
modifier|*
name|lesrc
parameter_list|,
name|lun_entry_t
modifier|*
name|ledst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_header
argument_list|,
operator|&
name|ledst
operator|->
name|le_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_reserved
argument_list|,
operator|&
name|ledst
operator|->
name|le_reserved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_lun
argument_list|,
operator|&
name|ledst
operator|->
name|le_rsvd
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_rsvd
argument_list|,
operator|&
name|ledst
operator|->
name|le_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_ops
argument_list|,
operator|&
name|ledst
operator|->
name|le_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_tgt
argument_list|,
operator|&
name|ledst
operator|->
name|le_ops
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_status
argument_list|,
operator|&
name|ledst
operator|->
name|le_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_reserved2
argument_list|,
operator|&
name|ledst
operator|->
name|le_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_cmd_count
argument_list|,
operator|&
name|ledst
operator|->
name|le_in_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_in_count
argument_list|,
operator|&
name|ledst
operator|->
name|le_cmd_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_cdb6len
argument_list|,
operator|&
name|ledst
operator|->
name|le_cdb7len
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_cdb7len
argument_list|,
operator|&
name|ledst
operator|->
name|le_cdb6len
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_lun
argument_list|,
operator|&
name|ledst
operator|->
name|le_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_rsvd
argument_list|,
operator|&
name|ledst
operator|->
name|le_rsvd
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_ops
argument_list|,
operator|&
name|ledst
operator|->
name|le_ops
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_tgt
argument_list|,
operator|&
name|ledst
operator|->
name|le_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_status
argument_list|,
operator|&
name|ledst
operator|->
name|le_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_reserved2
argument_list|,
operator|&
name|ledst
operator|->
name|le_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_cmd_count
argument_list|,
operator|&
name|ledst
operator|->
name|le_cmd_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_in_count
argument_list|,
operator|&
name|ledst
operator|->
name|le_in_count
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_cdb6len
argument_list|,
operator|&
name|ledst
operator|->
name|le_cdb6len
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_cdb7len
argument_list|,
operator|&
name|ledst
operator|->
name|le_cdb7len
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_flags
argument_list|,
operator|&
name|ledst
operator|->
name|le_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_timeout
argument_list|,
operator|&
name|ledst
operator|->
name|le_timeout
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|lesrc
operator|->
name|le_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|ledst
operator|->
name|le_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_enable_lun
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|lun_entry_t
modifier|*
name|lesrc
parameter_list|,
name|lun_entry_t
modifier|*
name|ledst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_header
argument_list|,
operator|&
name|ledst
operator|->
name|le_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_reserved
argument_list|,
name|ledst
operator|->
name|le_reserved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_lun
argument_list|,
name|ledst
operator|->
name|le_rsvd
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_rsvd
argument_list|,
name|ledst
operator|->
name|le_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_ops
argument_list|,
name|ledst
operator|->
name|le_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_tgt
argument_list|,
name|ledst
operator|->
name|le_ops
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_status
argument_list|,
name|ledst
operator|->
name|le_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_reserved2
argument_list|,
name|ledst
operator|->
name|le_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_cmd_count
argument_list|,
name|ledst
operator|->
name|le_in_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_in_count
argument_list|,
name|ledst
operator|->
name|le_cmd_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_cdb6len
argument_list|,
name|ledst
operator|->
name|le_cdb7len
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_cdb7len
argument_list|,
name|ledst
operator|->
name|le_cdb6len
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_lun
argument_list|,
name|ledst
operator|->
name|le_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_rsvd
argument_list|,
name|ledst
operator|->
name|le_rsvd
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_ops
argument_list|,
name|ledst
operator|->
name|le_ops
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_tgt
argument_list|,
name|ledst
operator|->
name|le_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_status
argument_list|,
name|ledst
operator|->
name|le_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_reserved2
argument_list|,
name|ledst
operator|->
name|le_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_cmd_count
argument_list|,
name|ledst
operator|->
name|le_cmd_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_in_count
argument_list|,
name|ledst
operator|->
name|le_in_count
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_cdb6len
argument_list|,
name|ledst
operator|->
name|le_cdb6len
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_cdb7len
argument_list|,
name|ledst
operator|->
name|le_cdb7len
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_flags
argument_list|,
name|ledst
operator|->
name|le_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_timeout
argument_list|,
name|ledst
operator|->
name|le_timeout
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|lesrc
operator|->
name|le_reserved3
index|[
name|i
index|]
argument_list|,
name|ledst
operator|->
name|le_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_notify
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_entry_t
modifier|*
name|src
parameter_list|,
name|in_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_lun
argument_list|,
operator|&
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_iid
argument_list|,
operator|&
name|dst
operator|->
name|in_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|in_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_tgt
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_status
argument_list|,
operator|&
name|dst
operator|->
name|in_rsvd2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_rsvd2
argument_list|,
operator|&
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_tag_val
argument_list|,
operator|&
name|dst
operator|->
name|in_tag_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_tag_type
argument_list|,
operator|&
name|dst
operator|->
name|in_tag_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_lun
argument_list|,
operator|&
name|dst
operator|->
name|in_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_iid
argument_list|,
operator|&
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_tgt
argument_list|,
operator|&
name|dst
operator|->
name|in_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_status
argument_list|,
operator|&
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_rsvd2
argument_list|,
operator|&
name|dst
operator|->
name|in_rsvd2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_tag_val
argument_list|,
operator|&
name|dst
operator|->
name|in_tag_val
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_tag_type
argument_list|,
operator|&
name|dst
operator|->
name|in_tag_type
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_flags
argument_list|,
operator|&
name|dst
operator|->
name|in_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_seqid
argument_list|,
operator|&
name|dst
operator|->
name|in_seqid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IN_MSGLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_msg
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|in_msg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IN_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QLTM_SENSELEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_sense
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|in_sense
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_notify
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_entry_t
modifier|*
name|src
parameter_list|,
name|in_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved
argument_list|,
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_lun
argument_list|,
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_iid
argument_list|,
name|dst
operator|->
name|in_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved2
argument_list|,
name|dst
operator|->
name|in_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_tgt
argument_list|,
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_status
argument_list|,
name|dst
operator|->
name|in_rsvd2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_rsvd2
argument_list|,
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_tag_val
argument_list|,
name|dst
operator|->
name|in_tag_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_tag_type
argument_list|,
name|dst
operator|->
name|in_tag_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_lun
argument_list|,
name|dst
operator|->
name|in_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_iid
argument_list|,
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved2
argument_list|,
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_tgt
argument_list|,
name|dst
operator|->
name|in_tgt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_status
argument_list|,
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_rsvd2
argument_list|,
name|dst
operator|->
name|in_rsvd2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_tag_val
argument_list|,
name|dst
operator|->
name|in_tag_val
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_tag_type
argument_list|,
name|dst
operator|->
name|in_tag_type
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_flags
argument_list|,
name|dst
operator|->
name|in_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_seqid
argument_list|,
name|dst
operator|->
name|in_seqid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IN_MSGLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_msg
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|in_msg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IN_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved3
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|in_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|QLTM_SENSELEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_sense
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|in_sense
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_notify_fc
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_fcentry_t
modifier|*
name|src
parameter_list|,
name|in_fcentry_t
modifier|*
name|dst
parameter_list|)
block|{
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_lun
argument_list|,
operator|&
name|dst
operator|->
name|in_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_iid
argument_list|,
operator|&
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_scclun
argument_list|,
operator|&
name|dst
operator|->
name|in_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_status
argument_list|,
operator|&
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_task_flags
argument_list|,
operator|&
name|dst
operator|->
name|in_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_seqid
argument_list|,
operator|&
name|dst
operator|->
name|in_seqid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_notify_fc_e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_fcentry_e_t
modifier|*
name|src
parameter_list|,
name|in_fcentry_e_t
modifier|*
name|dst
parameter_list|)
block|{
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_iid
argument_list|,
operator|&
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_scclun
argument_list|,
operator|&
name|dst
operator|->
name|in_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_status
argument_list|,
operator|&
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_task_flags
argument_list|,
operator|&
name|dst
operator|->
name|in_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_seqid
argument_list|,
operator|&
name|dst
operator|->
name|in_seqid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_notify_24xx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_fcentry_24xx_t
modifier|*
name|src
parameter_list|,
name|in_fcentry_24xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|in_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_flags
argument_list|,
operator|&
name|dst
operator|->
name|in_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_srr_rxid
argument_list|,
operator|&
name|dst
operator|->
name|in_srr_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_status
argument_list|,
operator|&
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_status_subcode
argument_list|,
operator|&
name|dst
operator|->
name|in_status_subcode
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_rxid
argument_list|,
operator|&
name|dst
operator|->
name|in_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_srr_reloff_hi
argument_list|,
operator|&
name|dst
operator|->
name|in_srr_reloff_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_srr_reloff_lo
argument_list|,
operator|&
name|dst
operator|->
name|in_srr_reloff_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_srr_iu
argument_list|,
operator|&
name|dst
operator|->
name|in_srr_iu
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_srr_oxid
argument_list|,
operator|&
name|dst
operator|->
name|in_srr_oxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_nport_id_hi
argument_list|,
operator|&
name|dst
operator|->
name|in_nport_id_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_nport_id_lo
argument_list|,
operator|&
name|dst
operator|->
name|in_nport_id_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved3
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_np_handle
argument_list|,
operator|&
name|dst
operator|->
name|in_np_handle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|in_reserved4
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved4
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved4
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved5
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved5
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|in_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved6
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved6
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_portid_lo
argument_list|,
operator|&
name|dst
operator|->
name|in_portid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_portid_hi
argument_list|,
operator|&
name|dst
operator|->
name|in_portid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved7
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved7
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_reserved8
argument_list|,
operator|&
name|dst
operator|->
name|in_reserved8
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|in_oxid
argument_list|,
operator|&
name|dst
operator|->
name|in_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_notify_fc
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_fcentry_t
modifier|*
name|src
parameter_list|,
name|in_fcentry_t
modifier|*
name|dst
parameter_list|)
block|{
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved
argument_list|,
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_lun
argument_list|,
name|dst
operator|->
name|in_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_iid
argument_list|,
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_scclun
argument_list|,
name|dst
operator|->
name|in_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved2
argument_list|,
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_status
argument_list|,
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_task_flags
argument_list|,
name|dst
operator|->
name|in_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_seqid
argument_list|,
name|dst
operator|->
name|in_seqid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_notify_fc_e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_fcentry_e_t
modifier|*
name|src
parameter_list|,
name|in_fcentry_e_t
modifier|*
name|dst
parameter_list|)
block|{
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved
argument_list|,
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_iid
argument_list|,
name|dst
operator|->
name|in_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_scclun
argument_list|,
name|dst
operator|->
name|in_scclun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved2
argument_list|,
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_status
argument_list|,
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_task_flags
argument_list|,
name|dst
operator|->
name|in_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_seqid
argument_list|,
name|dst
operator|->
name|in_seqid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_notify_24xx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|in_fcentry_24xx_t
modifier|*
name|src
parameter_list|,
name|in_fcentry_24xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_header
argument_list|,
operator|&
name|dst
operator|->
name|in_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved
argument_list|,
name|dst
operator|->
name|in_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_nphdl
argument_list|,
name|dst
operator|->
name|in_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved1
argument_list|,
name|dst
operator|->
name|in_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_flags
argument_list|,
name|dst
operator|->
name|in_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_srr_rxid
argument_list|,
name|dst
operator|->
name|in_srr_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_status
argument_list|,
name|dst
operator|->
name|in_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_status_subcode
argument_list|,
name|dst
operator|->
name|in_status_subcode
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved2
argument_list|,
name|dst
operator|->
name|in_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_rxid
argument_list|,
name|dst
operator|->
name|in_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_srr_reloff_hi
argument_list|,
name|dst
operator|->
name|in_srr_reloff_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_srr_reloff_lo
argument_list|,
name|dst
operator|->
name|in_srr_reloff_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_srr_iu
argument_list|,
name|dst
operator|->
name|in_srr_iu
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_srr_oxid
argument_list|,
name|dst
operator|->
name|in_srr_oxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_nport_id_hi
argument_list|,
name|dst
operator|->
name|in_nport_id_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_nport_id_lo
argument_list|,
name|dst
operator|->
name|in_nport_id_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved3
argument_list|,
name|dst
operator|->
name|in_reserved3
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_np_handle
argument_list|,
name|dst
operator|->
name|in_np_handle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ASIZE
argument_list|(
name|src
operator|->
name|in_reserved4
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved4
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|in_reserved4
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved5
argument_list|,
name|dst
operator|->
name|in_reserved5
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_vpidx
argument_list|,
name|dst
operator|->
name|in_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved6
argument_list|,
name|dst
operator|->
name|in_reserved6
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_portid_lo
argument_list|,
name|dst
operator|->
name|in_portid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_portid_hi
argument_list|,
name|dst
operator|->
name|in_portid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved7
argument_list|,
name|dst
operator|->
name|in_reserved7
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_reserved8
argument_list|,
name|dst
operator|->
name|in_reserved8
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|in_oxid
argument_list|,
name|dst
operator|->
name|in_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_notify_ack
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_entry_t
modifier|*
name|src
parameter_list|,
name|na_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_lun
argument_list|,
operator|&
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_iid
argument_list|,
operator|&
name|dst
operator|->
name|na_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_status
argument_list|,
operator|&
name|dst
operator|->
name|na_event
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_event
argument_list|,
operator|&
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_lun
argument_list|,
operator|&
name|dst
operator|->
name|na_lun
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_iid
argument_list|,
operator|&
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_status
argument_list|,
operator|&
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_event
argument_list|,
operator|&
name|dst
operator|->
name|na_event
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NA_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_notify_ack
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_entry_t
modifier|*
name|src
parameter_list|,
name|na_entry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved
argument_list|,
name|dst
operator|->
name|na_reserved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISP_IS_SBUS
argument_list|(
name|isp
argument_list|)
condition|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_lun
argument_list|,
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_iid
argument_list|,
name|dst
operator|->
name|na_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_status
argument_list|,
name|dst
operator|->
name|na_event
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_event
argument_list|,
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_lun
argument_list|,
name|dst
operator|->
name|na_lun
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_iid
argument_list|,
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_status
argument_list|,
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_event
argument_list|,
name|dst
operator|->
name|na_event
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_flags
argument_list|,
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NA_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_notify_ack_fc
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_fcentry_t
modifier|*
name|src
parameter_list|,
name|na_fcentry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_iid
argument_list|,
operator|&
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_response
argument_list|,
operator|&
name|dst
operator|->
name|na_response
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_status
argument_list|,
operator|&
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_task_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_seqid
argument_list|,
operator|&
name|dst
operator|->
name|na_seqid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NA2_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_notify_ack_fc_e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_fcentry_e_t
modifier|*
name|src
parameter_list|,
name|na_fcentry_e_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_iid
argument_list|,
operator|&
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_response
argument_list|,
operator|&
name|dst
operator|->
name|na_response
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_status
argument_list|,
operator|&
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_task_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_seqid
argument_list|,
operator|&
name|dst
operator|->
name|na_seqid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NA2_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_put_notify_24xx_ack
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_fcentry_24xx_t
modifier|*
name|src
parameter_list|,
name|na_fcentry_24xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_handle
argument_list|,
operator|&
name|dst
operator|->
name|na_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|na_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved1
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_rxid
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_status
argument_list|,
operator|&
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_status_subcode
argument_list|,
operator|&
name|dst
operator|->
name|na_status_subcode
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved2
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_rxid
argument_list|,
operator|&
name|dst
operator|->
name|na_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_reloff_hi
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_reloff_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_reloff_lo
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_reloff_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_iu
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_iu
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_flags
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|18
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved4
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved4
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_vpidx
argument_list|,
operator|&
name|dst
operator|->
name|na_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_reject_vunique
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_reject_vunique
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_reject_explanation
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_reject_explanation
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_srr_reject_code
argument_list|,
operator|&
name|dst
operator|->
name|na_srr_reject_code
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved5
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved5
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_reserved6
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|na_reserved6
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|na_oxid
argument_list|,
operator|&
name|dst
operator|->
name|na_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_notify_ack_fc
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_fcentry_t
modifier|*
name|src
parameter_list|,
name|na_fcentry_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved
argument_list|,
name|dst
operator|->
name|na_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved1
argument_list|,
name|dst
operator|->
name|na_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_iid
argument_list|,
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_response
argument_list|,
name|dst
operator|->
name|na_response
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_flags
argument_list|,
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved2
argument_list|,
name|dst
operator|->
name|na_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_status
argument_list|,
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_task_flags
argument_list|,
name|dst
operator|->
name|na_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_seqid
argument_list|,
name|dst
operator|->
name|na_seqid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NA2_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_notify_ack_fc_e
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_fcentry_e_t
modifier|*
name|src
parameter_list|,
name|na_fcentry_e_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved
argument_list|,
name|dst
operator|->
name|na_reserved
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_iid
argument_list|,
name|dst
operator|->
name|na_iid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_response
argument_list|,
name|dst
operator|->
name|na_response
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_flags
argument_list|,
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved2
argument_list|,
name|dst
operator|->
name|na_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_status
argument_list|,
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_task_flags
argument_list|,
name|dst
operator|->
name|na_task_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_seqid
argument_list|,
name|dst
operator|->
name|na_seqid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NA2_RSVDLEN
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isp_get_notify_ack_24xx
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|na_fcentry_24xx_t
modifier|*
name|src
parameter_list|,
name|na_fcentry_24xx_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_header
argument_list|,
operator|&
name|dst
operator|->
name|na_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_handle
argument_list|,
name|dst
operator|->
name|na_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_nphdl
argument_list|,
name|dst
operator|->
name|na_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved1
argument_list|,
name|dst
operator|->
name|na_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_flags
argument_list|,
name|dst
operator|->
name|na_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_rxid
argument_list|,
name|dst
operator|->
name|na_srr_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_status
argument_list|,
name|dst
operator|->
name|na_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_status_subcode
argument_list|,
name|dst
operator|->
name|na_status_subcode
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved2
argument_list|,
name|dst
operator|->
name|na_reserved2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_rxid
argument_list|,
name|dst
operator|->
name|na_rxid
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_reloff_hi
argument_list|,
name|dst
operator|->
name|na_srr_reloff_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_reloff_lo
argument_list|,
name|dst
operator|->
name|na_srr_reloff_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_iu
argument_list|,
name|dst
operator|->
name|na_srr_iu
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_flags
argument_list|,
name|dst
operator|->
name|na_srr_flags
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|18
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|na_reserved3
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved4
argument_list|,
name|dst
operator|->
name|na_reserved4
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_vpidx
argument_list|,
name|dst
operator|->
name|na_vpidx
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_reject_vunique
argument_list|,
name|dst
operator|->
name|na_srr_reject_vunique
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_reject_explanation
argument_list|,
name|dst
operator|->
name|na_srr_reject_explanation
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_srr_reject_code
argument_list|,
name|dst
operator|->
name|na_srr_reject_code
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved5
argument_list|,
name|dst
operator|->
name|na_reserved5
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_reserved6
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|na_reserved6
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|na_oxid
argument_list|,
name|dst
operator|->
name|na_oxid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_abts
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|abts_t
modifier|*
name|src
parameter_list|,
name|abts_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_header
argument_list|,
operator|&
name|dst
operator|->
name|abts_header
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_reserved0
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|abts_reserved0
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_nphdl
argument_list|,
name|dst
operator|->
name|abts_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_reserved1
argument_list|,
name|dst
operator|->
name|abts_reserved1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_sof
argument_list|,
name|dst
operator|->
name|abts_sof
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rxid_abts
argument_list|,
name|dst
operator|->
name|abts_rxid_abts
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_did_lo
argument_list|,
name|dst
operator|->
name|abts_did_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_did_hi
argument_list|,
name|dst
operator|->
name|abts_did_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_r_ctl
argument_list|,
name|dst
operator|->
name|abts_r_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_sid_lo
argument_list|,
name|dst
operator|->
name|abts_sid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_sid_hi
argument_list|,
name|dst
operator|->
name|abts_sid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_cs_ctl
argument_list|,
name|dst
operator|->
name|abts_cs_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_fs_ctl
argument_list|,
name|dst
operator|->
name|abts_fs_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_f_ctl
argument_list|,
name|dst
operator|->
name|abts_f_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_type
argument_list|,
name|dst
operator|->
name|abts_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_seq_cnt
argument_list|,
name|dst
operator|->
name|abts_seq_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_df_ctl
argument_list|,
name|dst
operator|->
name|abts_df_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_seq_id
argument_list|,
name|dst
operator|->
name|abts_seq_id
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rx_id
argument_list|,
name|dst
operator|->
name|abts_rx_id
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_ox_id
argument_list|,
name|dst
operator|->
name|abts_ox_id
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_param
argument_list|,
name|dst
operator|->
name|abts_param
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_reserved2
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|abts_reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rxid_task
argument_list|,
name|dst
operator|->
name|abts_rxid_task
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_put_abts_rsp
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|abts_rsp_t
modifier|*
name|src
parameter_list|,
name|abts_rsp_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_put_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_header
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_header
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_handle
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_handle
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_status
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_status
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_nphdl
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_ctl_flags
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_ctl_flags
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_sof
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_sof
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_rxid_abts
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_rxid_abts
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_did_lo
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_did_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_did_hi
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_did_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_r_ctl
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_r_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_sid_lo
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_sid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_sid_hi
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_sid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_cs_ctl
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_cs_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_f_ctl_lo
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_f_ctl_lo
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_f_ctl_hi
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_f_ctl_hi
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_type
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_type
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_seq_cnt
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_seq_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_df_ctl
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_df_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_seq_id
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_seq_id
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_rx_id
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_rx_id
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_ox_id
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_ox_id
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_param
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_param
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|->
name|abts_rsp_r_ctl
operator|==
name|BA_ACC
condition|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|reserved
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|reserved
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|last_seq_id
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|last_seq_id
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|seq_id_valid
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|seq_id_valid
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|aborted_rx_id
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|aborted_rx_id
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|aborted_ox_id
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|aborted_ox_id
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|high_seq_cnt
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|high_seq_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|low_seq_cnt
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|low_seq_cnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_acc
operator|.
name|reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|src
operator|->
name|abts_rsp_r_ctl
operator|==
name|BA_RJT
condition|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|vendor_unique
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|vendor_unique
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|explanation
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|explanation
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|reason
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|reason
argument_list|)
expr_stmt|;
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|reserved
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|reserved
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|12
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_16
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|reserved2
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|ba_rjt
operator|.
name|reserved2
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXPUT_8
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_payload
operator|.
name|reserved
index|[
name|i
index|]
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|reserved
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|ISP_IOXPUT_32
argument_list|(
name|isp
argument_list|,
name|src
operator|->
name|abts_rsp_rxid_task
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_rxid_task
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isp_get_abts_rsp
parameter_list|(
name|ispsoftc_t
modifier|*
name|isp
parameter_list|,
name|abts_rsp_t
modifier|*
name|src
parameter_list|,
name|abts_rsp_t
modifier|*
name|dst
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|isp_get_hdr
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_header
argument_list|,
operator|&
name|dst
operator|->
name|abts_rsp_header
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_handle
argument_list|,
name|dst
operator|->
name|abts_rsp_handle
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_status
argument_list|,
name|dst
operator|->
name|abts_rsp_status
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_nphdl
argument_list|,
name|dst
operator|->
name|abts_rsp_nphdl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_ctl_flags
argument_list|,
name|dst
operator|->
name|abts_rsp_ctl_flags
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_sof
argument_list|,
name|dst
operator|->
name|abts_rsp_sof
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_rxid_abts
argument_list|,
name|dst
operator|->
name|abts_rsp_rxid_abts
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_did_lo
argument_list|,
name|dst
operator|->
name|abts_rsp_did_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_did_hi
argument_list|,
name|dst
operator|->
name|abts_rsp_did_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_r_ctl
argument_list|,
name|dst
operator|->
name|abts_rsp_r_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_sid_lo
argument_list|,
name|dst
operator|->
name|abts_rsp_sid_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_sid_hi
argument_list|,
name|dst
operator|->
name|abts_rsp_sid_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_cs_ctl
argument_list|,
name|dst
operator|->
name|abts_rsp_cs_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_f_ctl_lo
argument_list|,
name|dst
operator|->
name|abts_rsp_f_ctl_lo
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_f_ctl_hi
argument_list|,
name|dst
operator|->
name|abts_rsp_f_ctl_hi
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_type
argument_list|,
name|dst
operator|->
name|abts_rsp_type
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_seq_cnt
argument_list|,
name|dst
operator|->
name|abts_rsp_seq_cnt
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_df_ctl
argument_list|,
name|dst
operator|->
name|abts_rsp_df_ctl
argument_list|)
expr_stmt|;
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_seq_id
argument_list|,
name|dst
operator|->
name|abts_rsp_seq_id
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_rx_id
argument_list|,
name|dst
operator|->
name|abts_rsp_rx_id
argument_list|)
expr_stmt|;
name|ISP_IOXGET_16
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_ox_id
argument_list|,
name|dst
operator|->
name|abts_rsp_ox_id
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_param
argument_list|,
name|dst
operator|->
name|abts_rsp_param
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|ISP_IOXGET_8
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_payload
operator|.
name|rsp
operator|.
name|reserved
index|[
name|i
index|]
argument_list|,
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|rsp
operator|.
name|reserved
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_payload
operator|.
name|rsp
operator|.
name|subcode1
argument_list|,
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|rsp
operator|.
name|subcode1
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_payload
operator|.
name|rsp
operator|.
name|subcode2
argument_list|,
name|dst
operator|->
name|abts_rsp_payload
operator|.
name|rsp
operator|.
name|subcode2
argument_list|)
expr_stmt|;
name|ISP_IOXGET_32
argument_list|(
name|isp
argument_list|,
operator|&
name|src
operator|->
name|abts_rsp_rxid_task
argument_list|,
name|dst
operator|->
name|abts_rsp_rxid_task
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ISP_TARGET_MODE */
end_comment

begin_comment
comment|/*  * vim:ts=8:sw=8  */
end_comment

end_unit

