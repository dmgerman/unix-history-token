begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$NetBSD: rf_nwayxor.c,v 1.4 2000/03/30 12:45:41 augustss Exp $	*/
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*  * Copyright (c) 1995 Carnegie-Mellon University.  * All rights reserved.  *  * Author: Mark Holland, Daniel Stodolsky  *  * Permission to use, copy, modify and distribute this software and  * its documentation is hereby granted, provided that both the copyright  * notice and this permission notice appear in all copies of the  * software, derivative works or modified versions, and any portions  * thereof, and that both notices appear in supporting documentation.  *  * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"  * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND  * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.  *  * Carnegie Mellon requests users of this software to return to  *  *  Software Distribution Coordinator  or  Software.Distribution@CS.CMU.EDU  *  School of Computer Science  *  Carnegie Mellon University  *  Pittsburgh PA 15213-3890  *  * any improvements or extensions that they make and grant Carnegie the  * rights to redistribute these changes.  */
end_comment

begin_comment
comment|/************************************************************  *  * nwayxor.c -- code to do N-way xors for reconstruction  *  * nWayXorN xors N input buffers into the destination buffer.  * adapted from danner's longword_bxor code.  *  ************************************************************/
end_comment

begin_include
include|#
directive|include
file|<dev/raidframe/rf_nwayxor.h>
end_include

begin_include
include|#
directive|include
file|<dev/raidframe/rf_shutdown.h>
end_include

begin_decl_stmt
specifier|static
name|int
name|callcount
index|[
literal|10
index|]
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|rf_ShutdownNWayXor
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|rf_ShutdownNWayXor
parameter_list|(
name|ignored
parameter_list|)
name|void
modifier|*
name|ignored
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|rf_showXorCallCounts
operator|==
literal|0
condition|)
return|return;
name|printf
argument_list|(
literal|"Call counts for n-way xor routines:  "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%d "
argument_list|,
name|callcount
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|rf_ConfigureNWayXor
parameter_list|(
name|listp
parameter_list|)
name|RF_ShutdownList_t
modifier|*
modifier|*
name|listp
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|rc
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
name|callcount
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|rc
operator|=
name|rf_ShutdownCreate
argument_list|(
name|listp
argument_list|,
name|rf_ShutdownNWayXor
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_function
name|void
name|rf_nWayXor1
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|src
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|dest
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|end
init|=
name|src
operator|+
name|len
decl_stmt|;
name|unsigned
name|long
name|d0
decl_stmt|,
name|d1
decl_stmt|,
name|d2
decl_stmt|,
name|d3
decl_stmt|,
name|s0
decl_stmt|,
name|s1
decl_stmt|,
name|s2
decl_stmt|,
name|s3
decl_stmt|;
name|callcount
index|[
literal|1
index|]
operator|++
expr_stmt|;
while|while
condition|(
name|len
operator|>=
literal|4
condition|)
block|{
name|d0
operator|=
name|dest
index|[
literal|0
index|]
expr_stmt|;
name|d1
operator|=
name|dest
index|[
literal|1
index|]
expr_stmt|;
name|d2
operator|=
name|dest
index|[
literal|2
index|]
expr_stmt|;
name|d3
operator|=
name|dest
index|[
literal|3
index|]
expr_stmt|;
name|s0
operator|=
name|src
index|[
literal|0
index|]
expr_stmt|;
name|s1
operator|=
name|src
index|[
literal|1
index|]
expr_stmt|;
name|s2
operator|=
name|src
index|[
literal|2
index|]
expr_stmt|;
name|s3
operator|=
name|src
index|[
literal|3
index|]
expr_stmt|;
name|dest
index|[
literal|0
index|]
operator|=
name|d0
operator|^
name|s0
expr_stmt|;
name|dest
index|[
literal|1
index|]
operator|=
name|d1
operator|^
name|s1
expr_stmt|;
name|dest
index|[
literal|2
index|]
operator|=
name|d2
operator|^
name|s2
expr_stmt|;
name|dest
index|[
literal|3
index|]
operator|=
name|d3
operator|^
name|s3
expr_stmt|;
name|src
operator|+=
literal|4
expr_stmt|;
name|dest
operator|+=
literal|4
expr_stmt|;
name|len
operator|-=
literal|4
expr_stmt|;
block|}
while|while
condition|(
name|src
operator|<
name|end
condition|)
block|{
operator|*
name|dest
operator|++
operator|^=
operator|*
name|src
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor2
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|a
init|=
name|dst
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|2
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|=
operator|*
name|a
operator|++
operator|^
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|a0
operator|=
name|a
index|[
literal|0
index|]
expr_stmt|;
name|len
operator|-=
literal|4
expr_stmt|;
name|a1
operator|=
name|a
index|[
literal|1
index|]
expr_stmt|;
name|a2
operator|=
name|a
index|[
literal|2
index|]
expr_stmt|;
name|a3
operator|=
name|a
index|[
literal|3
index|]
expr_stmt|;
name|a
operator|+=
literal|4
expr_stmt|;
name|b0
operator|=
name|b
index|[
literal|0
index|]
expr_stmt|;
name|b1
operator|=
name|b
index|[
literal|1
index|]
expr_stmt|;
name|b2
operator|=
name|b
index|[
literal|2
index|]
expr_stmt|;
name|b3
operator|=
name|b
index|[
literal|3
index|]
expr_stmt|;
comment|/* start dual issue */
name|a0
operator|^=
name|b0
expr_stmt|;
name|b0
operator|=
name|c
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|+=
literal|4
expr_stmt|;
name|a1
operator|^=
name|b1
expr_stmt|;
name|a2
operator|^=
name|b2
expr_stmt|;
name|a3
operator|^=
name|b3
expr_stmt|;
name|b1
operator|=
name|c
index|[
literal|1
index|]
expr_stmt|;
name|a0
operator|^=
name|b0
expr_stmt|;
name|b2
operator|=
name|c
index|[
literal|2
index|]
expr_stmt|;
name|a1
operator|^=
name|b1
expr_stmt|;
name|b3
operator|=
name|c
index|[
literal|3
index|]
expr_stmt|;
name|a2
operator|^=
name|b2
expr_stmt|;
name|dst
index|[
literal|0
index|]
operator|=
name|a0
expr_stmt|;
name|a3
operator|^=
name|b3
expr_stmt|;
name|dst
index|[
literal|1
index|]
operator|=
name|a1
expr_stmt|;
name|c
operator|+=
literal|4
expr_stmt|;
name|dst
index|[
literal|2
index|]
operator|=
name|a2
expr_stmt|;
name|dst
index|[
literal|3
index|]
operator|=
name|a3
expr_stmt|;
name|dst
operator|+=
literal|4
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|=
operator|*
name|a
operator|++
operator|^
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* note that first arg is not incremented but 2nd arg is */
end_comment

begin_define
define|#
directive|define
name|LOAD_FIRST
parameter_list|(
name|_dst
parameter_list|,
name|_b
parameter_list|)
define|\
value|a0 = _dst[0]; len -= 4;   \   a1 = _dst[1];             \   a2 = _dst[2];             \   a3 = _dst[3];             \   b0 = _b[0];               \   b1 = _b[1];               \   b2 = _b[2];               \   b3 = _b[3];  _b += 4;
end_define

begin_comment
comment|/* note: arg is incremented */
end_comment

begin_define
define|#
directive|define
name|XOR_AND_LOAD_NEXT
parameter_list|(
name|_n
parameter_list|)
define|\
value|a0 ^= b0; b0 = _n[0];       \   a1 ^= b1; b1 = _n[1];       \   a2 ^= b2; b2 = _n[2];       \   a3 ^= b3; b3 = _n[3];       \   _n += 4;
end_define

begin_comment
comment|/* arg is incremented */
end_comment

begin_define
define|#
directive|define
name|XOR_AND_STORE
parameter_list|(
name|_dst
parameter_list|)
define|\
value|a0 ^= b0; _dst[0] = a0;         \   a1 ^= b1; _dst[1] = a1;         \   a2 ^= b2; _dst[2] = a2;         \   a3 ^= b3; _dst[3] = a3;         \   _dst += 4;
end_define

begin_function
name|void
name|rf_nWayXor3
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|3
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor4
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|e
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|3
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|4
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor5
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|e
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|3
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|f
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|4
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|5
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor6
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|e
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|3
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|f
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|4
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|g
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|5
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|6
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor7
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|e
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|3
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|f
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|4
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|g
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|5
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|h
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|6
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|7
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
operator|^
operator|*
name|h
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
operator|^
operator|*
name|h
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor8
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|e
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|3
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|f
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|4
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|g
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|5
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|h
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|6
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|i
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|7
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|8
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
operator|^
operator|*
name|h
operator|++
operator|^
operator|*
name|i
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
operator|^
operator|*
name|h
operator|++
operator|^
operator|*
name|i
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|rf_nWayXor9
parameter_list|(
name|src_rbs
parameter_list|,
name|dest_rb
parameter_list|,
name|len
parameter_list|)
name|RF_ReconBuffer_t
modifier|*
modifier|*
name|src_rbs
decl_stmt|;
name|RF_ReconBuffer_t
modifier|*
name|dest_rb
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|unsigned
name|long
modifier|*
name|dst
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|dest_rb
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|b
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|0
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|c
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|1
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|d
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|2
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|e
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|3
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|f
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|4
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|g
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|5
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|h
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|6
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|i
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|7
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
modifier|*
name|j
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|src_rbs
index|[
literal|8
index|]
operator|->
name|buffer
decl_stmt|;
name|unsigned
name|long
name|a0
decl_stmt|,
name|a1
decl_stmt|,
name|a2
decl_stmt|,
name|a3
decl_stmt|,
name|b0
decl_stmt|,
name|b1
decl_stmt|,
name|b2
decl_stmt|,
name|b3
decl_stmt|;
name|callcount
index|[
literal|9
index|]
operator|++
expr_stmt|;
comment|/* align dest to cache line */
while|while
condition|(
operator|(
operator|(
operator|(
name|unsigned
name|long
operator|)
name|dst
operator|)
operator|&
literal|0x1f
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
operator|^
operator|*
name|h
operator|++
operator|^
operator|*
name|i
operator|++
operator|^
operator|*
name|j
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|len
operator|>
literal|4
condition|)
block|{
name|LOAD_FIRST
argument_list|(
name|dst
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|XOR_AND_LOAD_NEXT
argument_list|(
name|j
argument_list|)
expr_stmt|;
name|XOR_AND_STORE
argument_list|(
name|dst
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|len
condition|)
block|{
operator|*
name|dst
operator|++
operator|^=
operator|*
name|b
operator|++
operator|^
operator|*
name|c
operator|++
operator|^
operator|*
name|d
operator|++
operator|^
operator|*
name|e
operator|++
operator|^
operator|*
name|f
operator|++
operator|^
operator|*
name|g
operator|++
operator|^
operator|*
name|h
operator|++
operator|^
operator|*
name|i
operator|++
operator|^
operator|*
name|j
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
end_function

end_unit

