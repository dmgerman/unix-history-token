begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  * ===================================  * HARP  |  Host ATM Research Platform  * ===================================  *  *  * This Host ATM Research Platform ("HARP") file (the "Software") is  * made available by Network Computing Services, Inc. ("NetworkCS")  * "AS IS".  NetworkCS does not provide maintenance, improvements or  * support of any kind.  *  * NETWORKCS MAKES NO WARRANTIES OR REPRESENTATIONS, EXPRESS OR IMPLIED,  * INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS FOR A PARTICULAR PURPOSE, AS TO ANY ELEMENT OF THE  * SOFTWARE OR ANY SUPPORT PROVIDED IN CONNECTION WITH THIS SOFTWARE.  * In no event shall NetworkCS be responsible for any damages, including  * but not limited to consequential damages, arising from or relating to  * any use of the Software or related support.  *  * Copyright 1994-1998 Network Computing Services, Inc.  *  * Copies of this Software may be made, however, the above copyright  * notice must be reproduced on all copies.  *  *	@(#) $FreeBSD$  *  */
end_comment

begin_comment
comment|/*  * ATM Forum UNI 3.0/3.1 Signalling Manager  * ----------------------------------------  *  * Message formatting module  *  */
end_comment

begin_include
include|#
directive|include
file|<netatm/kern_include.h>
end_include

begin_include
include|#
directive|include
file|<netatm/uni/unisig_var.h>
end_include

begin_include
include|#
directive|include
file|<netatm/uni/unisig_msg.h>
end_include

begin_include
include|#
directive|include
file|<netatm/uni/unisig_mbuf.h>
end_include

begin_include
include|#
directive|include
file|<netatm/uni/unisig_decode.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_expr_stmt
name|__RCSID
argument_list|(
literal|"@(#) $FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|ALLOC_IE
parameter_list|(
name|ie
parameter_list|)
define|\
value|(ie) = (struct ie_generic *) atm_allocate(&unisig_iepool); \ 	if (!ie)						\ 		return(ENOMEM);
end_define

begin_comment
comment|/*  * Local functions  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|unisig_msg
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_hdr
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_aalp
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_clrt
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_bbcp
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_bhli
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_blli
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_clst
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_cdad
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_cdsa
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_cgad
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_cgsa
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_caus
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_cnid
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_qosp
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_brpi
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_rsti
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_bsdc
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_trnt
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_uimp
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_ie_ident
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
expr|struct
name|ie_generic
operator|*
operator|,
expr|struct
name|ie_decode_tbl
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|usf_dec_atm_addr
name|__P
argument_list|(
operator|(
expr|struct
name|usfmt
operator|*
operator|,
name|Atm_addr
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Table associating IE type with IE vector index  */
end_comment

begin_decl_stmt
name|u_char
name|unisig_ie_ident_vec
index|[]
init|=
block|{
name|UNI_IE_AALP
block|,
name|UNI_IE_CLRT
block|,
name|UNI_IE_BBCP
block|,
name|UNI_IE_BHLI
block|,
name|UNI_IE_BLLI
block|,
name|UNI_IE_CLST
block|,
name|UNI_IE_CDAD
block|,
name|UNI_IE_CDSA
block|,
name|UNI_IE_CGAD
block|,
name|UNI_IE_CGSA
block|,
name|UNI_IE_CAUS
block|,
name|UNI_IE_CNID
block|,
name|UNI_IE_QOSP
block|,
name|UNI_IE_BRPI
block|,
name|UNI_IE_RSTI
block|,
name|UNI_IE_BLSH
block|,
name|UNI_IE_BNSH
block|,
name|UNI_IE_BSDC
block|,
name|UNI_IE_TRNT
block|,
name|UNI_IE_EPRF
block|,
name|UNI_IE_EPST
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Tables specifying which IEs are mandatory, optional, and  * not allowed for each Q.2931 message type  */
end_comment

begin_decl_stmt
specifier|static
name|u_char
name|uni_calp_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_OPT
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_OPT
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_conn_ie_tbl
index|[]
init|=
block|{
name|IE_OPT
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_OPT
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_OPT
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_OPT
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_cack_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_NA
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_setu_ie_tbl
index|[]
init|=
block|{
name|IE_MAND
block|,
comment|/* ATM AAL Parameters (not required by 			   UNI 3.0) */
name|IE_MAND
block|,
comment|/* ATM User Cell Rate */
name|IE_MAND
block|,
comment|/* Broadband Bearer Capability */
name|IE_OPT
block|,
comment|/* Broadband High Layer Information */
name|IE_MAND
block|,
comment|/* Broadband Low Layer Information (not required				   by UNI 3.0 */
name|IE_NA
block|,
comment|/* Call State */
name|IE_MAND
block|,
comment|/* Called Party Number */
name|IE_OPT
block|,
comment|/* Called Party Subaddress */
name|IE_OPT
block|,
comment|/* Calling Party Number */
name|IE_OPT
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_MAND
block|,
comment|/* Connection Identifier */
name|IE_MAND
block|,
comment|/* Quality of Service Parameters */
name|IE_OPT
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_OPT
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_OPT
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_rlse_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_MAND
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_NA
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_rlsc_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_MAND
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_NA
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_rstr_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_OPT
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_MAND
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_NA
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_rsta_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_OPT
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_MAND
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_NA
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_stat_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_MAND
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_MAND
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_OPT
block|,
comment|/* Endpoint Reference */
name|IE_OPT
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_senq_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_OPT
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_addp_ie_tbl
index|[]
init|=
block|{
name|IE_OPT
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_OPT
block|,
comment|/* Broadband High Layer Information */
name|IE_OPT
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_MAND
block|,
comment|/* Called Party Number */
name|IE_OPT
block|,
comment|/* Called Party Subaddress */
name|IE_OPT
block|,
comment|/* Calling Party Number */
name|IE_OPT
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_OPT
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_MAND
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_adpa_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_NA
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_MAND
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_adpr_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_MAND
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_MAND
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_drpp_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_MAND
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_MAND
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|uni_drpa_ie_tbl
index|[]
init|=
block|{
name|IE_NA
block|,
comment|/* ATM AAL Parameters */
name|IE_NA
block|,
comment|/* ATM User Cell Rate */
name|IE_NA
block|,
comment|/* Broadband Bearer Capability */
name|IE_NA
block|,
comment|/* Broadband High Layer Information */
name|IE_NA
block|,
comment|/* Broadband Low Layer Information */
name|IE_NA
block|,
comment|/* Call State */
name|IE_NA
block|,
comment|/* Called Party Number */
name|IE_NA
block|,
comment|/* Called Party Subaddress */
name|IE_NA
block|,
comment|/* Calling Party Number */
name|IE_NA
block|,
comment|/* Calling Party Subaddress */
name|IE_OPT
block|,
comment|/* Cause */
name|IE_NA
block|,
comment|/* Connection Identifier */
name|IE_NA
block|,
comment|/* Quality of Service Parameters */
name|IE_NA
block|,
comment|/* Broadband Repeat Indicator */
name|IE_NA
block|,
comment|/* Restart Indicator */
name|IE_NA
block|,
comment|/* Broadband Locking Shift */
name|IE_NA
block|,
comment|/* Broadband Non-locking Shift */
name|IE_NA
block|,
comment|/* Broadband Sending Complete */
name|IE_NA
block|,
comment|/* Transit Net */
name|IE_MAND
block|,
comment|/* Endpoint Reference */
name|IE_NA
comment|/* Endpoint State */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Table of Q.2931 message types  */
end_comment

begin_struct
specifier|static
struct|struct
block|{
name|u_char
name|msg_type
decl_stmt|;
name|u_char
modifier|*
name|msg_ie_tbl
decl_stmt|;
block|}
name|uni_msg_types
index|[]
init|=
block|{
block|{
name|UNI_MSG_CALP
block|,
name|uni_calp_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_CONN
block|,
name|uni_conn_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_CACK
block|,
name|uni_cack_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_SETU
block|,
name|uni_setu_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_RLSE
block|,
name|uni_rlse_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_RLSC
block|,
name|uni_rlsc_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_RSTR
block|,
name|uni_rstr_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_RSTA
block|,
name|uni_rsta_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_STAT
block|,
name|uni_stat_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_SENQ
block|,
name|uni_senq_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_ADDP
block|,
name|uni_addp_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_ADPA
block|,
name|uni_adpa_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_ADPR
block|,
name|uni_adpr_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_DRPP
block|,
name|uni_drpp_ie_tbl
block|}
block|,
block|{
name|UNI_MSG_DRPA
block|,
name|uni_drpa_ie_tbl
block|}
block|, }
struct|;
end_struct

begin_comment
comment|/*  * Table of information elements  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|ie_ent
name|ie_table
index|[]
init|=
block|{
block|{
name|UNI_IE_AALP
block|,
literal|5
block|,
literal|16
block|,
name|UNI_MSG_IE_AALP
block|,
name|usf_dec_ie_aalp
block|}
block|,
block|{
name|UNI_IE_CLRT
block|,
literal|0
block|,
literal|26
block|,
name|UNI_MSG_IE_CLRT
block|,
name|usf_dec_ie_clrt
block|}
block|,
block|{
name|UNI_IE_BBCP
block|,
literal|2
block|,
literal|3
block|,
name|UNI_MSG_IE_BBCP
block|,
name|usf_dec_ie_bbcp
block|}
block|,
block|{
name|UNI_IE_BHLI
block|,
literal|1
block|,
literal|9
block|,
name|UNI_MSG_IE_BHLI
block|,
name|usf_dec_ie_bhli
block|}
block|,
block|{
name|UNI_IE_BLLI
block|,
literal|0
block|,
literal|13
block|,
name|UNI_MSG_IE_BLLI
block|,
name|usf_dec_ie_blli
block|}
block|,
block|{
name|UNI_IE_CLST
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_CLST
block|,
name|usf_dec_ie_clst
block|}
block|,
block|{
name|UNI_IE_CDAD
block|,
literal|1
block|,
literal|21
block|,
name|UNI_MSG_IE_CDAD
block|,
name|usf_dec_ie_cdad
block|}
block|,
block|{
name|UNI_IE_CDSA
block|,
literal|1
block|,
literal|21
block|,
name|UNI_MSG_IE_CDSA
block|,
name|usf_dec_ie_cdsa
block|}
block|,
block|{
name|UNI_IE_CGAD
block|,
literal|1
block|,
literal|22
block|,
name|UNI_MSG_IE_CGAD
block|,
name|usf_dec_ie_cgad
block|}
block|,
block|{
name|UNI_IE_CGSA
block|,
literal|1
block|,
literal|21
block|,
name|UNI_MSG_IE_CGSA
block|,
name|usf_dec_ie_cgsa
block|}
block|,
block|{
name|UNI_IE_CAUS
block|,
literal|2
block|,
literal|30
block|,
name|UNI_MSG_IE_CAUS
block|,
name|usf_dec_ie_caus
block|}
block|,
block|{
name|UNI_IE_CNID
block|,
literal|5
block|,
literal|5
block|,
name|UNI_MSG_IE_CNID
block|,
name|usf_dec_ie_cnid
block|}
block|,
block|{
name|UNI_IE_QOSP
block|,
literal|2
block|,
literal|2
block|,
name|UNI_MSG_IE_QOSP
block|,
name|usf_dec_ie_qosp
block|}
block|,
block|{
name|UNI_IE_BRPI
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_BRPI
block|,
name|usf_dec_ie_brpi
block|}
block|,
block|{
name|UNI_IE_RSTI
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_RSTI
block|,
name|usf_dec_ie_rsti
block|}
block|,
block|{
name|UNI_IE_BLSH
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_ERR
block|,
name|usf_dec_ie_uimp
block|}
block|,
block|{
name|UNI_IE_BNSH
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_ERR
block|,
name|usf_dec_ie_uimp
block|}
block|,
block|{
name|UNI_IE_BSDC
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_BSDC
block|,
name|usf_dec_ie_bsdc
block|}
block|,
block|{
name|UNI_IE_TRNT
block|,
literal|1
block|,
literal|5
block|,
name|UNI_MSG_IE_TRNT
block|,
name|usf_dec_ie_trnt
block|}
block|,
block|{
name|UNI_IE_EPRF
block|,
literal|3
block|,
literal|3
block|,
name|UNI_MSG_IE_ERR
block|,
name|usf_dec_ie_uimp
block|}
block|,
block|{
name|UNI_IE_EPST
block|,
literal|1
block|,
literal|1
block|,
name|UNI_MSG_IE_ERR
block|,
name|usf_dec_ie_uimp
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Decoding table for AAL 1  */
end_comment

begin_decl_stmt
name|struct
name|ie_decode_tbl
name|ie_aal1_tbl
index|[]
init|=
block|{
block|{
literal|133
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_subtype
argument_list|)
block|}
block|,
block|{
literal|134
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_cbr_rate
argument_list|)
block|}
block|,
block|{
literal|135
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_multiplier
argument_list|)
block|}
block|,
block|{
literal|136
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_clock_recovery
argument_list|)
block|}
block|,
block|{
literal|137
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_error_correction
argument_list|)
block|}
block|,
block|{
literal|138
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_struct_data_tran
argument_list|)
block|}
block|,
block|{
literal|139
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_1_partial_cells
argument_list|)
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Decoding table for AAL 3/4  */
end_comment

begin_decl_stmt
name|struct
name|ie_decode_tbl
name|ie_aal4_tbl_30
index|[]
init|=
block|{
block|{
literal|140
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_fwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|129
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_bkwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|130
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_mid_range
argument_list|)
block|}
block|,
block|{
literal|131
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_mode
argument_list|)
block|}
block|,
block|{
literal|132
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_sscs_type
argument_list|)
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_decode_tbl
name|ie_aal4_tbl_31
index|[]
init|=
block|{
block|{
literal|140
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_fwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|129
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_bkwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|130
block|,
literal|4
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_mid_range
argument_list|)
block|}
block|,
block|{
literal|132
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_4_sscs_type
argument_list|)
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Decoding table for AAL 5  */
end_comment

begin_decl_stmt
name|struct
name|ie_decode_tbl
name|ie_aal5_tbl_30
index|[]
init|=
block|{
block|{
literal|140
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_fwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|129
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_bkwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|131
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_mode
argument_list|)
block|}
block|,
block|{
literal|132
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_sscs_type
argument_list|)
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_decode_tbl
name|ie_aal5_tbl_31
index|[]
init|=
block|{
block|{
literal|140
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_fwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|129
block|,
literal|2
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_bkwd_max_sdu
argument_list|)
block|}
block|,
block|{
literal|132
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_aalp_5_sscs_type
argument_list|)
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Decoding table for ATM user cell rate  */
end_comment

begin_decl_stmt
name|struct
name|ie_decode_tbl
name|ie_clrt_tbl
index|[]
init|=
block|{
block|{
name|UNI_IE_CLRT_FWD_PEAK_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_fwd_peak
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BKWD_PEAK_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_bkwd_peak
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_FWD_PEAK_01_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_fwd_peak_01
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BKWD_PEAK_01_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_bkwd_peak_01
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_FWD_SUST_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_fwd_sust
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BKWD_SUST_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_bkwd_sust
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_FWD_SUST_01_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_fwd_sust_01
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BKWD_SUST_01_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_bkwd_sust_01
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_FWD_BURST_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_fwd_burst
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BKWD_BURST_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_bkwd_burst
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_FWD_BURST_01_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_fwd_burst_01
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BKWD_BURST_01_ID
block|,
literal|3
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_bkwd_burst_01
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_BEST_EFFORT_ID
block|,
literal|0
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_best_effort
argument_list|)
block|}
block|,
block|{
name|UNI_IE_CLRT_TM_OPTIONS_ID
block|,
literal|1
block|,
name|IE_OFF_SIZE
argument_list|(
argument|ie_clrt_tm_options
argument_list|)
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * IEs initialized to empty values  */
end_comment

begin_decl_stmt
name|struct
name|ie_aalp
name|ie_aalp_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_clrt
name|ie_clrt_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_bbcp
name|ie_bbcp_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_bhli
name|ie_bhli_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_blli
name|ie_blli_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_clst
name|ie_clst_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_cdad
name|ie_cdad_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
block|{
name|T_ATM_ABSENT
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_cdsa
name|ie_cdsa_absent
init|=
block|{
block|{
name|T_ATM_ABSENT
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_cgad
name|ie_cgad_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
block|{
name|T_ATM_ABSENT
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_cgsa
name|ie_cgsa_absent
init|=
block|{
block|{
name|T_ATM_ABSENT
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_caus
name|ie_caus_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_cnid
name|ie_cnid_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_qosp
name|ie_qosp_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_brpi
name|ie_brpi_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_rsti
name|ie_rsti_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_blsh
name|ie_blsh_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_bnsh
name|ie_bnsh_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_bsdc
name|ie_bsdc_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_trnt
name|ie_trnt_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_eprf
name|ie_eprf_absent
init|=
block|{
name|T_ATM_ABSENT
block|,
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ie_epst
name|ie_epst_absent
init|=
block|{
name|T_ATM_ABSENT
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Decode a UNI signalling message  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	msg	pointer to a signalling message structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
name|int
name|usf_dec_msg
parameter_list|(
name|usf
parameter_list|,
name|msg
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|unisig_msg
modifier|*
name|msg
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|short
name|s
decl_stmt|;
name|u_char
name|c
decl_stmt|,
modifier|*
name|ie_tbl
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
name|ATM_DEBUG2
argument_list|(
literal|"usf_dec_msg: usf=%p, msg=%p\n"
argument_list|,
name|usf
argument_list|,
name|msg
argument_list|)
expr_stmt|;
comment|/* 	 * Check the total message length 	 */
if|if
condition|(
name|usf_count
argument_list|(
name|usf
argument_list|)
operator|<
name|UNI_MSG_MIN_LEN
condition|)
block|{
return|return
operator|(
name|EIO
operator|)
return|;
block|}
comment|/* 	 * Get and check the protocol discriminator 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
if|if
condition|(
name|c
operator|!=
name|UNI_MSG_DISC_Q93B
condition|)
return|return
operator|(
name|EIO
operator|)
return|;
comment|/* 	 * Get and check the call reference length 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
if|if
condition|(
name|c
operator|!=
literal|3
condition|)
return|return
operator|(
name|EIO
operator|)
return|;
comment|/* 	 * Get the call reference 	 */
name|rc
operator|=
name|usf_int3
argument_list|(
name|usf
argument_list|,
operator|&
name|msg
operator|->
name|msg_call_ref
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Get the message type 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|msg
operator|->
name|msg_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Get the message type extension 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|msg
operator|->
name|msg_type_flag
operator|=
operator|(
name|c
operator|>>
name|UNI_MSG_TYPE_FLAG_SHIFT
operator|)
operator|&
name|UNI_MSG_TYPE_FLAG_MASK
expr_stmt|;
name|msg
operator|->
name|msg_type_action
operator|=
name|c
operator|&
name|UNI_MSG_TYPE_ACT_MASK
expr_stmt|;
comment|/* 	 * Get the message length and make sure we actually have 	 * enough data for the whole message 	 */
name|rc
operator|=
name|usf_short
argument_list|(
name|usf
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|msg
operator|->
name|msg_length
operator|=
name|s
expr_stmt|;
if|if
condition|(
name|usf_count
argument_list|(
name|usf
argument_list|)
operator|!=
name|msg
operator|->
name|msg_length
condition|)
block|{
return|return
operator|(
name|EMSGSIZE
operator|)
return|;
block|}
comment|/* 	 * Process information elements 	 */
name|len
operator|=
name|msg
operator|->
name|msg_length
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|ALLOC_IE
argument_list|(
name|ie
argument_list|)
expr_stmt|;
name|rc
operator|=
name|usf_dec_ie
argument_list|(
name|usf
argument_list|,
name|msg
argument_list|,
name|ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|atm_free
argument_list|(
name|ie
argument_list|)
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
name|len
operator|-=
operator|(
name|ie
operator|->
name|ie_length
operator|+
name|UNI_IE_HDR_LEN
operator|)
expr_stmt|;
block|}
comment|/* 	 * Make sure that mandatory IEs are included and 	 * unwanted ones aren't 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|msg
operator|->
name|msg_type
operator|!=
name|uni_msg_types
index|[
name|i
index|]
operator|.
name|msg_type
operator|&&
name|uni_msg_types
index|[
name|i
index|]
operator|.
name|msg_type
operator|!=
literal|0
condition|;
name|i
operator|++
control|)
block|{ 	}
if|if
condition|(
operator|!
name|uni_msg_types
index|[
name|i
index|]
operator|.
name|msg_ie_tbl
condition|)
goto|goto
name|done
goto|;
comment|/* 	 * If the message type is in the table, check the IEs. 	 * If it isn't, the receive routine will catch the error. 	 */
name|ie_tbl
operator|=
name|uni_msg_types
index|[
name|i
index|]
operator|.
name|msg_ie_tbl
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|UNI_MSG_IE_CNT
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
switch|switch
condition|(
name|ie_tbl
index|[
name|i
index|]
condition|)
block|{
case|case
name|IE_MAND
case|:
if|if
condition|(
operator|!
name|msg
operator|->
name|msg_ie_vec
index|[
name|i
index|]
condition|)
block|{
comment|/* 				 * Mandatory IE missing 				 */
name|ALLOC_IE
argument_list|(
name|ie
argument_list|)
expr_stmt|;
name|ie
operator|->
name|ie_ident
operator|=
name|unisig_ie_ident_vec
index|[
name|i
index|]
expr_stmt|;
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_MISSING
expr_stmt|;
name|MSG_IE_ADD
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|UNI_MSG_IE_ERR
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IE_NA
case|:
if|if
condition|(
name|msg
operator|->
name|msg_ie_vec
index|[
name|i
index|]
condition|)
block|{
comment|/* 				 * Disallowed IE present 				 */
name|ie
operator|=
name|msg
operator|->
name|msg_ie_vec
index|[
name|i
index|]
expr_stmt|;
name|msg
operator|->
name|msg_ie_vec
index|[
name|i
index|]
operator|=
operator|(
expr|struct
name|ie_generic
operator|*
operator|)
literal|0
expr_stmt|;
name|MSG_IE_ADD
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|UNI_MSG_IE_ERR
argument_list|)
expr_stmt|;
while|while
condition|(
name|ie
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IEEXIST
expr_stmt|;
name|ie
operator|=
name|ie
operator|->
name|ie_next
expr_stmt|;
block|}
block|}
break|break;
case|case
name|IE_OPT
case|:
break|break;
block|}
block|}
name|done
label|:
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode an information element  *  * This routine will be called repeatedly as long as there are  * information elements left to be decoded.  It will decode the  * first part of the IE, look its type up in a table, and call  * the appropriate routine to decode the rest.  After an IE is  * successfully decoded, it is linked into the UNI signalling  * message structure.  If an error is discovered, the IE is linked  * into the IE error chain and an error cause is set in the header.  *  * Arguments:  *	usf	pointer to a UNISIG formatting structure  *	msg	pointer to a UNISIG message structure  *	ie	pointer to a generic IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie
parameter_list|(
name|usf
parameter_list|,
name|msg
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|unisig_msg
modifier|*
name|msg
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|ie_index
decl_stmt|,
name|rc
decl_stmt|;
comment|/* 	 * Decode the IE header (identifier, instruction field, 	 * and length) 	 */
name|rc
operator|=
name|usf_dec_ie_hdr
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Ignore the IE if it is of zero length. 	 */
if|if
condition|(
operator|!
name|ie
operator|->
name|ie_length
condition|)
block|{
name|atm_free
argument_list|(
name|ie
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * Look up the information element in the table 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|ie
operator|->
name|ie_ident
operator|!=
name|ie_table
index|[
name|i
index|]
operator|.
name|ident
operator|)
operator|&&
operator|(
name|ie_table
index|[
name|i
index|]
operator|.
name|decode
operator|!=
name|NULL
operator|)
condition|;
name|i
operator|++
control|)
block|{ 	}
if|if
condition|(
name|ie_table
index|[
name|i
index|]
operator|.
name|decode
operator|==
name|NULL
condition|)
block|{
comment|/* 		 * Unrecognized IE 		 */
name|ie_index
operator|=
name|UNI_MSG_IE_ERR
expr_stmt|;
block|}
else|else
block|{
name|ie_index
operator|=
name|ie_table
index|[
name|i
index|]
operator|.
name|p_idx
expr_stmt|;
block|}
comment|/* 	 * Check for unimplemented or unrecognized IEs 	 */
if|if
condition|(
name|ie_index
operator|==
name|UNI_MSG_IE_ERR
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IEEXIST
expr_stmt|;
comment|/* 		 * Skip over the invalid IE 		 */
name|rc
operator|=
name|usf_dec_ie_uimp
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
goto|goto
name|done
goto|;
block|}
comment|/* 	 * Check the length against the IE table 	 */
if|if
condition|(
name|ie
operator|->
name|ie_length
operator|<
name|ie_table
index|[
name|i
index|]
operator|.
name|min_len
operator|||
name|ie
operator|->
name|ie_length
operator|>
name|ie_table
index|[
name|i
index|]
operator|.
name|max_len
condition|)
block|{
name|ie_index
operator|=
name|UNI_MSG_IE_ERR
expr_stmt|;
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
comment|/* 		 * Skip over the invalid IE 		 */
name|rc
operator|=
name|usf_dec_ie_uimp
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
goto|goto
name|done
goto|;
block|}
comment|/* 	 * Process the IE by calling the function indicated 	 * in the IE table 	 */
name|rc
operator|=
name|ie_table
index|[
name|i
index|]
operator|.
name|decode
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Link the IE into the signalling message 	 */
name|done
label|:
if|if
condition|(
name|ie
operator|->
name|ie_err_cause
condition|)
block|{
name|ie_index
operator|=
name|UNI_MSG_IE_ERR
expr_stmt|;
block|}
name|MSG_IE_ADD
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|ie_index
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode an information element header  *  * Arguments:  *	usf	pointer to a UNISIG formatting structure  *	ie	pointer to a generic IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_hdr
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|u_char
name|c
decl_stmt|;
name|short
name|s
decl_stmt|;
name|int
name|rc
decl_stmt|;
comment|/* 	 * Get the IE identifier 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_ident
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Get the extended type 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_coding
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_CODE_SHIFT
operator|)
operator|&
name|UNI_IE_CODE_MASK
expr_stmt|;
name|ie
operator|->
name|ie_flag
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_FLAG_SHIFT
operator|)
operator|&
name|UNI_IE_FLAG_MASK
expr_stmt|;
name|ie
operator|->
name|ie_action
operator|=
name|c
operator|&
name|UNI_IE_ACT_MASK
expr_stmt|;
comment|/* 	 * Get the length. 	 */
name|rc
operator|=
name|usf_short
argument_list|(
name|usf
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_length
operator|=
name|s
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode an AAL parameters information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to an AAL parms IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_aalp
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|rc
init|=
literal|0
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_aalp_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_aalp
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_aalp_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the AAL type 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_aalp_aal_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Subtract the length of the AAL type from the total. 	 * It will be readjusted after usf_dec_ie_ident is finished. 	 */
name|ie
operator|->
name|ie_length
operator|--
expr_stmt|;
comment|/* 	 * Process based on AAL type 	 */
switch|switch
condition|(
name|ie
operator|->
name|ie_aalp_aal_type
condition|)
block|{
case|case
name|UNI_IE_AALP_AT_AAL1
case|:
comment|/* 		 * Clear the AAL 1 subparameters 		 */
name|ie
operator|->
name|ie_aalp_1_subtype
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_1_cbr_rate
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_1_multiplier
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_1_clock_recovery
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_1_error_correction
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_1_struct_data_tran
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_1_partial_cells
operator|=
name|T_ATM_ABSENT
expr_stmt|;
comment|/* 		 * Parse the AAL fields based on their IDs 		 */
name|rc
operator|=
name|usf_dec_ie_ident
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|,
name|ie_aal1_tbl
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_IE_AALP_AT_AAL3
case|:
comment|/* 		 * Clear the AAL 3/4 subparameters 		 */
name|ie
operator|->
name|ie_aalp_4_fwd_max_sdu
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_4_bkwd_max_sdu
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_4_mid_range
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_4_mode
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_4_sscs_type
operator|=
name|T_ATM_ABSENT
expr_stmt|;
comment|/* 		 * Parse the AAL fields based on their IDs 		 */
if|if
condition|(
name|usf
operator|->
name|usf_sig
operator|->
name|us_proto
operator|==
name|ATM_SIG_UNI30
condition|)
name|rc
operator|=
name|usf_dec_ie_ident
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|,
name|ie_aal4_tbl_30
argument_list|)
expr_stmt|;
else|else
name|rc
operator|=
name|usf_dec_ie_ident
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|,
name|ie_aal4_tbl_31
argument_list|)
expr_stmt|;
comment|/* 		 * If either forward or backward maximum SDU 		 * size is specified, the other must also be 		 * specified. 		 */
if|if
condition|(
operator|(
name|ie
operator|->
name|ie_aalp_4_fwd_max_sdu
operator|!=
name|T_ATM_ABSENT
operator|&&
name|ie
operator|->
name|ie_aalp_4_bkwd_max_sdu
operator|==
name|T_ATM_ABSENT
operator|)
operator|||
operator|(
name|ie
operator|->
name|ie_aalp_4_fwd_max_sdu
operator|==
name|T_ATM_ABSENT
operator|&&
name|ie
operator|->
name|ie_aalp_4_bkwd_max_sdu
operator|!=
name|T_ATM_ABSENT
operator|)
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
block|}
break|break;
case|case
name|UNI_IE_AALP_AT_AAL5
case|:
comment|/* 		 * Clear the AAL 5 subparameters 		 */
name|ie
operator|->
name|ie_aalp_5_fwd_max_sdu
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_5_bkwd_max_sdu
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_5_mode
operator|=
name|T_ATM_ABSENT
expr_stmt|;
name|ie
operator|->
name|ie_aalp_5_sscs_type
operator|=
name|T_ATM_ABSENT
expr_stmt|;
comment|/* 		 * Parse the AAL fields based on their IDs 		 */
if|if
condition|(
name|usf
operator|->
name|usf_sig
operator|->
name|us_proto
operator|==
name|ATM_SIG_UNI30
condition|)
name|rc
operator|=
name|usf_dec_ie_ident
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|,
name|ie_aal5_tbl_30
argument_list|)
expr_stmt|;
else|else
name|rc
operator|=
name|usf_dec_ie_ident
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|,
name|ie_aal5_tbl_31
argument_list|)
expr_stmt|;
comment|/* 		 * If either forward or backward maximum SDU 		 * size is specified, the other must also be 		 * specified. 		 */
if|if
condition|(
operator|(
name|ie
operator|->
name|ie_aalp_5_fwd_max_sdu
operator|!=
name|T_ATM_ABSENT
operator|&&
name|ie
operator|->
name|ie_aalp_5_bkwd_max_sdu
operator|==
name|T_ATM_ABSENT
operator|)
operator|||
operator|(
name|ie
operator|->
name|ie_aalp_5_fwd_max_sdu
operator|==
name|T_ATM_ABSENT
operator|&&
name|ie
operator|->
name|ie_aalp_5_bkwd_max_sdu
operator|!=
name|T_ATM_ABSENT
operator|)
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
block|}
break|break;
case|case
name|UNI_IE_AALP_AT_AALU
case|:
comment|/* 		 * Check user parameter length 		 */
if|if
condition|(
name|ie
operator|->
name|ie_length
operator|>
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|ie_aalp_user_info
argument_list|)
operator|+
literal|1
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
block|}
comment|/* 		 * Get the user data 		 */
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|ie
operator|->
name|ie_length
operator|-
literal|2
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_aalp_user_info
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
break|break;
name|i
operator|++
expr_stmt|;
block|}
break|break;
default|default:
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
block|}
name|ie
operator|->
name|ie_length
operator|++
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a user cell rate information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_clrt
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_clrt_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_clrt
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_clrt_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Parse the IE using field identifiers 	 */
name|rc
operator|=
name|usf_dec_ie_ident
argument_list|(
name|usf
argument_list|,
name|ie
argument_list|,
name|ie_clrt_tbl
argument_list|)
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a broadband bearer capability information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_bbcp
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_bbcp_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_bbcp
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_bbcp_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the broadband bearer class 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_bbcp_bearer_class
operator|=
name|c
operator|&
name|UNI_IE_BBCP_BC_MASK
expr_stmt|;
comment|/* 	 * If the broadband bearer class was X, the next 	 * byte has the traffic type and timing requirements 	 */
if|if
condition|(
name|ie
operator|->
name|ie_bbcp_bearer_class
operator|==
name|UNI_IE_BBCP_BC_BCOB_X
operator|&&
operator|!
operator|(
name|c
operator|&
name|UNI_IE_EXT_BIT
operator|)
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_bbcp_traffic_type
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_BBCP_TT_SHIFT
operator|)
operator|&
name|UNI_IE_BBCP_TT_MASK
expr_stmt|;
name|ie
operator|->
name|ie_bbcp_timing_req
operator|=
name|c
operator|&
name|UNI_IE_BBCP_TR_MASK
expr_stmt|;
block|}
comment|/* 	 * Get the clipping and user plane connection configuration 	 */
if|if
condition|(
name|c
operator|&
name|UNI_IE_EXT_BIT
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_bbcp_clipping
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_BBCP_SC_SHIFT
operator|)
operator|&
name|UNI_IE_BBCP_SC_MASK
expr_stmt|;
name|ie
operator|->
name|ie_bbcp_conn_config
operator|=
name|c
operator|&
name|UNI_IE_BBCP_CC_MASK
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a broadband high layer information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_bhli
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_bhli_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_bhli
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_bhli_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the high layer information type 	 */
name|rc
operator|=
name|usf_ext
argument_list|(
name|usf
argument_list|,
operator|&
name|i
argument_list|)
expr_stmt|;
name|ie
operator|->
name|ie_bhli_type
operator|=
name|i
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * What comes next depends on the type 	 */
switch|switch
condition|(
name|ie
operator|->
name|ie_bhli_type
condition|)
block|{
case|case
name|UNI_IE_BHLI_TYPE_ISO
case|:
case|case
name|UNI_IE_BHLI_TYPE_USER
case|:
comment|/* 		 * ISO or user-specified parameters -- take the 		 * length of information from the IE length 		 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|ie_length
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_bhli_info
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
break|break;
case|case
name|UNI_IE_BHLI_TYPE_HLP
case|:
comment|/* 		 * Make sure the IE is long enough for the high 		 * layer profile information, then get it 		 */
if|if
condition|(
name|usf
operator|->
name|usf_sig
operator|->
name|us_proto
operator|!=
name|ATM_SIG_UNI30
condition|)
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|ie_length
operator|<
name|UNI_IE_BHLI_HLP_LEN
operator|+
literal|1
condition|)
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|ie_length
operator|&&
name|i
operator|<
name|UNI_IE_BHLI_HLP_LEN
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_bhli_info
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
break|break;
case|case
name|UNI_IE_BHLI_TYPE_VSA
case|:
comment|/* 		 * Make sure the IE is long enough for the vendor- 		 * specific application information, then get it 		 */
if|if
condition|(
name|ie
operator|->
name|ie_length
operator|<
name|UNI_IE_BHLI_VSA_LEN
operator|+
literal|1
condition|)
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|ie_length
operator|&&
name|i
operator|<
name|UNI_IE_BHLI_VSA_LEN
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_bhli_info
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
break|break;
default|default:
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|ie_length
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a broadband low layer information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_blli
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|u_char
name|c
decl_stmt|,
name|id
decl_stmt|;
name|int
name|bc
decl_stmt|,
name|i
decl_stmt|,
name|rc
decl_stmt|;
name|u_int
name|ipi
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_blli_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_blli
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_blli_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get paramteters for the protocol layers as long as 	 * there is still information left in the IE 	 */
name|bc
operator|=
name|ie
operator|->
name|ie_length
expr_stmt|;
while|while
condition|(
name|bc
condition|)
block|{
comment|/* 		 * Get the type and process based on what it is 		 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
switch|switch
condition|(
operator|(
operator|(
name|id
operator|&
name|UNI_IE_EXT_MASK
operator|)
operator|>>
name|UNI_IE_BLLI_LID_SHIFT
operator|)
operator|&
name|UNI_IE_BLLI_LID_MASK
condition|)
block|{
case|case
name|UNI_IE_BLLI_L1_ID
case|:
comment|/* 			 * Layer 1 info 			 */
name|ie
operator|->
name|ie_blli_l1_id
operator|=
name|id
operator|&
name|UNI_IE_BLLI_LP_MASK
expr_stmt|;
name|bc
operator|--
expr_stmt|;
break|break;
case|case
name|UNI_IE_BLLI_L2_ID
case|:
comment|/* 			 * Layer 2 info--contents vary based on type 			 */
name|ie
operator|->
name|ie_blli_l2_id
operator|=
name|id
operator|&
name|UNI_IE_BLLI_LP_MASK
expr_stmt|;
name|bc
operator|--
expr_stmt|;
if|if
condition|(
name|id
operator|&
name|UNI_IE_EXT_BIT
condition|)
break|break;
switch|switch
condition|(
name|ie
operator|->
name|ie_blli_l2_id
condition|)
block|{
case|case
name|UNI_IE_BLLI_L2P_X25L
case|:
case|case
name|UNI_IE_BLLI_L2P_X25M
case|:
case|case
name|UNI_IE_BLLI_L2P_HDLC1
case|:
case|case
name|UNI_IE_BLLI_L2P_HDLC2
case|:
case|case
name|UNI_IE_BLLI_L2P_HDLC3
case|:
case|case
name|UNI_IE_BLLI_L2P_Q922
case|:
case|case
name|UNI_IE_BLLI_L2P_ISO7776
case|:
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l2_mode
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_BLLI_L2MODE_SHIFT
operator|)
operator|&
name|UNI_IE_BLLI_L2MODE_MASK
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
name|UNI_IE_EXT_BIT
operator|)
condition|)
break|break;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l2_window
operator|=
name|c
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
break|break;
case|case
name|UNI_IE_BLLI_L2P_USER
case|:
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l2_user_proto
operator|=
name|c
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|UNI_IE_BLLI_L3_ID
case|:
comment|/* 			 * Layer 3 info--contents vary based on type 			 */
name|ie
operator|->
name|ie_blli_l3_id
operator|=
name|id
operator|&
name|UNI_IE_BLLI_LP_MASK
expr_stmt|;
name|bc
operator|--
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|ie_blli_l3_id
condition|)
block|{
case|case
name|UNI_IE_BLLI_L3P_X25
case|:
case|case
name|UNI_IE_BLLI_L3P_ISO8208
case|:
case|case
name|UNI_IE_BLLI_L3P_ISO8878
case|:
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l3_mode
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_BLLI_L3MODE_SHIFT
operator|)
operator|&
name|UNI_IE_BLLI_L3MODE_MASK
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
name|UNI_IE_EXT_BIT
operator|)
condition|)
break|break;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l3_packet_size
operator|=
name|c
operator|&
name|UNI_IE_BLLI_L3PS_MASK
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
name|UNI_IE_EXT_BIT
operator|)
condition|)
break|break;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l3_window
operator|=
name|c
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
break|break;
case|case
name|UNI_IE_BLLI_L3P_USER
case|:
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_blli_l3_mode
operator|=
name|c
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
break|break;
case|case
name|UNI_IE_BLLI_L3P_ISO9577
case|:
name|rc
operator|=
name|usf_ext
argument_list|(
name|usf
argument_list|,
operator|&
name|ipi
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|-=
literal|2
expr_stmt|;
name|ie
operator|->
name|ie_blli_l3_ipi
operator|=
name|ipi
operator|>>
name|UNI_IE_BLLI_L3IPI_SHIFT
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|ie_blli_l3_ipi
operator|!=
name|UNI_IE_BLLI_L3IPI_SNAP
condition|)
break|break;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
name|ie
operator|->
name|ie_blli_l3_snap_id
operator|=
name|c
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|--
expr_stmt|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_blli_l3_oui
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_blli_l3_oui
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_blli_l3_oui
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_blli_l3_pid
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_blli_l3_pid
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|bc
operator|-=
literal|5
expr_stmt|;
break|break;
block|}
break|break;
default|default:
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|ie_length
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a call state information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_clst
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_clst_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_clst
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_clst_absent
argument_list|)
argument_list|)
expr_stmt|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_clst_state
operator|=
name|c
operator|&
name|UNI_IE_CLST_STATE_MASK
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a called party number information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_cdad
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_cdad_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_cdad
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_cdad_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get and check the numbering plan 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_cdad_plan
operator|=
name|c
operator|&
name|UNI_IE_CDAD_PLAN_MASK
expr_stmt|;
name|len
operator|=
name|ie
operator|->
name|ie_length
operator|-
literal|1
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|ie_cdad_plan
condition|)
block|{
case|case
name|UNI_IE_CDAD_PLAN_E164
case|:
name|ie
operator|->
name|ie_cdad_addr
operator|.
name|address_format
operator|=
name|T_ATM_E164_ADDR
expr_stmt|;
break|break;
case|case
name|UNI_IE_CDAD_PLAN_NSAP
case|:
name|ie
operator|->
name|ie_cdad_addr
operator|.
name|address_format
operator|=
name|T_ATM_ENDSYS_ADDR
expr_stmt|;
break|break;
default|default:
comment|/* 		 * Invalid numbering plan 		 */
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * Get the ATM address 	 */
name|rc
operator|=
name|usf_dec_atm_addr
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_cdad_addr
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|==
name|EINVAL
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
name|rc
operator|=
literal|0
expr_stmt|;
block|}
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a called party subaddress information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_cdsa
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_cdsa_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_cdsa
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_cdsa_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get and check the subaddress type 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|=
name|ie
operator|->
name|ie_length
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|c
operator|>>
name|UNI_IE_CDSA_TYPE_SHIFT
operator|)
operator|&
name|UNI_IE_CDSA_TYPE_MASK
operator|)
operator|!=
name|UNI_IE_CDSA_TYPE_AESA
condition|)
block|{
comment|/* 		 * Invalid subaddress type 		 */
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * Get the ATM address 	 */
name|ie
operator|->
name|ie_cdsa_addr
operator|.
name|address_format
operator|=
name|T_ATM_ENDSYS_ADDR
expr_stmt|;
name|rc
operator|=
name|usf_dec_atm_addr
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_cdsa_addr
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|==
name|EINVAL
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
name|rc
operator|=
literal|0
expr_stmt|;
block|}
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a calling party number information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_cgad
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_cgad_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_cgad
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_cgad_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get and check the numbering plan 	 */
name|len
operator|=
name|ie
operator|->
name|ie_length
expr_stmt|;
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_cgad_type
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_CGAD_TYPE_SHIFT
operator|)
operator|&
name|UNI_IE_CGAD_TYPE_MASK
expr_stmt|;
name|ie
operator|->
name|ie_cgad_plan
operator|=
name|c
operator|&
name|UNI_IE_CGAD_PLAN_MASK
expr_stmt|;
name|len
operator|--
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|ie_cgad_plan
condition|)
block|{
case|case
name|UNI_IE_CGAD_PLAN_E164
case|:
name|ie
operator|->
name|ie_cgad_addr
operator|.
name|address_format
operator|=
name|T_ATM_E164_ADDR
expr_stmt|;
break|break;
case|case
name|UNI_IE_CGAD_PLAN_NSAP
case|:
name|ie
operator|->
name|ie_cgad_addr
operator|.
name|address_format
operator|=
name|T_ATM_ENDSYS_ADDR
expr_stmt|;
break|break;
default|default:
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * Get the presentation and screening indicators, if present 	 */
if|if
condition|(
operator|!
operator|(
name|c
operator|&
name|UNI_IE_EXT_BIT
operator|)
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
name|ie
operator|->
name|ie_cgad_pres_ind
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_CGAD_PRES_SHIFT
operator|)
operator|&
name|UNI_IE_CGAD_PRES_MASK
expr_stmt|;
name|ie
operator|->
name|ie_cgad_screen_ind
operator|=
name|c
operator|&
name|UNI_IE_CGAD_SCR_MASK
expr_stmt|;
block|}
else|else
block|{
name|ie
operator|->
name|ie_cgad_pres_ind
operator|=
literal|0
expr_stmt|;
name|ie
operator|->
name|ie_cgad_screen_ind
operator|=
literal|0
expr_stmt|;
block|}
comment|/* 	 * Get the ATM address 	 */
name|rc
operator|=
name|usf_dec_atm_addr
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_cgad_addr
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|==
name|EINVAL
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
name|rc
operator|=
literal|0
expr_stmt|;
block|}
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a calling party subaddress information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_cgsa
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_cgsa_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_cgsa
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_cgsa_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get and check the subaddress type 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|=
name|ie
operator|->
name|ie_length
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|c
operator|>>
name|UNI_IE_CGSA_TYPE_SHIFT
operator|)
operator|&
name|UNI_IE_CGSA_TYPE_MASK
operator|)
operator|!=
name|UNI_IE_CGSA_TYPE_AESA
condition|)
block|{
comment|/* 		 * Invalid subaddress type 		 */
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * Get the ATM address 	 */
name|ie
operator|->
name|ie_cgsa_addr
operator|.
name|address_format
operator|=
name|T_ATM_ENDSYS_ADDR
expr_stmt|;
name|rc
operator|=
name|usf_dec_atm_addr
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_cgsa_addr
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|==
name|EINVAL
condition|)
block|{
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
name|rc
operator|=
literal|0
expr_stmt|;
block|}
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a cause information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_caus
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_caus_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_caus
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_caus_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the cause location 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_caus_loc
operator|=
name|c
operator|&
name|UNI_IE_CAUS_LOC_MASK
expr_stmt|;
comment|/* 	 * Get the cause value 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_caus_cause
operator|=
name|c
operator|&
name|UNI_IE_EXT_MASK
expr_stmt|;
comment|/* 	 * Get any included diagnostics 	 */
name|len
operator|=
name|ie
operator|->
name|ie_length
operator|-
literal|2
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|ie
operator|->
name|ie_caus_diag_len
operator|=
literal|0
init|;
name|len
operator|&&
name|i
operator|<
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|ie_caus_diagnostic
argument_list|)
condition|;
name|len
operator|--
operator|,
name|i
operator|++
operator|,
name|ie
operator|->
name|ie_caus_diag_len
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_caus_diagnostic
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a conection identifier information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_cnid
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|rc
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_cnid_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_cnid
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_cnid_absent
argument_list|)
argument_list|)
expr_stmt|;
name|rc
operator|=
name|usf_ext
argument_list|(
name|usf
argument_list|,
operator|&
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_cnid_vp_sig
operator|=
operator|(
name|i
operator|>>
name|UNI_IE_CNID_VPSIG_SHIFT
operator|)
operator|&
name|UNI_IE_CNID_VPSIG_MASK
expr_stmt|;
name|ie
operator|->
name|ie_cnid_pref_excl
operator|=
name|i
operator|&
name|UNI_IE_CNID_PREX_MASK
expr_stmt|;
name|rc
operator|=
name|usf_short
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_cnid_vpci
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|rc
operator|=
name|usf_short
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_cnid_vci
argument_list|)
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a quality of service parameters information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_qosp
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_qosp_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_qosp
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_qosp_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get forward QoS class 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_qosp_fwd_class
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Get backward QoS class 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_qosp_bkwd_class
argument_list|)
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a broadband repeat indicator information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_brpi
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_brpi_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_brpi
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_brpi_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the repeat indicator 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_brpi_ind
operator|=
name|c
operator|&
name|UNI_IE_BRPI_IND_MASK
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a restart indicator information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_rsti
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_rsti_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_rsti
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_rsti_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the restart class 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_rsti_class
operator|=
name|c
operator|&
name|UNI_IE_RSTI_CLASS_MASK
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a broadband sending complete information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a broadband sending complete IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_bsdc
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_bsdc_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_bsdc
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_bsdc_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the sending complete indicator 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
comment|/* 	 * Validate the indicator 	 */
name|c
operator|&=
name|UNI_IE_EXT_MASK
expr_stmt|;
if|if
condition|(
name|c
operator|!=
name|UNI_IE_BSDC_IND
condition|)
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
name|ie
operator|->
name|ie_bsdc_ind
operator|=
name|c
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a transit network selection information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a transit network selection IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_trnt
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Clear the IE 	 */
name|KM_COPY
argument_list|(
operator|&
name|ie_trnt_absent
argument_list|,
operator|&
name|ie
operator|->
name|ie_u
operator|.
name|ie_trnt
argument_list|,
sizeof|sizeof
argument_list|(
name|ie_trnt_absent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the network ID type and plan 	 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|ie
operator|->
name|ie_trnt_id_type
operator|=
operator|(
name|c
operator|>>
name|UNI_IE_TRNT_IDT_SHIFT
operator|)
operator|&
name|UNI_IE_TRNT_IDT_MASK
expr_stmt|;
name|ie
operator|->
name|ie_trnt_id_plan
operator|=
name|c
operator|&
name|UNI_IE_TRNT_IDP_MASK
expr_stmt|;
comment|/* 	 * Get the length of the network ID 	 */
name|len
operator|=
name|ie
operator|->
name|ie_length
operator|-
literal|1
expr_stmt|;
name|ie
operator|->
name|ie_trnt_id_len
operator|=
name|MIN
argument_list|(
name|len
argument_list|,
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|ie_trnt_id
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Get the network ID 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|<
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|ie_trnt_id
argument_list|)
condition|)
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|ie
operator|->
name|ie_trnt_id
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode an unimplemented information element  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_uimp
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
comment|/* 	 * Skip over the IE contents 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|ie_length
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode an information element using field identifiers  *  * The AAL parameters and ATM user cell rate IEs are formatted  * with a one-byte identifier preceeding each field.  The routine  * parses these IEs by using a table which relates the field  * identifiers with the fields in the appropriate IE structure.  * Field order in the received message is immaterial.  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	ie	pointer to a cell rate IE structure  *	tbl	pointer to an IE decoding table  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_ie_ident
parameter_list|(
name|usf
parameter_list|,
name|ie
parameter_list|,
name|tbl
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|struct
name|ie_generic
modifier|*
name|ie
decl_stmt|;
name|struct
name|ie_decode_tbl
modifier|*
name|tbl
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|len
decl_stmt|,
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|;
name|u_int8_t
name|cv
decl_stmt|;
name|u_int16_t
name|sv
decl_stmt|;
name|u_int32_t
name|iv
decl_stmt|;
name|void
modifier|*
name|dest
decl_stmt|;
comment|/* 	 * Scan through the IE 	 */
name|len
operator|=
name|ie
operator|->
name|ie_length
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
comment|/* 		 * Get the field identifier 		 */
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
comment|/* 		 * Look up the field in the table 		 */
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|tbl
index|[
name|i
index|]
operator|.
name|ident
operator|!=
name|c
operator|)
operator|&&
name|tbl
index|[
name|i
index|]
operator|.
name|len
condition|;
name|i
operator|++
control|)
block|{ 		}
if|if
condition|(
name|tbl
index|[
name|i
index|]
operator|.
name|ident
operator|==
literal|0
condition|)
block|{
comment|/* 			 * Bad subfield identifier -- flag an 			 * error and skip over the rest of the IE 			 */
name|ie
operator|->
name|ie_err_cause
operator|=
name|UNI_IE_CAUS_IECONTENT
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 		 * Save final destination address 		 */
name|dest
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|int
operator|)
name|ie
operator|+
name|tbl
index|[
name|i
index|]
operator|.
name|f_offs
operator|)
expr_stmt|;
comment|/* 		 * Get the field value 		 */
switch|switch
condition|(
name|tbl
index|[
name|i
index|]
operator|.
name|len
condition|)
block|{
case|case
literal|0
case|:
name|cv
operator|=
literal|1
expr_stmt|;
goto|goto
name|savec
goto|;
case|case
literal|1
case|:
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|cv
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
break|break;
name|savec
label|:
comment|/* 				 * Save field value 				 */
switch|switch
condition|(
name|tbl
index|[
name|i
index|]
operator|.
name|f_size
condition|)
block|{
case|case
literal|1
case|:
operator|*
operator|(
name|u_int8_t
operator|*
operator|)
name|dest
operator|=
name|cv
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|*
operator|(
name|u_int16_t
operator|*
operator|)
name|dest
operator|=
name|cv
expr_stmt|;
break|break;
case|case
literal|4
case|:
operator|*
operator|(
name|u_int32_t
operator|*
operator|)
name|dest
operator|=
name|cv
expr_stmt|;
break|break;
default|default:
goto|goto
name|badtbl
goto|;
block|}
break|break;
case|case
literal|2
case|:
name|rc
operator|=
name|usf_short
argument_list|(
name|usf
argument_list|,
operator|&
name|sv
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
break|break;
comment|/* 				 * Save field value 				 */
switch|switch
condition|(
name|tbl
index|[
name|i
index|]
operator|.
name|f_size
condition|)
block|{
case|case
literal|2
case|:
operator|*
operator|(
name|u_int16_t
operator|*
operator|)
name|dest
operator|=
name|sv
expr_stmt|;
break|break;
case|case
literal|4
case|:
operator|*
operator|(
name|u_int32_t
operator|*
operator|)
name|dest
operator|=
name|sv
expr_stmt|;
break|break;
default|default:
goto|goto
name|badtbl
goto|;
block|}
break|break;
case|case
literal|3
case|:
name|rc
operator|=
name|usf_int3
argument_list|(
name|usf
argument_list|,
operator|&
name|iv
argument_list|)
expr_stmt|;
goto|goto
name|savei
goto|;
case|case
literal|4
case|:
name|rc
operator|=
name|usf_int
argument_list|(
name|usf
argument_list|,
operator|&
name|iv
argument_list|)
expr_stmt|;
name|savei
label|:
comment|/* 				 * Save field value 				 */
if|if
condition|(
name|rc
condition|)
break|break;
switch|switch
condition|(
name|tbl
index|[
name|i
index|]
operator|.
name|f_size
condition|)
block|{
case|case
literal|4
case|:
operator|*
operator|(
name|u_int32_t
operator|*
operator|)
name|dest
operator|=
name|iv
expr_stmt|;
break|break;
default|default:
goto|goto
name|badtbl
goto|;
block|}
break|break;
default|default:
name|badtbl
label|:
name|log
argument_list|(
name|LOG_ERR
argument_list|,
literal|"uni decode: id=%d,len=%d,off=%d,size=%d\n"
argument_list|,
name|tbl
index|[
name|i
index|]
operator|.
name|ident
argument_list|,
name|tbl
index|[
name|i
index|]
operator|.
name|len
argument_list|,
name|tbl
index|[
name|i
index|]
operator|.
name|f_offs
argument_list|,
name|tbl
index|[
name|i
index|]
operator|.
name|f_size
argument_list|)
expr_stmt|;
name|rc
operator|=
name|EFAULT
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|-=
name|tbl
index|[
name|i
index|]
operator|.
name|len
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode an ATM address  *  * Arguments:  *	usf	pointer to a unisig formatting structure  *	addr	pointer to an ATM address structure  *	len	length of data remainig in the IE  *  * Returns:  *	0	success  *	errno	error encountered  *  */
end_comment

begin_function
specifier|static
name|int
name|usf_dec_atm_addr
parameter_list|(
name|usf
parameter_list|,
name|addr
parameter_list|,
name|len
parameter_list|)
name|struct
name|usfmt
modifier|*
name|usf
decl_stmt|;
name|Atm_addr
modifier|*
name|addr
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|int
name|rc
decl_stmt|;
name|u_char
name|c
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
comment|/* 	 * Check the address type 	 */
name|addr
operator|->
name|address_length
operator|=
name|len
expr_stmt|;
switch|switch
condition|(
name|addr
operator|->
name|address_format
condition|)
block|{
case|case
name|T_ATM_E164_ADDR
case|:
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|Atm_addr_e164
argument_list|)
condition|)
block|{
goto|goto
name|flush
goto|;
block|}
name|cp
operator|=
operator|(
name|u_char
operator|*
operator|)
name|addr
operator|->
name|address
expr_stmt|;
break|break;
case|case
name|T_ATM_ENDSYS_ADDR
case|:
if|if
condition|(
name|len
operator|!=
sizeof|sizeof
argument_list|(
name|Atm_addr_nsap
argument_list|)
condition|)
block|{
goto|goto
name|flush
goto|;
block|}
name|cp
operator|=
operator|(
name|u_char
operator|*
operator|)
name|addr
operator|->
name|address
expr_stmt|;
break|break;
default|default:
comment|/* Silence the compiler */
name|cp
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* 	 * Get the ATM address 	 */
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
name|cp
operator|++
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
name|flush
label|:
while|while
condition|(
name|len
condition|)
block|{
name|rc
operator|=
name|usf_byte
argument_list|(
name|usf
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
return|return
operator|(
name|rc
operator|)
return|;
name|len
operator|--
expr_stmt|;
block|}
return|return
operator|(
name|EINVAL
operator|)
return|;
block|}
end_function

end_unit

