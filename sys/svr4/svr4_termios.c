begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1998 Mark Newton  * Copyright (c) 1994 Christos Zoulas  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of the author may not be used to endorse or promote products  *    derived from this software without specific prior written permission  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *   * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/proc.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<sys/filedesc.h>
end_include

begin_include
include|#
directive|include
file|<sys/termios.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysproto.h>
end_include

begin_include
include|#
directive|include
file|<svr4/svr4.h>
end_include

begin_include
include|#
directive|include
file|<svr4/svr4_util.h>
end_include

begin_include
include|#
directive|include
file|<svr4/svr4_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<svr4/svr4_termios.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|__CONCAT3
end_ifndef

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|__CONCAT3
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|)
value|a ## b ## c
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|__CONCAT3
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|)
value|a
comment|/**/
value|b
comment|/**/
value|c
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|u_long
name|bsd_to_svr4_speed
name|__P
argument_list|(
operator|(
name|u_long
operator|,
name|u_long
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_long
name|svr4_to_bsd_speed
name|__P
argument_list|(
operator|(
name|u_long
operator|,
name|u_long
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|svr4_to_bsd_termios
name|__P
argument_list|(
operator|(
specifier|const
expr|struct
name|svr4_termios
operator|*
operator|,
expr|struct
name|termios
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|bsd_to_svr4_termios
name|__P
argument_list|(
operator|(
specifier|const
expr|struct
name|termios
operator|*
operator|,
expr|struct
name|svr4_termios
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|svr4_termio_to_termios
name|__P
argument_list|(
operator|(
specifier|const
expr|struct
name|svr4_termio
operator|*
operator|,
expr|struct
name|svr4_termios
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|svr4_termios_to_termio
name|__P
argument_list|(
operator|(
specifier|const
expr|struct
name|svr4_termios
operator|*
operator|,
expr|struct
name|svr4_termio
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG_SVR4
end_ifdef

begin_decl_stmt
specifier|static
name|void
name|print_svr4_termios
name|__P
argument_list|(
operator|(
specifier|const
expr|struct
name|svr4_termios
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|print_bsd_termios
name|__P
argument_list|(
operator|(
specifier|const
expr|struct
name|termios
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEBUG_SVR4 */
end_comment

begin_define
define|#
directive|define
name|undefined_char
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
end_define

begin_comment
comment|/**/
end_comment

begin_define
define|#
directive|define
name|undefined_flag1
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|)
end_define

begin_comment
comment|/**/
end_comment

begin_define
define|#
directive|define
name|undefined_flag2
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c1
parameter_list|,
name|t1
parameter_list|,
name|c2
parameter_list|,
name|t2
parameter_list|)
end_define

begin_comment
comment|/**/
end_comment

begin_define
define|#
directive|define
name|undefined_flag4
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c1
parameter_list|,
name|t1
parameter_list|,
name|c2
parameter_list|,
name|t2
parameter_list|,
name|c3
parameter_list|,
name|t3
parameter_list|,
name|c4
parameter_list|,
name|t4
parameter_list|)
end_define

begin_comment
comment|/**/
end_comment

begin_define
define|#
directive|define
name|svr4_to_bsd_char
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
define|\
value|if (new || __CONCAT3(SVR4_,a,b)< SVR4_NCC) { \ 		if (st->c_cc[__CONCAT3(SVR4_,a,b)] == SVR4_POSIX_VDISABLE) \ 			bt->c_cc[__CONCAT(a,b)] = _POSIX_VDISABLE; \ 		else \ 			bt->c_cc[__CONCAT(a,b)] = st->c_cc[__CONCAT3(SVR4_,a,b)]; \ 	}
end_define

begin_define
define|#
directive|define
name|svr4_to_bsd_flag1
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|)
define|\
value|if (new || __CONCAT3(SVR4_,a,b)< 0200000) { \ 		if (st->f& __CONCAT3(SVR4_,a,b)) \ 			bt->f |= __CONCAT(a,b); \ 		else \ 			bt->f&= ~__CONCAT(a,b); \ 	}
end_define

begin_define
define|#
directive|define
name|svr4_to_bsd_flag2
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c1
parameter_list|,
name|t1
parameter_list|,
name|c2
parameter_list|,
name|t2
parameter_list|)
define|\
value|if (new || __CONCAT3(SVR4_,a,b)< 0200000) { \ 		bt->f&= ~__CONCAT(a,b); \ 		switch (st->f& __CONCAT3(SVR4_,a,b)) { \ 		case __CONCAT3(SVR4_,c1,t1): bt->f |= __CONCAT(c1,t1); break; \ 		case __CONCAT3(SVR4_,c2,t2): bt->f |= __CONCAT(c2,t2); break; \ 		} \ 	}
end_define

begin_define
define|#
directive|define
name|svr4_to_bsd_flag4
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c1
parameter_list|,
name|t1
parameter_list|,
name|c2
parameter_list|,
name|t2
parameter_list|,
name|c3
parameter_list|,
name|t3
parameter_list|,
name|c4
parameter_list|,
name|t4
parameter_list|)
define|\
value|if (new || __CONCAT3(SVR4_,a,b)< 0200000) { \ 		bt->f&= ~__CONCAT(a,b); \ 		switch (st->f& __CONCAT3(SVR4_,a,b)) { \ 		case __CONCAT3(SVR4_,c1,t1): bt->f |= __CONCAT(c1,t1); break; \ 		case __CONCAT3(SVR4_,c2,t2): bt->f |= __CONCAT(c2,t2); break; \ 		case __CONCAT3(SVR4_,c3,t3): bt->f |= __CONCAT(c3,t3); break; \ 		case __CONCAT3(SVR4_,c4,t4): bt->f |= __CONCAT(c4,t4); break; \ 		} \ 	}
end_define

begin_define
define|#
directive|define
name|bsd_to_svr4_char
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
define|\
value|if (bt->c_cc[__CONCAT(a,b)] == _POSIX_VDISABLE) \ 		st->c_cc[__CONCAT3(SVR4_,a,b)] = SVR4_POSIX_VDISABLE; \ 	else \ 		st->c_cc[__CONCAT3(SVR4_,a,b)] = bt->c_cc[__CONCAT(a,b)]
end_define

begin_define
define|#
directive|define
name|bsd_to_svr4_flag1
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|)
define|\
value|if (bt->f& __CONCAT(a,b)) \ 		st->f |= __CONCAT3(SVR4_,a,b); \ 	else \ 		st->f&= ~__CONCAT3(SVR4_,a,b)
end_define

begin_define
define|#
directive|define
name|bsd_to_svr4_flag2
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c1
parameter_list|,
name|t1
parameter_list|,
name|c2
parameter_list|,
name|t2
parameter_list|)
define|\
value|st->f&= ~__CONCAT(a,b); \ 	switch (bt->f& __CONCAT(a,b)) { \ 	case __CONCAT(c1,t1): st->f |= __CONCAT3(SVR4_,c1,t1); break; \ 	case __CONCAT(c2,t2): st->f |= __CONCAT3(SVR4_,c2,t2); break; \ 	}
end_define

begin_define
define|#
directive|define
name|bsd_to_svr4_flag4
parameter_list|(
name|f
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c1
parameter_list|,
name|t1
parameter_list|,
name|c2
parameter_list|,
name|t2
parameter_list|,
name|c3
parameter_list|,
name|t3
parameter_list|,
name|c4
parameter_list|,
name|t4
parameter_list|)
define|\
value|st->f&= ~__CONCAT(a,b); \ 	switch (bt->f& __CONCAT(a,b)) { \ 	case __CONCAT(c1,t1): st->f |= __CONCAT3(SVR4_,c1,t1); break; \ 	case __CONCAT(c2,t2): st->f |= __CONCAT3(SVR4_,c2,t2); break; \ 	case __CONCAT(c3,t3): st->f |= __CONCAT3(SVR4_,c3,t3); break; \ 	case __CONCAT(c4,t4): st->f |= __CONCAT3(SVR4_,c4,t4); break; \ 	}
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG_SVR4
end_ifdef

begin_function
specifier|static
name|void
name|print_svr4_termios
parameter_list|(
name|st
parameter_list|)
specifier|const
name|struct
name|svr4_termios
modifier|*
name|st
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|DPRINTF
argument_list|(
operator|(
literal|"SVR4\niflag=%lo oflag=%lo cflag=%lo lflag=%lo\n"
operator|,
name|st
operator|->
name|c_iflag
operator|,
name|st
operator|->
name|c_oflag
operator|,
name|st
operator|->
name|c_cflag
operator|,
name|st
operator|->
name|c_lflag
operator|)
argument_list|)
expr_stmt|;
name|DPRINTF
argument_list|(
operator|(
literal|"cc: "
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SVR4_NCCS
condition|;
name|i
operator|++
control|)
name|DPRINTF
argument_list|(
operator|(
literal|"%o "
operator|,
name|st
operator|->
name|c_cc
index|[
name|i
index|]
operator|)
argument_list|)
expr_stmt|;
name|DPRINTF
argument_list|(
operator|(
literal|"\n"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_bsd_termios
parameter_list|(
name|bt
parameter_list|)
specifier|const
name|struct
name|termios
modifier|*
name|bt
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|uprintf
argument_list|(
literal|"BSD\niflag=%o oflag=%o cflag=%o lflag=%o\n"
argument_list|,
name|bt
operator|->
name|c_iflag
argument_list|,
name|bt
operator|->
name|c_oflag
argument_list|,
name|bt
operator|->
name|c_cflag
argument_list|,
name|bt
operator|->
name|c_lflag
argument_list|)
expr_stmt|;
name|uprintf
argument_list|(
literal|"cc: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NCCS
condition|;
name|i
operator|++
control|)
name|uprintf
argument_list|(
literal|"%o "
argument_list|,
name|bt
operator|->
name|c_cc
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uprintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEBUG_SVR4 */
end_comment

begin_function
specifier|static
name|u_long
name|bsd_to_svr4_speed
parameter_list|(
name|sp
parameter_list|,
name|mask
parameter_list|)
name|u_long
name|sp
decl_stmt|;
name|u_long
name|mask
decl_stmt|;
block|{
switch|switch
condition|(
name|sp
condition|)
block|{
undef|#
directive|undef
name|getval
define|#
directive|define
name|getval
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|case __CONCAT(a,b):	sp = __CONCAT3(SVR4_,a,b)
name|getval
argument_list|(
name|B
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|75
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|110
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|134
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|600
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|1200
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|1800
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|2400
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|4800
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|9600
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|19200
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|38400
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|57600
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|115200
argument_list|)
expr_stmt|;
default|default:
name|sp
operator|=
name|SVR4_B9600
expr_stmt|;
comment|/* XXX */
block|}
while|while
condition|(
operator|(
name|mask
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
name|mask
operator|>>=
literal|1
expr_stmt|;
name|sp
operator|<<=
literal|1
expr_stmt|;
block|}
return|return
name|sp
return|;
block|}
end_function

begin_function
specifier|static
name|u_long
name|svr4_to_bsd_speed
parameter_list|(
name|sp
parameter_list|,
name|mask
parameter_list|)
name|u_long
name|sp
decl_stmt|;
name|u_long
name|mask
decl_stmt|;
block|{
while|while
condition|(
operator|(
name|mask
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
name|mask
operator|>>=
literal|1
expr_stmt|;
name|sp
operator|>>=
literal|1
expr_stmt|;
block|}
switch|switch
condition|(
name|sp
operator|&
name|mask
condition|)
block|{
undef|#
directive|undef
name|getval
define|#
directive|define
name|getval
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|case __CONCAT3(SVR4_,a,b):	return __CONCAT(a,b)
name|getval
argument_list|(
name|B
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|75
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|110
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|134
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|600
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|1200
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|1800
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|2400
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|4800
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|9600
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|19200
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|38400
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|57600
argument_list|)
expr_stmt|;
name|getval
argument_list|(
name|B
argument_list|,
literal|115200
argument_list|)
expr_stmt|;
default|default:
return|return
name|B9600
return|;
comment|/* XXX */
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|svr4_to_bsd_termios
parameter_list|(
name|st
parameter_list|,
name|bt
parameter_list|,
name|new
parameter_list|)
specifier|const
name|struct
name|svr4_termios
modifier|*
name|st
decl_stmt|;
name|struct
name|termios
modifier|*
name|bt
decl_stmt|;
name|int
name|new
decl_stmt|;
block|{
comment|/* control characters */
comment|/* 	 * We process VMIN and VTIME first, 	 * because they are shared with VEOF and VEOL 	 */
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|MIN
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|TIME
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|INTR
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|QUIT
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|ERASE
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|KILL
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|EOF
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|EOL
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|EOL2
argument_list|)
expr_stmt|;
name|undefined_char
argument_list|(
name|V
argument_list|,
name|SWTCH
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|START
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|STOP
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|SUSP
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|DSUSP
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|REPRINT
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|DISCARD
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|WERASE
argument_list|)
expr_stmt|;
name|svr4_to_bsd_char
argument_list|(
name|V
argument_list|,
name|LNEXT
argument_list|)
expr_stmt|;
comment|/* Input modes */
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|GNBRK
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|B
argument_list|,
name|RKINT
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|GNPAR
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|P
argument_list|,
name|ARMRK
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|NPCK
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|STRIP
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|NLCR
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|GNCR
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|CRNL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|UCLC
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|XON
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|XANY
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|XOFF
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|MAXBEL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_iflag
argument_list|,
name|D
argument_list|,
name|OSMODE
argument_list|)
expr_stmt|;
comment|/* Output modes */
name|svr4_to_bsd_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|POST
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|LCUC
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|NLCR
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|CRNL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|NOCR
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|NLRET
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|FILL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|FDEL
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|N
argument_list|,
name|LDLY
argument_list|,
name|N
argument_list|,
name|L0
argument_list|,
name|N
argument_list|,
name|L1
argument_list|)
expr_stmt|;
name|undefined_flag4
argument_list|(
name|c_oflag
argument_list|,
name|C
argument_list|,
name|RDLY
argument_list|,
name|C
argument_list|,
name|R0
argument_list|,
name|C
argument_list|,
name|R1
argument_list|,
name|C
argument_list|,
name|R2
argument_list|,
name|C
argument_list|,
name|R3
argument_list|)
expr_stmt|;
name|undefined_flag4
argument_list|(
name|c_oflag
argument_list|,
name|T
argument_list|,
name|ABDLY
argument_list|,
name|T
argument_list|,
name|AB0
argument_list|,
name|T
argument_list|,
name|AB1
argument_list|,
name|T
argument_list|,
name|AB2
argument_list|,
name|T
argument_list|,
name|AB3
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|B
argument_list|,
name|SDLY
argument_list|,
name|B
argument_list|,
name|S0
argument_list|,
name|B
argument_list|,
name|S1
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|V
argument_list|,
name|TDLY
argument_list|,
name|V
argument_list|,
name|T0
argument_list|,
name|V
argument_list|,
name|T1
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|F
argument_list|,
name|FDLY
argument_list|,
name|F
argument_list|,
name|F0
argument_list|,
name|F
argument_list|,
name|F1
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|P
argument_list|,
name|AGEOUT
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|W
argument_list|,
name|RAP
argument_list|)
expr_stmt|;
comment|/* Control modes */
name|bt
operator|->
name|c_ospeed
operator|=
name|svr4_to_bsd_speed
argument_list|(
name|st
operator|->
name|c_cflag
argument_list|,
name|SVR4_CBAUD
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag4
argument_list|(
argument|c_cflag
argument_list|,
argument|C
argument_list|,
argument|SIZE
argument_list|,
argument|C
argument_list|,
argument|S5
argument_list|,
argument|C
argument_list|,
argument|S6
argument_list|,
argument|C
argument_list|,
argument|S7
argument_list|,
argument|C
argument_list|,
argument|S8
argument_list|)
name|svr4_to_bsd_flag1
argument_list|(
name|c_cflag
argument_list|,
name|C
argument_list|,
name|STOPB
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_cflag
argument_list|,
name|C
argument_list|,
name|READ
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_cflag
argument_list|,
name|P
argument_list|,
name|ARENB
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_cflag
argument_list|,
name|P
argument_list|,
name|ARODD
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_cflag
argument_list|,
name|H
argument_list|,
name|UPCL
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_cflag
argument_list|,
name|C
argument_list|,
name|LOCAL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|R
argument_list|,
name|CV1EN
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|X
argument_list|,
name|MT1EN
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|L
argument_list|,
name|OBLK
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|X
argument_list|,
name|CLUDE
argument_list|)
expr_stmt|;
name|bt
operator|->
name|c_ispeed
operator|=
name|svr4_to_bsd_speed
argument_list|(
name|st
operator|->
name|c_cflag
argument_list|,
name|SVR4_CIBAUD
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|P
argument_list|,
name|AREXT
argument_list|)
expr_stmt|;
comment|/* line discipline modes */
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|I
argument_list|,
name|SIG
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|I
argument_list|,
name|CANON
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_lflag
argument_list|,
name|X
argument_list|,
name|CASE
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHO
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOE
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOK
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHONL
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|N
argument_list|,
name|OFLSH
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|T
argument_list|,
name|OSTOP
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOCTL
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOPRT
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOKE
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_lflag
argument_list|,
name|D
argument_list|,
name|EFECHO
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|F
argument_list|,
name|LUSHO
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|P
argument_list|,
name|ENDIN
argument_list|)
expr_stmt|;
name|svr4_to_bsd_flag1
argument_list|(
name|c_lflag
argument_list|,
name|I
argument_list|,
name|EXTEN
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|bsd_to_svr4_termios
parameter_list|(
name|bt
parameter_list|,
name|st
parameter_list|)
specifier|const
name|struct
name|termios
modifier|*
name|bt
decl_stmt|;
name|struct
name|svr4_termios
modifier|*
name|st
decl_stmt|;
block|{
comment|/* control characters */
comment|/* 	 * We process VMIN and VTIME first, 	 * because they are shared with VEOF and VEOL 	 */
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|MIN
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|TIME
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|INTR
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|QUIT
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|ERASE
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|KILL
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|EOF
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|EOL
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|EOL2
argument_list|)
expr_stmt|;
name|undefined_char
argument_list|(
name|V
argument_list|,
name|SWTCH
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|START
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|STOP
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|SUSP
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|DSUSP
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|REPRINT
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|DISCARD
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|WERASE
argument_list|)
expr_stmt|;
name|bsd_to_svr4_char
argument_list|(
name|V
argument_list|,
name|LNEXT
argument_list|)
expr_stmt|;
comment|/* Input modes */
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|GNBRK
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|B
argument_list|,
name|RKINT
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|GNPAR
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|P
argument_list|,
name|ARMRK
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|NPCK
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|STRIP
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|NLCR
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|GNCR
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|CRNL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|UCLC
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|XON
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|XANY
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|XOFF
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_iflag
argument_list|,
name|I
argument_list|,
name|MAXBEL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_iflag
argument_list|,
name|D
argument_list|,
name|OSMODE
argument_list|)
expr_stmt|;
comment|/* Output modes */
name|bsd_to_svr4_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|POST
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|LCUC
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|NLCR
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|CRNL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|NOCR
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|NLRET
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|FILL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|O
argument_list|,
name|FDEL
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|N
argument_list|,
name|LDLY
argument_list|,
name|N
argument_list|,
name|L0
argument_list|,
name|N
argument_list|,
name|L1
argument_list|)
expr_stmt|;
name|undefined_flag4
argument_list|(
name|c_oflag
argument_list|,
name|C
argument_list|,
name|RDLY
argument_list|,
name|C
argument_list|,
name|R0
argument_list|,
name|C
argument_list|,
name|R1
argument_list|,
name|C
argument_list|,
name|R2
argument_list|,
name|C
argument_list|,
name|R3
argument_list|)
expr_stmt|;
name|undefined_flag4
argument_list|(
name|c_oflag
argument_list|,
name|T
argument_list|,
name|ABDLY
argument_list|,
name|T
argument_list|,
name|AB0
argument_list|,
name|T
argument_list|,
name|AB1
argument_list|,
name|T
argument_list|,
name|AB2
argument_list|,
name|T
argument_list|,
name|AB3
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|B
argument_list|,
name|SDLY
argument_list|,
name|B
argument_list|,
name|S0
argument_list|,
name|B
argument_list|,
name|S1
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|V
argument_list|,
name|TDLY
argument_list|,
name|V
argument_list|,
name|T0
argument_list|,
name|V
argument_list|,
name|T1
argument_list|)
expr_stmt|;
name|undefined_flag2
argument_list|(
name|c_oflag
argument_list|,
name|F
argument_list|,
name|FDLY
argument_list|,
name|F
argument_list|,
name|F0
argument_list|,
name|F
argument_list|,
name|F1
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|P
argument_list|,
name|AGEOUT
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|W
argument_list|,
name|RAP
argument_list|)
expr_stmt|;
comment|/* Control modes */
name|st
operator|->
name|c_cflag
operator|&=
operator|~
name|SVR4_CBAUD
expr_stmt|;
name|st
operator|->
name|c_cflag
operator||=
name|bsd_to_svr4_speed
argument_list|(
name|bt
operator|->
name|c_ospeed
argument_list|,
name|SVR4_CBAUD
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag4
argument_list|(
argument|c_cflag
argument_list|,
argument|C
argument_list|,
argument|SIZE
argument_list|,
argument|C
argument_list|,
argument|S5
argument_list|,
argument|C
argument_list|,
argument|S6
argument_list|,
argument|C
argument_list|,
argument|S7
argument_list|,
argument|C
argument_list|,
argument|S8
argument_list|)
name|bsd_to_svr4_flag1
argument_list|(
name|c_cflag
argument_list|,
name|C
argument_list|,
name|STOPB
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_cflag
argument_list|,
name|C
argument_list|,
name|READ
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_cflag
argument_list|,
name|P
argument_list|,
name|ARENB
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_cflag
argument_list|,
name|P
argument_list|,
name|ARODD
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_cflag
argument_list|,
name|H
argument_list|,
name|UPCL
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_cflag
argument_list|,
name|C
argument_list|,
name|LOCAL
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|R
argument_list|,
name|CV1EN
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|X
argument_list|,
name|MT1EN
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|L
argument_list|,
name|OBLK
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_cflag
argument_list|,
name|X
argument_list|,
name|CLUDE
argument_list|)
expr_stmt|;
name|st
operator|->
name|c_cflag
operator|&=
operator|~
name|SVR4_CIBAUD
expr_stmt|;
name|st
operator|->
name|c_cflag
operator||=
name|bsd_to_svr4_speed
argument_list|(
name|bt
operator|->
name|c_ispeed
argument_list|,
name|SVR4_CIBAUD
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_oflag
argument_list|,
name|P
argument_list|,
name|AREXT
argument_list|)
expr_stmt|;
comment|/* line discipline modes */
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|I
argument_list|,
name|SIG
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|I
argument_list|,
name|CANON
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_lflag
argument_list|,
name|X
argument_list|,
name|CASE
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHO
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOE
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOK
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHONL
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|N
argument_list|,
name|OFLSH
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|T
argument_list|,
name|OSTOP
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOCTL
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOPRT
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|E
argument_list|,
name|CHOKE
argument_list|)
expr_stmt|;
name|undefined_flag1
argument_list|(
name|c_lflag
argument_list|,
name|D
argument_list|,
name|EFECHO
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|F
argument_list|,
name|LUSHO
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|P
argument_list|,
name|ENDIN
argument_list|)
expr_stmt|;
name|bsd_to_svr4_flag1
argument_list|(
name|c_lflag
argument_list|,
name|I
argument_list|,
name|EXTEN
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|svr4_termio_to_termios
parameter_list|(
name|t
parameter_list|,
name|ts
parameter_list|)
specifier|const
name|struct
name|svr4_termio
modifier|*
name|t
decl_stmt|;
name|struct
name|svr4_termios
modifier|*
name|ts
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|ts
operator|->
name|c_iflag
operator|=
operator|(
name|svr4_tcflag_t
operator|)
name|t
operator|->
name|c_iflag
expr_stmt|;
name|ts
operator|->
name|c_oflag
operator|=
operator|(
name|svr4_tcflag_t
operator|)
name|t
operator|->
name|c_oflag
expr_stmt|;
name|ts
operator|->
name|c_cflag
operator|=
operator|(
name|svr4_tcflag_t
operator|)
name|t
operator|->
name|c_cflag
expr_stmt|;
name|ts
operator|->
name|c_lflag
operator|=
operator|(
name|svr4_tcflag_t
operator|)
name|t
operator|->
name|c_lflag
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SVR4_NCC
condition|;
name|i
operator|++
control|)
name|ts
operator|->
name|c_cc
index|[
name|i
index|]
operator|=
operator|(
name|svr4_cc_t
operator|)
name|t
operator|->
name|c_cc
index|[
name|i
index|]
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|svr4_termios_to_termio
parameter_list|(
name|ts
parameter_list|,
name|t
parameter_list|)
specifier|const
name|struct
name|svr4_termios
modifier|*
name|ts
decl_stmt|;
name|struct
name|svr4_termio
modifier|*
name|t
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|t
operator|->
name|c_iflag
operator|=
operator|(
name|u_short
operator|)
name|ts
operator|->
name|c_iflag
expr_stmt|;
name|t
operator|->
name|c_oflag
operator|=
operator|(
name|u_short
operator|)
name|ts
operator|->
name|c_oflag
expr_stmt|;
name|t
operator|->
name|c_cflag
operator|=
operator|(
name|u_short
operator|)
name|ts
operator|->
name|c_cflag
expr_stmt|;
name|t
operator|->
name|c_lflag
operator|=
operator|(
name|u_short
operator|)
name|ts
operator|->
name|c_lflag
expr_stmt|;
name|t
operator|->
name|c_line
operator|=
literal|0
expr_stmt|;
comment|/* XXX */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SVR4_NCC
condition|;
name|i
operator|++
control|)
name|t
operator|->
name|c_cc
index|[
name|i
index|]
operator|=
operator|(
name|u_char
operator|)
name|ts
operator|->
name|c_cc
index|[
name|i
index|]
expr_stmt|;
block|}
end_function

begin_function
name|int
name|svr4_term_ioctl
parameter_list|(
name|fp
parameter_list|,
name|p
parameter_list|,
name|retval
parameter_list|,
name|fd
parameter_list|,
name|cmd
parameter_list|,
name|data
parameter_list|)
name|struct
name|file
modifier|*
name|fp
decl_stmt|;
name|struct
name|proc
modifier|*
name|p
decl_stmt|;
name|register_t
modifier|*
name|retval
decl_stmt|;
name|int
name|fd
decl_stmt|;
name|u_long
name|cmd
decl_stmt|;
name|caddr_t
name|data
decl_stmt|;
block|{
name|struct
name|termios
name|bt
decl_stmt|;
name|struct
name|svr4_termios
name|st
decl_stmt|;
name|struct
name|svr4_termio
name|t
decl_stmt|;
name|int
name|error
decl_stmt|,
name|new
decl_stmt|;
operator|*
name|retval
operator|=
literal|0
expr_stmt|;
name|DPRINTF
argument_list|(
operator|(
literal|"TERM ioctl %x\n"
operator|,
name|cmd
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cmd
condition|)
block|{
case|case
name|SVR4_TCGETA
case|:
case|case
name|SVR4_TCGETS
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"ioctl(TCGET%c);\n"
operator|,
name|cmd
operator|==
name|SVR4_TCGETA
condition|?
literal|'A'
else|:
literal|'S'
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|error
operator|=
name|fo_ioctl
argument_list|(
name|fp
argument_list|,
name|TIOCGETA
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bt
argument_list|,
name|p
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
name|error
return|;
name|memset
argument_list|(
operator|&
name|st
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|st
argument_list|)
argument_list|)
expr_stmt|;
name|bsd_to_svr4_termios
argument_list|(
operator|&
name|bt
argument_list|,
operator|&
name|st
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_SVR4
name|print_bsd_termios
argument_list|(
operator|&
name|bt
argument_list|)
expr_stmt|;
name|print_svr4_termios
argument_list|(
operator|&
name|st
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_SVR4 */
if|if
condition|(
name|cmd
operator|==
name|SVR4_TCGETA
condition|)
block|{
name|svr4_termios_to_termio
argument_list|(
operator|&
name|st
argument_list|,
operator|&
name|t
argument_list|)
expr_stmt|;
return|return
name|copyout
argument_list|(
operator|&
name|t
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|t
argument_list|)
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|copyout
argument_list|(
operator|&
name|st
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|st
argument_list|)
argument_list|)
return|;
block|}
case|case
name|SVR4_TCSETA
case|:
case|case
name|SVR4_TCSETS
case|:
case|case
name|SVR4_TCSETAW
case|:
case|case
name|SVR4_TCSETSW
case|:
case|case
name|SVR4_TCSETAF
case|:
case|case
name|SVR4_TCSETSF
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"TCSET{A,S,AW,SW,AF,SF}\n"
operator|)
argument_list|)
expr_stmt|;
comment|/* get full BSD termios so we don't lose information */
if|if
condition|(
operator|(
name|error
operator|=
name|fo_ioctl
argument_list|(
name|fp
argument_list|,
name|TIOCGETA
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bt
argument_list|,
name|p
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
name|error
return|;
switch|switch
condition|(
name|cmd
condition|)
block|{
case|case
name|SVR4_TCSETS
case|:
case|case
name|SVR4_TCSETSW
case|:
case|case
name|SVR4_TCSETSF
case|:
if|if
condition|(
operator|(
name|error
operator|=
name|copyin
argument_list|(
name|data
argument_list|,
operator|&
name|st
argument_list|,
sizeof|sizeof
argument_list|(
name|st
argument_list|)
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
name|error
return|;
name|new
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|SVR4_TCSETA
case|:
case|case
name|SVR4_TCSETAW
case|:
case|case
name|SVR4_TCSETAF
case|:
if|if
condition|(
operator|(
name|error
operator|=
name|copyin
argument_list|(
name|data
argument_list|,
operator|&
name|t
argument_list|,
sizeof|sizeof
argument_list|(
name|t
argument_list|)
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
name|error
return|;
name|svr4_termio_to_termios
argument_list|(
operator|&
name|t
argument_list|,
operator|&
name|st
argument_list|)
expr_stmt|;
name|new
operator|=
literal|0
expr_stmt|;
break|break;
default|default:
return|return
name|EINVAL
return|;
block|}
name|svr4_to_bsd_termios
argument_list|(
operator|&
name|st
argument_list|,
operator|&
name|bt
argument_list|,
name|new
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cmd
condition|)
block|{
case|case
name|SVR4_TCSETA
case|:
case|case
name|SVR4_TCSETS
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"ioctl(TCSET[A|S]);\n"
operator|)
argument_list|)
expr_stmt|;
name|cmd
operator|=
name|TIOCSETA
expr_stmt|;
break|break;
case|case
name|SVR4_TCSETAW
case|:
case|case
name|SVR4_TCSETSW
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"ioctl(TCSET[A|S]W);\n"
operator|)
argument_list|)
expr_stmt|;
name|cmd
operator|=
name|TIOCSETAW
expr_stmt|;
break|break;
case|case
name|SVR4_TCSETAF
case|:
case|case
name|SVR4_TCSETSF
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"ioctl(TCSET[A|S]F);\n"
operator|)
argument_list|)
expr_stmt|;
name|cmd
operator|=
name|TIOCSETAF
expr_stmt|;
break|break;
block|}
ifdef|#
directive|ifdef
name|DEBUG_SVR4
name|print_bsd_termios
argument_list|(
operator|&
name|bt
argument_list|)
expr_stmt|;
name|print_svr4_termios
argument_list|(
operator|&
name|st
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_SVR4 */
return|return
name|fo_ioctl
argument_list|(
name|fp
argument_list|,
name|cmd
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bt
argument_list|,
name|p
argument_list|)
return|;
case|case
name|SVR4_TIOCGWINSZ
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"TIOCGWINSZ\n"
operator|)
argument_list|)
expr_stmt|;
block|{
name|struct
name|svr4_winsize
name|ws
decl_stmt|;
name|error
operator|=
name|fo_ioctl
argument_list|(
name|fp
argument_list|,
name|TIOCGWINSZ
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ws
argument_list|,
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
return|return
name|error
return|;
return|return
name|copyout
argument_list|(
operator|&
name|ws
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|ws
argument_list|)
argument_list|)
return|;
block|}
case|case
name|SVR4_TIOCSWINSZ
case|:
name|DPRINTF
argument_list|(
operator|(
literal|"TIOCSWINSZ\n"
operator|)
argument_list|)
expr_stmt|;
block|{
name|struct
name|svr4_winsize
name|ws
decl_stmt|;
if|if
condition|(
operator|(
name|error
operator|=
name|copyin
argument_list|(
name|data
argument_list|,
operator|&
name|ws
argument_list|,
sizeof|sizeof
argument_list|(
name|ws
argument_list|)
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
name|error
return|;
return|return
name|fo_ioctl
argument_list|(
name|fp
argument_list|,
name|TIOCSWINSZ
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ws
argument_list|,
name|p
argument_list|)
return|;
block|}
default|default:
name|DPRINTF
argument_list|(
operator|(
literal|"teleport to STREAMS ioctls...\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|svr4_stream_ti_ioctl
argument_list|(
name|fp
argument_list|,
name|p
argument_list|,
name|retval
argument_list|,
name|fd
argument_list|,
name|cmd
argument_list|,
name|data
argument_list|)
return|;
block|}
block|}
end_function

end_unit

