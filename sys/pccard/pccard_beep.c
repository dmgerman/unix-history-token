begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * pccard noise interface.  * Nate Williams, October 1997.  * This file is in the public domain.  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<machine/clock.h>
end_include

begin_include
include|#
directive|include
file|<pccard/driver.h>
end_include

begin_define
define|#
directive|define
name|PCCARD_BEEP_PITCH0
value|1600
end_define

begin_define
define|#
directive|define
name|PCCARD_BEEP_DURATION0
value|20
end_define

begin_define
define|#
directive|define
name|PCCARD_BEEP_PITCH1
value|1200
end_define

begin_define
define|#
directive|define
name|PCCARD_BEEP_DURATION1
value|40
end_define

begin_define
define|#
directive|define
name|PCCARD_BEEP_PITCH2
value|3200
end_define

begin_define
define|#
directive|define
name|PCCARD_BEEP_DURATION2
value|40
end_define

begin_decl_stmt
specifier|static
name|enum
name|beepstate
name|allow_beep
init|=
name|BEEP_OFF
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * timeout function to keep lots of noise from  * happening with insertion/removals.  */
end_comment

begin_function
specifier|static
name|void
name|enable_beep
parameter_list|(
name|void
modifier|*
name|dummy
parameter_list|)
block|{
comment|/* Should never be needed */
name|untimeout
argument_list|(
name|enable_beep
argument_list|,
operator|(
name|void
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|allow_beep
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|pccard_insert_beep
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|allow_beep
operator|==
name|BEEP_ON
condition|)
block|{
name|sysbeep
argument_list|(
name|PCCARD_BEEP_PITCH0
argument_list|,
name|PCCARD_BEEP_DURATION0
argument_list|)
expr_stmt|;
name|allow_beep
operator|=
literal|0
expr_stmt|;
name|timeout
argument_list|(
name|enable_beep
argument_list|,
operator|(
name|void
operator|*
operator|)
name|NULL
argument_list|,
name|hz
operator|/
literal|5
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|pccard_remove_beep
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|allow_beep
operator|==
name|BEEP_ON
condition|)
block|{
name|sysbeep
argument_list|(
name|PCCARD_BEEP_PITCH0
argument_list|,
name|PCCARD_BEEP_DURATION0
argument_list|)
expr_stmt|;
name|allow_beep
operator|=
literal|0
expr_stmt|;
name|timeout
argument_list|(
name|enable_beep
argument_list|,
operator|(
name|void
operator|*
operator|)
name|NULL
argument_list|,
name|hz
operator|/
literal|5
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|pccard_success_beep
parameter_list|(
name|void
parameter_list|)
block|{
name|sysbeep
argument_list|(
name|PCCARD_BEEP_PITCH1
argument_list|,
name|PCCARD_BEEP_DURATION1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|pccard_failure_beep
parameter_list|(
name|void
parameter_list|)
block|{
name|sysbeep
argument_list|(
name|PCCARD_BEEP_PITCH2
argument_list|,
name|PCCARD_BEEP_DURATION2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|pccard_beep_select
parameter_list|(
name|enum
name|beepstate
name|state
parameter_list|)
block|{
name|allow_beep
operator|=
name|state
expr_stmt|;
block|}
end_function

end_unit

