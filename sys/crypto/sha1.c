begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$FreeBSD$	*/
end_comment

begin_comment
comment|/*	$KAME: sha1.c,v 1.5 2000/11/08 06:13:08 itojun Exp $	*/
end_comment

begin_comment
comment|/*  * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. Neither the name of the project nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * FIPS pub 180-1: Secure Hash Algorithm (SHA-1)  * based on: http://csrc.nist.gov/fips/fip180-1.txt  * implemented by Jun-ichiro itojun Itoh<itojun@itojun.org>  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<crypto/sha1.h>
end_include

begin_comment
comment|/* sanity check */
end_comment

begin_if
if|#
directive|if
name|BYTE_ORDER
operator|!=
name|BIG_ENDIAN
end_if

begin_if
if|#
directive|if
name|BYTE_ORDER
operator|!=
name|LITTLE_ENDIAN
end_if

begin_define
define|#
directive|define
name|unsupported
value|1
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|unsupported
end_ifndef

begin_comment
comment|/* constant table */
end_comment

begin_decl_stmt
specifier|static
name|u_int32_t
name|_K
index|[]
init|=
block|{
literal|0x5a827999
block|,
literal|0x6ed9eba1
block|,
literal|0x8f1bbcdc
block|,
literal|0xca62c1d6
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|K
parameter_list|(
name|t
parameter_list|)
value|_K[(t) / 20]
end_define

begin_define
define|#
directive|define
name|F0
parameter_list|(
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|)
value|(((b)& (c)) | ((~(b))& (d)))
end_define

begin_define
define|#
directive|define
name|F1
parameter_list|(
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|)
value|(((b) ^ (c)) ^ (d))
end_define

begin_define
define|#
directive|define
name|F2
parameter_list|(
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|)
value|(((b)& (c)) | ((b)& (d)) | ((c)& (d)))
end_define

begin_define
define|#
directive|define
name|F3
parameter_list|(
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|)
value|(((b) ^ (c)) ^ (d))
end_define

begin_define
define|#
directive|define
name|S
parameter_list|(
name|n
parameter_list|,
name|x
parameter_list|)
value|(((x)<< (n)) | ((x)>> (32 - n)))
end_define

begin_define
define|#
directive|define
name|H
parameter_list|(
name|n
parameter_list|)
value|(ctxt->h.b32[(n)])
end_define

begin_define
define|#
directive|define
name|COUNT
value|(ctxt->count)
end_define

begin_define
define|#
directive|define
name|BCOUNT
value|(ctxt->c.b64[0] / 8)
end_define

begin_define
define|#
directive|define
name|W
parameter_list|(
name|n
parameter_list|)
value|(ctxt->m.b32[(n)])
end_define

begin_define
define|#
directive|define
name|PUTBYTE
parameter_list|(
name|x
parameter_list|)
value|{ \ 	ctxt->m.b8[(COUNT % 64)] = (x);		\ 	COUNT++;				\ 	COUNT %= 64;				\ 	ctxt->c.b64[0] += 8;			\ 	if (COUNT % 64 == 0)			\ 		sha1_step(ctxt);		\      }
end_define

begin_define
define|#
directive|define
name|PUTPAD
parameter_list|(
name|x
parameter_list|)
value|{ \ 	ctxt->m.b8[(COUNT % 64)] = (x);		\ 	COUNT++;				\ 	COUNT %= 64;				\ 	if (COUNT % 64 == 0)			\ 		sha1_step(ctxt);		\      }
end_define

begin_decl_stmt
specifier|static
name|void
name|sha1_step
name|__P
argument_list|(
operator|(
expr|struct
name|sha1_ctxt
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|sha1_step
parameter_list|(
name|ctxt
parameter_list|)
name|struct
name|sha1_ctxt
modifier|*
name|ctxt
decl_stmt|;
block|{
name|u_int32_t
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|;
name|size_t
name|t
decl_stmt|,
name|s
decl_stmt|;
name|u_int32_t
name|tmp
decl_stmt|;
if|#
directive|if
name|BYTE_ORDER
operator|==
name|LITTLE_ENDIAN
name|struct
name|sha1_ctxt
name|tctxt
decl_stmt|;
name|bcopy
argument_list|(
operator|&
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|0
index|]
argument_list|,
operator|&
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|0
index|]
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|0
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|3
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|1
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|2
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|2
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|1
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|3
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|0
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|4
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|7
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|5
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|6
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|6
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|5
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|7
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|4
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|8
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|11
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|9
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|10
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|10
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|9
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|11
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|8
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|12
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|15
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|13
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|14
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|14
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|13
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|15
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|12
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|16
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|19
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|17
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|18
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|18
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|17
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|19
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|16
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|20
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|23
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|21
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|22
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|22
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|21
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|23
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|20
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|24
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|27
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|25
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|26
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|26
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|25
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|27
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|24
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|28
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|31
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|29
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|30
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|30
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|29
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|31
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|28
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|32
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|35
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|33
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|34
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|34
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|33
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|35
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|32
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|36
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|39
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|37
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|38
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|38
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|37
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|39
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|36
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|40
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|43
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|41
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|42
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|42
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|41
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|43
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|40
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|44
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|47
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|45
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|46
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|46
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|45
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|47
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|44
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|48
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|51
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|49
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|50
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|50
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|49
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|51
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|48
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|52
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|55
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|53
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|54
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|54
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|53
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|55
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|52
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|56
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|59
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|57
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|58
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|58
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|57
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|59
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|56
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|60
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|63
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|61
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|62
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|62
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|61
index|]
expr_stmt|;
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|63
index|]
operator|=
name|tctxt
operator|.
name|m
operator|.
name|b8
index|[
literal|60
index|]
expr_stmt|;
endif|#
directive|endif
name|a
operator|=
name|H
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|b
operator|=
name|H
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|c
operator|=
name|H
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|d
operator|=
name|H
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|e
operator|=
name|H
argument_list|(
literal|4
argument_list|)
expr_stmt|;
for|for
control|(
name|t
operator|=
literal|0
init|;
name|t
operator|<
literal|20
condition|;
name|t
operator|++
control|)
block|{
name|s
operator|=
name|t
operator|&
literal|0x0f
expr_stmt|;
if|if
condition|(
name|t
operator|>=
literal|16
condition|)
block|{
name|W
argument_list|(
name|s
argument_list|)
operator|=
name|S
argument_list|(
literal|1
argument_list|,
name|W
argument_list|(
operator|(
name|s
operator|+
literal|13
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|8
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|2
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|tmp
operator|=
name|S
argument_list|(
literal|5
argument_list|,
name|a
argument_list|)
operator|+
name|F0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
operator|+
name|e
operator|+
name|W
argument_list|(
name|s
argument_list|)
operator|+
name|K
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|e
operator|=
name|d
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|S
argument_list|(
literal|30
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|tmp
expr_stmt|;
block|}
for|for
control|(
name|t
operator|=
literal|20
init|;
name|t
operator|<
literal|40
condition|;
name|t
operator|++
control|)
block|{
name|s
operator|=
name|t
operator|&
literal|0x0f
expr_stmt|;
name|W
argument_list|(
name|s
argument_list|)
operator|=
name|S
argument_list|(
literal|1
argument_list|,
name|W
argument_list|(
operator|(
name|s
operator|+
literal|13
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|8
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|2
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|S
argument_list|(
literal|5
argument_list|,
name|a
argument_list|)
operator|+
name|F1
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
operator|+
name|e
operator|+
name|W
argument_list|(
name|s
argument_list|)
operator|+
name|K
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|e
operator|=
name|d
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|S
argument_list|(
literal|30
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|tmp
expr_stmt|;
block|}
for|for
control|(
name|t
operator|=
literal|40
init|;
name|t
operator|<
literal|60
condition|;
name|t
operator|++
control|)
block|{
name|s
operator|=
name|t
operator|&
literal|0x0f
expr_stmt|;
name|W
argument_list|(
name|s
argument_list|)
operator|=
name|S
argument_list|(
literal|1
argument_list|,
name|W
argument_list|(
operator|(
name|s
operator|+
literal|13
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|8
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|2
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|S
argument_list|(
literal|5
argument_list|,
name|a
argument_list|)
operator|+
name|F2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
operator|+
name|e
operator|+
name|W
argument_list|(
name|s
argument_list|)
operator|+
name|K
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|e
operator|=
name|d
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|S
argument_list|(
literal|30
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|tmp
expr_stmt|;
block|}
for|for
control|(
name|t
operator|=
literal|60
init|;
name|t
operator|<
literal|80
condition|;
name|t
operator|++
control|)
block|{
name|s
operator|=
name|t
operator|&
literal|0x0f
expr_stmt|;
name|W
argument_list|(
name|s
argument_list|)
operator|=
name|S
argument_list|(
literal|1
argument_list|,
name|W
argument_list|(
operator|(
name|s
operator|+
literal|13
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|8
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
operator|(
name|s
operator|+
literal|2
operator|)
operator|&
literal|0x0f
argument_list|)
operator|^
name|W
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|S
argument_list|(
literal|5
argument_list|,
name|a
argument_list|)
operator|+
name|F3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
operator|+
name|e
operator|+
name|W
argument_list|(
name|s
argument_list|)
operator|+
name|K
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|e
operator|=
name|d
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|S
argument_list|(
literal|30
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|tmp
expr_stmt|;
block|}
name|H
argument_list|(
literal|0
argument_list|)
operator|=
name|H
argument_list|(
literal|0
argument_list|)
operator|+
name|a
expr_stmt|;
name|H
argument_list|(
literal|1
argument_list|)
operator|=
name|H
argument_list|(
literal|1
argument_list|)
operator|+
name|b
expr_stmt|;
name|H
argument_list|(
literal|2
argument_list|)
operator|=
name|H
argument_list|(
literal|2
argument_list|)
operator|+
name|c
expr_stmt|;
name|H
argument_list|(
literal|3
argument_list|)
operator|=
name|H
argument_list|(
literal|3
argument_list|)
operator|+
name|d
expr_stmt|;
name|H
argument_list|(
literal|4
argument_list|)
operator|=
name|H
argument_list|(
literal|4
argument_list|)
operator|+
name|e
expr_stmt|;
name|bzero
argument_list|(
operator|&
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
literal|0
index|]
argument_list|,
literal|64
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*------------------------------------------------------------*/
end_comment

begin_function
name|void
name|sha1_init
parameter_list|(
name|ctxt
parameter_list|)
name|struct
name|sha1_ctxt
modifier|*
name|ctxt
decl_stmt|;
block|{
name|bzero
argument_list|(
name|ctxt
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|sha1_ctxt
argument_list|)
argument_list|)
expr_stmt|;
name|H
argument_list|(
literal|0
argument_list|)
operator|=
literal|0x67452301
expr_stmt|;
name|H
argument_list|(
literal|1
argument_list|)
operator|=
literal|0xefcdab89
expr_stmt|;
name|H
argument_list|(
literal|2
argument_list|)
operator|=
literal|0x98badcfe
expr_stmt|;
name|H
argument_list|(
literal|3
argument_list|)
operator|=
literal|0x10325476
expr_stmt|;
name|H
argument_list|(
literal|4
argument_list|)
operator|=
literal|0xc3d2e1f0
expr_stmt|;
block|}
end_function

begin_function
name|void
name|sha1_pad
parameter_list|(
name|ctxt
parameter_list|)
name|struct
name|sha1_ctxt
modifier|*
name|ctxt
decl_stmt|;
block|{
name|size_t
name|padlen
decl_stmt|;
comment|/*pad length in bytes*/
name|size_t
name|padstart
decl_stmt|;
name|PUTPAD
argument_list|(
literal|0x80
argument_list|)
expr_stmt|;
name|padstart
operator|=
name|COUNT
operator|%
literal|64
expr_stmt|;
name|padlen
operator|=
literal|64
operator|-
name|padstart
expr_stmt|;
if|if
condition|(
name|padlen
operator|<
literal|8
condition|)
block|{
name|bzero
argument_list|(
operator|&
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
name|padstart
index|]
argument_list|,
name|padlen
argument_list|)
expr_stmt|;
name|COUNT
operator|+=
name|padlen
expr_stmt|;
name|COUNT
operator|%=
literal|64
expr_stmt|;
name|sha1_step
argument_list|(
name|ctxt
argument_list|)
expr_stmt|;
name|padstart
operator|=
name|COUNT
operator|%
literal|64
expr_stmt|;
comment|/* should be 0 */
name|padlen
operator|=
literal|64
operator|-
name|padstart
expr_stmt|;
comment|/* should be 64 */
block|}
name|bzero
argument_list|(
operator|&
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
name|padstart
index|]
argument_list|,
name|padlen
operator|-
literal|8
argument_list|)
expr_stmt|;
name|COUNT
operator|+=
operator|(
name|padlen
operator|-
literal|8
operator|)
expr_stmt|;
name|COUNT
operator|%=
literal|64
expr_stmt|;
if|#
directive|if
name|BYTE_ORDER
operator|==
name|BIG_ENDIAN
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
else|#
directive|else
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|PUTPAD
argument_list|(
name|ctxt
operator|->
name|c
operator|.
name|b8
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|sha1_loop
parameter_list|(
name|ctxt
parameter_list|,
name|input
parameter_list|,
name|len
parameter_list|)
name|struct
name|sha1_ctxt
modifier|*
name|ctxt
decl_stmt|;
specifier|const
name|u_int8_t
modifier|*
name|input
decl_stmt|;
name|size_t
name|len
decl_stmt|;
block|{
name|size_t
name|gaplen
decl_stmt|;
name|size_t
name|gapstart
decl_stmt|;
name|size_t
name|off
decl_stmt|;
name|size_t
name|copysiz
decl_stmt|;
name|off
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|off
operator|<
name|len
condition|)
block|{
name|gapstart
operator|=
name|COUNT
operator|%
literal|64
expr_stmt|;
name|gaplen
operator|=
literal|64
operator|-
name|gapstart
expr_stmt|;
name|copysiz
operator|=
operator|(
name|gaplen
operator|<
name|len
operator|-
name|off
operator|)
condition|?
name|gaplen
else|:
name|len
operator|-
name|off
expr_stmt|;
name|bcopy
argument_list|(
operator|&
name|input
index|[
name|off
index|]
argument_list|,
operator|&
name|ctxt
operator|->
name|m
operator|.
name|b8
index|[
name|gapstart
index|]
argument_list|,
name|copysiz
argument_list|)
expr_stmt|;
name|COUNT
operator|+=
name|copysiz
expr_stmt|;
name|COUNT
operator|%=
literal|64
expr_stmt|;
name|ctxt
operator|->
name|c
operator|.
name|b64
index|[
literal|0
index|]
operator|+=
name|copysiz
operator|*
literal|8
expr_stmt|;
if|if
condition|(
name|COUNT
operator|%
literal|64
operator|==
literal|0
condition|)
name|sha1_step
argument_list|(
name|ctxt
argument_list|)
expr_stmt|;
name|off
operator|+=
name|copysiz
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|sha1_result
parameter_list|(
name|ctxt
parameter_list|,
name|digest0
parameter_list|)
name|struct
name|sha1_ctxt
modifier|*
name|ctxt
decl_stmt|;
name|caddr_t
name|digest0
decl_stmt|;
block|{
name|u_int8_t
modifier|*
name|digest
decl_stmt|;
name|digest
operator|=
operator|(
name|u_int8_t
operator|*
operator|)
name|digest0
expr_stmt|;
name|sha1_pad
argument_list|(
name|ctxt
argument_list|)
expr_stmt|;
if|#
directive|if
name|BYTE_ORDER
operator|==
name|BIG_ENDIAN
name|bcopy
argument_list|(
operator|&
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|0
index|]
argument_list|,
name|digest
argument_list|,
literal|20
argument_list|)
expr_stmt|;
else|#
directive|else
name|digest
index|[
literal|0
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|3
index|]
expr_stmt|;
name|digest
index|[
literal|1
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|2
index|]
expr_stmt|;
name|digest
index|[
literal|2
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|1
index|]
expr_stmt|;
name|digest
index|[
literal|3
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|0
index|]
expr_stmt|;
name|digest
index|[
literal|4
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|7
index|]
expr_stmt|;
name|digest
index|[
literal|5
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|6
index|]
expr_stmt|;
name|digest
index|[
literal|6
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|5
index|]
expr_stmt|;
name|digest
index|[
literal|7
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|4
index|]
expr_stmt|;
name|digest
index|[
literal|8
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|11
index|]
expr_stmt|;
name|digest
index|[
literal|9
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|10
index|]
expr_stmt|;
name|digest
index|[
literal|10
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|9
index|]
expr_stmt|;
name|digest
index|[
literal|11
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|8
index|]
expr_stmt|;
name|digest
index|[
literal|12
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|15
index|]
expr_stmt|;
name|digest
index|[
literal|13
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|14
index|]
expr_stmt|;
name|digest
index|[
literal|14
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|13
index|]
expr_stmt|;
name|digest
index|[
literal|15
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|12
index|]
expr_stmt|;
name|digest
index|[
literal|16
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|19
index|]
expr_stmt|;
name|digest
index|[
literal|17
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|18
index|]
expr_stmt|;
name|digest
index|[
literal|18
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|17
index|]
expr_stmt|;
name|digest
index|[
literal|19
index|]
operator|=
name|ctxt
operator|->
name|h
operator|.
name|b8
index|[
literal|16
index|]
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*unsupported*/
end_comment

end_unit

