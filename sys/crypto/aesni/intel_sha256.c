begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************* * Copyright (c) 2013, Intel Corporation  *  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without * modification, are permitted provided that the following conditions are * met:  *  * * Redistributions of source code must retain the above copyright *   notice, this list of conditions and the following disclaimer.   *  * * Redistributions in binary form must reproduce the above copyright *   notice, this list of conditions and the following disclaimer in the *   documentation and/or other materials provided with the *   distribution.  *  * * Neither the name of the Intel Corporation nor the names of its *   contributors may be used to endorse or promote products derived from *   this software without specific prior written permission.  *  *  * THIS SOFTWARE IS PROVIDED BY INTEL CORPORATION ""AS IS"" AND ANY * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL CORPORATION OR * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. ******************************************************************************** * * Intel SHA Extensions optimized implementation of a SHA-256 update function  * * The function takes a pointer to the current hash values, a pointer to the  * input data, and a number of 64 byte blocks to process.  Once all blocks have  * been processed, the digest pointer is  updated with the resulting hash value. * The function only processes complete blocks, there is no functionality to  * store partial blocks.  All message padding and hash value initialization must * be done outside the update function.   * * The indented lines in the loop are instructions related to rounds processing. * The non-indented lines are instructions related to the message schedule. * * Author: Sean Gulley<sean.m.gulley@intel.com> * Date:   July 2013 * ******************************************************************************** * * Example complier command line: * icc intel_sha_extensions_sha256_intrinsic.c * gcc -msha -msse4 intel_sha_extensions_sha256_intrinsic.c * *******************************************************************************/
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<immintrin.h>
end_include

begin_include
include|#
directive|include
file|<crypto/aesni/sha_sse.h>
end_include

begin_function
name|void
name|intel_sha256_step
parameter_list|(
name|uint32_t
modifier|*
name|digest
parameter_list|,
specifier|const
name|char
modifier|*
name|data
parameter_list|,
name|uint32_t
name|num_blks
parameter_list|)
block|{
name|__m128i
name|state0
decl_stmt|,
name|state1
decl_stmt|;
name|__m128i
name|msg
decl_stmt|;
name|__m128i
name|msgtmp0
decl_stmt|,
name|msgtmp1
decl_stmt|,
name|msgtmp2
decl_stmt|,
name|msgtmp3
decl_stmt|;
name|__m128i
name|tmp
decl_stmt|;
name|__m128i
name|shuf_mask
decl_stmt|;
name|__m128i
name|abef_save
decl_stmt|,
name|cdgh_save
decl_stmt|;
comment|// Load initial hash values
comment|// Need to reorder these appropriately
comment|// DCBA, HGFE -> ABEF, CDGH
name|tmp
operator|=
name|_mm_loadu_si128
argument_list|(
operator|(
name|__m128i
operator|*
operator|)
name|digest
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_loadu_si128
argument_list|(
operator|(
name|__m128i
operator|*
operator|)
operator|(
name|digest
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|tmp
argument_list|,
literal|0xB1
argument_list|)
expr_stmt|;
comment|// CDAB
name|state1
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|state1
argument_list|,
literal|0x1B
argument_list|)
expr_stmt|;
comment|// EFGH
name|state0
operator|=
name|_mm_alignr_epi8
argument_list|(
name|tmp
argument_list|,
name|state1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|// ABEF
name|state1
operator|=
name|_mm_blend_epi16
argument_list|(
name|state1
argument_list|,
name|tmp
argument_list|,
literal|0xF0
argument_list|)
expr_stmt|;
comment|// CDGH
name|shuf_mask
operator|=
name|_mm_set_epi64x
argument_list|(
literal|0x0c0d0e0f08090a0bull
argument_list|,
literal|0x0405060700010203ull
argument_list|)
expr_stmt|;
while|while
condition|(
name|num_blks
operator|>
literal|0
condition|)
block|{
comment|// Save hash values for addition after rounds
name|abef_save
operator|=
name|state0
expr_stmt|;
name|cdgh_save
operator|=
name|state1
expr_stmt|;
comment|// Rounds 0-3
name|msg
operator|=
name|_mm_loadu_si128
argument_list|(
operator|(
specifier|const
name|__m128i
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_shuffle_epi8
argument_list|(
name|msg
argument_list|,
name|shuf_mask
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0xE9B5DBA5B5C0FBCFull
argument_list|,
literal|0x71374491428A2F98ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
comment|// Rounds 4-7
name|msgtmp1
operator|=
name|_mm_loadu_si128
argument_list|(
operator|(
specifier|const
name|__m128i
operator|*
operator|)
operator|(
name|data
operator|+
literal|16
operator|)
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_shuffle_epi8
argument_list|(
name|msgtmp1
argument_list|,
name|shuf_mask
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0xAB1C5ED5923F82A4ull
argument_list|,
literal|0x59F111F13956C25Bull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp1
argument_list|)
expr_stmt|;
comment|// Rounds 8-11
name|msgtmp2
operator|=
name|_mm_loadu_si128
argument_list|(
operator|(
specifier|const
name|__m128i
operator|*
operator|)
operator|(
name|data
operator|+
literal|32
operator|)
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_shuffle_epi8
argument_list|(
name|msgtmp2
argument_list|,
name|shuf_mask
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x550C7DC3243185BEull
argument_list|,
literal|0x12835B01D807AA98ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp2
argument_list|)
expr_stmt|;
comment|// Rounds 12-15
name|msgtmp3
operator|=
name|_mm_loadu_si128
argument_list|(
operator|(
specifier|const
name|__m128i
operator|*
operator|)
operator|(
name|data
operator|+
literal|48
operator|)
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_shuffle_epi8
argument_list|(
name|msgtmp3
argument_list|,
name|shuf_mask
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0xC19BF1749BDC06A7ull
argument_list|,
literal|0x80DEB1FE72BE5D74ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp3
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp3
argument_list|)
expr_stmt|;
comment|// Rounds 16-19
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x240CA1CC0FC19DC6ull
argument_list|,
literal|0xEFBE4786E49B69C1ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp3
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp0
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp0
argument_list|)
expr_stmt|;
comment|// Rounds 20-23
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x76F988DA5CB0A9DCull
argument_list|,
literal|0x4A7484AA2DE92C6Full
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp1
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp1
argument_list|)
expr_stmt|;
comment|// Rounds 24-27
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0xBF597FC7B00327C8ull
argument_list|,
literal|0xA831C66D983E5152ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp2
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp2
argument_list|)
expr_stmt|;
comment|// Rounds 28-31
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x1429296706CA6351ull
argument_list|,
literal|0xD5A79147C6E00BF3ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp3
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp3
argument_list|)
expr_stmt|;
comment|// Rounds 32-35
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x53380D134D2C6DFCull
argument_list|,
literal|0x2E1B213827B70A85ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp3
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp0
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp0
argument_list|)
expr_stmt|;
comment|// Rounds 36-39
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x92722C8581C2C92Eull
argument_list|,
literal|0x766A0ABB650A7354ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp1
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp1
argument_list|)
expr_stmt|;
comment|// Rounds 40-43
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0xC76C51A3C24B8B70ull
argument_list|,
literal|0xA81A664BA2BFE8A1ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp2
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp2
argument_list|)
expr_stmt|;
comment|// Rounds 44-47
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x106AA070F40E3585ull
argument_list|,
literal|0xD6990624D192E819ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp0
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp3
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp3
argument_list|)
expr_stmt|;
comment|// Rounds 48-51
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp0
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x34B0BCB52748774Cull
argument_list|,
literal|0x1E376C0819A4C116ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp0
argument_list|,
name|msgtmp3
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp1
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp0
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_sha256msg1_epu32
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp0
argument_list|)
expr_stmt|;
comment|// Rounds 52-55
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp1
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x682E6FF35B9CCA4Full
argument_list|,
literal|0x4ED8AA4A391C0CB3ull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp1
argument_list|,
name|msgtmp0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp2
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp1
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
comment|// Rounds 56-59
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp2
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0x8CC7020884C87814ull
argument_list|,
literal|0x78A5636F748F82EEull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|_mm_alignr_epi8
argument_list|(
name|msgtmp2
argument_list|,
name|msgtmp1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|msgtmp3
operator|=
name|_mm_sha256msg2_epu32
argument_list|(
name|msgtmp3
argument_list|,
name|msgtmp2
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
comment|// Rounds 60-63
name|msg
operator|=
name|_mm_add_epi32
argument_list|(
name|msgtmp3
argument_list|,
name|_mm_set_epi64x
argument_list|(
literal|0xC67178F2BEF9A3F7ull
argument_list|,
literal|0xA4506CEB90BEFFFAull
argument_list|)
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state1
argument_list|,
name|state0
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|msg
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|msg
argument_list|,
literal|0x0E
argument_list|)
expr_stmt|;
name|state0
operator|=
name|_mm_sha256rnds2_epu32
argument_list|(
name|state0
argument_list|,
name|state1
argument_list|,
name|msg
argument_list|)
expr_stmt|;
comment|// Add current hash values with previously saved
name|state0
operator|=
name|_mm_add_epi32
argument_list|(
name|state0
argument_list|,
name|abef_save
argument_list|)
expr_stmt|;
name|state1
operator|=
name|_mm_add_epi32
argument_list|(
name|state1
argument_list|,
name|cdgh_save
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|64
expr_stmt|;
name|num_blks
operator|--
expr_stmt|;
block|}
comment|// Write hash values back in the correct order
name|tmp
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|state0
argument_list|,
literal|0x1B
argument_list|)
expr_stmt|;
comment|// FEBA
name|state1
operator|=
name|_mm_shuffle_epi32
argument_list|(
name|state1
argument_list|,
literal|0xB1
argument_list|)
expr_stmt|;
comment|// DCHG
name|state0
operator|=
name|_mm_blend_epi16
argument_list|(
name|tmp
argument_list|,
name|state1
argument_list|,
literal|0xF0
argument_list|)
expr_stmt|;
comment|// DCBA
name|state1
operator|=
name|_mm_alignr_epi8
argument_list|(
name|state1
argument_list|,
name|tmp
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|// ABEF
name|_mm_store_si128
argument_list|(
operator|(
name|__m128i
operator|*
operator|)
name|digest
argument_list|,
name|state0
argument_list|)
expr_stmt|;
name|_mm_store_si128
argument_list|(
operator|(
name|__m128i
operator|*
operator|)
operator|(
name|digest
operator|+
literal|4
operator|)
argument_list|,
name|state1
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

