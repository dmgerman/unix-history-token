begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2016 Ruslan Bukin<br@bsdpad.com>  * All rights reserved.  *  * Portions of this software were developed by SRI International and the  * University of Cambridge Computer Laboratory under DARPA/AFRL contract  * FA8750-10-C-0237 ("CTSRD"), as part of the DARPA CRASH research programme.  *  * Portions of this software were developed by the University of Cambridge  * Computer Laboratory as part of the CTSRD Project, with support from the  * UK Higher Education Innovation Fund (HEIF).  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<ddb/ddb.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_access.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_sym.h>
end_include

begin_include
include|#
directive|include
file|<machine/riscvreg.h>
end_include

begin_include
include|#
directive|include
file|<machine/riscv_opcode.h>
end_include

begin_struct
struct|struct
name|riscv_op
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|type
decl_stmt|;
name|char
modifier|*
name|fmt
decl_stmt|;
name|int
name|opcode
decl_stmt|;
name|int
name|funct3
decl_stmt|;
name|int
name|funct7
decl_stmt|;
comment|/* Or imm, depending on type. */
block|}
struct|;
end_struct

begin_comment
comment|/*  * Keep sorted by opcode, funct3, funct7 so some instructions  * aliases will be supported (e.g. "mv" instruction alias)  * Use same print format as binutils do.  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|riscv_op
name|riscv_opcodes
index|[]
init|=
block|{
block|{
literal|"lb"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"lh"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"lw"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|2
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"ld"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|3
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"lbu"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|4
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"lhu"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|5
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"lwu"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|6
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"ldu"
block|,
literal|"I"
block|,
literal|"d,o(s)"
block|,
literal|3
block|,
literal|7
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"fence"
block|,
literal|"I"
block|,
literal|""
block|,
literal|15
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"fence.i"
block|,
literal|"I"
block|,
literal|""
block|,
literal|15
block|,
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"mv"
block|,
literal|"I"
block|,
literal|"d,s"
block|,
literal|19
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"addi"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|19
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"slli"
block|,
literal|"R2"
block|,
literal|"d,s,>"
block|,
literal|19
block|,
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"slti"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|19
block|,
literal|2
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sltiu"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|19
block|,
literal|3
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"xori"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|19
block|,
literal|4
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"srli"
block|,
literal|"R2"
block|,
literal|"d,s,>"
block|,
literal|19
block|,
literal|5
block|,
literal|0
block|}
block|,
block|{
literal|"srai"
block|,
literal|"R2"
block|,
literal|"d,s,>"
block|,
literal|19
block|,
literal|5
block|,
literal|0b010000
block|}
block|,
block|{
literal|"ori"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|19
block|,
literal|6
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"andi"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|19
block|,
literal|7
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"auipc"
block|,
literal|"U"
block|,
literal|"d,u"
block|,
literal|23
block|,
operator|-
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sext.w"
block|,
literal|"I"
block|,
literal|"d,s"
block|,
literal|27
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"addiw"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|27
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"slliw"
block|,
literal|"R"
block|,
literal|"d,s,<"
block|,
literal|27
block|,
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"srliw"
block|,
literal|"R"
block|,
literal|"d,s,<"
block|,
literal|27
block|,
literal|5
block|,
literal|0
block|}
block|,
block|{
literal|"sraiw"
block|,
literal|"R"
block|,
literal|"d,s,<"
block|,
literal|27
block|,
literal|5
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"sb"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sh"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sw"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|2
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sd"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|3
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sbu"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|4
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"shu"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|5
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"swu"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|6
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"sdu"
block|,
literal|"S"
block|,
literal|"t,q(s)"
block|,
literal|35
block|,
literal|7
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"lr.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0001000
block|}
block|,
block|{
literal|"sc.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0001100
block|}
block|,
block|{
literal|"amoswap.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0000100
block|}
block|,
block|{
literal|"amoadd.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0000000
block|}
block|,
block|{
literal|"amoxor.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0010000
block|}
block|,
block|{
literal|"amoand.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0110000
block|}
block|,
block|{
literal|"amoor.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"amomin.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1000000
block|}
block|,
block|{
literal|"amomax.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1010000
block|}
block|,
block|{
literal|"amominu.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1100000
block|}
block|,
block|{
literal|"amomaxu.w"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1110000
block|}
block|,
block|{
literal|"lr.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0001000
block|}
block|,
block|{
literal|"sc.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0001100
block|}
block|,
block|{
literal|"amoswap.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0000110
block|}
block|,
block|{
literal|"amoadd.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0000010
block|}
block|,
block|{
literal|"amoxor.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0010010
block|}
block|,
block|{
literal|"amoand.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0110010
block|}
block|,
block|{
literal|"amoor.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0100010
block|}
block|,
block|{
literal|"amomin.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1000010
block|}
block|,
block|{
literal|"amomax.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1010010
block|}
block|,
block|{
literal|"amominu.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1100010
block|}
block|,
block|{
literal|"amomaxu.w.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1110010
block|}
block|,
block|{
literal|"amoswap.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0000110
block|}
block|,
block|{
literal|"amoadd.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0000001
block|}
block|,
block|{
literal|"amoxor.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0010001
block|}
block|,
block|{
literal|"amoand.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0110001
block|}
block|,
block|{
literal|"amoor.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b0100001
block|}
block|,
block|{
literal|"amomin.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1000001
block|}
block|,
block|{
literal|"amomax.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1010001
block|}
block|,
block|{
literal|"amominu.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1100001
block|}
block|,
block|{
literal|"amomaxu.w.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|2
block|,
literal|0b1110001
block|}
block|,
block|{
literal|"amoswap.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0000100
block|}
block|,
block|{
literal|"amoadd.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0000000
block|}
block|,
block|{
literal|"amoxor.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0010000
block|}
block|,
block|{
literal|"amoand.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0110000
block|}
block|,
block|{
literal|"amoor.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"amomin.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1000000
block|}
block|,
block|{
literal|"amomax.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1010000
block|}
block|,
block|{
literal|"amominu.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1100000
block|}
block|,
block|{
literal|"amomaxu.d"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1110000
block|}
block|,
block|{
literal|"lr.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0001000
block|}
block|,
block|{
literal|"sc.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0001100
block|}
block|,
block|{
literal|"amoswap.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0000110
block|}
block|,
block|{
literal|"amoadd.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0000010
block|}
block|,
block|{
literal|"amoxor.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0010010
block|}
block|,
block|{
literal|"amoand.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0110010
block|}
block|,
block|{
literal|"amoor.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0100010
block|}
block|,
block|{
literal|"amomin.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1000010
block|}
block|,
block|{
literal|"amomax.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1010010
block|}
block|,
block|{
literal|"amominu.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1100010
block|}
block|,
block|{
literal|"amomaxu.d.aq"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1110010
block|}
block|,
block|{
literal|"amoswap.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0000110
block|}
block|,
block|{
literal|"amoadd.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0000001
block|}
block|,
block|{
literal|"amoxor.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0010001
block|}
block|,
block|{
literal|"amoand.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0110001
block|}
block|,
block|{
literal|"amoor.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b0100001
block|}
block|,
block|{
literal|"amomin.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1000001
block|}
block|,
block|{
literal|"amomax.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1010001
block|}
block|,
block|{
literal|"amominu.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1100001
block|}
block|,
block|{
literal|"amomaxu.d.rl"
block|,
literal|"R"
block|,
literal|"d,t,0(s)"
block|,
literal|47
block|,
literal|3
block|,
literal|0b1110001
block|}
block|,
block|{
literal|"add"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"sub"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|0
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"mul"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|0
block|,
literal|0b0000001
block|}
block|,
block|{
literal|"sll"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"slt"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|2
block|,
literal|0
block|}
block|,
block|{
literal|"sltu"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|3
block|,
literal|0
block|}
block|,
block|{
literal|"xor"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|4
block|,
literal|0
block|}
block|,
block|{
literal|"srl"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|5
block|,
literal|0
block|}
block|,
block|{
literal|"sra"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|5
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"or"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|6
block|,
literal|0
block|}
block|,
block|{
literal|"and"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|51
block|,
literal|7
block|,
literal|0
block|}
block|,
block|{
literal|"lui"
block|,
literal|"U"
block|,
literal|"d,u"
block|,
literal|55
block|,
operator|-
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"addw"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|59
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"subw"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|59
block|,
literal|0
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"mulw"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|59
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"sllw"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|59
block|,
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"srlw"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|59
block|,
literal|5
block|,
literal|0
block|}
block|,
block|{
literal|"sraw"
block|,
literal|"R"
block|,
literal|"d,s,t"
block|,
literal|59
block|,
literal|5
block|,
literal|0b0100000
block|}
block|,
block|{
literal|"beq"
block|,
literal|"SB"
block|,
literal|"s,t,p"
block|,
literal|99
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"bne"
block|,
literal|"SB"
block|,
literal|"s,t,p"
block|,
literal|99
block|,
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"blt"
block|,
literal|"SB"
block|,
literal|"s,t,p"
block|,
literal|99
block|,
literal|4
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"bge"
block|,
literal|"SB"
block|,
literal|"s,t,p"
block|,
literal|99
block|,
literal|5
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"bltu"
block|,
literal|"SB"
block|,
literal|"s,t,p"
block|,
literal|99
block|,
literal|6
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"bgeu"
block|,
literal|"SB"
block|,
literal|"s,t,p"
block|,
literal|99
block|,
literal|7
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"jalr"
block|,
literal|"I"
block|,
literal|"d,s,j"
block|,
literal|103
block|,
literal|0
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"jal"
block|,
literal|"UJ"
block|,
literal|"a"
block|,
literal|111
block|,
operator|-
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"eret"
block|,
literal|"I"
block|,
literal|""
block|,
literal|115
block|,
literal|0
block|,
literal|0b000100000000
block|}
block|,
block|{
literal|"sfence.vm"
block|,
literal|"I"
block|,
literal|""
block|,
literal|115
block|,
literal|0
block|,
literal|0b000100000001
block|}
block|,
block|{
literal|"wfi"
block|,
literal|"I"
block|,
literal|""
block|,
literal|115
block|,
literal|0
block|,
literal|0b000100000010
block|}
block|,
block|{
literal|"csrrw"
block|,
literal|"I"
block|,
literal|"d,E,s"
block|,
literal|115
block|,
literal|1
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"csrrs"
block|,
literal|"I"
block|,
literal|"d,E,s"
block|,
literal|115
block|,
literal|2
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"csrrc"
block|,
literal|"I"
block|,
literal|"d,E,s"
block|,
literal|115
block|,
literal|3
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"csrrwi"
block|,
literal|"I"
block|,
literal|"d,E,Z"
block|,
literal|115
block|,
literal|5
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"csrrsi"
block|,
literal|"I"
block|,
literal|"d,E,Z"
block|,
literal|115
block|,
literal|6
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|"csrrci"
block|,
literal|"I"
block|,
literal|"d,E,Z"
block|,
literal|115
block|,
literal|7
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|csr_op
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|imm
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|csr_op
name|csr_name
index|[]
init|=
block|{
block|{
literal|"fflags"
block|,
literal|0x001
block|}
block|,
block|{
literal|"frm"
block|,
literal|0x002
block|}
block|,
block|{
literal|"fcsr"
block|,
literal|0x003
block|}
block|,
block|{
literal|"cycle"
block|,
literal|0xc00
block|}
block|,
block|{
literal|"time"
block|,
literal|0xc01
block|}
block|,
block|{
literal|"instret"
block|,
literal|0xc02
block|}
block|,
block|{
literal|"stats"
block|,
literal|0x0c0
block|}
block|,
block|{
literal|"uarch0"
block|,
literal|0xcc0
block|}
block|,
block|{
literal|"uarch1"
block|,
literal|0xcc1
block|}
block|,
block|{
literal|"uarch2"
block|,
literal|0xcc2
block|}
block|,
block|{
literal|"uarch3"
block|,
literal|0xcc3
block|}
block|,
block|{
literal|"uarch4"
block|,
literal|0xcc4
block|}
block|,
block|{
literal|"uarch5"
block|,
literal|0xcc5
block|}
block|,
block|{
literal|"uarch6"
block|,
literal|0xcc6
block|}
block|,
block|{
literal|"uarch7"
block|,
literal|0xcc7
block|}
block|,
block|{
literal|"uarch8"
block|,
literal|0xcc8
block|}
block|,
block|{
literal|"uarch9"
block|,
literal|0xcc9
block|}
block|,
block|{
literal|"uarch10"
block|,
literal|0xcca
block|}
block|,
block|{
literal|"uarch11"
block|,
literal|0xccb
block|}
block|,
block|{
literal|"uarch12"
block|,
literal|0xccc
block|}
block|,
block|{
literal|"uarch13"
block|,
literal|0xccd
block|}
block|,
block|{
literal|"uarch14"
block|,
literal|0xcce
block|}
block|,
block|{
literal|"uarch15"
block|,
literal|0xccf
block|}
block|,
block|{
literal|"sstatus"
block|,
literal|0x100
block|}
block|,
block|{
literal|"stvec"
block|,
literal|0x101
block|}
block|,
block|{
literal|"sie"
block|,
literal|0x104
block|}
block|,
block|{
literal|"sscratch"
block|,
literal|0x140
block|}
block|,
block|{
literal|"sepc"
block|,
literal|0x141
block|}
block|,
block|{
literal|"sip"
block|,
literal|0x144
block|}
block|,
block|{
literal|"sptbr"
block|,
literal|0x180
block|}
block|,
block|{
literal|"sasid"
block|,
literal|0x181
block|}
block|,
block|{
literal|"cyclew"
block|,
literal|0x900
block|}
block|,
block|{
literal|"timew"
block|,
literal|0x901
block|}
block|,
block|{
literal|"instretw"
block|,
literal|0x902
block|}
block|,
block|{
literal|"stime"
block|,
literal|0xd01
block|}
block|,
block|{
literal|"scause"
block|,
literal|0xd42
block|}
block|,
block|{
literal|"sbadaddr"
block|,
literal|0xd43
block|}
block|,
block|{
literal|"stimew"
block|,
literal|0xa01
block|}
block|,
block|{
literal|"mstatus"
block|,
literal|0x300
block|}
block|,
block|{
literal|"mtvec"
block|,
literal|0x301
block|}
block|,
block|{
literal|"mtdeleg"
block|,
literal|0x302
block|}
block|,
block|{
literal|"mie"
block|,
literal|0x304
block|}
block|,
block|{
literal|"mtimecmp"
block|,
literal|0x321
block|}
block|,
block|{
literal|"mscratch"
block|,
literal|0x340
block|}
block|,
block|{
literal|"mepc"
block|,
literal|0x341
block|}
block|,
block|{
literal|"mcause"
block|,
literal|0x342
block|}
block|,
block|{
literal|"mbadaddr"
block|,
literal|0x343
block|}
block|,
block|{
literal|"mip"
block|,
literal|0x344
block|}
block|,
block|{
literal|"mtime"
block|,
literal|0x701
block|}
block|,
block|{
literal|"mcpuid"
block|,
literal|0xf00
block|}
block|,
block|{
literal|"mimpid"
block|,
literal|0xf01
block|}
block|,
block|{
literal|"mhartid"
block|,
literal|0xf10
block|}
block|,
block|{
literal|"mtohost"
block|,
literal|0x780
block|}
block|,
block|{
literal|"mfromhost"
block|,
literal|0x781
block|}
block|,
block|{
literal|"mreset"
block|,
literal|0x782
block|}
block|,
block|{
literal|"send_ipi"
block|,
literal|0x783
block|}
block|,
block|{
literal|"miobase"
block|,
literal|0x784
block|}
block|,
block|{
literal|"cycleh"
block|,
literal|0xc80
block|}
block|,
block|{
literal|"timeh"
block|,
literal|0xc81
block|}
block|,
block|{
literal|"instreth"
block|,
literal|0xc82
block|}
block|,
block|{
literal|"cyclehw"
block|,
literal|0x980
block|}
block|,
block|{
literal|"timehw"
block|,
literal|0x981
block|}
block|,
block|{
literal|"instrethw"
block|,
literal|0x982
block|}
block|,
block|{
literal|"stimeh"
block|,
literal|0xd81
block|}
block|,
block|{
literal|"stimehw"
block|,
literal|0xa81
block|}
block|,
block|{
literal|"mtimecmph"
block|,
literal|0x361
block|}
block|,
block|{
literal|"mtimeh"
block|,
literal|0x741
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|reg_name
index|[
literal|32
index|]
init|=
block|{
literal|"zero"
block|,
literal|"ra"
block|,
literal|"sp"
block|,
literal|"gp"
block|,
literal|"tp"
block|,
literal|"t0"
block|,
literal|"t1"
block|,
literal|"t2"
block|,
literal|"s0"
block|,
literal|"s1"
block|,
literal|"a0"
block|,
literal|"a1"
block|,
literal|"a2"
block|,
literal|"a3"
block|,
literal|"a4"
block|,
literal|"a5"
block|,
literal|"a6"
block|,
literal|"a7"
block|,
literal|"s2"
block|,
literal|"s3"
block|,
literal|"s4"
block|,
literal|"s5"
block|,
literal|"s6"
block|,
literal|"s7"
block|,
literal|"s8"
block|,
literal|"s9"
block|,
literal|"s10"
block|,
literal|"s11"
block|,
literal|"t3"
block|,
literal|"t4"
block|,
literal|"t5"
block|,
literal|"t6"
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int32_t
name|get_imm
parameter_list|(
name|InstFmt
name|i
parameter_list|,
name|char
modifier|*
name|type
parameter_list|,
name|uint32_t
modifier|*
name|val
parameter_list|)
block|{
name|int
name|imm
decl_stmt|;
name|imm
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|type
argument_list|,
literal|"I"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|imm
operator|=
name|i
operator|.
name|IType
operator|.
name|imm
expr_stmt|;
operator|*
name|val
operator|=
name|imm
expr_stmt|;
if|if
condition|(
name|imm
operator|&
operator|(
literal|1
operator|<<
literal|11
operator|)
condition|)
name|imm
operator||=
operator|(
literal|0xfffff
operator|<<
literal|12
operator|)
expr_stmt|;
comment|/* sign extend */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|type
argument_list|,
literal|"S"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|imm
operator|=
name|i
operator|.
name|SType
operator|.
name|imm0_4
expr_stmt|;
name|imm
operator||=
operator|(
name|i
operator|.
name|SType
operator|.
name|imm5_11
operator|<<
literal|5
operator|)
expr_stmt|;
operator|*
name|val
operator|=
name|imm
expr_stmt|;
if|if
condition|(
name|imm
operator|&
operator|(
literal|1
operator|<<
literal|11
operator|)
condition|)
name|imm
operator||=
operator|(
literal|0xfffff
operator|<<
literal|12
operator|)
expr_stmt|;
comment|/* sign extend */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|type
argument_list|,
literal|"U"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|imm
operator|=
name|i
operator|.
name|UType
operator|.
name|imm12_31
expr_stmt|;
operator|*
name|val
operator|=
name|imm
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|type
argument_list|,
literal|"UJ"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|imm
operator|=
name|i
operator|.
name|UJType
operator|.
name|imm12_19
operator|<<
literal|12
expr_stmt|;
name|imm
operator||=
name|i
operator|.
name|UJType
operator|.
name|imm11
operator|<<
literal|11
expr_stmt|;
name|imm
operator||=
name|i
operator|.
name|UJType
operator|.
name|imm1_10
operator|<<
literal|1
expr_stmt|;
name|imm
operator||=
name|i
operator|.
name|UJType
operator|.
name|imm20
operator|<<
literal|20
expr_stmt|;
operator|*
name|val
operator|=
name|imm
expr_stmt|;
if|if
condition|(
name|imm
operator|&
operator|(
literal|1
operator|<<
literal|20
operator|)
condition|)
name|imm
operator||=
operator|(
literal|0xfff
operator|<<
literal|21
operator|)
expr_stmt|;
comment|/* sign extend */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|type
argument_list|,
literal|"SB"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|imm
operator|=
name|i
operator|.
name|SBType
operator|.
name|imm11
operator|<<
literal|11
expr_stmt|;
name|imm
operator||=
name|i
operator|.
name|SBType
operator|.
name|imm1_4
operator|<<
literal|1
expr_stmt|;
name|imm
operator||=
name|i
operator|.
name|SBType
operator|.
name|imm5_10
operator|<<
literal|5
expr_stmt|;
name|imm
operator||=
name|i
operator|.
name|SBType
operator|.
name|imm12
operator|<<
literal|12
expr_stmt|;
operator|*
name|val
operator|=
name|imm
expr_stmt|;
if|if
condition|(
name|imm
operator|&
operator|(
literal|1
operator|<<
literal|12
operator|)
condition|)
name|imm
operator||=
operator|(
literal|0xfffff
operator|<<
literal|12
operator|)
expr_stmt|;
comment|/* sign extend */
block|}
return|return
operator|(
name|imm
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|oprint
parameter_list|(
name|struct
name|riscv_op
modifier|*
name|op
parameter_list|,
name|vm_offset_t
name|loc
parameter_list|,
name|int
name|rd
parameter_list|,
name|int
name|rs1
parameter_list|,
name|int
name|rs2
parameter_list|,
name|uint32_t
name|val
parameter_list|,
name|vm_offset_t
name|imm
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|i
decl_stmt|;
name|p
operator|=
name|op
operator|->
name|fmt
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s\t"
argument_list|,
name|op
operator|->
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
literal|"d"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%s"
argument_list|,
name|reg_name
index|[
name|rd
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"s"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%s"
argument_list|,
name|reg_name
index|[
name|rs1
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"t"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%s"
argument_list|,
name|reg_name
index|[
name|rs2
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|">"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"0x%x"
argument_list|,
name|rs2
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"E"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|csr_name
index|[
name|i
index|]
operator|.
name|name
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|csr_name
index|[
name|i
index|]
operator|.
name|imm
operator|==
name|val
condition|)
name|db_printf
argument_list|(
literal|"%s"
argument_list|,
name|csr_name
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"Z"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%d"
argument_list|,
name|rs1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"<"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"0x%x"
argument_list|,
name|rs2
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"j"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%d"
argument_list|,
name|imm
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"u"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"0x%x"
argument_list|,
name|imm
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"a"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"0x%016lx"
argument_list|,
name|imm
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"p"
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"0x%016lx"
argument_list|,
operator|(
name|loc
operator|+
name|imm
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strlen
argument_list|(
name|p
argument_list|)
operator|>=
literal|4
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
literal|"o(s)"
argument_list|,
name|p
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%d(%s)"
argument_list|,
name|imm
argument_list|,
name|reg_name
index|[
name|rs1
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"q(s)"
argument_list|,
name|p
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"%d(%s)"
argument_list|,
name|imm
argument_list|,
name|reg_name
index|[
name|rs1
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"0(s)"
argument_list|,
name|p
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
name|db_printf
argument_list|(
literal|"(%s)"
argument_list|,
name|reg_name
index|[
name|rs1
index|]
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|p
operator|&&
name|strncmp
argument_list|(
name|p
argument_list|,
literal|","
argument_list|,
literal|1
argument_list|)
operator|!=
literal|0
condition|)
name|p
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|p
condition|)
block|{
name|db_printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|match_type
parameter_list|(
name|InstFmt
name|i
parameter_list|,
name|struct
name|riscv_op
modifier|*
name|op
parameter_list|,
name|vm_offset_t
name|loc
parameter_list|)
block|{
name|uint32_t
name|val
decl_stmt|;
name|int
name|found
decl_stmt|;
name|int
name|imm
decl_stmt|;
name|val
operator|=
literal|0
expr_stmt|;
name|imm
operator|=
name|get_imm
argument_list|(
name|i
argument_list|,
name|op
operator|->
name|type
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"U"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
name|i
operator|.
name|UType
operator|.
name|rd
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|val
argument_list|,
name|imm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"UJ"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|val
argument_list|,
operator|(
name|loc
operator|+
name|imm
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"I"
argument_list|)
operator|==
literal|0
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct3
operator|==
name|i
operator|.
name|IType
operator|.
name|funct3
operator|)
condition|)
block|{
name|found
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|op
operator|->
name|funct7
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|op
operator|->
name|funct7
operator|==
name|i
operator|.
name|IType
operator|.
name|imm
condition|)
name|found
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|found
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|found
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
name|i
operator|.
name|IType
operator|.
name|rd
argument_list|,
name|i
operator|.
name|IType
operator|.
name|rs1
argument_list|,
literal|0
argument_list|,
name|val
argument_list|,
name|imm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"S"
argument_list|)
operator|==
literal|0
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct3
operator|==
name|i
operator|.
name|SType
operator|.
name|funct3
operator|)
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
literal|0
argument_list|,
name|i
operator|.
name|SType
operator|.
name|rs1
argument_list|,
name|i
operator|.
name|SType
operator|.
name|rs2
argument_list|,
name|val
argument_list|,
name|imm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"SB"
argument_list|)
operator|==
literal|0
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct3
operator|==
name|i
operator|.
name|SBType
operator|.
name|funct3
operator|)
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
literal|0
argument_list|,
name|i
operator|.
name|SBType
operator|.
name|rs1
argument_list|,
name|i
operator|.
name|SBType
operator|.
name|rs2
argument_list|,
name|val
argument_list|,
name|imm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"R2"
argument_list|)
operator|==
literal|0
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct3
operator|==
name|i
operator|.
name|R2Type
operator|.
name|funct3
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct7
operator|==
name|i
operator|.
name|R2Type
operator|.
name|funct7
operator|)
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
name|i
operator|.
name|R2Type
operator|.
name|rd
argument_list|,
name|i
operator|.
name|R2Type
operator|.
name|rs1
argument_list|,
name|i
operator|.
name|R2Type
operator|.
name|rs2
argument_list|,
name|val
argument_list|,
name|imm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|op
operator|->
name|type
argument_list|,
literal|"R"
argument_list|)
operator|==
literal|0
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct3
operator|==
name|i
operator|.
name|RType
operator|.
name|funct3
operator|)
operator|&&
expr|\
operator|(
name|op
operator|->
name|funct7
operator|==
name|i
operator|.
name|RType
operator|.
name|funct7
operator|)
condition|)
block|{
name|oprint
argument_list|(
name|op
argument_list|,
name|loc
argument_list|,
name|i
operator|.
name|RType
operator|.
name|rd
argument_list|,
name|i
operator|.
name|RType
operator|.
name|rs1
argument_list|,
name|val
argument_list|,
name|i
operator|.
name|RType
operator|.
name|rs2
argument_list|,
name|imm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|vm_offset_t
name|db_disasm
parameter_list|(
name|vm_offset_t
name|loc
parameter_list|,
name|bool
name|altfmt
parameter_list|)
block|{
name|struct
name|riscv_op
modifier|*
name|op
decl_stmt|;
name|InstFmt
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|i
operator|.
name|word
operator|=
name|db_get_value
argument_list|(
name|loc
argument_list|,
name|INSN_SIZE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* First match opcode */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|riscv_opcodes
index|[
name|j
index|]
operator|.
name|name
operator|!=
name|NULL
condition|;
name|j
operator|++
control|)
block|{
name|op
operator|=
operator|&
name|riscv_opcodes
index|[
name|j
index|]
expr_stmt|;
if|if
condition|(
name|op
operator|->
name|opcode
operator|==
name|i
operator|.
name|RType
operator|.
name|opcode
condition|)
block|{
if|if
condition|(
name|match_type
argument_list|(
name|i
argument_list|,
name|op
argument_list|,
name|loc
argument_list|)
condition|)
break|break;
block|}
block|}
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|loc
operator|+
name|INSN_SIZE
operator|)
return|;
block|}
end_function

end_unit

