begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ip.c - MIB realization of the IP (and Address Translation) group */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/snmp/RCS/ip.c,v 7.20 91/02/22 09:43:27 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * $Header: /f/osi/snmp/RCS/ip.c,v 7.20 91/02/22 09:43:27 mrose Interim $  *  * Contributed by NYSERNet Inc.  This work was partially supported by the  * U.S. Defense Advanced Research Projects Agency and the Rome Air Development  * Center of the U.S. Air Force Systems Command under contract number  * F30602-88-C-0016.  *  *  * $Log:	ip.c,v $  * Revision 7.20  91/02/22  09:43:27  mrose  * Interim 6.8  *   * Revision 7.19  91/01/11  15:34:23  mrose  * sets  *   * Revision 7.18  90/12/18  10:13:36  mrose  * update  *   * Revision 7.17  90/10/15  18:21:00  mrose  * tables  *   * Revision 7.16  90/10/02  09:54:59  mrose  * normalize again  *   * Revision 7.15  90/09/03  12:57:25  mrose  * update  *   * Revision 7.14  90/08/16  16:50:32  mrose  * again  *   * Revision 7.13  90/08/08  14:00:58  mrose  * stuff  *   * Revision 7.12  90/07/09  14:48:44  mrose  * sync  *   * Revision 7.11  90/05/22  20:30:26  mrose  * cache  *   * Revision 7.10  90/05/12  17:02:02  mrose  * sync  *   * Revision 7.9  90/04/18  08:51:47  mrose  * oid_normalize  *   * Revision 7.8  90/03/24  10:54:09  mrose  * update  *   * Revision 7.7  90/03/06  13:50:55  mrose  * jch  *   * Revision 7.6  90/02/27  18:52:11  mrose  * unix stuff  *   * Revision 7.5  90/02/27  18:49:40  mrose  * unix stuff  *   * Revision 7.4  90/02/23  17:47:43  mrose  * update  *   * Revision 7.3  90/02/17  10:38:14  mrose  * smux  *   * Revision 7.2  90/01/27  08:21:52  mrose  * touch-up  *   * Revision 7.1  90/01/11  18:34:10  mrose  * real-sync  *   * Revision 7.0  89/11/23  22:23:06  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"mib.h"
end_include

begin_include
include|#
directive|include
file|"interfaces.h"
end_include

begin_include
include|#
directive|include
file|"routes.h"
end_include

begin_include
include|#
directive|include
file|<netinet/in_systm.h>
end_include

begin_include
include|#
directive|include
file|<netinet/ip.h>
end_include

begin_include
include|#
directive|include
file|<netinet/ip_var.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|FORW_GATEWAY
value|1
end_define

begin_comment
comment|/* ipForwarding */
end_comment

begin_define
define|#
directive|define
name|FORW_HOST
value|2
end_define

begin_decl_stmt
specifier|static
name|int
name|ipforwarding
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ipstat
name|ipstat
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|ipForwarding
value|0
end_define

begin_define
define|#
directive|define
name|ipDefaultTTL
value|1
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|BSD43
end_ifdef

begin_define
define|#
directive|define
name|ipInReceives
value|2
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|ipInHdrErrors
value|3
end_define

begin_undef
undef|#
directive|undef
name|ipInAddrErrors
name|4
end_undef

begin_comment
comment|/* NOT IMPLEMENTED */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|BSD43
end_ifdef

begin_define
define|#
directive|define
name|ipForwDatagrams
value|5
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BSD44
end_ifdef

begin_define
define|#
directive|define
name|ipInUnknownProtos
value|6
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_undef
undef|#
directive|undef
name|ipInDiscards
name|7
end_undef

begin_comment
comment|/* NOT IMPLEMENTED */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|BSD44
end_ifdef

begin_define
define|#
directive|define
name|ipInDelivers
value|8
end_define

begin_define
define|#
directive|define
name|ipOutRequests
value|9
end_define

begin_define
define|#
directive|define
name|ipOutDiscards
value|10
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BSD43
end_ifdef

begin_define
define|#
directive|define
name|ipOutNoRoutes
value|11
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|ipReasmTimeout
value|12
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|BSD43
end_ifdef

begin_define
define|#
directive|define
name|ipReasmReqds
value|13
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BSD44
end_ifdef

begin_define
define|#
directive|define
name|ipReasmOKs
value|14
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BSD43
end_ifdef

begin_define
define|#
directive|define
name|ipReasmFails
value|15
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BSD44
end_ifdef

begin_undef
undef|#
directive|undef
name|ipFragOKs
name|16
end_undef

begin_undef
undef|#
directive|undef
name|ipFragFails
name|17
end_undef

begin_undef
undef|#
directive|undef
name|ipFragCreates
name|18
end_undef

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|o_ip
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
name|int
name|ifvar
decl_stmt|;
specifier|register
name|struct
name|ipstat
modifier|*
name|ips
init|=
operator|&
name|ipstat
decl_stmt|;
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|static
name|int
name|lastq
init|=
operator|-
literal|1
decl_stmt|;
name|ifvar
operator|=
operator|(
name|int
operator|)
name|ot
operator|->
name|ot_info
expr_stmt|;
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_get__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|!=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
literal|1
operator|||
name|oid
operator|->
name|oid_elements
index|[
name|oid
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
case|case
name|type_SNMP_PDUs_get__next__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|==
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
block|{
name|OID
name|new
decl_stmt|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
name|new
operator|->
name|oid_elements
index|[
name|new
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
block|}
else|else
return|return
name|NOTOK
return|;
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
switch|switch
condition|(
name|ifvar
condition|)
block|{
case|case
name|ipDefaultTTL
case|:
case|case
name|ipReasmTimeout
case|:
break|break;
default|default:
if|if
condition|(
name|quantum
operator|!=
name|lastq
condition|)
block|{
name|lastq
operator|=
name|quantum
expr_stmt|;
if|if
condition|(
name|getkmem
argument_list|(
name|nl
operator|+
name|N_IPFORWARDING
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ipforwarding
argument_list|,
sizeof|sizeof
name|ipforwarding
argument_list|)
operator|==
name|NOTOK
operator|||
name|getkmem
argument_list|(
name|nl
operator|+
name|N_IPSTAT
argument_list|,
operator|(
name|caddr_t
operator|)
name|ips
argument_list|,
sizeof|sizeof
expr|*
name|ips
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
block|}
break|break;
block|}
switch|switch
condition|(
name|ifvar
condition|)
block|{
case|case
name|ipForwarding
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ipforwarding
condition|?
name|FORW_GATEWAY
else|:
name|FORW_HOST
argument_list|)
return|;
case|case
name|ipDefaultTTL
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|MAXTTL
argument_list|)
return|;
ifdef|#
directive|ifdef
name|ipInReceives
case|case
name|ipInReceives
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_total
argument_list|)
return|;
endif|#
directive|endif
case|case
name|ipInHdrErrors
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_badsum
operator|+
name|ips
operator|->
name|ips_tooshort
operator|+
name|ips
operator|->
name|ips_toosmall
operator|+
name|ips
operator|->
name|ips_badhlen
operator|+
name|ips
operator|->
name|ips_badlen
argument_list|)
return|;
ifdef|#
directive|ifdef
name|ipForwDatagrams
case|case
name|ipForwDatagrams
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_forward
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipInUnknownProtos
case|case
name|ipInUnknownProtos
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_noproto
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipInDelivers
case|case
name|ipInDelivers
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_delivered
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipOutRequests
case|case
name|ipOutRequests
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_localout
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipOutDiscards
case|case
name|ipOutDiscards
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_odropped
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipOutNoRoutes
case|case
name|ipOutNoRoutes
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_cantforward
argument_list|)
return|;
endif|#
directive|endif
case|case
name|ipReasmTimeout
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|IPFRAGTTL
argument_list|)
return|;
ifdef|#
directive|ifdef
name|ipReasmReqds
case|case
name|ipReasmReqds
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_fragments
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipReasmOKs
case|case
name|ipReasmOKs
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_reassembled
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipReasmFails
case|case
name|ipReasmFails
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_fragdropped
operator|+
name|ips
operator|->
name|ips_fragtimeout
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipFragOKs
case|case
name|ipFragOKs
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_fragmented
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipFragFails
case|case
name|ipFragFails
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_cantfrag
argument_list|)
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipFragCreates
case|case
name|ipFragCreates
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ips
operator|->
name|ips_ofragments
argument_list|)
return|;
endif|#
directive|endif
default|default:
return|return
name|int_SNMP_error__status_noSuchName
return|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|IP_MAXPACKET
end_ifndef

begin_define
define|#
directive|define
name|IP_MAXPACKET
value|65535
end_define

begin_comment
comment|/* ipAdEntReasmMaxSize */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|IFN_SIZE
value|4
end_define

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|ipAdEntAddr
value|0
end_define

begin_define
define|#
directive|define
name|ipAdEntIfIndex
value|1
end_define

begin_define
define|#
directive|define
name|ipAdEntNetMask
value|2
end_define

begin_define
define|#
directive|define
name|ipAdEntBcastAddr
value|3
end_define

begin_define
define|#
directive|define
name|ipAdEntReasmMaxSize
value|4
end_define

begin_function
specifier|static
name|int
name|o_ip_addr
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|int
name|ifvar
decl_stmt|;
specifier|register
name|unsigned
name|int
modifier|*
name|ip
decl_stmt|,
modifier|*
name|jp
decl_stmt|;
specifier|register
name|struct
name|address
modifier|*
name|as
decl_stmt|;
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
name|OID
name|new
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
if|if
condition|(
name|get_interfaces
argument_list|(
name|offset
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
name|ifvar
operator|=
operator|(
name|int
operator|)
name|ot
operator|->
name|ot_info
expr_stmt|;
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_get__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|!=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
name|IFN_SIZE
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
if|if
condition|(
operator|(
name|as
operator|=
name|get_addrent
argument_list|(
name|oid
operator|->
name|oid_elements
operator|+
name|oid
operator|->
name|oid_nelem
operator|-
name|IFN_SIZE
argument_list|,
name|IFN_SIZE
argument_list|,
name|afs_inet
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
case|case
name|type_SNMP_PDUs_get__next__request
case|:
if|if
condition|(
operator|(
name|i
operator|=
name|oid
operator|->
name|oid_nelem
operator|-
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|)
operator|!=
literal|0
operator|&&
name|i
operator|<
name|IFN_SIZE
condition|)
block|{
for|for
control|(
name|jp
operator|=
operator|(
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|-
literal|1
operator|)
operator|+
name|i
init|;
name|jp
operator|>
name|ip
condition|;
name|jp
operator|--
control|)
if|if
condition|(
operator|*
name|jp
operator|!=
literal|0
condition|)
break|break;
if|if
condition|(
name|jp
operator|==
name|ip
condition|)
name|oid
operator|->
name|oid_nelem
operator|=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|new
operator|=
name|oid_normalize
argument_list|(
name|oid
argument_list|,
name|IFN_SIZE
operator|-
name|i
argument_list|,
literal|256
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|oid
operator|=
name|new
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|i
operator|>
name|IFN_SIZE
condition|)
name|oid
operator|->
name|oid_nelem
operator|=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
name|IFN_SIZE
expr_stmt|;
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|==
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
block|{
if|if
condition|(
operator|(
name|as
operator|=
name|afs_inet
operator|)
operator|==
name|NULL
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
name|IFN_SIZE
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
name|ip
operator|=
name|new
operator|->
name|oid_elements
operator|+
name|new
operator|->
name|oid_nelem
operator|-
name|IFN_SIZE
expr_stmt|;
name|jp
operator|=
name|as
operator|->
name|adr_instance
expr_stmt|;
for|for
control|(
name|i
operator|=
name|IFN_SIZE
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
operator|++
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|as
operator|=
name|get_addrent
argument_list|(
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|oid
operator|->
name|oid_nelem
operator|-
name|IFN_SIZE
argument_list|,
name|IFN_SIZE
argument_list|,
name|afs_inet
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|NOTOK
return|;
name|jp
operator|=
name|as
operator|->
name|adr_instance
expr_stmt|;
for|for
control|(
name|i
operator|=
name|IFN_SIZE
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
operator|++
expr_stmt|;
block|}
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
switch|switch
condition|(
name|ifvar
condition|)
block|{
case|case
name|ipAdEntAddr
case|:
return|return
name|o_ipaddr
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|as
operator|->
name|adr_address
argument_list|)
return|;
case|case
name|ipAdEntIfIndex
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|ffs
argument_list|(
name|as
operator|->
name|adr_indexmask
argument_list|)
argument_list|)
return|;
case|case
name|ipAdEntNetMask
case|:
return|return
name|o_ipaddr
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|as
operator|->
name|adr_netmask
argument_list|)
return|;
case|case
name|ipAdEntBcastAddr
case|:
comment|/* beyond belief! */
block|{
name|u_long
name|a
init|=
operator|(
operator|(
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|as
operator|->
name|adr_netmask
operator|)
operator|->
name|sin_addr
operator|.
name|s_addr
operator|)
operator|&
operator|~
operator|(
operator|(
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|as
operator|->
name|adr_broadaddr
operator|)
operator|->
name|sin_addr
operator|.
name|s_addr
operator|)
decl_stmt|;
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|a
condition|?
literal|1
else|:
literal|0
argument_list|)
return|;
block|}
case|case
name|ipAdEntReasmMaxSize
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|IP_MAXPACKET
argument_list|)
return|;
default|default:
return|return
name|int_SNMP_error__status_noSuchName
return|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|ipRouteDest
value|0
end_define

begin_define
define|#
directive|define
name|ipRouteIfIndex
value|1
end_define

begin_define
define|#
directive|define
name|ipRouteMetric1
value|2
end_define

begin_define
define|#
directive|define
name|ipRouteMetric2
value|3
end_define

begin_define
define|#
directive|define
name|ipRouteMetric3
value|4
end_define

begin_define
define|#
directive|define
name|ipRouteMetric4
value|5
end_define

begin_define
define|#
directive|define
name|ipRouteNextHop
value|6
end_define

begin_define
define|#
directive|define
name|ipRouteType
value|7
end_define

begin_define
define|#
directive|define
name|ipRouteProto
value|8
end_define

begin_undef
undef|#
directive|undef
name|ipRouteAge
name|9
end_undef

begin_comment
comment|/* NOT IMPLEMENTED */
end_comment

begin_define
define|#
directive|define
name|ipRouteMask
value|10
end_define

begin_define
define|#
directive|define
name|ipRouteMetric5
value|11
end_define

begin_define
define|#
directive|define
name|ipRouteInfo
value|12
end_define

begin_define
define|#
directive|define
name|unixIpRouteFlags
value|13
end_define

begin_define
define|#
directive|define
name|unixIpRouteRefCnt
value|14
end_define

begin_define
define|#
directive|define
name|unixIpRouteUses
value|15
end_define

begin_function
specifier|static
name|int
name|o_ip_route
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
name|int
name|ifvar
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|unsigned
name|int
modifier|*
name|ip
decl_stmt|,
modifier|*
name|jp
decl_stmt|;
specifier|register
name|struct
name|rtetab
modifier|*
name|rt
decl_stmt|;
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
name|OID
name|new
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
if|if
condition|(
name|get_routes
argument_list|(
name|offset
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
name|ifvar
operator|=
operator|(
name|int
operator|)
name|ot
operator|->
name|ot_info
expr_stmt|;
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_get__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|<
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
name|IFN_SIZE
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
if|if
condition|(
operator|(
name|rt
operator|=
name|get_rtent
argument_list|(
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|oid
operator|->
name|oid_nelem
operator|-
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|rts_inet
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
case|case
name|type_SNMP_PDUs_get__next__request
case|:
if|if
condition|(
operator|(
name|i
operator|=
name|oid
operator|->
name|oid_nelem
operator|-
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|)
operator|!=
literal|0
operator|&&
name|i
operator|<
name|IFN_SIZE
condition|)
block|{
for|for
control|(
name|jp
operator|=
operator|(
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|-
literal|1
operator|)
operator|+
name|i
init|;
name|jp
operator|>
name|ip
condition|;
name|jp
operator|--
control|)
if|if
condition|(
operator|*
name|jp
operator|!=
literal|0
condition|)
break|break;
if|if
condition|(
name|jp
operator|==
name|ip
condition|)
name|oid
operator|->
name|oid_nelem
operator|=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|new
operator|=
name|oid_normalize
argument_list|(
name|oid
argument_list|,
name|IFN_SIZE
operator|-
name|i
argument_list|,
literal|256
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|oid
operator|=
name|new
expr_stmt|;
block|}
block|}
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|==
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
block|{
if|if
condition|(
operator|(
name|rt
operator|=
name|rts_inet
operator|)
operator|==
name|NULL
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
name|rt
operator|->
name|rt_insize
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
name|ip
operator|=
name|new
operator|->
name|oid_elements
operator|+
name|new
operator|->
name|oid_nelem
operator|-
name|rt
operator|->
name|rt_insize
expr_stmt|;
name|jp
operator|=
name|rt
operator|->
name|rt_instance
expr_stmt|;
for|for
control|(
name|i
operator|=
name|rt
operator|->
name|rt_insize
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
operator|++
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
block|}
else|else
block|{
name|int
name|j
decl_stmt|;
if|if
condition|(
operator|(
name|rt
operator|=
name|get_rtent
argument_list|(
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|j
operator|=
name|oid
operator|->
name|oid_nelem
operator|-
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|rts_inet
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
operator|(
name|i
operator|=
name|j
operator|-
name|rt
operator|->
name|rt_insize
operator|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
operator|-
name|i
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
name|oid
operator|=
name|new
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|>
literal|0
condition|)
name|oid
operator|->
name|oid_nelem
operator|-=
name|i
expr_stmt|;
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
expr_stmt|;
name|jp
operator|=
name|rt
operator|->
name|rt_instance
expr_stmt|;
for|for
control|(
name|i
operator|=
name|rt
operator|->
name|rt_insize
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
operator|++
expr_stmt|;
block|}
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
switch|switch
condition|(
name|ifvar
condition|)
block|{
case|case
name|ipRouteDest
case|:
return|return
name|o_ipaddr
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|rt
operator|->
name|rt_dst
argument_list|)
return|;
case|case
name|ipRouteIfIndex
case|:
block|{
specifier|register
name|struct
name|interface
modifier|*
name|is
decl_stmt|;
if|if
condition|(
name|get_interfaces
argument_list|(
name|type_SNMP_PDUs_get__request
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
for|for
control|(
name|is
operator|=
name|ifs
init|;
name|is
condition|;
name|is
operator|=
name|is
operator|->
name|ifn_next
control|)
if|if
condition|(
operator|(
name|caddr_t
operator|)
name|is
operator|->
name|ifn_offset
operator|==
operator|(
name|caddr_t
operator|)
name|rt
operator|->
name|rt_rt
operator|.
name|rt_ifp
condition|)
block|{
if|if
condition|(
name|is
operator|->
name|ifn_ready
condition|)
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|is
operator|->
name|ifn_index
argument_list|)
return|;
break|break;
block|}
if|if
condition|(
name|offset
operator|==
name|type_SNMP_PDUs_get__next__request
condition|)
return|return
name|NOTOK
return|;
return|return
name|int_SNMP_error__status_noSuchName
return|;
block|}
case|case
name|ipRouteMetric1
case|:
case|case
name|ipRouteMetric2
case|:
case|case
name|ipRouteMetric3
case|:
case|case
name|ipRouteMetric4
case|:
case|case
name|ipRouteMetric5
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|METRIC_NONE
argument_list|)
return|;
case|case
name|ipRouteNextHop
case|:
return|return
name|o_ipaddr
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|rt
operator|->
name|rt_gateway
argument_list|)
return|;
case|case
name|ipRouteType
case|:
switch|switch
condition|(
name|rt
operator|->
name|rt_rt
operator|.
name|rt_flags
operator|&
operator|(
name|RTF_GATEWAY
operator||
name|RTF_HOST
operator|)
condition|)
block|{
case|case
name|RTF_GATEWAY
case|:
case|case
name|RTF_HOST
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|TYPE_REMOTE
argument_list|)
return|;
case|case
literal|0
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|TYPE_DIRECT
argument_list|)
return|;
default|default:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|TYPE_OTHER
argument_list|)
return|;
block|}
case|case
name|ipRouteProto
case|:
ifdef|#
directive|ifdef
name|RTF_DYNAMIC
ifndef|#
directive|ifndef
name|RTF_MODIFIED
if|if
condition|(
name|rt
operator|->
name|rt_rt
operator|.
name|rt_flags
operator|&
name|RTF_DYNAMIC
condition|)
else|#
directive|else
if|if
condition|(
name|rt
operator|->
name|rt_rt
operator|.
name|rt_flags
operator|&
operator|(
name|RTF_DYNAMIC
operator||
name|RTF_MODIFIED
operator|)
condition|)
endif|#
directive|endif
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|PROTO_ICMP
argument_list|)
return|;
else|else
endif|#
directive|endif
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|PROTO_OTHER
argument_list|)
return|;
case|case
name|ipRouteMask
case|:
block|{
name|struct
name|sockaddr_in
name|mask
decl_stmt|;
name|struct
name|sockaddr_in
modifier|*
name|sin
init|=
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|rt
operator|->
name|rt_dst
decl_stmt|;
ifndef|#
directive|ifndef
name|BSD44
specifier|register
name|struct
name|interface
modifier|*
name|is
decl_stmt|;
specifier|register
name|struct
name|address
modifier|*
name|as
decl_stmt|;
endif|#
directive|endif
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|mask
argument_list|,
sizeof|sizeof
name|mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|rt
operator|->
name|rt_rt
operator|.
name|rt_flags
operator|&
name|RTF_HOST
condition|)
name|mask
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
operator|(
name|u_long
operator|)
literal|0xffffffff
expr_stmt|;
elseif|else
if|if
condition|(
name|sin
operator|->
name|sin_addr
operator|.
name|s_addr
operator|!=
literal|0L
condition|)
block|{
ifndef|#
directive|ifndef
name|BSD44
comment|/* XXX - BSD44 shouldn't use this code, it has a */
comment|/* mask associated with each route, but I don't */
comment|/* know how to locate it at the moment (jch) */
if|if
condition|(
name|get_interfaces
argument_list|(
name|type_SNMP_PDUs_get__request
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
for|for
control|(
name|is
operator|=
name|ifs
init|;
name|is
condition|;
name|is
operator|=
name|is
operator|->
name|ifn_next
control|)
if|if
condition|(
operator|(
name|caddr_t
operator|)
name|is
operator|->
name|ifn_offset
operator|==
operator|(
name|caddr_t
operator|)
name|rt
operator|->
name|rt_rt
operator|.
name|rt_ifp
condition|)
break|break;
if|if
condition|(
operator|!
name|is
operator|||
operator|!
name|is
operator|->
name|ifn_ready
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
for|for
control|(
name|as
operator|=
name|afs_inet
init|;
name|as
condition|;
name|as
operator|=
name|as
operator|->
name|adr_next
control|)
if|if
condition|(
name|is
operator|->
name|ifn_indexmask
operator|&
name|as
operator|->
name|adr_indexmask
condition|)
break|break;
if|if
condition|(
operator|!
name|as
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
name|mask
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|as
operator|->
name|adr_netmask
operator|.
name|un_in
operator|.
name|sin_addr
operator|.
name|s_addr
expr_stmt|;
else|#
directive|else
if|if
condition|(
name|IN_CLASSA
argument_list|(
name|sin
operator|->
name|sin_addr
operator|.
name|s_addr
argument_list|)
condition|)
name|mask
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|IN_CLASSA_NET
expr_stmt|;
elseif|else
if|if
condition|(
name|IN_CLASSB
argument_list|(
name|sin
operator|->
name|sin_addr
operator|.
name|s_addr
argument_list|)
condition|)
name|mask
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|IN_CLASSB_NET
expr_stmt|;
else|else
name|mask
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|IN_CLASSC_NET
expr_stmt|;
endif|#
directive|endif
block|}
return|return
name|o_ipaddr
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|&
name|mask
argument_list|)
return|;
block|}
case|case
name|ipRouteInfo
case|:
return|return
name|o_specific
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
name|caddr_t
operator|)
name|nullSpecific
argument_list|)
return|;
case|case
name|unixIpRouteFlags
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rt
operator|->
name|rt_rt
operator|.
name|rt_flags
operator|&
literal|0xffff
argument_list|)
return|;
case|case
name|unixIpRouteRefCnt
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rt
operator|->
name|rt_rt
operator|.
name|rt_refcnt
operator|&
literal|0xffff
argument_list|)
return|;
case|case
name|unixIpRouteUses
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rt
operator|->
name|rt_rt
operator|.
name|rt_use
argument_list|)
return|;
default|default:
return|return
name|int_SNMP_error__status_noSuchName
return|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_decl_stmt
specifier|static
name|struct
name|rtstat
name|rtstat
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|unixRouteBadRedirects
value|0
end_define

begin_define
define|#
directive|define
name|unixRouteCreatedByRedirects
value|1
end_define

begin_define
define|#
directive|define
name|unixRouteModifiedByRedirects
value|2
end_define

begin_define
define|#
directive|define
name|unixRouteLookupFails
value|3
end_define

begin_define
define|#
directive|define
name|unixRouteWildcardUses
value|4
end_define

begin_function
specifier|static
name|int
name|o_ip_routing_stats
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
name|int
name|ifvar
decl_stmt|;
specifier|register
name|struct
name|rtstat
modifier|*
name|rts
init|=
operator|&
name|rtstat
decl_stmt|;
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|static
name|int
name|lastq
init|=
operator|-
literal|1
decl_stmt|;
name|ifvar
operator|=
operator|(
name|int
operator|)
name|ot
operator|->
name|ot_info
expr_stmt|;
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_get__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|!=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
literal|1
operator|||
name|oid
operator|->
name|oid_elements
index|[
name|oid
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
case|case
name|type_SNMP_PDUs_get__next__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|==
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
block|{
name|OID
name|new
decl_stmt|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
name|new
operator|->
name|oid_elements
index|[
name|new
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
block|}
else|else
return|return
name|NOTOK
return|;
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|quantum
operator|!=
name|lastq
condition|)
block|{
name|lastq
operator|=
name|quantum
expr_stmt|;
if|if
condition|(
name|getkmem
argument_list|(
name|nl
operator|+
name|N_RTSTAT
argument_list|,
operator|(
name|caddr_t
operator|)
name|rts
argument_list|,
sizeof|sizeof
expr|*
name|rts
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
block|}
switch|switch
condition|(
name|ifvar
condition|)
block|{
case|case
name|unixRouteBadRedirects
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rts
operator|->
name|rts_badredirect
operator|&
literal|0xffff
argument_list|)
return|;
case|case
name|unixRouteCreatedByRedirects
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rts
operator|->
name|rts_dynamic
operator|&
literal|0xffff
argument_list|)
return|;
case|case
name|unixRouteModifiedByRedirects
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rts
operator|->
name|rts_newgateway
operator|&
literal|0xffff
argument_list|)
return|;
case|case
name|unixRouteLookupFails
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rts
operator|->
name|rts_unreach
operator|&
literal|0xffff
argument_list|)
return|;
case|case
name|unixRouteWildcardUses
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|rts
operator|->
name|rts_wildcard
operator|&
literal|0xffff
argument_list|)
return|;
default|default:
return|return
name|int_SNMP_error__status_noSuchName
return|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_struct
struct|struct
name|adrtab
block|{
define|#
directive|define
name|ADN_SIZE
value|(IFN_SIZE + 1)
comment|/* IpAddress instance */
name|unsigned
name|int
name|adn_instance
index|[
name|ADN_SIZE
index|]
decl_stmt|;
name|int
name|adn_insize
decl_stmt|;
name|struct
name|in_addr
name|adn_address
decl_stmt|;
comment|/* IpAddress */
define|#
directive|define
name|ADM_SIZE
value|ADR_SIZE
comment|/* PhysAddress instance */
name|unsigned
name|int
name|adm_instance
index|[
name|ADM_SIZE
index|]
decl_stmt|;
name|int
name|adm_insize
decl_stmt|;
name|u_char
name|adm_address
index|[
name|ADM_SIZE
index|]
decl_stmt|;
comment|/* PhysAddress */
name|u_char
name|adm_addrlen
decl_stmt|;
comment|/*   .. */
define|#
directive|define
name|ADA_SIZE
value|(IFN_SIZE + 2)
comment|/* AtEntry instance */
name|unsigned
name|int
name|ada_instance
index|[
name|ADA_SIZE
index|]
decl_stmt|;
name|int
name|ada_insize
decl_stmt|;
name|int
name|adr_index
decl_stmt|;
comment|/* ifIndex */
name|int
name|adr_type
decl_stmt|;
comment|/* ipNetToMediaType */
define|#
directive|define
name|OTHER_MAPPING
value|1
define|#
directive|define
name|DYNAMIC_MAPPING
value|3
define|#
directive|define
name|STATIC_MAPPING
value|4
name|struct
name|adrtab
modifier|*
name|adn_next
decl_stmt|;
comment|/* next IpAddress */
name|struct
name|adrtab
modifier|*
name|adm_next
decl_stmt|;
comment|/* next PhysAddress */
name|struct
name|adrtab
modifier|*
name|ada_next
decl_stmt|;
comment|/* next AtEntry */
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|adrtab
modifier|*
name|ada
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|adrtab
modifier|*
name|adn
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|adrtab
modifier|*
name|adm
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|flush_arp_cache
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|struct
name|adrtab
modifier|*
name|get_arpent
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|atIfIndex
value|0
end_define

begin_define
define|#
directive|define
name|atPhysAddress
value|1
end_define

begin_define
define|#
directive|define
name|atNetAddress
value|2
end_define

begin_define
define|#
directive|define
name|ipNetToMediaIfIndex
value|3
end_define

begin_define
define|#
directive|define
name|ipNetToMediaPhysAddress
value|4
end_define

begin_define
define|#
directive|define
name|ipNetToMediaNetAddress
value|5
end_define

begin_define
define|#
directive|define
name|ipNetToMediaType
value|6
end_define

begin_function
specifier|static
name|int
name|o_address
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|int
name|ifvar
decl_stmt|,
name|isnpa
decl_stmt|;
specifier|register
name|unsigned
name|int
modifier|*
name|ip
decl_stmt|,
modifier|*
name|jp
decl_stmt|;
specifier|register
name|struct
name|adrtab
modifier|*
name|at
decl_stmt|;
name|struct
name|sockaddr_in
name|netaddr
decl_stmt|;
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
if|if
condition|(
name|get_arptab
argument_list|(
name|offset
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
switch|switch
condition|(
name|ifvar
operator|=
operator|(
name|int
operator|)
name|ot
operator|->
name|ot_info
condition|)
block|{
case|case
name|ipNetToMediaIfIndex
case|:
case|case
name|ipNetToMediaPhysAddress
case|:
case|case
name|ipNetToMediaNetAddress
case|:
case|case
name|ipNetToMediaType
case|:
name|isnpa
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|atIfIndex
case|:
case|case
name|atPhysAddress
case|:
case|case
name|atNetAddress
case|:
name|isnpa
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
default|default:
return|return
name|generr
argument_list|(
name|offset
argument_list|)
return|;
block|}
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_get__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|<=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
if|if
condition|(
operator|(
name|at
operator|=
name|get_arpent
argument_list|(
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|oid
operator|->
name|oid_nelem
operator|-
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|isnpa
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
case|case
name|type_SNMP_PDUs_get__next__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|==
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
block|{
name|OID
name|new
decl_stmt|;
switch|switch
condition|(
name|isnpa
condition|)
block|{
case|case
literal|0
case|:
if|if
condition|(
name|at
operator|=
name|adn
condition|)
name|jp
operator|=
name|at
operator|->
name|adn_instance
operator|,
name|i
operator|=
name|at
operator|->
name|adn_insize
expr_stmt|;
break|break;
case|case
literal|1
case|:
if|if
condition|(
name|at
operator|=
name|adm
condition|)
name|jp
operator|=
name|at
operator|->
name|adm_instance
operator|,
name|i
operator|=
name|at
operator|->
name|adm_insize
expr_stmt|;
break|break;
case|case
operator|-
literal|1
case|:
if|if
condition|(
name|at
operator|=
name|ada
condition|)
name|jp
operator|=
name|at
operator|->
name|ada_instance
operator|,
name|i
operator|=
name|at
operator|->
name|ada_insize
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|at
operator|==
name|NULL
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
name|i
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
name|ip
operator|=
name|new
operator|->
name|oid_elements
operator|+
name|new
operator|->
name|oid_nelem
operator|-
name|i
expr_stmt|;
for|for
control|(
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
operator|++
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
block|}
else|else
block|{
name|int
name|j
decl_stmt|;
if|if
condition|(
operator|(
name|at
operator|=
name|get_arpent
argument_list|(
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|j
operator|=
name|oid
operator|->
name|oid_nelem
operator|-
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
argument_list|,
name|isnpa
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|NOTOK
return|;
name|i
operator|=
name|isnpa
operator|>
literal|0
condition|?
name|at
operator|->
name|adm_insize
else|:
name|isnpa
operator|==
literal|0
condition|?
name|at
operator|->
name|adn_insize
else|:
name|at
operator|->
name|ada_insize
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|=
name|j
operator|-
name|i
operator|)
operator|<
literal|0
condition|)
block|{
name|OID
name|new
decl_stmt|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
operator|-
name|i
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
name|oid
operator|=
name|new
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|>
literal|0
condition|)
name|oid
operator|->
name|oid_nelem
operator|-=
name|i
expr_stmt|;
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
expr_stmt|;
switch|switch
condition|(
name|isnpa
condition|)
block|{
case|case
literal|0
case|:
name|jp
operator|=
name|at
operator|->
name|adn_instance
operator|,
name|i
operator|=
name|at
operator|->
name|adn_insize
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|jp
operator|=
name|at
operator|->
name|adm_instance
operator|,
name|i
operator|=
name|at
operator|->
name|adm_insize
expr_stmt|;
break|break;
case|case
operator|-
literal|1
case|:
name|jp
operator|=
name|at
operator|->
name|ada_instance
operator|,
name|i
operator|=
name|at
operator|->
name|ada_insize
expr_stmt|;
break|break;
block|}
for|for
control|(
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
operator|++
expr_stmt|;
block|}
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
switch|switch
condition|(
name|ifvar
condition|)
block|{
case|case
name|atIfIndex
case|:
case|case
name|ipNetToMediaIfIndex
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|at
operator|->
name|adr_index
argument_list|)
return|;
case|case
name|atPhysAddress
case|:
case|case
name|ipNetToMediaPhysAddress
case|:
return|return
name|o_string
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
name|char
operator|*
operator|)
name|at
operator|->
name|adm_address
argument_list|,
operator|(
name|int
operator|)
name|at
operator|->
name|adm_addrlen
argument_list|)
return|;
case|case
name|atNetAddress
case|:
case|case
name|ipNetToMediaNetAddress
case|:
name|netaddr
operator|.
name|sin_addr
operator|=
name|at
operator|->
name|adn_address
expr_stmt|;
comment|/* struct copy */
return|return
name|o_ipaddr
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|&
name|netaddr
argument_list|)
return|;
case|case
name|ipNetToMediaType
case|:
return|return
name|o_integer
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
name|at
operator|->
name|adr_type
argument_list|)
return|;
default|default:
return|return
name|int_SNMP_error__status_noSuchName
return|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|adn_compar
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
specifier|register
name|struct
name|adrtab
modifier|*
modifier|*
name|a
decl_stmt|,
decl|*
modifier|*
name|b
decl_stmt|;
end_function

begin_block
block|{
return|return
name|elem_cmp
argument_list|(
operator|(
operator|*
name|a
operator|)
operator|->
name|adn_instance
argument_list|,
operator|(
operator|*
name|a
operator|)
operator|->
name|adn_insize
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|adn_instance
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|adn_insize
argument_list|)
return|;
block|}
end_block

begin_function
specifier|static
name|int
name|adm_compar
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
specifier|register
name|struct
name|adrtab
modifier|*
modifier|*
name|a
decl_stmt|,
decl|*
modifier|*
name|b
decl_stmt|;
end_function

begin_block
block|{
return|return
name|elem_cmp
argument_list|(
operator|(
operator|*
name|a
operator|)
operator|->
name|adm_instance
argument_list|,
operator|(
operator|*
name|a
operator|)
operator|->
name|adm_insize
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|adm_instance
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|adm_insize
argument_list|)
return|;
block|}
end_block

begin_function
specifier|static
name|int
name|ada_compar
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
specifier|register
name|struct
name|adrtab
modifier|*
modifier|*
name|a
decl_stmt|,
decl|*
modifier|*
name|b
decl_stmt|;
end_function

begin_block
block|{
return|return
name|elem_cmp
argument_list|(
operator|(
operator|*
name|a
operator|)
operator|->
name|ada_instance
argument_list|,
operator|(
operator|*
name|a
operator|)
operator|->
name|ada_insize
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|ada_instance
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|ada_insize
argument_list|)
return|;
block|}
end_block

begin_function
specifier|static
name|int
name|get_arptab
parameter_list|(
name|offset
parameter_list|)
name|int
name|offset
decl_stmt|;
block|{
name|int
name|adrNumber
init|=
literal|0
decl_stmt|,
name|arptab_size
decl_stmt|,
name|tblsize
decl_stmt|;
specifier|register
name|struct
name|arptab
modifier|*
name|ac
decl_stmt|,
modifier|*
name|ae
decl_stmt|;
name|struct
name|arptab
modifier|*
name|arptab
decl_stmt|;
specifier|register
name|struct
name|adrtab
modifier|*
name|at
decl_stmt|,
modifier|*
name|ap
decl_stmt|,
modifier|*
modifier|*
name|base
decl_stmt|,
modifier|*
modifier|*
name|afe
decl_stmt|,
modifier|*
modifier|*
name|afp
decl_stmt|;
specifier|register
name|struct
name|interface
modifier|*
name|is
decl_stmt|;
specifier|static
name|int
name|first_time
init|=
literal|1
decl_stmt|;
specifier|static
name|int
name|lastq
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|quantum
operator|==
name|lastq
condition|)
return|return
name|OK
return|;
if|if
condition|(
operator|!
name|flush_arp_cache
operator|&&
name|offset
operator|==
name|type_SNMP_PDUs_get__next__request
operator|&&
name|quantum
operator|==
name|lastq
operator|+
literal|1
condition|)
block|{
comment|/* XXX: caching! */
name|lastq
operator|=
name|quantum
expr_stmt|;
return|return
name|OK
return|;
block|}
name|lastq
operator|=
name|quantum
operator|,
name|flush_arp_cache
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|at
operator|=
name|adn
init|;
name|at
condition|;
name|at
operator|=
name|ap
control|)
block|{
name|ap
operator|=
name|at
operator|->
name|adn_next
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|at
argument_list|)
expr_stmt|;
block|}
name|adn
operator|=
name|adm
operator|=
name|ada
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|getkmem
argument_list|(
name|nl
operator|+
name|N_ARPTAB_SIZE
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|arptab_size
argument_list|,
sizeof|sizeof
name|arptab_size
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|NOTOK
return|;
name|tblsize
operator|=
name|arptab_size
operator|*
sizeof|sizeof
expr|*
name|arptab
expr_stmt|;
if|if
condition|(
operator|(
name|arptab
operator|=
operator|(
expr|struct
name|arptab
operator|*
operator|)
name|malloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|tblsize
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"out of memory"
argument_list|)
expr_stmt|;
if|if
condition|(
name|getkmem
argument_list|(
name|nl
operator|+
name|N_ARPTAB
argument_list|,
operator|(
name|caddr_t
operator|)
name|arptab
argument_list|,
name|tblsize
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arptab
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
name|afp
operator|=
operator|&
name|adn
expr_stmt|;
for|for
control|(
name|ae
operator|=
operator|(
name|ac
operator|=
name|arptab
operator|)
operator|+
name|arptab_size
init|;
name|ac
operator|<
name|ae
condition|;
name|ac
operator|++
control|)
block|{
name|int
name|type
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|ac
operator|->
name|at_iaddr
operator|.
name|s_addr
operator|)
operator|||
operator|!
operator|(
name|ac
operator|->
name|at_flags
operator|&
name|ATF_COM
operator|)
condition|)
continue|continue;
name|type
operator|=
name|ac
operator|->
name|at_flags
operator|&
name|ATF_PERM
condition|?
name|OTHER_MAPPING
else|:
name|ac
operator|->
name|at_flags
operator|&
name|ATF_PUBL
condition|?
name|STATIC_MAPPING
else|:
name|DYNAMIC_MAPPING
expr_stmt|;
comment|/* there appears to be no way to gather per-interface address translation    tables, so we simply duplicate the arptable for each interface... */
for|for
control|(
name|is
operator|=
name|ifs
init|;
name|is
condition|;
name|is
operator|=
name|is
operator|->
name|ifn_next
control|)
block|{
if|if
condition|(
operator|!
name|is
operator|->
name|ifn_ready
condition|)
continue|continue;
if|if
condition|(
operator|(
name|at
operator|=
operator|(
expr|struct
name|adrtab
operator|*
operator|)
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
expr|*
name|at
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"out of memory"
argument_list|)
expr_stmt|;
operator|*
name|afp
operator|=
name|at
operator|,
name|afp
operator|=
operator|&
name|at
operator|->
name|adn_next
operator|,
name|adrNumber
operator|++
expr_stmt|;
name|at
operator|->
name|adr_index
operator|=
name|is
operator|->
name|ifn_index
expr_stmt|;
name|at
operator|->
name|adr_type
operator|=
name|type
expr_stmt|;
name|at
operator|->
name|adn_address
operator|=
name|ac
operator|->
name|at_iaddr
expr_stmt|;
comment|/* struct copy */
name|at
operator|->
name|adn_instance
index|[
literal|0
index|]
operator|=
name|at
operator|->
name|adr_index
operator|,
name|at
operator|->
name|adn_insize
operator|=
literal|1
expr_stmt|;
name|at
operator|->
name|adn_insize
operator|+=
name|ipaddr2oid
argument_list|(
name|at
operator|->
name|adn_instance
operator|+
literal|1
argument_list|,
operator|&
name|at
operator|->
name|adn_address
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|NEW_AT
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ac
operator|->
name|at_enaddr
argument_list|,
operator|(
name|char
operator|*
operator|)
name|at
operator|->
name|adm_address
argument_list|,
call|(
name|int
call|)
argument_list|(
name|at
operator|->
name|adm_addrlen
operator|=
sizeof|sizeof
name|ac
operator|->
name|at_enaddr
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ac
operator|->
name|at_enaddr
operator|.
name|ether_addr_octet
argument_list|,
operator|(
name|char
operator|*
operator|)
name|at
operator|->
name|adm_address
argument_list|,
call|(
name|int
call|)
argument_list|(
name|at
operator|->
name|adm_addrlen
operator|=
sizeof|sizeof
name|ac
operator|->
name|at_enaddr
operator|.
name|ether_addr_octet
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|at
operator|->
name|adm_instance
index|[
literal|0
index|]
operator|=
name|at
operator|->
name|adr_index
operator|,
name|at
operator|->
name|adm_insize
operator|=
literal|1
expr_stmt|;
name|at
operator|->
name|adm_insize
operator|+=
name|mediaddr2oid
argument_list|(
name|at
operator|->
name|adm_instance
operator|+
literal|1
argument_list|,
name|at
operator|->
name|adm_address
argument_list|,
operator|(
name|int
operator|)
name|at
operator|->
name|adm_addrlen
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|at
operator|->
name|ada_instance
index|[
literal|0
index|]
operator|=
name|at
operator|->
name|adr_index
expr_stmt|;
name|at
operator|->
name|ada_instance
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|at
operator|->
name|ada_insize
operator|=
literal|2
expr_stmt|;
name|at
operator|->
name|ada_insize
operator|+=
name|ipaddr2oid
argument_list|(
name|at
operator|->
name|ada_instance
operator|+
literal|2
argument_list|,
operator|&
name|at
operator|->
name|adn_address
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|&&
name|first_time
condition|)
block|{
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|OIDentifier
name|oids
decl_stmt|;
name|oids
operator|.
name|oid_elements
operator|=
name|at
operator|->
name|adn_instance
expr_stmt|;
name|oids
operator|.
name|oid_nelem
operator|=
name|at
operator|->
name|adn_insize
expr_stmt|;
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|sprintoid
argument_list|(
operator|&
name|oids
argument_list|)
argument_list|)
expr_stmt|;
name|oids
operator|.
name|oid_elements
operator|=
name|at
operator|->
name|adm_instance
expr_stmt|;
name|oids
operator|.
name|oid_nelem
operator|=
name|at
operator|->
name|adm_insize
expr_stmt|;
name|advise
argument_list|(
name|LLOG_DEBUG
argument_list|,
name|NULLCP
argument_list|,
literal|"add mapping on %d: %s -> %s"
argument_list|,
name|at
operator|->
name|adr_index
argument_list|,
name|buffer
argument_list|,
name|sprintoid
argument_list|(
operator|&
name|oids
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|first_time
operator|=
literal|0
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arptab
argument_list|)
expr_stmt|;
if|if
condition|(
name|adrNumber
operator|<=
literal|1
condition|)
block|{
name|adm
operator|=
name|ada
operator|=
name|adn
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
operator|(
name|base
operator|=
operator|(
expr|struct
name|adrtab
operator|*
operator|*
operator|)
name|malloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|adrNumber
operator|*
sizeof|sizeof
expr|*
name|base
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"out of memory"
argument_list|)
expr_stmt|;
name|afe
operator|=
name|base
expr_stmt|;
for|for
control|(
name|at
operator|=
name|adn
init|;
name|at
condition|;
name|at
operator|=
name|at
operator|->
name|adn_next
control|)
operator|*
name|afe
operator|++
operator|=
name|at
expr_stmt|;
name|qsort
argument_list|(
operator|(
name|char
operator|*
operator|)
name|base
argument_list|,
name|adrNumber
argument_list|,
sizeof|sizeof
expr|*
name|base
argument_list|,
name|adn_compar
argument_list|)
expr_stmt|;
name|afp
operator|=
name|base
expr_stmt|;
name|at
operator|=
name|adn
operator|=
operator|*
name|afp
operator|++
expr_stmt|;
while|while
condition|(
name|afp
operator|<
name|afe
condition|)
block|{
name|at
operator|->
name|adn_next
operator|=
operator|*
name|afp
expr_stmt|;
name|at
operator|=
operator|*
name|afp
operator|++
expr_stmt|;
block|}
name|at
operator|->
name|adn_next
operator|=
name|NULL
expr_stmt|;
name|qsort
argument_list|(
operator|(
name|char
operator|*
operator|)
name|base
argument_list|,
name|adrNumber
argument_list|,
sizeof|sizeof
expr|*
name|base
argument_list|,
name|adm_compar
argument_list|)
expr_stmt|;
name|afp
operator|=
name|base
expr_stmt|;
name|at
operator|=
name|adm
operator|=
operator|*
name|afp
operator|++
expr_stmt|;
while|while
condition|(
name|afp
operator|<
name|afe
condition|)
block|{
name|at
operator|->
name|adm_next
operator|=
operator|*
name|afp
expr_stmt|;
name|at
operator|=
operator|*
name|afp
operator|++
expr_stmt|;
block|}
name|at
operator|->
name|adm_next
operator|=
name|NULL
expr_stmt|;
name|qsort
argument_list|(
operator|(
name|char
operator|*
operator|)
name|base
argument_list|,
name|adrNumber
argument_list|,
sizeof|sizeof
expr|*
name|base
argument_list|,
name|ada_compar
argument_list|)
expr_stmt|;
name|afp
operator|=
name|base
expr_stmt|;
name|at
operator|=
name|ada
operator|=
operator|*
name|afp
operator|++
expr_stmt|;
while|while
condition|(
name|afp
operator|<
name|afe
condition|)
block|{
name|at
operator|->
name|ada_next
operator|=
operator|*
name|afp
expr_stmt|;
name|at
operator|=
operator|*
name|afp
operator|++
expr_stmt|;
block|}
name|at
operator|->
name|ada_next
operator|=
name|NULL
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|base
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|struct
name|adrtab
modifier|*
name|get_arpent
parameter_list|(
name|ip
parameter_list|,
name|len
parameter_list|,
name|isnpa
parameter_list|,
name|isnext
parameter_list|)
specifier|register
name|unsigned
name|int
modifier|*
name|ip
decl_stmt|;
name|int
name|len
decl_stmt|;
name|int
name|isnpa
decl_stmt|,
name|isnext
decl_stmt|;
block|{
specifier|register
name|struct
name|adrtab
modifier|*
name|at
decl_stmt|;
switch|switch
condition|(
name|isnpa
condition|)
block|{
case|case
literal|0
case|:
for|for
control|(
name|at
operator|=
name|adn
init|;
name|at
condition|;
name|at
operator|=
name|at
operator|->
name|adn_next
control|)
switch|switch
condition|(
name|elem_cmp
argument_list|(
name|at
operator|->
name|adn_instance
argument_list|,
name|at
operator|->
name|adn_insize
argument_list|,
name|ip
argument_list|,
name|len
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
if|if
condition|(
operator|!
name|isnext
condition|)
return|return
name|at
return|;
if|if
condition|(
operator|(
name|at
operator|=
name|at
operator|->
name|adn_next
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|out
goto|;
comment|/* else fall... */
case|case
literal|1
case|:
return|return
operator|(
name|isnext
condition|?
name|at
else|:
name|NULL
operator|)
return|;
block|}
break|break;
case|case
literal|1
case|:
for|for
control|(
name|at
operator|=
name|adm
init|;
name|at
condition|;
name|at
operator|=
name|at
operator|->
name|adm_next
control|)
switch|switch
condition|(
name|elem_cmp
argument_list|(
name|at
operator|->
name|adm_instance
argument_list|,
name|at
operator|->
name|adm_insize
argument_list|,
name|ip
argument_list|,
name|len
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
if|if
condition|(
operator|!
name|isnext
condition|)
return|return
name|at
return|;
if|if
condition|(
operator|(
name|at
operator|=
name|at
operator|->
name|adm_next
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|out
goto|;
comment|/* else fall... */
case|case
literal|1
case|:
return|return
operator|(
name|isnext
condition|?
name|at
else|:
name|NULL
operator|)
return|;
block|}
break|break;
case|case
operator|-
literal|1
case|:
for|for
control|(
name|at
operator|=
name|ada
init|;
name|at
condition|;
name|at
operator|=
name|at
operator|->
name|ada_next
control|)
switch|switch
condition|(
name|elem_cmp
argument_list|(
name|at
operator|->
name|ada_instance
argument_list|,
name|at
operator|->
name|ada_insize
argument_list|,
name|ip
argument_list|,
name|len
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
if|if
condition|(
operator|!
name|isnext
condition|)
return|return
name|at
return|;
if|if
condition|(
operator|(
name|at
operator|=
name|at
operator|->
name|ada_next
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|out
goto|;
comment|/* else fall... */
case|case
literal|1
case|:
return|return
operator|(
name|isnext
condition|?
name|at
else|:
name|NULL
operator|)
return|;
block|}
break|break;
block|}
name|out
label|:
empty_stmt|;
name|flush_arp_cache
operator|=
literal|1
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_macro
name|init_ip
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|OT
name|ot
decl_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipForwarding"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipForwarding
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipDefaultTTL"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipDefaultTTL
expr_stmt|;
ifdef|#
directive|ifdef
name|ipInReceives
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipInReceives"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipInReceives
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipInHdrErrors"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipInHdrErrors
expr_stmt|;
ifdef|#
directive|ifdef
name|ipInAddrErrors
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipInAddrErrors"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipInAddrErrors
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipForwDatagrams
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipForwDatagrams"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipForwDatagrams
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipInUnknownProtos
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipInUnknownProtos"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipInUnknownProtos
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipInDiscards
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipInDiscards"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipInDiscards
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipInDelivers
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipInDelivers"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipInDelivers
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipOutRequests
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipOutRequests"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipOutRequests
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipOutDiscards
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipOutDiscards"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipOutDiscards
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipOutNoRoutes
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipOutNoRoutes"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipOutNoRoutes
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipReasmTimeout"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipReasmTimeout
expr_stmt|;
ifdef|#
directive|ifdef
name|ipReasmReqds
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipReasmReqds"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipReasmReqds
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipReasmOKs
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipReasmOKs"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipReasmOKs
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipReasmFails
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipReasmFails"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipReasmFails
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipFragOKs
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipFragOKs"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipFragOKs
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipFragFails
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipFragFails"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipFragFails
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ipFragCreates
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipFragCreates"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipFragCreates
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipAdEntAddr"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_addr
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipAdEntAddr
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipAdEntIfIndex"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_addr
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipAdEntIfIndex
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipAdEntNetMask"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_addr
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipAdEntNetMask
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipAdEntBcastAddr"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_addr
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipAdEntBcastAddr
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipAdEntReasmMaxSize"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_addr
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipAdEntReasmMaxSize
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteDest"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteDest
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteIfIndex"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteIfIndex
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteMetric1"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteMetric1
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteMetric2"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteMetric2
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteMetric3"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteMetric3
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteMetric4"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteMetric4
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteNextHop"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteNextHop
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteType"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteType
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteProto"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteProto
expr_stmt|;
ifdef|#
directive|ifdef
name|ipRouteAge
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteAge"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteAge
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteMask"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteMask
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteMetric5"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteMetric5
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipRouteInfo"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipRouteInfo
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixIpRouteFlags"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixIpRouteFlags
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixIpRouteRefCnt"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixIpRouteRefCnt
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixIpRouteUses"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_route
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixIpRouteUses
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixRouteBadRedirects"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_routing_stats
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixRouteBadRedirects
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixRouteCreatedByRedirects"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_routing_stats
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixRouteCreatedByRedirects
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixRouteModifiedByRedirects"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_routing_stats
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixRouteModifiedByRedirects
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixRouteLookupFails"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_routing_stats
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixRouteLookupFails
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"unixRouteWildcardUses"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_ip_routing_stats
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|unixRouteWildcardUses
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"atIfIndex"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|atIfIndex
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"atPhysAddress"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|atPhysAddress
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"atNetAddress"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|atNetAddress
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipNetToMediaIfIndex"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipNetToMediaIfIndex
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipNetToMediaPhysAddress"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipNetToMediaPhysAddress
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipNetToMediaNetAddress"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipNetToMediaNetAddress
expr_stmt|;
if|if
condition|(
name|ot
operator|=
name|text2obj
argument_list|(
literal|"ipNetToMediaType"
argument_list|)
condition|)
name|ot
operator|->
name|ot_getfnx
operator|=
name|o_address
operator|,
name|ot
operator|->
name|ot_info
operator|=
operator|(
name|caddr_t
operator|)
name|ipNetToMediaType
expr_stmt|;
block|}
end_block

end_unit

