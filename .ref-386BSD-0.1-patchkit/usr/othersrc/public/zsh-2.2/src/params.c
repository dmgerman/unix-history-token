begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  * params.c - parameters  *  * This file is part of zsh, the Z shell.  *  * This software is Copyright 1992 by Paul Falstad  *  * Permission is hereby granted to copy, reproduce, redistribute or otherwise  * use this software as long as: there is no monetary profit gained  * specifically from the use or reproduction of this software, it is not  * sold, rented, traded or otherwise marketed, and this copyright notice is  * included prominently in any copy made.   *  * The author make no claims as to the fitness or correctness of this software  * for any use whatsoever, and it is provided as is. Any use of this software  * is at the user's own risk.   *  */
end_comment

begin_include
include|#
directive|include
file|"zsh.h"
end_include

begin_include
include|#
directive|include
file|<pwd.h>
end_include

begin_define
define|#
directive|define
name|new
parameter_list|(
name|X
parameter_list|)
value|(X=(vptr)alloc(sizeof(*(X))))
end_define

begin_decl_stmt
specifier|static
name|Param
name|argvparam
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|iparam
block|{
name|struct
name|hashnode
modifier|*
name|next
decl_stmt|;
name|int
name|canfree
decl_stmt|;
name|char
modifier|*
name|nam
decl_stmt|;
comment|/* hash data */
name|void
modifier|*
name|value
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func1
function_decl|)
parameter_list|()
function_decl|;
comment|/* set func */
name|int
function_decl|(
modifier|*
name|func2
function_decl|)
parameter_list|()
function_decl|;
comment|/* get func */
name|int
name|ct
decl_stmt|;
comment|/* output base or field width */
name|int
name|flags
decl_stmt|;
name|vptr
name|data
decl_stmt|;
comment|/* used by getfns */
name|char
modifier|*
name|env
decl_stmt|;
comment|/* location in environment, if exported */
name|char
modifier|*
name|ename
decl_stmt|;
comment|/* name of corresponding environment var */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|IFN
parameter_list|(
name|X
parameter_list|)
value|((int (*)())(X))
end_define

begin_comment
comment|/* put predefined params in hash table */
end_comment

begin_function
name|void
name|setupparams
parameter_list|()
comment|/**/
block|{
specifier|static
name|struct
name|iparam
name|pinit
index|[]
init|=
block|{
define|#
directive|define
name|IPDEF1
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|,
name|C
parameter_list|,
name|D
parameter_list|)
value|{NULL,0,A,NULL,IFN(C),IFN(B),10,\ 		PMFLAG_i|PMFLAG_SPECIAL|D,NULL,NULL,NULL}
name|IPDEF1
argument_list|(
literal|"#"
argument_list|,
name|poundgetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"ARGC"
argument_list|,
name|poundgetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"ERRNO"
argument_list|,
name|errnogetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"GID"
argument_list|,
name|gidgetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"HISTSIZE"
argument_list|,
name|histsizegetfn
argument_list|,
name|histsizesetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"LITHISTSIZE"
argument_list|,
name|lithistsizegetfn
argument_list|,
name|lithistsizesetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"RANDOM"
argument_list|,
name|randomgetfn
argument_list|,
name|randomsetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"SECONDS"
argument_list|,
name|secondsgetfn
argument_list|,
name|secondssetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF1
argument_list|(
literal|"UID"
argument_list|,
name|uidgetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
define|#
directive|define
name|IPDEF2
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|,
name|C
parameter_list|,
name|D
parameter_list|)
value|{NULL,0,A,NULL,IFN(C),IFN(B),0,\ 		PMFLAG_SPECIAL|D,NULL,NULL,NULL}
name|IPDEF2
argument_list|(
literal|"-"
argument_list|,
name|dashgetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
name|IPDEF2
argument_list|(
literal|"HISTCHARS"
argument_list|,
name|histcharsgetfn
argument_list|,
name|histcharssetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF2
argument_list|(
literal|"HOME"
argument_list|,
name|homegetfn
argument_list|,
name|homesetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF2
argument_list|(
literal|"TERM"
argument_list|,
name|termgetfn
argument_list|,
name|termsetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF2
argument_list|(
literal|"WORDCHARS"
argument_list|,
name|wordcharsgetfn
argument_list|,
name|wordcharssetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF2
argument_list|(
literal|"IFS"
argument_list|,
name|ifsgetfn
argument_list|,
name|ifssetfn
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF2
argument_list|(
literal|"_"
argument_list|,
name|underscoregetfn
argument_list|,
name|IFN
argument_list|(
name|nullsetfn
argument_list|)
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
define|#
directive|define
name|IPDEF3
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|)
value|{NULL,0,A,NULL,IFN(nullsetfn),IFN(strconstgetfn),0,PMFLAG_r|\ 		PMFLAG_SPECIAL,(vptr)B,NULL,NULL}
name|IPDEF3
argument_list|(
literal|"HOSTTYPE"
argument_list|,
name|HOSTTYPE
argument_list|)
block|,
name|IPDEF3
argument_list|(
literal|"VERSION"
argument_list|,
name|VERSIONSTR
argument_list|)
block|,
define|#
directive|define
name|IPDEF4
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|)
value|{NULL,0,A,NULL,IFN(nullsetfn),IFN(intvargetfn),10,\ 		PMFLAG_r|PMFLAG_i|PMFLAG_SPECIAL,(vptr)B,NULL,NULL}
name|IPDEF4
argument_list|(
literal|"!"
argument_list|,
operator|&
name|lastpid
argument_list|)
block|,
name|IPDEF4
argument_list|(
literal|"$"
argument_list|,
operator|&
name|mypid
argument_list|)
block|,
name|IPDEF4
argument_list|(
literal|"?"
argument_list|,
operator|&
name|lastval
argument_list|)
block|,
name|IPDEF4
argument_list|(
literal|"status"
argument_list|,
operator|&
name|lastval
argument_list|)
block|,
name|IPDEF4
argument_list|(
literal|"LINENO"
argument_list|,
operator|&
name|lineno
argument_list|)
block|,
name|IPDEF4
argument_list|(
literal|"PPID"
argument_list|,
operator|&
name|ppid
argument_list|)
block|,
define|#
directive|define
name|IPDEF5
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|)
value|{NULL,0,A,NULL,IFN(intvarsetfn),IFN(intvargetfn),10,\ 		PMFLAG_i|PMFLAG_SPECIAL,(vptr)B,NULL,NULL}
name|IPDEF5
argument_list|(
literal|"BAUD"
argument_list|,
operator|&
name|baud
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"COLUMNS"
argument_list|,
operator|&
name|columns
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"DIRSTACKSIZE"
argument_list|,
operator|&
name|dirstacksize
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"LINES"
argument_list|,
operator|&
name|lines
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"LISTMAX"
argument_list|,
operator|&
name|listmax
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"LOGCHECK"
argument_list|,
operator|&
name|logcheck
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"MAILCHECK"
argument_list|,
operator|&
name|mailcheck
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"OPTIND"
argument_list|,
operator|&
name|zoptind
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"PERIOD"
argument_list|,
operator|&
name|period
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"REPORTTIME"
argument_list|,
operator|&
name|reporttime
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"SAVEHIST"
argument_list|,
operator|&
name|savehist
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"SHLVL"
argument_list|,
operator|&
name|shlvl
argument_list|)
block|,
name|IPDEF5
argument_list|(
literal|"TMOUT"
argument_list|,
operator|&
name|tmout
argument_list|)
block|,
define|#
directive|define
name|IPDEF6
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|)
value|{NULL,0,A,NULL,IFN(nullsetfn),IFN(strvargetfn),0,\ 		PMFLAG_r|PMFLAG_SPECIAL,(vptr)B,NULL,NULL}
name|IPDEF6
argument_list|(
literal|"LOGNAME"
argument_list|,
operator|&
name|logname
argument_list|)
block|,
name|IPDEF6
argument_list|(
literal|"PWD"
argument_list|,
operator|&
name|pwd
argument_list|)
block|,
name|IPDEF6
argument_list|(
literal|"TTY"
argument_list|,
operator|&
name|ttystrname
argument_list|)
block|,
name|IPDEF6
argument_list|(
literal|"USERNAME"
argument_list|,
operator|&
name|username
argument_list|)
block|,
define|#
directive|define
name|IPDEF7
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|)
value|{NULL,0,A,NULL,IFN(strvarsetfn),IFN(strvargetfn),0,\ 		PMFLAG_SPECIAL,(vptr)B,NULL,NULL}
name|IPDEF7
argument_list|(
literal|"FCEDIT"
argument_list|,
operator|&
name|fceditparam
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"HOST"
argument_list|,
operator|&
name|hostnam
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"OLDPWD"
argument_list|,
operator|&
name|oldpwd
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"OPTARG"
argument_list|,
operator|&
name|optarg
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"MAIL"
argument_list|,
operator|&
name|mailfile
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"NULLCMD"
argument_list|,
operator|&
name|nullcmd
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"POSTEDIT"
argument_list|,
operator|&
name|postedit
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"prompt"
argument_list|,
operator|&
name|prompt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PROMPT"
argument_list|,
operator|&
name|prompt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PROMPT2"
argument_list|,
operator|&
name|prompt2
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PROMPT3"
argument_list|,
operator|&
name|prompt3
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PROMPT4"
argument_list|,
operator|&
name|prompt4
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"READNULLCMD"
argument_list|,
operator|&
name|readnullcmd
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"RPROMPT"
argument_list|,
operator|&
name|rprompt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PS1"
argument_list|,
operator|&
name|prompt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PS2"
argument_list|,
operator|&
name|prompt2
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PS3"
argument_list|,
operator|&
name|prompt3
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"PS4"
argument_list|,
operator|&
name|prompt4
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"RPS1"
argument_list|,
operator|&
name|rprompt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"SPROMPT"
argument_list|,
operator|&
name|sprompt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"TIMEFMT"
argument_list|,
operator|&
name|timefmt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"TMPPREFIX"
argument_list|,
operator|&
name|tmpprefix
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"WATCHFMT"
argument_list|,
operator|&
name|watchfmt
argument_list|)
block|,
name|IPDEF7
argument_list|(
literal|"0"
argument_list|,
operator|&
name|argzero
argument_list|)
block|,
define|#
directive|define
name|IPDEF8
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|,
name|C
parameter_list|)
value|{NULL,0,A,NULL,IFN(colonarrsetfn),IFN(colonarrgetfn),0,\ 		PMFLAG_SPECIAL,(vptr)C,NULL,B}
name|IPDEF8
argument_list|(
literal|"CDPATH"
argument_list|,
literal|"cdpath"
argument_list|,
operator|&
name|cdpath
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"FIGNORE"
argument_list|,
literal|"fignore"
argument_list|,
operator|&
name|fignore
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"FPATH"
argument_list|,
literal|"fpath"
argument_list|,
operator|&
name|fpath
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"MAILPATH"
argument_list|,
literal|"mailpath"
argument_list|,
operator|&
name|mailpath
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"MANPATH"
argument_list|,
literal|"manpath"
argument_list|,
operator|&
name|manpath
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"WATCH"
argument_list|,
literal|"watch"
argument_list|,
operator|&
name|watch
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"HOSTS"
argument_list|,
literal|"hosts"
argument_list|,
operator|&
name|hosts
argument_list|)
block|,
name|IPDEF8
argument_list|(
literal|"PATH"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
block|,
define|#
directive|define
name|IPDEF9
parameter_list|(
name|A
parameter_list|,
name|B
parameter_list|,
name|C
parameter_list|)
value|{NULL,0,A,NULL,IFN(arrvarsetfn),IFN(arrvargetfn),0,\ 		PMFLAG_A|PMFLAG_SPECIAL|C,(vptr)B,NULL,NULL}
name|IPDEF9
argument_list|(
literal|"cdpath"
argument_list|,
operator|&
name|cdpath
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"fignore"
argument_list|,
operator|&
name|fignore
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"fpath"
argument_list|,
operator|&
name|fpath
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"mailpath"
argument_list|,
operator|&
name|mailpath
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"manpath"
argument_list|,
operator|&
name|manpath
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"watch"
argument_list|,
operator|&
name|watch
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"hosts"
argument_list|,
operator|&
name|hosts
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"signals"
argument_list|,
operator|&
name|sigptr
argument_list|,
name|PMFLAG_r
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"argv"
argument_list|,
operator|&
name|pparams
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"*"
argument_list|,
operator|&
name|pparams
argument_list|,
literal|0
argument_list|)
block|,
name|IPDEF9
argument_list|(
literal|"@"
argument_list|,
operator|&
name|pparams
argument_list|,
literal|0
argument_list|)
block|,
define|#
directive|define
name|IPDEF10
parameter_list|(
name|A
parameter_list|,
name|C
parameter_list|,
name|D
parameter_list|)
value|{NULL,0,A,NULL,IFN(D),IFN(C),0,\ 		PMFLAG_A|PMFLAG_SPECIAL,NULL,NULL,NULL}
name|IPDEF10
argument_list|(
literal|"path"
argument_list|,
name|pathgetfn
argument_list|,
name|pathsetfn
argument_list|)
block|,
name|IPDEF10
argument_list|(
literal|"hostcmds"
argument_list|,
name|nullgetfn
argument_list|,
name|hostcmdssetfn
argument_list|)
block|,
name|IPDEF10
argument_list|(
literal|"optcmds"
argument_list|,
name|nullgetfn
argument_list|,
name|optcmdssetfn
argument_list|)
block|,
name|IPDEF10
argument_list|(
literal|"bindcmds"
argument_list|,
name|nullgetfn
argument_list|,
name|bindcmdssetfn
argument_list|)
block|,
name|IPDEF10
argument_list|(
literal|"varcmds"
argument_list|,
name|nullgetfn
argument_list|,
name|varcmdssetfn
argument_list|)
block|,
block|{
name|NULL
block|,}
block|}
decl_stmt|;
name|struct
name|iparam
modifier|*
name|ip
decl_stmt|;
for|for
control|(
name|ip
operator|=
name|pinit
init|;
name|ip
operator|->
name|nam
condition|;
name|ip
operator|++
control|)
name|addhperm
argument_list|(
name|ip
operator|->
name|nam
argument_list|,
name|ip
argument_list|,
name|paramtab
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|argvparam
operator|=
name|gethnode
argument_list|(
literal|"argv"
argument_list|,
name|paramtab
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|unsetflag
decl_stmt|;
end_decl_stmt

begin_function
name|struct
name|param
modifier|*
name|createparam
parameter_list|(
name|name
parameter_list|,
name|value
parameter_list|,
name|flags
parameter_list|)
comment|/**/
name|char
modifier|*
name|name
decl_stmt|;
name|vptr
name|value
decl_stmt|;
name|int
name|flags
decl_stmt|;
block|{
name|struct
name|param
modifier|*
name|pm
decl_stmt|;
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
name|pm
operator|=
name|zcalloc
argument_list|(
sizeof|sizeof
expr|*
name|pm
argument_list|)
expr_stmt|;
if|if
condition|(
name|isset
argument_list|(
name|ALLEXPORT
argument_list|)
condition|)
name|flags
operator||=
name|PMFLAG_x
expr_stmt|;
name|pm
operator|->
name|flags
operator|=
name|flags
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
name|PMTYPE
operator|)
operator|==
name|PMFLAG_s
condition|)
block|{
name|pm
operator|->
name|u
operator|.
name|str
operator|=
name|value
expr_stmt|;
name|pm
operator|->
name|sets
operator|.
name|cfn
operator|=
name|strsetfn
expr_stmt|;
name|pm
operator|->
name|gets
operator|.
name|cfn
operator|=
name|strgetfn
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|flags
operator|&
name|PMTYPE
operator|)
operator|==
name|PMFLAG_A
condition|)
block|{
name|pm
operator|->
name|u
operator|.
name|arr
operator|=
name|value
expr_stmt|;
name|pm
operator|->
name|sets
operator|.
name|afn
operator|=
name|arrsetfn
expr_stmt|;
name|pm
operator|->
name|gets
operator|.
name|afn
operator|=
name|arrgetfn
expr_stmt|;
block|}
else|else
block|{
name|pm
operator|->
name|u
operator|.
name|val
operator|=
operator|(
name|value
operator|)
condition|?
name|matheval
argument_list|(
name|value
argument_list|)
else|:
literal|0
expr_stmt|;
name|pm
operator|->
name|sets
operator|.
name|ifn
operator|=
name|intsetfn
expr_stmt|;
name|pm
operator|->
name|gets
operator|.
name|ifn
operator|=
name|intgetfn
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%ld"
argument_list|,
name|pm
operator|->
name|u
operator|.
name|val
argument_list|)
expr_stmt|;
name|value
operator|=
name|buf
expr_stmt|;
block|}
if|if
condition|(
name|flags
operator|&
name|PMFLAG_x
condition|)
name|pm
operator|->
name|env
operator|=
name|addenv
argument_list|(
name|name
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|addhnode
argument_list|(
name|ztrdup
argument_list|(
name|name
argument_list|)
argument_list|,
name|pm
argument_list|,
name|paramtab
argument_list|,
name|freepm
argument_list|)
expr_stmt|;
return|return
name|pm
return|;
block|}
end_function

begin_function
name|int
name|isident
parameter_list|(
name|s
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|char
modifier|*
name|ss
decl_stmt|;
for|for
control|(
name|ss
operator|=
name|s
init|;
operator|*
name|ss
condition|;
name|ss
operator|++
control|)
if|if
condition|(
operator|!
name|iident
argument_list|(
operator|*
name|ss
argument_list|)
condition|)
break|break;
if|if
condition|(
operator|!
operator|*
name|ss
operator|||
operator|*
name|ss
operator|==
literal|'['
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|*
name|s
operator|==
name|Quest
condition|)
operator|*
name|s
operator|=
literal|'?'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|Pound
condition|)
operator|*
name|s
operator|=
literal|'#'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|String
operator|||
operator|*
name|s
operator|==
name|Qstring
condition|)
operator|*
name|s
operator|=
literal|'$'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|Star
condition|)
operator|*
name|s
operator|=
literal|'*'
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|'#'
operator|||
operator|*
name|s
operator|==
literal|'-'
operator|||
operator|*
name|s
operator|==
literal|'?'
operator|||
operator|*
name|s
operator|==
literal|'$'
operator|||
operator|*
name|s
operator|==
literal|'_'
operator|||
operator|*
name|s
operator|==
literal|'!'
operator|||
operator|*
name|s
operator|==
literal|'@'
operator|||
operator|*
name|s
operator|==
literal|'*'
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|Value
name|getvalue
parameter_list|(
name|pptr
parameter_list|,
name|bracks
parameter_list|)
comment|/**/
name|char
modifier|*
modifier|*
name|pptr
decl_stmt|;
name|int
name|bracks
decl_stmt|;
block|{
name|char
modifier|*
name|s
init|=
operator|*
name|pptr
decl_stmt|,
modifier|*
name|t
init|=
operator|*
name|pptr
decl_stmt|;
name|char
name|sav
decl_stmt|;
name|Value
name|v
decl_stmt|;
if|if
condition|(
name|idigit
argument_list|(
operator|*
name|s
argument_list|)
condition|)
while|while
condition|(
name|idigit
argument_list|(
operator|*
name|s
argument_list|)
condition|)
name|s
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|iident
argument_list|(
operator|*
name|s
argument_list|)
condition|)
while|while
condition|(
name|iident
argument_list|(
operator|*
name|s
argument_list|)
condition|)
name|s
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|Quest
condition|)
operator|*
name|s
operator|++
operator|=
literal|'?'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|Pound
condition|)
operator|*
name|s
operator|++
operator|=
literal|'#'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|String
condition|)
operator|*
name|s
operator|++
operator|=
literal|'$'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|Qstring
condition|)
operator|*
name|s
operator|++
operator|=
literal|'$'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
name|Star
condition|)
operator|*
name|s
operator|++
operator|=
literal|'*'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
literal|'#'
operator|||
operator|*
name|s
operator|==
literal|'-'
operator|||
operator|*
name|s
operator|==
literal|'?'
operator|||
operator|*
name|s
operator|==
literal|'$'
operator|||
operator|*
name|s
operator|==
literal|'_'
operator|||
operator|*
name|s
operator|==
literal|'!'
operator|||
operator|*
name|s
operator|==
literal|'@'
operator|||
operator|*
name|s
operator|==
literal|'*'
condition|)
name|s
operator|++
expr_stmt|;
else|else
return|return
name|NULL
return|;
if|if
condition|(
name|sav
operator|=
operator|*
name|s
condition|)
operator|*
name|s
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|idigit
argument_list|(
operator|*
name|t
argument_list|)
operator|&&
operator|*
name|t
operator|!=
literal|'0'
condition|)
block|{
name|v
operator|=
operator|(
name|Value
operator|)
name|hcalloc
argument_list|(
sizeof|sizeof
expr|*
name|v
argument_list|)
expr_stmt|;
name|v
operator|->
name|pm
operator|=
name|argvparam
expr_stmt|;
name|v
operator|->
name|a
operator|=
name|v
operator|->
name|b
operator|=
name|atoi
argument_list|(
name|t
argument_list|)
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|sav
condition|)
operator|*
name|s
operator|=
name|sav
expr_stmt|;
block|}
else|else
block|{
name|struct
name|param
modifier|*
name|pm
decl_stmt|;
name|int
name|isvarat
init|=
operator|!
name|strcmp
argument_list|(
name|t
argument_list|,
literal|"@"
argument_list|)
decl_stmt|;
name|pm
operator|=
name|gethnode
argument_list|(
name|t
argument_list|,
name|paramtab
argument_list|)
expr_stmt|;
if|if
condition|(
name|sav
condition|)
operator|*
name|s
operator|=
name|sav
expr_stmt|;
operator|*
name|pptr
operator|=
name|s
expr_stmt|;
if|if
condition|(
operator|!
name|pm
condition|)
return|return
name|NULL
return|;
name|v
operator|=
name|hcalloc
argument_list|(
sizeof|sizeof
expr|*
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|pmtype
argument_list|(
name|pm
argument_list|)
operator|==
name|PMFLAG_A
condition|)
name|v
operator|->
name|isarr
operator|=
name|isvarat
condition|?
operator|-
literal|1
else|:
literal|1
expr_stmt|;
name|v
operator|->
name|pm
operator|=
name|pm
expr_stmt|;
name|v
operator|->
name|a
operator|=
literal|0
expr_stmt|;
name|v
operator|->
name|b
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|bracks
operator|&&
operator|(
operator|*
name|s
operator|==
literal|'['
operator|||
operator|*
name|s
operator|==
name|Inbrack
operator|)
condition|)
block|{
name|int
name|a
decl_stmt|,
name|b
decl_stmt|;
name|char
modifier|*
name|olds
init|=
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|;
operator|*
name|s
operator|++
operator|=
literal|'['
expr_stmt|;
for|for
control|(
name|t
operator|=
name|s
init|;
operator|*
name|t
operator|&&
operator|*
name|t
operator|!=
literal|']'
operator|&&
operator|*
name|t
operator|!=
name|Outbrack
condition|;
name|t
operator|++
control|)
if|if
condition|(
name|itok
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
name|ztokens
index|[
operator|*
name|t
operator|-
name|Pound
index|]
expr_stmt|;
if|if
condition|(
operator|*
name|t
operator|==
name|Outbrack
condition|)
operator|*
name|t
operator|=
literal|']'
expr_stmt|;
if|if
condition|(
operator|(
name|s
index|[
literal|0
index|]
operator|==
literal|'*'
operator|||
name|s
index|[
literal|0
index|]
operator|==
literal|'@'
operator|)
operator|&&
name|s
index|[
literal|1
index|]
operator|==
literal|']'
condition|)
block|{
if|if
condition|(
name|v
operator|->
name|isarr
condition|)
name|v
operator|->
name|isarr
operator|=
operator|(
name|s
index|[
literal|0
index|]
operator|==
literal|'*'
operator|)
condition|?
literal|1
else|:
operator|-
literal|1
expr_stmt|;
name|v
operator|->
name|a
operator|=
literal|0
expr_stmt|;
name|v
operator|->
name|b
operator|=
operator|-
literal|1
expr_stmt|;
name|s
operator|+=
literal|2
expr_stmt|;
block|}
else|else
block|{
name|a
operator|=
name|mathevalarg
argument_list|(
name|s
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|>
literal|0
condition|)
name|a
operator|--
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|','
operator|||
operator|*
name|s
operator|==
name|Comma
condition|)
block|{
name|s
operator|++
expr_stmt|;
name|b
operator|=
name|mathevalarg
argument_list|(
name|s
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
operator|>
literal|0
condition|)
name|b
operator|--
expr_stmt|;
block|}
else|else
name|b
operator|=
name|a
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|']'
condition|)
block|{
name|s
operator|++
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|isarr
operator|&&
name|a
operator|==
name|b
condition|)
name|v
operator|->
name|isarr
operator|=
literal|0
expr_stmt|;
name|v
operator|->
name|a
operator|=
name|a
expr_stmt|;
name|v
operator|->
name|b
operator|=
name|b
expr_stmt|;
block|}
else|else
name|s
operator|=
name|olds
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|bracks
operator|&&
operator|*
name|s
condition|)
return|return
name|NULL
return|;
operator|*
name|pptr
operator|=
name|s
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|getstrvalue
parameter_list|(
name|v
parameter_list|)
comment|/**/
name|Value
name|v
decl_stmt|;
block|{
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
modifier|*
name|ss
decl_stmt|;
specifier|static
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|v
condition|)
return|return
literal|""
return|;
if|if
condition|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
operator|!=
name|PMFLAG_A
condition|)
block|{
if|if
condition|(
operator|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
operator|==
name|PMFLAG_i
operator|)
condition|)
name|convbase
argument_list|(
name|s
operator|=
name|buf
argument_list|,
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|ifn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
argument_list|,
name|v
operator|->
name|pm
operator|->
name|ct
argument_list|)
expr_stmt|;
else|else
name|s
operator|=
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|cfn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|==
literal|0
operator|&&
name|v
operator|->
name|b
operator|==
operator|-
literal|1
condition|)
return|return
name|s
return|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|v
operator|->
name|a
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|b
operator|<
literal|0
condition|)
name|v
operator|->
name|b
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|s
operator|=
operator|(
name|v
operator|->
name|a
operator|>
name|strlen
argument_list|(
name|s
argument_list|)
operator|)
condition|?
name|strdup
argument_list|(
literal|""
argument_list|)
else|:
name|strdup
argument_list|(
name|s
operator|+
name|v
operator|->
name|a
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|b
operator|<
name|v
operator|->
name|a
condition|)
name|s
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
elseif|else
if|if
condition|(
name|v
operator|->
name|b
operator|-
name|v
operator|->
name|a
operator|<
name|strlen
argument_list|(
name|s
argument_list|)
condition|)
name|s
index|[
name|v
operator|->
name|b
operator|-
name|v
operator|->
name|a
operator|+
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|s
return|;
block|}
if|if
condition|(
name|v
operator|->
name|isarr
condition|)
return|return
name|spacejoin
argument_list|(
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|afn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
argument_list|)
return|;
name|ss
operator|=
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|afn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|v
operator|->
name|a
operator|+=
name|arrlen
argument_list|(
name|ss
argument_list|)
expr_stmt|;
name|s
operator|=
operator|(
name|v
operator|->
name|a
operator|>=
name|arrlen
argument_list|(
name|ss
argument_list|)
operator|||
name|v
operator|->
name|a
operator|<
literal|0
operator|)
condition|?
literal|""
else|:
name|ss
index|[
name|v
operator|->
name|a
index|]
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|getarrvalue
parameter_list|(
name|v
parameter_list|)
comment|/**/
name|Value
name|v
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|s
decl_stmt|;
specifier|static
name|char
modifier|*
name|nular
index|[]
init|=
block|{
literal|""
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|v
condition|)
return|return
name|arrdup
argument_list|(
name|nular
argument_list|)
return|;
name|s
operator|=
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|afn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|==
literal|0
operator|&&
name|v
operator|->
name|b
operator|==
operator|-
literal|1
condition|)
return|return
name|s
return|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|v
operator|->
name|a
operator|+=
name|arrlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|b
operator|<
literal|0
condition|)
name|v
operator|->
name|b
operator|+=
name|arrlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|>
name|arrlen
argument_list|(
name|s
argument_list|)
operator|||
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|s
operator|=
name|arrdup
argument_list|(
name|nular
argument_list|)
expr_stmt|;
else|else
name|s
operator|=
name|arrdup
argument_list|(
name|s
argument_list|)
operator|+
name|v
operator|->
name|a
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|b
operator|<
name|v
operator|->
name|a
condition|)
name|s
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if
condition|(
name|v
operator|->
name|b
operator|-
name|v
operator|->
name|a
operator|<
name|arrlen
argument_list|(
name|s
argument_list|)
condition|)
name|s
index|[
name|v
operator|->
name|b
operator|-
name|v
operator|->
name|a
operator|+
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
name|long
name|getintvalue
parameter_list|(
name|v
parameter_list|)
comment|/**/
name|Value
name|v
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|ss
decl_stmt|;
if|if
condition|(
operator|!
name|v
operator|||
name|v
operator|->
name|isarr
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
operator|!=
name|PMFLAG_A
condition|)
block|{
if|if
condition|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
operator|==
name|PMFLAG_i
condition|)
return|return
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|ifn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
return|;
return|return
name|atol
argument_list|(
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|cfn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
argument_list|)
return|;
block|}
name|ss
operator|=
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|afn
argument_list|(
name|v
operator|->
name|pm
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|v
operator|->
name|a
operator|+=
name|arrlen
argument_list|(
name|ss
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
operator|||
name|v
operator|->
name|a
operator|>
name|arrlen
argument_list|(
name|ss
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|atol
argument_list|(
name|ss
index|[
name|v
operator|->
name|a
index|]
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|setstrvalue
parameter_list|(
name|v
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|Value
name|v
decl_stmt|;
name|char
modifier|*
name|val
decl_stmt|;
block|{
name|char
modifier|*
name|s
decl_stmt|;
if|if
condition|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_r
condition|)
block|{
name|free
argument_list|(
name|val
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|s
operator|=
name|v
operator|->
name|pm
operator|->
name|env
operator|)
operator|&&
name|val
condition|)
name|v
operator|->
name|pm
operator|->
name|env
operator|=
name|replenv
argument_list|(
name|v
operator|->
name|pm
operator|->
name|env
argument_list|,
name|val
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
condition|)
block|{
case|case
name|PMFLAG_s
case|:
if|if
condition|(
name|v
operator|->
name|a
operator|==
literal|0
operator|&&
name|v
operator|->
name|b
operator|==
operator|-
literal|1
condition|)
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|cfn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|val
argument_list|)
expr_stmt|;
else|else
block|{
name|char
modifier|*
name|z
decl_stmt|,
modifier|*
name|y
decl_stmt|,
modifier|*
name|x
decl_stmt|;
name|z
operator|=
name|strdup
argument_list|(
call|(
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|cfn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
block|{
name|v
operator|->
name|a
operator|+=
name|strlen
argument_list|(
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|v
operator|->
name|a
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|v
operator|->
name|a
operator|>
name|strlen
argument_list|(
name|z
argument_list|)
condition|)
name|v
operator|->
name|a
operator|=
name|strlen
argument_list|(
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|b
operator|<
literal|0
condition|)
name|v
operator|->
name|b
operator|+=
name|strlen
argument_list|(
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|b
operator|<
name|v
operator|->
name|a
condition|)
name|v
operator|->
name|b
operator|=
name|v
operator|->
name|a
expr_stmt|;
name|z
index|[
name|v
operator|->
name|a
index|]
operator|=
literal|'\0'
expr_stmt|;
name|y
operator|=
name|z
operator|+
name|v
operator|->
name|b
operator|+
literal|1
expr_stmt|;
name|x
operator|=
name|zalloc
argument_list|(
name|strlen
argument_list|(
name|z
argument_list|)
operator|+
name|strlen
argument_list|(
name|y
argument_list|)
operator|+
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|x
argument_list|,
name|z
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|x
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|cfn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
operator|(
name|PMFLAG_L
operator||
name|PMFLAG_R
operator||
name|PMFLAG_Z
operator|)
operator|&&
operator|!
name|v
operator|->
name|pm
operator|->
name|ct
condition|)
name|v
operator|->
name|pm
operator|->
name|ct
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
break|break;
case|case
name|PMFLAG_i
case|:
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|ifn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|matheval
argument_list|(
name|val
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|v
operator|->
name|pm
operator|->
name|ct
operator|&&
name|lastbase
operator|!=
literal|1
condition|)
name|v
operator|->
name|pm
operator|->
name|ct
operator|=
name|lastbase
expr_stmt|;
name|free
argument_list|(
name|val
argument_list|)
expr_stmt|;
break|break;
case|case
name|PMFLAG_A
case|:
if|if
condition|(
name|v
operator|->
name|a
operator|!=
name|v
operator|->
name|b
condition|)
name|zerr
argument_list|(
literal|"illegal array assignment"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
block|{
name|char
modifier|*
modifier|*
name|ss
init|=
call|(
name|v
operator|->
name|pm
operator|->
name|gets
operator|.
name|afn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|)
decl_stmt|;
name|int
name|ac
decl_stmt|,
name|ad
decl_stmt|,
name|t0
decl_stmt|;
name|ac
operator|=
name|arrlen
argument_list|(
name|ss
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
block|{
name|v
operator|->
name|a
operator|+=
name|ac
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|a
operator|<
literal|0
condition|)
name|v
operator|->
name|a
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|v
operator|->
name|a
operator|>=
name|ac
condition|)
block|{
name|char
modifier|*
modifier|*
name|st
init|=
name|ss
decl_stmt|;
name|ad
operator|=
name|v
operator|->
name|a
operator|+
literal|1
expr_stmt|;
name|ss
operator|=
name|zalloc
argument_list|(
operator|(
name|ad
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
expr|*
name|ss
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|ss
argument_list|,
name|st
argument_list|,
operator|(
name|ad
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
expr|*
name|ss
argument_list|)
expr_stmt|;
for|for
control|(
name|t0
operator|=
literal|0
init|;
name|t0
operator|!=
name|ac
condition|;
name|t0
operator|++
control|)
name|ss
index|[
name|t0
index|]
operator|=
name|ztrdup
argument_list|(
name|ss
index|[
name|t0
index|]
argument_list|)
expr_stmt|;
while|while
condition|(
name|ac
operator|<
name|ad
condition|)
name|ss
index|[
name|ac
operator|++
index|]
operator|=
name|ztrdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|ss
index|[
name|ac
index|]
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|ss
index|[
name|v
operator|->
name|a
index|]
condition|)
name|free
argument_list|(
name|ss
index|[
name|v
operator|->
name|a
index|]
argument_list|)
expr_stmt|;
name|ss
index|[
name|v
operator|->
name|a
index|]
operator|=
name|val
expr_stmt|;
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|afn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|ss
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
name|void
name|setintvalue
parameter_list|(
name|v
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|Value
name|v
decl_stmt|;
name|long
name|val
decl_stmt|;
block|{
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_r
condition|)
return|return;
if|if
condition|(
name|v
operator|->
name|pm
operator|->
name|env
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%ld"
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|v
operator|->
name|pm
operator|->
name|env
operator|=
name|replenv
argument_list|(
name|v
operator|->
name|pm
operator|->
name|env
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
condition|)
block|{
case|case
name|PMFLAG_s
case|:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%ld"
argument_list|,
name|val
argument_list|)
expr_stmt|;
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|cfn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|ztrdup
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PMFLAG_i
case|:
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|ifn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|v
operator|->
name|pm
operator|->
name|ct
operator|&&
name|lastbase
operator|!=
operator|-
literal|1
condition|)
name|v
operator|->
name|pm
operator|->
name|ct
operator|=
name|lastbase
expr_stmt|;
break|break;
case|case
name|PMFLAG_A
case|:
name|zerr
argument_list|(
literal|"attempt to assign integer to array"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
name|void
name|setintenv
parameter_list|(
name|s
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|long
name|val
decl_stmt|;
block|{
name|Param
name|pm
decl_stmt|;
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|pm
operator|=
name|gethnode
argument_list|(
name|s
argument_list|,
name|paramtab
argument_list|)
operator|)
operator|&&
name|pm
operator|->
name|env
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%ld"
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|pm
operator|->
name|env
operator|=
name|replenv
argument_list|(
name|pm
operator|->
name|env
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|setarrvalue
parameter_list|(
name|v
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|Value
name|v
decl_stmt|;
name|char
modifier|*
modifier|*
name|val
decl_stmt|;
block|{
if|if
condition|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_r
condition|)
return|return;
if|if
condition|(
name|pmtype
argument_list|(
name|v
operator|->
name|pm
argument_list|)
operator|!=
name|PMFLAG_A
condition|)
block|{
name|zerr
argument_list|(
literal|"attempt to assign array value to non-array"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
call|(
name|v
operator|->
name|pm
operator|->
name|sets
operator|.
name|afn
call|)
argument_list|(
name|v
operator|->
name|pm
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|getsparamval
parameter_list|(
name|s
parameter_list|,
name|l
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|l
decl_stmt|;
block|{
name|char
name|sav
decl_stmt|,
modifier|*
name|t
init|=
name|s
decl_stmt|;
name|Value
name|v
decl_stmt|;
if|if
condition|(
name|sav
operator|=
name|t
index|[
name|l
index|]
condition|)
name|t
index|[
name|l
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|0
argument_list|)
operator|)
condition|)
return|return
name|NULL
return|;
name|t
index|[
name|l
index|]
operator|=
name|sav
expr_stmt|;
name|t
operator|=
name|getstrvalue
argument_list|(
name|v
argument_list|)
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function
name|long
name|getiparam
parameter_list|(
name|s
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|Value
name|v
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|0
argument_list|)
operator|)
condition|)
return|return
literal|0
return|;
return|return
name|getintvalue
argument_list|(
name|v
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|getsparam
parameter_list|(
name|s
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|Value
name|v
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|0
argument_list|)
operator|)
condition|)
return|return
name|NULL
return|;
return|return
name|getstrvalue
argument_list|(
name|v
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|getaparam
parameter_list|(
name|s
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|Value
name|v
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|0
argument_list|)
operator|)
condition|)
return|return
name|NULL
return|;
return|return
name|getarrvalue
argument_list|(
name|v
argument_list|)
return|;
block|}
end_function

begin_function
name|Param
name|setsparam
parameter_list|(
name|s
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|char
modifier|*
name|val
decl_stmt|;
block|{
name|Value
name|v
decl_stmt|;
name|char
modifier|*
name|t
init|=
name|s
decl_stmt|;
if|if
condition|(
operator|!
name|isident
argument_list|(
name|s
argument_list|)
condition|)
block|{
name|zerr
argument_list|(
literal|"not an identifier: %s"
argument_list|,
name|s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|val
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|1
argument_list|)
operator|)
operator|||
operator|*
name|s
condition|)
return|return
name|createparam
argument_list|(
name|t
argument_list|,
name|val
argument_list|,
name|PMFLAG_s
argument_list|)
return|;
if|if
condition|(
operator|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMTYPE
operator|)
operator|!=
name|PMFLAG_s
operator|&&
operator|!
operator|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_SPECIAL
operator|)
condition|)
block|{
name|unsetparam
argument_list|(
name|s
argument_list|)
expr_stmt|;
return|return
name|createparam
argument_list|(
name|t
argument_list|,
name|val
argument_list|,
name|PMFLAG_s
argument_list|)
return|;
block|}
name|setstrvalue
argument_list|(
name|v
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
name|v
operator|->
name|pm
return|;
block|}
end_function

begin_function
name|Param
name|setaparam
parameter_list|(
name|s
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|char
modifier|*
modifier|*
name|val
decl_stmt|;
block|{
name|Value
name|v
decl_stmt|;
name|char
modifier|*
name|t
init|=
name|s
decl_stmt|;
if|if
condition|(
operator|!
name|isident
argument_list|(
name|s
argument_list|)
condition|)
block|{
name|zerr
argument_list|(
literal|"not an identifier: %s"
argument_list|,
name|s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|1
argument_list|)
operator|)
operator|||
operator|*
name|s
condition|)
return|return
name|createparam
argument_list|(
name|t
argument_list|,
name|val
argument_list|,
name|PMFLAG_A
argument_list|)
return|;
if|if
condition|(
operator|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMTYPE
operator|)
operator|!=
name|PMFLAG_A
operator|&&
operator|!
operator|(
name|v
operator|->
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_SPECIAL
operator|)
condition|)
block|{
name|unsetparam
argument_list|(
name|s
argument_list|)
expr_stmt|;
return|return
name|createparam
argument_list|(
name|t
argument_list|,
name|val
argument_list|,
name|PMFLAG_A
argument_list|)
return|;
block|}
name|setarrvalue
argument_list|(
name|v
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
name|v
operator|->
name|pm
return|;
block|}
end_function

begin_function
name|Param
name|setiparam
parameter_list|(
name|s
parameter_list|,
name|val
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|long
name|val
decl_stmt|;
block|{
name|Value
name|v
decl_stmt|;
name|char
modifier|*
name|t
init|=
name|s
decl_stmt|;
name|Param
name|pm
decl_stmt|;
if|if
condition|(
operator|!
name|isident
argument_list|(
name|s
argument_list|)
condition|)
block|{
name|zerr
argument_list|(
literal|"not an identifier: %s"
argument_list|,
name|s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|v
operator|=
name|getvalue
argument_list|(
operator|&
name|s
argument_list|,
literal|0
argument_list|)
operator|)
condition|)
block|{
name|pm
operator|=
name|createparam
argument_list|(
name|t
argument_list|,
name|NULL
argument_list|,
name|PMFLAG_i
argument_list|)
expr_stmt|;
name|pm
operator|->
name|u
operator|.
name|val
operator|=
name|val
expr_stmt|;
return|return
name|pm
return|;
block|}
name|setintvalue
argument_list|(
name|v
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
name|v
operator|->
name|pm
return|;
block|}
end_function

begin_function
name|void
name|unsetparam
parameter_list|(
name|s
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|Param
name|pm
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|pm
operator|=
name|gethnode
argument_list|(
name|s
argument_list|,
name|paramtab
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_r
condition|)
return|return;
name|unsetflag
operator|=
literal|1
expr_stmt|;
switch|switch
condition|(
name|pmtype
argument_list|(
name|pm
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
call|(
name|pm
operator|->
name|sets
operator|.
name|cfn
call|)
argument_list|(
name|pm
argument_list|,
name|ztrdup
argument_list|(
literal|""
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PMFLAG_i
case|:
call|(
name|pm
operator|->
name|sets
operator|.
name|ifn
call|)
argument_list|(
name|pm
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|PMFLAG_A
case|:
call|(
name|pm
operator|->
name|sets
operator|.
name|afn
call|)
argument_list|(
name|pm
argument_list|,
name|mkarray
argument_list|(
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|pmtype
argument_list|(
name|pm
argument_list|)
operator|==
name|PMFLAG_s
operator|&&
operator|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_x
operator|)
condition|)
block|{
name|delenv
argument_list|(
name|pm
operator|->
name|env
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pm
operator|->
name|env
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_SPECIAL
operator|)
condition|)
name|freepm
argument_list|(
name|remhnode
argument_list|(
name|s
argument_list|,
name|paramtab
argument_list|)
argument_list|)
expr_stmt|;
name|unsetflag
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|void
name|intsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|x
decl_stmt|;
block|{
name|pm
operator|->
name|u
operator|.
name|val
operator|=
name|x
expr_stmt|;
block|}
end_function

begin_function
name|long
name|intgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|pm
operator|->
name|u
operator|.
name|val
return|;
block|}
end_function

begin_function
name|void
name|strsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
if|if
condition|(
name|x
condition|)
block|{
if|if
condition|(
name|pm
operator|->
name|u
operator|.
name|str
condition|)
name|free
argument_list|(
name|pm
operator|->
name|u
operator|.
name|str
argument_list|)
expr_stmt|;
name|pm
operator|->
name|u
operator|.
name|str
operator|=
name|x
expr_stmt|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|strgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|pm
operator|->
name|u
operator|.
name|str
return|;
block|}
end_function

begin_function
name|void
name|nullsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|free
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|arrsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
name|int
name|ct
decl_stmt|;
if|if
condition|(
name|x
condition|)
block|{
if|if
condition|(
name|pm
operator|->
name|u
operator|.
name|arr
operator|&&
name|pm
operator|->
name|u
operator|.
name|arr
operator|!=
name|x
condition|)
name|freearray
argument_list|(
name|pm
operator|->
name|u
operator|.
name|arr
argument_list|)
expr_stmt|;
name|pm
operator|->
name|u
operator|.
name|arr
operator|=
name|x
expr_stmt|;
for|for
control|(
name|ct
operator|=
literal|0
init|;
operator|*
name|x
condition|;
name|x
operator|++
operator|,
name|ct
operator|++
control|)
empty_stmt|;
name|pm
operator|->
name|ct
operator|=
name|ct
expr_stmt|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|arrgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|pm
operator|->
name|u
operator|.
name|arr
return|;
block|}
end_function

begin_function
name|void
name|intvarsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|x
decl_stmt|;
block|{
operator|*
operator|(
operator|(
name|long
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
operator|=
name|x
expr_stmt|;
block|}
end_function

begin_function
name|long
name|intvargetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
operator|*
operator|(
operator|(
name|long
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
return|;
block|}
end_function

begin_function
name|void
name|strvarsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|q
init|=
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
decl_stmt|;
if|if
condition|(
operator|*
name|q
condition|)
name|free
argument_list|(
operator|*
name|q
argument_list|)
expr_stmt|;
operator|*
name|q
operator|=
name|x
expr_stmt|;
block|}
end_function

begin_function
name|void
name|strvarnonullsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|q
init|=
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
decl_stmt|;
if|if
condition|(
operator|*
name|q
condition|)
name|free
argument_list|(
operator|*
name|q
argument_list|)
expr_stmt|;
operator|*
name|q
operator|=
operator|(
name|x
operator|)
condition|?
name|x
else|:
name|ztrdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|strvargetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
name|char
modifier|*
name|s
decl_stmt|;
name|s
operator|=
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
condition|)
return|return
literal|""
return|;
return|return
name|s
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|strconstgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
operator|(
name|char
operator|*
operator|)
name|pm
operator|->
name|data
return|;
block|}
end_function

begin_function
name|void
name|colonarrsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|s
decl_stmt|,
modifier|*
modifier|*
name|t
decl_stmt|,
modifier|*
name|u
decl_stmt|,
modifier|*
name|up
decl_stmt|;
name|s
operator|=
name|colonsplit
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|data
operator|!=
operator|&
name|fignore
condition|)
for|for
control|(
name|t
operator|=
name|s
init|;
operator|*
name|t
condition|;
name|t
operator|++
control|)
block|{
name|u
operator|=
operator|*
name|t
expr_stmt|;
if|if
condition|(
operator|*
name|u
operator|==
literal|'~'
condition|)
operator|*
name|u
operator|=
name|Tilde
expr_stmt|;
if|if
condition|(
operator|*
name|u
operator|==
literal|'='
condition|)
operator|*
name|u
operator|=
name|Equals
expr_stmt|;
name|up
operator|=
name|hcalloc
argument_list|(
name|strlen
argument_list|(
name|u
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|up
argument_list|,
name|u
argument_list|)
expr_stmt|;
name|u
operator|=
name|up
expr_stmt|;
name|filesub
argument_list|(
operator|&
name|u
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|u
condition|)
name|u
operator|=
literal|"."
expr_stmt|;
operator|*
name|t
operator|=
name|ztrdup
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pm
operator|->
name|data
condition|)
block|{
name|freearray
argument_list|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
operator|=
name|s
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|ename
condition|)
name|arrfixenv
argument_list|(
name|pm
operator|->
name|ename
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|freearray
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|path
operator|=
name|s
expr_stmt|;
name|newcmdnamtab
argument_list|()
expr_stmt|;
name|arrfixenv
argument_list|(
literal|"PATH"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|colonarrgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|char
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
condition|)
return|return
name|colonjoin
argument_list|(
operator|*
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
argument_list|)
return|;
else|else
return|return
name|colonjoin
argument_list|(
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|arrvargetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
return|;
block|}
end_function

begin_function
name|void
name|arrvarsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
if|if
condition|(
operator|(
operator|*
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
operator|!=
name|x
condition|)
name|freearray
argument_list|(
operator|*
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
argument_list|)
expr_stmt|;
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|*
operator|)
name|pm
operator|->
name|data
operator|)
operator|=
name|x
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|ename
condition|)
name|arrfixenv
argument_list|(
name|pm
operator|->
name|ename
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|pathgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|path
return|;
block|}
end_function

begin_function
name|void
name|pathsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
if|if
condition|(
name|path
operator|!=
name|x
condition|)
name|freearray
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|path
operator|=
name|x
expr_stmt|;
name|newcmdnamtab
argument_list|()
expr_stmt|;
name|arrfixenv
argument_list|(
literal|"PATH"
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|hostcmdssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
name|compctl_process
argument_list|(
name|x
argument_list|,
name|CC_HOSTS
operator||
name|CC_FILES
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|freearray
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|optcmdssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
name|compctl_process
argument_list|(
name|x
argument_list|,
name|CC_OPTIONS
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|freearray
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|bindcmdssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
name|compctl_process
argument_list|(
name|x
argument_list|,
name|CC_BINDINGS
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|freearray
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|varcmdssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
name|compctl_process
argument_list|(
name|x
argument_list|,
name|CC_VARS
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|freearray
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|nullgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
specifier|static
name|char
modifier|*
name|nl
init|=
name|NULL
decl_stmt|;
return|return
operator|&
name|nl
return|;
block|}
end_function

begin_function
name|void
name|unsettablesetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
empty_stmt|;
block|}
end_function

begin_function
name|long
name|poundgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|arrlen
argument_list|(
name|pparams
argument_list|)
return|;
block|}
end_function

begin_function
name|long
name|randomgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|rand
argument_list|()
operator|&
literal|0x7fff
return|;
block|}
end_function

begin_function
name|void
name|randomsetfn
parameter_list|(
name|pm
parameter_list|,
name|v
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|v
decl_stmt|;
block|{
name|srand
argument_list|(
operator|(
name|unsigned
name|int
operator|)
name|v
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|long
name|secondsgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|shtimer
return|;
block|}
end_function

begin_function
name|void
name|secondssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|x
decl_stmt|;
block|{
name|shtimer
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|x
expr_stmt|;
block|}
end_function

begin_function
name|long
name|uidgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|getuid
argument_list|()
return|;
block|}
end_function

begin_function
name|long
name|gidgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|getegid
argument_list|()
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|usernamegetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
name|struct
name|passwd
modifier|*
name|pwd
decl_stmt|;
name|pwd
operator|=
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|pwd
operator|->
name|pw_name
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|hostgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
specifier|static
name|char
name|hostnam
index|[
literal|65
index|]
decl_stmt|;
specifier|static
name|int
name|got
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|got
condition|)
block|{
name|gethostname
argument_list|(
name|hostnam
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|hostnam
index|[
literal|64
index|]
operator|=
literal|'\0'
expr_stmt|;
name|got
operator|=
literal|1
expr_stmt|;
block|}
return|return
name|hostnam
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ifsgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|ifs
return|;
block|}
end_function

begin_function
name|void
name|ifssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
if|if
condition|(
name|x
condition|)
block|{
name|free
argument_list|(
name|ifs
argument_list|)
expr_stmt|;
name|ifs
operator|=
name|x
expr_stmt|;
block|}
name|inittyptab
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|histsizesetfn
parameter_list|(
name|pm
parameter_list|,
name|v
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|v
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|histsiz
operator|=
name|v
operator|)
operator|<=
literal|2
condition|)
name|histsiz
operator|=
literal|2
expr_stmt|;
name|resizehistents
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|long
name|histsizegetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|histsiz
return|;
block|}
end_function

begin_function
name|void
name|lithistsizesetfn
parameter_list|(
name|pm
parameter_list|,
name|v
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|v
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|lithistsiz
operator|=
name|v
operator|)
operator|<=
literal|2
condition|)
name|lithistsiz
operator|=
literal|2
expr_stmt|;
name|resizehistents
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|long
name|lithistsizegetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|lithistsiz
return|;
block|}
end_function

begin_function
name|void
name|mailchecksetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|long
name|x
decl_stmt|;
block|{
name|mailcheck
operator|=
operator|(
name|unsetflag
operator|)
condition|?
literal|600
else|:
name|x
expr_stmt|;
block|}
end_function

begin_function
name|void
name|pathasetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
modifier|*
name|x
decl_stmt|;
block|{
name|freearray
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|path
operator|=
name|x
expr_stmt|;
name|newcmdnamtab
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
name|pathagetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|path
return|;
block|}
end_function

begin_function
name|long
name|errnogetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|errno
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|dashgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
specifier|static
name|char
name|buf
index|[
literal|100
index|]
decl_stmt|;
name|char
modifier|*
name|val
init|=
name|buf
decl_stmt|;
name|int
name|t0
decl_stmt|;
for|for
control|(
name|val
operator|=
name|buf
operator|,
name|t0
operator|=
literal|' '
init|;
name|t0
operator|<=
literal|'z'
condition|;
name|t0
operator|++
control|)
if|if
condition|(
name|opts
index|[
name|t0
index|]
operator|==
name|OPT_SET
condition|)
operator|*
name|val
operator|++
operator|=
name|t0
expr_stmt|;
operator|*
name|val
operator|=
literal|'\0'
expr_stmt|;
return|return
name|buf
return|;
block|}
end_function

begin_function
name|void
name|histcharssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
if|if
condition|(
name|x
condition|)
block|{
name|bangchar
operator|=
name|x
index|[
literal|0
index|]
expr_stmt|;
name|hatchar
operator|=
operator|(
name|bangchar
operator|)
condition|?
name|x
index|[
literal|1
index|]
else|:
literal|'\0'
expr_stmt|;
name|hashchar
operator|=
operator|(
name|hatchar
operator|)
condition|?
name|x
index|[
literal|2
index|]
else|:
literal|'\0'
expr_stmt|;
name|free
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|histcharsgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
specifier|static
name|char
name|buf
index|[
literal|4
index|]
decl_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
name|bangchar
expr_stmt|;
name|buf
index|[
literal|1
index|]
operator|=
name|hatchar
expr_stmt|;
name|buf
index|[
literal|2
index|]
operator|=
name|hashchar
expr_stmt|;
name|buf
index|[
literal|3
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|buf
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|homegetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|home
return|;
block|}
end_function

begin_function
name|void
name|homesetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|free
argument_list|(
name|home
argument_list|)
expr_stmt|;
if|if
condition|(
name|isset
argument_list|(
name|CHASELINKS
argument_list|)
operator|&&
operator|(
name|home
operator|=
name|xsymlink
argument_list|(
name|x
argument_list|)
operator|)
condition|)
name|free
argument_list|(
name|x
argument_list|)
expr_stmt|;
else|else
name|home
operator|=
name|x
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|wordcharsgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|wordchars
return|;
block|}
end_function

begin_function
name|void
name|wordcharssetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|free
argument_list|(
name|wordchars
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
condition|)
name|wordchars
operator|=
name|x
expr_stmt|;
else|else
name|wordchars
operator|=
name|ztrdup
argument_list|(
name|DEFWORDCHARS
argument_list|)
expr_stmt|;
name|inittyptab
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|underscoregetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|s
operator|=
name|qgetevent
argument_list|(
name|curhist
operator|-
literal|1
argument_list|)
operator|)
condition|)
return|return
literal|""
return|;
for|for
control|(
name|t
operator|=
name|s
operator|+
name|strlen
argument_list|(
name|s
argument_list|)
init|;
name|t
operator|>
name|s
condition|;
name|t
operator|--
control|)
if|if
condition|(
operator|*
name|t
operator|==
name|HISTSPACE
condition|)
break|break;
if|if
condition|(
name|t
operator|!=
name|s
condition|)
name|t
operator|++
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|termgetfn
parameter_list|(
name|pm
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
block|{
return|return
name|term
return|;
block|}
end_function

begin_function
name|void
name|termsetfn
parameter_list|(
name|pm
parameter_list|,
name|x
parameter_list|)
comment|/**/
name|Param
name|pm
decl_stmt|;
name|char
modifier|*
name|x
decl_stmt|;
block|{
if|if
condition|(
name|term
condition|)
name|free
argument_list|(
name|term
argument_list|)
expr_stmt|;
name|term
operator|=
name|x
expr_stmt|;
if|if
condition|(
operator|!
name|interact
operator|||
name|unset
argument_list|(
name|USEZLE
argument_list|)
condition|)
return|return;
if|if
condition|(
name|tgetent
argument_list|(
name|termbuf
argument_list|,
name|term
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|zerr
argument_list|(
literal|"can't find termcap info for %s"
argument_list|,
name|term
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|errflag
operator|=
literal|0
expr_stmt|;
name|termok
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|char
name|tbuf
index|[
literal|1024
index|]
decl_stmt|,
modifier|*
name|pp
decl_stmt|;
name|int
name|t0
decl_stmt|;
name|termok
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|t0
operator|=
literal|0
init|;
name|t0
operator|!=
name|TC_COUNT
condition|;
name|t0
operator|++
control|)
block|{
name|pp
operator|=
name|tbuf
expr_stmt|;
if|if
condition|(
name|tcstr
index|[
name|t0
index|]
condition|)
name|free
argument_list|(
name|tcstr
index|[
name|t0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tgetstr
argument_list|(
name|tccapnams
index|[
name|t0
index|]
argument_list|,
operator|&
name|pp
argument_list|)
condition|)
name|tcstr
index|[
name|t0
index|]
operator|=
name|NULL
operator|,
name|tclen
index|[
name|t0
index|]
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|tcstr
index|[
name|t0
index|]
operator|=
name|zalloc
argument_list|(
name|tclen
index|[
name|t0
index|]
operator|=
name|pp
operator|-
name|tbuf
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|tcstr
index|[
name|t0
index|]
argument_list|,
name|tbuf
argument_list|,
name|tclen
index|[
name|t0
index|]
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* if there's no termcap entry for cursor left, use \b. */
if|if
condition|(
operator|!
name|tccan
argument_list|(
name|TCLEFT
argument_list|)
condition|)
block|{
name|tcstr
index|[
name|TCLEFT
index|]
operator|=
name|ztrdup
argument_list|(
literal|"\b"
argument_list|)
expr_stmt|;
name|tclen
index|[
name|TCLEFT
index|]
operator|=
literal|1
expr_stmt|;
block|}
comment|/* if there's no termcap entry for clear, use ^L. */
if|if
condition|(
operator|!
name|tccan
argument_list|(
name|TCCLEARSCREEN
argument_list|)
condition|)
block|{
name|tcstr
index|[
name|TCCLEARSCREEN
index|]
operator|=
name|ztrdup
argument_list|(
literal|"\14"
argument_list|)
expr_stmt|;
name|tclen
index|[
name|TCCLEARSCREEN
index|]
operator|=
literal|1
expr_stmt|;
block|}
comment|/* if the termcap entry for down is \n, don't use it. */
if|if
condition|(
name|tccan
argument_list|(
name|TCDOWN
argument_list|)
operator|&&
name|tcstr
index|[
name|TCDOWN
index|]
index|[
literal|0
index|]
operator|==
literal|'\n'
condition|)
block|{
name|tclen
index|[
name|TCDOWN
index|]
operator|=
literal|0
expr_stmt|;
name|free
argument_list|(
name|tcstr
index|[
name|TCDOWN
index|]
argument_list|)
expr_stmt|;
name|tcstr
index|[
name|TCDOWN
index|]
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* if there's no termcap entry for cursor up, forget it. 	Use single line mode. */
if|if
condition|(
operator|!
name|tccan
argument_list|(
name|TCUP
argument_list|)
condition|)
name|termok
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|setparams
parameter_list|()
comment|/**/
block|{
name|char
modifier|*
modifier|*
name|envp
decl_stmt|,
modifier|*
modifier|*
name|envp2
decl_stmt|,
modifier|*
modifier|*
name|envp3
decl_stmt|,
modifier|*
name|str
decl_stmt|;
name|char
name|buf
index|[
literal|50
index|]
decl_stmt|;
name|struct
name|param
modifier|*
name|pm
decl_stmt|;
name|int
name|ct
decl_stmt|;
name|noerrs
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|envp
operator|=
name|environ
operator|,
name|ct
operator|=
literal|2
init|;
operator|*
name|envp
condition|;
name|envp
operator|++
operator|,
name|ct
operator|++
control|)
empty_stmt|;
name|envp
operator|=
name|environ
expr_stmt|;
name|envp2
operator|=
name|envp3
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|zalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|ct
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|*
name|envp
condition|;
name|envp
operator|++
control|)
operator|*
name|envp2
operator|++
operator|=
name|ztrdup
argument_list|(
operator|*
name|envp
argument_list|)
expr_stmt|;
operator|*
name|envp2
operator|=
name|NULL
expr_stmt|;
name|envp
operator|=
name|environ
expr_stmt|;
name|environ
operator|=
name|envp2
operator|=
name|envp3
expr_stmt|;
for|for
control|(
init|;
operator|*
name|envp
condition|;
name|envp
operator|++
operator|,
name|envp2
operator|++
control|)
block|{
for|for
control|(
name|str
operator|=
operator|*
name|envp
init|;
operator|*
name|str
operator|&&
operator|*
name|str
operator|!=
literal|'='
condition|;
name|str
operator|++
control|)
empty_stmt|;
if|if
condition|(
operator|*
name|str
operator|==
literal|'='
condition|)
block|{
name|char
modifier|*
name|iname
decl_stmt|;
operator|*
name|str
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|isident
argument_list|(
operator|*
name|envp
argument_list|)
condition|)
name|pm
operator|=
name|setsparam
argument_list|(
name|iname
operator|=
operator|*
name|envp
argument_list|,
name|ztrdup
argument_list|(
name|str
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
condition|)
block|{
name|pm
operator|->
name|flags
operator||=
name|PMFLAG_x
expr_stmt|;
name|pm
operator|->
name|env
operator|=
operator|*
name|envp2
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_SPECIAL
condition|)
name|pm
operator|->
name|env
operator|=
name|replenv
argument_list|(
name|pm
operator|->
name|env
argument_list|,
name|getsparam
argument_list|(
name|iname
argument_list|)
argument_list|)
expr_stmt|;
block|}
operator|*
name|str
operator|=
literal|'='
expr_stmt|;
block|}
block|}
name|pm
operator|=
name|gethnode
argument_list|(
literal|"HOME"
argument_list|,
name|paramtab
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_x
operator|)
condition|)
block|{
name|pm
operator|->
name|flags
operator||=
name|PMFLAG_x
expr_stmt|;
name|pm
operator|->
name|env
operator|=
name|addenv
argument_list|(
literal|"HOME"
argument_list|,
name|home
argument_list|)
expr_stmt|;
block|}
name|pm
operator|=
name|gethnode
argument_list|(
literal|"PWD"
argument_list|,
name|paramtab
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_x
operator|)
condition|)
block|{
name|pm
operator|->
name|flags
operator||=
name|PMFLAG_x
expr_stmt|;
name|pm
operator|->
name|env
operator|=
name|addenv
argument_list|(
literal|"PWD"
argument_list|,
name|pwd
argument_list|)
expr_stmt|;
block|}
name|pm
operator|=
name|gethnode
argument_list|(
literal|"LOGNAME"
argument_list|,
name|paramtab
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_x
operator|)
condition|)
block|{
name|pm
operator|->
name|flags
operator||=
name|PMFLAG_x
expr_stmt|;
name|pm
operator|->
name|env
operator|=
name|addenv
argument_list|(
literal|"LOGNAME"
argument_list|,
name|logname
argument_list|)
expr_stmt|;
block|}
name|pm
operator|=
name|gethnode
argument_list|(
literal|"SHLVL"
argument_list|,
name|paramtab
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|pm
operator|->
name|flags
operator|&
name|PMFLAG_x
operator|)
condition|)
name|pm
operator|->
name|flags
operator||=
name|PMFLAG_x
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
operator|++
name|shlvl
argument_list|)
expr_stmt|;
name|pm
operator|->
name|env
operator|=
name|addenv
argument_list|(
literal|"SHLVL"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|noerrs
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|mkenvstr
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
comment|/**/
name|char
modifier|*
name|x
decl_stmt|;
name|char
modifier|*
name|y
decl_stmt|;
block|{
name|char
modifier|*
name|z
decl_stmt|;
name|int
name|xl
init|=
name|strlen
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|yl
init|=
name|strlen
argument_list|(
name|y
argument_list|)
decl_stmt|;
name|z
operator|=
name|zalloc
argument_list|(
name|xl
operator|+
name|yl
operator|+
literal|2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|z
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|z
index|[
name|xl
index|]
operator|=
literal|'='
expr_stmt|;
name|strcpy
argument_list|(
name|z
operator|+
name|xl
operator|+
literal|1
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|z
index|[
name|xl
operator|+
name|yl
operator|+
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|z
return|;
block|}
end_function

begin_function
name|void
name|arrfixenv
parameter_list|(
name|s
parameter_list|,
name|t
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|char
modifier|*
modifier|*
name|t
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|ep
decl_stmt|;
name|int
name|sl
init|=
name|strlen
argument_list|(
name|s
argument_list|)
decl_stmt|;
for|for
control|(
name|ep
operator|=
name|environ
init|;
operator|*
name|ep
condition|;
name|ep
operator|++
control|)
if|if
condition|(
operator|!
name|strncmp
argument_list|(
operator|*
name|ep
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
operator|&&
operator|(
operator|*
name|ep
operator|)
index|[
name|sl
index|]
operator|==
literal|'='
condition|)
block|{
name|char
modifier|*
name|u
init|=
name|colonjoin
argument_list|(
name|t
argument_list|)
decl_stmt|;
name|replenv
argument_list|(
operator|*
name|ep
argument_list|,
name|u
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|replenv
parameter_list|(
name|e
parameter_list|,
name|value
parameter_list|)
comment|/**/
name|char
modifier|*
name|e
decl_stmt|;
name|char
modifier|*
name|value
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|ep
decl_stmt|;
for|for
control|(
name|ep
operator|=
name|environ
init|;
operator|*
name|ep
condition|;
name|ep
operator|++
control|)
if|if
condition|(
operator|*
name|ep
operator|==
name|e
condition|)
block|{
name|char
modifier|*
name|s
init|=
name|e
decl_stmt|;
while|while
condition|(
operator|*
name|s
operator|++
operator|!=
literal|'='
condition|)
empty_stmt|;
operator|*
name|s
operator|=
literal|'\0'
expr_stmt|;
operator|*
name|ep
operator|=
name|zalloc
argument_list|(
name|strlen
argument_list|(
name|e
argument_list|)
operator|+
name|strlen
argument_list|(
name|value
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
operator|*
name|ep
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
operator|*
name|ep
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|e
argument_list|)
expr_stmt|;
return|return
operator|*
name|ep
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|addenv
parameter_list|(
name|name
parameter_list|,
name|value
parameter_list|)
comment|/**/
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|value
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|ep
decl_stmt|,
modifier|*
modifier|*
name|ep2
decl_stmt|,
modifier|*
modifier|*
name|ep3
decl_stmt|;
name|int
name|envct
decl_stmt|;
for|for
control|(
name|ep
operator|=
name|environ
init|;
operator|*
name|ep
condition|;
name|ep
operator|++
control|)
block|{
name|char
modifier|*
name|s
init|=
operator|*
name|ep
decl_stmt|,
modifier|*
name|t
init|=
name|name
decl_stmt|;
while|while
condition|(
operator|*
name|s
operator|&&
operator|*
name|s
operator|==
operator|*
name|t
condition|)
name|s
operator|++
operator|,
name|t
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|'='
operator|&&
operator|!
operator|*
name|t
condition|)
block|{
name|free
argument_list|(
operator|*
name|ep
argument_list|)
expr_stmt|;
return|return
operator|*
name|ep
operator|=
name|mkenvstr
argument_list|(
name|name
argument_list|,
name|value
argument_list|)
return|;
block|}
block|}
name|envct
operator|=
name|arrlen
argument_list|(
name|environ
argument_list|)
expr_stmt|;
name|ep
operator|=
name|ep2
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|zalloc
argument_list|(
operator|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|)
operator|*
operator|(
name|envct
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|ep3
operator|=
name|environ
init|;
operator|*
name|ep2
operator|=
operator|*
name|ep3
condition|;
name|ep3
operator|++
operator|,
name|ep2
operator|++
control|)
empty_stmt|;
operator|*
name|ep2
operator|=
name|mkenvstr
argument_list|(
name|name
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|ep2
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|free
argument_list|(
name|environ
argument_list|)
expr_stmt|;
name|environ
operator|=
name|ep
expr_stmt|;
return|return
operator|*
name|ep2
return|;
block|}
end_function

begin_function
name|void
name|delenv
parameter_list|(
name|x
parameter_list|)
comment|/**/
name|char
modifier|*
name|x
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|ep
decl_stmt|;
name|ep
operator|=
name|environ
expr_stmt|;
for|for
control|(
init|;
operator|*
name|ep
condition|;
name|ep
operator|++
control|)
if|if
condition|(
operator|*
name|ep
operator|==
name|x
condition|)
break|break;
if|if
condition|(
operator|*
name|ep
condition|)
for|for
control|(
init|;
name|ep
index|[
literal|0
index|]
operator|=
name|ep
index|[
literal|1
index|]
condition|;
name|ep
operator|++
control|)
empty_stmt|;
block|}
end_function

begin_function
name|void
name|convbase
parameter_list|(
name|s
parameter_list|,
name|v
parameter_list|,
name|base
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
name|long
name|v
decl_stmt|;
name|int
name|base
decl_stmt|;
block|{
name|int
name|digs
init|=
literal|0
decl_stmt|;
name|long
name|x
decl_stmt|;
if|if
condition|(
name|base
operator|<=
literal|1
condition|)
name|base
operator|=
literal|10
expr_stmt|;
name|x
operator|=
name|v
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
block|{
name|x
operator|=
operator|-
name|x
expr_stmt|;
name|digs
operator|++
expr_stmt|;
block|}
for|for
control|(
init|;
name|x
condition|;
name|digs
operator|++
control|)
name|x
operator|/=
name|base
expr_stmt|;
if|if
condition|(
operator|!
name|digs
condition|)
name|digs
operator|=
literal|1
expr_stmt|;
name|s
index|[
name|digs
operator|--
index|]
operator|=
literal|'\0'
expr_stmt|;
name|x
operator|=
operator|(
name|v
operator|<
literal|0
operator|)
condition|?
operator|-
name|v
else|:
name|v
expr_stmt|;
while|while
condition|(
name|digs
operator|>=
literal|0
condition|)
block|{
name|int
name|dig
init|=
name|x
operator|%
name|base
decl_stmt|;
name|s
index|[
name|digs
operator|--
index|]
operator|=
operator|(
name|dig
operator|<
literal|10
operator|)
condition|?
literal|'0'
operator|+
name|dig
else|:
name|dig
operator|-
literal|10
operator|+
literal|'A'
expr_stmt|;
name|x
operator|/=
name|base
expr_stmt|;
block|}
if|if
condition|(
name|v
operator|<
literal|0
condition|)
name|s
index|[
literal|0
index|]
operator|=
literal|'-'
expr_stmt|;
block|}
end_function

end_unit

