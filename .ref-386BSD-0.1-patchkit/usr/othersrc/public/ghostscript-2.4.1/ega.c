begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (C) 1989, 1992 Aladdin Enterprises.  All rights reserved.    Distributed by Free Software Foundation, Inc.  This file is part of Ghostscript.  Ghostscript is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the Ghostscript General Public License for full details.  Everyone is granted permission to copy, modify and redistribute Ghostscript, but only under the conditions described in the Ghostscript General Public License.  A copy of this license is supposed to have been given to you along with Ghostscript so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_comment
comment|/* ega.c */
end_comment

begin_comment
comment|/* EGA graphics hacks */
end_comment

begin_define
define|#
directive|define
name|interrupt
end_define

begin_comment
comment|/* patch ANSI incompatibility */
end_comment

begin_include
include|#
directive|include
file|<dos.h>
end_include

begin_include
include|#
directive|include
file|"math_.h"
end_include

begin_include
include|#
directive|include
file|"gx.h"
end_include

begin_include
include|#
directive|include
file|"gsmatrix.h"
end_include

begin_comment
comment|/* for gxdevice.h */
end_comment

begin_include
include|#
directive|include
file|"gxdevice.h"
end_include

begin_comment
comment|/* Stuff in egaxxx.c */
end_comment

begin_decl_stmt
specifier|extern
name|struct
name|gx_device_s
name|gs_ega_device
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|yDx
init|=
literal|35.0
operator|/
literal|48.0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* aspect ratio */
end_comment

begin_define
define|#
directive|define
name|black
value|(gx_color_index)0
end_define

begin_define
define|#
directive|define
name|green
value|(gx_color_index)2
end_define

begin_define
define|#
directive|define
name|blue
value|(gx_color_index)9
end_define

begin_define
define|#
directive|define
name|red
value|(gx_color_index)12
end_define

begin_define
define|#
directive|define
name|yellow
value|(gx_color_index)14
end_define

begin_define
define|#
directive|define
name|white
value|(gx_color_index)15
end_define

begin_function
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
return|return
name|real_main
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
return|;
block|}
end_function

begin_macro
name|real_main
argument_list|(
argument|int argc
argument_list|,
argument|char *argv[]
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
comment|/* Display a PPM file */
name|FILE
modifier|*
name|f
init|=
name|fopen
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rb"
argument_list|)
decl_stmt|;
name|char
name|line
index|[
literal|80
index|]
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|raster
decl_stmt|,
name|y
decl_stmt|,
name|yskip
decl_stmt|;
if|if
condition|(
name|f
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"Can't open %s\n"
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
operator|,
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|line
argument_list|,
literal|80
argument_list|,
name|f
argument_list|)
expr_stmt|;
if|if
condition|(
name|line
index|[
literal|0
index|]
operator|!=
literal|'P'
condition|)
name|printf
argument_list|(
literal|"Not a PPM file\n"
argument_list|)
operator|,
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|line
index|[
literal|1
index|]
operator|!=
literal|'4'
condition|)
name|printf
argument_list|(
literal|"Sorry, mono images only\n"
argument_list|)
operator|,
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|line
argument_list|,
literal|80
argument_list|,
name|f
argument_list|)
expr_stmt|;
comment|/* skip comment */
name|fscanf
argument_list|(
name|f
argument_list|,
literal|"%d %d\n"
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|width
operator|>
literal|640
condition|)
name|printf
argument_list|(
literal|"Sorry, max width is 640\n"
argument_list|)
operator|,
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|raster
operator|=
operator|(
name|width
operator|+
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
name|yskip
operator|=
operator|(
name|height
operator|>
literal|350
condition|?
name|height
operator|-
literal|350
else|:
literal|0
operator|)
expr_stmt|;
name|ega_open
argument_list|(
operator|&
name|gs_ega_device
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
block|{
name|fread
argument_list|(
name|line
argument_list|,
literal|1
argument_list|,
name|raster
argument_list|,
name|f
argument_list|)
expr_stmt|;
if|if
condition|(
name|y
operator|>=
name|yskip
condition|)
name|ega_copy_mono
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|line
argument_list|,
literal|0
argument_list|,
name|raster
argument_list|,
literal|0
argument_list|,
name|y
operator|-
name|yskip
argument_list|,
name|width
argument_list|,
literal|1
argument_list|,
name|white
argument_list|,
name|black
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Display all kinds of stuff */
name|ega_open
argument_list|(
operator|&
name|gs_ega_device
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|kbhit
argument_list|()
condition|)
name|paint1
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|kbhit
argument_list|()
condition|)
name|paint2
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|kbhit
argument_list|()
condition|)
name|paint3
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|kbhit
argument_list|()
condition|)
name|paint4
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|kbhit
argument_list|()
condition|)
name|test2
argument_list|()
expr_stmt|;
block|}
while|while
condition|(
operator|!
name|kbhit
argument_list|()
condition|)
empty_stmt|;
name|ega_close
argument_list|(
operator|&
name|gs_ega_device
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Stubs for gx procedures */
end_comment

begin_function
name|int
name|gx_default_draw_line
parameter_list|()
block|{
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|void
name|gx_default_get_initial_matrix
parameter_list|()
block|{ }
end_function

begin_function
name|int
name|gx_default_output_page
parameter_list|()
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|gx_default_sync_output
parameter_list|()
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|gx_default_tile_rectangle
parameter_list|()
block|{
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_comment
comment|/* Display color samples */
end_comment

begin_macro
name|paint1
argument_list|()
end_macro

begin_block
block|{
name|ushort
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|ushort
name|m
init|=
name|gs_ega_device
operator|.
name|color_info
operator|.
name|max_rgb
decl_stmt|;
for|for
control|(
name|r
operator|=
literal|0
init|;
name|r
operator|<=
name|m
condition|;
name|r
operator|++
control|)
for|for
control|(
name|g
operator|=
literal|0
init|;
name|g
operator|<=
name|m
condition|;
name|g
operator|++
control|)
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<=
name|m
condition|;
name|b
operator|++
control|)
block|{
name|int
name|x
init|=
name|r
operator|*
literal|30
decl_stmt|,
name|y
init|=
operator|(
name|g
operator|*
operator|(
name|m
operator|+
literal|1
operator|)
operator|+
name|b
operator|)
operator|*
literal|24
decl_stmt|;
name|gx_color_index
name|color
init|=
name|ega_map_rgb_color
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
decl_stmt|;
specifier|static
name|unsigned
name|char
name|map
index|[
literal|12
index|]
init|=
block|{
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0x55
block|,
literal|0x55
block|,
literal|0x55
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0x55
block|,
literal|0x55
block|,
literal|0x55
block|}
decl_stmt|;
name|ega_fill_rectangle
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
literal|21
argument_list|,
literal|8
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|ega_copy_mono
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|map
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|x
argument_list|,
name|y
operator|+
literal|8
argument_list|,
literal|21
argument_list|,
literal|4
argument_list|,
name|white
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|ega_copy_mono
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|map
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|x
argument_list|,
name|y
operator|+
literal|12
argument_list|,
literal|21
argument_list|,
literal|4
argument_list|,
name|black
argument_list|,
name|color
argument_list|)
expr_stmt|;
block|}
block|{
name|int
name|c
decl_stmt|;
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<=
literal|15
condition|;
name|c
operator|++
control|)
block|{
name|ega_fill_rectangle
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
literal|320
operator|+
name|c
operator|*
literal|20
argument_list|,
literal|0
argument_list|,
literal|14
argument_list|,
literal|11
argument_list|,
operator|(
name|gx_color_index
operator|)
name|c
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_comment
comment|/* Tile with different color combinations */
end_comment

begin_macro
name|paint2
argument_list|()
end_macro

begin_block
block|{
specifier|static
name|byte
name|pattern
index|[]
init|=
block|{
literal|0xaa
block|,
literal|0xcc
block|,
literal|0x55
block|,
literal|0xcc
block|,
literal|0xaa
block|,
literal|0x33
block|,
literal|0x55
block|,
literal|0x33
block|,
literal|0xaa
block|,
literal|0xcc
block|,
literal|0x55
block|,
literal|0xcc
block|,
literal|0xaa
block|,
literal|0x33
block|,
literal|0x55
block|,
literal|0x33
block|,
literal|0xf0
block|,
literal|0xcc
block|,
literal|0xf0
block|,
literal|0x66
block|,
literal|0xf0
block|,
literal|0x33
block|,
literal|0xf0
block|,
literal|0x99
block|,
literal|0x0f
block|,
literal|0xcc
block|,
literal|0x0f
block|,
literal|0x66
block|,
literal|0x0f
block|,
literal|0x33
block|,
literal|0x0f
block|,
literal|0x99
block|}
decl_stmt|;
specifier|static
name|gx_color_index
name|colors
index|[
literal|5
index|]
init|=
block|{
literal|0
block|,
literal|2
block|,
literal|6
block|,
literal|12
block|,
literal|0xf
block|}
decl_stmt|;
name|gx_bitmap
name|tile
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|tile
operator|.
name|data
operator|=
name|pattern
expr_stmt|;
name|tile
operator|.
name|raster
operator|=
literal|2
expr_stmt|;
name|tile
operator|.
name|size
operator|.
name|x
operator|=
literal|16
expr_stmt|;
name|tile
operator|.
name|size
operator|.
name|y
operator|=
literal|16
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|5
condition|;
name|j
operator|++
control|)
name|ega_tile_rectangle
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
operator|&
name|tile
argument_list|,
literal|212
operator|+
name|i
operator|*
literal|44
argument_list|,
literal|20
operator|+
name|j
operator|*
literal|44
argument_list|,
literal|32
argument_list|,
literal|32
argument_list|,
name|colors
index|[
name|i
index|]
argument_list|,
name|colors
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Draw a turkey */
end_comment

begin_macro
name|paint3
argument_list|()
end_macro

begin_block
block|{
specifier|static
name|byte
name|turkey
index|[]
init|=
block|{
literal|0x00
block|,
literal|0x3b
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x27
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x24
block|,
literal|0x80
block|,
literal|0x0e
block|,
literal|0x49
block|,
literal|0x40
block|,
literal|0x11
block|,
literal|0x49
block|,
literal|0x20
block|,
literal|0x14
block|,
literal|0xb2
block|,
literal|0x20
block|,
literal|0x3c
block|,
literal|0xb6
block|,
literal|0x50
block|,
literal|0x75
block|,
literal|0xfe
block|,
literal|0x88
block|,
literal|0x17
block|,
literal|0xff
block|,
literal|0x8c
block|,
literal|0x17
block|,
literal|0x5f
block|,
literal|0x14
block|,
literal|0x1c
block|,
literal|0x07
block|,
literal|0xe2
block|,
literal|0x38
block|,
literal|0x03
block|,
literal|0xc4
block|,
literal|0x70
block|,
literal|0x31
block|,
literal|0x82
block|,
literal|0xf8
block|,
literal|0xed
block|,
literal|0xfc
block|,
literal|0xb2
block|,
literal|0xbb
block|,
literal|0xc2
block|,
literal|0xbb
block|,
literal|0x6f
block|,
literal|0x84
block|,
literal|0x31
block|,
literal|0xbf
block|,
literal|0xc2
block|,
literal|0x18
block|,
literal|0xea
block|,
literal|0x3c
block|,
literal|0x0e
block|,
literal|0x3e
block|,
literal|0x00
block|,
literal|0x07
block|,
literal|0xfc
block|,
literal|0x00
block|,
literal|0x03
block|,
literal|0xf8
block|,
literal|0x00
block|,
literal|0x1e
block|,
literal|0x18
block|,
literal|0x00
block|,
literal|0x1f
block|,
literal|0xf8
block|,
literal|0x00
block|}
decl_stmt|;
name|ega_fill_rectangle
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
literal|0
argument_list|,
literal|250
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|,
name|yellow
argument_list|)
expr_stmt|;
name|ega_copy_mono
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|turkey
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|250
argument_list|,
literal|24
argument_list|,
literal|23
argument_list|,
name|white
argument_list|,
name|red
argument_list|)
expr_stmt|;
name|ega_copy_color
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|turkey
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|280
argument_list|,
literal|6
argument_list|,
literal|23
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Copy patterns to the screen */
end_comment

begin_macro
name|paint4
argument_list|()
end_macro

begin_block
block|{
specifier|static
name|unsigned
name|char
name|box
index|[]
init|=
block|{
literal|0xff
block|,
literal|0xff
block|,
literal|0xc0
block|,
literal|0x0c
block|,
literal|0xc0
block|,
literal|0x0c
block|,
literal|0xc0
block|,
literal|0x0c
block|,
literal|0xff
block|,
literal|0xff
block|}
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|ega_fill_rectangle
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
literal|432
operator|-
literal|4
argument_list|,
literal|20
operator|-
literal|4
argument_list|,
literal|4
operator|+
literal|8
operator|*
literal|17
operator|+
literal|8
argument_list|,
literal|4
operator|+
literal|8
operator|*
literal|17
argument_list|,
name|green
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
name|j
operator|++
control|)
name|ega_copy_mono
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|box
argument_list|,
name|i
argument_list|,
literal|2
argument_list|,
literal|432
operator|+
operator|(
name|j
operator|*
literal|17
operator|)
operator|+
name|i
argument_list|,
literal|20
operator|+
operator|(
name|i
operator|*
literal|17
operator|)
argument_list|,
name|j
operator|+
literal|1
argument_list|,
literal|5
argument_list|,
name|black
argument_list|,
name|red
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Plot a circle 2 different ways */
end_comment

begin_expr_stmt
name|plot_arc
argument_list|(
name|P9
argument_list|(
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|int
argument_list|,
name|gx_color_index
argument_list|,
name|floatp
argument_list|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|test2
argument_list|()
end_macro

begin_block
block|{
name|float
name|kx
init|=
literal|200.0
decl_stmt|;
name|float
name|ky
init|=
operator|-
name|kx
operator|*
name|yDx
decl_stmt|;
name|float
name|ox
init|=
literal|320.0
decl_stmt|,
name|oy
init|=
literal|175.0
decl_stmt|;
name|float
name|x0
init|=
name|ox
operator|-
name|kx
decl_stmt|,
name|y0
init|=
name|oy
operator|-
name|ky
decl_stmt|;
name|float
name|x1
init|=
name|ox
operator|+
name|kx
decl_stmt|,
name|y1
init|=
name|oy
operator|+
name|ky
decl_stmt|;
comment|/* Plot a real circle */
name|float
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|360
condition|;
name|i
operator|+=
literal|5
control|)
block|{
name|float
name|theta
init|=
name|i
operator|*
name|M_PI
operator|/
literal|180.0
decl_stmt|;
name|int
name|x
init|=
name|ox
operator|+
name|kx
operator|*
name|cos
argument_list|(
name|theta
argument_list|)
decl_stmt|;
name|int
name|y
init|=
name|oy
operator|+
name|ky
operator|*
name|sin
argument_list|(
name|theta
argument_list|)
decl_stmt|;
name|ega_write_dot
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|red
argument_list|)
expr_stmt|;
block|}
comment|/* Plot with 90 degree arcs */
block|{
specifier|static
name|float
name|mar
index|[]
init|=
block|{
literal|0.5
block|,
literal|0.45
block|,
literal|0.4
block|}
decl_stmt|;
specifier|static
name|gx_color_index
name|car
index|[]
init|=
block|{
name|white
block|,
name|green
block|,
name|yellow
block|}
decl_stmt|;
name|int
name|j
decl_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
block|{
name|float
name|magic
init|=
name|mar
index|[
name|j
index|]
decl_stmt|;
name|gx_color_index
name|color
init|=
name|car
index|[
name|j
index|]
decl_stmt|;
name|plot_arc
argument_list|(
name|x1
argument_list|,
name|oy
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|ox
argument_list|,
name|y1
argument_list|,
literal|40
argument_list|,
name|color
argument_list|,
name|magic
argument_list|)
expr_stmt|;
name|plot_arc
argument_list|(
name|ox
argument_list|,
name|y1
argument_list|,
name|x0
argument_list|,
name|y1
argument_list|,
name|x0
argument_list|,
name|oy
argument_list|,
literal|40
argument_list|,
name|color
argument_list|,
name|magic
argument_list|)
expr_stmt|;
name|plot_arc
argument_list|(
name|x0
argument_list|,
name|oy
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|ox
argument_list|,
name|y0
argument_list|,
literal|40
argument_list|,
name|color
argument_list|,
name|magic
argument_list|)
expr_stmt|;
name|plot_arc
argument_list|(
name|ox
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|oy
argument_list|,
literal|40
argument_list|,
name|color
argument_list|,
name|magic
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_comment
comment|/* Approximate an arc */
end_comment

begin_expr_stmt
name|plot_curve
argument_list|(
name|P10
argument_list|(
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|int
argument_list|,
name|gx_color_index
argument_list|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|plot_arc
argument_list|(
argument|floatp x0
argument_list|,
argument|floatp y0
argument_list|,
argument|floatp xi
argument_list|,
argument|floatp yi
argument_list|,
argument|floatp x3
argument_list|,
argument|floatp y3
argument_list|,
argument|int nsteps
argument_list|,
argument|gx_color_index color
argument_list|,
argument|floatp magic
argument_list|)
end_macro

begin_block
block|{
name|float
name|cmagic
init|=
literal|1
operator|-
name|magic
decl_stmt|;
name|float
name|xic
init|=
name|xi
operator|*
name|cmagic
decl_stmt|,
name|yic
init|=
name|yi
operator|*
name|cmagic
decl_stmt|;
name|plot_curve
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|,
name|x0
operator|*
name|magic
operator|+
name|xic
argument_list|,
name|y0
operator|*
name|magic
operator|+
name|yic
argument_list|,
name|x3
operator|*
name|magic
operator|+
name|xic
argument_list|,
name|y3
operator|*
name|magic
operator|+
name|yic
argument_list|,
name|x3
argument_list|,
name|y3
argument_list|,
name|nsteps
argument_list|,
name|color
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Plot a Bezier curve */
end_comment

begin_macro
name|plot_curve
argument_list|(
argument|floatp x0
argument_list|,
argument|floatp y0
argument_list|,
argument|floatp x1
argument_list|,
argument|floatp y1
argument_list|,
argument|floatp x2
argument_list|,
argument|floatp y2
argument_list|,
argument|floatp x3
argument_list|,
argument|floatp y3
argument_list|,
argument|int nsteps
argument_list|,
argument|gx_color_index color
argument_list|)
end_macro

begin_block
block|{
name|float
name|dt
init|=
literal|1.0
operator|/
name|nsteps
decl_stmt|;
name|float
name|cx
init|=
literal|3.0
operator|*
operator|(
name|x1
operator|-
name|x0
operator|)
decl_stmt|;
name|float
name|bx
init|=
literal|3.0
operator|*
operator|(
name|x2
operator|-
name|x1
operator|)
operator|-
name|cx
decl_stmt|;
name|float
name|ax
init|=
name|x3
operator|-
operator|(
name|x0
operator|+
name|cx
operator|+
name|bx
operator|)
decl_stmt|;
name|float
name|cy
init|=
literal|3.0
operator|*
operator|(
name|y1
operator|-
name|y0
operator|)
decl_stmt|;
name|float
name|by
init|=
literal|3.0
operator|*
operator|(
name|y2
operator|-
name|y1
operator|)
operator|-
name|cy
decl_stmt|;
name|float
name|ay
init|=
name|y3
operator|-
operator|(
name|y0
operator|+
name|cy
operator|+
name|by
operator|)
decl_stmt|;
name|float
name|t
init|=
literal|0.0
decl_stmt|;
while|while
condition|(
name|t
operator|<=
literal|1.0
condition|)
block|{
name|int
name|x
init|=
operator|(
operator|(
name|ax
operator|*
name|t
operator|+
name|bx
operator|)
operator|*
name|t
operator|+
name|cx
operator|)
operator|*
name|t
operator|+
name|x0
decl_stmt|;
name|int
name|y
init|=
operator|(
operator|(
name|ay
operator|*
name|t
operator|+
name|by
operator|)
operator|*
name|t
operator|+
name|cy
operator|)
operator|*
name|t
operator|+
name|y0
decl_stmt|;
name|ega_write_dot
argument_list|(
operator|&
name|gs_ega_device
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|t
operator|+=
name|dt
expr_stmt|;
block|}
block|}
end_block

end_unit

