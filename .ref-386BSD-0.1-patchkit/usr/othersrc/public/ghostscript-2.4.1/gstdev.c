begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (C) 1989, 1992 Aladdin Enterprises.  All rights reserved.    Distributed by Free Software Foundation, Inc.  This file is part of Ghostscript.  Ghostscript is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the Ghostscript General Public License for full details.  Everyone is granted permission to copy, modify and redistribute Ghostscript, but only under the conditions described in the Ghostscript General Public License.  A copy of this license is supposed to have been given to you along with Ghostscript so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_comment
comment|/* gstdev.c */
end_comment

begin_comment
comment|/* Device tracing for Ghostscript library */
end_comment

begin_include
include|#
directive|include
file|"gx.h"
end_include

begin_include
include|#
directive|include
file|"gxfixed.h"
end_include

begin_comment
comment|/* for gxmatrix.h */
end_comment

begin_include
include|#
directive|include
file|"gxmatrix.h"
end_include

begin_comment
comment|/* for gxdevice.h */
end_comment

begin_include
include|#
directive|include
file|"gxdevice.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_comment
comment|/* ------ Tracing 'device' ------*/
end_comment

begin_comment
comment|/* To avoid unpleasant interactions with copydevice, */
end_comment

begin_comment
comment|/* the tracing 'device' uses an external linked list to keep track of */
end_comment

begin_comment
comment|/* the real procedures that were replaced in the procedure vector. */
end_comment

begin_typedef
typedef|typedef
name|struct
name|trace_record_s
name|trace_record
typedef|;
end_typedef

begin_struct
struct|struct
name|trace_record_s
block|{
name|trace_record
modifier|*
name|next
decl_stmt|;
name|gx_device_procs
modifier|*
name|tprocs
decl_stmt|;
name|gx_device_procs
name|procs
decl_stmt|;
name|int
name|index
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|private
name|gx_device
modifier|*
name|trace_cache_device
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|gx_device_procs
modifier|*
name|trace_cache_procs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|trace_record
modifier|*
name|trace_list
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|trace_next_index
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|rprocs
define|\
value|(dev == trace_cache_device ? trace_cache_procs :\ 	 trace_find_procs(dev))
end_define

begin_comment
comment|/* Procedure structure */
end_comment

begin_function_decl
name|private
name|dev_proc_open_device
parameter_list|(
name|trace_open_device
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_get_initial_matrix
parameter_list|(
name|trace_get_initial_matrix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_sync_output
parameter_list|(
name|trace_sync_output
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_output_page
parameter_list|(
name|trace_output_page
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_close_device
parameter_list|(
name|trace_close_device
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_map_rgb_color
parameter_list|(
name|trace_map_rgb_color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_map_color_rgb
parameter_list|(
name|trace_map_color_rgb
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_fill_rectangle
parameter_list|(
name|trace_fill_rectangle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_tile_rectangle
parameter_list|(
name|trace_tile_rectangle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_copy_mono
parameter_list|(
name|trace_copy_mono
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_copy_color
parameter_list|(
name|trace_copy_color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_draw_line
parameter_list|(
name|trace_draw_line
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_get_bits
parameter_list|(
name|trace_get_bits
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_get_props
parameter_list|(
name|trace_get_props
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|private
name|dev_proc_put_props
parameter_list|(
name|trace_put_props
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|private
name|gx_device_procs
name|trace_procs
init|=
block|{
name|trace_open_device
block|,
name|trace_get_initial_matrix
block|,
name|trace_sync_output
block|,
name|trace_output_page
block|,
name|trace_close_device
block|,
name|trace_map_rgb_color
block|,
name|trace_map_color_rgb
block|,
name|trace_fill_rectangle
block|,
name|trace_tile_rectangle
block|,
name|trace_copy_mono
block|,
name|trace_copy_color
block|,
name|trace_draw_line
block|,
name|trace_get_bits
block|,
name|trace_get_props
block|,
name|trace_put_props
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Find the real procedures for a traced device */
end_comment

begin_function
name|private
name|gx_device_procs
modifier|*
name|trace_find_procs
parameter_list|(
name|gx_device
modifier|*
name|tdev
parameter_list|)
block|{
name|gx_device_procs
modifier|*
name|tprocs
init|=
name|tdev
operator|->
name|procs
decl_stmt|;
specifier|register
name|trace_record
modifier|*
name|tp
init|=
name|trace_list
decl_stmt|;
while|while
condition|(
name|tp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|tp
operator|->
name|tprocs
operator|==
name|tprocs
condition|)
block|{
name|trace_cache_device
operator|=
name|tdev
expr_stmt|;
return|return
operator|(
name|trace_cache_procs
operator|=
operator|&
name|tp
operator|->
name|procs
operator|)
return|;
block|}
name|tp
operator|=
name|tp
operator|->
name|next
expr_stmt|;
block|}
name|lprintf
argument_list|(
literal|"Traced procedures not found!\n"
argument_list|)
expr_stmt|;
name|gs_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Trace a device. */
end_comment

begin_function
name|gx_device
modifier|*
name|gs_trace_device
parameter_list|(
name|gx_device
modifier|*
name|rdev
parameter_list|)
block|{
name|trace_record
modifier|*
name|tp
decl_stmt|;
if|if
condition|(
name|rdev
operator|->
name|procs
operator|->
name|open_device
operator|==
name|trace_procs
operator|.
name|open_device
condition|)
return|return
name|rdev
return|;
comment|/* already traced */
name|tp
operator|=
operator|(
name|trace_record
operator|*
operator|)
name|gs_malloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|trace_record
argument_list|)
argument_list|,
literal|"gs_trace_device"
argument_list|)
expr_stmt|;
if|if
condition|(
name|tp
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|tp
operator|->
name|next
operator|=
name|trace_list
expr_stmt|;
name|tp
operator|->
name|tprocs
operator|=
name|rdev
operator|->
name|procs
expr_stmt|;
name|tp
operator|->
name|procs
operator|=
operator|*
name|rdev
operator|->
name|procs
expr_stmt|;
name|tp
operator|->
name|index
operator|=
operator|++
name|trace_next_index
expr_stmt|;
name|trace_list
operator|=
name|tp
expr_stmt|;
operator|*
name|rdev
operator|->
name|procs
operator|=
name|trace_procs
expr_stmt|;
return|return
name|rdev
return|;
block|}
end_function

begin_comment
comment|/* Utilities */
end_comment

begin_function
name|private
name|int
name|trace_print_code
parameter_list|(
name|int
name|result
parameter_list|)
block|{
if|if
condition|(
name|result
operator|==
literal|0
condition|)
name|dprintf
argument_list|(
literal|";\n"
argument_list|)
expr_stmt|;
else|else
name|dprintf1
argument_list|(
literal|";\t/* = %d */\n"
argument_list|,
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|void
name|trace_print_tile
parameter_list|(
name|gx_bitmap
modifier|*
name|tile
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|dprintf1
argument_list|(
literal|"\t{ static byte data = { 0x%x"
argument_list|,
name|tile
operator|->
name|data
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|tile
operator|->
name|raster
operator|*
name|tile
operator|->
name|size
operator|.
name|y
condition|;
name|i
operator|++
control|)
name|dprintf1
argument_list|(
literal|", 0x%x"
argument_list|,
name|tile
operator|->
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|dprintf4
argument_list|(
literal|" };\n\t  static gx_bitmap tile = {&data, %d, %d, %d, 0x%lx };\n"
argument_list|,
name|tile
operator|->
name|raster
argument_list|,
name|tile
operator|->
name|size
operator|.
name|x
argument_list|,
name|tile
operator|->
name|size
operator|.
name|y
argument_list|,
name|tile
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Procedures */
end_comment

begin_function
name|private
name|int
name|trace_open_device
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|open_device
call|)
argument_list|(
name|dev
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf2
argument_list|(
literal|"[V]\topen_device(0x%lx /*%s*/)"
argument_list|,
operator|(
name|ulong
operator|)
name|dev
argument_list|,
name|dev
operator|->
name|dname
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|void
name|trace_get_initial_matrix
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|gs_matrix
modifier|*
name|pmat
parameter_list|)
block|{
call|(
modifier|*
name|rprocs
operator|->
name|get_initial_matrix
call|)
argument_list|(
name|dev
argument_list|,
name|pmat
argument_list|)
expr_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf6
argument_list|(
literal|"[V]\tget_initial_matrix(dev) = (%6g, %6g, %6g, %6g, %6g, %6g);\n"
argument_list|,
name|pmat
operator|->
name|xx
argument_list|,
name|pmat
operator|->
name|xy
argument_list|,
name|pmat
operator|->
name|yx
argument_list|,
name|pmat
operator|->
name|yy
argument_list|,
name|pmat
operator|->
name|tx
argument_list|,
name|pmat
operator|->
name|ty
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|int
name|trace_sync_output
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|sync_output
call|)
argument_list|(
name|dev
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf
argument_list|(
literal|"[V]\tsync_output(dev)"
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_output_page
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|int
name|num_copies
parameter_list|,
name|int
name|flush
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|output_page
call|)
argument_list|(
name|dev
argument_list|,
name|num_copies
argument_list|,
name|flush
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf2
argument_list|(
literal|"[V]\toutput_page(dev, %d, %d)"
argument_list|,
name|num_copies
argument_list|,
name|flush
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_close_device
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|close_device
call|)
argument_list|(
name|dev
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf2
argument_list|(
literal|"[V]\tclose_device(0x%lx /*%s*/)"
argument_list|,
operator|(
name|ulong
operator|)
name|dev
argument_list|,
name|dev
operator|->
name|dname
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|gx_color_index
name|trace_map_rgb_color
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|gx_color_value
name|r
parameter_list|,
name|gx_color_value
name|g
parameter_list|,
name|gx_color_value
name|b
parameter_list|)
block|{
name|gx_color_index
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|map_rgb_color
call|)
argument_list|(
name|dev
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf4
argument_list|(
literal|"[V]\tmap_rgb_color(dev, %u, %u, %u) /*= %ld */;\n"
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
operator|(
name|long
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_map_color_rgb
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|gx_color_index
name|color
parameter_list|,
name|gx_color_value
name|prgb
index|[
literal|3
index|]
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|map_color_rgb
call|)
argument_list|(
name|dev
argument_list|,
name|color
argument_list|,
name|prgb
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf4
argument_list|(
literal|"[V]\t{ gx_color_value rgb[3]; map_color_rgb(dev, %ld, rgb /* %u, %u, %u */); }"
argument_list|,
operator|(
name|long
operator|)
name|color
argument_list|,
name|prgb
index|[
literal|0
index|]
argument_list|,
name|prgb
index|[
literal|1
index|]
argument_list|,
name|prgb
index|[
literal|2
index|]
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_fill_rectangle
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|,
name|gx_color_index
name|color
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|fill_rectangle
call|)
argument_list|(
name|dev
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
name|color
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf5
argument_list|(
literal|"[V]\tfill_rectangle(dev, %d, %d, %d, %d, %ld)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
operator|(
name|long
operator|)
name|color
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_tile_rectangle
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|gx_bitmap
modifier|*
name|tile
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|,
name|gx_color_index
name|zero
parameter_list|,
name|gx_color_index
name|one
parameter_list|,
name|int
name|px
parameter_list|,
name|int
name|py
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|tile_rectangle
call|)
argument_list|(
name|dev
argument_list|,
name|tile
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
name|zero
argument_list|,
name|one
argument_list|,
name|px
argument_list|,
name|py
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
block|{
name|trace_print_tile
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|dprintf8
argument_list|(
literal|"[V]\t  tile_rectangle(dev,&tile, %d, %d, %d, %d, %ld, %ld, %d, %d);\n\t}"
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
operator|(
name|long
operator|)
name|zero
argument_list|,
operator|(
name|long
operator|)
name|one
argument_list|,
name|px
argument_list|,
name|py
argument_list|)
expr_stmt|;
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_copy_mono
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|byte
modifier|*
name|data
parameter_list|,
name|int
name|dx
parameter_list|,
name|int
name|raster
parameter_list|,
name|gx_bitmap_id
name|id
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|,
name|gx_color_index
name|zero
parameter_list|,
name|gx_color_index
name|one
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|copy_mono
call|)
argument_list|(
name|dev
argument_list|,
name|data
argument_list|,
name|dx
argument_list|,
name|raster
argument_list|,
name|id
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
name|zero
argument_list|,
name|one
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf9
argument_list|(
literal|"[V]\tcopy_mono(dev, data, %d, %d, 0x%lx, %d, %d, %d, %d, %ld, %ld)"
argument_list|,
name|dx
argument_list|,
name|raster
argument_list|,
name|id
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
operator|(
name|long
operator|)
name|zero
argument_list|,
operator|(
name|long
operator|)
name|one
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_copy_color
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|byte
modifier|*
name|data
parameter_list|,
name|int
name|dx
parameter_list|,
name|int
name|raster
parameter_list|,
name|gx_bitmap_id
name|id
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|copy_color
call|)
argument_list|(
name|dev
argument_list|,
name|data
argument_list|,
name|dx
argument_list|,
name|raster
argument_list|,
name|id
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf7
argument_list|(
literal|"[V]\tcopy_color(dev, data, %d, %d, 0x%lx, %d, %d, %d, %d)"
argument_list|,
name|dx
argument_list|,
name|raster
argument_list|,
name|id
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_draw_line
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|int
name|x0
parameter_list|,
name|int
name|y0
parameter_list|,
name|int
name|x1
parameter_list|,
name|int
name|y1
parameter_list|,
name|gx_color_index
name|color
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|draw_line
call|)
argument_list|(
name|dev
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|color
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf5
argument_list|(
literal|"[V]\tdraw_line(dev, %d, %d, %d, %d, %ld)"
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|long
operator|)
name|color
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_get_bits
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|int
name|y
parameter_list|,
name|byte
modifier|*
name|data
parameter_list|,
name|uint
name|size
parameter_list|,
name|int
name|pad
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|get_bits
call|)
argument_list|(
name|dev
argument_list|,
name|y
argument_list|,
name|data
argument_list|,
name|size
argument_list|,
name|pad
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf3
argument_list|(
literal|"[V]\tget_bits(dev, %d, data, %d, %d)"
argument_list|,
name|y
argument_list|,
name|size
argument_list|,
name|pad
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_get_props
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|gs_prop_item
modifier|*
name|plist
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|get_props
call|)
argument_list|(
name|dev
argument_list|,
name|plist
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf
argument_list|(
literal|"[V]\tget_props(dev, plist)\n"
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|private
name|int
name|trace_put_props
parameter_list|(
name|gx_device
modifier|*
name|dev
parameter_list|,
name|gs_prop_item
modifier|*
name|plist
parameter_list|,
name|int
name|count
parameter_list|)
block|{
name|int
name|result
init|=
call|(
modifier|*
name|rprocs
operator|->
name|put_props
call|)
argument_list|(
name|dev
argument_list|,
name|plist
argument_list|,
name|count
argument_list|)
decl_stmt|;
if|if
condition|(
name|gs_debug
index|[
literal|'V'
index|]
condition|)
name|dprintf1
argument_list|(
literal|"[V]\tput_props(dev, plist, %d)"
argument_list|,
name|count
argument_list|)
operator|,
name|trace_print_code
argument_list|(
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

