begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (C) 1991, 1992 Aladdin Enterprises.  All rights reserved.    Distributed by Free Software Foundation, Inc.  This file is part of Ghostscript.  Ghostscript is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the Ghostscript General Public License for full details.  Everyone is granted permission to copy, modify and redistribute Ghostscript, but only under the conditions described in the Ghostscript General Public License.  A copy of this license is supposed to have been given to you along with Ghostscript so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_comment
comment|/* zfont1.c */
end_comment

begin_comment
comment|/* Type 1 font creation operator for Ghostscript */
end_comment

begin_include
include|#
directive|include
file|"ghost.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"oper.h"
end_include

begin_include
include|#
directive|include
file|"gxfixed.h"
end_include

begin_include
include|#
directive|include
file|"gsmatrix.h"
end_include

begin_include
include|#
directive|include
file|"gxdevice.h"
end_include

begin_include
include|#
directive|include
file|"gschar.h"
end_include

begin_include
include|#
directive|include
file|"gxfont.h"
end_include

begin_include
include|#
directive|include
file|"dict.h"
end_include

begin_include
include|#
directive|include
file|"font.h"
end_include

begin_include
include|#
directive|include
file|"name.h"
end_include

begin_include
include|#
directive|include
file|"store.h"
end_include

begin_comment
comment|/* Imported procedures from zfont2.c */
end_comment

begin_decl_stmt
specifier|extern
name|int
name|build_gs_simple_font
argument_list|(
name|P4
argument_list|(
name|os_ptr
argument_list|,
name|gs_font
operator|*
operator|*
argument_list|,
name|font_type
argument_list|,
name|ref
operator|*
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|font_int_param
argument_list|(
name|P6
argument_list|(
argument|ref *pdict
argument_list|,
argument|ref *pname
argument_list|,
argument|int minval
argument_list|,
argument|int maxval
argument_list|,
argument|int defaultval
argument_list|,
argument|int *pvalue
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Forward references */
end_comment

begin_decl_stmt
name|private
name|int
name|near
name|font_bool_param
argument_list|(
name|P4
argument_list|(
argument|ref *pdict
argument_list|,
argument|ref *pname
argument_list|,
argument|int defaultval
argument_list|,
argument|int *pvalue
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|near
name|font_float_param
argument_list|(
name|P4
argument_list|(
argument|ref *pdict
argument_list|,
argument|ref *pname
argument_list|,
argument|floatp defaultval
argument_list|,
argument|float *pvalue
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|near
name|font_int_array
argument_list|(
name|P4
argument_list|(
argument|ref *pdict
argument_list|,
argument|ref *pname
argument_list|,
argument|uint maxlen
argument_list|,
argument|int *ivec
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|near
name|font_float_array
argument_list|(
name|P4
argument_list|(
argument|ref *pdict
argument_list|,
argument|ref *pname
argument_list|,
argument|uint maxlen
argument_list|,
argument|float *fvec
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Type 1 auxiliary procedures (defined in zchar.c) */
end_comment

begin_decl_stmt
specifier|extern
name|int
name|z1_subr_proc
argument_list|(
name|P3
argument_list|(
name|gs_type1_data
operator|*
argument_list|,
name|int
argument_list|,
name|byte
operator|*
operator|*
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|z1_pop_proc
argument_list|(
name|P2
argument_list|(
name|gs_type1_data
operator|*
argument_list|,
name|fixed
operator|*
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Names of system-known keys in font dictionaries: */
end_comment

begin_decl_stmt
name|private
name|ref
name|name_PaintType
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|ref
name|name_UniqueID
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* in zfont2 */
end_comment

begin_decl_stmt
name|private
name|ref
name|name_Type1BuildChar
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_Private
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_CharStrings
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* only needed for seac */
end_comment

begin_comment
comment|/* Names of system-known keys in type 1 font Private dictionary: */
end_comment

begin_decl_stmt
name|private
name|ref
name|name_BlueFuzz
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_BlueScale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_BlueShift
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_BlueValues
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_ExpansionFactor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_FamilyBlues
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_FamilyOtherBlues
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_ForceBold
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_LanguageGroup
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_lenIV
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_OtherBlues
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_RndStemUp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_StdHW
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_StdVW
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_StemSnapH
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_StemSnapV
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|ref
name|name_Subrs
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Default value of lenIV */
end_comment

begin_define
define|#
directive|define
name|default_lenIV
value|4
end_define

begin_comment
comment|/* Initialize the font building operators */
end_comment

begin_function
name|private
name|void
name|zfont1_init
parameter_list|()
block|{
specifier|static
name|names_def
name|fnd1
index|[]
init|=
block|{
comment|/* Create the names of the standard elements of */
comment|/* a font dictionary. */
block|{
literal|"PaintType"
block|,
operator|&
name|name_PaintType
block|}
block|,
block|{
literal|"Type1BuildChar"
block|,
operator|&
name|name_Type1BuildChar
block|}
block|,
block|{
literal|"Private"
block|,
operator|&
name|name_Private
block|}
block|,
block|{
literal|"CharStrings"
block|,
operator|&
name|name_CharStrings
block|}
block|,
comment|/* Create the names of the known entries in */
comment|/* a type 1 font Private dictionary. */
block|{
literal|"BlueFuzz"
block|,
operator|&
name|name_BlueFuzz
block|}
block|,
block|{
literal|"BlueScale"
block|,
operator|&
name|name_BlueScale
block|}
block|,
block|{
literal|"BlueShift"
block|,
operator|&
name|name_BlueShift
block|}
block|,
block|{
literal|"BlueValues"
block|,
operator|&
name|name_BlueValues
block|}
block|,
block|{
literal|"ExpansionFactor"
block|,
operator|&
name|name_ExpansionFactor
block|}
block|,
block|{
literal|"FamilyBlues"
block|,
operator|&
name|name_FamilyBlues
block|}
block|,
block|{
literal|"FamilyOtherBlues"
block|,
operator|&
name|name_FamilyOtherBlues
block|}
block|,
block|{
literal|"ForceBold"
block|,
operator|&
name|name_ForceBold
block|}
block|,
block|{
literal|"LanguageGroup"
block|,
operator|&
name|name_LanguageGroup
block|}
block|,
block|{
literal|"lenIV"
block|,
operator|&
name|name_lenIV
block|}
block|,
block|{
literal|"OtherBlues"
block|,
operator|&
name|name_OtherBlues
block|}
block|,
block|{
literal|"RndStemUp"
block|,
operator|&
name|name_RndStemUp
block|}
block|,
block|{
literal|"StdHW"
block|,
operator|&
name|name_StdHW
block|}
block|,
block|{
literal|"StdVW"
block|,
operator|&
name|name_StdVW
block|}
block|,
block|{
literal|"StemSnapH"
block|,
operator|&
name|name_StemSnapH
block|}
block|,
block|{
literal|"StemSnapV"
block|,
operator|&
name|name_StemSnapV
block|}
block|,
block|{
literal|"Subrs"
block|,
operator|&
name|name_Subrs
block|}
block|,
comment|/* Mark the end of the initalized name list. */
name|names_def_end
block|}
decl_stmt|;
name|init_names
argument_list|(
name|fnd1
argument_list|)
expr_stmt|;
comment|/* Make the standard BuildChar procedures executable. */
name|r_set_attrs
argument_list|(
operator|&
name|name_Type1BuildChar
argument_list|,
name|a_executable
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* .buildfont1 */
end_comment

begin_comment
comment|/* Build a type 1 (Adobe encrypted) font. */
end_comment

begin_function
name|int
name|zbuildfont1
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
name|gs_type1_data
name|data1
decl_stmt|;
name|ref
modifier|*
name|psubrs
decl_stmt|;
name|ref
modifier|*
name|pcharstrings
decl_stmt|;
name|ref
modifier|*
name|pprivate
decl_stmt|;
name|ref
modifier|*
name|puniqueid
decl_stmt|;
specifier|static
name|ref
name|no_subrs
decl_stmt|;
name|gs_font
modifier|*
name|pfont
decl_stmt|;
name|font_data
modifier|*
name|pdata
decl_stmt|;
name|int
name|code
decl_stmt|;
name|check_type
argument_list|(
operator|*
name|op
argument_list|,
name|t_dictionary
argument_list|)
expr_stmt|;
name|code
operator|=
name|font_int_param
argument_list|(
name|op
argument_list|,
operator|&
name|name_PaintType
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
operator|&
name|data1
operator|.
name|PaintType
argument_list|)
expr_stmt|;
if|if
condition|(
name|code
operator|<
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|dict_find
argument_list|(
name|op
argument_list|,
operator|&
name|name_CharStrings
argument_list|,
operator|&
name|pcharstrings
argument_list|)
operator|<=
literal|0
operator|||
operator|!
name|r_has_type
argument_list|(
name|pcharstrings
argument_list|,
name|t_dictionary
argument_list|)
operator|||
name|dict_find
argument_list|(
name|op
argument_list|,
operator|&
name|name_Private
argument_list|,
operator|&
name|pprivate
argument_list|)
operator|<=
literal|0
operator|||
operator|!
name|r_has_type
argument_list|(
name|pprivate
argument_list|,
name|t_dictionary
argument_list|)
condition|)
return|return
name|e_invalidfont
return|;
if|if
condition|(
name|dict_find
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_Subrs
argument_list|,
operator|&
name|psubrs
argument_list|)
operator|>
literal|0
condition|)
block|{
name|check_array_else
argument_list|(
operator|*
name|psubrs
argument_list|,
name|e_invalidfont
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|make_tasv
argument_list|(
operator|&
name|no_subrs
argument_list|,
name|t_string
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|bytes
argument_list|,
operator|(
name|byte
operator|*
operator|)
literal|0
argument_list|)
operator|,
name|psubrs
operator|=
operator|&
name|no_subrs
expr_stmt|;
block|}
comment|/* Get the rest of the information from the Private dictionary. */
if|if
condition|(
operator|(
name|code
operator|=
name|font_int_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_lenIV
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
name|default_lenIV
argument_list|,
operator|&
name|data1
operator|.
name|lenIV
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_int_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_BlueFuzz
argument_list|,
literal|0
argument_list|,
literal|1999
argument_list|,
literal|1
argument_list|,
operator|&
name|data1
operator|.
name|BlueFuzz
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_float_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_BlueScale
argument_list|,
literal|0.04379
argument_list|,
operator|&
name|data1
operator|.
name|BlueScale
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_int_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_BlueShift
argument_list|,
literal|0
argument_list|,
literal|1999
argument_list|,
literal|7
argument_list|,
operator|&
name|data1
operator|.
name|BlueShift
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|BlueValues
operator|.
name|count
operator|=
name|font_int_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_BlueValues
argument_list|,
name|max_BlueValues
operator|*
literal|2
argument_list|,
operator|&
name|data1
operator|.
name|BlueValues
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_float_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_ExpansionFactor
argument_list|,
literal|0.06
argument_list|,
operator|&
name|data1
operator|.
name|ExpansionFactor
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|FamilyBlues
operator|.
name|count
operator|=
name|font_int_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_FamilyBlues
argument_list|,
name|max_FamilyBlues
operator|*
literal|2
argument_list|,
operator|&
name|data1
operator|.
name|FamilyBlues
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|FamilyOtherBlues
operator|.
name|count
operator|=
name|font_int_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_FamilyOtherBlues
argument_list|,
name|max_FamilyOtherBlues
operator|*
literal|2
argument_list|,
operator|&
name|data1
operator|.
name|FamilyOtherBlues
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_bool_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_ForceBold
argument_list|,
literal|0
argument_list|,
operator|&
name|data1
operator|.
name|ForceBold
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_int_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_LanguageGroup
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
operator|&
name|data1
operator|.
name|LanguageGroup
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|OtherBlues
operator|.
name|count
operator|=
name|font_int_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_OtherBlues
argument_list|,
name|max_OtherBlues
operator|*
literal|2
argument_list|,
operator|&
name|data1
operator|.
name|OtherBlues
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|font_bool_param
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_RndStemUp
argument_list|,
literal|0
argument_list|,
operator|&
name|data1
operator|.
name|RndStemUp
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|StdHW
operator|.
name|count
operator|=
name|font_float_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_StdHW
argument_list|,
literal|1
argument_list|,
operator|&
name|data1
operator|.
name|StdHW
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|StdVW
operator|.
name|count
operator|=
name|font_float_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_StdVW
argument_list|,
literal|1
argument_list|,
operator|&
name|data1
operator|.
name|StdVW
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|StemSnapH
operator|.
name|count
operator|=
name|font_float_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_StemSnapH
argument_list|,
name|max_StemSnap
argument_list|,
operator|&
name|data1
operator|.
name|StemSnapH
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
name|data1
operator|.
name|StemSnapV
operator|.
name|count
operator|=
name|font_float_array
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_StemSnapV
argument_list|,
name|max_StemSnap
argument_list|,
operator|&
name|data1
operator|.
name|StemSnapV
operator|.
name|data
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<
literal|0
condition|)
return|return
name|code
return|;
comment|/* Do the work common to all non-composite font types. */
name|code
operator|=
name|build_gs_simple_font
argument_list|(
name|op
argument_list|,
operator|&
name|pfont
argument_list|,
name|ft_encrypted
argument_list|,
operator|&
name|name_Type1BuildChar
argument_list|)
expr_stmt|;
if|if
condition|(
name|code
operator|!=
literal|0
condition|)
return|return
name|code
return|;
comment|/* This is a new font, fill it in. */
name|pdata
operator|=
operator|(
name|font_data
operator|*
operator|)
name|pfont
operator|->
name|client_data
expr_stmt|;
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|type1_data
operator|=
name|data1
expr_stmt|;
name|ref_assign
argument_list|(
operator|&
name|pdata
operator|->
name|CharStrings
argument_list|,
name|pcharstrings
argument_list|)
expr_stmt|;
name|ref_assign
argument_list|(
operator|&
name|pdata
operator|->
name|Subrs
argument_list|,
name|psubrs
argument_list|)
expr_stmt|;
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|type1_data
operator|.
name|subr_proc
operator|=
name|z1_subr_proc
expr_stmt|;
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|type1_data
operator|.
name|pop_proc
operator|=
name|z1_pop_proc
expr_stmt|;
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|type1_data
operator|.
name|proc_data
operator|=
operator|(
name|char
operator|*
operator|)
name|pdata
expr_stmt|;
comment|/* Check that the UniqueIDs match.  This is part of the */
comment|/* Adobe protection scheme, but we may as well emulate it. */
if|if
condition|(
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|UniqueID
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|dict_find
argument_list|(
name|pprivate
argument_list|,
operator|&
name|name_UniqueID
argument_list|,
operator|&
name|puniqueid
argument_list|)
operator|<=
literal|0
operator|||
operator|!
name|r_has_type
argument_list|(
name|puniqueid
argument_list|,
name|t_integer
argument_list|)
operator|||
name|puniqueid
operator|->
name|value
operator|.
name|intval
operator|!=
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|UniqueID
condition|)
name|pfont
operator|->
name|data
operator|.
name|base
operator|.
name|UniqueID
operator|=
operator|-
literal|1
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* ------ Initialization procedure ------ */
end_comment

begin_decl_stmt
name|op_def
name|zfont1_op_defs
index|[]
init|=
block|{
block|{
literal|"1.buildfont1"
block|,
name|zbuildfont1
block|}
block|,
name|op_def_end
argument_list|(
argument|zfont1_init
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ------ Subroutines ------ */
end_comment

begin_comment
comment|/* Get a Boolean parameter from a font-related dictionary. */
end_comment

begin_comment
comment|/* Return 0 if found, 1 if defaulted,<0 if wrong type. */
end_comment

begin_function
name|private
name|int
name|near
name|font_bool_param
parameter_list|(
name|ref
modifier|*
name|pdict
parameter_list|,
name|ref
modifier|*
name|pname
parameter_list|,
name|int
name|defaultval
parameter_list|,
name|int
modifier|*
name|pvalue
parameter_list|)
block|{
name|ref
modifier|*
name|pdval
decl_stmt|;
if|if
condition|(
name|dict_find
argument_list|(
name|pdict
argument_list|,
name|pname
argument_list|,
operator|&
name|pdval
argument_list|)
operator|<=
literal|0
condition|)
block|{
operator|*
name|pvalue
operator|=
name|defaultval
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|r_has_type
argument_list|(
name|pdval
argument_list|,
name|t_boolean
argument_list|)
condition|)
return|return
name|e_typecheck
return|;
operator|*
name|pvalue
operator|=
name|pdval
operator|->
name|value
operator|.
name|index
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Get a float parameter from a font-related dictionary. */
end_comment

begin_comment
comment|/* Return 0 if found, 1 if defaulted,<0 if wrong type. */
end_comment

begin_function
name|private
name|int
name|near
name|font_float_param
parameter_list|(
name|ref
modifier|*
name|pdict
parameter_list|,
name|ref
modifier|*
name|pname
parameter_list|,
name|floatp
name|defaultval
parameter_list|,
name|float
modifier|*
name|pvalue
parameter_list|)
block|{
name|ref
modifier|*
name|pdval
decl_stmt|;
if|if
condition|(
name|dict_find
argument_list|(
name|pdict
argument_list|,
name|pname
argument_list|,
operator|&
name|pdval
argument_list|)
operator|<=
literal|0
condition|)
block|{
operator|*
name|pvalue
operator|=
name|defaultval
expr_stmt|;
return|return
literal|1
return|;
block|}
switch|switch
condition|(
name|r_type
argument_list|(
name|pdval
argument_list|)
condition|)
block|{
case|case
name|t_integer
case|:
operator|*
name|pvalue
operator|=
name|pdval
operator|->
name|value
operator|.
name|intval
expr_stmt|;
return|return
literal|0
return|;
case|case
name|t_real
case|:
operator|*
name|pvalue
operator|=
name|pdval
operator|->
name|value
operator|.
name|realval
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|e_typecheck
return|;
block|}
end_function

begin_comment
comment|/* Get an integer array from a Type 1 font Private dictionary. */
end_comment

begin_comment
comment|/* Return the element count if OK, 0 if missing,<0 if invalid. */
end_comment

begin_function
name|private
name|int
name|near
name|font_int_array
parameter_list|(
name|ref
modifier|*
name|pdict
parameter_list|,
name|ref
modifier|*
name|pname
parameter_list|,
name|uint
name|maxlen
parameter_list|,
name|int
modifier|*
name|ivec
parameter_list|)
block|{
name|ref
modifier|*
name|pdval
decl_stmt|,
modifier|*
name|pa
decl_stmt|;
name|int
modifier|*
name|pi
init|=
name|ivec
decl_stmt|;
name|uint
name|size
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|dict_find
argument_list|(
name|pdict
argument_list|,
name|pname
argument_list|,
operator|&
name|pdval
argument_list|)
operator|<=
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|r_has_type
argument_list|(
name|pdval
argument_list|,
name|t_array
argument_list|)
condition|)
return|return
name|e_invalidfont
return|;
name|size
operator|=
name|r_size
argument_list|(
name|pdval
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|>
name|maxlen
condition|)
return|return
name|e_limitcheck
return|;
name|pa
operator|=
name|pdval
operator|->
name|value
operator|.
name|refs
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
operator|,
name|pa
operator|++
operator|,
name|pi
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|r_has_type
argument_list|(
name|pa
argument_list|,
name|t_integer
argument_list|)
condition|)
return|return
name|e_typecheck
return|;
if|if
condition|(
name|pa
operator|->
name|value
operator|.
name|intval
operator|!=
operator|(
name|int
operator|)
name|pa
operator|->
name|value
operator|.
name|intval
condition|)
return|return
name|e_rangecheck
return|;
operator|*
name|pi
operator|=
operator|(
name|int
operator|)
name|pa
operator|->
name|value
operator|.
name|intval
expr_stmt|;
block|}
return|return
name|size
return|;
block|}
end_function

begin_comment
comment|/* Get a float array from a Type 1 font Private dictionary. */
end_comment

begin_comment
comment|/* Return the element count if OK, 0 if missing,<0 if invalid. */
end_comment

begin_function
name|private
name|int
name|near
name|font_float_array
parameter_list|(
name|ref
modifier|*
name|pdict
parameter_list|,
name|ref
modifier|*
name|pname
parameter_list|,
name|uint
name|maxlen
parameter_list|,
name|float
modifier|*
name|fvec
parameter_list|)
block|{
name|ref
modifier|*
name|pdval
decl_stmt|;
name|uint
name|size
decl_stmt|;
name|int
name|code
decl_stmt|;
if|if
condition|(
name|dict_find
argument_list|(
name|pdict
argument_list|,
name|pname
argument_list|,
operator|&
name|pdval
argument_list|)
operator|<=
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|r_has_type
argument_list|(
name|pdval
argument_list|,
name|t_array
argument_list|)
condition|)
return|return
name|e_invalidfont
return|;
name|size
operator|=
name|r_size
argument_list|(
name|pdval
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|>
name|maxlen
condition|)
return|return
name|e_limitcheck
return|;
name|code
operator|=
name|num_params
argument_list|(
name|pdval
operator|->
name|value
operator|.
name|refs
operator|+
name|size
operator|-
literal|1
argument_list|,
name|size
argument_list|,
name|fvec
argument_list|)
expr_stmt|;
return|return
operator|(
name|code
operator|>=
literal|0
condition|?
name|size
else|:
name|code
operator|)
return|;
block|}
end_function

end_unit

