begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  Crc calculation stuff  */
end_comment

begin_comment
comment|/* crctab calculated by Mark G. Mendel, Network Systems Corporation */
end_comment

begin_decl_stmt
specifier|static
name|unsigned
name|short
name|crctab
index|[
literal|256
index|]
init|=
block|{
literal|0x0000
block|,
literal|0x1021
block|,
literal|0x2042
block|,
literal|0x3063
block|,
literal|0x4084
block|,
literal|0x50a5
block|,
literal|0x60c6
block|,
literal|0x70e7
block|,
literal|0x8108
block|,
literal|0x9129
block|,
literal|0xa14a
block|,
literal|0xb16b
block|,
literal|0xc18c
block|,
literal|0xd1ad
block|,
literal|0xe1ce
block|,
literal|0xf1ef
block|,
literal|0x1231
block|,
literal|0x0210
block|,
literal|0x3273
block|,
literal|0x2252
block|,
literal|0x52b5
block|,
literal|0x4294
block|,
literal|0x72f7
block|,
literal|0x62d6
block|,
literal|0x9339
block|,
literal|0x8318
block|,
literal|0xb37b
block|,
literal|0xa35a
block|,
literal|0xd3bd
block|,
literal|0xc39c
block|,
literal|0xf3ff
block|,
literal|0xe3de
block|,
literal|0x2462
block|,
literal|0x3443
block|,
literal|0x0420
block|,
literal|0x1401
block|,
literal|0x64e6
block|,
literal|0x74c7
block|,
literal|0x44a4
block|,
literal|0x5485
block|,
literal|0xa56a
block|,
literal|0xb54b
block|,
literal|0x8528
block|,
literal|0x9509
block|,
literal|0xe5ee
block|,
literal|0xf5cf
block|,
literal|0xc5ac
block|,
literal|0xd58d
block|,
literal|0x3653
block|,
literal|0x2672
block|,
literal|0x1611
block|,
literal|0x0630
block|,
literal|0x76d7
block|,
literal|0x66f6
block|,
literal|0x5695
block|,
literal|0x46b4
block|,
literal|0xb75b
block|,
literal|0xa77a
block|,
literal|0x9719
block|,
literal|0x8738
block|,
literal|0xf7df
block|,
literal|0xe7fe
block|,
literal|0xd79d
block|,
literal|0xc7bc
block|,
literal|0x48c4
block|,
literal|0x58e5
block|,
literal|0x6886
block|,
literal|0x78a7
block|,
literal|0x0840
block|,
literal|0x1861
block|,
literal|0x2802
block|,
literal|0x3823
block|,
literal|0xc9cc
block|,
literal|0xd9ed
block|,
literal|0xe98e
block|,
literal|0xf9af
block|,
literal|0x8948
block|,
literal|0x9969
block|,
literal|0xa90a
block|,
literal|0xb92b
block|,
literal|0x5af5
block|,
literal|0x4ad4
block|,
literal|0x7ab7
block|,
literal|0x6a96
block|,
literal|0x1a71
block|,
literal|0x0a50
block|,
literal|0x3a33
block|,
literal|0x2a12
block|,
literal|0xdbfd
block|,
literal|0xcbdc
block|,
literal|0xfbbf
block|,
literal|0xeb9e
block|,
literal|0x9b79
block|,
literal|0x8b58
block|,
literal|0xbb3b
block|,
literal|0xab1a
block|,
literal|0x6ca6
block|,
literal|0x7c87
block|,
literal|0x4ce4
block|,
literal|0x5cc5
block|,
literal|0x2c22
block|,
literal|0x3c03
block|,
literal|0x0c60
block|,
literal|0x1c41
block|,
literal|0xedae
block|,
literal|0xfd8f
block|,
literal|0xcdec
block|,
literal|0xddcd
block|,
literal|0xad2a
block|,
literal|0xbd0b
block|,
literal|0x8d68
block|,
literal|0x9d49
block|,
literal|0x7e97
block|,
literal|0x6eb6
block|,
literal|0x5ed5
block|,
literal|0x4ef4
block|,
literal|0x3e13
block|,
literal|0x2e32
block|,
literal|0x1e51
block|,
literal|0x0e70
block|,
literal|0xff9f
block|,
literal|0xefbe
block|,
literal|0xdfdd
block|,
literal|0xcffc
block|,
literal|0xbf1b
block|,
literal|0xaf3a
block|,
literal|0x9f59
block|,
literal|0x8f78
block|,
literal|0x9188
block|,
literal|0x81a9
block|,
literal|0xb1ca
block|,
literal|0xa1eb
block|,
literal|0xd10c
block|,
literal|0xc12d
block|,
literal|0xf14e
block|,
literal|0xe16f
block|,
literal|0x1080
block|,
literal|0x00a1
block|,
literal|0x30c2
block|,
literal|0x20e3
block|,
literal|0x5004
block|,
literal|0x4025
block|,
literal|0x7046
block|,
literal|0x6067
block|,
literal|0x83b9
block|,
literal|0x9398
block|,
literal|0xa3fb
block|,
literal|0xb3da
block|,
literal|0xc33d
block|,
literal|0xd31c
block|,
literal|0xe37f
block|,
literal|0xf35e
block|,
literal|0x02b1
block|,
literal|0x1290
block|,
literal|0x22f3
block|,
literal|0x32d2
block|,
literal|0x4235
block|,
literal|0x5214
block|,
literal|0x6277
block|,
literal|0x7256
block|,
literal|0xb5ea
block|,
literal|0xa5cb
block|,
literal|0x95a8
block|,
literal|0x8589
block|,
literal|0xf56e
block|,
literal|0xe54f
block|,
literal|0xd52c
block|,
literal|0xc50d
block|,
literal|0x34e2
block|,
literal|0x24c3
block|,
literal|0x14a0
block|,
literal|0x0481
block|,
literal|0x7466
block|,
literal|0x6447
block|,
literal|0x5424
block|,
literal|0x4405
block|,
literal|0xa7db
block|,
literal|0xb7fa
block|,
literal|0x8799
block|,
literal|0x97b8
block|,
literal|0xe75f
block|,
literal|0xf77e
block|,
literal|0xc71d
block|,
literal|0xd73c
block|,
literal|0x26d3
block|,
literal|0x36f2
block|,
literal|0x0691
block|,
literal|0x16b0
block|,
literal|0x6657
block|,
literal|0x7676
block|,
literal|0x4615
block|,
literal|0x5634
block|,
literal|0xd94c
block|,
literal|0xc96d
block|,
literal|0xf90e
block|,
literal|0xe92f
block|,
literal|0x99c8
block|,
literal|0x89e9
block|,
literal|0xb98a
block|,
literal|0xa9ab
block|,
literal|0x5844
block|,
literal|0x4865
block|,
literal|0x7806
block|,
literal|0x6827
block|,
literal|0x18c0
block|,
literal|0x08e1
block|,
literal|0x3882
block|,
literal|0x28a3
block|,
literal|0xcb7d
block|,
literal|0xdb5c
block|,
literal|0xeb3f
block|,
literal|0xfb1e
block|,
literal|0x8bf9
block|,
literal|0x9bd8
block|,
literal|0xabbb
block|,
literal|0xbb9a
block|,
literal|0x4a75
block|,
literal|0x5a54
block|,
literal|0x6a37
block|,
literal|0x7a16
block|,
literal|0x0af1
block|,
literal|0x1ad0
block|,
literal|0x2ab3
block|,
literal|0x3a92
block|,
literal|0xfd2e
block|,
literal|0xed0f
block|,
literal|0xdd6c
block|,
literal|0xcd4d
block|,
literal|0xbdaa
block|,
literal|0xad8b
block|,
literal|0x9de8
block|,
literal|0x8dc9
block|,
literal|0x7c26
block|,
literal|0x6c07
block|,
literal|0x5c64
block|,
literal|0x4c45
block|,
literal|0x3ca2
block|,
literal|0x2c83
block|,
literal|0x1ce0
block|,
literal|0x0cc1
block|,
literal|0xef1f
block|,
literal|0xff3e
block|,
literal|0xcf5d
block|,
literal|0xdf7c
block|,
literal|0xaf9b
block|,
literal|0xbfba
block|,
literal|0x8fd9
block|,
literal|0x9ff8
block|,
literal|0x6e17
block|,
literal|0x7e36
block|,
literal|0x4e55
block|,
literal|0x5e74
block|,
literal|0x2e93
block|,
literal|0x3eb2
block|,
literal|0x0ed1
block|,
literal|0x1ef0
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * updcrc macro derived from article Copyright (C) 1986 Stephen Satchell.   *  NOTE: First srgument must be in range 0 to 255.  *        Second argument is referenced twice.  *   * Programmers may incorporate any or all code into their programs,   * giving proper credit within the source. Publication of the   * source routines is permitted so long as proper credit is given   * to Stephen Satchell, Satchell Evaluations and Chuck Forsberg,   * Omen Technology.  */
end_comment

begin_define
define|#
directive|define
name|updcrc
parameter_list|(
name|cp
parameter_list|,
name|crc
parameter_list|)
value|( crctab[((crc>> 8)& 255)] ^ (crc<< 8) ^ cp)
end_define

begin_comment
comment|/*  * Copyright (C) 1986 Gary S. Brown.  You may use this program, or  * code or tables extracted from it, as desired without restriction.  */
end_comment

begin_comment
comment|/* First, the polynomial itself and its table of feedback terms.  The  */
end_comment

begin_comment
comment|/* polynomial is                                                       */
end_comment

begin_comment
comment|/* X^32+X^26+X^23+X^22+X^16+X^12+X^11+X^10+X^8+X^7+X^5+X^4+X^2+X^1+X^0 */
end_comment

begin_comment
comment|/* Note that we take it "backwards" and put the highest-order term in  */
end_comment

begin_comment
comment|/* the lowest-order bit.  The X^32 term is "implied"; the LSB is the   */
end_comment

begin_comment
comment|/* X^31 term, etc.  The X^0 term (usually shown as "+1") results in    */
end_comment

begin_comment
comment|/* the MSB being 1.                                                    */
end_comment

begin_comment
comment|/* Note that the usual hardware shift register implementation, which   */
end_comment

begin_comment
comment|/* is what we're using (we're merely optimizing it by doing eight-bit  */
end_comment

begin_comment
comment|/* chunks at a time) shifts bits into the lowest-order term.  In our   */
end_comment

begin_comment
comment|/* implementation, that means shifting towards the right.  Why do we   */
end_comment

begin_comment
comment|/* do it this way?  Because the calculated CRC must be transmitted in  */
end_comment

begin_comment
comment|/* order from highest-order term to lowest-order term.  UARTs transmit */
end_comment

begin_comment
comment|/* characters in order from LSB to MSB.  By storing the CRC this way,  */
end_comment

begin_comment
comment|/* we hand it to the UART in the order low-byte to high-byte; the UART */
end_comment

begin_comment
comment|/* sends each low-bit to hight-bit; and the result is transmission bit */
end_comment

begin_comment
comment|/* by bit from highest- to lowest-order term without requiring any bit */
end_comment

begin_comment
comment|/* shuffling on our part.  Reception works similarly.                  */
end_comment

begin_comment
comment|/* The feedback terms table consists of 256, 32-bit entries.  Notes:   */
end_comment

begin_comment
comment|/*                                                                     */
end_comment

begin_comment
comment|/*     The table can be generated at runtime if desired; code to do so */
end_comment

begin_comment
comment|/*     is shown later.  It might not be obvious, but the feedback      */
end_comment

begin_comment
comment|/*     terms simply represent the results of eight shift/xor opera-    */
end_comment

begin_comment
comment|/*     tions for all combinations of data and CRC register values.     */
end_comment

begin_comment
comment|/*                                                                     */
end_comment

begin_comment
comment|/*     The values must be right-shifted by eight bits by the "updcrc"  */
end_comment

begin_comment
comment|/*     logic; the shift must be unsigned (bring in zeroes).  On some   */
end_comment

begin_comment
comment|/*     hardware you could probably optimize the shift in assembler by  */
end_comment

begin_comment
comment|/*     using byte-swap instructions.                                   */
end_comment

begin_decl_stmt
specifier|static
name|long
name|cr3tab
index|[]
init|=
block|{
comment|/* CRC polynomial 0xedb88320 */
literal|0x00000000
block|,
literal|0x77073096
block|,
literal|0xee0e612c
block|,
literal|0x990951ba
block|,
literal|0x076dc419
block|,
literal|0x706af48f
block|,
literal|0xe963a535
block|,
literal|0x9e6495a3
block|,
literal|0x0edb8832
block|,
literal|0x79dcb8a4
block|,
literal|0xe0d5e91e
block|,
literal|0x97d2d988
block|,
literal|0x09b64c2b
block|,
literal|0x7eb17cbd
block|,
literal|0xe7b82d07
block|,
literal|0x90bf1d91
block|,
literal|0x1db71064
block|,
literal|0x6ab020f2
block|,
literal|0xf3b97148
block|,
literal|0x84be41de
block|,
literal|0x1adad47d
block|,
literal|0x6ddde4eb
block|,
literal|0xf4d4b551
block|,
literal|0x83d385c7
block|,
literal|0x136c9856
block|,
literal|0x646ba8c0
block|,
literal|0xfd62f97a
block|,
literal|0x8a65c9ec
block|,
literal|0x14015c4f
block|,
literal|0x63066cd9
block|,
literal|0xfa0f3d63
block|,
literal|0x8d080df5
block|,
literal|0x3b6e20c8
block|,
literal|0x4c69105e
block|,
literal|0xd56041e4
block|,
literal|0xa2677172
block|,
literal|0x3c03e4d1
block|,
literal|0x4b04d447
block|,
literal|0xd20d85fd
block|,
literal|0xa50ab56b
block|,
literal|0x35b5a8fa
block|,
literal|0x42b2986c
block|,
literal|0xdbbbc9d6
block|,
literal|0xacbcf940
block|,
literal|0x32d86ce3
block|,
literal|0x45df5c75
block|,
literal|0xdcd60dcf
block|,
literal|0xabd13d59
block|,
literal|0x26d930ac
block|,
literal|0x51de003a
block|,
literal|0xc8d75180
block|,
literal|0xbfd06116
block|,
literal|0x21b4f4b5
block|,
literal|0x56b3c423
block|,
literal|0xcfba9599
block|,
literal|0xb8bda50f
block|,
literal|0x2802b89e
block|,
literal|0x5f058808
block|,
literal|0xc60cd9b2
block|,
literal|0xb10be924
block|,
literal|0x2f6f7c87
block|,
literal|0x58684c11
block|,
literal|0xc1611dab
block|,
literal|0xb6662d3d
block|,
literal|0x76dc4190
block|,
literal|0x01db7106
block|,
literal|0x98d220bc
block|,
literal|0xefd5102a
block|,
literal|0x71b18589
block|,
literal|0x06b6b51f
block|,
literal|0x9fbfe4a5
block|,
literal|0xe8b8d433
block|,
literal|0x7807c9a2
block|,
literal|0x0f00f934
block|,
literal|0x9609a88e
block|,
literal|0xe10e9818
block|,
literal|0x7f6a0dbb
block|,
literal|0x086d3d2d
block|,
literal|0x91646c97
block|,
literal|0xe6635c01
block|,
literal|0x6b6b51f4
block|,
literal|0x1c6c6162
block|,
literal|0x856530d8
block|,
literal|0xf262004e
block|,
literal|0x6c0695ed
block|,
literal|0x1b01a57b
block|,
literal|0x8208f4c1
block|,
literal|0xf50fc457
block|,
literal|0x65b0d9c6
block|,
literal|0x12b7e950
block|,
literal|0x8bbeb8ea
block|,
literal|0xfcb9887c
block|,
literal|0x62dd1ddf
block|,
literal|0x15da2d49
block|,
literal|0x8cd37cf3
block|,
literal|0xfbd44c65
block|,
literal|0x4db26158
block|,
literal|0x3ab551ce
block|,
literal|0xa3bc0074
block|,
literal|0xd4bb30e2
block|,
literal|0x4adfa541
block|,
literal|0x3dd895d7
block|,
literal|0xa4d1c46d
block|,
literal|0xd3d6f4fb
block|,
literal|0x4369e96a
block|,
literal|0x346ed9fc
block|,
literal|0xad678846
block|,
literal|0xda60b8d0
block|,
literal|0x44042d73
block|,
literal|0x33031de5
block|,
literal|0xaa0a4c5f
block|,
literal|0xdd0d7cc9
block|,
literal|0x5005713c
block|,
literal|0x270241aa
block|,
literal|0xbe0b1010
block|,
literal|0xc90c2086
block|,
literal|0x5768b525
block|,
literal|0x206f85b3
block|,
literal|0xb966d409
block|,
literal|0xce61e49f
block|,
literal|0x5edef90e
block|,
literal|0x29d9c998
block|,
literal|0xb0d09822
block|,
literal|0xc7d7a8b4
block|,
literal|0x59b33d17
block|,
literal|0x2eb40d81
block|,
literal|0xb7bd5c3b
block|,
literal|0xc0ba6cad
block|,
literal|0xedb88320
block|,
literal|0x9abfb3b6
block|,
literal|0x03b6e20c
block|,
literal|0x74b1d29a
block|,
literal|0xead54739
block|,
literal|0x9dd277af
block|,
literal|0x04db2615
block|,
literal|0x73dc1683
block|,
literal|0xe3630b12
block|,
literal|0x94643b84
block|,
literal|0x0d6d6a3e
block|,
literal|0x7a6a5aa8
block|,
literal|0xe40ecf0b
block|,
literal|0x9309ff9d
block|,
literal|0x0a00ae27
block|,
literal|0x7d079eb1
block|,
literal|0xf00f9344
block|,
literal|0x8708a3d2
block|,
literal|0x1e01f268
block|,
literal|0x6906c2fe
block|,
literal|0xf762575d
block|,
literal|0x806567cb
block|,
literal|0x196c3671
block|,
literal|0x6e6b06e7
block|,
literal|0xfed41b76
block|,
literal|0x89d32be0
block|,
literal|0x10da7a5a
block|,
literal|0x67dd4acc
block|,
literal|0xf9b9df6f
block|,
literal|0x8ebeeff9
block|,
literal|0x17b7be43
block|,
literal|0x60b08ed5
block|,
literal|0xd6d6a3e8
block|,
literal|0xa1d1937e
block|,
literal|0x38d8c2c4
block|,
literal|0x4fdff252
block|,
literal|0xd1bb67f1
block|,
literal|0xa6bc5767
block|,
literal|0x3fb506dd
block|,
literal|0x48b2364b
block|,
literal|0xd80d2bda
block|,
literal|0xaf0a1b4c
block|,
literal|0x36034af6
block|,
literal|0x41047a60
block|,
literal|0xdf60efc3
block|,
literal|0xa867df55
block|,
literal|0x316e8eef
block|,
literal|0x4669be79
block|,
literal|0xcb61b38c
block|,
literal|0xbc66831a
block|,
literal|0x256fd2a0
block|,
literal|0x5268e236
block|,
literal|0xcc0c7795
block|,
literal|0xbb0b4703
block|,
literal|0x220216b9
block|,
literal|0x5505262f
block|,
literal|0xc5ba3bbe
block|,
literal|0xb2bd0b28
block|,
literal|0x2bb45a92
block|,
literal|0x5cb36a04
block|,
literal|0xc2d7ffa7
block|,
literal|0xb5d0cf31
block|,
literal|0x2cd99e8b
block|,
literal|0x5bdeae1d
block|,
literal|0x9b64c2b0
block|,
literal|0xec63f226
block|,
literal|0x756aa39c
block|,
literal|0x026d930a
block|,
literal|0x9c0906a9
block|,
literal|0xeb0e363f
block|,
literal|0x72076785
block|,
literal|0x05005713
block|,
literal|0x95bf4a82
block|,
literal|0xe2b87a14
block|,
literal|0x7bb12bae
block|,
literal|0x0cb61b38
block|,
literal|0x92d28e9b
block|,
literal|0xe5d5be0d
block|,
literal|0x7cdcefb7
block|,
literal|0x0bdbdf21
block|,
literal|0x86d3d2d4
block|,
literal|0xf1d4e242
block|,
literal|0x68ddb3f8
block|,
literal|0x1fda836e
block|,
literal|0x81be16cd
block|,
literal|0xf6b9265b
block|,
literal|0x6fb077e1
block|,
literal|0x18b74777
block|,
literal|0x88085ae6
block|,
literal|0xff0f6a70
block|,
literal|0x66063bca
block|,
literal|0x11010b5c
block|,
literal|0x8f659eff
block|,
literal|0xf862ae69
block|,
literal|0x616bffd3
block|,
literal|0x166ccf45
block|,
literal|0xa00ae278
block|,
literal|0xd70dd2ee
block|,
literal|0x4e048354
block|,
literal|0x3903b3c2
block|,
literal|0xa7672661
block|,
literal|0xd06016f7
block|,
literal|0x4969474d
block|,
literal|0x3e6e77db
block|,
literal|0xaed16a4a
block|,
literal|0xd9d65adc
block|,
literal|0x40df0b66
block|,
literal|0x37d83bf0
block|,
literal|0xa9bcae53
block|,
literal|0xdebb9ec5
block|,
literal|0x47b2cf7f
block|,
literal|0x30b5ffe9
block|,
literal|0xbdbdf21c
block|,
literal|0xcabac28a
block|,
literal|0x53b39330
block|,
literal|0x24b4a3a6
block|,
literal|0xbad03605
block|,
literal|0xcdd70693
block|,
literal|0x54de5729
block|,
literal|0x23d967bf
block|,
literal|0xb3667a2e
block|,
literal|0xc4614ab8
block|,
literal|0x5d681b02
block|,
literal|0x2a6f2b94
block|,
literal|0xb40bbe37
block|,
literal|0xc30c8ea1
block|,
literal|0x5a05df1b
block|,
literal|0x2d02ef8d
block|}
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|NFGM
end_ifdef

begin_function
name|long
name|UPDC32
parameter_list|(
name|b
parameter_list|,
name|c
parameter_list|)
name|long
name|c
decl_stmt|;
block|{
return|return
operator|(
name|cr3tab
index|[
operator|(
operator|(
name|int
operator|)
name|c
operator|^
name|b
operator|)
operator|&
literal|0xff
index|]
operator|^
operator|(
operator|(
name|c
operator|>>
literal|8
operator|)
operator|&
literal|0x00FFFFFF
operator|)
operator|)
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|UPDC32
parameter_list|(
name|b
parameter_list|,
name|c
parameter_list|)
value|(cr3tab[((int)c ^ b)& 0xff] ^ ((c>> 8)& 0x00FFFFFF))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* End of crctab.c */
end_comment

end_unit

