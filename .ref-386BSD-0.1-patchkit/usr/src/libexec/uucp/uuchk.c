begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* uuchk.c    Display what we think the permissions of systems are.     Copyright (C) 1991, 1992 Ian Lance Taylor     This file is part of the Taylor UUCP package.     This program is free software; you can redistribute it and/or    modify it under the terms of the GNU General Public License as    published by the Free Software Foundation; either version 2 of the    License, or (at your option) any later version.     This program is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.     The author of the program may be contacted at ian@airs.com or    c/o AIRS, P.O. Box 520, Waltham, MA 02254.     $Log: uuchk.c,v $    Revision 1.28  1992/03/28  20:31:55  ian    Franc,ois Pinard: allow a name to be given to an alternate     Revision 1.27  1992/03/12  19:54:43  ian    Debugging based on types rather than number     Revision 1.26  1992/03/10  21:47:39  ian    Added protocol command for ports     Revision 1.25  1992/03/09  18:10:26  ian    Zacharias Beckman: put acceptable commands and path on different lines     Revision 1.24  1992/03/07  02:56:30  ian    Rewrote time routines     Revision 1.23  1992/02/27  05:40:54  ian    T. William Wells: detach from controlling terminal, handle signals safely     Revision 1.22  1992/02/23  19:50:50  ian    Handle READ and WRITE in Permissions correctly     Revision 1.21  1992/02/23  03:26:51  ian    Overhaul to use automatic configure shell script     Revision 1.20  1992/02/08  22:33:32  ian    Only get the current working directory if it's going to be needed     Revision 1.19  1992/02/08  20:33:57  ian    Handle all possible signals raised by abort     Revision 1.18  1992/02/08  03:54:18  ian    Include<string.h> only in<uucp.h>, added 1992 copyright     Revision 1.17  1992/01/15  07:06:29  ian    Set configuration directory in Makefile rather than sysdep.h     Revision 1.16  1992/01/14  04:04:17  ian    Chip Salzenberg: strcmp is a macro on AIX     Revision 1.15  1992/01/05  03:09:17  ian    Changed abProgram and abVersion to non const to avoid compiler bug     Revision 1.14  1991/12/23  05:15:54  ian    David Nugent: set debugging level for a specific system     Revision 1.13  1991/12/22  22:14:53  ian    Added externs for strcasecmp or strncasecmp     Revision 1.12  1991/12/18  03:54:14  ian    Made error messages to terminal appear more normal     Revision 1.11  1991/12/17  23:14:08  ian    T. William Wells: allow dialer complete and abort to be chat scripts     Revision 1.10  1991/12/15  04:17:11  ian    Added chat-seven-bit command to control parity bit stripping     Revision 1.9  1991/12/15  03:42:33  ian    Added tprocess_chat_cmd for all chat commands, and added CMDTABTYPE_PREFIX     Revision 1.8  1991/12/01  14:45:53  ian    Bob Izenberg: report dialer/token pairs correctly     Revision 1.7  1991/11/21  22:17:06  ian    Add version string, print version when printing usage     Revision 1.6  1991/11/13  20:38:00  ian    Added TCP port type for connections over TCP     Revision 1.5  1991/11/12  19:47:04  ian    Add called-chat set of commands to run a chat script on an incoming call     Revision 1.4  1991/11/11  23:47:24  ian    Added chat-program to run a program to do a chat script     Revision 1.3  1991/11/11  16:19:21  ian    Added message for no protocol specified     Revision 1.2  1991/09/19  02:22:44  ian    Chip Salzenberg's patch to allow ";retrytime" at the end of a time string     Revision 1.1  1991/09/10  19:40:31  ian    Initial revision     */
end_comment

begin_include
include|#
directive|include
file|"uucp.h"
end_include

begin_if
if|#
directive|if
name|USE_RCS_ID
end_if

begin_decl_stmt
name|char
name|uuchk_rcsid
index|[]
init|=
literal|"$Id: uuchk.c,v 1.28 1992/03/28 20:31:55 ian Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"getopt.h"
end_include

begin_include
include|#
directive|include
file|"port.h"
end_include

begin_include
include|#
directive|include
file|"system.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"uutime.h"
end_include

begin_comment
comment|/* External functions.  */
end_comment

begin_function_decl
specifier|extern
name|int
name|strcasecmp
parameter_list|()
function_decl|;
end_function_decl

begin_escape
end_escape

begin_comment
comment|/* Program name.  */
end_comment

begin_decl_stmt
name|char
name|abProgram
index|[]
init|=
literal|"uuchk"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Local functions.  */
end_comment

begin_decl_stmt
specifier|static
name|void
name|ukusage
name|P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ukshow
name|P
argument_list|(
operator|(
specifier|const
expr|struct
name|ssysteminfo
operator|*
name|qsys
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|boolean
name|fkshow_port
name|P
argument_list|(
operator|(
expr|struct
name|sport
operator|*
name|qport
operator|,
name|boolean
name|fin
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ukshow_dialer
name|P
argument_list|(
operator|(
expr|struct
name|sdialer
operator|*
name|qdial
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ukshow_chat
name|P
argument_list|(
operator|(
specifier|const
expr|struct
name|schat_info
operator|*
name|qchat
operator|,
specifier|const
name|char
operator|*
name|zhdr
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ukshow_size
name|P
argument_list|(
operator|(
specifier|const
name|char
operator|*
name|z
operator|,
name|boolean
name|fcall
operator|,
name|boolean
name|flocal
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ukshow_proto_params
name|P
argument_list|(
operator|(
name|int
name|c
operator|,
expr|struct
name|sproto_param
operator|*
name|pas
operator|,
name|int
name|cindent
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ukshow_time
name|P
argument_list|(
operator|(
specifier|const
expr|struct
name|sspan
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|sspan
modifier|*
name|qcompress_span
name|P
argument_list|(
operator|(
expr|struct
name|sspan
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Local variables.  */
end_comment

begin_decl_stmt
specifier|static
name|boolean
name|fKgot_port
decl_stmt|;
end_decl_stmt

begin_escape
end_escape

begin_comment
comment|/* Long getopt options.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|option
name|asKlongopts
index|[]
init|=
block|{
block|{
name|NULL
block|,
literal|0
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|struct
name|option
modifier|*
name|_getopt_long_options
init|=
name|asKlongopts
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|iopt
decl_stmt|;
comment|/* The configuration file name.  */
specifier|const
name|char
modifier|*
name|zconfig
init|=
name|NULL
decl_stmt|;
name|int
name|c
decl_stmt|;
name|struct
name|ssysteminfo
modifier|*
name|pas
decl_stmt|;
name|int
name|i
decl_stmt|;
while|while
condition|(
operator|(
name|iopt
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"I:x:"
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
block|{
switch|switch
condition|(
name|iopt
condition|)
block|{
case|case
literal|'I'
case|:
comment|/* Set the configuration file name.  */
name|zconfig
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'x'
case|:
if|#
directive|if
name|DEBUG
operator|>
literal|1
comment|/* Set the debugging level.  */
name|iDebug
operator||=
name|idebug_parse
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
literal|0
case|:
comment|/* Long option found and flag set.  */
break|break;
default|default:
name|ukusage
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|optind
operator|!=
name|argc
condition|)
name|ukusage
argument_list|()
expr_stmt|;
name|uread_config
argument_list|(
name|zconfig
argument_list|)
expr_stmt|;
name|usysdep_initialize
argument_list|(
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|uread_all_system_info
argument_list|(
operator|&
name|c
argument_list|,
operator|&
name|pas
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|c
condition|;
name|i
operator|++
control|)
block|{
name|ukshow
argument_list|(
operator|&
name|pas
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|c
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ulog_close
argument_list|()
expr_stmt|;
name|usysdep_exit
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Avoid errors about not returning a value.  */
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Print a usage message and die.  */
end_comment

begin_function
specifier|static
name|void
name|ukusage
parameter_list|()
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Taylor UUCP version %s, copyright (C) 1991, 1992 Ian Lance Taylor\n"
argument_list|,
name|abVersion
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Usage: uuchk [-I file] [-x debug]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -x debug: Set debugging level (0 for none, 9 is max)\n"
argument_list|)
expr_stmt|;
if|#
directive|if
name|HAVE_TAYLOR_CONFIG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -I file: Set configuration file to use (default %s%s)\n"
argument_list|,
name|NEWCONFIGLIB
argument_list|,
name|CONFIGFILE
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* HAVE_TAYLOR_CONFIG */
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Dump out the information for a system.  */
end_comment

begin_function
specifier|static
name|void
name|ukshow
parameter_list|(
name|qsys
parameter_list|)
specifier|const
name|struct
name|ssysteminfo
modifier|*
name|qsys
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
specifier|const
name|struct
name|ssysteminfo
modifier|*
name|qlast
decl_stmt|;
name|printf
argument_list|(
literal|"System: %s"
argument_list|,
name|qsys
operator|->
name|zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zalias
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|" (%s)"
argument_list|,
name|qsys
operator|->
name|zalias
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|qlast
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|qsys
operator|!=
name|NULL
condition|;
name|qlast
operator|=
name|qsys
operator|,
name|qsys
operator|=
name|qsys
operator|->
name|qalternate
operator|,
name|i
operator|++
control|)
block|{
name|boolean
name|fcall
decl_stmt|,
name|fcalled
decl_stmt|;
name|struct
name|sspan
modifier|*
name|qtime
decl_stmt|,
modifier|*
name|qspan
decl_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
operator|||
name|qsys
operator|->
name|qalternate
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Alternate %d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zalternate
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|" (%s)"
argument_list|,
name|qsys
operator|->
name|zalternate
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
comment|/* See if this alternate could be used when calling out.  */
name|fcall
operator|=
operator|(
name|i
operator|==
literal|0
operator|||
name|qsys
operator|->
name|ztime
operator|!=
name|qlast
operator|->
name|ztime
operator|||
name|qsys
operator|->
name|zport
operator|!=
name|qlast
operator|->
name|zport
operator|||
name|qsys
operator|->
name|qport
operator|!=
name|qlast
operator|->
name|qport
operator|||
name|qsys
operator|->
name|ibaud
operator|!=
name|qlast
operator|->
name|ibaud
operator|||
name|qsys
operator|->
name|zphone
operator|!=
name|qlast
operator|->
name|zphone
operator|||
name|qsys
operator|->
name|schat
operator|.
name|zprogram
operator|!=
name|qlast
operator|->
name|schat
operator|.
name|zprogram
operator|||
name|qsys
operator|->
name|schat
operator|.
name|zchat
operator|!=
name|qlast
operator|->
name|schat
operator|.
name|zchat
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|fcall
condition|)
name|qtime
operator|=
name|NULL
expr_stmt|;
else|else
block|{
name|qtime
operator|=
name|qtimegrade_parse
argument_list|(
name|qsys
operator|->
name|ztime
argument_list|)
expr_stmt|;
if|if
condition|(
name|qtime
operator|==
name|NULL
condition|)
name|fcall
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/* If this is the first alternate, it can be used to accept 	 a call.  Otherwise it can be used if it specifies a different 	 login name than the previous alternate.  */
name|fcalled
operator|=
operator|(
name|i
operator|==
literal|0
operator|||
operator|(
name|qlast
operator|!=
name|NULL
operator|&&
name|qsys
operator|->
name|zcalled_login
operator|!=
name|NULL
operator|&&
operator|(
name|qlast
operator|->
name|zcalled_login
operator|==
name|NULL
operator|||
name|strcmp
argument_list|(
name|qsys
operator|->
name|zcalled_login
argument_list|,
name|qlast
operator|->
name|zcalled_login
argument_list|)
operator|!=
literal|0
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|fcall
operator|&&
operator|!
name|fcalled
condition|)
block|{
name|printf
argument_list|(
literal|" This alternate is never used\n"
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|fcalled
condition|)
block|{
if|if
condition|(
name|qsys
operator|->
name|zcalled_login
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|qsys
operator|->
name|zcalled_login
argument_list|,
literal|"ANY"
argument_list|)
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|i
operator|==
literal|0
operator|&&
name|qsys
operator|->
name|qalternate
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|" Caller must log in as %s\n"
argument_list|,
name|qsys
operator|->
name|zcalled_login
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" When called using login name %s\n"
argument_list|,
name|qsys
operator|->
name|zcalled_login
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|" When called using any login name\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zlocalname
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|" Will use %s as name of local system\n"
argument_list|,
name|qsys
operator|->
name|zlocalname
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fcalled
operator|&&
name|qsys
operator|->
name|fcallback
condition|)
block|{
name|printf
argument_list|(
literal|" If called, will call back\n"
argument_list|)
expr_stmt|;
name|fcalled
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|fcall
condition|)
block|{
if|if
condition|(
name|i
operator|==
literal|0
operator|&&
name|qsys
operator|->
name|qalternate
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|" Call out"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" This alternate applies when calling"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zport
operator|!=
name|NULL
operator|||
name|qsys
operator|->
name|qport
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|" using "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zport
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"port %s"
argument_list|,
name|qsys
operator|->
name|zport
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"a specially defined port"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|ibaud
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" at speed %ld"
argument_list|,
name|qsys
operator|->
name|ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|ihighbaud
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" to %ld"
argument_list|,
name|qsys
operator|->
name|ihighbaud
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|qsys
operator|->
name|ibaud
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" at speed %ld"
argument_list|,
name|qsys
operator|->
name|ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|ihighbaud
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" to %ld"
argument_list|,
name|qsys
operator|->
name|ihighbaud
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|" using any port\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|qport
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|" The port is defined as:\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fkshow_port
argument_list|(
name|qsys
operator|->
name|qport
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|struct
name|sport
name|sdummy
decl_stmt|;
name|printf
argument_list|(
literal|" The possible ports are:\n"
argument_list|)
expr_stmt|;
name|fKgot_port
operator|=
name|FALSE
expr_stmt|;
operator|(
name|void
operator|)
name|ffind_port
argument_list|(
name|qsys
operator|->
name|zport
argument_list|,
name|qsys
operator|->
name|ibaud
argument_list|,
name|qsys
operator|->
name|ihighbaud
argument_list|,
operator|&
name|sdummy
argument_list|,
name|fkshow_port
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fKgot_port
condition|)
name|printf
argument_list|(
literal|" *** There are no matching ports\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qsys
operator|->
name|zphone
operator|!=
name|NULL
condition|)
block|{
if|#
directive|if
name|HAVE_TCP
if|if
condition|(
operator|(
name|qsys
operator|->
name|zport
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|qsys
operator|->
name|zport
argument_list|,
literal|"TCP"
argument_list|)
operator|==
literal|0
operator|)
operator|||
operator|(
name|qsys
operator|->
name|qport
operator|!=
name|NULL
operator|&&
name|qsys
operator|->
name|qport
operator|->
name|ttype
operator|==
name|PORTTYPE_TCP
operator|)
condition|)
name|printf
argument_list|(
literal|" Remote address %s\n"
argument_list|,
name|qsys
operator|->
name|zphone
argument_list|)
expr_stmt|;
else|else
endif|#
directive|endif
comment|/* HAVE_TCP */
name|printf
argument_list|(
literal|" Phone number %s\n"
argument_list|,
name|qsys
operator|->
name|zphone
argument_list|)
expr_stmt|;
block|}
name|ukshow_chat
argument_list|(
operator|&
name|qsys
operator|->
name|schat
argument_list|,
literal|" Chat"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zcall_login
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|qsys
operator|->
name|zcall_login
argument_list|,
literal|"*"
argument_list|)
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" Login name %s\n"
argument_list|,
name|qsys
operator|->
name|zcall_login
argument_list|)
expr_stmt|;
else|else
block|{
name|char
modifier|*
name|zlogin
decl_stmt|,
modifier|*
name|zpass
decl_stmt|;
if|if
condition|(
operator|!
name|fcallout_login
argument_list|(
name|qsys
argument_list|,
operator|&
name|zlogin
argument_list|,
operator|&
name|zpass
argument_list|)
condition|)
name|printf
argument_list|(
literal|" Can not determine login name\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|" Login name %s\n"
argument_list|,
name|zlogin
argument_list|)
expr_stmt|;
name|xfree
argument_list|(
operator|(
name|pointer
operator|)
name|zlogin
argument_list|)
expr_stmt|;
name|xfree
argument_list|(
operator|(
name|pointer
operator|)
name|zpass
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|qsys
operator|->
name|zcall_password
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|qsys
operator|->
name|zcall_password
argument_list|,
literal|"*"
argument_list|)
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" Password %s\n"
argument_list|,
name|qsys
operator|->
name|zcall_password
argument_list|)
expr_stmt|;
else|else
block|{
name|char
modifier|*
name|zlogin
decl_stmt|,
modifier|*
name|zpass
decl_stmt|;
if|if
condition|(
operator|!
name|fcallout_login
argument_list|(
name|qsys
argument_list|,
operator|&
name|zlogin
argument_list|,
operator|&
name|zpass
argument_list|)
condition|)
name|printf
argument_list|(
literal|" Can not determine password\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|" Password %s\n"
argument_list|,
name|zpass
argument_list|)
expr_stmt|;
name|xfree
argument_list|(
operator|(
name|pointer
operator|)
name|zlogin
argument_list|)
expr_stmt|;
name|xfree
argument_list|(
operator|(
name|pointer
operator|)
name|zpass
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|qtime
operator|=
name|qcompress_span
argument_list|(
name|qtime
argument_list|)
expr_stmt|;
for|for
control|(
name|qspan
operator|=
name|qtime
init|;
name|qspan
operator|!=
name|NULL
condition|;
name|qspan
operator|=
name|qspan
operator|->
name|qnext
control|)
block|{
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|ukshow_time
argument_list|(
name|qspan
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" may call if "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|char
operator|)
name|qspan
operator|->
name|ival
operator|==
name|BGRADE_LOW
condition|)
name|printf
argument_list|(
literal|"any work"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"work grade %c or higher"
argument_list|,
operator|(
name|char
operator|)
name|qspan
operator|->
name|ival
argument_list|)
expr_stmt|;
if|if
condition|(
name|qspan
operator|->
name|cretry
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" (retry %d)"
argument_list|,
name|qspan
operator|->
name|cretry
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|utimespan_free
argument_list|(
name|qtime
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zcalltimegrade
operator|!=
name|NULL
condition|)
block|{
name|boolean
name|fprint
decl_stmt|,
name|fother
decl_stmt|;
name|qtime
operator|=
name|qtimegrade_parse
argument_list|(
name|qsys
operator|->
name|zcalltimegrade
argument_list|)
expr_stmt|;
name|qtime
operator|=
name|qcompress_span
argument_list|(
name|qtime
argument_list|)
expr_stmt|;
name|fprint
operator|=
name|FALSE
expr_stmt|;
name|fother
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|qtime
operator|->
name|istart
operator|!=
literal|0
condition|)
name|fother
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|qspan
operator|=
name|qtime
init|;
name|qspan
operator|!=
name|NULL
condition|;
name|qspan
operator|=
name|qspan
operator|->
name|qnext
control|)
block|{
if|if
condition|(
operator|(
name|char
operator|)
name|qspan
operator|->
name|ival
operator|==
name|BGRADE_LOW
condition|)
block|{
name|fother
operator|=
name|TRUE
expr_stmt|;
continue|continue;
block|}
name|fprint
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|ukshow_time
argument_list|(
name|qspan
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" may accept work grade %c or higher\n"
argument_list|,
operator|(
name|char
operator|)
name|qspan
operator|->
name|ival
argument_list|)
expr_stmt|;
if|if
condition|(
name|qspan
operator|->
name|qnext
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|qspan
operator|->
name|iend
operator|!=
literal|7
operator|*
literal|24
operator|*
literal|60
condition|)
name|fother
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|qspan
operator|->
name|iend
operator|!=
name|qspan
operator|->
name|qnext
operator|->
name|istart
condition|)
name|fother
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|fprint
operator|&&
name|fother
condition|)
name|printf
argument_list|(
literal|" (At other times may accept any work)\n"
argument_list|)
expr_stmt|;
name|utimespan_free
argument_list|(
name|qtime
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|qsys
operator|->
name|fsequence
condition|)
name|printf
argument_list|(
literal|" Sequence numbers are used\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcalled
condition|)
name|ukshow_chat
argument_list|(
operator|&
name|qsys
operator|->
name|scalled_chat
argument_list|,
literal|" When called, chat"
argument_list|)
expr_stmt|;
if|#
directive|if
name|DEBUG
operator|>
literal|1
if|if
condition|(
name|qsys
operator|->
name|idebug
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" Debugging level 0%o\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|qsys
operator|->
name|idebug
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|imax_remote_debug
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" Max remote debugging level 0%o\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|qsys
operator|->
name|imax_remote_debug
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|fcall
condition|)
block|{
name|ukshow_size
argument_list|(
name|qsys
operator|->
name|zcall_local_size
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|ukshow_size
argument_list|(
name|qsys
operator|->
name|zcall_remote_size
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fcalled
condition|)
block|{
name|ukshow_size
argument_list|(
name|qsys
operator|->
name|zcalled_local_size
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|ukshow_size
argument_list|(
name|qsys
operator|->
name|zcalled_remote_size
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fcall
condition|)
block|{
name|printf
argument_list|(
literal|" %sllow remote requests when calling\n"
argument_list|,
name|qsys
operator|->
name|fcall_request
condition|?
literal|"A"
else|:
literal|"Do not a"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" May %smake local requests when calling\n"
argument_list|,
name|qsys
operator|->
name|fcall_transfer
condition|?
literal|""
else|:
literal|"not "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fcalled
condition|)
block|{
name|printf
argument_list|(
literal|" %sllow remote requests when called\n"
argument_list|,
name|qsys
operator|->
name|fcalled_request
condition|?
literal|"A"
else|:
literal|"Do not a"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" May %smake local requests when called\n"
argument_list|,
name|qsys
operator|->
name|fcalled_transfer
condition|?
literal|""
else|:
literal|"not "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qsys
operator|->
name|fcall_transfer
operator|||
name|qsys
operator|->
name|fcalled_transfer
condition|)
block|{
if|if
condition|(
name|qsys
operator|->
name|zcalled_local_send
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|" May send by local request: %s\n"
argument_list|,
name|qsys
operator|->
name|zlocal_send
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|fcall
operator|&&
name|qsys
operator|->
name|fcall_transfer
condition|)
name|printf
argument_list|(
literal|" May send by local request when calling: %s\n"
argument_list|,
name|qsys
operator|->
name|zlocal_send
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcalled
operator|&&
name|qsys
operator|->
name|fcalled_transfer
condition|)
name|printf
argument_list|(
literal|" May send by local request when called: %s\n"
argument_list|,
name|qsys
operator|->
name|zcalled_local_send
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|qsys
operator|->
name|fcall_request
operator|||
name|qsys
operator|->
name|fcalled_request
condition|)
block|{
if|if
condition|(
name|qsys
operator|->
name|zcalled_remote_send
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|" May send by remote request: %s\n"
argument_list|,
name|qsys
operator|->
name|zremote_send
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|fcall
operator|&&
name|qsys
operator|->
name|fcall_request
condition|)
name|printf
argument_list|(
literal|" May send by remote request when calling: %s\n"
argument_list|,
name|qsys
operator|->
name|zremote_send
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcalled
operator|&&
name|qsys
operator|->
name|fcalled_request
condition|)
name|printf
argument_list|(
literal|" May send by remote request when called: %s\n"
argument_list|,
name|qsys
operator|->
name|zcalled_remote_send
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|qsys
operator|->
name|fcall_transfer
operator|||
name|qsys
operator|->
name|fcalled_transfer
condition|)
block|{
if|if
condition|(
name|qsys
operator|->
name|zcalled_local_receive
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|" May accept by local request: %s\n"
argument_list|,
name|qsys
operator|->
name|zlocal_receive
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|fcall
operator|&&
name|qsys
operator|->
name|fcall_transfer
condition|)
name|printf
argument_list|(
literal|" May accept by local request when calling: %s\n"
argument_list|,
name|qsys
operator|->
name|zlocal_receive
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcalled
operator|&&
name|qsys
operator|->
name|fcalled_transfer
condition|)
name|printf
argument_list|(
literal|" May accept by local request when called: %s\n"
argument_list|,
name|qsys
operator|->
name|zcalled_local_receive
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|qsys
operator|->
name|fcall_request
operator|||
name|qsys
operator|->
name|fcalled_request
condition|)
block|{
if|if
condition|(
name|qsys
operator|->
name|zcalled_remote_receive
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|" May accept by remote request: %s\n"
argument_list|,
name|qsys
operator|->
name|zremote_receive
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|fcall
operator|&&
name|qsys
operator|->
name|fcall_request
condition|)
name|printf
argument_list|(
literal|" May accept by remote request when calling: %s\n"
argument_list|,
name|qsys
operator|->
name|zremote_receive
argument_list|)
expr_stmt|;
if|if
condition|(
name|fcalled
operator|&&
name|qsys
operator|->
name|fcalled_request
condition|)
name|printf
argument_list|(
literal|" May accept by remote request when called: %s\n"
argument_list|,
name|qsys
operator|->
name|zcalled_remote_receive
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|" May execute %s\n"
argument_list|,
name|qsys
operator|->
name|zcmds
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" Execution path %s\n"
argument_list|,
name|qsys
operator|->
name|zpath
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|cfree_space
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|" Will leave %ld bytes available\n"
argument_list|,
name|qsys
operator|->
name|cfree_space
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zpubdir
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|" Public directory is %s\n"
argument_list|,
name|qsys
operator|->
name|zpubdir
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|zprotocols
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|" Will use protocols %s\n"
argument_list|,
name|qsys
operator|->
name|zprotocols
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" Will use any known protocol\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|cproto_params
operator|!=
literal|0
condition|)
name|ukshow_proto_params
argument_list|(
name|qsys
operator|->
name|cproto_params
argument_list|,
name|qsys
operator|->
name|qproto_params
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Show information about a port.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|boolean
name|fkshow_port
parameter_list|(
name|qport
parameter_list|,
name|fin
parameter_list|)
name|struct
name|sport
modifier|*
name|qport
decl_stmt|;
name|boolean
name|fin
decl_stmt|;
block|{
name|fKgot_port
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"  Port name %s\n"
argument_list|,
name|qport
operator|->
name|zname
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|qport
operator|->
name|ttype
condition|)
block|{
case|case
name|PORTTYPE_STDIN
case|:
name|printf
argument_list|(
literal|"   Port type stdin\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PORTTYPE_DIRECT
case|:
name|printf
argument_list|(
literal|"   Port type direct\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|u
operator|.
name|sdirect
operator|.
name|zdevice
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"   Device %s\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|sdirect
operator|.
name|zdevice
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"   Speed %ld\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|sdirect
operator|.
name|ibaud
argument_list|)
expr_stmt|;
break|break;
case|case
name|PORTTYPE_MODEM
case|:
name|printf
argument_list|(
literal|"   Port type modem\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdevice
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"   Device %s\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdevice
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdial_device
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"   Dial device %s\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdial_device
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"   Speed %ld\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|ilowbaud
operator|!=
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|ihighbaud
condition|)
name|printf
argument_list|(
literal|"   Speed range %ld to %ld\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|ilowbaud
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|ihighbaud
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"   Carrier %savailable\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|fcarrier
condition|?
literal|""
else|:
literal|"not "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|qdialer
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"   Specially defined dialer\n"
argument_list|)
expr_stmt|;
name|ukshow_dialer
argument_list|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|qdialer
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdialer
operator|!=
name|NULL
condition|)
block|{
specifier|const
name|char
modifier|*
name|zc
decl_stmt|;
name|struct
name|sdialer
name|sdial
decl_stmt|;
comment|/* This might be a single dialer name, or it might be a 	     sequence of dialer/token pairs.  */
name|zc
operator|=
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdialer
expr_stmt|;
if|if
condition|(
name|zc
index|[
name|strcspn
argument_list|(
name|zc
argument_list|,
literal|" \t"
argument_list|)
index|]
operator|==
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|!
name|fread_dialer_info
argument_list|(
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdialer
argument_list|,
operator|&
name|sdial
argument_list|)
condition|)
name|printf
argument_list|(
literal|"   *** No dialer %s\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdialer
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"   Dialer %s\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|smodem
operator|.
name|zdialer
argument_list|)
expr_stmt|;
name|ukshow_dialer
argument_list|(
operator|&
name|sdial
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|char
modifier|*
name|z
decl_stmt|,
modifier|*
name|zdialer
decl_stmt|;
name|printf
argument_list|(
literal|"   Dialer sequence %s\n"
argument_list|,
name|zc
argument_list|)
expr_stmt|;
name|z
operator|=
operator|(
name|char
operator|*
operator|)
name|alloca
argument_list|(
name|strlen
argument_list|(
name|zc
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|z
argument_list|,
name|zc
argument_list|)
expr_stmt|;
name|zdialer
operator|=
name|strtok
argument_list|(
name|z
argument_list|,
literal|" \t"
argument_list|)
expr_stmt|;
while|while
condition|(
name|zdialer
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
name|ztoken
decl_stmt|;
if|if
condition|(
operator|!
name|fread_dialer_info
argument_list|(
name|zdialer
argument_list|,
operator|&
name|sdial
argument_list|)
condition|)
name|printf
argument_list|(
literal|"   *** No dialer %s\n"
argument_list|,
name|zdialer
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"   Dialer %s\n"
argument_list|,
name|zdialer
argument_list|)
expr_stmt|;
name|ukshow_dialer
argument_list|(
operator|&
name|sdial
argument_list|)
expr_stmt|;
block|}
name|ztoken
operator|=
name|strtok
argument_list|(
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|" \t"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ztoken
operator|==
name|NULL
condition|)
name|zdialer
operator|=
name|NULL
expr_stmt|;
else|else
name|zdialer
operator|=
name|strtok
argument_list|(
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|" \t"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
name|printf
argument_list|(
literal|"   *** No dialer information\n"
argument_list|)
expr_stmt|;
break|break;
if|#
directive|if
name|HAVE_TCP
case|case
name|PORTTYPE_TCP
case|:
name|printf
argument_list|(
literal|"   Port type tcp\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"   TCP service %s\n"
argument_list|,
name|qport
operator|->
name|u
operator|.
name|stcp
operator|.
name|zport
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* HAVE_TCP */
default|default:
name|printf
argument_list|(
literal|"   CAN'T HAPPEN\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|qport
operator|->
name|zprotocols
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"   Will use protocols %s\n"
argument_list|,
name|qport
operator|->
name|zprotocols
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|cproto_params
operator|!=
literal|0
condition|)
name|ukshow_proto_params
argument_list|(
name|qport
operator|->
name|cproto_params
argument_list|,
name|qport
operator|->
name|qproto_params
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|/* Return FALSE to force ffind_port to continue searching.  */
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* Show information about a dialer.  */
end_comment

begin_function
specifier|static
name|void
name|ukshow_dialer
parameter_list|(
name|q
parameter_list|)
name|struct
name|sdialer
modifier|*
name|q
decl_stmt|;
block|{
name|ukshow_chat
argument_list|(
operator|&
name|q
operator|->
name|schat
argument_list|,
literal|"    Chat"
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|zdialtone
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"    Wait for dialtone %s\n"
argument_list|,
name|q
operator|->
name|zdialtone
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|zpause
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"    Pause while dialing %s\n"
argument_list|,
name|q
operator|->
name|zpause
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    Carrier %savailable\n"
argument_list|,
name|q
operator|->
name|fcarrier
condition|?
literal|""
else|:
literal|"not "
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|fcarrier
condition|)
name|printf
argument_list|(
literal|"    Wait %d seconds for carrier\n"
argument_list|,
name|q
operator|->
name|ccarrier_wait
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|fdtr_toggle
condition|)
block|{
name|printf
argument_list|(
literal|"    Toggle DTR"
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|fdtr_toggle_wait
condition|)
name|printf
argument_list|(
literal|" and wait"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|ukshow_chat
argument_list|(
operator|&
name|q
operator|->
name|scomplete
argument_list|,
literal|"    When complete chat"
argument_list|)
expr_stmt|;
name|ukshow_chat
argument_list|(
operator|&
name|q
operator|->
name|sabort
argument_list|,
literal|"    When aborting chat"
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|cproto_params
operator|!=
literal|0
condition|)
name|ukshow_proto_params
argument_list|(
name|q
operator|->
name|cproto_params
argument_list|,
name|q
operator|->
name|qproto_params
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Show a chat script.  */
end_comment

begin_function
specifier|static
name|void
name|ukshow_chat
parameter_list|(
name|qchat
parameter_list|,
name|zhdr
parameter_list|)
specifier|const
name|struct
name|schat_info
modifier|*
name|qchat
decl_stmt|;
specifier|const
name|char
modifier|*
name|zhdr
decl_stmt|;
block|{
if|if
condition|(
name|qchat
operator|->
name|zprogram
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"%s program %s\n"
argument_list|,
name|zhdr
argument_list|,
name|qchat
operator|->
name|zprogram
argument_list|)
expr_stmt|;
if|if
condition|(
name|qchat
operator|->
name|zchat
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"%s script %s\n"
argument_list|,
name|zhdr
argument_list|,
name|qchat
operator|->
name|zchat
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s script timeout %d\n"
argument_list|,
name|zhdr
argument_list|,
name|qchat
operator|->
name|ctimeout
argument_list|)
expr_stmt|;
if|if
condition|(
name|qchat
operator|->
name|zfail
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"%s failure strings %s\n"
argument_list|,
name|zhdr
argument_list|,
name|qchat
operator|->
name|zfail
argument_list|)
expr_stmt|;
if|if
condition|(
name|qchat
operator|->
name|fstrip
condition|)
name|printf
argument_list|(
literal|"%s script incoming bytes stripped to seven bits\n"
argument_list|,
name|zhdr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Show a size/time restriction.  */
end_comment

begin_function
specifier|static
name|void
name|ukshow_size
parameter_list|(
name|zstring
parameter_list|,
name|fcall
parameter_list|,
name|flocal
parameter_list|)
specifier|const
name|char
modifier|*
name|zstring
decl_stmt|;
name|boolean
name|fcall
decl_stmt|;
name|boolean
name|flocal
decl_stmt|;
block|{
name|struct
name|sspan
modifier|*
name|qspan
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|boolean
name|fother
decl_stmt|;
name|qspan
operator|=
name|qcompress_span
argument_list|(
name|qtimesize_parse
argument_list|(
name|zstring
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|qspan
operator|==
name|NULL
condition|)
return|return;
name|printf
argument_list|(
literal|" If call%s the following applies to a %s request:\n"
argument_list|,
name|fcall
condition|?
literal|"ing"
else|:
literal|"ed"
argument_list|,
name|flocal
condition|?
literal|"local"
else|:
literal|"remote"
argument_list|)
expr_stmt|;
name|fother
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|qspan
operator|->
name|istart
operator|>=
literal|60
condition|)
name|fother
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|q
operator|=
name|qspan
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|qnext
control|)
block|{
name|printf
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|ukshow_time
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" may transfer files %ld bytes or smaller\n"
argument_list|,
name|q
operator|->
name|ival
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|qnext
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|iend
operator|<=
literal|6
operator|*
literal|24
operator|*
literal|60
operator|+
literal|23
operator|*
literal|60
condition|)
name|fother
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|q
operator|->
name|iend
operator|+
literal|60
operator|<=
name|q
operator|->
name|qnext
operator|->
name|istart
condition|)
name|fother
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|fother
condition|)
name|printf
argument_list|(
literal|"  (At other times may send files of any size)\n"
argument_list|)
expr_stmt|;
name|utimespan_free
argument_list|(
name|qspan
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Show protocol parameters.  */
end_comment

begin_function
specifier|static
name|void
name|ukshow_proto_params
parameter_list|(
name|c
parameter_list|,
name|pas
parameter_list|,
name|cindent
parameter_list|)
name|int
name|c
decl_stmt|;
name|struct
name|sproto_param
modifier|*
name|pas
decl_stmt|;
name|int
name|cindent
decl_stmt|;
block|{
name|int
name|ip
decl_stmt|;
for|for
control|(
name|ip
operator|=
literal|0
init|;
name|ip
operator|<
name|c
condition|;
name|ip
operator|++
control|)
block|{
name|int
name|ie
decl_stmt|,
name|isp
decl_stmt|;
for|for
control|(
name|isp
operator|=
literal|0
init|;
name|isp
operator|<
name|cindent
condition|;
name|isp
operator|++
control|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"For protocol %c will use the following parameters\n"
argument_list|,
name|pas
index|[
name|ip
index|]
operator|.
name|bproto
argument_list|)
expr_stmt|;
for|for
control|(
name|ie
operator|=
literal|0
init|;
name|ie
operator|<
name|pas
index|[
name|ip
index|]
operator|.
name|centries
condition|;
name|ie
operator|++
control|)
block|{
name|int
name|ia
decl_stmt|;
name|struct
name|sproto_param_entry
modifier|*
name|qe
decl_stmt|;
name|qe
operator|=
operator|&
name|pas
index|[
name|ip
index|]
operator|.
name|qentries
index|[
name|ie
index|]
expr_stmt|;
for|for
control|(
name|isp
operator|=
literal|0
init|;
name|isp
operator|<
name|cindent
condition|;
name|isp
operator|++
control|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
for|for
control|(
name|ia
operator|=
literal|0
init|;
name|ia
operator|<
name|qe
operator|->
name|cargs
condition|;
name|ia
operator|++
control|)
name|printf
argument_list|(
literal|" %s"
argument_list|,
name|qe
operator|->
name|azargs
index|[
name|ia
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Display a time span.  */
end_comment

begin_function
specifier|static
name|void
name|ukshow_time
parameter_list|(
name|q
parameter_list|)
specifier|const
name|struct
name|sspan
modifier|*
name|q
decl_stmt|;
block|{
name|int
name|idaystart
decl_stmt|,
name|idayend
decl_stmt|;
name|int
name|ihourstart
decl_stmt|,
name|ihourend
decl_stmt|;
name|int
name|iminutestart
decl_stmt|,
name|iminuteend
decl_stmt|;
specifier|const
name|char
modifier|*
specifier|const
name|zdays
init|=
literal|"Sun\0Mon\0Tue\0Wed\0Thu\0Fri\0Sat\0Sun"
decl_stmt|;
if|if
condition|(
name|q
operator|->
name|istart
operator|==
literal|0
operator|&&
name|q
operator|->
name|iend
operator|==
literal|7
operator|*
literal|24
operator|*
literal|60
condition|)
block|{
name|printf
argument_list|(
literal|"At any time"
argument_list|)
expr_stmt|;
return|return;
block|}
name|idaystart
operator|=
name|q
operator|->
name|istart
operator|/
operator|(
literal|24
operator|*
literal|60
operator|)
expr_stmt|;
name|ihourstart
operator|=
operator|(
name|q
operator|->
name|istart
operator|%
operator|(
literal|24
operator|*
literal|60
operator|)
operator|)
operator|/
literal|60
expr_stmt|;
name|iminutestart
operator|=
name|q
operator|->
name|istart
operator|%
literal|60
expr_stmt|;
name|idayend
operator|=
name|q
operator|->
name|iend
operator|/
operator|(
literal|24
operator|*
literal|60
operator|)
expr_stmt|;
name|ihourend
operator|=
operator|(
name|q
operator|->
name|iend
operator|%
operator|(
literal|24
operator|*
literal|60
operator|)
operator|)
operator|/
literal|60
expr_stmt|;
name|iminuteend
operator|=
name|q
operator|->
name|iend
operator|%
literal|60
expr_stmt|;
if|if
condition|(
name|idaystart
operator|==
name|idayend
condition|)
name|printf
argument_list|(
literal|"%s from %02d:%02d to %02d:%02d"
argument_list|,
name|zdays
operator|+
name|idaystart
operator|*
literal|4
argument_list|,
name|ihourstart
argument_list|,
name|iminutestart
argument_list|,
name|ihourend
argument_list|,
name|iminuteend
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"From %s %02d:%02d to %s %02d:%02d"
argument_list|,
name|zdays
operator|+
name|idaystart
operator|*
literal|4
argument_list|,
name|ihourstart
argument_list|,
name|iminutestart
argument_list|,
name|zdays
operator|+
name|idayend
operator|*
literal|4
argument_list|,
name|ihourend
argument_list|,
name|iminuteend
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Compress a time span by merging any two adjacent spans with    identical values.  This isn't necessary for uucico, but it looks    nicer when printed out.  */
end_comment

begin_function
specifier|static
name|struct
name|sspan
modifier|*
name|qcompress_span
parameter_list|(
name|qlist
parameter_list|)
name|struct
name|sspan
modifier|*
name|qlist
decl_stmt|;
block|{
name|struct
name|sspan
modifier|*
modifier|*
name|pq
decl_stmt|;
name|pq
operator|=
operator|&
name|qlist
expr_stmt|;
while|while
condition|(
operator|*
name|pq
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|pq
operator|)
operator|->
name|qnext
operator|!=
name|NULL
operator|&&
operator|(
operator|*
name|pq
operator|)
operator|->
name|iend
operator|==
operator|(
operator|*
name|pq
operator|)
operator|->
name|qnext
operator|->
name|istart
operator|&&
operator|(
operator|*
name|pq
operator|)
operator|->
name|ival
operator|==
operator|(
operator|*
name|pq
operator|)
operator|->
name|qnext
operator|->
name|ival
condition|)
block|{
name|struct
name|sspan
modifier|*
name|qfree
decl_stmt|;
name|qfree
operator|=
operator|(
operator|*
name|pq
operator|)
operator|->
name|qnext
expr_stmt|;
operator|(
operator|*
name|pq
operator|)
operator|->
name|qnext
operator|=
name|qfree
operator|->
name|qnext
expr_stmt|;
operator|(
operator|*
name|pq
operator|)
operator|->
name|iend
operator|=
name|qfree
operator|->
name|iend
expr_stmt|;
name|xfree
argument_list|(
operator|(
name|pointer
operator|)
name|qfree
argument_list|)
expr_stmt|;
block|}
else|else
name|pq
operator|=
operator|&
operator|(
operator|*
name|pq
operator|)
operator|->
name|qnext
expr_stmt|;
block|}
return|return
name|qlist
return|;
block|}
end_function

end_unit

