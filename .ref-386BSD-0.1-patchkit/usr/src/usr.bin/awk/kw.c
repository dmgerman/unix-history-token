begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************** kw.c copyright 1991, Michael D. Brennan  This is a source file for mawk, an implementation of the AWK programming language.  Mawk is distributed without warranty under the terms of the GNU General Public License, version 2, 1991. ********************************************/
end_comment

begin_comment
comment|/* $Log:	kw.c,v $  * Revision 5.1  91/12/05  07:56:12  brennan  * 1.1 pre-release  *  */
end_comment

begin_comment
comment|/* kw.c */
end_comment

begin_include
include|#
directive|include
file|"mawk.h"
end_include

begin_include
include|#
directive|include
file|"symtype.h"
end_include

begin_include
include|#
directive|include
file|"parse.h"
end_include

begin_include
include|#
directive|include
file|"init.h"
end_include

begin_struct
specifier|static
struct|struct
name|kw
block|{
name|char
modifier|*
name|text
decl_stmt|;
name|short
name|kw
decl_stmt|;
block|}
name|keywords
index|[]
init|=
block|{
literal|"print"
block|,
name|PRINT
block|,
literal|"printf"
block|,
name|PRINTF
block|,
literal|"do"
block|,
name|DO
block|,
literal|"while"
block|,
name|WHILE
block|,
literal|"for"
block|,
name|FOR
block|,
literal|"break"
block|,
name|BREAK
block|,
literal|"continue"
block|,
name|CONTINUE
block|,
literal|"if"
block|,
name|IF
block|,
literal|"else"
block|,
name|ELSE
block|,
literal|"in"
block|,
name|IN
block|,
literal|"delete"
block|,
name|DELETE
block|,
literal|"split"
block|,
name|SPLIT
block|,
literal|"match"
block|,
name|MATCH_FUNC
block|,
literal|"BEGIN"
block|,
name|BEGIN
block|,
literal|"END"
block|,
name|END
block|,
literal|"exit"
block|,
name|EXIT
block|,
literal|"next"
block|,
name|NEXT
block|,
literal|"return"
block|,
name|RETURN
block|,
literal|"getline"
block|,
name|GETLINE
block|,
literal|"sub"
block|,
name|SUB
block|,
literal|"gsub"
block|,
name|GSUB
block|,
literal|"function"
block|,
name|FUNCTION
block|,
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
struct|;
end_struct

begin_comment
comment|/* put keywords in the symbol table */
end_comment

begin_function
name|void
name|kw_init
parameter_list|()
block|{
specifier|register
name|struct
name|kw
modifier|*
name|p
init|=
name|keywords
decl_stmt|;
specifier|register
name|SYMTAB
modifier|*
name|q
decl_stmt|;
while|while
condition|(
name|p
operator|->
name|text
condition|)
block|{
name|q
operator|=
name|insert
argument_list|(
name|p
operator|->
name|text
argument_list|)
expr_stmt|;
name|q
operator|->
name|type
operator|=
name|ST_KEYWORD
expr_stmt|;
name|q
operator|->
name|stval
operator|.
name|kw
operator|=
name|p
operator|++
operator|->
name|kw
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* find a keyword to emit an error message */
end_comment

begin_function
name|char
modifier|*
name|find_kw_str
parameter_list|(
name|kw_token
parameter_list|)
name|int
name|kw_token
decl_stmt|;
block|{
name|struct
name|kw
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|keywords
init|;
name|p
operator|->
name|text
condition|;
name|p
operator|++
control|)
if|if
condition|(
name|p
operator|->
name|kw
operator|==
name|kw_token
condition|)
return|return
name|p
operator|->
name|text
return|;
comment|/* search failed */
return|return
operator|(
name|char
operator|*
operator|)
literal|0
return|;
block|}
end_function

end_unit

