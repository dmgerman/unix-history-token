begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************** rexpdb.c copyright 1991, Michael D. Brennan  This is a source file for mawk, an implementation of the AWK programming language.  Mawk is distributed without warranty under the terms of the GNU General Public License, version 2, 1991. ********************************************/
end_comment

begin_comment
comment|/*$Log:	rexpdb.c,v $  * Revision 3.2  91/08/13  09:10:09  brennan  * VERSION .9994  *   * Revision 3.1  91/06/07  10:33:30  brennan  * VERSION 0.995  *  */
end_comment

begin_include
include|#
directive|include
file|"rexp.h"
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_comment
comment|/*  print a machine for debugging  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|xlat
index|[]
init|=
block|{
literal|"M_STR"
block|,
literal|"M_CLASS"
block|,
literal|"M_ANY"
block|,
literal|"M_START"
block|,
literal|"M_END"
block|,
literal|"M_U"
block|,
literal|"M_1J"
block|,
literal|"M_2JA"
block|,
literal|"M_2JB"
block|,
literal|"M_ACCEPT"
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|REmprint
parameter_list|(
name|m
parameter_list|,
name|f
parameter_list|)
name|VOID
modifier|*
name|m
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|;
block|{
specifier|register
name|STATE
modifier|*
name|p
init|=
operator|(
name|STATE
operator|*
operator|)
name|m
decl_stmt|;
name|char
modifier|*
name|end_on_string
decl_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|p
operator|->
name|type
operator|>=
name|END_ON
condition|)
block|{
name|p
operator|->
name|type
operator|-=
name|END_ON
expr_stmt|;
name|end_on_string
operator|=
literal|"$"
expr_stmt|;
block|}
else|else
name|end_on_string
operator|=
literal|""
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|type
operator|<
literal|0
operator|||
name|p
operator|->
name|type
operator|>=
name|END_ON
condition|)
block|{
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"unknown STATE type\n"
argument_list|)
expr_stmt|;
return|return ;
block|}
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%-10s"
argument_list|,
name|xlat
index|[
name|p
operator|->
name|type
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|p
operator|->
name|type
condition|)
block|{
case|case
name|M_STR
case|:
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s"
argument_list|,
name|p
operator|->
name|data
operator|.
name|str
argument_list|)
expr_stmt|;
break|break ;
case|case
name|M_1J
case|:
case|case
name|M_2JA
case|:
case|case
name|M_2JB
case|:
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%d"
argument_list|,
name|p
operator|->
name|data
operator|.
name|jump
argument_list|)
expr_stmt|;
break|break ;
case|case
name|M_CLASS
case|:
block|{
name|unsigned
name|char
modifier|*
name|q
init|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|p
operator|->
name|data
operator|.
name|bvp
decl_stmt|;
name|unsigned
name|char
modifier|*
name|r
init|=
name|q
operator|+
sizeof|sizeof
argument_list|(
name|BV
argument_list|)
decl_stmt|;
while|while
condition|(
name|q
operator|<
name|r
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%x "
argument_list|,
operator|*
name|q
operator|++
argument_list|)
expr_stmt|;
block|}
break|break ;
block|}
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s\n"
argument_list|,
name|end_on_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|end_on_string
index|[
literal|0
index|]
condition|)
name|p
operator|->
name|type
operator|+=
name|END_ON
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|type
operator|==
name|M_ACCEPT
condition|)
return|return ;
name|p
operator|++
expr_stmt|;
block|}
block|}
end_function

end_unit

