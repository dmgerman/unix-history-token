begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD support to byte-swap a symbol table in MIPS (Third-Eye, `ecoff') format.    Copyright 1992 Free Software Foundation, Inc.  This file is part of BFD, the Binary File Descriptor library.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_comment
comment|/* These routines are not yet called from BFD.  They are called from    the MIPS symbol reading code in GDB.  However, they are in the BFD    library because they will eventually be useful if and when BFD    supports reading or writing of MIPS symbol tables.     The routines in this file convert the external representation of    ECOFF symbol tables to the internal (usual struct) representation.    On a machine with the same byte-order and the same basic type    sizes and alignments as a MIPS machine, this is a no-op.      If the symbol TEST is defined when this file is compiled, a comparison    is made to ensure that, in fact, the output is bit-for-bit the same as    the input.  Of course, this symbol should only be defined when    deliberately testing the code on a machine with the proper byte sex    and such.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"coff/sym.h"
end_include

begin_comment
comment|/* MIPS symbols */
end_comment

begin_include
include|#
directive|include
file|"coff/symconst.h"
end_include

begin_comment
comment|/* MIPS symbols */
end_comment

begin_include
include|#
directive|include
file|"coff/ecoff-ext.h"
end_include

begin_comment
comment|/* ECOFF external struct defns */
end_comment

begin_function
name|void
name|ecoff_swap_hdr_in
parameter_list|(
name|abfd
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|hdr_ext
modifier|*
name|ext_copy
decl_stmt|;
name|HDRR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|hdr_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
name|intern
operator|->
name|magic
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_magic
argument_list|)
expr_stmt|;
name|intern
operator|->
name|vstamp
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_vstamp
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ilineMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_ilineMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbLine
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbLine
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbLineOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbLineOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|idnMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_idnMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbDnOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbDnOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ipdMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_ipdMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbPdOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbPdOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|isymMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_isymMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbSymOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbSymOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ioptMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_ioptMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbOptOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbOptOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|iauxMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_iauxMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbAuxOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbAuxOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|issMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_issMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbSsOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbSsOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|issExtMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_issExtMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbSsExtOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbSsExtOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ifdMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_ifdMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbFdOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbFdOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|crfd
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_crfd
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbRfdOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbRfdOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|iextMax
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_iextMax
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbExtOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|h_cbExtOffset
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in the file descriptor record.  */
end_comment

begin_function
name|void
name|ecoff_swap_fdr_in
parameter_list|(
name|abfd
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|fdr_ext
modifier|*
name|ext_copy
decl_stmt|;
name|FDR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|fdr_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
comment|/* Make it reasonable to do in-place.  */
name|intern
operator|->
name|adr
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_adr
argument_list|)
expr_stmt|;
name|intern
operator|->
name|rss
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_rss
argument_list|)
expr_stmt|;
name|intern
operator|->
name|issBase
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_issBase
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbSs
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_cbSs
argument_list|)
expr_stmt|;
name|intern
operator|->
name|isymBase
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_isymBase
argument_list|)
expr_stmt|;
name|intern
operator|->
name|csym
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_csym
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ilineBase
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_ilineBase
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cline
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_cline
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ioptBase
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_ioptBase
argument_list|)
expr_stmt|;
name|intern
operator|->
name|copt
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_copt
argument_list|)
expr_stmt|;
name|intern
operator|->
name|ipdFirst
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_ipdFirst
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cpd
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_cpd
argument_list|)
expr_stmt|;
name|intern
operator|->
name|iauxBase
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_iauxBase
argument_list|)
expr_stmt|;
name|intern
operator|->
name|caux
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_caux
argument_list|)
expr_stmt|;
name|intern
operator|->
name|rfdBase
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_rfdBase
argument_list|)
expr_stmt|;
name|intern
operator|->
name|crfd
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_crfd
argument_list|)
expr_stmt|;
comment|/* now the fun stuff... */
if|if
condition|(
name|abfd
operator|->
name|xvec
operator|->
name|header_byteorder_big_p
operator|!=
name|false
condition|)
block|{
name|intern
operator|->
name|lang
operator|=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_LANG_BIG
operator|)
operator|>>
name|FDR_BITS1_LANG_SH_BIG
expr_stmt|;
name|intern
operator|->
name|fMerge
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_FMERGE_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|fReadin
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_FREADIN_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|fBigendian
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_FBIGENDIAN_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|glevel
operator|=
operator|(
name|ext
operator|->
name|f_bits2
index|[
literal|0
index|]
operator|&
name|FDR_BITS2_GLEVEL_BIG
operator|)
operator|>>
name|FDR_BITS2_GLEVEL_SH_BIG
expr_stmt|;
comment|/* intern->reserved  we ignore.  */
block|}
else|else
block|{
name|intern
operator|->
name|lang
operator|=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_LANG_LITTLE
operator|)
operator|>>
name|FDR_BITS1_LANG_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|fMerge
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_FMERGE_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|fReadin
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_FREADIN_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|fBigendian
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|f_bits1
index|[
literal|0
index|]
operator|&
name|FDR_BITS1_FBIGENDIAN_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|glevel
operator|=
operator|(
name|ext
operator|->
name|f_bits2
index|[
literal|0
index|]
operator|&
name|FDR_BITS2_GLEVEL_LITTLE
operator|)
operator|>>
name|FDR_BITS2_GLEVEL_SH_LITTLE
expr_stmt|;
comment|/* intern->reserved  we ignore.  */
block|}
name|intern
operator|->
name|cbLineOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_cbLineOffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbLine
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|f_cbLine
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in the procedure descriptor record.  */
end_comment

begin_function
name|void
name|ecoff_swap_pdr_in
parameter_list|(
name|abfd
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|pdr_ext
modifier|*
name|ext_copy
decl_stmt|;
name|PDR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|pdr_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
comment|/* Make it reasonable to do in-place.  */
name|intern
operator|->
name|adr
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_adr
argument_list|)
expr_stmt|;
name|intern
operator|->
name|isym
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_isym
argument_list|)
expr_stmt|;
name|intern
operator|->
name|iline
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_iline
argument_list|)
expr_stmt|;
name|intern
operator|->
name|regmask
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_regmask
argument_list|)
expr_stmt|;
name|intern
operator|->
name|regoffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_regoffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|iopt
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_iopt
argument_list|)
expr_stmt|;
name|intern
operator|->
name|fregmask
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_fregmask
argument_list|)
expr_stmt|;
name|intern
operator|->
name|fregoffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_fregoffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|frameoffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_frameoffset
argument_list|)
expr_stmt|;
name|intern
operator|->
name|framereg
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_framereg
argument_list|)
expr_stmt|;
name|intern
operator|->
name|pcreg
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_pcreg
argument_list|)
expr_stmt|;
name|intern
operator|->
name|lnLow
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_lnLow
argument_list|)
expr_stmt|;
name|intern
operator|->
name|lnHigh
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_lnHigh
argument_list|)
expr_stmt|;
name|intern
operator|->
name|cbLineOffset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|p_cbLineOffset
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in a symbol record.  */
end_comment

begin_function
name|void
name|ecoff_swap_sym_in
parameter_list|(
name|abfd
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|sym_ext
modifier|*
name|ext_copy
decl_stmt|;
name|SYMR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|sym_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
comment|/* Make it reasonable to do in-place.  */
name|intern
operator|->
name|iss
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|s_iss
argument_list|)
expr_stmt|;
name|intern
operator|->
name|value
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|s_value
argument_list|)
expr_stmt|;
comment|/* now the fun stuff... */
if|if
condition|(
name|abfd
operator|->
name|xvec
operator|->
name|header_byteorder_big_p
operator|!=
name|false
condition|)
block|{
name|intern
operator|->
name|st
operator|=
operator|(
name|ext
operator|->
name|s_bits1
index|[
literal|0
index|]
operator|&
name|SYM_BITS1_ST_BIG
operator|)
operator|>>
name|SYM_BITS1_ST_SH_BIG
expr_stmt|;
name|intern
operator|->
name|sc
operator|=
operator|(
operator|(
name|ext
operator|->
name|s_bits1
index|[
literal|0
index|]
operator|&
name|SYM_BITS1_SC_BIG
operator|)
operator|<<
name|SYM_BITS1_SC_SH_LEFT_BIG
operator|)
operator||
operator|(
operator|(
name|ext
operator|->
name|s_bits2
index|[
literal|0
index|]
operator|&
name|SYM_BITS2_SC_BIG
operator|)
operator|>>
name|SYM_BITS2_SC_SH_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|reserved
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|s_bits2
index|[
literal|0
index|]
operator|&
name|SYM_BITS2_RESERVED_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|index
operator|=
operator|(
operator|(
name|ext
operator|->
name|s_bits2
index|[
literal|0
index|]
operator|&
name|SYM_BITS2_INDEX_BIG
operator|)
operator|<<
name|SYM_BITS2_INDEX_SH_LEFT_BIG
operator|)
operator||
operator|(
name|ext
operator|->
name|s_bits3
index|[
literal|0
index|]
operator|<<
name|SYM_BITS3_INDEX_SH_LEFT_BIG
operator|)
operator||
operator|(
name|ext
operator|->
name|s_bits4
index|[
literal|0
index|]
operator|<<
name|SYM_BITS4_INDEX_SH_LEFT_BIG
operator|)
expr_stmt|;
block|}
else|else
block|{
name|intern
operator|->
name|st
operator|=
operator|(
name|ext
operator|->
name|s_bits1
index|[
literal|0
index|]
operator|&
name|SYM_BITS1_ST_LITTLE
operator|)
operator|>>
name|SYM_BITS1_ST_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|sc
operator|=
operator|(
operator|(
name|ext
operator|->
name|s_bits1
index|[
literal|0
index|]
operator|&
name|SYM_BITS1_SC_LITTLE
operator|)
operator|>>
name|SYM_BITS1_SC_SH_LITTLE
operator|)
operator||
operator|(
operator|(
name|ext
operator|->
name|s_bits2
index|[
literal|0
index|]
operator|&
name|SYM_BITS2_SC_LITTLE
operator|)
operator|<<
name|SYM_BITS2_SC_SH_LEFT_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|reserved
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|s_bits2
index|[
literal|0
index|]
operator|&
name|SYM_BITS2_RESERVED_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|index
operator|=
operator|(
operator|(
name|ext
operator|->
name|s_bits2
index|[
literal|0
index|]
operator|&
name|SYM_BITS2_INDEX_LITTLE
operator|)
operator|>>
name|SYM_BITS2_INDEX_SH_LITTLE
operator|)
operator||
operator|(
name|ext
operator|->
name|s_bits3
index|[
literal|0
index|]
operator|<<
name|SYM_BITS3_INDEX_SH_LEFT_LITTLE
operator|)
operator||
operator|(
name|ext
operator|->
name|s_bits4
index|[
literal|0
index|]
operator|<<
name|SYM_BITS4_INDEX_SH_LEFT_LITTLE
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in an external symbol record.  */
end_comment

begin_function
name|void
name|ecoff_swap_ext_in
parameter_list|(
name|abfd
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|ext_ext
modifier|*
name|ext_copy
decl_stmt|;
name|EXTR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|ext_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
comment|/* Make it reasonable to do in-place.  */
comment|/* now the fun stuff... */
if|if
condition|(
name|abfd
operator|->
name|xvec
operator|->
name|header_byteorder_big_p
operator|!=
name|false
condition|)
block|{
name|intern
operator|->
name|jmptbl
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|es_bits1
index|[
literal|0
index|]
operator|&
name|EXT_BITS1_JMPTBL_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|cobol_main
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|es_bits1
index|[
literal|0
index|]
operator|&
name|EXT_BITS1_COBOL_MAIN_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|weakext
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|es_bits1
index|[
literal|0
index|]
operator|&
name|EXT_BITS1_WEAKEXT_BIG
operator|)
expr_stmt|;
block|}
else|else
block|{
name|intern
operator|->
name|jmptbl
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|es_bits1
index|[
literal|0
index|]
operator|&
name|EXT_BITS1_JMPTBL_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|cobol_main
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|es_bits1
index|[
literal|0
index|]
operator|&
name|EXT_BITS1_COBOL_MAIN_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|weakext
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|es_bits1
index|[
literal|0
index|]
operator|&
name|EXT_BITS1_WEAKEXT_LITTLE
operator|)
expr_stmt|;
block|}
name|intern
operator|->
name|ifd
operator|=
name|bfd_h_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|es_ifd
argument_list|)
expr_stmt|;
name|ecoff_swap_sym_in
argument_list|(
name|abfd
argument_list|,
operator|&
name|ext
operator|->
name|es_asym
argument_list|,
operator|&
name|intern
operator|->
name|asym
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in a type information record.    BIGEND says whether AUX symbols are big-endian or little-endian; this    info comes from the file header record (fh-fBigendian).  */
end_comment

begin_function
name|void
name|ecoff_swap_tir_in
parameter_list|(
name|bigend
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|int
name|bigend
decl_stmt|;
name|struct
name|tir_ext
modifier|*
name|ext_copy
decl_stmt|;
name|TIR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|tir_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
comment|/* Make it reasonable to do in-place.  */
comment|/* now the fun stuff... */
if|if
condition|(
name|bigend
condition|)
block|{
name|intern
operator|->
name|fBitfield
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|t_bits1
index|[
literal|0
index|]
operator|&
name|TIR_BITS1_FBITFIELD_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|continued
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|t_bits1
index|[
literal|0
index|]
operator|&
name|TIR_BITS1_CONTINUED_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|bt
operator|=
operator|(
name|ext
operator|->
name|t_bits1
index|[
literal|0
index|]
operator|&
name|TIR_BITS1_BT_BIG
operator|)
operator|>>
name|TIR_BITS1_BT_SH_BIG
expr_stmt|;
name|intern
operator|->
name|tq4
operator|=
operator|(
name|ext
operator|->
name|t_tq45
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ4_BIG
operator|)
operator|>>
name|TIR_BITS_TQ4_SH_BIG
expr_stmt|;
name|intern
operator|->
name|tq5
operator|=
operator|(
name|ext
operator|->
name|t_tq45
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ5_BIG
operator|)
operator|>>
name|TIR_BITS_TQ5_SH_BIG
expr_stmt|;
name|intern
operator|->
name|tq0
operator|=
operator|(
name|ext
operator|->
name|t_tq01
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ0_BIG
operator|)
operator|>>
name|TIR_BITS_TQ0_SH_BIG
expr_stmt|;
name|intern
operator|->
name|tq1
operator|=
operator|(
name|ext
operator|->
name|t_tq01
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ1_BIG
operator|)
operator|>>
name|TIR_BITS_TQ1_SH_BIG
expr_stmt|;
name|intern
operator|->
name|tq2
operator|=
operator|(
name|ext
operator|->
name|t_tq23
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ2_BIG
operator|)
operator|>>
name|TIR_BITS_TQ2_SH_BIG
expr_stmt|;
name|intern
operator|->
name|tq3
operator|=
operator|(
name|ext
operator|->
name|t_tq23
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ3_BIG
operator|)
operator|>>
name|TIR_BITS_TQ3_SH_BIG
expr_stmt|;
block|}
else|else
block|{
name|intern
operator|->
name|fBitfield
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|t_bits1
index|[
literal|0
index|]
operator|&
name|TIR_BITS1_FBITFIELD_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|continued
operator|=
literal|0
operator|!=
operator|(
name|ext
operator|->
name|t_bits1
index|[
literal|0
index|]
operator|&
name|TIR_BITS1_CONTINUED_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|bt
operator|=
operator|(
name|ext
operator|->
name|t_bits1
index|[
literal|0
index|]
operator|&
name|TIR_BITS1_BT_LITTLE
operator|)
operator|>>
name|TIR_BITS1_BT_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|tq4
operator|=
operator|(
name|ext
operator|->
name|t_tq45
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ4_LITTLE
operator|)
operator|>>
name|TIR_BITS_TQ4_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|tq5
operator|=
operator|(
name|ext
operator|->
name|t_tq45
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ5_LITTLE
operator|)
operator|>>
name|TIR_BITS_TQ5_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|tq0
operator|=
operator|(
name|ext
operator|->
name|t_tq01
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ0_LITTLE
operator|)
operator|>>
name|TIR_BITS_TQ0_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|tq1
operator|=
operator|(
name|ext
operator|->
name|t_tq01
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ1_LITTLE
operator|)
operator|>>
name|TIR_BITS_TQ1_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|tq2
operator|=
operator|(
name|ext
operator|->
name|t_tq23
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ2_LITTLE
operator|)
operator|>>
name|TIR_BITS_TQ2_SH_LITTLE
expr_stmt|;
name|intern
operator|->
name|tq3
operator|=
operator|(
name|ext
operator|->
name|t_tq23
index|[
literal|0
index|]
operator|&
name|TIR_BITS_TQ3_LITTLE
operator|)
operator|>>
name|TIR_BITS_TQ3_SH_LITTLE
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in a relative symbol record.  BIGEND says whether it is in    big-endian or little-endian format.*/
end_comment

begin_function
name|void
name|ecoff_swap_rndx_in
parameter_list|(
name|bigend
parameter_list|,
name|ext_copy
parameter_list|,
name|intern
parameter_list|)
name|int
name|bigend
decl_stmt|;
name|struct
name|rndx_ext
modifier|*
name|ext_copy
decl_stmt|;
name|RNDXR
modifier|*
name|intern
decl_stmt|;
block|{
name|struct
name|rndx_ext
name|ext
index|[
literal|1
index|]
decl_stmt|;
operator|*
name|ext
operator|=
operator|*
name|ext_copy
expr_stmt|;
comment|/* Make it reasonable to do in-place.  */
comment|/* now the fun stuff... */
if|if
condition|(
name|bigend
condition|)
block|{
name|intern
operator|->
name|rfd
operator|=
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|0
index|]
operator|<<
name|RNDX_BITS0_RFD_SH_LEFT_BIG
operator|)
operator||
operator|(
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|1
index|]
operator|&
name|RNDX_BITS1_RFD_BIG
operator|)
operator|>>
name|RNDX_BITS1_RFD_SH_BIG
operator|)
expr_stmt|;
name|intern
operator|->
name|index
operator|=
operator|(
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|1
index|]
operator|&
name|RNDX_BITS1_INDEX_BIG
operator|)
operator|<<
name|RNDX_BITS1_INDEX_SH_LEFT_BIG
operator|)
operator||
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|2
index|]
operator|<<
name|RNDX_BITS2_INDEX_SH_LEFT_BIG
operator|)
operator||
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|3
index|]
operator|<<
name|RNDX_BITS3_INDEX_SH_LEFT_BIG
operator|)
expr_stmt|;
block|}
else|else
block|{
name|intern
operator|->
name|rfd
operator|=
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|0
index|]
operator|<<
name|RNDX_BITS0_RFD_SH_LEFT_LITTLE
operator|)
operator||
operator|(
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|1
index|]
operator|&
name|RNDX_BITS1_RFD_LITTLE
operator|)
operator|<<
name|RNDX_BITS1_RFD_SH_LEFT_LITTLE
operator|)
expr_stmt|;
name|intern
operator|->
name|index
operator|=
operator|(
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|1
index|]
operator|&
name|RNDX_BITS1_INDEX_LITTLE
operator|)
operator|>>
name|RNDX_BITS1_INDEX_SH_LITTLE
operator|)
operator||
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|2
index|]
operator|<<
name|RNDX_BITS2_INDEX_SH_LEFT_LITTLE
operator|)
operator||
operator|(
name|ext
operator|->
name|r_bits
index|[
literal|3
index|]
operator|<<
name|RNDX_BITS3_INDEX_SH_LEFT_LITTLE
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Swap in a relative file descriptor.  */
end_comment

begin_function
name|void
name|ecoff_swap_rfd_in
parameter_list|(
name|abfd
parameter_list|,
name|ext
parameter_list|,
name|intern
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|rfd_ext
modifier|*
name|ext
decl_stmt|;
name|RFDT
modifier|*
name|intern
decl_stmt|;
block|{
operator|*
name|intern
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|ext
operator|->
name|rfd
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TEST
if|if
condition|(
name|memcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intern
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|intern
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
end_function

end_unit

