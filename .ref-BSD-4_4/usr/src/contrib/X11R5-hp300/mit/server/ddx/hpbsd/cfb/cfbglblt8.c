begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Poly glyph blt for 8 bit displays.  Accepts  * an arbitrary font<= 32 bits wide, in Copy mode only.  */
end_comment

begin_comment
comment|/* Copyright 1989 by the Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_comment
comment|/* $XConsortium: cfbglblt8.c,v 5.23 91/07/18 23:44:50 keith Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xmd.h"
end_include

begin_include
include|#
directive|include
file|"Xproto.h"
end_include

begin_include
include|#
directive|include
file|"cfb.h"
end_include

begin_include
include|#
directive|include
file|"fontstruct.h"
end_include

begin_include
include|#
directive|include
file|"dixfontstr.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"regionstr.h"
end_include

begin_include
include|#
directive|include
file|"cfbmskbits.h"
end_include

begin_include
include|#
directive|include
file|"cfb8bit.h"
end_include

begin_define
define|#
directive|define
name|BOX_OVERLAP
parameter_list|(
name|box1
parameter_list|,
name|box2
parameter_list|,
name|xoffset
parameter_list|,
name|yoffset
parameter_list|)
define|\
value|((box1)->x1<= ((int) (box2)->x2 + (xoffset))&& \  	 ((int) (box2)->x1 + (xoffset))<= (box1)->x2&& \ 	 (box1)->y1<= ((int) (box2)->y2 + (yoffset))&& \  	 ((int) (box2)->y1 + (yoffset))<= (box1)->y2)
end_define

begin_define
define|#
directive|define
name|BOX_CONTAINS
parameter_list|(
name|box1
parameter_list|,
name|box2
parameter_list|,
name|xoffset
parameter_list|,
name|yoffset
parameter_list|)
define|\
value|((box1)->x1<= ((int) (box2)->x1 + (xoffset))&& \  	 ((int) (box2)->x2 + (xoffset))<= (box1)->x2&& \ 	 (box1)->y1<= ((int) (box2)->y1 + (yoffset))&& \  	 ((int) (box2)->y2 + (yoffset))<= (box1)->y2)
end_define

begin_if
if|#
directive|if
name|PPW
operator|==
literal|4
end_if

begin_if
if|#
directive|if
name|GLYPHPADBYTES
operator|!=
literal|4
end_if

begin_define
define|#
directive|define
name|USE_LEFTBITS
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|USE_LEFTBITS
end_ifdef

begin_typedef
typedef|typedef
name|unsigned
name|char
modifier|*
name|glyphPointer
typedef|;
end_typedef

begin_decl_stmt
specifier|extern
name|long
name|endtab
index|[]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|GlyphBits
parameter_list|(
name|bits
parameter_list|,
name|width
parameter_list|,
name|dst
parameter_list|)
value|getleftbits(bits,width,dst); \ 					(dst)&= widthMask; \ 					(bits) += widthGlyph;
end_define

begin_define
define|#
directive|define
name|GlyphBitsS
parameter_list|(
name|bits
parameter_list|,
name|width
parameter_list|,
name|dst
parameter_list|,
name|off
parameter_list|)
value|GlyphBits(bits,width,dst); \ 					dst = BitRight (dst, off);
end_define

begin_else
else|#
directive|else
end_else

begin_typedef
typedef|typedef
name|unsigned
name|long
modifier|*
name|glyphPointer
typedef|;
end_typedef

begin_define
define|#
directive|define
name|GlyphBits
parameter_list|(
name|bits
parameter_list|,
name|width
parameter_list|,
name|dst
parameter_list|)
value|dst = *bits++;
end_define

begin_define
define|#
directive|define
name|GlyphBitsS
parameter_list|(
name|bits
parameter_list|,
name|width
parameter_list|,
name|dst
parameter_list|,
name|off
parameter_list|)
value|dst = BitRight(*bits++, off);
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|GLYPHROP
end_ifdef

begin_define
define|#
directive|define
name|cfbPolyGlyphBlt8
value|cfbPolyGlyphRop8
end_define

begin_define
define|#
directive|define
name|cfbPolyGlyphBlt8Clipped
value|cfbPolyGlyphRop8Clipped
end_define

begin_undef
undef|#
directive|undef
name|WriteFourBits
end_undef

begin_define
define|#
directive|define
name|WriteFourBits
parameter_list|(
name|dst
parameter_list|,
name|pixel
parameter_list|,
name|bits
parameter_list|)
value|RRopFourBits(dst,bits)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
specifier|static
name|void
name|cfbPolyGlyphBlt8Clipped
parameter_list|()
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|defined
argument_list|(
name|HAS_STIPPLE_CODE
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|GLYPHROP
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_LEFTBITS
argument_list|)
end_if

begin_define
define|#
directive|define
name|USE_STIPPLE_CODE
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__GNUC__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|GLYPHROP
argument_list|)
operator|&&
operator|(
name|defined
argument_list|(
name|mc68020
argument_list|)
operator|||
name|defined
argument_list|(
name|mc68000
argument_list|)
operator|||
name|defined
argument_list|(
name|__mc68000__
argument_list|)
operator|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_LEFTBITS
argument_list|)
end_if

begin_include
include|#
directive|include
file|<stip68kgnu.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|cfbPolyGlyphBlt8
parameter_list|(
name|pDrawable
parameter_list|,
name|pGC
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|nglyph
parameter_list|,
name|ppci
parameter_list|,
name|pglyphBase
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|int
name|nglyph
decl_stmt|;
name|CharInfoPtr
modifier|*
name|ppci
decl_stmt|;
comment|/* array of character info */
name|unsigned
name|char
modifier|*
name|pglyphBase
decl_stmt|;
comment|/* start of array of glyphs */
block|{
specifier|register
name|unsigned
name|long
name|c
decl_stmt|;
ifndef|#
directive|ifndef
name|GLYPHROP
specifier|register
name|unsigned
name|long
name|pixel
decl_stmt|;
endif|#
directive|endif
specifier|register
name|unsigned
name|long
modifier|*
name|dst
decl_stmt|;
specifier|register
name|glyphPointer
name|glyphBits
decl_stmt|;
specifier|register
name|int
name|xoff
decl_stmt|;
specifier|register
name|int
name|ewTmp
decl_stmt|;
name|FontPtr
name|pfont
init|=
name|pGC
operator|->
name|font
decl_stmt|;
name|CharInfoPtr
name|pci
decl_stmt|;
name|unsigned
name|long
modifier|*
name|dstLine
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pdstBase
decl_stmt|;
name|int
name|hTmp
decl_stmt|;
name|int
name|bwidthDst
decl_stmt|;
name|int
name|widthDst
decl_stmt|;
name|int
name|h
decl_stmt|;
name|int
name|ew
decl_stmt|;
name|BoxRec
name|bbox
decl_stmt|;
comment|/* for clipping */
name|int
name|widthDiff
decl_stmt|;
name|int
name|w
decl_stmt|;
name|RegionPtr
name|clip
decl_stmt|;
name|BoxPtr
name|extents
decl_stmt|;
ifdef|#
directive|ifdef
name|USE_LEFTBITS
name|int
name|widthGlyph
decl_stmt|;
name|unsigned
name|long
name|widthMask
decl_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|STIPPLE
ifdef|#
directive|ifdef
name|USE_STIPPLE_CODE
name|void
function_decl|(
modifier|*
name|stipple
function_decl|)
parameter_list|()
function_decl|;
specifier|extern
name|void
name|stipplestack
argument_list|()
decl_stmt|,
name|stipplestackte
argument_list|()
decl_stmt|;
name|stipple
operator|=
name|stipplestack
expr_stmt|;
if|if
condition|(
name|FONTCONSTMETRICS
argument_list|(
name|pfont
argument_list|)
condition|)
name|stipple
operator|=
name|stipplestackte
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
name|x
operator|+=
name|pDrawable
operator|->
name|x
expr_stmt|;
name|y
operator|+=
name|pDrawable
operator|->
name|y
expr_stmt|;
comment|/* compute an approximate (but covering) bounding box */
name|bbox
operator|.
name|x1
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ppci
index|[
literal|0
index|]
operator|->
name|metrics
operator|.
name|leftSideBearing
operator|<
literal|0
operator|)
condition|)
name|bbox
operator|.
name|x1
operator|=
name|ppci
index|[
literal|0
index|]
operator|->
name|metrics
operator|.
name|leftSideBearing
expr_stmt|;
name|h
operator|=
name|nglyph
operator|-
literal|1
expr_stmt|;
name|w
operator|=
name|ppci
index|[
name|h
index|]
operator|->
name|metrics
operator|.
name|rightSideBearing
expr_stmt|;
while|while
condition|(
operator|--
name|h
operator|>=
literal|0
condition|)
name|w
operator|+=
name|ppci
index|[
name|h
index|]
operator|->
name|metrics
operator|.
name|characterWidth
expr_stmt|;
name|bbox
operator|.
name|x2
operator|=
name|w
expr_stmt|;
name|bbox
operator|.
name|y1
operator|=
operator|-
name|FONTMAXBOUNDS
argument_list|(
name|pfont
argument_list|,
name|ascent
argument_list|)
expr_stmt|;
name|bbox
operator|.
name|y2
operator|=
name|FONTMAXBOUNDS
argument_list|(
name|pfont
argument_list|,
name|descent
argument_list|)
expr_stmt|;
name|clip
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|)
operator|->
name|pCompositeClip
expr_stmt|;
name|extents
operator|=
operator|&
name|clip
operator|->
name|extents
expr_stmt|;
if|if
condition|(
operator|!
name|clip
operator|->
name|data
condition|)
block|{
if|if
condition|(
operator|!
name|BOX_CONTAINS
argument_list|(
name|extents
argument_list|,
operator|&
name|bbox
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
block|{
if|if
condition|(
name|BOX_OVERLAP
argument_list|(
name|extents
argument_list|,
operator|&
name|bbox
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
name|cfbPolyGlyphBlt8Clipped
argument_list|(
name|pDrawable
argument_list|,
name|pGC
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|nglyph
argument_list|,
name|ppci
argument_list|,
name|pglyphBase
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
else|else
block|{
comment|/* check to make sure some of the text appears on the screen */
if|if
condition|(
operator|!
name|BOX_OVERLAP
argument_list|(
name|extents
argument_list|,
operator|&
name|bbox
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
return|return;
name|bbox
operator|.
name|x1
operator|+=
name|x
expr_stmt|;
name|bbox
operator|.
name|x2
operator|+=
name|x
expr_stmt|;
name|bbox
operator|.
name|y1
operator|+=
name|y
expr_stmt|;
name|bbox
operator|.
name|y2
operator|+=
name|y
expr_stmt|;
switch|switch
condition|(
call|(
modifier|*
name|pGC
operator|->
name|pScreen
operator|->
name|RectIn
call|)
argument_list|(
name|clip
argument_list|,
operator|&
name|bbox
argument_list|)
condition|)
block|{
case|case
name|rgnPART
case|:
name|cfbPolyGlyphBlt8Clipped
argument_list|(
name|pDrawable
argument_list|,
name|pGC
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|nglyph
argument_list|,
name|ppci
argument_list|,
name|pglyphBase
argument_list|)
expr_stmt|;
case|case
name|rgnOUT
case|:
return|return;
block|}
block|}
ifdef|#
directive|ifdef
name|GLYPHROP
name|cfb8CheckStipple
argument_list|(
name|pGC
operator|->
name|alu
argument_list|,
name|pGC
operator|->
name|fgPixel
argument_list|,
name|pGC
operator|->
name|planemask
argument_list|)
expr_stmt|;
else|#
directive|else
name|pixel
operator|=
operator|(
operator|(
name|cfbPrivGCPtr
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|xor
expr_stmt|;
endif|#
directive|endif
name|cfbGetTypedWidthAndPointer
argument_list|(
argument|pDrawable
argument_list|,
argument|bwidthDst
argument_list|,
argument|pdstBase
argument_list|,
argument|char
argument_list|,
argument|unsigned long
argument_list|)
name|widthDst
operator|=
name|bwidthDst
operator|>>
literal|2
expr_stmt|;
name|SET_REGISTERS_FOR_WRITING
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|,
operator|~
literal|0
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
while|while
condition|(
name|nglyph
operator|--
condition|)
block|{
name|pci
operator|=
operator|*
name|ppci
operator|++
expr_stmt|;
name|glyphBits
operator|=
operator|(
name|glyphPointer
operator|)
name|FONTGLYPHBITS
argument_list|(
name|pglyphBase
argument_list|,
name|pci
argument_list|)
expr_stmt|;
name|xoff
operator|=
name|x
operator|+
name|pci
operator|->
name|metrics
operator|.
name|leftSideBearing
expr_stmt|;
name|dstLine
operator|=
name|pdstBase
operator|+
operator|(
name|y
operator|-
name|pci
operator|->
name|metrics
operator|.
name|ascent
operator|)
operator|*
name|widthDst
operator|+
operator|(
name|xoff
operator|>>
literal|2
operator|)
expr_stmt|;
name|x
operator|+=
name|pci
operator|->
name|metrics
operator|.
name|characterWidth
expr_stmt|;
if|if
condition|(
name|hTmp
operator|=
name|pci
operator|->
name|metrics
operator|.
name|descent
operator|+
name|pci
operator|->
name|metrics
operator|.
name|ascent
condition|)
block|{
name|xoff
operator|&=
literal|0x3
expr_stmt|;
ifdef|#
directive|ifdef
name|STIPPLE
name|STIPPLE
argument_list|(
name|dstLine
argument_list|,
name|glyphBits
argument_list|,
name|pixel
argument_list|,
name|bwidthDst
argument_list|,
name|hTmp
argument_list|,
name|xoff
argument_list|)
expr_stmt|;
else|#
directive|else
ifdef|#
directive|ifdef
name|USE_STIPPLE_CODE
call|(
modifier|*
name|stipple
call|)
argument_list|(
name|dstLine
argument_list|,
name|glyphBits
argument_list|,
name|pixel
argument_list|,
name|bwidthDst
argument_list|,
name|hTmp
argument_list|,
name|xoff
argument_list|)
expr_stmt|;
else|#
directive|else
ifdef|#
directive|ifdef
name|USE_LEFTBITS
name|w
operator|=
name|pci
operator|->
name|metrics
operator|.
name|rightSideBearing
operator|-
name|pci
operator|->
name|metrics
operator|.
name|leftSideBearing
expr_stmt|;
name|widthGlyph
operator|=
name|PADGLYPHWIDTHBYTES
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|widthMask
operator|=
name|endtab
index|[
name|w
index|]
expr_stmt|;
endif|#
directive|endif
do|do
block|{
name|dst
operator|=
name|dstLine
expr_stmt|;
name|dstLine
operator|=
operator|(
name|unsigned
name|long
operator|*
operator|)
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
name|dstLine
operator|)
operator|+
name|bwidthDst
operator|)
expr_stmt|;
name|GlyphBits
argument_list|(
argument|glyphBits
argument_list|,
argument|w
argument_list|,
argument|c
argument_list|)
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|BitRight
argument_list|(
name|c
argument_list|,
name|xoff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|c
operator|=
name|BitLeft
argument_list|(
name|c
argument_list|,
literal|4
operator|-
name|xoff
argument_list|)
expr_stmt|;
while|while
condition|(
name|c
condition|)
block|{
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
block|}
block|}
do|while
condition|(
operator|--
name|hTmp
condition|)
do|;
endif|#
directive|endif
comment|/* USE_STIPPLE_CODE else */
endif|#
directive|endif
comment|/* STIPPLE else */
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|cfbPolyGlyphBlt8Clipped
parameter_list|(
name|pDrawable
parameter_list|,
name|pGC
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|nglyph
parameter_list|,
name|ppci
parameter_list|,
name|pglyphBase
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|int
name|nglyph
decl_stmt|;
name|CharInfoPtr
modifier|*
name|ppci
decl_stmt|;
comment|/* array of character info */
name|unsigned
name|char
modifier|*
name|pglyphBase
decl_stmt|;
comment|/* start of array of glyphs */
block|{
specifier|register
name|unsigned
name|long
name|c
decl_stmt|;
ifndef|#
directive|ifndef
name|GLYPHROP
specifier|register
name|unsigned
name|long
name|pixel
decl_stmt|;
endif|#
directive|endif
specifier|register
name|unsigned
name|long
modifier|*
name|dst
decl_stmt|;
specifier|register
name|glyphPointer
name|glyphBits
decl_stmt|;
specifier|register
name|int
name|xoff
decl_stmt|;
specifier|register
name|int
name|ewTmp
decl_stmt|;
name|unsigned
name|long
name|c1
decl_stmt|;
name|CharInfoPtr
name|pci
decl_stmt|;
name|FontPtr
name|pfont
init|=
name|pGC
operator|->
name|font
decl_stmt|;
name|unsigned
name|long
modifier|*
name|dstLine
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pdstBase
decl_stmt|;
name|unsigned
name|long
modifier|*
name|cTmp
decl_stmt|,
modifier|*
name|clips
decl_stmt|;
name|int
name|maxAscent
decl_stmt|,
name|maxDescent
decl_stmt|;
name|int
name|minLeftBearing
decl_stmt|;
name|int
name|hTmp
decl_stmt|;
name|int
name|widthDst
decl_stmt|;
name|int
name|bwidthDst
decl_stmt|;
name|int
name|ew
decl_stmt|;
name|int
name|xG
decl_stmt|,
name|yG
decl_stmt|;
name|BoxPtr
name|pBox
decl_stmt|;
name|int
name|numRects
decl_stmt|;
name|int
name|widthDiff
decl_stmt|;
name|int
name|w
decl_stmt|;
name|RegionPtr
name|pRegion
decl_stmt|;
name|int
name|yBand
decl_stmt|;
ifdef|#
directive|ifdef
name|USE_LEFTBITS
name|int
name|widthGlyph
decl_stmt|;
name|unsigned
name|long
name|widthMask
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|GLYPHROP
name|cfb8CheckStipple
argument_list|(
name|pGC
operator|->
name|alu
argument_list|,
name|pGC
operator|->
name|fgPixel
argument_list|,
name|pGC
operator|->
name|planemask
argument_list|)
expr_stmt|;
else|#
directive|else
name|pixel
operator|=
operator|(
operator|(
name|cfbPrivGCPtr
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|xor
expr_stmt|;
endif|#
directive|endif
name|cfbGetTypedWidthAndPointer
argument_list|(
argument|pDrawable
argument_list|,
argument|bwidthDst
argument_list|,
argument|pdstBase
argument_list|,
argument|char
argument_list|,
argument|unsigned long
argument_list|)
name|widthDst
operator|=
name|bwidthDst
operator|>>
literal|2
expr_stmt|;
name|maxAscent
operator|=
name|FONTMAXBOUNDS
argument_list|(
name|pfont
argument_list|,
name|ascent
argument_list|)
expr_stmt|;
name|maxDescent
operator|=
name|FONTMAXBOUNDS
argument_list|(
name|pfont
argument_list|,
name|descent
argument_list|)
expr_stmt|;
name|minLeftBearing
operator|=
name|FONTMINBOUNDS
argument_list|(
name|pfont
argument_list|,
name|leftSideBearing
argument_list|)
expr_stmt|;
name|SET_REGISTERS_FOR_WRITING
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|,
operator|~
literal|0
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|pRegion
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|)
operator|->
name|pCompositeClip
expr_stmt|;
name|pBox
operator|=
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
expr_stmt|;
name|numRects
operator|=
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
expr_stmt|;
while|while
condition|(
name|numRects
operator|&&
name|pBox
operator|->
name|y2
operator|<=
name|y
operator|-
name|maxAscent
condition|)
block|{
operator|++
name|pBox
expr_stmt|;
operator|--
name|numRects
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|numRects
operator|||
name|pBox
operator|->
name|y1
operator|>=
name|y
operator|+
name|maxDescent
condition|)
return|return;
name|yBand
operator|=
name|pBox
operator|->
name|y1
expr_stmt|;
while|while
condition|(
name|numRects
operator|&&
name|pBox
operator|->
name|y1
operator|==
name|yBand
operator|&&
name|pBox
operator|->
name|x2
operator|<=
name|x
operator|+
name|minLeftBearing
condition|)
block|{
operator|++
name|pBox
expr_stmt|;
operator|--
name|numRects
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|numRects
condition|)
return|return;
name|clips
operator|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|ALLOCATE_LOCAL
argument_list|(
operator|(
name|maxAscent
operator|+
name|maxDescent
operator|)
operator|*
expr|sizeof
operator|(
name|unsigned
name|long
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|nglyph
operator|--
condition|)
block|{
name|pci
operator|=
operator|*
name|ppci
operator|++
expr_stmt|;
name|glyphBits
operator|=
operator|(
name|glyphPointer
operator|)
name|FONTGLYPHBITS
argument_list|(
name|pglyphBase
argument_list|,
name|pci
argument_list|)
expr_stmt|;
name|w
operator|=
name|pci
operator|->
name|metrics
operator|.
name|rightSideBearing
operator|-
name|pci
operator|->
name|metrics
operator|.
name|leftSideBearing
expr_stmt|;
name|xG
operator|=
name|x
operator|+
name|pci
operator|->
name|metrics
operator|.
name|leftSideBearing
expr_stmt|;
name|yG
operator|=
name|y
operator|-
name|pci
operator|->
name|metrics
operator|.
name|ascent
expr_stmt|;
name|x
operator|+=
name|pci
operator|->
name|metrics
operator|.
name|characterWidth
expr_stmt|;
if|if
condition|(
name|hTmp
operator|=
name|pci
operator|->
name|metrics
operator|.
name|descent
operator|+
name|pci
operator|->
name|metrics
operator|.
name|ascent
condition|)
block|{
name|dstLine
operator|=
name|pdstBase
operator|+
name|yG
operator|*
name|widthDst
operator|+
operator|(
name|xG
operator|>>
literal|2
operator|)
expr_stmt|;
name|xoff
operator|=
name|xG
operator|&
literal|0x3
expr_stmt|;
ifdef|#
directive|ifdef
name|USE_LEFTBITS
name|w
operator|=
name|pci
operator|->
name|metrics
operator|.
name|rightSideBearing
operator|-
name|pci
operator|->
name|metrics
operator|.
name|leftSideBearing
expr_stmt|;
name|widthGlyph
operator|=
name|PADGLYPHWIDTHBYTES
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|widthMask
operator|=
name|endtab
index|[
name|w
index|]
expr_stmt|;
endif|#
directive|endif
switch|switch
condition|(
name|cfb8ComputeClipMasks32
argument_list|(
name|pBox
argument_list|,
name|numRects
argument_list|,
name|xG
argument_list|,
name|yG
argument_list|,
name|w
argument_list|,
name|hTmp
argument_list|,
name|clips
argument_list|)
condition|)
block|{
case|case
name|rgnPART
case|:
ifdef|#
directive|ifdef
name|USE_LEFTBITS
name|cTmp
operator|=
name|clips
expr_stmt|;
do|do
block|{
name|dst
operator|=
name|dstLine
expr_stmt|;
name|dstLine
operator|=
operator|(
name|unsigned
name|long
operator|*
operator|)
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
name|dstLine
operator|)
operator|+
name|bwidthDst
operator|)
expr_stmt|;
name|GlyphBits
argument_list|(
argument|glyphBits
argument_list|,
argument|w
argument_list|,
argument|c
argument_list|)
name|c
operator|&=
operator|*
name|cTmp
operator|++
expr_stmt|;
if|if
condition|(
name|c
condition|)
block|{
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|BitRight
argument_list|(
name|c
argument_list|,
name|xoff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|c
operator|=
name|BitLeft
argument_list|(
name|c
argument_list|,
literal|4
operator|-
name|xoff
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
while|while
condition|(
name|c
condition|)
block|{
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
block|}
block|}
block|}
do|while
condition|(
operator|--
name|hTmp
condition|)
do|;
break|break;
else|#
directive|else
block|{
name|int
name|h
decl_stmt|;
name|h
operator|=
name|hTmp
expr_stmt|;
do|do
block|{
operator|--
name|h
expr_stmt|;
name|clips
index|[
name|h
index|]
operator|=
name|clips
index|[
name|h
index|]
operator|&
name|glyphBits
index|[
name|h
index|]
expr_stmt|;
block|}
do|while
condition|(
name|h
condition|)
do|;
block|}
name|glyphBits
operator|=
name|clips
expr_stmt|;
comment|/* fall through */
endif|#
directive|endif
case|case
name|rgnIN
case|:
ifdef|#
directive|ifdef
name|STIPPLE
name|STIPPLE
argument_list|(
name|dstLine
argument_list|,
name|glyphBits
argument_list|,
name|pixel
argument_list|,
name|bwidthDst
argument_list|,
name|hTmp
argument_list|,
name|xoff
argument_list|)
expr_stmt|;
else|#
directive|else
ifdef|#
directive|ifdef
name|USE_STIPPLE_CODE
name|stipplestackte
argument_list|(
name|dstLine
argument_list|,
name|glyphBits
argument_list|,
name|pixel
argument_list|,
name|bwidthDst
argument_list|,
name|hTmp
argument_list|,
name|xoff
argument_list|)
expr_stmt|;
else|#
directive|else
do|do
block|{
name|dst
operator|=
name|dstLine
expr_stmt|;
name|dstLine
operator|=
operator|(
name|unsigned
name|long
operator|*
operator|)
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
name|dstLine
operator|)
operator|+
name|bwidthDst
operator|)
expr_stmt|;
name|GlyphBits
argument_list|(
argument|glyphBits
argument_list|,
argument|w
argument_list|,
argument|c
argument_list|)
if|if
condition|(
name|c
condition|)
block|{
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|BitRight
argument_list|(
name|c
argument_list|,
name|xoff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|c
operator|=
name|BitLeft
argument_list|(
name|c
argument_list|,
literal|4
operator|-
name|xoff
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
while|while
condition|(
name|c
condition|)
block|{
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
block|}
block|}
block|}
do|while
condition|(
operator|--
name|hTmp
condition|)
do|;
endif|#
directive|endif
comment|/* USE_STIPPLE_CODE else */
endif|#
directive|endif
comment|/* STIPPLE else */
break|break;
block|}
block|}
block|}
name|DEALLOCATE_LOCAL
argument_list|(
name|clips
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* PPW == 4 */
end_comment

end_unit

