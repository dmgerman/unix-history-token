begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XCrIC.c,v 1.34 92/07/29 13:54:58 rws Exp $  */
end_comment

begin_comment
comment|/*  * Copyright 1990, 1991 by OMRON Corporation  * Copyright 1991 by the Massachusetts Institute of Technology  *  * Permission to use, copy, modify, distribute, and sell this software and its  * documentation for any purpose is hereby granted without fee, provided that  * the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the names of OMRON and MIT not be used in  * advertising or publicity pertaining to distribution of the software without  * specific, written prior permission.  OMRON and MIT make no representations  * about the suitability of this software for any purpose.  It is provided  * "as is" without express or implied warranty.  *  * OMRON AND MIT DISCLAIM ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,  * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO  * EVENT SHALL OMRON OR MIT BE LIABLE FOR ANY SPECIAL, INDIRECT OR  * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,  * DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER  * TORTUOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.   *  *	Author:	Seiji Kuwari	OMRON Corporation  *				kuwa@omron.co.jp  *				kuwa%omron.co.jp@uunet.uu.net  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xi18nint.h"
end_include

begin_include
include|#
directive|include
file|"XIMlibint.h"
end_include

begin_if
if|#
directive|if
name|NeedVarargsPrototypes
end_if

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_define
define|#
directive|define
name|Va_start
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|va_start(a,b)
end_define

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<varargs.h>
end_include

begin_define
define|#
directive|define
name|Va_start
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|va_start(a)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|__STDC__
operator|&&
operator|!
name|defined
argument_list|(
name|NORCONST
argument_list|)
end_if

begin_define
define|#
directive|define
name|RConst
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|RConst
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Free the input context.  */
end_comment

begin_function
name|void
name|_XipDestroyIC
parameter_list|(
name|supic
parameter_list|)
name|XIC
name|supic
decl_stmt|;
block|{
name|XipIC
name|ic
init|=
operator|(
name|XipIC
operator|)
name|supic
decl_stmt|;
name|XipIM
name|im
init|=
operator|(
name|XipIM
operator|)
name|ic
operator|->
name|core
operator|.
name|im
decl_stmt|;
comment|/* check xim and ic*/
if|if
condition|(
name|im
operator|->
name|fd
operator|>=
literal|0
condition|)
block|{
name|ximDestroyICReq
name|req
decl_stmt|;
name|ximEventReply
name|reply
decl_stmt|;
name|req
operator|.
name|reqType
operator|=
name|XIM_DestroyIC
expr_stmt|;
name|req
operator|.
name|length
operator|=
name|sz_ximDestroyICReq
expr_stmt|;
name|req
operator|.
name|xic
operator|=
name|ic
operator|->
name|icid
expr_stmt|;
if|if
condition|(
operator|(
name|_XipWriteToIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|req
argument_list|,
name|sz_ximDestroyICReq
argument_list|)
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|_XipFlushToIM
argument_list|(
name|im
argument_list|)
operator|>=
literal|0
operator|)
condition|)
block|{
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|_XipReadFromIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|reply
argument_list|,
name|sz_ximEventReply
argument_list|)
operator|<
literal|0
operator|)
operator|||
operator|(
name|reply
operator|.
name|state
operator|==
literal|0xffff
operator|)
condition|)
block|{
return|return;
block|}
if|if
condition|(
name|reply
operator|.
name|detail
operator|==
name|XIM_CALLBACK
condition|)
block|{
comment|/* 		     * Call the callback routines. 		     */
if|if
condition|(
name|_XipCallCallbacks
argument_list|(
name|ic
argument_list|)
operator|<
literal|0
condition|)
block|{
return|return;
block|}
block|}
else|else
block|{
break|break;
block|}
block|}
block|}
block|}
name|_XUnregisterFilter
argument_list|(
name|im
operator|->
name|core
operator|.
name|display
argument_list|,
name|ic
operator|->
name|core
operator|.
name|focus_window
argument_list|,
name|ic
operator|->
name|prototype_filter
argument_list|,
operator|(
name|XPointer
operator|)
name|ic
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|mb
condition|)
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|mb
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|wc
condition|)
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|wc
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XML
if|if
condition|(
name|ic
operator|->
name|xlc_num
operator|>
literal|0
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ic
operator|->
name|xlc_num
condition|;
name|i
operator|++
control|)
block|{
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|wc_temp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ic
operator|->
name|mb_temp
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|mb_temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|wc_temp
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|wc_temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|values
operator|.
name|using_language
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|values
operator|.
name|using_language
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|values
operator|.
name|current_language
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|values
operator|.
name|current_language
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* XML */
if|if
condition|(
name|ic
operator|->
name|ct_buf
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|ct_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|wc_buf
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|wc_buf
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|_XipFreeAllICQueue
argument_list|(
name|ic
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|RConst
name|XICMethodsRec
name|ic_methods
init|=
block|{
name|_XipDestroyIC
block|,
name|_XipSetICFocus
block|,
name|_XipUnsetICFocus
block|,
name|_XipSetICValues
block|,
name|_XipGetICValues
block|,
name|_XipmbResetIC
block|,
name|_XipwcResetIC
block|,
name|_XipmbLookupString
block|,
name|_XipwcLookupString
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Status
name|_StringToPixel
parameter_list|(
name|display
parameter_list|,
name|colormap
parameter_list|,
name|name
parameter_list|,
name|pixel
parameter_list|)
name|Display
modifier|*
name|display
decl_stmt|;
name|Colormap
name|colormap
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pixel
decl_stmt|;
block|{
name|XColor
name|c
decl_stmt|,
name|e_c
decl_stmt|;
name|Status
name|status
decl_stmt|;
if|if
condition|(
name|name
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
block|{
name|status
operator|=
name|XParseColor
argument_list|(
name|display
argument_list|,
name|colormap
argument_list|,
name|name
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
literal|0
condition|)
block|{
name|status
operator|=
name|XAllocColor
argument_list|(
name|display
argument_list|,
name|colormap
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|status
operator|=
name|XAllocNamedColor
argument_list|(
name|display
argument_list|,
name|colormap
argument_list|,
name|name
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|e_c
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
literal|0
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
block|{
operator|*
name|pixel
operator|=
name|c
operator|.
name|pixel
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
end_function

begin_function
name|unsigned
name|long
name|_XipReadRdb
parameter_list|(
name|display
parameter_list|,
name|ic
parameter_list|,
name|mask
parameter_list|,
name|rdb
parameter_list|,
name|res_name
parameter_list|,
name|res_class
parameter_list|)
name|Display
modifier|*
name|display
decl_stmt|;
name|XipIC
name|ic
decl_stmt|;
name|unsigned
name|long
name|mask
decl_stmt|;
name|XrmDatabase
name|rdb
decl_stmt|;
name|char
modifier|*
name|res_name
decl_stmt|;
name|char
modifier|*
name|res_class
decl_stmt|;
block|{
name|XipIM
name|im
init|=
name|ipIMofIC
argument_list|(
name|ic
argument_list|)
decl_stmt|;
name|unsigned
name|long
name|ret_mask
init|=
literal|0
decl_stmt|;
name|char
name|name_prefix
index|[
literal|256
index|]
decl_stmt|,
name|class_prefix
index|[
literal|256
index|]
decl_stmt|;
name|char
name|res_name_buf
index|[
literal|256
index|]
decl_stmt|,
name|res_class_buf
index|[
literal|256
index|]
decl_stmt|;
comment|/*     char def_fontset[256];     */
ifdef|#
directive|ifdef
name|XML
name|char
name|def_language
index|[
literal|256
index|]
decl_stmt|;
endif|#
directive|endif
comment|/* XML */
name|char
name|def_fg_name
index|[
literal|256
index|]
decl_stmt|,
name|def_bg_name
index|[
literal|256
index|]
decl_stmt|;
name|unsigned
name|long
name|def_fg
decl_stmt|,
name|def_bg
decl_stmt|;
name|char
modifier|*
name|str_type
index|[
literal|20
index|]
decl_stmt|;
name|XrmValue
name|value
decl_stmt|;
name|XIMArg
name|args
index|[
literal|8
index|]
decl_stmt|,
name|pre_args
index|[
literal|4
index|]
decl_stmt|,
name|st_args
index|[
literal|4
index|]
decl_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|,
name|pre_count
init|=
literal|0
decl_stmt|,
name|st_count
init|=
literal|0
decl_stmt|;
name|Colormap
name|colormap
decl_stmt|,
name|def_colormap
decl_stmt|;
name|XWindowAttributes
name|win_info
decl_stmt|;
if|if
condition|(
name|rdb
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|ic
operator|->
name|core
operator|.
name|client_window
condition|)
block|{
name|XGetWindowAttributes
argument_list|(
name|display
argument_list|,
name|ic
operator|->
name|core
operator|.
name|client_window
argument_list|,
operator|&
name|win_info
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XGetWindowAttributes
argument_list|(
name|display
argument_list|,
name|RootWindow
argument_list|(
name|display
argument_list|,
name|DefaultScreen
argument_list|(
name|display
argument_list|)
argument_list|)
argument_list|,
operator|&
name|win_info
argument_list|)
expr_stmt|;
block|}
name|def_colormap
operator|=
name|win_info
operator|.
name|colormap
expr_stmt|;
if|if
condition|(
name|res_name
operator|==
name|NULL
operator|||
operator|*
name|res_name
operator|==
literal|'\0'
operator|||
name|res_class
operator|==
name|NULL
operator|||
operator|*
name|res_class
operator|==
literal|'\0'
condition|)
block|{
name|strcpy
argument_list|(
name|name_prefix
argument_list|,
literal|"*."
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|class_prefix
argument_list|,
literal|"*."
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|strcpy
argument_list|(
name|name_prefix
argument_list|,
name|res_name
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|class_prefix
argument_list|,
name|res_class
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|name_prefix
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|class_prefix
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
operator|(
literal|1
operator|<<
name|ICForeground
operator|)
operator||
operator|(
literal|1
operator|<<
operator|(
name|ICForeground
operator|+
name|StatusOffset
operator|)
operator|)
operator|)
operator|)
condition|)
block|{
name|strcpy
argument_list|(
name|res_name_buf
argument_list|,
name|name_prefix
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|res_class_buf
argument_list|,
name|class_prefix
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|res_name_buf
argument_list|,
literal|"foreground"
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|res_class_buf
argument_list|,
literal|"Foreground"
argument_list|)
expr_stmt|;
if|if
condition|(
name|XrmGetResource
argument_list|(
name|rdb
argument_list|,
name|res_name_buf
argument_list|,
name|res_class_buf
argument_list|,
name|str_type
argument_list|,
operator|&
name|value
argument_list|)
operator|==
name|True
condition|)
block|{
name|strncpy
argument_list|(
name|def_fg_name
argument_list|,
name|value
operator|.
name|addr
argument_list|,
operator|(
name|int
operator|)
name|value
operator|.
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|core
operator|.
name|preedit_attr
operator|.
name|colormap
condition|)
block|{
name|colormap
operator|=
name|ic
operator|->
name|core
operator|.
name|preedit_attr
operator|.
name|colormap
expr_stmt|;
block|}
else|else
block|{
name|colormap
operator|=
name|def_colormap
expr_stmt|;
block|}
if|if
condition|(
name|_StringToPixel
argument_list|(
name|display
argument_list|,
name|colormap
argument_list|,
name|def_fg_name
argument_list|,
operator|&
name|def_fg
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
literal|1
operator|<<
name|ICForeground
operator|)
operator|)
condition|)
block|{
name|pre_args
index|[
name|pre_count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|XNForeground
expr_stmt|;
name|pre_args
index|[
name|pre_count
index|]
operator|.
name|value
operator|=
operator|(
name|XPointer
operator|)
name|def_fg
expr_stmt|;
name|pre_count
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
literal|1
operator|<<
operator|(
name|ICForeground
operator|+
name|StatusOffset
operator|)
operator|)
operator|)
condition|)
block|{
name|st_args
index|[
name|st_count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|XNForeground
expr_stmt|;
name|st_args
index|[
name|st_count
index|]
operator|.
name|value
operator|=
operator|(
name|XPointer
operator|)
name|def_fg
expr_stmt|;
name|st_count
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XIM: Could not Alloc color \"%s\"."
argument_list|,
name|def_fg_name
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
operator|(
literal|1
operator|<<
name|ICBackground
operator|)
operator||
operator|(
literal|1
operator|<<
operator|(
name|ICBackground
operator|+
name|StatusOffset
operator|)
operator|)
operator|)
operator|)
condition|)
block|{
name|strcpy
argument_list|(
name|res_name_buf
argument_list|,
name|name_prefix
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|res_class_buf
argument_list|,
name|class_prefix
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|res_name_buf
argument_list|,
literal|"background"
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|res_class_buf
argument_list|,
literal|"Background"
argument_list|)
expr_stmt|;
if|if
condition|(
name|XrmGetResource
argument_list|(
name|rdb
argument_list|,
name|res_name_buf
argument_list|,
name|res_class_buf
argument_list|,
name|str_type
argument_list|,
operator|&
name|value
argument_list|)
operator|==
name|True
condition|)
block|{
name|strncpy
argument_list|(
name|def_bg_name
argument_list|,
name|value
operator|.
name|addr
argument_list|,
operator|(
name|int
operator|)
name|value
operator|.
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|core
operator|.
name|preedit_attr
operator|.
name|colormap
condition|)
block|{
name|colormap
operator|=
name|ic
operator|->
name|core
operator|.
name|preedit_attr
operator|.
name|colormap
expr_stmt|;
block|}
else|else
block|{
name|colormap
operator|=
name|def_colormap
expr_stmt|;
block|}
if|if
condition|(
name|_StringToPixel
argument_list|(
name|display
argument_list|,
name|colormap
argument_list|,
name|def_bg_name
argument_list|,
operator|&
name|def_bg
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
literal|1
operator|<<
name|ICBackground
operator|)
operator|)
condition|)
block|{
name|pre_args
index|[
name|pre_count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|XNBackground
expr_stmt|;
name|pre_args
index|[
name|pre_count
index|]
operator|.
name|value
operator|=
operator|(
name|XPointer
operator|)
name|def_bg
expr_stmt|;
name|pre_count
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
literal|1
operator|<<
operator|(
name|ICBackground
operator|+
name|StatusOffset
operator|)
operator|)
operator|)
condition|)
block|{
name|st_args
index|[
name|st_count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|XNBackground
expr_stmt|;
name|st_args
index|[
name|st_count
index|]
operator|.
name|value
operator|=
operator|(
name|XPointer
operator|)
name|def_bg
expr_stmt|;
name|st_count
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XIM: Could not Alloc color \"%s\"."
argument_list|,
name|def_bg_name
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/*     if (!(mask& ((1<< ICFontSet) | (1<< (ICFontSet + StatusOffset))))) { 	strcpy(res_name_buf, name_prefix);	 	strcpy(res_class_buf, class_prefix); 	strcat(res_name_buf, "fontSet"); 	strcat(res_class_buf, "FontSet"); 	if (XrmGetResource(rdb, res_name_buf, res_class_buf, 			   str_type,&value) == True) { 	    strncpy(def_fontset, value.addr, value.size); 	    if (!(mask& (1<< ICFontSet))) { 		pre_args[pre_count].name = (char *)XNFontSet; 		pre_args[pre_count].value = (XPointer)def_fontset; 		pre_count++; 	    } 	    if (!(mask& (1<< (ICFontSet + StatusOffset)))) { 		st_args[st_count].name = (char *)XNForeground; 		st_args[st_count].value = (XPointer)def_fg; 		st_count++; 	    } 	}     }     */
ifdef|#
directive|ifdef
name|XML
if|if
condition|(
operator|!
operator|(
name|mask
operator|&
operator|(
literal|1
operator|<<
name|ICUsingLanguage
operator|)
operator|)
condition|)
block|{
name|strcpy
argument_list|(
name|res_name_buf
argument_list|,
name|name_prefix
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|res_class_buf
argument_list|,
name|class_prefix
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|res_name_buf
argument_list|,
literal|"usingLanguage"
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|res_class_buf
argument_list|,
literal|"usingLanguage"
argument_list|)
expr_stmt|;
if|if
condition|(
name|XrmGetResource
argument_list|(
name|rdb
argument_list|,
name|res_name_buf
argument_list|,
name|res_class_buf
argument_list|,
name|str_type
argument_list|,
operator|&
name|value
argument_list|)
operator|==
name|True
condition|)
block|{
name|strncpy
argument_list|(
name|def_language
argument_list|,
name|value
operator|.
name|addr
argument_list|,
operator|(
name|int
operator|)
name|value
operator|.
name|size
argument_list|)
expr_stmt|;
name|args
index|[
name|count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|XNUsingLanguage
expr_stmt|;
name|args
index|[
name|count
index|]
operator|.
name|value
operator|=
operator|(
name|XPointer
operator|)
name|def_language
expr_stmt|;
name|count
operator|++
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* XML */
if|if
condition|(
name|pre_count
condition|)
block|{
name|pre_args
index|[
name|pre_count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|NULL
expr_stmt|;
operator|(
name|void
operator|)
name|_XipICSetAttrValues
argument_list|(
name|im
argument_list|,
name|pre_args
argument_list|,
operator|&
name|ic
operator|->
name|core
operator|.
name|preedit_attr
argument_list|,
operator|&
name|ret_mask
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|st_count
condition|)
block|{
name|st_args
index|[
name|st_count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|NULL
expr_stmt|;
operator|(
name|void
operator|)
name|_XipICSetAttrValues
argument_list|(
name|im
argument_list|,
name|st_args
argument_list|,
operator|&
name|ic
operator|->
name|core
operator|.
name|status_attr
argument_list|,
operator|&
name|ret_mask
argument_list|,
name|StatusOffset
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|count
condition|)
block|{
name|args
index|[
name|count
index|]
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|NULL
expr_stmt|;
operator|(
name|void
operator|)
name|_XipICSetValues
argument_list|(
name|ic
argument_list|,
name|args
argument_list|,
operator|&
name|ret_mask
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|ret_mask
operator|)
return|;
block|}
end_function

begin_function
name|Bool
name|_XipCreateDefIC
parameter_list|(
name|im
parameter_list|)
name|XipIM
name|im
decl_stmt|;
block|{
name|im
operator|->
name|default_ic
operator|=
operator|(
name|XipIC
operator|)
name|Xcalloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|XipICRec
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|im
operator|->
name|default_ic
operator|==
name|NULL
condition|)
block|{
return|return
name|False
return|;
block|}
name|im
operator|->
name|default_ic
operator|->
name|core
operator|.
name|im
operator|=
operator|(
name|XIM
operator|)
name|im
expr_stmt|;
name|im
operator|->
name|default_mask
operator|=
name|_XipReadRdb
argument_list|(
name|im
operator|->
name|core
operator|.
name|display
argument_list|,
name|im
operator|->
name|default_ic
argument_list|,
operator|(
name|unsigned
name|long
operator|)
literal|0
argument_list|,
name|im
operator|->
name|core
operator|.
name|rdb
argument_list|,
name|im
operator|->
name|core
operator|.
name|res_name
argument_list|,
name|im
operator|->
name|core
operator|.
name|res_class
argument_list|)
expr_stmt|;
return|return
name|True
return|;
block|}
end_function

begin_comment
comment|/*  * Create an input context within the input method,   * and return a pointer the input context ti the caller.  */
end_comment

begin_function
name|XIC
name|_XipCreateIC
parameter_list|(
name|supim
parameter_list|,
name|args
parameter_list|)
name|XIM
name|supim
decl_stmt|;
name|XIMArg
modifier|*
name|args
decl_stmt|;
block|{
name|XipIM
name|im
init|=
operator|(
name|XipIM
operator|)
name|supim
decl_stmt|;
name|XipIC
name|ic
decl_stmt|;
name|ximCreateICReq
name|req
decl_stmt|;
name|ximCreateICReply
name|reply
decl_stmt|;
name|ximEventReply
name|reply1
decl_stmt|;
name|unsigned
name|long
name|mask
decl_stmt|;
specifier|extern
name|Bool
name|_XipBackEndFilter
parameter_list|()
function_decl|;
ifdef|#
directive|ifdef
name|XML
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
modifier|*
name|nls_list
decl_stmt|,
modifier|*
modifier|*
name|l
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|,
name|n
init|=
literal|0
decl_stmt|;
name|XLocale
name|xlc
decl_stmt|;
endif|#
directive|endif
comment|/* XML */
comment|/*      * If im is not specified or the file descripter is not available,      * return NULL.      */
if|if
condition|(
name|im
operator|->
name|fd
operator|<
literal|0
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|ic
operator|=
operator|(
name|XipIC
operator|)
name|Xcalloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|XipICRec
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|mask
operator|=
name|im
operator|->
name|default_mask
expr_stmt|;
if|if
condition|(
name|mask
condition|)
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|im
operator|->
name|default_ic
operator|->
name|values
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ic
operator|->
name|values
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|_ICValues
argument_list|)
argument_list|)
expr_stmt|;
name|ic
operator|->
name|methods
operator|=
operator|(
name|XICMethods
operator|)
operator|&
name|ic_methods
expr_stmt|;
name|ic
operator|->
name|prototype_filter
operator|=
name|_XipBackEndFilter
expr_stmt|;
name|ic
operator|->
name|core
operator|.
name|im
operator|=
name|supim
expr_stmt|;
operator|(
name|void
operator|)
name|_XipICSetValues
argument_list|(
name|ic
argument_list|,
name|args
argument_list|,
operator|&
name|mask
argument_list|)
expr_stmt|;
name|req
operator|.
name|reqType
operator|=
name|XIM_CreateIC
expr_stmt|;
name|req
operator|.
name|length
operator|=
name|sz_ximCreateICReq
operator|+
name|strlen
argument_list|(
name|im
operator|->
name|client_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|_XipWriteToIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|req
argument_list|,
name|sz_ximCreateICReq
argument_list|)
operator|<
literal|0
operator|)
operator|||
operator|(
name|_XipWriteToIM
argument_list|(
name|im
argument_list|,
name|im
operator|->
name|client_data
argument_list|,
name|strlen
argument_list|(
name|im
operator|->
name|client_data
argument_list|)
argument_list|)
operator|<
literal|0
operator|)
operator|||
operator|(
name|_XipFlushToIM
argument_list|(
name|im
argument_list|)
operator|<
literal|0
operator|)
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|im
operator|->
name|core
operator|.
name|rdb
operator|&&
name|ic
operator|->
name|values
operator|.
name|res_name
operator|&&
name|ic
operator|->
name|values
operator|.
name|res_class
condition|)
block|{
name|mask
operator||=
name|_XipReadRdb
argument_list|(
name|im
operator|->
name|core
operator|.
name|display
argument_list|,
name|ic
argument_list|,
name|mask
argument_list|,
name|im
operator|->
name|core
operator|.
name|rdb
argument_list|,
name|ic
operator|->
name|values
operator|.
name|res_name
argument_list|,
name|ic
operator|->
name|values
operator|.
name|res_class
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|XML
if|if
condition|(
name|im
operator|->
name|xlc
operator|!=
name|NULL
condition|)
block|{
endif|#
directive|endif
comment|/* XML */
name|ic
operator|->
name|mb
operator|=
name|_XlcDupLocale
argument_list|(
name|im
operator|->
name|xlc
argument_list|)
expr_stmt|;
name|ic
operator|->
name|wc
operator|=
name|_XlcDupLocale
argument_list|(
name|im
operator|->
name|xlc
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XML
name|ic
operator|->
name|xlc_num
operator|=
literal|0
expr_stmt|;
name|ic
operator|->
name|mb_temp
operator|=
name|NULL
expr_stmt|;
name|ic
operator|->
name|wc_temp
operator|=
name|NULL
expr_stmt|;
name|n
operator|=
name|strlen
argument_list|(
name|im
operator|->
name|xlc
operator|->
name|xlc_db
operator|->
name|lc_name
argument_list|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|Xmalloc
argument_list|(
name|n
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|strcpy
argument_list|(
name|p
argument_list|,
name|im
operator|->
name|xlc
operator|->
name|xlc_db
operator|->
name|lc_name
argument_list|)
expr_stmt|;
name|p
index|[
name|n
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|ic
operator|->
name|values
operator|.
name|using_language
operator|=
name|p
expr_stmt|;
name|mask
operator||=
operator|(
literal|1
operator|<<
name|ICUsingLanguage
operator|)
expr_stmt|;
block|}
else|else
block|{
name|ic
operator|->
name|mb
operator|=
name|NULL
expr_stmt|;
name|ic
operator|->
name|wc
operator|=
name|NULL
expr_stmt|;
name|ic
operator|->
name|xlc_num
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ic
operator|->
name|mb_temp
operator|=
operator|(
name|XLocale
operator|*
operator|)
name|Xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|XLocale
argument_list|)
operator|*
literal|32
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|ic
operator|->
name|wc_temp
operator|=
operator|(
name|XLocale
operator|*
operator|)
name|Xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|XLocale
argument_list|)
operator|*
literal|32
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|_XlcListLocale
argument_list|(
operator|&
name|nls_list
argument_list|)
expr_stmt|;
for|for
control|(
name|l
operator|=
name|nls_list
init|;
operator|*
name|l
condition|;
name|l
operator|++
control|)
block|{
name|xlc
operator|=
name|_XlcMakeLocale
argument_list|(
operator|*
name|l
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|xlc
condition|)
continue|continue;
name|ic
operator|->
name|mb_temp
index|[
name|ic
operator|->
name|xlc_num
index|]
operator|=
name|xlc
expr_stmt|;
name|ic
operator|->
name|wc_temp
index|[
name|ic
operator|->
name|xlc_num
index|]
operator|=
name|_XlcDupLocale
argument_list|(
name|xlc
argument_list|)
expr_stmt|;
name|n
operator|+=
name|strlen
argument_list|(
name|ic
operator|->
name|mb_temp
index|[
name|ic
operator|->
name|xlc_num
index|]
operator|->
name|xlc_db
operator|->
name|lc_name
argument_list|)
operator|+
literal|1
expr_stmt|;
name|ic
operator|->
name|xlc_num
operator|++
expr_stmt|;
block|}
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|nls_list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|Xmalloc
argument_list|(
name|n
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|p
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ic
operator|->
name|xlc_num
condition|;
name|i
operator|++
control|)
block|{
name|strcat
argument_list|(
name|p
argument_list|,
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
operator|->
name|xlc_db
operator|->
name|lc_name
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|p
argument_list|,
literal|";"
argument_list|)
expr_stmt|;
block|}
name|p
index|[
name|n
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ic
operator|->
name|values
operator|.
name|using_language
operator|=
name|p
expr_stmt|;
name|mask
operator||=
operator|(
literal|1
operator|<<
name|ICUsingLanguage
operator|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* XML */
comment|/*      * Attempt to send IC data to the input manager. If sending failed,      * free IC structure and return NULL.      */
name|_XipSendICValues
argument_list|(
name|ic
argument_list|,
name|mask
argument_list|)
expr_stmt|;
name|ic
operator|->
name|max_of_ct
operator|=
name|ic
operator|->
name|max_of_wc
operator|=
literal|0
expr_stmt|;
name|ic
operator|->
name|ct_buf
operator|=
name|NULL
expr_stmt|;
name|ic
operator|->
name|wc_buf
operator|=
name|NULL
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|_XipReadFromIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|reply1
argument_list|,
name|sz_ximEventReply
argument_list|)
operator|<
literal|0
operator|)
operator|||
operator|(
name|reply1
operator|.
name|state
operator|==
literal|0xffff
operator|)
condition|)
block|{
goto|goto
name|_err_ret
goto|;
block|}
if|if
condition|(
name|reply1
operator|.
name|detail
operator|==
name|XIM_CALLBACK
condition|)
block|{
comment|/* 	     * Call the callback routines. 	     */
if|if
condition|(
name|_XipCallCallbacks
argument_list|(
name|ic
argument_list|)
operator|<
literal|0
condition|)
block|{
goto|goto
name|_err_ret
goto|;
block|}
block|}
elseif|else
if|if
condition|(
name|reply1
operator|.
name|detail
operator|==
name|XIM_IC
condition|)
block|{
if|if
condition|(
name|_XipReadFromIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|reply
argument_list|,
name|sz_ximCreateICReply
argument_list|)
operator|<
literal|0
condition|)
block|{
goto|goto
name|_err_ret
goto|;
block|}
if|if
condition|(
name|reply
operator|.
name|state
operator|!=
literal|0
condition|)
block|{
goto|goto
name|_err_ret
goto|;
block|}
name|ic
operator|->
name|icid
operator|=
name|reply
operator|.
name|xic
expr_stmt|;
break|break;
block|}
else|else
block|{
break|break;
block|}
block|}
comment|/*      * Attempt to get current IC data from the input manager.      */
name|_XipReceiveICValues
argument_list|(
name|ic
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ICAllMask
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XML
if|if
condition|(
name|ic
operator|->
name|xlc_num
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ic
operator|->
name|xlc_num
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|ic
operator|->
name|values
operator|.
name|current_language
argument_list|,
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
operator|->
name|xlc_db
operator|->
name|lc_name
argument_list|)
condition|)
block|{
name|ic
operator|->
name|mb
operator|=
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
expr_stmt|;
name|ic
operator|->
name|wc
operator|=
name|ic
operator|->
name|wc_temp
index|[
name|i
index|]
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|ic
operator|->
name|mb
operator|==
name|NULL
condition|)
block|{
name|ic
operator|->
name|mb
operator|=
name|ic
operator|->
name|mb_temp
index|[
literal|0
index|]
expr_stmt|;
name|ic
operator|->
name|wc
operator|=
name|ic
operator|->
name|wc_temp
index|[
literal|0
index|]
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* XML */
return|return
operator|(
operator|(
name|XIC
operator|)
name|ic
operator|)
return|;
name|_err_ret
label|:
if|if
condition|(
name|ic
operator|->
name|mb
condition|)
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|mb
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|wc
condition|)
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|wc
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XML
if|if
condition|(
name|ic
operator|->
name|xlc_num
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ic
operator|->
name|xlc_num
condition|;
name|i
operator|++
control|)
block|{
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|_XlcFreeLocale
argument_list|(
name|ic
operator|->
name|wc_temp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ic
operator|->
name|mb_temp
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|mb_temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|wc_temp
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|wc_temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ic
operator|->
name|values
operator|.
name|using_language
condition|)
name|Xfree
argument_list|(
name|ic
operator|->
name|values
operator|.
name|using_language
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* XML */
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ic
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Reset the input context.   */
end_comment

begin_function
name|wchar_t
modifier|*
name|_XipwcResetIC
parameter_list|(
name|ic
parameter_list|)
name|XIC
name|ic
decl_stmt|;
comment|/* specified the input context to reset*/
block|{
name|XipIM
name|im
init|=
name|ipIMofIC
argument_list|(
operator|(
name|XipIC
operator|)
name|ic
argument_list|)
decl_stmt|;
name|ximResetICReq
name|req
decl_stmt|;
name|ximEventReply
name|reply
decl_stmt|;
comment|/*      * If im is not specified or the file descripter is not available,      * return NULL.      */
if|if
condition|(
name|im
operator|->
name|fd
operator|<
literal|0
condition|)
block|{
return|return
operator|(
operator|(
name|wchar_t
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
name|req
operator|.
name|reqType
operator|=
name|XIM_ResetIC
expr_stmt|;
name|req
operator|.
name|length
operator|=
name|sz_ximResetICReq
expr_stmt|;
name|req
operator|.
name|xic
operator|=
operator|(
operator|(
name|XipIC
operator|)
name|ic
operator|)
operator|->
name|icid
expr_stmt|;
if|if
condition|(
operator|(
name|_XipWriteToIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|req
argument_list|,
name|sz_ximResetICReq
argument_list|)
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|_XipFlushToIM
argument_list|(
name|im
argument_list|)
operator|>=
literal|0
operator|)
condition|)
block|{
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|_XipReadFromIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|reply
argument_list|,
name|sz_ximEventReply
argument_list|)
operator|<
literal|0
operator|)
operator|||
operator|(
name|reply
operator|.
name|state
operator|==
literal|0xffff
operator|)
condition|)
block|{
return|return
operator|(
operator|(
name|wchar_t
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|reply
operator|.
name|detail
operator|==
name|XIM_CALLBACK
condition|)
block|{
comment|/* 		 * Call the callback routines. 		 */
if|if
condition|(
name|_XipCallCallbacks
argument_list|(
name|ic
argument_list|)
operator|<
literal|0
condition|)
block|{
return|return
operator|(
operator|(
name|wchar_t
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
block|}
else|else
block|{
break|break;
block|}
block|}
block|}
return|return
operator|(
operator|(
name|wchar_t
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|_XipmbResetIC
parameter_list|(
name|ic
parameter_list|)
name|XIC
name|ic
decl_stmt|;
comment|/* specified the input context to reset*/
block|{
name|XipIM
name|im
init|=
name|ipIMofIC
argument_list|(
operator|(
name|XipIC
operator|)
name|ic
argument_list|)
decl_stmt|;
name|ximResetICReq
name|req
decl_stmt|;
name|ximEventReply
name|reply
decl_stmt|;
comment|/*      * If im is not specified or the file descripter is not available,      * return NULL.      */
if|if
condition|(
name|im
operator|->
name|fd
operator|<
literal|0
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|req
operator|.
name|reqType
operator|=
name|XIM_ResetIC
expr_stmt|;
name|req
operator|.
name|length
operator|=
name|sz_ximResetICReq
expr_stmt|;
name|req
operator|.
name|xic
operator|=
operator|(
operator|(
name|XipIC
operator|)
name|ic
operator|)
operator|->
name|icid
expr_stmt|;
if|if
condition|(
operator|(
name|_XipWriteToIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|req
argument_list|,
name|sz_ximResetICReq
argument_list|)
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|_XipFlushToIM
argument_list|(
name|im
argument_list|)
operator|>=
literal|0
operator|)
condition|)
block|{
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|_XipReadFromIM
argument_list|(
name|im
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|reply
argument_list|,
name|sz_ximEventReply
argument_list|)
operator|<
literal|0
operator|)
operator|||
operator|(
name|reply
operator|.
name|state
operator|==
literal|0xffff
operator|)
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|reply
operator|.
name|detail
operator|==
name|XIM_CALLBACK
condition|)
block|{
comment|/* 		 * Call the callback routines. 		 */
if|if
condition|(
name|_XipCallCallbacks
argument_list|(
name|ic
argument_list|)
operator|<
literal|0
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
block|}
else|else
block|{
break|break;
block|}
block|}
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|XML
end_ifdef

begin_function
name|void
name|_XipChangeLocale
parameter_list|(
name|ic
parameter_list|,
name|lc_name
parameter_list|)
name|XipIC
name|ic
decl_stmt|;
name|char
modifier|*
name|lc_name
decl_stmt|;
block|{
name|XLocale
name|xlc
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ic
operator|->
name|xlc_num
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|!
name|strcmp
argument_list|(
name|lc_name
argument_list|,
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
operator|->
name|lc_lang
argument_list|)
operator|)
operator|||
operator|(
operator|!
name|strcmp
argument_list|(
name|lc_name
argument_list|,
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
operator|->
name|xlc_db
operator|->
name|lc_name
argument_list|)
operator|)
condition|)
block|{
name|ic
operator|->
name|mb
operator|=
name|ic
operator|->
name|mb_temp
index|[
name|i
index|]
expr_stmt|;
name|ic
operator|->
name|wc
operator|=
name|ic
operator|->
name|wc_temp
index|[
name|i
index|]
expr_stmt|;
return|return;
block|}
block|}
name|xlc
operator|=
name|_XlcMakeLocale
argument_list|(
name|lc_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|xlc
condition|)
block|{
name|ic
operator|->
name|mb
operator|=
name|ic
operator|->
name|mb_temp
index|[
name|ic
operator|->
name|xlc_num
index|]
operator|=
name|xlc
expr_stmt|;
name|ic
operator|->
name|wc
operator|=
name|ic
operator|->
name|wc_temp
index|[
name|ic
operator|->
name|xlc_num
index|]
operator|=
name|_XlcDupLocale
argument_list|(
name|xlc
argument_list|)
expr_stmt|;
name|ic
operator|->
name|xlc_num
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* XML */
end_comment

end_unit

