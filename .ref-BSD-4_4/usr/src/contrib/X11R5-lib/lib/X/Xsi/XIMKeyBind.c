begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XIMKeyBind.c,v 1.26 92/10/22 14:26:09 rws Exp $  */
end_comment

begin_comment
comment|/*  * Copyright 1990, 1991 by OMRON Corporation  * Copyright 1991 by the Massachusetts Institute of Technology  *  * Permission to use, copy, modify, distribute, and sell this software and its  * documentation for any purpose is hereby granted without fee, provided that  * the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the names of OMRON and MIT not be used in  * advertising or publicity pertaining to distribution of the software without  * specific, written prior permission.  OMRON and MIT make no representations  * about the suitability of this software for any purpose.  It is provided  * "as is" without express or implied warranty.  *  * OMRON AND MIT DISCLAIM ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,  * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO  * EVENT SHALL OMRON OR MIT BE LIABLE FOR ANY SPECIAL, INDIRECT OR  * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,  * DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER  * TORTUOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.   *  *	Author:	Seiji Kuwari	OMRON Corporation  *				kuwa@omron.co.jp  *				kuwa%omron.co.jp@uunet.uu.net  */
end_comment

begin_define
define|#
directive|define
name|NEED_EVENTS
end_define

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xi18nint.h"
end_include

begin_include
include|#
directive|include
file|"XIMlibint.h"
end_include

begin_include
include|#
directive|include
file|<X11/Xutil.h>
end_include

begin_function
name|int
name|_XipwcLookupString
parameter_list|(
name|supic
parameter_list|,
name|ev
parameter_list|,
name|buffer
parameter_list|,
name|nchars
parameter_list|,
name|keysym
parameter_list|,
name|status
parameter_list|)
name|XIC
name|supic
decl_stmt|;
specifier|register
name|XKeyEvent
modifier|*
name|ev
decl_stmt|;
name|wchar_t
modifier|*
name|buffer
decl_stmt|;
name|int
name|nchars
decl_stmt|;
name|KeySym
modifier|*
name|keysym
decl_stmt|;
name|Status
modifier|*
name|status
decl_stmt|;
block|{
name|XipIC
name|ic
init|=
operator|(
name|XipIC
operator|)
name|supic
decl_stmt|;
name|short
name|type
decl_stmt|,
name|string_is_mb
decl_stmt|;
name|int
name|length
decl_stmt|;
name|unsigned
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
name|ret_len
decl_stmt|,
name|scanned_bytes
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|unsigned
name|char
name|buf
index|[
literal|32
index|]
decl_stmt|;
name|KeySym
name|tmp_ks
decl_stmt|;
ifndef|#
directive|ifndef
name|X_WCHAR
name|char
modifier|*
name|mbuf
decl_stmt|;
endif|#
directive|endif
if|if
condition|(
name|ev
operator|->
name|keycode
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ev
operator|->
name|state
operator|>
literal|0
condition|)
block|{
name|_XipGetOverflowICQueue
argument_list|(
name|ic
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|length
argument_list|,
operator|&
name|tmp_ks
argument_list|,
operator|&
name|string_is_mb
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|ptr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_XipGetNextICQueue
argument_list|(
name|ic
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|length
argument_list|,
operator|&
name|tmp_ks
argument_list|,
operator|&
name|string_is_mb
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|ptr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|type
operator|==
name|XIM_STRING
operator|||
operator|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|length
operator|>
literal|0
operator|)
condition|)
block|{
ifdef|#
directive|ifdef
name|X_WCHAR
name|ret_len
operator|=
name|nchars
expr_stmt|;
if|if
condition|(
name|string_is_mb
condition|)
block|{
name|ret
operator|=
name|_XConvertMBToWC
argument_list|(
name|ic
operator|->
name|wc
argument_list|,
name|ptr
argument_list|,
name|length
argument_list|,
operator|(
name|wchar
operator|*
operator|)
name|buffer
argument_list|,
operator|&
name|ret_len
argument_list|,
operator|&
name|scanned_bytes
argument_list|,
operator|(
name|_State
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ret
operator|=
name|_XConvertCTToWC
argument_list|(
name|ic
operator|->
name|wc
argument_list|,
name|ptr
argument_list|,
name|length
argument_list|,
operator|(
name|wchar
operator|*
operator|)
name|buffer
argument_list|,
operator|&
name|ret_len
argument_list|,
operator|&
name|scanned_bytes
argument_list|,
operator|(
name|_State
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|ret_len
operator|=
name|length
operator|*
literal|2
expr_stmt|;
name|mbuf
operator|=
name|_XAllocScratch
argument_list|(
name|ev
operator|->
name|display
argument_list|,
name|ret_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|string_is_mb
condition|)
block|{
name|ret
operator|=
literal|0
expr_stmt|;
name|strncpy
argument_list|(
name|mbuf
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ptr
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|ret_len
operator|=
name|length
expr_stmt|;
block|}
else|else
block|{
name|ret
operator|=
name|_XConvertCTToMB
argument_list|(
name|ic
operator|->
name|mb
argument_list|,
name|ptr
argument_list|,
name|length
argument_list|,
name|mbuf
argument_list|,
operator|&
name|ret_len
argument_list|,
operator|&
name|scanned_bytes
argument_list|,
operator|(
name|_State
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ret
operator|>=
literal|0
condition|)
block|{
ifdef|#
directive|ifdef
name|macII
name|ret_len
operator|=
literal|0
expr_stmt|;
else|#
directive|else
name|mbuf
index|[
name|ret_len
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ret_len
operator|=
name|mbstowcs
argument_list|(
name|buffer
argument_list|,
name|mbuf
argument_list|,
name|nchars
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|ret_len
operator|==
name|nchars
condition|)
name|ret
operator|=
name|BadBuffer
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|ret
operator|==
name|BadBuffer
condition|)
block|{
name|_XipSaveOverflowICQueue
argument_list|(
name|ic
argument_list|,
name|type
argument_list|,
name|length
argument_list|,
name|tmp_ks
argument_list|,
name|string_is_mb
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
name|ev
operator|->
name|state
operator|=
literal|1
expr_stmt|;
operator|*
name|status
operator|=
name|XBufferOverflow
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupBoth
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupChars
expr_stmt|;
block|}
return|return
operator|(
name|ret_len
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupKeySym
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
else|else
block|{
name|ret_len
operator|=
name|XLookupString
argument_list|(
name|ev
argument_list|,
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
literal|32
argument_list|,
operator|&
name|tmp_ks
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret_len
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|tmp_ks
operator|!=
name|NoSymbol
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupBoth
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupChars
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|X_WCHAR
comment|/* XXX BUG Need to save current status */
name|ret
operator|=
name|_XConvertMBToWC
argument_list|(
name|ic
operator|->
name|wc
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
argument_list|,
name|ret_len
argument_list|,
operator|(
name|wchar
operator|*
operator|)
name|buffer
argument_list|,
operator|&
name|nchars
argument_list|,
operator|&
name|scanned_bytes
argument_list|,
operator|(
name|_State
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|BadBuffer
condition|)
block|{
operator|*
name|status
operator|=
name|XBufferOverflow
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|ret_len
operator|=
name|nchars
expr_stmt|;
comment|/* XXX BUG Need to restore saved status */
else|#
directive|else
ifdef|#
directive|ifdef
name|macII
name|ret_len
operator|=
literal|0
expr_stmt|;
else|#
directive|else
name|buf
index|[
name|ret_len
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ret_len
operator|=
name|mbstowcs
argument_list|(
name|buffer
argument_list|,
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|nchars
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
block|}
else|else
block|{
if|if
condition|(
name|tmp_ks
operator|!=
name|NoSymbol
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupKeySym
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
block|}
block|}
return|return
operator|(
name|ret_len
operator|)
return|;
block|}
block|}
end_function

begin_function
name|int
name|_XipmbLookupString
parameter_list|(
name|supic
parameter_list|,
name|ev
parameter_list|,
name|buffer
parameter_list|,
name|nbytes
parameter_list|,
name|keysym
parameter_list|,
name|status
parameter_list|)
name|XIC
name|supic
decl_stmt|;
specifier|register
name|XKeyEvent
modifier|*
name|ev
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|int
name|nbytes
decl_stmt|;
name|KeySym
modifier|*
name|keysym
decl_stmt|;
name|Status
modifier|*
name|status
decl_stmt|;
block|{
name|XipIC
name|ic
init|=
operator|(
name|XipIC
operator|)
name|supic
decl_stmt|;
name|short
name|type
decl_stmt|,
name|string_is_mb
decl_stmt|;
name|int
name|length
decl_stmt|;
name|unsigned
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
name|ret_len
decl_stmt|,
name|scanned_bytes
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|KeySym
name|tmp_ks
decl_stmt|;
if|if
condition|(
name|ev
operator|->
name|keycode
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ev
operator|->
name|state
operator|>
literal|0
condition|)
block|{
name|_XipGetOverflowICQueue
argument_list|(
name|ic
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|length
argument_list|,
operator|&
name|tmp_ks
argument_list|,
operator|&
name|string_is_mb
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|ptr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_XipGetNextICQueue
argument_list|(
name|ic
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|length
argument_list|,
operator|&
name|tmp_ks
argument_list|,
operator|&
name|string_is_mb
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|ptr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|type
operator|==
name|XIM_STRING
operator|||
operator|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|length
operator|>
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|string_is_mb
condition|)
block|{
if|if
condition|(
name|nbytes
operator|<
name|length
condition|)
block|{
name|_XipSaveOverflowICQueue
argument_list|(
name|ic
argument_list|,
name|type
argument_list|,
name|length
argument_list|,
name|tmp_ks
argument_list|,
name|string_is_mb
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
name|ev
operator|->
name|state
operator|=
literal|1
expr_stmt|;
operator|*
name|status
operator|=
name|XBufferOverflow
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|buffer
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ptr
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|<
name|nbytes
condition|)
name|buffer
index|[
name|length
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ret_len
operator|=
name|length
expr_stmt|;
block|}
else|else
block|{
name|ret_len
operator|=
name|nbytes
expr_stmt|;
name|ret
operator|=
name|_XConvertCTToMB
argument_list|(
name|ic
operator|->
name|mb
argument_list|,
name|ptr
argument_list|,
name|length
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buffer
argument_list|,
operator|&
name|ret_len
argument_list|,
operator|&
name|scanned_bytes
argument_list|,
operator|(
name|_State
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|BadBuffer
condition|)
block|{
name|_XipSaveOverflowICQueue
argument_list|(
name|ic
argument_list|,
name|type
argument_list|,
name|length
argument_list|,
name|tmp_ks
argument_list|,
name|string_is_mb
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
name|ev
operator|->
name|state
operator|=
literal|1
expr_stmt|;
operator|*
name|status
operator|=
name|XBufferOverflow
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
if|if
condition|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupBoth
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupChars
expr_stmt|;
block|}
return|return
operator|(
name|ret_len
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupKeySym
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
else|else
block|{
name|ret_len
operator|=
name|XLookupString
argument_list|(
name|ev
argument_list|,
name|buffer
argument_list|,
name|nbytes
argument_list|,
operator|&
name|tmp_ks
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret_len
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|tmp_ks
operator|!=
name|NoSymbol
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupBoth
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupChars
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|tmp_ks
operator|!=
name|NoSymbol
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupKeySym
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
block|}
block|}
return|return
operator|(
name|ret_len
operator|)
return|;
block|}
block|}
end_function

begin_function
name|int
name|_XipctLookupString
parameter_list|(
name|supic
parameter_list|,
name|ev
parameter_list|,
name|buffer
parameter_list|,
name|nbytes
parameter_list|,
name|keysym
parameter_list|,
name|status
parameter_list|)
name|XIC
name|supic
decl_stmt|;
specifier|register
name|XKeyEvent
modifier|*
name|ev
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|int
name|nbytes
decl_stmt|;
name|KeySym
modifier|*
name|keysym
decl_stmt|;
name|Status
modifier|*
name|status
decl_stmt|;
block|{
name|XipIC
name|ic
init|=
operator|(
name|XipIC
operator|)
name|supic
decl_stmt|;
name|short
name|type
decl_stmt|,
name|string_is_mb
decl_stmt|;
name|int
name|length
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
name|ret_len
decl_stmt|,
name|scanned_bytes
decl_stmt|;
name|KeySym
name|tmp_ks
decl_stmt|;
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|ev
operator|->
name|keycode
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ev
operator|->
name|state
operator|>
literal|0
condition|)
block|{
name|_XipGetOverflowICQueue
argument_list|(
name|ic
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|length
argument_list|,
operator|&
name|tmp_ks
argument_list|,
operator|&
name|string_is_mb
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|ptr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_XipGetNextICQueue
argument_list|(
name|ic
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|length
argument_list|,
operator|&
name|tmp_ks
argument_list|,
operator|&
name|string_is_mb
argument_list|,
operator|&
name|ptr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|type
operator|==
name|XIM_STRING
operator|||
operator|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|length
operator|>
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|string_is_mb
condition|)
block|{
name|ret_len
operator|=
name|nbytes
expr_stmt|;
name|ret
operator|=
name|_XConvertMBToCT
argument_list|(
name|ic
operator|->
name|mb
argument_list|,
name|ptr
argument_list|,
name|length
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buffer
argument_list|,
operator|&
name|ret_len
argument_list|,
operator|&
name|scanned_bytes
argument_list|,
operator|(
name|_State
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|BadBuffer
condition|)
block|{
name|_XipSaveOverflowICQueue
argument_list|(
name|ic
argument_list|,
name|type
argument_list|,
name|length
argument_list|,
name|tmp_ks
argument_list|,
name|string_is_mb
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
name|ev
operator|->
name|state
operator|=
literal|1
expr_stmt|;
operator|*
name|status
operator|=
name|XBufferOverflow
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|length
operator|>
name|nbytes
condition|)
block|{
name|_XipSaveOverflowICQueue
argument_list|(
name|ic
argument_list|,
name|type
argument_list|,
name|length
argument_list|,
name|tmp_ks
argument_list|,
name|string_is_mb
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
name|ev
operator|->
name|state
operator|=
literal|1
expr_stmt|;
operator|*
name|status
operator|=
name|XBufferOverflow
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|buffer
argument_list|,
name|ptr
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|<
name|nbytes
condition|)
name|buffer
index|[
name|length
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ret_len
operator|=
name|length
expr_stmt|;
block|}
if|if
condition|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupBoth
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupChars
expr_stmt|;
block|}
return|return
operator|(
name|ret_len
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|type
operator|==
name|XIM_KEYSYM
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupKeySym
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
else|else
block|{
name|ret_len
operator|=
name|XLookupString
argument_list|(
name|ev
argument_list|,
name|buffer
argument_list|,
name|nbytes
argument_list|,
operator|&
name|tmp_ks
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret_len
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|tmp_ks
operator|!=
name|NoSymbol
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupBoth
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupChars
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|tmp_ks
operator|!=
name|NoSymbol
operator|&&
name|keysym
condition|)
block|{
operator|*
name|keysym
operator|=
name|tmp_ks
expr_stmt|;
operator|*
name|status
operator|=
name|XLookupKeySym
expr_stmt|;
block|}
else|else
block|{
operator|*
name|status
operator|=
name|XLookupNone
expr_stmt|;
block|}
block|}
return|return
operator|(
name|ret_len
operator|)
return|;
block|}
block|}
end_function

end_unit

