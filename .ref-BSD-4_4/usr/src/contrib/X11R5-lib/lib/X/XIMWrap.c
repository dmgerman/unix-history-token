begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XIMWrap.c,v 11.4 91/04/07 18:59:21 rws Exp $  */
end_comment

begin_comment
comment|/*  * Copyright 1991 by the Massachusetts Institute of Technology  * Copyright 1991 by the Open Software Foundation  *  * Permission to use, copy, modify, distribute, and sell this software and its  * documentation for any purpose is hereby granted without fee, provided that  * the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the names of Open Software Foundation and M.I.T.  * not be used in advertising or publicity pertaining to distribution of the  * software without specific, written prior permission.  Open Software  * Foundation and M.I.T. make no representations about the suitability of this  * software for any purpose.  It is provided "as is" without express or  * implied warranty.  *  * OPEN SOFTWARE FOUNDATION AND M.I.T. DISCLAIM ALL WARRANTIES WITH REGARD TO  * THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND  * FITNESS, IN NO EVENT SHALL OPEN SOFTWARE FOUNDATIONN OR M.I.T. BE  * LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES   * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *   *		 M. Collins		OSF    */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xlcint.h"
end_include

begin_comment
comment|/*  * Compile the resource list. (XIMResourceList ---> XIMrmResourceList)  */
end_comment

begin_function
name|void
name|_XIMCompileResourceList
parameter_list|(
name|res
parameter_list|,
name|num_res
parameter_list|)
specifier|register
name|XIMResourceList
name|res
decl_stmt|;
name|unsigned
name|int
name|num_res
decl_stmt|;
block|{
specifier|register
name|unsigned
name|int
name|count
decl_stmt|;
define|#
directive|define
name|xrmres
value|((XIMrmResourceList) res)
for|for
control|(
name|count
operator|=
literal|0
init|;
name|count
operator|<
name|num_res
condition|;
name|res
operator|++
operator|,
name|count
operator|++
control|)
block|{
name|xrmres
operator|->
name|xrm_name
operator|=
name|XrmPermStringToQuark
argument_list|(
name|res
operator|->
name|resource_name
argument_list|)
expr_stmt|;
name|xrmres
operator|->
name|xrm_offset
operator|=
operator|-
name|res
operator|->
name|resource_offset
operator|-
literal|1
expr_stmt|;
block|}
undef|#
directive|undef
name|xrmres
block|}
end_function

begin_function
name|void
name|_XCopyToArg
parameter_list|(
name|src
parameter_list|,
name|dst
parameter_list|,
name|size
parameter_list|)
name|XPointer
name|src
decl_stmt|;
name|XPointer
modifier|*
name|dst
decl_stmt|;
specifier|register
name|unsigned
name|int
name|size
decl_stmt|;
block|{
if|if
condition|(
operator|!
operator|*
name|dst
condition|)
block|{
union|union
block|{
name|long
name|longval
decl_stmt|;
name|short
name|shortval
decl_stmt|;
name|char
name|charval
decl_stmt|;
name|char
modifier|*
name|charptr
decl_stmt|;
name|XPointer
name|ptr
decl_stmt|;
block|}
name|u
union|;
if|if
condition|(
name|size
operator|<=
sizeof|sizeof
argument_list|(
name|XPointer
argument_list|)
condition|)
block|{
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|u
argument_list|,
operator|(
name|int
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|==
sizeof|sizeof
argument_list|(
name|long
argument_list|)
condition|)
operator|*
name|dst
operator|=
operator|(
name|XPointer
operator|)
name|u
operator|.
name|longval
expr_stmt|;
elseif|else
if|if
condition|(
name|size
operator|==
sizeof|sizeof
argument_list|(
name|short
argument_list|)
condition|)
operator|*
name|dst
operator|=
operator|(
name|XPointer
operator|)
name|u
operator|.
name|shortval
expr_stmt|;
elseif|else
if|if
condition|(
name|size
operator|==
sizeof|sizeof
argument_list|(
name|char
argument_list|)
condition|)
operator|*
name|dst
operator|=
operator|(
name|XPointer
operator|)
name|u
operator|.
name|charval
expr_stmt|;
elseif|else
if|if
condition|(
name|size
operator|==
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
condition|)
operator|*
name|dst
operator|=
operator|(
name|XPointer
operator|)
name|u
operator|.
name|charptr
expr_stmt|;
elseif|else
if|if
condition|(
name|size
operator|==
sizeof|sizeof
argument_list|(
name|XPointer
argument_list|)
condition|)
operator|*
name|dst
operator|=
operator|(
name|XPointer
operator|)
name|u
operator|.
name|ptr
expr_stmt|;
else|else
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|char
operator|*
operator|)
name|dst
argument_list|,
operator|(
name|int
operator|)
name|size
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|char
operator|*
operator|)
name|dst
argument_list|,
operator|(
name|int
operator|)
name|size
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|*
name|dst
argument_list|,
operator|(
name|int
operator|)
name|size
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Connects to an input method matching current locale specification, creates  * a XIM object and return a pointer the newly created XIM back to the caller.  */
end_comment

begin_function
name|XIM
name|XOpenIM
parameter_list|(
name|display
parameter_list|,
name|rdb
parameter_list|,
name|res_name
parameter_list|,
name|res_class
parameter_list|)
name|Display
modifier|*
name|display
decl_stmt|;
name|XrmDatabase
name|rdb
decl_stmt|;
name|char
modifier|*
name|res_name
decl_stmt|;
name|char
modifier|*
name|res_class
decl_stmt|;
block|{
name|XLCd
name|lcd
init|=
name|_XlcCurrentLC
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|lcd
condition|)
return|return
operator|(
name|XIM
operator|)
name|NULL
return|;
return|return
call|(
modifier|*
name|lcd
operator|->
name|methods
operator|->
name|open_im
call|)
argument_list|(
name|lcd
argument_list|,
name|display
argument_list|,
name|rdb
argument_list|,
name|res_name
argument_list|,
name|res_class
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Close the connection to the input manager, and free the XIM structure  */
end_comment

begin_function
name|Status
name|XCloseIM
parameter_list|(
name|im
parameter_list|)
name|XIM
name|im
decl_stmt|;
block|{
name|Status
name|s
decl_stmt|;
name|XIC
name|ic
decl_stmt|;
name|s
operator|=
call|(
name|im
operator|->
name|methods
operator|->
name|close
call|)
argument_list|(
name|im
argument_list|)
expr_stmt|;
for|for
control|(
name|ic
operator|=
name|im
operator|->
name|core
operator|.
name|ic_chain
init|;
name|ic
condition|;
name|ic
operator|=
name|ic
operator|->
name|core
operator|.
name|next
control|)
name|ic
operator|->
name|core
operator|.
name|im
operator|=
operator|(
name|XIM
operator|)
name|NULL
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|im
argument_list|)
expr_stmt|;
return|return
operator|(
name|s
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Return the Display associated with the input method.  */
end_comment

begin_function
name|Display
modifier|*
name|XDisplayOfIM
parameter_list|(
name|im
parameter_list|)
name|XIM
name|im
decl_stmt|;
block|{
return|return
name|im
operator|->
name|core
operator|.
name|display
return|;
block|}
end_function

begin_comment
comment|/*  * Return the Locale associated with the input method.  */
end_comment

begin_function
name|char
modifier|*
name|XLocaleOfIM
parameter_list|(
name|im
parameter_list|)
name|XIM
name|im
decl_stmt|;
block|{
return|return
name|im
operator|->
name|core
operator|.
name|lcd
operator|->
name|core
operator|.
name|name
return|;
block|}
end_function

end_unit

