begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: WMGeom.c,v 1.4 91/01/06 11:43:59 rws Exp $ */
end_comment

begin_comment
comment|/* Copyright 1989 Massachusetts Institute of Technology */
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xutil.h"
end_include

begin_function_decl
specifier|static
name|int
name|_GeometryMaskToGravity
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*  * This routine given a user supplied positional argument and a default  * argument (fully qualified) will return the position the window should take  * as well as the gravity to be set in the WM_NORMAL_HINTS size hints.  * Always sets all return values and returns a mask describing which fields  * were set by the user or'ed with whether or not the x and y values should  * be considered "negative".  */
end_comment

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_function
name|int
name|XWMGeometry
parameter_list|(
name|Display
modifier|*
name|dpy
parameter_list|,
comment|/* user's display connection */
name|int
name|screen
parameter_list|,
comment|/* screen on which to do computation */
name|_Xconst
name|char
modifier|*
name|user_geom
parameter_list|,
comment|/* user provided geometry spec */
name|_Xconst
name|char
modifier|*
name|def_geom
parameter_list|,
comment|/* default geometry spec for window */
name|unsigned
name|int
name|bwidth
parameter_list|,
comment|/* border width */
name|XSizeHints
modifier|*
name|hints
parameter_list|,
comment|/* usually WM_NORMAL_HINTS */
name|int
modifier|*
name|x_return
parameter_list|,
comment|/* location of window */
name|int
modifier|*
name|y_return
parameter_list|,
comment|/* location of window */
name|int
modifier|*
name|width_return
parameter_list|,
comment|/* size of window */
name|int
modifier|*
name|height_return
parameter_list|,
comment|/* size of window */
name|int
modifier|*
name|gravity_return
parameter_list|)
comment|/* gravity of window */
else|#
directive|else
function|int XWMGeometry
parameter_list|(
name|dpy
parameter_list|,
name|screen
parameter_list|,
name|user_geom
parameter_list|,
name|def_geom
parameter_list|,
name|bwidth
parameter_list|,
name|hints
parameter_list|,
name|x_return
parameter_list|,
name|y_return
parameter_list|,
name|width_return
parameter_list|,
name|height_return
parameter_list|,
name|gravity_return
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
comment|/* user's display connection */
name|int
name|screen
decl_stmt|;
comment|/* screen on which to do computation */
name|char
modifier|*
name|user_geom
decl_stmt|;
comment|/* user provided geometry spec */
name|char
modifier|*
name|def_geom
decl_stmt|;
comment|/* default geometry spec for window */
name|unsigned
name|int
name|bwidth
decl_stmt|;
comment|/* border width */
name|XSizeHints
modifier|*
name|hints
decl_stmt|;
comment|/* usually WM_NORMAL_HINTS */
name|int
modifier|*
name|x_return
decl_stmt|,
decl|*
name|y_return
decl_stmt|;
end_function

begin_comment
comment|/* location of window */
end_comment

begin_decl_stmt
name|int
modifier|*
name|width_return
decl_stmt|,
modifier|*
name|height_return
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* size of window */
end_comment

begin_decl_stmt
name|int
modifier|*
name|gravity_return
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gravity of window */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_block
block|{
name|int
name|ux
decl_stmt|,
name|uy
decl_stmt|;
comment|/* returned values from parse */
name|unsigned
name|int
name|uwidth
decl_stmt|,
name|uheight
decl_stmt|;
comment|/* returned values from parse */
name|int
name|umask
decl_stmt|;
comment|/* parse mask of returned values */
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
comment|/* default values from parse */
name|unsigned
name|int
name|dwidth
decl_stmt|,
name|dheight
decl_stmt|;
comment|/* default values from parse */
name|int
name|dmask
decl_stmt|;
comment|/* parse mask of returned values */
name|int
name|base_width
decl_stmt|,
name|base_height
decl_stmt|;
comment|/* valid amounts */
name|int
name|min_width
decl_stmt|,
name|min_height
decl_stmt|;
comment|/* valid amounts */
name|int
name|width_inc
decl_stmt|,
name|height_inc
decl_stmt|;
comment|/* valid amounts */
name|int
name|rx
decl_stmt|,
name|ry
decl_stmt|,
name|rwidth
decl_stmt|,
name|rheight
decl_stmt|;
comment|/* return values */
name|int
name|rmask
decl_stmt|;
comment|/* return mask */
comment|/*      * Get the base sizes and increments.  Section 4.1.2.3 of the ICCCM      * states that the base and minimum sizes are defaults for each other.      * If neither is given, then the base sizes should be 0.  These parameters      * control the sets of sizes that window managers should allow for the       * window according to the following formulae:      *      *          width = base_width  + (i * width_inc)      *         height = base_height + (j * height_inc)      */
name|base_width
operator|=
operator|(
operator|(
name|hints
operator|->
name|flags
operator|&
name|PBaseSize
operator|)
condition|?
name|hints
operator|->
name|base_width
else|:
operator|(
operator|(
name|hints
operator|->
name|flags
operator|&
name|PMinSize
operator|)
condition|?
name|hints
operator|->
name|min_width
else|:
literal|0
operator|)
operator|)
expr_stmt|;
name|base_height
operator|=
operator|(
operator|(
name|hints
operator|->
name|flags
operator|&
name|PBaseSize
operator|)
condition|?
name|hints
operator|->
name|base_height
else|:
operator|(
operator|(
name|hints
operator|->
name|flags
operator|&
name|PMinSize
operator|)
condition|?
name|hints
operator|->
name|min_height
else|:
literal|0
operator|)
operator|)
expr_stmt|;
name|min_width
operator|=
operator|(
operator|(
name|hints
operator|->
name|flags
operator|&
name|PMinSize
operator|)
condition|?
name|hints
operator|->
name|min_width
else|:
name|base_width
operator|)
expr_stmt|;
name|min_height
operator|=
operator|(
operator|(
name|hints
operator|->
name|flags
operator|&
name|PMinSize
operator|)
condition|?
name|hints
operator|->
name|min_height
else|:
name|base_height
operator|)
expr_stmt|;
name|width_inc
operator|=
operator|(
name|hints
operator|->
name|flags
operator|&
name|PResizeInc
operator|)
condition|?
name|hints
operator|->
name|width_inc
else|:
literal|1
expr_stmt|;
name|height_inc
operator|=
operator|(
name|hints
operator|->
name|flags
operator|&
name|PResizeInc
operator|)
condition|?
name|hints
operator|->
name|height_inc
else|:
literal|1
expr_stmt|;
comment|/*      * parse the two geometry masks      */
name|rmask
operator|=
name|umask
operator|=
name|XParseGeometry
argument_list|(
name|user_geom
argument_list|,
operator|&
name|ux
argument_list|,
operator|&
name|uy
argument_list|,
operator|&
name|uwidth
argument_list|,
operator|&
name|uheight
argument_list|)
expr_stmt|;
name|dmask
operator|=
name|XParseGeometry
argument_list|(
name|def_geom
argument_list|,
operator|&
name|dx
argument_list|,
operator|&
name|dy
argument_list|,
operator|&
name|dwidth
argument_list|,
operator|&
name|dheight
argument_list|)
expr_stmt|;
comment|/*      * get the width and height:      *     1.  if user-specified, then take that value      *     2.  else, if program-specified, then take that value      *     3.  else, take 1      *     4.  multiply by the size increment      *     5.  and add to the base size      */
name|rwidth
operator|=
operator|(
operator|(
operator|(
operator|(
name|umask
operator|&
name|WidthValue
operator|)
condition|?
name|uwidth
else|:
operator|(
operator|(
name|dmask
operator|&
name|WidthValue
operator|)
condition|?
name|dwidth
else|:
literal|1
operator|)
operator|)
operator|*
name|width_inc
operator|)
operator|+
name|base_width
operator|)
expr_stmt|;
name|rheight
operator|=
operator|(
operator|(
operator|(
operator|(
name|umask
operator|&
name|HeightValue
operator|)
condition|?
name|uheight
else|:
operator|(
operator|(
name|dmask
operator|&
name|HeightValue
operator|)
condition|?
name|dheight
else|:
literal|1
operator|)
operator|)
operator|*
name|height_inc
operator|)
operator|+
name|base_height
operator|)
expr_stmt|;
comment|/*      * Make sure computed size is within limits.  Note that we always do the      * lower bounds check since the base size (which defaults to 0) should      * be used if a minimum size isn't specified.      */
if|if
condition|(
name|rwidth
operator|<
name|min_width
condition|)
name|rwidth
operator|=
name|min_width
expr_stmt|;
if|if
condition|(
name|rheight
operator|<
name|min_height
condition|)
name|rheight
operator|=
name|min_height
expr_stmt|;
if|if
condition|(
name|hints
operator|->
name|flags
operator|&
name|PMaxSize
condition|)
block|{
if|if
condition|(
name|rwidth
operator|>
name|hints
operator|->
name|max_width
condition|)
name|rwidth
operator|=
name|hints
operator|->
name|max_width
expr_stmt|;
if|if
condition|(
name|rheight
operator|>
name|hints
operator|->
name|max_height
condition|)
name|rheight
operator|=
name|hints
operator|->
name|max_height
expr_stmt|;
block|}
comment|/*      * Compute the location.  Set the negative flags in the return mask      * (and watch out for borders), if necessary.      */
if|if
condition|(
name|umask
operator|&
name|XValue
condition|)
block|{
name|rx
operator|=
operator|(
operator|(
name|umask
operator|&
name|XNegative
operator|)
condition|?
operator|(
name|DisplayWidth
argument_list|(
name|dpy
argument_list|,
name|screen
argument_list|)
operator|+
name|ux
operator|-
name|rwidth
operator|-
literal|2
operator|*
name|bwidth
operator|)
else|:
name|ux
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|dmask
operator|&
name|XValue
condition|)
block|{
if|if
condition|(
name|dmask
operator|&
name|XNegative
condition|)
block|{
name|rx
operator|=
operator|(
name|DisplayWidth
argument_list|(
name|dpy
argument_list|,
name|screen
argument_list|)
operator|+
name|dx
operator|-
name|rwidth
operator|-
literal|2
operator|*
name|bwidth
operator|)
expr_stmt|;
name|rmask
operator||=
name|XNegative
expr_stmt|;
block|}
else|else
name|rx
operator|=
name|dx
expr_stmt|;
block|}
else|else
block|{
name|rx
operator|=
literal|0
expr_stmt|;
comment|/* gotta choose something... */
block|}
if|if
condition|(
name|umask
operator|&
name|YValue
condition|)
block|{
name|ry
operator|=
operator|(
operator|(
name|umask
operator|&
name|YNegative
operator|)
condition|?
operator|(
name|DisplayHeight
argument_list|(
name|dpy
argument_list|,
name|screen
argument_list|)
operator|+
name|uy
operator|-
name|rheight
operator|-
literal|2
operator|*
name|bwidth
operator|)
else|:
name|uy
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|dmask
operator|&
name|YValue
condition|)
block|{
if|if
condition|(
name|dmask
operator|&
name|YNegative
condition|)
block|{
name|ry
operator|=
operator|(
name|DisplayHeight
argument_list|(
name|dpy
argument_list|,
name|screen
argument_list|)
operator|+
name|dy
operator|-
name|rheight
operator|-
literal|2
operator|*
name|bwidth
operator|)
expr_stmt|;
name|rmask
operator||=
name|YNegative
expr_stmt|;
block|}
else|else
name|ry
operator|=
name|dy
expr_stmt|;
block|}
else|else
block|{
name|ry
operator|=
literal|0
expr_stmt|;
comment|/* gotta choose something... */
block|}
comment|/*      * All finished, so set the return variables.      */
operator|*
name|x_return
operator|=
name|rx
expr_stmt|;
operator|*
name|y_return
operator|=
name|ry
expr_stmt|;
operator|*
name|width_return
operator|=
name|rwidth
expr_stmt|;
operator|*
name|height_return
operator|=
name|rheight
expr_stmt|;
operator|*
name|gravity_return
operator|=
name|_GeometryMaskToGravity
argument_list|(
name|rmask
argument_list|)
expr_stmt|;
return|return
name|rmask
return|;
block|}
end_block

begin_function
specifier|static
name|int
name|_GeometryMaskToGravity
parameter_list|(
name|mask
parameter_list|)
name|int
name|mask
decl_stmt|;
block|{
switch|switch
condition|(
name|mask
operator|&
operator|(
name|XNegative
operator||
name|YNegative
operator|)
condition|)
block|{
case|case
literal|0
case|:
return|return
name|NorthWestGravity
return|;
case|case
name|XNegative
case|:
return|return
name|NorthEastGravity
return|;
case|case
name|YNegative
case|:
return|return
name|SouthWestGravity
return|;
default|default:
return|return
name|SouthEastGravity
return|;
block|}
block|}
end_function

end_unit

