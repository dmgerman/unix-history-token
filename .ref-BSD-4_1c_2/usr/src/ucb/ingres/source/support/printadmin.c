begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<ingres.h>
end_include

begin_include
include|#
directive|include
file|<access.h>
end_include

begin_include
include|#
directive|include
file|<sccs.h>
end_include

begin_macro
name|SCCSID
argument_list|(
argument|@(#)printadmin.c
literal|7.1
literal|2
argument|/
literal|5
argument|/
literal|81
argument_list|)
end_macro

begin_decl_stmt
name|short
name|tTdbu
index|[
literal|100
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|admin
name|Admin
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|,
name|fp
decl_stmt|;
specifier|register
name|char
modifier|*
name|db
decl_stmt|;
specifier|extern
name|char
modifier|*
name|Dbpath
decl_stmt|;
specifier|extern
name|char
modifier|*
name|Parmvect
index|[]
decl_stmt|,
modifier|*
name|Flagvect
index|[]
decl_stmt|;
name|argv
index|[
name|argc
index|]
operator|=
name|NULL
expr_stmt|;
ifdef|#
directive|ifdef
name|xSTR1
name|tTrace
argument_list|(
name|argv
argument_list|,
literal|'T'
argument_list|,
name|tTdbu
argument_list|,
literal|100
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|i
operator|=
name|initucode
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|db
operator|=
name|Parmvect
index|[
literal|0
index|]
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|5
case|:
break|break;
case|case
literal|1
case|:
case|case
literal|6
case|:
name|printf
argument_list|(
literal|"Database %s does not exist\n"
argument_list|,
name|db
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"You are not authorized to access this database\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"You are not a valid INGRES user\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
case|case
literal|4
case|:
name|printf
argument_list|(
literal|"No database name specified\n"
argument_list|)
expr_stmt|;
name|usage
label|:
name|printf
argument_list|(
literal|"usage: printadmin database\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
default|default:
name|syserr
argument_list|(
literal|"initucode %d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Flagvect
index|[
literal|0
index|]
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"No flags are allowed for this command\n"
argument_list|)
expr_stmt|;
goto|goto
name|usage
goto|;
block|}
if|if
condition|(
name|Parmvect
index|[
literal|1
index|]
operator|!=
name|NULL
condition|)
goto|goto
name|usage
goto|;
if|if
condition|(
name|chdir
argument_list|(
name|Dbpath
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"cannot access database %s"
argument_list|,
name|db
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|xTTR2
if|if
condition|(
name|tTf
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
condition|)
name|printf
argument_list|(
literal|"entered database %s\n"
argument_list|,
name|Dbpath
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Admin struct has been filled in by initucode */
name|printf
argument_list|(
literal|"Database %s, Dba %.2s, Adflags %o\n"
argument_list|,
name|db
argument_list|,
name|Admin
operator|.
name|adhdr
operator|.
name|adowner
argument_list|,
name|Admin
operator|.
name|adhdr
operator|.
name|adflags
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Code %d, adlen %d, adreldsz %d, adattdsz %d\n"
argument_list|,
name|Admin
operator|.
name|adhdr
operator|.
name|adversion
argument_list|,
name|Admin
operator|.
name|adhdr
operator|.
name|adlength
argument_list|,
name|Admin
operator|.
name|adhdr
operator|.
name|adreldsz
argument_list|,
name|Admin
operator|.
name|adhdr
operator|.
name|adattdsz
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\n"
argument_list|)
expr_stmt|;
name|printdesc
argument_list|(
operator|&
name|Admin
operator|.
name|adreld
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\n"
argument_list|)
expr_stmt|;
name|printdesc
argument_list|(
operator|&
name|Admin
operator|.
name|adattd
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|rubproc
argument_list|()
end_macro

begin_block
block|{
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

