begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<ingres.h>
end_include

begin_include
include|#
directive|include
file|<symbol.h>
end_include

begin_include
include|#
directive|include
file|<tree.h>
end_include

begin_include
include|#
directive|include
file|<aux.h>
end_include

begin_include
include|#
directive|include
file|<sccs.h>
end_include

begin_macro
name|SCCSID
argument_list|(
argument|@(#)treepr.c
literal|7.1
literal|2
argument|/
literal|5
argument|/
literal|81
argument_list|)
end_macro

begin_comment
comment|/* **  TREEPR -- print tree for debugging ** **	This routine prints a tree for debugging. ** **	Parameters: **		tree -- root of tree to be printed ** **	Returns: **		none ** **	Side Effects: **		output to terminal */
end_comment

begin_macro
name|treepr
argument_list|(
argument|tree
argument_list|)
end_macro

begin_decl_stmt
name|QTREE
modifier|*
name|tree
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|QTREE
modifier|*
name|t
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|t
operator|=
name|tree
expr_stmt|;
name|printf
argument_list|(
literal|"Querytree @ %x:\n"
argument_list|,
name|t
argument_list|)
expr_stmt|;
comment|/* print range table */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXVAR
operator|+
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|Qt
operator|.
name|qt_rangev
index|[
name|i
index|]
operator|.
name|rngvdesc
operator|==
name|NULL
condition|)
continue|continue;
name|printf
argument_list|(
literal|"range of %d is %.14s\n"
argument_list|,
name|i
argument_list|,
name|Qt
operator|.
name|qt_rangev
index|[
name|i
index|]
operator|.
name|rngvdesc
operator|->
name|reldum
operator|.
name|relid
argument_list|)
expr_stmt|;
block|}
comment|/* print query type */
if|if
condition|(
name|Qt
operator|.
name|qt_qmode
operator|>=
literal|0
condition|)
name|printf
argument_list|(
literal|"Qmode %d "
argument_list|,
name|Qt
operator|.
name|qt_qmode
argument_list|)
expr_stmt|;
comment|/* print result relation if realistic */
if|if
condition|(
name|Qt
operator|.
name|qt_resvar
operator|>=
literal|0
condition|)
name|printf
argument_list|(
literal|"resvar %d "
argument_list|,
name|Qt
operator|.
name|qt_resvar
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* print tree */
name|rcsvtrpr
argument_list|(
name|t
argument_list|)
expr_stmt|;
comment|/* print exciting final stuff */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* **  RCSVTRPR -- traverse and print tree ** **	This function does the real stuff for treepr.  It recursively **	traverses the tree in postfix order, printing each node. ** **	Parameters: **		tree -- the root of the tree to print. ** **	Returns: **		none ** **	Side Effects: **		none ** **	Trace Flags: **		none */
end_comment

begin_expr_stmt
specifier|static
name|rcsvtrpr
argument_list|(
argument|tree
argument_list|)
name|QTREE
operator|*
name|tree
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|QTREE
modifier|*
name|t
decl_stmt|;
name|t
operator|=
name|tree
expr_stmt|;
while|while
condition|(
name|t
operator|!=
name|NULL
condition|)
block|{
name|nodepr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|rcsvtrpr
argument_list|(
name|t
operator|->
name|left
argument_list|)
expr_stmt|;
name|t
operator|=
name|t
operator|->
name|right
expr_stmt|;
block|}
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* **  NODEPR -- print tree node for debugging ** **	Parameters: **		tree -- the node to print. ** **	Returns: **		none ** **	Side Effects: **		output to terminal */
end_comment

begin_macro
name|nodepr
argument_list|(
argument|tree
argument_list|)
end_macro

begin_decl_stmt
name|QTREE
modifier|*
name|tree
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|QTREE
modifier|*
name|t
decl_stmt|;
specifier|register
name|int
name|ty
decl_stmt|;
name|int
name|l
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|;
name|t
operator|=
name|tree
expr_stmt|;
name|ty
operator|=
name|t
operator|->
name|sym
operator|.
name|type
expr_stmt|;
name|l
operator|=
name|t
operator|->
name|sym
operator|.
name|len
operator|&
name|I1MASK
expr_stmt|;
name|printf
argument_list|(
literal|"%x: %x, %x/ "
argument_list|,
name|t
argument_list|,
name|t
operator|->
name|left
argument_list|,
name|t
operator|->
name|right
argument_list|)
expr_stmt|;
name|xputchar
argument_list|(
name|ty
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d: "
argument_list|,
name|l
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ty
condition|)
block|{
case|case
name|VAR
case|:
name|printf
argument_list|(
literal|"%d.%d ["
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|varno
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|attno
argument_list|)
expr_stmt|;
name|xputchar
argument_list|(
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|varfrmt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d]: %x"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|varfrml
operator|&
name|I1MASK
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|valptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|varno
operator|==
operator|-
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"\n\tSub var: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|valptr
operator|!=
name|NULL
condition|)
name|nodepr
argument_list|(
operator|(
name|QTREE
operator|*
operator|)
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|valptr
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"ERROR: no value\n"
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
block|{
if|if
condition|(
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|valptr
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|" = "
argument_list|)
expr_stmt|;
name|printatt
argument_list|(
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|varfrmt
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|varfrml
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_var
operator|.
name|valptr
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|RESDOM
case|:
name|printf
argument_list|(
literal|"%d [%c%d]"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_resdom
operator|.
name|resno
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_resdom
operator|.
name|resfrmt
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_resdom
operator|.
name|resfrml
argument_list|)
expr_stmt|;
break|break;
case|case
name|AOP
case|:
name|printf
argument_list|(
literal|"%d [%c%d] [%c%d]"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_op
operator|.
name|opno
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_op
operator|.
name|opfrmt
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_op
operator|.
name|opfrml
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_op
operator|.
name|agfrmt
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_op
operator|.
name|agfrml
argument_list|)
expr_stmt|;
break|break;
case|case
name|UOP
case|:
case|case
name|BOP
case|:
case|case
name|COP
case|:
case|case
name|INT
case|:
case|case
name|QMODE
case|:
case|case
name|RESULTVAR
case|:
switch|switch
condition|(
name|t
operator|->
name|sym
operator|.
name|len
condition|)
block|{
case|case
literal|1
case|:
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_data
operator|.
name|i2type
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|printf
argument_list|(
literal|"%ld"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_data
operator|.
name|i4type
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|FLOAT
case|:
name|printf
argument_list|(
literal|"%.10f"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_data
operator|.
name|f4type
argument_list|)
expr_stmt|;
break|break;
case|case
name|CHAR
case|:
name|cp
operator|=
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_data
operator|.
name|c0type
expr_stmt|;
while|while
condition|(
name|l
operator|--
condition|)
name|xputchar
argument_list|(
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
break|break;
case|case
name|AND
case|:
case|case
name|ROOT
case|:
case|case
name|AGHEAD
case|:
name|printf
argument_list|(
literal|"[%d/%d] [%o/%o]"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_root
operator|.
name|tvarc
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_root
operator|.
name|lvarc
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_root
operator|.
name|lvarm
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_root
operator|.
name|rvarm
argument_list|)
expr_stmt|;
if|if
condition|(
name|ty
operator|!=
name|AND
condition|)
name|printf
argument_list|(
literal|" (%d)"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_root
operator|.
name|rootuser
argument_list|)
expr_stmt|;
break|break;
case|case
name|TREE
case|:
case|case
name|OR
case|:
case|case
name|QLEND
case|:
case|case
name|BYHEAD
case|:
break|break;
case|case
name|RESULTID
case|:
case|case
name|SOURCEID
case|:
name|printf
argument_list|(
literal|"%.14s"
argument_list|,
name|t
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_data
operator|.
name|c0type
argument_list|)
expr_stmt|;
break|break;
default|default:
name|syserr
argument_list|(
literal|"nodepr: ty %d"
argument_list|,
name|ty
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"/\n"
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

