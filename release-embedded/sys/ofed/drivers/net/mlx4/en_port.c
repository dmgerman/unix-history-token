begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2007 Mellanox Technologies. All rights reserved.  *  * This software is available to you under a choice of one of two  * licenses.  You may choose to be licensed under the terms of the GNU  * General Public License (GPL) Version 2, available from the file  * COPYING in the main directory of this source tree, or the  * OpenIB.org BSD license below:  *  *     Redistribution and use in source and binary forms, with or  *     without modification, are permitted provided that the following  *     conditions are met:  *  *      - Redistributions of source code must retain the above  *        copyright notice, this list of conditions and the following  *        disclaimer.  *  *      - Redistributions in binary form must reproduce the above  *        copyright notice, this list of conditions and the following  *        disclaimer in the documentation and/or other materials  *        provided with the distribution.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN  * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  * SOFTWARE.  *  */
end_comment

begin_include
include|#
directive|include
file|"mlx4_en.h"
end_include

begin_include
include|#
directive|include
file|<linux/if_vlan.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/device.h>
end_include

begin_include
include|#
directive|include
file|<linux/mlx4/cmd.h>
end_include

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|//  moved to port.c
end_comment

begin_endif
unit|int mlx4_SET_MCAST_FLTR(struct mlx4_dev *dev, u8 port, 			u64 mac, u64 clear, u8 mode) { 	return mlx4_cmd(dev, (mac | (clear<< 63)), port, mode, 			MLX4_CMD_SET_MCAST_FLTR, MLX4_CMD_TIME_CLASS_B, MLX4_CMD_NATIVE); }
endif|#
directive|endif
end_endif

begin_function
name|int
name|mlx4_SET_VLAN_FLTR
parameter_list|(
name|struct
name|mlx4_dev
modifier|*
name|dev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u32
modifier|*
name|vlans
parameter_list|)
block|{
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|struct
name|mlx4_set_vlan_fltr_mbox
modifier|*
name|filter
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|err
init|=
literal|0
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|filter
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|memset
argument_list|(
name|filter
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
expr|*
name|filter
argument_list|)
expr_stmt|;
if|if
condition|(
name|vlans
condition|)
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
name|VLAN_FLTR_SIZE
operator|-
literal|1
init|;
name|i
operator|<
name|VLAN_FLTR_SIZE
condition|;
name|i
operator|++
operator|,
name|j
operator|--
control|)
name|filter
operator|->
name|entry
index|[
name|j
index|]
operator|=
name|cpu_to_be32
argument_list|(
name|vlans
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd
argument_list|(
name|dev
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|port
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_SET_VLAN_FLTR
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_NATIVE
argument_list|)
expr_stmt|;
name|mlx4_free_cmd_mailbox
argument_list|(
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|//moved to port.c - shahark
end_comment

begin_comment
unit|int mlx4_SET_PORT_general(struct mlx4_dev *dev, u8 port, int mtu, 			  u8 pptx, u8 pfctx, u8 pprx, u8 pfcrx) { 	struct mlx4_cmd_mailbox *mailbox; 	struct mlx4_set_port_general_context *context; 	int err; 	u32 in_mod;  	mailbox = mlx4_alloc_cmd_mailbox(dev); 	if (IS_ERR(mailbox)) 		return PTR_ERR(mailbox); 	context = mailbox->buf; 	memset(context, 0, sizeof *context);  	context->flags = SET_PORT_GEN_ALL_VALID; 	context->mtu = cpu_to_be16(mtu); 	context->pptx = (pptx * (!pfctx))<< 7; 	context->pfctx = pfctx; 	context->pprx = (pprx * (!pfcrx))<< 7; 	context->pfcrx = pfcrx;  	in_mod = MLX4_SET_PORT_GENERAL<< 8 | port; 	err = mlx4_cmd(dev, mailbox->dma, in_mod, 1, MLX4_CMD_SET_PORT, 		       MLX4_CMD_TIME_CLASS_B, MLX4_CMD_NATIVE);  	mlx4_free_cmd_mailbox(dev, mailbox); 	return err; } int mlx4_SET_PORT_qpn_calc(struct mlx4_dev *dev, u8 port, u32 base_qpn, 			   u8 promisc) {          printf("%s %s:%d\n", __func__, __FILE__, __LINE__);    	struct mlx4_cmd_mailbox *mailbox; 	struct mlx4_set_port_rqp_calc_context *context; 	int err; 	u32 in_mod;  	mailbox = mlx4_alloc_cmd_mailbox(dev); 	if (IS_ERR(mailbox)) 		return PTR_ERR(mailbox); 	context = mailbox->buf; 	memset(context, 0, sizeof *context);  	context->base_qpn = cpu_to_be32(base_qpn); 	context->promisc = cpu_to_be32(promisc<< SET_PORT_PROMISC_EN_SHIFT | base_qpn);
comment|/* 	context->mcast = cpu_to_be32((dev->caps.mc_promisc_mode<< 				      SET_PORT_PROMISC_MODE_SHIFT) | base_qpn); */
end_comment

begin_endif
unit|context->intra_no_vlan = 0; 	context->no_vlan = MLX4_NO_VLAN_IDX; 	context->intra_vlan_miss = 0; 	context->vlan_miss = MLX4_VLAN_MISS_IDX;  	in_mod = MLX4_SET_PORT_RQP_CALC<< 8 | port; 	err = mlx4_cmd(dev, mailbox->dma, in_mod, 1, MLX4_CMD_SET_PORT, 		       MLX4_CMD_TIME_CLASS_B, MLX4_CMD_NATIVE);  	mlx4_free_cmd_mailbox(dev, mailbox); 	return err; }
endif|#
directive|endif
end_endif

begin_function
name|int
name|mlx4_en_QUERY_PORT
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|)
block|{
name|struct
name|mlx4_en_query_port_context
modifier|*
name|qport_context
decl_stmt|;
name|struct
name|mlx4_en_priv
modifier|*
name|priv
init|=
name|netdev_priv
argument_list|(
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
argument_list|)
decl_stmt|;
name|struct
name|mlx4_en_port_state
modifier|*
name|state
init|=
operator|&
name|priv
operator|->
name|port_state
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|int
name|err
decl_stmt|;
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|memset
argument_list|(
name|mailbox
operator|->
name|buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|qport_context
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|port
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_QUERY_PORT
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_WRAPPED
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|qport_context
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
comment|/* This command is always accessed from Ethtool context 	 * already synchronized, no need in locking */
name|state
operator|->
name|link_state
operator|=
operator|!
operator|!
operator|(
name|qport_context
operator|->
name|link_up
operator|&
name|MLX4_EN_LINK_UP_MASK
operator|)
expr_stmt|;
switch|switch
condition|(
name|qport_context
operator|->
name|link_speed
operator|&
name|MLX4_EN_SPEED_MASK
condition|)
block|{
case|case
name|MLX4_EN_1G_SPEED
case|:
name|state
operator|->
name|link_speed
operator|=
literal|1000
expr_stmt|;
break|break;
case|case
name|MLX4_EN_10G_SPEED_XAUI
case|:
case|case
name|MLX4_EN_10G_SPEED_XFI
case|:
name|state
operator|->
name|link_speed
operator|=
literal|10000
expr_stmt|;
break|break;
case|case
name|MLX4_EN_40G_SPEED
case|:
name|state
operator|->
name|link_speed
operator|=
literal|40000
expr_stmt|;
break|break;
default|default:
name|state
operator|->
name|link_speed
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|state
operator|->
name|transciver
operator|=
name|qport_context
operator|->
name|transceiver
expr_stmt|;
if|if
condition|(
name|be32_to_cpu
argument_list|(
name|qport_context
operator|->
name|transceiver_code_hi
argument_list|)
operator|&
literal|0x400
condition|)
name|state
operator|->
name|transciver
operator|=
literal|0x80
expr_stmt|;
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static int read_iboe_counters(struct mlx4_dev *dev, int index, u64 counters[]) { 	struct mlx4_cmd_mailbox *mailbox; 	int err; 	int mode; 	struct mlx4_counters_ext *ext; 	struct mlx4_counters *reg;  	mailbox = mlx4_alloc_cmd_mailbox(dev); 	if (IS_ERR(mailbox)) 		return -ENOMEM;  	err = mlx4_cmd_box(dev, 0, mailbox->dma, index, 0, 			   MLX4_CMD_QUERY_IF_STAT, MLX4_CMD_TIME_CLASS_C, MLX4_CMD_WRAPPED); 	if (err) 		goto out;  	mode = be32_to_cpu(((struct mlx4_counters *)mailbox->buf)->counter_mode)& 0xf; 	switch (mode) { 	case 0: 		reg = mailbox->buf; 		counters[0] = be64_to_cpu(reg->rx_frames); 		counters[1] = be64_to_cpu(reg->tx_frames); 		counters[2] = be64_to_cpu(reg->rx_bytes); 		counters[3] = be64_to_cpu(reg->tx_bytes); 		break; 	case 1: 		ext = mailbox->buf; 		counters[0] = be64_to_cpu(ext->rx_uni_frames); 		counters[1] = be64_to_cpu(ext->tx_uni_frames); 		counters[2] = be64_to_cpu(ext->rx_uni_bytes); 		counters[3] = be64_to_cpu(ext->tx_uni_bytes); 		break; 	default: 		err = -EINVAL; 	}  out: 	mlx4_free_cmd_mailbox(dev, mailbox); 	return err; }
endif|#
directive|endif
end_endif

begin_function
name|int
name|mlx4_en_DUMP_ETH_STATS
parameter_list|(
name|struct
name|mlx4_en_dev
modifier|*
name|mdev
parameter_list|,
name|u8
name|port
parameter_list|,
name|u8
name|reset
parameter_list|)
block|{
name|struct
name|mlx4_en_stat_out_mbox
modifier|*
name|mlx4_en_stats
decl_stmt|;
name|struct
name|net_device
modifier|*
name|dev
decl_stmt|;
name|struct
name|mlx4_en_priv
modifier|*
name|priv
decl_stmt|;
name|struct
name|mlx4_cmd_mailbox
modifier|*
name|mailbox
decl_stmt|;
name|u64
name|in_mod
init|=
name|reset
operator|<<
literal|8
operator||
name|port
decl_stmt|;
name|unsigned
name|long
name|oerror
decl_stmt|;
name|unsigned
name|long
name|ierror
decl_stmt|;
name|int
name|err
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|//int counter;
name|u64
name|counters
index|[
literal|4
index|]
decl_stmt|;
name|dev
operator|=
name|mdev
operator|->
name|pndev
index|[
name|port
index|]
expr_stmt|;
name|priv
operator|=
name|netdev_priv
argument_list|(
name|dev
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|counters
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
name|counters
argument_list|)
expr_stmt|;
comment|/* 	counter = mlx4_get_iboe_counter(priv->mdev->dev, port); 	if (counter>= 0) 		err = read_iboe_counters(priv->mdev->dev, counter, counters);         */
name|mailbox
operator|=
name|mlx4_alloc_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_ERR
argument_list|(
name|mailbox
argument_list|)
condition|)
return|return
name|PTR_ERR
argument_list|(
name|mailbox
argument_list|)
return|;
name|memset
argument_list|(
name|mailbox
operator|->
name|buf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|mlx4_en_stats
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|mlx4_cmd_box
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
literal|0
argument_list|,
name|mailbox
operator|->
name|dma
argument_list|,
name|in_mod
argument_list|,
literal|0
argument_list|,
name|MLX4_CMD_DUMP_ETH_STATS
argument_list|,
name|MLX4_CMD_TIME_CLASS_B
argument_list|,
name|MLX4_CMD_WRAPPED
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|out
goto|;
name|mlx4_en_stats
operator|=
name|mailbox
operator|->
name|buf
expr_stmt|;
name|spin_lock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|oerror
operator|=
name|ierror
operator|=
literal|0
expr_stmt|;
name|dev
operator|->
name|if_ipackets
operator|=
name|counters
index|[
literal|0
index|]
expr_stmt|;
name|dev
operator|->
name|if_ibytes
operator|=
name|counters
index|[
literal|2
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|priv
operator|->
name|rx_ring_num
condition|;
name|i
operator|++
control|)
block|{
name|dev
operator|->
name|if_ipackets
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|.
name|packets
expr_stmt|;
name|dev
operator|->
name|if_ibytes
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|.
name|bytes
expr_stmt|;
name|ierror
operator|+=
name|priv
operator|->
name|rx_ring
index|[
name|i
index|]
operator|.
name|errors
expr_stmt|;
block|}
name|dev
operator|->
name|if_opackets
operator|=
name|counters
index|[
literal|1
index|]
expr_stmt|;
name|dev
operator|->
name|if_obytes
operator|=
name|counters
index|[
literal|3
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|priv
operator|->
name|tx_ring_num
condition|;
name|i
operator|++
control|)
block|{
name|dev
operator|->
name|if_opackets
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|.
name|packets
expr_stmt|;
name|dev
operator|->
name|if_obytes
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|.
name|bytes
expr_stmt|;
name|oerror
operator|+=
name|priv
operator|->
name|tx_ring
index|[
name|i
index|]
operator|.
name|errors
expr_stmt|;
block|}
name|dev
operator|->
name|if_ierrors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RDROP
argument_list|)
operator|+
name|ierror
expr_stmt|;
name|dev
operator|->
name|if_oerrors
operator|=
name|be32_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TDROP
argument_list|)
operator|+
name|oerror
expr_stmt|;
name|dev
operator|->
name|if_imcasts
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|MCAST_novlan
argument_list|)
expr_stmt|;
name|dev
operator|->
name|if_omcasts
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TMCAST_novlan
argument_list|)
expr_stmt|;
name|dev
operator|->
name|if_collisions
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|broadcast
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_0
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_1
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_2
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_3
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_4
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_5
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_6
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_prio_7
argument_list|)
operator|+
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RBCAST_novlan
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|2
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|3
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|4
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|5
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|6
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|rx_prio
index|[
literal|7
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|RTOT_prio_7
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|0
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|1
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_1
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|2
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_2
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|3
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_3
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|4
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_4
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|5
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_5
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|6
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_6
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pkstats
operator|.
name|tx_prio
index|[
literal|7
index|]
operator|=
name|be64_to_cpu
argument_list|(
name|mlx4_en_stats
operator|->
name|TTOT_prio_7
argument_list|)
expr_stmt|;
name|spin_unlock
argument_list|(
operator|&
name|priv
operator|->
name|stats_lock
argument_list|)
expr_stmt|;
name|out
label|:
name|mlx4_free_cmd_mailbox
argument_list|(
name|mdev
operator|->
name|dev
argument_list|,
name|mailbox
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

end_unit

