begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2006 - 2007 Kungliga Tekniska HÃ¶gskolan  * (Royal Institute of Technology, Stockholm, Sweden).  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  *  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * 3. Neither the name of the Institute nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_define
define|#
directive|define
name|HC_DEPRECATED_CRYPTO
end_define

begin_include
include|#
directive|include
file|"kuser_locl.h"
end_include

begin_include
include|#
directive|include
file|<kdigest-commands.h>
end_include

begin_include
include|#
directive|include
file|<hex.h>
end_include

begin_include
include|#
directive|include
file|<base64.h>
end_include

begin_include
include|#
directive|include
file|<heimntlm.h>
end_include

begin_include
include|#
directive|include
file|"crypto-headers.h"
end_include

begin_decl_stmt
specifier|static
name|int
name|version_flag
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|help_flag
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|ccache_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|krb5_ccache
name|id
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|getargs
name|args
index|[]
init|=
block|{
block|{
literal|"ccache"
block|,
literal|0
block|,
name|arg_string
block|,
operator|&
name|ccache_string
block|,
literal|"credential cache"
block|,
name|NULL
block|}
block|,
block|{
literal|"version"
block|,
literal|0
block|,
name|arg_flag
block|,
operator|&
name|version_flag
block|,
literal|"print version"
block|,
name|NULL
block|}
block|,
block|{
literal|"help"
block|,
literal|0
block|,
name|arg_flag
block|,
operator|&
name|help_flag
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|usage
parameter_list|(
name|int
name|ret
parameter_list|)
block|{
name|arg_printusage
argument_list|(
name|args
argument_list|,
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|args
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|ret
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|krb5_context
name|context
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|digest_probe
parameter_list|(
name|struct
name|digest_probe_options
modifier|*
name|opt
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|krb5_realm
name|realm
decl_stmt|;
name|unsigned
name|flags
decl_stmt|;
name|realm
operator|=
name|opt
operator|->
name|realm_string
expr_stmt|;
if|if
condition|(
name|realm
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"realm missing"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_probe
argument_list|(
name|context
argument_list|,
name|realm
argument_list|,
name|id
argument_list|,
operator|&
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"digest_probe"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"flags: %u\n"
argument_list|,
name|flags
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|digest_server_init
parameter_list|(
name|struct
name|digest_server_init_options
modifier|*
name|opt
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|krb5_digest
name|digest
decl_stmt|;
name|ret
operator|=
name|krb5_digest_alloc
argument_list|(
name|context
argument_list|,
operator|&
name|digest
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"digest_alloc"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_set_type
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|type_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_type"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|cb_type_string
operator|&&
name|opt
operator|->
name|cb_value_string
condition|)
block|{
name|ret
operator|=
name|krb5_digest_set_server_cb
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|cb_type_string
argument_list|,
name|opt
operator|->
name|cb_value_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_server_cb"
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
name|krb5_digest_init_request
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|kerberos_realm_string
argument_list|,
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_init_request"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"type=%s\n"
argument_list|,
name|opt
operator|->
name|type_string
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"server-nonce=%s\n"
argument_list|,
name|krb5_digest_get_server_nonce
argument_list|(
name|context
argument_list|,
name|digest
argument_list|)
argument_list|)
expr_stmt|;
block|{
specifier|const
name|char
modifier|*
name|s
init|=
name|krb5_digest_get_identifier
argument_list|(
name|context
argument_list|,
name|digest
argument_list|)
decl_stmt|;
if|if
condition|(
name|s
condition|)
name|printf
argument_list|(
literal|"identifier=%s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"opaque=%s\n"
argument_list|,
name|krb5_digest_get_opaque
argument_list|(
name|context
argument_list|,
name|digest
argument_list|)
argument_list|)
expr_stmt|;
name|krb5_digest_free
argument_list|(
name|digest
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|digest_server_request
parameter_list|(
name|struct
name|digest_server_request_options
modifier|*
name|opt
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|krb5_digest
name|digest
decl_stmt|;
specifier|const
name|char
modifier|*
name|status
decl_stmt|,
modifier|*
name|rsp
decl_stmt|;
name|krb5_data
name|session_key
decl_stmt|;
if|if
condition|(
name|opt
operator|->
name|server_nonce_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server nonce missing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|type_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"type missing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|opaque_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"opaque missing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|client_response_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"client response missing"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_alloc
argument_list|(
name|context
argument_list|,
operator|&
name|digest
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"digest_alloc"
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|opt
operator|->
name|type_string
argument_list|,
literal|"CHAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|opt
operator|->
name|server_identifier_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server identifier missing"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_set_identifier
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|server_identifier_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_type"
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
name|krb5_digest_set_type
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|type_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_type"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_set_username
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|username_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_username"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_set_server_nonce
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|server_nonce_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_server_nonce"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|client_nonce_string
condition|)
block|{
name|ret
operator|=
name|krb5_digest_set_client_nonce
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|client_nonce_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_client_nonce"
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
name|krb5_digest_set_opaque
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|opaque_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_opaque"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_set_responseData
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|client_response_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_set_responseData"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_request
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
name|opt
operator|->
name|kerberos_realm_string
argument_list|,
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_request"
argument_list|)
expr_stmt|;
name|status
operator|=
name|krb5_digest_rep_get_status
argument_list|(
name|context
argument_list|,
name|digest
argument_list|)
condition|?
literal|"ok"
else|:
literal|"failed"
expr_stmt|;
name|rsp
operator|=
name|krb5_digest_get_rsp
argument_list|(
name|context
argument_list|,
name|digest
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"status=%s\n"
argument_list|,
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsp
condition|)
name|printf
argument_list|(
literal|"rsp=%s\n"
argument_list|,
name|rsp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"tickets=no\n"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_digest_get_session_key
argument_list|(
name|context
argument_list|,
name|digest
argument_list|,
operator|&
name|session_key
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_digest_get_session_key"
argument_list|)
expr_stmt|;
if|if
condition|(
name|session_key
operator|.
name|length
condition|)
block|{
name|char
modifier|*
name|key
decl_stmt|;
name|hex_encode
argument_list|(
name|session_key
operator|.
name|data
argument_list|,
name|session_key
operator|.
name|length
argument_list|,
operator|&
name|key
argument_list|)
expr_stmt|;
if|if
condition|(
name|key
operator|==
name|NULL
condition|)
name|krb5_errx
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
literal|"hex_encode"
argument_list|)
expr_stmt|;
name|krb5_data_free
argument_list|(
operator|&
name|session_key
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"session-key=%s\n"
argument_list|,
name|key
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|key
argument_list|)
expr_stmt|;
block|}
name|krb5_digest_free
argument_list|(
name|digest
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|client_chap
parameter_list|(
specifier|const
name|void
modifier|*
name|server_nonce
parameter_list|,
name|size_t
name|snoncelen
parameter_list|,
name|unsigned
name|char
name|server_identifier
parameter_list|,
specifier|const
name|char
modifier|*
name|password
parameter_list|)
block|{
name|EVP_MD_CTX
modifier|*
name|ctx
decl_stmt|;
name|unsigned
name|char
name|md
index|[
name|MD5_DIGEST_LENGTH
index|]
decl_stmt|;
name|char
modifier|*
name|h
decl_stmt|;
name|ctx
operator|=
name|EVP_MD_CTX_create
argument_list|()
expr_stmt|;
name|EVP_DigestInit_ex
argument_list|(
name|ctx
argument_list|,
name|EVP_md5
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
operator|&
name|server_identifier
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|password
argument_list|,
name|strlen
argument_list|(
name|password
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|server_nonce
argument_list|,
name|snoncelen
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|ctx
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_MD_CTX_destroy
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|hex_encode
argument_list|(
name|md
argument_list|,
literal|16
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"responseData=%s\n"
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|h
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|unsigned
name|char
name|ms_chap_v2_magic1
index|[
literal|39
index|]
init|=
block|{
literal|0x4D
block|,
literal|0x61
block|,
literal|0x67
block|,
literal|0x69
block|,
literal|0x63
block|,
literal|0x20
block|,
literal|0x73
block|,
literal|0x65
block|,
literal|0x72
block|,
literal|0x76
block|,
literal|0x65
block|,
literal|0x72
block|,
literal|0x20
block|,
literal|0x74
block|,
literal|0x6F
block|,
literal|0x20
block|,
literal|0x63
block|,
literal|0x6C
block|,
literal|0x69
block|,
literal|0x65
block|,
literal|0x6E
block|,
literal|0x74
block|,
literal|0x20
block|,
literal|0x73
block|,
literal|0x69
block|,
literal|0x67
block|,
literal|0x6E
block|,
literal|0x69
block|,
literal|0x6E
block|,
literal|0x67
block|,
literal|0x20
block|,
literal|0x63
block|,
literal|0x6F
block|,
literal|0x6E
block|,
literal|0x73
block|,
literal|0x74
block|,
literal|0x61
block|,
literal|0x6E
block|,
literal|0x74
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|unsigned
name|char
name|ms_chap_v2_magic2
index|[
literal|41
index|]
init|=
block|{
literal|0x50
block|,
literal|0x61
block|,
literal|0x64
block|,
literal|0x20
block|,
literal|0x74
block|,
literal|0x6F
block|,
literal|0x20
block|,
literal|0x6D
block|,
literal|0x61
block|,
literal|0x6B
block|,
literal|0x65
block|,
literal|0x20
block|,
literal|0x69
block|,
literal|0x74
block|,
literal|0x20
block|,
literal|0x64
block|,
literal|0x6F
block|,
literal|0x20
block|,
literal|0x6D
block|,
literal|0x6F
block|,
literal|0x72
block|,
literal|0x65
block|,
literal|0x20
block|,
literal|0x74
block|,
literal|0x68
block|,
literal|0x61
block|,
literal|0x6E
block|,
literal|0x20
block|,
literal|0x6F
block|,
literal|0x6E
block|,
literal|0x65
block|,
literal|0x20
block|,
literal|0x69
block|,
literal|0x74
block|,
literal|0x65
block|,
literal|0x72
block|,
literal|0x61
block|,
literal|0x74
block|,
literal|0x69
block|,
literal|0x6F
block|,
literal|0x6E
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|unsigned
name|char
name|ms_rfc3079_magic1
index|[
literal|27
index|]
init|=
block|{
literal|0x54
block|,
literal|0x68
block|,
literal|0x69
block|,
literal|0x73
block|,
literal|0x20
block|,
literal|0x69
block|,
literal|0x73
block|,
literal|0x20
block|,
literal|0x74
block|,
literal|0x68
block|,
literal|0x65
block|,
literal|0x20
block|,
literal|0x4d
block|,
literal|0x50
block|,
literal|0x50
block|,
literal|0x45
block|,
literal|0x20
block|,
literal|0x4d
block|,
literal|0x61
block|,
literal|0x73
block|,
literal|0x74
block|,
literal|0x65
block|,
literal|0x72
block|,
literal|0x20
block|,
literal|0x4b
block|,
literal|0x65
block|,
literal|0x79
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|client_mschapv2
parameter_list|(
specifier|const
name|void
modifier|*
name|server_nonce
parameter_list|,
name|size_t
name|snoncelen
parameter_list|,
specifier|const
name|void
modifier|*
name|client_nonce
parameter_list|,
name|size_t
name|cnoncelen
parameter_list|,
specifier|const
name|char
modifier|*
name|username
parameter_list|,
specifier|const
name|char
modifier|*
name|password
parameter_list|)
block|{
name|EVP_MD_CTX
modifier|*
name|hctx
decl_stmt|,
modifier|*
name|ctx
decl_stmt|;
name|unsigned
name|char
name|md
index|[
name|SHA_DIGEST_LENGTH
index|]
decl_stmt|,
name|challenge
index|[
name|SHA_DIGEST_LENGTH
index|]
decl_stmt|;
name|unsigned
name|char
name|hmd
index|[
name|MD4_DIGEST_LENGTH
index|]
decl_stmt|;
name|struct
name|ntlm_buf
name|answer
decl_stmt|;
name|int
name|i
decl_stmt|,
name|len
decl_stmt|,
name|ret
decl_stmt|;
name|char
modifier|*
name|h
decl_stmt|;
name|ctx
operator|=
name|EVP_MD_CTX_create
argument_list|()
expr_stmt|;
name|EVP_DigestInit_ex
argument_list|(
name|ctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|client_nonce
argument_list|,
name|cnoncelen
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|server_nonce
argument_list|,
name|snoncelen
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|username
argument_list|,
name|strlen
argument_list|(
name|username
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|ctx
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|hctx
operator|=
name|EVP_MD_CTX_create
argument_list|()
expr_stmt|;
name|EVP_DigestInit_ex
argument_list|(
name|hctx
argument_list|,
name|EVP_md4
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|password
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|EVP_DigestUpdate
argument_list|(
name|hctx
argument_list|,
operator|&
name|password
index|[
name|i
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|hctx
argument_list|,
operator|&
name|password
index|[
name|len
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|EVP_DigestFinal_ex
argument_list|(
name|hctx
argument_list|,
name|hmd
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* ChallengeResponse */
name|ret
operator|=
name|heim_ntlm_calculate_ntlm1
argument_list|(
name|hmd
argument_list|,
sizeof|sizeof
argument_list|(
name|hmd
argument_list|)
argument_list|,
name|md
argument_list|,
operator|&
name|answer
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"heim_ntlm_calculate_ntlm1"
argument_list|)
expr_stmt|;
name|hex_encode
argument_list|(
name|answer
operator|.
name|data
argument_list|,
name|answer
operator|.
name|length
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"responseData=%s\n"
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|h
argument_list|)
expr_stmt|;
comment|/* PasswordHash */
name|EVP_DigestInit_ex
argument_list|(
name|hctx
argument_list|,
name|EVP_md4
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|hctx
argument_list|,
name|hmd
argument_list|,
sizeof|sizeof
argument_list|(
name|hmd
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|hctx
argument_list|,
name|hmd
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* GenerateAuthenticatorResponse */
name|EVP_DigestInit_ex
argument_list|(
name|ctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|hmd
argument_list|,
sizeof|sizeof
argument_list|(
name|hmd
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|answer
operator|.
name|data
argument_list|,
name|answer
operator|.
name|length
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|ms_chap_v2_magic1
argument_list|,
sizeof|sizeof
argument_list|(
name|ms_chap_v2_magic1
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|ctx
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* ChallengeHash */
name|EVP_DigestInit_ex
argument_list|(
name|ctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|client_nonce
argument_list|,
name|cnoncelen
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|server_nonce
argument_list|,
name|snoncelen
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|username
argument_list|,
name|strlen
argument_list|(
name|username
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|ctx
argument_list|,
name|challenge
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestInit_ex
argument_list|(
name|ctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|md
argument_list|,
sizeof|sizeof
argument_list|(
name|md
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|challenge
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|ms_chap_v2_magic2
argument_list|,
sizeof|sizeof
argument_list|(
name|ms_chap_v2_magic2
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|ctx
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|hex_encode
argument_list|(
name|md
argument_list|,
sizeof|sizeof
argument_list|(
name|md
argument_list|)
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"AuthenticatorResponse=%s\n"
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|h
argument_list|)
expr_stmt|;
comment|/* get_master, rfc 3079 3.4 */
name|EVP_DigestInit_ex
argument_list|(
name|ctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|hmd
argument_list|,
sizeof|sizeof
argument_list|(
name|hmd
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|answer
operator|.
name|data
argument_list|,
name|answer
operator|.
name|length
argument_list|)
expr_stmt|;
name|EVP_DigestUpdate
argument_list|(
name|ctx
argument_list|,
name|ms_rfc3079_magic1
argument_list|,
sizeof|sizeof
argument_list|(
name|ms_rfc3079_magic1
argument_list|)
argument_list|)
expr_stmt|;
name|EVP_DigestFinal_ex
argument_list|(
name|ctx
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|answer
operator|.
name|data
argument_list|)
expr_stmt|;
name|hex_encode
argument_list|(
name|md
argument_list|,
literal|16
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"session-key=%s\n"
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|EVP_MD_CTX_destroy
argument_list|(
name|hctx
argument_list|)
expr_stmt|;
name|EVP_MD_CTX_destroy
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|digest_client_request
parameter_list|(
name|struct
name|digest_client_request_options
modifier|*
name|opt
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|char
modifier|*
name|server_nonce
decl_stmt|,
modifier|*
name|client_nonce
init|=
name|NULL
decl_stmt|,
name|server_identifier
decl_stmt|;
name|ssize_t
name|snoncelen
decl_stmt|,
name|cnoncelen
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|opt
operator|->
name|server_nonce_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server nonce missing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|password_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"password missing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|opaque_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"opaque missing"
argument_list|)
expr_stmt|;
name|snoncelen
operator|=
name|strlen
argument_list|(
name|opt
operator|->
name|server_nonce_string
argument_list|)
expr_stmt|;
name|server_nonce
operator|=
name|malloc
argument_list|(
name|snoncelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|server_nonce
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server_nonce"
argument_list|)
expr_stmt|;
name|snoncelen
operator|=
name|hex_decode
argument_list|(
name|opt
operator|->
name|server_nonce_string
argument_list|,
name|server_nonce
argument_list|,
name|snoncelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|snoncelen
operator|<=
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server nonce wrong"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|client_nonce_string
condition|)
block|{
name|cnoncelen
operator|=
name|strlen
argument_list|(
name|opt
operator|->
name|client_nonce_string
argument_list|)
expr_stmt|;
name|client_nonce
operator|=
name|malloc
argument_list|(
name|cnoncelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|client_nonce
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"client_nonce"
argument_list|)
expr_stmt|;
name|cnoncelen
operator|=
name|hex_decode
argument_list|(
name|opt
operator|->
name|client_nonce_string
argument_list|,
name|client_nonce
argument_list|,
name|cnoncelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|cnoncelen
operator|<=
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"client nonce wrong"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|opt
operator|->
name|server_identifier_string
condition|)
block|{
name|int
name|ret
decl_stmt|;
name|ret
operator|=
name|hex_decode
argument_list|(
name|opt
operator|->
name|server_identifier_string
argument_list|,
operator|&
name|server_identifier
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server identifier wrong length"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strcasecmp
argument_list|(
name|opt
operator|->
name|type_string
argument_list|,
literal|"CHAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|opt
operator|->
name|server_identifier_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"server identifier missing"
argument_list|)
expr_stmt|;
name|client_chap
argument_list|(
name|server_nonce
argument_list|,
name|snoncelen
argument_list|,
name|server_identifier
argument_list|,
name|opt
operator|->
name|password_string
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|opt
operator|->
name|type_string
argument_list|,
literal|"MS-CHAP-V2"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|opt
operator|->
name|client_nonce_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"client nonce missing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|->
name|username_string
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"client nonce missing"
argument_list|)
expr_stmt|;
name|client_mschapv2
argument_list|(
name|server_nonce
argument_list|,
name|snoncelen
argument_list|,
name|client_nonce
argument_list|,
name|cnoncelen
argument_list|,
name|opt
operator|->
name|username_string
argument_list|,
name|opt
operator|->
name|password_string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|client_nonce
condition|)
name|free
argument_list|(
name|client_nonce
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|server_nonce
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_include
include|#
directive|include
file|<heimntlm.h>
end_include

begin_function
name|int
name|ntlm_server_init
parameter_list|(
name|struct
name|ntlm_server_init_options
modifier|*
name|opt
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|krb5_ntlm
name|ntlm
decl_stmt|;
name|struct
name|ntlm_type2
name|type2
decl_stmt|;
name|krb5_data
name|challenge
decl_stmt|,
name|opaque
decl_stmt|;
name|struct
name|ntlm_buf
name|data
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
specifier|static
name|char
name|zero2
index|[]
init|=
literal|"\x00\x00"
decl_stmt|;
name|memset
argument_list|(
operator|&
name|type2
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|type2
argument_list|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_ntlm_alloc
argument_list|(
name|context
argument_list|,
operator|&
name|ntlm
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_ntlm_alloc"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_ntlm_init_request
argument_list|(
name|context
argument_list|,
name|ntlm
argument_list|,
name|opt
operator|->
name|kerberos_realm_string
argument_list|,
name|id
argument_list|,
name|NTLM_NEG_UNICODE
operator||
name|NTLM_NEG_NTLM
argument_list|,
literal|"NUTCRACKER"
argument_list|,
literal|"L"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_ntlm_init_request"
argument_list|)
expr_stmt|;
comment|/*      *      */
name|ret
operator|=
name|krb5_ntlm_init_get_challange
argument_list|(
name|context
argument_list|,
name|ntlm
argument_list|,
operator|&
name|challenge
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_ntlm_init_get_challange"
argument_list|)
expr_stmt|;
if|if
condition|(
name|challenge
operator|.
name|length
operator|!=
sizeof|sizeof
argument_list|(
name|type2
operator|.
name|challenge
argument_list|)
condition|)
name|krb5_errx
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
literal|"ntlm challenge have wrong length"
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|type2
operator|.
name|challenge
argument_list|,
name|challenge
operator|.
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|type2
operator|.
name|challenge
argument_list|)
argument_list|)
expr_stmt|;
name|krb5_data_free
argument_list|(
operator|&
name|challenge
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_ntlm_init_get_flags
argument_list|(
name|context
argument_list|,
name|ntlm
argument_list|,
operator|&
name|type2
operator|.
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_ntlm_init_get_flags"
argument_list|)
expr_stmt|;
name|krb5_ntlm_init_get_targetname
argument_list|(
name|context
argument_list|,
name|ntlm
argument_list|,
operator|&
name|type2
operator|.
name|targetname
argument_list|)
expr_stmt|;
name|type2
operator|.
name|targetinfo
operator|.
name|data
operator|=
name|zero2
expr_stmt|;
name|type2
operator|.
name|targetinfo
operator|.
name|length
operator|=
literal|2
expr_stmt|;
name|ret
operator|=
name|heim_ntlm_encode_type2
argument_list|(
operator|&
name|type2
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_errx
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
literal|"heim_ntlm_encode_type2"
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|type2
operator|.
name|targetname
argument_list|)
expr_stmt|;
comment|/*      *      */
name|base64_encode
argument_list|(
name|data
operator|.
name|data
argument_list|,
name|data
operator|.
name|length
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data
operator|.
name|data
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"type2=%s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|s
argument_list|)
expr_stmt|;
comment|/*      *      */
name|ret
operator|=
name|krb5_ntlm_init_get_opaque
argument_list|(
name|context
argument_list|,
name|ntlm
argument_list|,
operator|&
name|opaque
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_ntlm_init_get_opaque"
argument_list|)
expr_stmt|;
name|base64_encode
argument_list|(
name|opaque
operator|.
name|data
argument_list|,
name|opaque
operator|.
name|length
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
name|krb5_data_free
argument_list|(
operator|&
name|opaque
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"opaque=%s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|s
argument_list|)
expr_stmt|;
comment|/*      *      */
name|krb5_ntlm_free
argument_list|(
name|context
argument_list|,
name|ntlm
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  *  */
end_comment

begin_function
name|int
name|help
parameter_list|(
name|void
modifier|*
name|opt
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|sl_slc_help
argument_list|(
name|commands
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|int
name|optidx
init|=
literal|0
decl_stmt|;
name|setprogname
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_init_context
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|KRB5_CONFIG_BADFORMAT
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"krb5_init_context failed to parse configuration file"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ret
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"krb5_init_context failed: %d"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
if|if
condition|(
name|getarg
argument_list|(
name|args
argument_list|,
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|optidx
argument_list|)
condition|)
name|usage
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|help_flag
condition|)
name|usage
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|version_flag
condition|)
block|{
name|print_version
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|argc
operator|-=
name|optidx
expr_stmt|;
name|argv
operator|+=
name|optidx
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|0
condition|)
block|{
name|help
argument_list|(
name|NULL
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|ccache_string
condition|)
block|{
name|ret
operator|=
name|krb5_cc_resolve
argument_list|(
name|context
argument_list|,
name|ccache_string
argument_list|,
operator|&
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|krb5_err
argument_list|(
name|context
argument_list|,
literal|1
argument_list|,
name|ret
argument_list|,
literal|"krb5_cc_resolve"
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
name|sl_command
argument_list|(
name|commands
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
operator|-
literal|1
condition|)
block|{
name|help
argument_list|(
name|NULL
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
return|return
name|ret
return|;
block|}
end_function

end_unit

