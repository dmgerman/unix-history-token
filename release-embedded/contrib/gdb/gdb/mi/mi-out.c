begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* MI Command Set - output generating routines.     Copyright 2000, 2002, 2003, 2004 Free Software Foundation, Inc.     Contributed by Cygnus Solutions (a Red Hat company).     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"ui-out.h"
end_include

begin_include
include|#
directive|include
file|"mi-out.h"
end_include

begin_struct
struct|struct
name|ui_out_data
block|{
name|int
name|suppress_field_separator
decl_stmt|;
name|int
name|suppress_output
decl_stmt|;
name|int
name|mi_version
decl_stmt|;
name|struct
name|ui_file
modifier|*
name|buffer
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|ui_out_data
name|mi_out_data
typedef|;
end_typedef

begin_comment
comment|/* These are the MI output functions */
end_comment

begin_function_decl
specifier|static
name|void
name|mi_table_begin
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|nbrofcols
parameter_list|,
name|int
name|nr_rows
parameter_list|,
specifier|const
name|char
modifier|*
name|tblid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_table_body
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_table_end
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_table_header
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alig
parameter_list|,
specifier|const
name|char
modifier|*
name|col_name
parameter_list|,
specifier|const
name|char
modifier|*
name|colhdr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_begin
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|,
name|int
name|level
parameter_list|,
specifier|const
name|char
modifier|*
name|id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_end
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|,
name|int
name|level
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_field_int
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alig
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|,
name|int
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_field_skip
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alig
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_field_string
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alig
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_field_fmt
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|align
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_spaces
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|numspaces
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_text
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_message
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|verbosity
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_wrap_hint
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|char
modifier|*
name|identstring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_flush
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* This is the MI ui-out implementation functions vector */
end_comment

begin_comment
comment|/* FIXME: This can be initialized dynamically after default is set to    handle initial output in main.c */
end_comment

begin_decl_stmt
name|struct
name|ui_out_impl
name|mi_ui_out_impl
init|=
block|{
name|mi_table_begin
block|,
name|mi_table_body
block|,
name|mi_table_end
block|,
name|mi_table_header
block|,
name|mi_begin
block|,
name|mi_end
block|,
name|mi_field_int
block|,
name|mi_field_skip
block|,
name|mi_field_string
block|,
name|mi_field_fmt
block|,
name|mi_spaces
block|,
name|mi_text
block|,
name|mi_message
block|,
name|mi_wrap_hint
block|,
name|mi_flush
block|,
name|NULL
block|,
literal|1
block|,
comment|/* Needs MI hacks.  */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Prototypes for local functions */
end_comment

begin_function_decl
specifier|extern
name|void
name|_initialize_mi_out
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|field_separator
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_open
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mi_close
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Mark beginning of a table */
end_comment

begin_function
name|void
name|mi_table_begin
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|nr_cols
parameter_list|,
name|int
name|nr_rows
parameter_list|,
specifier|const
name|char
modifier|*
name|tblid
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|mi_open
argument_list|(
name|uiout
argument_list|,
name|tblid
argument_list|,
name|ui_out_type_tuple
argument_list|)
expr_stmt|;
name|mi_field_int
argument_list|(
name|uiout
argument_list|,
operator|-
literal|1
comment|/*fldno*/
argument_list|,
operator|-
literal|1
comment|/*width*/
argument_list|,
operator|-
literal|1
comment|/*alin*/
argument_list|,
literal|"nr_rows"
argument_list|,
name|nr_rows
argument_list|)
expr_stmt|;
name|mi_field_int
argument_list|(
name|uiout
argument_list|,
operator|-
literal|1
comment|/*fldno*/
argument_list|,
operator|-
literal|1
comment|/*width*/
argument_list|,
operator|-
literal|1
comment|/*alin*/
argument_list|,
literal|"nr_cols"
argument_list|,
name|nr_cols
argument_list|)
expr_stmt|;
name|mi_open
argument_list|(
name|uiout
argument_list|,
literal|"hdr"
argument_list|,
name|ui_out_type_list
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Mark beginning of a table body */
end_comment

begin_function
name|void
name|mi_table_body
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
comment|/* close the table header line if there were any headers */
name|mi_close
argument_list|(
name|uiout
argument_list|,
name|ui_out_type_list
argument_list|)
expr_stmt|;
name|mi_open
argument_list|(
name|uiout
argument_list|,
literal|"body"
argument_list|,
name|ui_out_type_list
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Mark end of a table */
end_comment

begin_function
name|void
name|mi_table_end
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|data
operator|->
name|suppress_output
operator|=
literal|0
expr_stmt|;
name|mi_close
argument_list|(
name|uiout
argument_list|,
name|ui_out_type_list
argument_list|)
expr_stmt|;
comment|/* body */
name|mi_close
argument_list|(
name|uiout
argument_list|,
name|ui_out_type_tuple
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Specify table header */
end_comment

begin_function
name|void
name|mi_table_header
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alignment
parameter_list|,
specifier|const
name|char
modifier|*
name|col_name
parameter_list|,
specifier|const
name|char
modifier|*
name|colhdr
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|mi_open
argument_list|(
name|uiout
argument_list|,
name|NULL
argument_list|,
name|ui_out_type_tuple
argument_list|)
expr_stmt|;
name|mi_field_int
argument_list|(
name|uiout
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"width"
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|mi_field_int
argument_list|(
name|uiout
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"alignment"
argument_list|,
name|alignment
argument_list|)
expr_stmt|;
name|mi_field_string
argument_list|(
name|uiout
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"col_name"
argument_list|,
name|col_name
argument_list|)
expr_stmt|;
name|mi_field_string
argument_list|(
name|uiout
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|alignment
argument_list|,
literal|"colhdr"
argument_list|,
name|colhdr
argument_list|)
expr_stmt|;
name|mi_close
argument_list|(
name|uiout
argument_list|,
name|ui_out_type_tuple
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Mark beginning of a list */
end_comment

begin_function
name|void
name|mi_begin
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|,
name|int
name|level
parameter_list|,
specifier|const
name|char
modifier|*
name|id
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|mi_open
argument_list|(
name|uiout
argument_list|,
name|id
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Mark end of a list */
end_comment

begin_function
name|void
name|mi_end
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|,
name|int
name|level
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|mi_close
argument_list|(
name|uiout
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* output an int field */
end_comment

begin_function
name|void
name|mi_field_int
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alignment
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|,
name|int
name|value
parameter_list|)
block|{
name|char
name|buffer
index|[
literal|20
index|]
decl_stmt|;
comment|/* FIXME: how many chars long a %d can become? */
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|mi_field_string
argument_list|(
name|uiout
argument_list|,
name|fldno
argument_list|,
name|width
argument_list|,
name|alignment
argument_list|,
name|fldname
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* used to ommit a field */
end_comment

begin_function
name|void
name|mi_field_skip
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|alignment
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|mi_field_string
argument_list|(
name|uiout
argument_list|,
name|fldno
argument_list|,
name|width
argument_list|,
name|alignment
argument_list|,
name|fldname
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* other specific mi_field_* end up here so alignment and field    separators are both handled by mi_field_string */
end_comment

begin_function
name|void
name|mi_field_string
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|align
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|field_separator
argument_list|(
name|uiout
argument_list|)
expr_stmt|;
if|if
condition|(
name|fldname
condition|)
name|fprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
literal|"%s="
argument_list|,
name|fldname
argument_list|)
expr_stmt|;
name|fprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
condition|)
name|fputstr_unfiltered
argument_list|(
name|string
argument_list|,
literal|'"'
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
name|fprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* This is the only field function that does not align */
end_comment

begin_function
name|void
name|mi_field_fmt
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|fldno
parameter_list|,
name|int
name|width
parameter_list|,
name|enum
name|ui_align
name|align
parameter_list|,
specifier|const
name|char
modifier|*
name|fldname
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|args
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_output
condition|)
return|return;
name|field_separator
argument_list|(
name|uiout
argument_list|)
expr_stmt|;
if|if
condition|(
name|fldname
condition|)
name|fprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
literal|"%s=\""
argument_list|,
name|fldname
argument_list|)
expr_stmt|;
else|else
name|fputs_unfiltered
argument_list|(
literal|"\""
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
name|vfprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|fputs_unfiltered
argument_list|(
literal|"\""
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mi_spaces
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|numspaces
parameter_list|)
block|{ }
end_function

begin_function
name|void
name|mi_text
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|)
block|{ }
end_function

begin_function
name|void
name|mi_message
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|int
name|verbosity
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|args
parameter_list|)
block|{ }
end_function

begin_function
name|void
name|mi_wrap_hint
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|char
modifier|*
name|identstring
parameter_list|)
block|{
name|wrap_here
argument_list|(
name|identstring
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mi_flush
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|gdb_flush
argument_list|(
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* local functions */
end_comment

begin_comment
comment|/* access to ui_out format private members */
end_comment

begin_function
specifier|static
name|void
name|field_separator
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|suppress_field_separator
condition|)
name|data
operator|->
name|suppress_field_separator
operator|=
literal|0
expr_stmt|;
else|else
name|fputc_unfiltered
argument_list|(
literal|','
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mi_open
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|field_separator
argument_list|(
name|uiout
argument_list|)
expr_stmt|;
name|data
operator|->
name|suppress_field_separator
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|name
condition|)
name|fprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
literal|"%s="
argument_list|,
name|name
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|ui_out_type_tuple
case|:
name|fputc_unfiltered
argument_list|(
literal|'{'
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
break|break;
case|case
name|ui_out_type_list
case|:
name|fputc_unfiltered
argument_list|(
literal|'['
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
break|break;
default|default:
name|internal_error
argument_list|(
name|__FILE__
argument_list|,
name|__LINE__
argument_list|,
literal|"bad switch"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|mi_close
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|enum
name|ui_out_type
name|type
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|ui_out_type_tuple
case|:
name|fputc_unfiltered
argument_list|(
literal|'}'
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
break|break;
case|case
name|ui_out_type_list
case|:
name|fputc_unfiltered
argument_list|(
literal|']'
argument_list|,
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
break|break;
default|default:
name|internal_error
argument_list|(
name|__FILE__
argument_list|,
name|__LINE__
argument_list|,
literal|"bad switch"
argument_list|)
expr_stmt|;
block|}
name|data
operator|->
name|suppress_field_separator
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* add a string to the buffer */
end_comment

begin_function
name|void
name|mi_out_buffered
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|fprintf_unfiltered
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
literal|"%s"
argument_list|,
name|string
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* clear the buffer */
end_comment

begin_function
name|void
name|mi_out_rewind
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|ui_file_rewind
argument_list|(
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* dump the buffer onto the specified stream */
end_comment

begin_function
specifier|static
name|void
name|do_write
parameter_list|(
name|void
modifier|*
name|data
parameter_list|,
specifier|const
name|char
modifier|*
name|buffer
parameter_list|,
name|long
name|length_buffer
parameter_list|)
block|{
name|ui_file_write
argument_list|(
name|data
argument_list|,
name|buffer
argument_list|,
name|length_buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mi_out_put
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|,
name|struct
name|ui_file
modifier|*
name|stream
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
name|ui_file_put
argument_list|(
name|data
operator|->
name|buffer
argument_list|,
name|do_write
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|ui_file_rewind
argument_list|(
name|data
operator|->
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Current MI version.  */
end_comment

begin_function
name|int
name|mi_version
parameter_list|(
name|struct
name|ui_out
modifier|*
name|uiout
parameter_list|)
block|{
name|mi_out_data
modifier|*
name|data
init|=
name|ui_out_data
argument_list|(
name|uiout
argument_list|)
decl_stmt|;
return|return
name|data
operator|->
name|mi_version
return|;
block|}
end_function

begin_comment
comment|/* initalize private members at startup */
end_comment

begin_function
name|struct
name|ui_out
modifier|*
name|mi_out_new
parameter_list|(
name|int
name|mi_version
parameter_list|)
block|{
name|int
name|flags
init|=
literal|0
decl_stmt|;
name|mi_out_data
modifier|*
name|data
init|=
name|XMALLOC
argument_list|(
name|mi_out_data
argument_list|)
decl_stmt|;
name|data
operator|->
name|suppress_field_separator
operator|=
literal|0
expr_stmt|;
name|data
operator|->
name|suppress_output
operator|=
literal|0
expr_stmt|;
name|data
operator|->
name|mi_version
operator|=
name|mi_version
expr_stmt|;
comment|/* FIXME: This code should be using a ``string_file'' and not the      TUI buffer hack. */
name|data
operator|->
name|buffer
operator|=
name|mem_fileopen
argument_list|()
expr_stmt|;
return|return
name|ui_out_new
argument_list|(
operator|&
name|mi_ui_out_impl
argument_list|,
name|data
argument_list|,
name|flags
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* standard gdb initialization hook */
end_comment

begin_function
name|void
name|_initialize_mi_out
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* nothing happens here */
block|}
end_function

end_unit

