begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* TUI window generic functions.     Copyright 1998, 1999, 2000, 2001, 2002, 2003, 2004 Free Software    Foundation, Inc.     Contributed by Hewlett-Packard Company.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* This module contains procedures for handling tui window functions    like resize, scrolling, scrolling, changing focus, etc.     Author: Susan B. Macchia  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"command.h"
end_include

begin_include
include|#
directive|include
file|"symtab.h"
end_include

begin_include
include|#
directive|include
file|"breakpoint.h"
end_include

begin_include
include|#
directive|include
file|"frame.h"
end_include

begin_include
include|#
directive|include
file|"cli/cli-cmds.h"
end_include

begin_include
include|#
directive|include
file|"top.h"
end_include

begin_include
include|#
directive|include
file|"source.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-data.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-wingeneral.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-stack.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-regs.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-disasm.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-source.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-winsource.h"
end_include

begin_include
include|#
directive|include
file|"tui/tui-windata.h"
end_include

begin_include
include|#
directive|include
file|"gdb_curses.h"
end_include

begin_include
include|#
directive|include
file|"gdb_string.h"
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|"readline/readline.h"
end_include

begin_comment
comment|/******************************* ** Static Local Decls ********************************/
end_comment

begin_function_decl
specifier|static
name|void
name|make_visible_with_new_height
parameter_list|(
name|struct
name|tui_win_info
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|make_invisible_and_set_new_height
parameter_list|(
name|struct
name|tui_win_info
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|enum
name|tui_status
name|tui_adjust_win_heights
parameter_list|(
name|struct
name|tui_win_info
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|new_height_ok
parameter_list|(
name|struct
name|tui_win_info
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_set_tab_width_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_refresh_all_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_set_win_height_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_xdb_set_win_height_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_all_windows_info
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_set_focus_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_scroll_forward_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_scroll_backward_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_scroll_left_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tui_scroll_right_command
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|parse_scrolling_args
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|tui_win_info
modifier|*
modifier|*
parameter_list|,
name|int
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*************************************** ** DEFINITIONS ***************************************/
end_comment

begin_define
define|#
directive|define
name|WIN_HEIGHT_USAGE
value|"Usage: winheight<win_name> [+ | -]<#lines>\n"
end_define

begin_define
define|#
directive|define
name|XDBWIN_HEIGHT_USAGE
value|"Usage: w<#lines>\n"
end_define

begin_define
define|#
directive|define
name|FOCUS_USAGE
value|"Usage: focus {<win> | next | prev}\n"
end_define

begin_comment
comment|/*************************************** ** PUBLIC FUNCTIONS ***************************************/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|ACS_LRCORNER
end_ifndef

begin_define
define|#
directive|define
name|ACS_LRCORNER
value|'+'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ACS_LLCORNER
end_ifndef

begin_define
define|#
directive|define
name|ACS_LLCORNER
value|'+'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ACS_ULCORNER
end_ifndef

begin_define
define|#
directive|define
name|ACS_ULCORNER
value|'+'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ACS_URCORNER
end_ifndef

begin_define
define|#
directive|define
name|ACS_URCORNER
value|'+'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ACS_HLINE
end_ifndef

begin_define
define|#
directive|define
name|ACS_HLINE
value|'-'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ACS_VLINE
end_ifndef

begin_define
define|#
directive|define
name|ACS_VLINE
value|'|'
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Possible values for tui-border-kind variable.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|tui_border_kind_enums
index|[]
init|=
block|{
literal|"space"
block|,
literal|"ascii"
block|,
literal|"acs"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Possible values for tui-border-mode and tui-active-border-mode.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|tui_border_mode_enums
index|[]
init|=
block|{
literal|"normal"
block|,
literal|"standout"
block|,
literal|"reverse"
block|,
literal|"half"
block|,
literal|"half-standout"
block|,
literal|"bold"
block|,
literal|"bold-standout"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|tui_translate
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|value
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Translation table for border-mode variables.    The list of values must be terminated by a NULL.    After the NULL value, an entry defines the default.  */
end_comment

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_mode_translate
index|[]
init|=
block|{
block|{
literal|"normal"
block|,
name|A_NORMAL
block|}
block|,
block|{
literal|"standout"
block|,
name|A_STANDOUT
block|}
block|,
block|{
literal|"reverse"
block|,
name|A_REVERSE
block|}
block|,
block|{
literal|"half"
block|,
name|A_DIM
block|}
block|,
block|{
literal|"half-standout"
block|,
name|A_DIM
operator||
name|A_STANDOUT
block|}
block|,
block|{
literal|"bold"
block|,
name|A_BOLD
block|}
block|,
block|{
literal|"bold-standout"
block|,
name|A_BOLD
operator||
name|A_STANDOUT
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"normal"
block|,
name|A_NORMAL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Translation tables for border-kind, one for each border    character (see wborder, border curses operations).    -1 is used to indicate the ACS because ACS characters    are determined at run time by curses (depends on terminal).  */
end_comment

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_kind_translate_vline
index|[]
init|=
block|{
block|{
literal|"space"
block|,
literal|' '
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'|'
block|}
block|,
block|{
literal|"acs"
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'|'
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_kind_translate_hline
index|[]
init|=
block|{
block|{
literal|"space"
block|,
literal|' '
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'-'
block|}
block|,
block|{
literal|"acs"
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'-'
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_kind_translate_ulcorner
index|[]
init|=
block|{
block|{
literal|"space"
block|,
literal|' '
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|,
block|{
literal|"acs"
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_kind_translate_urcorner
index|[]
init|=
block|{
block|{
literal|"space"
block|,
literal|' '
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|,
block|{
literal|"acs"
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_kind_translate_llcorner
index|[]
init|=
block|{
block|{
literal|"space"
block|,
literal|' '
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|,
block|{
literal|"acs"
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tui_translate
name|tui_border_kind_translate_lrcorner
index|[]
init|=
block|{
block|{
literal|"space"
block|,
literal|' '
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|,
block|{
literal|"acs"
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"ascii"
block|,
literal|'+'
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Tui configuration variables controlled with set/show command.  */
end_comment

begin_decl_stmt
specifier|const
name|char
modifier|*
name|tui_active_border_mode
init|=
literal|"bold-standout"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|char
modifier|*
name|tui_border_mode
init|=
literal|"normal"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|char
modifier|*
name|tui_border_kind
init|=
literal|"acs"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Tui internal configuration variables.  These variables are    updated by tui_update_variables to reflect the tui configuration    variables.  */
end_comment

begin_decl_stmt
name|chtype
name|tui_border_vline
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|chtype
name|tui_border_hline
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|chtype
name|tui_border_ulcorner
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|chtype
name|tui_border_urcorner
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|chtype
name|tui_border_llcorner
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|chtype
name|tui_border_lrcorner
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tui_border_attrs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tui_active_border_attrs
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Identify the item in the translation table.    When the item is not recognized, use the default entry.  */
end_comment

begin_function
specifier|static
name|struct
name|tui_translate
modifier|*
name|translate
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|struct
name|tui_translate
modifier|*
name|table
parameter_list|)
block|{
while|while
condition|(
name|table
operator|->
name|name
condition|)
block|{
if|if
condition|(
name|name
operator|&&
name|strcmp
argument_list|(
name|table
operator|->
name|name
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
name|table
return|;
name|table
operator|++
expr_stmt|;
block|}
comment|/* Not found, return default entry.  */
name|table
operator|++
expr_stmt|;
return|return
name|table
return|;
block|}
end_function

begin_comment
comment|/* Update the tui internal configuration according to gdb settings.    Returns 1 if the configuration has changed and the screen should    be redrawn.  */
end_comment

begin_function
name|int
name|tui_update_variables
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|need_redraw
init|=
literal|0
decl_stmt|;
name|struct
name|tui_translate
modifier|*
name|entry
decl_stmt|;
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_mode
argument_list|,
name|tui_border_mode_translate
argument_list|)
expr_stmt|;
if|if
condition|(
name|tui_border_attrs
operator|!=
name|entry
operator|->
name|value
condition|)
block|{
name|tui_border_attrs
operator|=
name|entry
operator|->
name|value
expr_stmt|;
name|need_redraw
operator|=
literal|1
expr_stmt|;
block|}
name|entry
operator|=
name|translate
argument_list|(
name|tui_active_border_mode
argument_list|,
name|tui_border_mode_translate
argument_list|)
expr_stmt|;
if|if
condition|(
name|tui_active_border_attrs
operator|!=
name|entry
operator|->
name|value
condition|)
block|{
name|tui_active_border_attrs
operator|=
name|entry
operator|->
name|value
expr_stmt|;
name|need_redraw
operator|=
literal|1
expr_stmt|;
block|}
comment|/* If one corner changes, all characters are changed.      Only check the first one.  The ACS characters are determined at      run time by curses terminal management.  */
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_kind
argument_list|,
name|tui_border_kind_translate_lrcorner
argument_list|)
expr_stmt|;
if|if
condition|(
name|tui_border_lrcorner
operator|!=
operator|(
name|chtype
operator|)
name|entry
operator|->
name|value
condition|)
block|{
name|tui_border_lrcorner
operator|=
operator|(
name|entry
operator|->
name|value
operator|<
literal|0
operator|)
condition|?
name|ACS_LRCORNER
else|:
name|entry
operator|->
name|value
expr_stmt|;
name|need_redraw
operator|=
literal|1
expr_stmt|;
block|}
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_kind
argument_list|,
name|tui_border_kind_translate_llcorner
argument_list|)
expr_stmt|;
name|tui_border_llcorner
operator|=
operator|(
name|entry
operator|->
name|value
operator|<
literal|0
operator|)
condition|?
name|ACS_LLCORNER
else|:
name|entry
operator|->
name|value
expr_stmt|;
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_kind
argument_list|,
name|tui_border_kind_translate_ulcorner
argument_list|)
expr_stmt|;
name|tui_border_ulcorner
operator|=
operator|(
name|entry
operator|->
name|value
operator|<
literal|0
operator|)
condition|?
name|ACS_ULCORNER
else|:
name|entry
operator|->
name|value
expr_stmt|;
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_kind
argument_list|,
name|tui_border_kind_translate_urcorner
argument_list|)
expr_stmt|;
name|tui_border_urcorner
operator|=
operator|(
name|entry
operator|->
name|value
operator|<
literal|0
operator|)
condition|?
name|ACS_URCORNER
else|:
name|entry
operator|->
name|value
expr_stmt|;
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_kind
argument_list|,
name|tui_border_kind_translate_hline
argument_list|)
expr_stmt|;
name|tui_border_hline
operator|=
operator|(
name|entry
operator|->
name|value
operator|<
literal|0
operator|)
condition|?
name|ACS_HLINE
else|:
name|entry
operator|->
name|value
expr_stmt|;
name|entry
operator|=
name|translate
argument_list|(
name|tui_border_kind
argument_list|,
name|tui_border_kind_translate_vline
argument_list|)
expr_stmt|;
name|tui_border_vline
operator|=
operator|(
name|entry
operator|->
name|value
operator|<
literal|0
operator|)
condition|?
name|ACS_VLINE
else|:
name|entry
operator|->
name|value
expr_stmt|;
return|return
name|need_redraw
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|set_tui_cmd
parameter_list|(
name|char
modifier|*
name|args
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
name|show_tui_cmd
parameter_list|(
name|char
modifier|*
name|args
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{ }
end_function

begin_decl_stmt
specifier|static
name|struct
name|cmd_list_element
modifier|*
name|tuilist
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|tui_command
parameter_list|(
name|char
modifier|*
name|args
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|printf_unfiltered
argument_list|(
literal|"\"tui\" must be followed by the name of a "
literal|"tui command.\n"
argument_list|)
expr_stmt|;
name|help_list
argument_list|(
name|tuilist
argument_list|,
literal|"tui "
argument_list|,
operator|-
literal|1
argument_list|,
name|gdb_stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|struct
name|cmd_list_element
modifier|*
modifier|*
name|tui_get_cmd_list
parameter_list|()
block|{
if|if
condition|(
name|tuilist
operator|==
literal|0
condition|)
name|add_prefix_cmd
argument_list|(
literal|"tui"
argument_list|,
name|class_tui
argument_list|,
name|tui_command
argument_list|,
literal|"Text User Interface commands."
argument_list|,
operator|&
name|tuilist
argument_list|,
literal|"tui "
argument_list|,
literal|0
argument_list|,
operator|&
name|cmdlist
argument_list|)
expr_stmt|;
return|return
operator|&
name|tuilist
return|;
block|}
end_function

begin_comment
comment|/* Function to initialize gdb commands, for tui window manipulation.  */
end_comment

begin_function
name|void
name|_initialize_tui_win
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|cmd_list_element
modifier|*
name|c
decl_stmt|;
specifier|static
name|struct
name|cmd_list_element
modifier|*
name|tui_setlist
decl_stmt|;
specifier|static
name|struct
name|cmd_list_element
modifier|*
name|tui_showlist
decl_stmt|;
comment|/* Define the classes of commands.      They will appear in the help list in the reverse of this order.  */
name|add_prefix_cmd
argument_list|(
literal|"tui"
argument_list|,
name|class_tui
argument_list|,
name|set_tui_cmd
argument_list|,
literal|"TUI configuration variables"
argument_list|,
operator|&
name|tui_setlist
argument_list|,
literal|"set tui "
argument_list|,
literal|0
comment|/*allow-unknown*/
argument_list|,
operator|&
name|setlist
argument_list|)
expr_stmt|;
name|add_prefix_cmd
argument_list|(
literal|"tui"
argument_list|,
name|class_tui
argument_list|,
name|show_tui_cmd
argument_list|,
literal|"TUI configuration variables"
argument_list|,
operator|&
name|tui_showlist
argument_list|,
literal|"show tui "
argument_list|,
literal|0
comment|/*allow-unknown*/
argument_list|,
operator|&
name|showlist
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"refresh"
argument_list|,
name|class_tui
argument_list|,
name|tui_refresh_all_command
argument_list|,
literal|"Refresh the terminal display.\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|xdb_commands
condition|)
name|add_com_alias
argument_list|(
literal|"U"
argument_list|,
literal|"refresh"
argument_list|,
name|class_tui
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"tabset"
argument_list|,
name|class_tui
argument_list|,
name|tui_set_tab_width_command
argument_list|,
literal|"Set the width (in characters) of tab stops.\n\ Usage: tabset<n>\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"winheight"
argument_list|,
name|class_tui
argument_list|,
name|tui_set_win_height_command
argument_list|,
literal|"Set the height of a specified window.\n\ Usage: winheight<win_name> [+ | -]<#lines>\n\ Window names are:\n\ src  : the source window\n\ cmd  : the command window\n\ asm  : the disassembly window\n\ regs : the register display\n"
argument_list|)
expr_stmt|;
name|add_com_alias
argument_list|(
literal|"wh"
argument_list|,
literal|"winheight"
argument_list|,
name|class_tui
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|add_info
argument_list|(
literal|"win"
argument_list|,
name|tui_all_windows_info
argument_list|,
literal|"List of all displayed windows.\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"focus"
argument_list|,
name|class_tui
argument_list|,
name|tui_set_focus_command
argument_list|,
literal|"Set focus to named window or next/prev window.\n\ Usage: focus {<win> | next | prev}\n\ Valid Window names are:\n\ src  : the source window\n\ asm  : the disassembly window\n\ regs : the register display\n\ cmd  : the command window\n"
argument_list|)
expr_stmt|;
name|add_com_alias
argument_list|(
literal|"fs"
argument_list|,
literal|"focus"
argument_list|,
name|class_tui
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"+"
argument_list|,
name|class_tui
argument_list|,
name|tui_scroll_forward_command
argument_list|,
literal|"Scroll window forward.\nUsage: + [win] [n]\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"-"
argument_list|,
name|class_tui
argument_list|,
name|tui_scroll_backward_command
argument_list|,
literal|"Scroll window backward.\nUsage: - [win] [n]\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"<"
argument_list|,
name|class_tui
argument_list|,
name|tui_scroll_left_command
argument_list|,
literal|"Scroll window forward.\nUsage:< [win] [n]\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|">"
argument_list|,
name|class_tui
argument_list|,
name|tui_scroll_right_command
argument_list|,
literal|"Scroll window backward.\nUsage:> [win] [n]\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|xdb_commands
condition|)
name|add_com
argument_list|(
literal|"w"
argument_list|,
name|class_xdb
argument_list|,
name|tui_xdb_set_win_height_command
argument_list|,
literal|"XDB compatibility command for setting the height of a command window.\n\ Usage: w<#lines>\n"
argument_list|)
expr_stmt|;
comment|/* Define the tui control variables.  */
name|c
operator|=
name|add_set_enum_cmd
argument_list|(
literal|"border-kind"
argument_list|,
name|no_class
argument_list|,
name|tui_border_kind_enums
argument_list|,
operator|&
name|tui_border_kind
argument_list|,
literal|"Set the kind of border for TUI windows.\n"
literal|"This variable controls the border of TUI windows:\n"
literal|"space           use a white space\n"
literal|"ascii           use ascii characters + - | for the border\n"
literal|"acs             use the Alternate Character Set\n"
argument_list|,
operator|&
name|tui_setlist
argument_list|)
expr_stmt|;
name|add_show_from_set
argument_list|(
name|c
argument_list|,
operator|&
name|tui_showlist
argument_list|)
expr_stmt|;
name|c
operator|=
name|add_set_enum_cmd
argument_list|(
literal|"border-mode"
argument_list|,
name|no_class
argument_list|,
name|tui_border_mode_enums
argument_list|,
operator|&
name|tui_border_mode
argument_list|,
literal|"Set the attribute mode to use for the TUI window borders.\n"
literal|"This variable controls the attributes to use for the window borders:\n"
literal|"normal          normal display\n"
literal|"standout        use highlight mode of terminal\n"
literal|"reverse         use reverse video mode\n"
literal|"half            use half bright\n"
literal|"half-standout   use half bright and standout mode\n"
literal|"bold            use extra bright or bold\n"
literal|"bold-standout   use extra bright or bold with standout mode\n"
argument_list|,
operator|&
name|tui_setlist
argument_list|)
expr_stmt|;
name|add_show_from_set
argument_list|(
name|c
argument_list|,
operator|&
name|tui_showlist
argument_list|)
expr_stmt|;
name|c
operator|=
name|add_set_enum_cmd
argument_list|(
literal|"active-border-mode"
argument_list|,
name|no_class
argument_list|,
name|tui_border_mode_enums
argument_list|,
operator|&
name|tui_active_border_mode
argument_list|,
literal|"Set the attribute mode to use for the active TUI window border.\n"
literal|"This variable controls the attributes to use for the active window border:\n"
literal|"normal          normal display\n"
literal|"standout        use highlight mode of terminal\n"
literal|"reverse         use reverse video mode\n"
literal|"half            use half bright\n"
literal|"half-standout   use half bright and standout mode\n"
literal|"bold            use extra bright or bold\n"
literal|"bold-standout   use extra bright or bold with standout mode\n"
argument_list|,
operator|&
name|tui_setlist
argument_list|)
expr_stmt|;
name|add_show_from_set
argument_list|(
name|c
argument_list|,
operator|&
name|tui_showlist
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Update gdb's knowledge of the terminal size.  */
end_comment

begin_function
name|void
name|tui_update_gdb_sizes
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|cmd
index|[
literal|50
index|]
decl_stmt|;
name|int
name|screenheight
decl_stmt|,
name|screenwidth
decl_stmt|;
name|rl_get_screen_size
argument_list|(
operator|&
name|screenheight
argument_list|,
operator|&
name|screenwidth
argument_list|)
expr_stmt|;
comment|/* Set to TUI command window dimension or use readline values.  */
name|sprintf
argument_list|(
name|cmd
argument_list|,
literal|"set width %d"
argument_list|,
name|tui_active
condition|?
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|width
else|:
name|screenwidth
argument_list|)
expr_stmt|;
name|execute_command
argument_list|(
name|cmd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|cmd
argument_list|,
literal|"set height %d"
argument_list|,
name|tui_active
condition|?
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
else|:
name|screenheight
argument_list|)
expr_stmt|;
name|execute_command
argument_list|(
name|cmd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Set the logical focus to win_info.    */
end_comment

begin_function
name|void
name|tui_set_win_focus_to
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_info
parameter_list|)
block|{
if|if
condition|(
name|win_info
operator|!=
name|NULL
condition|)
block|{
name|struct
name|tui_win_info
modifier|*
name|win_with_focus
init|=
name|tui_win_with_focus
argument_list|()
decl_stmt|;
if|if
condition|(
name|win_with_focus
operator|!=
name|NULL
operator|&&
name|win_with_focus
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
condition|)
name|tui_unhighlight_win
argument_list|(
name|win_with_focus
argument_list|)
expr_stmt|;
name|tui_set_win_with_focus
argument_list|(
name|win_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|win_info
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
condition|)
name|tui_highlight_win
argument_list|(
name|win_info
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|tui_scroll_forward
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
parameter_list|,
name|int
name|num_to_scroll
parameter_list|)
block|{
if|if
condition|(
name|win_to_scroll
operator|!=
name|TUI_CMD_WIN
condition|)
block|{
name|int
name|_num_to_scroll
init|=
name|num_to_scroll
decl_stmt|;
if|if
condition|(
name|num_to_scroll
operator|==
literal|0
condition|)
name|_num_to_scroll
operator|=
name|win_to_scroll
operator|->
name|generic
operator|.
name|height
operator|-
literal|3
expr_stmt|;
comment|/*          ** If we are scrolling the source or disassembly window, do a          ** "psuedo" scroll since not all of the source is in memory,          ** only what is in the viewport.  If win_to_scroll is the          ** command window do nothing since the term should handle it.        */
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_SRC_WIN
condition|)
name|tui_vertical_source_scroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_DISASM_WIN
condition|)
name|tui_vertical_disassem_scroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_DATA_WIN
condition|)
name|tui_vertical_data_scroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|tui_scroll_backward
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
parameter_list|,
name|int
name|num_to_scroll
parameter_list|)
block|{
if|if
condition|(
name|win_to_scroll
operator|!=
name|TUI_CMD_WIN
condition|)
block|{
name|int
name|_num_to_scroll
init|=
name|num_to_scroll
decl_stmt|;
if|if
condition|(
name|num_to_scroll
operator|==
literal|0
condition|)
name|_num_to_scroll
operator|=
name|win_to_scroll
operator|->
name|generic
operator|.
name|height
operator|-
literal|3
expr_stmt|;
comment|/*          ** If we are scrolling the source or disassembly window, do a          ** "psuedo" scroll since not all of the source is in memory,          ** only what is in the viewport.  If win_to_scroll is the          ** command window do nothing since the term should handle it.        */
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_SRC_WIN
condition|)
name|tui_vertical_source_scroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_DISASM_WIN
condition|)
name|tui_vertical_disassem_scroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_DATA_WIN
condition|)
name|tui_vertical_data_scroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|tui_scroll_left
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
parameter_list|,
name|int
name|num_to_scroll
parameter_list|)
block|{
if|if
condition|(
name|win_to_scroll
operator|!=
name|TUI_CMD_WIN
condition|)
block|{
name|int
name|_num_to_scroll
init|=
name|num_to_scroll
decl_stmt|;
if|if
condition|(
name|_num_to_scroll
operator|==
literal|0
condition|)
name|_num_to_scroll
operator|=
literal|1
expr_stmt|;
comment|/*          ** If we are scrolling the source or disassembly window, do a          ** "psuedo" scroll since not all of the source is in memory,          ** only what is in the viewport. If win_to_scroll is the          ** command window do nothing since the term should handle it.        */
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_SRC_WIN
operator|||
name|win_to_scroll
operator|==
name|TUI_DISASM_WIN
condition|)
name|tui_horizontal_source_scroll
argument_list|(
name|win_to_scroll
argument_list|,
name|LEFT_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|tui_scroll_right
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
parameter_list|,
name|int
name|num_to_scroll
parameter_list|)
block|{
if|if
condition|(
name|win_to_scroll
operator|!=
name|TUI_CMD_WIN
condition|)
block|{
name|int
name|_num_to_scroll
init|=
name|num_to_scroll
decl_stmt|;
if|if
condition|(
name|_num_to_scroll
operator|==
literal|0
condition|)
name|_num_to_scroll
operator|=
literal|1
expr_stmt|;
comment|/*          ** If we are scrolling the source or disassembly window, do a          ** "psuedo" scroll since not all of the source is in memory,          ** only what is in the viewport. If win_to_scroll is the          ** command window do nothing since the term should handle it.        */
if|if
condition|(
name|win_to_scroll
operator|==
name|TUI_SRC_WIN
operator|||
name|win_to_scroll
operator|==
name|TUI_DISASM_WIN
condition|)
name|tui_horizontal_source_scroll
argument_list|(
name|win_to_scroll
argument_list|,
name|RIGHT_SCROLL
argument_list|,
name|_num_to_scroll
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Scroll a window.  Arguments are passed through a va_list.    */
end_comment

begin_function
name|void
name|tui_scroll
parameter_list|(
name|enum
name|tui_scroll_direction
name|direction
parameter_list|,
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
parameter_list|,
name|int
name|num_to_scroll
parameter_list|)
block|{
switch|switch
condition|(
name|direction
condition|)
block|{
case|case
name|FORWARD_SCROLL
case|:
name|tui_scroll_forward
argument_list|(
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
break|break;
case|case
name|BACKWARD_SCROLL
case|:
name|tui_scroll_backward
argument_list|(
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEFT_SCROLL
case|:
name|tui_scroll_left
argument_list|(
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
break|break;
case|case
name|RIGHT_SCROLL
case|:
name|tui_scroll_right
argument_list|(
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|void
name|tui_refresh_all_win
parameter_list|(
name|void
parameter_list|)
block|{
name|enum
name|tui_win_type
name|type
decl_stmt|;
name|clearok
argument_list|(
name|curscr
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|tui_refresh_all
argument_list|(
name|tui_win_list
argument_list|)
expr_stmt|;
for|for
control|(
name|type
operator|=
name|SRC_WIN
init|;
name|type
operator|<
name|MAX_MAJOR_WINDOWS
condition|;
name|type
operator|++
control|)
block|{
if|if
condition|(
name|tui_win_list
index|[
name|type
index|]
operator|&&
name|tui_win_list
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|is_visible
condition|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
case|case
name|DISASSEM_WIN
case|:
name|tui_show_source_content
argument_list|(
name|tui_win_list
index|[
name|type
index|]
argument_list|)
expr_stmt|;
name|tui_check_and_display_highlight_if_needed
argument_list|(
name|tui_win_list
index|[
name|type
index|]
argument_list|)
expr_stmt|;
name|tui_erase_exec_info_content
argument_list|(
name|tui_win_list
index|[
name|type
index|]
argument_list|)
expr_stmt|;
name|tui_update_exec_info
argument_list|(
name|tui_win_list
index|[
name|type
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DATA_WIN
case|:
name|tui_refresh_data_win
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
name|tui_show_locator_content
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Resize all the windows based on the the terminal size.  This    function gets called from within the readline sinwinch handler.  */
end_comment

begin_function
name|void
name|tui_resize_all
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|height_diff
decl_stmt|,
name|width_diff
decl_stmt|;
name|int
name|screenheight
decl_stmt|,
name|screenwidth
decl_stmt|;
name|rl_get_screen_size
argument_list|(
operator|&
name|screenheight
argument_list|,
operator|&
name|screenwidth
argument_list|)
expr_stmt|;
name|width_diff
operator|=
name|screenwidth
operator|-
name|tui_term_width
argument_list|()
expr_stmt|;
name|height_diff
operator|=
name|screenheight
operator|-
name|tui_term_height
argument_list|()
expr_stmt|;
if|if
condition|(
name|height_diff
operator|||
name|width_diff
condition|)
block|{
name|enum
name|tui_layout_type
name|cur_layout
init|=
name|tui_current_layout
argument_list|()
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_with_focus
init|=
name|tui_win_with_focus
argument_list|()
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|first_win
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|second_win
decl_stmt|;
name|struct
name|tui_gen_win_info
modifier|*
name|locator
init|=
name|tui_locator_win_info_ptr
argument_list|()
decl_stmt|;
name|enum
name|tui_win_type
name|win_type
decl_stmt|;
name|int
name|new_height
decl_stmt|,
name|split_diff
decl_stmt|,
name|cmd_split_diff
decl_stmt|,
name|num_wins_displayed
init|=
literal|2
decl_stmt|;
ifdef|#
directive|ifdef
name|HAVE_RESIZE_TERM
name|resize_term
argument_list|(
name|screenheight
argument_list|,
name|screenwidth
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* turn keypad off while we resize */
if|if
condition|(
name|win_with_focus
operator|!=
name|TUI_CMD_WIN
condition|)
name|keypad
argument_list|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|handle
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|tui_update_gdb_sizes
argument_list|()
expr_stmt|;
name|tui_set_term_height_to
argument_list|(
name|screenheight
argument_list|)
expr_stmt|;
name|tui_set_term_width_to
argument_list|(
name|screenwidth
argument_list|)
expr_stmt|;
if|if
condition|(
name|cur_layout
operator|==
name|SRC_DISASSEM_COMMAND
operator|||
name|cur_layout
operator|==
name|SRC_DATA_COMMAND
operator|||
name|cur_layout
operator|==
name|DISASSEM_DATA_COMMAND
condition|)
name|num_wins_displayed
operator|++
expr_stmt|;
name|split_diff
operator|=
name|height_diff
operator|/
name|num_wins_displayed
expr_stmt|;
name|cmd_split_diff
operator|=
name|split_diff
expr_stmt|;
if|if
condition|(
name|height_diff
operator|%
name|num_wins_displayed
condition|)
block|{
if|if
condition|(
name|height_diff
operator|<
literal|0
condition|)
name|cmd_split_diff
operator|--
expr_stmt|;
else|else
name|cmd_split_diff
operator|++
expr_stmt|;
block|}
comment|/* now adjust each window */
name|clear
argument_list|()
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|cur_layout
condition|)
block|{
case|case
name|SRC_COMMAND
case|:
case|case
name|DISASSEM_COMMAND
case|:
name|first_win
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
name|first_win
operator|->
name|generic
operator|.
name|width
operator|+=
name|width_diff
expr_stmt|;
name|locator
operator|->
name|width
operator|+=
name|width_diff
expr_stmt|;
comment|/* check for invalid heights */
if|if
condition|(
name|height_diff
operator|==
literal|0
condition|)
name|new_height
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
operator|)
operator|>=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
condition|)
name|new_height
operator|=
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
operator|)
operator|<=
literal|0
condition|)
name|new_height
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
else|else
name|new_height
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|first_win
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|width
operator|+=
name|width_diff
expr_stmt|;
name|new_height
operator|=
name|screenheight
operator|-
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|first_win
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|first_win
operator|->
name|generic
operator|.
name|content_size
operator|<=
literal|0
condition|)
name|tui_erase_source_content
argument_list|(
name|first_win
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|cur_layout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|first_win
operator|=
name|TUI_SRC_WIN
expr_stmt|;
name|first_win
operator|->
name|generic
operator|.
name|width
operator|+=
name|width_diff
expr_stmt|;
name|second_win
operator|=
name|TUI_DISASM_WIN
expr_stmt|;
name|second_win
operator|->
name|generic
operator|.
name|width
operator|+=
name|width_diff
expr_stmt|;
block|}
else|else
block|{
name|first_win
operator|=
name|TUI_DATA_WIN
expr_stmt|;
name|first_win
operator|->
name|generic
operator|.
name|width
operator|+=
name|width_diff
expr_stmt|;
name|second_win
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
name|second_win
operator|->
name|generic
operator|.
name|width
operator|+=
name|width_diff
expr_stmt|;
block|}
comment|/* Change the first window's height/width */
comment|/* check for invalid heights */
if|if
condition|(
name|height_diff
operator|==
literal|0
condition|)
name|new_height
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
operator|(
name|split_diff
operator|*
literal|2
operator|)
operator|)
operator|>=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
condition|)
name|new_height
operator|=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
operator|)
operator|<=
literal|0
condition|)
name|new_height
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
else|else
name|new_height
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|first_win
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
name|locator
operator|->
name|width
operator|+=
name|width_diff
expr_stmt|;
comment|/* Change the second window's height/width */
comment|/* check for invalid heights */
if|if
condition|(
name|height_diff
operator|==
literal|0
condition|)
name|new_height
operator|=
name|second_win
operator|->
name|generic
operator|.
name|height
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
operator|(
name|split_diff
operator|*
literal|2
operator|)
operator|)
operator|>=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
condition|)
block|{
name|new_height
operator|=
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|new_height
operator|%
literal|2
condition|)
name|new_height
operator|=
operator|(
name|new_height
operator|/
literal|2
operator|)
operator|+
literal|1
expr_stmt|;
else|else
name|new_height
operator|/=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
operator|)
operator|<=
literal|0
condition|)
name|new_height
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
else|else
name|new_height
operator|=
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|split_diff
expr_stmt|;
name|second_win
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|second_win
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
comment|/* Change the command window's height/width */
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|,
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|cmd_split_diff
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|first_win
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|second_win
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|first_win
operator|->
name|generic
operator|.
name|content_size
operator|<=
literal|0
condition|)
name|tui_erase_source_content
argument_list|(
name|first_win
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
if|if
condition|(
name|second_win
operator|->
name|generic
operator|.
name|content_size
operator|<=
literal|0
condition|)
name|tui_erase_source_content
argument_list|(
name|second_win
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/*          ** Now remove all invisible windows, and their content so that they get          ** created again when called for with the new size        */
for|for
control|(
name|win_type
operator|=
name|SRC_WIN
init|;
operator|(
name|win_type
operator|<
name|MAX_MAJOR_WINDOWS
operator|)
condition|;
name|win_type
operator|++
control|)
block|{
if|if
condition|(
name|win_type
operator|!=
name|CMD_WIN
operator|&&
operator|(
name|tui_win_list
index|[
name|win_type
index|]
operator|!=
name|NULL
operator|)
operator|&&
operator|!
name|tui_win_list
index|[
name|win_type
index|]
operator|->
name|generic
operator|.
name|is_visible
condition|)
block|{
name|tui_free_window
argument_list|(
name|tui_win_list
index|[
name|win_type
index|]
argument_list|)
expr_stmt|;
name|tui_win_list
index|[
name|win_type
index|]
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
name|NULL
expr_stmt|;
block|}
block|}
name|tui_set_win_resized_to
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
comment|/* turn keypad back on, unless focus is in the command window */
if|if
condition|(
name|win_with_focus
operator|!=
name|TUI_CMD_WIN
condition|)
name|keypad
argument_list|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|handle
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* SIGWINCH signal handler for the tui.  This signal handler is always    called, even when the readline package clears signals because it is    set as the old_sigwinch() (TUI only).  */
end_comment

begin_function
name|void
name|tui_sigwinch_handler
parameter_list|(
name|int
name|signal
parameter_list|)
block|{
comment|/*      ** Say that a resize was done so that the readline can do it      ** later when appropriate.    */
name|tui_set_win_resized_to
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/************************* ** STATIC LOCAL FUNCTIONS **************************/
end_comment

begin_function
specifier|static
name|void
name|tui_scroll_forward_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|int
name|num_to_scroll
init|=
literal|1
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
decl_stmt|;
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|parse_scrolling_args
argument_list|(
name|arg
argument_list|,
operator|&
name|win_to_scroll
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
else|else
name|parse_scrolling_args
argument_list|(
name|arg
argument_list|,
operator|&
name|win_to_scroll
argument_list|,
operator|&
name|num_to_scroll
argument_list|)
expr_stmt|;
name|tui_scroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tui_scroll_backward_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|int
name|num_to_scroll
init|=
literal|1
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
decl_stmt|;
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|parse_scrolling_args
argument_list|(
name|arg
argument_list|,
operator|&
name|win_to_scroll
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
else|else
name|parse_scrolling_args
argument_list|(
name|arg
argument_list|,
operator|&
name|win_to_scroll
argument_list|,
operator|&
name|num_to_scroll
argument_list|)
expr_stmt|;
name|tui_scroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tui_scroll_left_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|int
name|num_to_scroll
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
decl_stmt|;
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
name|parse_scrolling_args
argument_list|(
name|arg
argument_list|,
operator|&
name|win_to_scroll
argument_list|,
operator|&
name|num_to_scroll
argument_list|)
expr_stmt|;
name|tui_scroll
argument_list|(
name|LEFT_SCROLL
argument_list|,
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tui_scroll_right_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|int
name|num_to_scroll
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_to_scroll
decl_stmt|;
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
name|parse_scrolling_args
argument_list|(
name|arg
argument_list|,
operator|&
name|win_to_scroll
argument_list|,
operator|&
name|num_to_scroll
argument_list|)
expr_stmt|;
name|tui_scroll
argument_list|(
name|RIGHT_SCROLL
argument_list|,
name|win_to_scroll
argument_list|,
name|num_to_scroll
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Set focus to the window named by 'arg'.  */
end_comment

begin_function
specifier|static
name|void
name|tui_set_focus
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|buf_ptr
init|=
operator|(
name|char
operator|*
operator|)
name|xstrdup
argument_list|(
name|arg
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_info
init|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
name|NULL
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|strlen
argument_list|(
name|buf_ptr
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|buf_ptr
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|arg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|subset_compare
argument_list|(
name|buf_ptr
argument_list|,
literal|"NEXT"
argument_list|)
condition|)
name|win_info
operator|=
name|tui_next_win
argument_list|(
name|tui_win_with_focus
argument_list|()
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|subset_compare
argument_list|(
name|buf_ptr
argument_list|,
literal|"PREV"
argument_list|)
condition|)
name|win_info
operator|=
name|tui_prev_win
argument_list|(
name|tui_win_with_focus
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|win_info
operator|=
name|tui_partial_win_by_name
argument_list|(
name|buf_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|win_info
operator|==
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
name|NULL
operator|||
operator|!
name|win_info
operator|->
name|generic
operator|.
name|is_visible
condition|)
name|warning
argument_list|(
literal|"Invalid window specified. \n\ The window name specified must be valid and visible.\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|tui_set_win_focus_to
argument_list|(
name|win_info
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|handle
argument_list|,
operator|(
name|win_info
operator|!=
name|TUI_CMD_WIN
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TUI_DATA_WIN
operator|&&
name|TUI_DATA_WIN
operator|->
name|generic
operator|.
name|is_visible
condition|)
name|tui_refresh_data_win
argument_list|()
expr_stmt|;
name|xfree
argument_list|(
name|buf_ptr
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"Focus set to %s window.\n"
argument_list|,
name|tui_win_name
argument_list|(
operator|(
expr|struct
name|tui_gen_win_info
operator|*
operator|)
name|tui_win_with_focus
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Incorrect Number of Arguments.\n%s"
argument_list|,
name|FOCUS_USAGE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tui_set_focus_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
name|tui_set_focus
argument_list|(
name|arg
argument_list|,
name|from_tty
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tui_all_windows_info
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|enum
name|tui_win_type
name|type
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_with_focus
init|=
name|tui_win_with_focus
argument_list|()
decl_stmt|;
for|for
control|(
name|type
operator|=
name|SRC_WIN
init|;
operator|(
name|type
operator|<
name|MAX_MAJOR_WINDOWS
operator|)
condition|;
name|type
operator|++
control|)
if|if
condition|(
name|tui_win_list
index|[
name|type
index|]
operator|&&
name|tui_win_list
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|is_visible
condition|)
block|{
if|if
condition|(
name|win_with_focus
operator|==
name|tui_win_list
index|[
name|type
index|]
condition|)
name|printf_filtered
argument_list|(
literal|"        %s\t(%d lines)<has focus>\n"
argument_list|,
name|tui_win_name
argument_list|(
operator|&
name|tui_win_list
index|[
name|type
index|]
operator|->
name|generic
argument_list|)
argument_list|,
name|tui_win_list
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
else|else
name|printf_filtered
argument_list|(
literal|"        %s\t(%d lines)\n"
argument_list|,
name|tui_win_name
argument_list|(
operator|&
name|tui_win_list
index|[
name|type
index|]
operator|->
name|generic
argument_list|)
argument_list|,
name|tui_win_list
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tui_refresh_all_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
name|tui_refresh_all_win
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Set the height of the specified window.   */
end_comment

begin_function
specifier|static
name|void
name|tui_set_tab_width_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|int
name|ts
decl_stmt|;
name|ts
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ts
operator|>
literal|0
condition|)
name|tui_set_default_tab_len
argument_list|(
name|ts
argument_list|)
expr_stmt|;
else|else
name|warning
argument_list|(
literal|"Tab widths greater than 0 must be specified.\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Set the height of the specified window.   */
end_comment

begin_function
specifier|static
name|void
name|tui_set_win_height
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|buf
init|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
decl_stmt|;
name|char
modifier|*
name|buf_ptr
init|=
name|buf
decl_stmt|;
name|char
modifier|*
name|wname
init|=
operator|(
name|char
operator|*
operator|)
name|NULL
decl_stmt|;
name|int
name|new_height
decl_stmt|,
name|i
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_info
decl_stmt|;
name|wname
operator|=
name|buf_ptr
expr_stmt|;
name|buf_ptr
operator|=
name|strchr
argument_list|(
name|buf_ptr
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_ptr
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
operator|*
name|buf_ptr
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
comment|/* 	     ** Validate the window name 	   */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|wname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|win_info
operator|=
name|tui_partial_win_by_name
argument_list|(
name|wname
argument_list|)
expr_stmt|;
if|if
condition|(
name|win_info
operator|==
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
name|NULL
operator|||
operator|!
name|win_info
operator|->
name|generic
operator|.
name|is_visible
condition|)
name|warning
argument_list|(
literal|"Invalid window specified. \n\ The window name specified must be valid and visible.\n"
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Process the size */
while|while
condition|(
operator|*
operator|(
operator|++
name|buf_ptr
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
if|if
condition|(
operator|*
name|buf_ptr
operator|!=
operator|(
name|char
operator|)
literal|0
condition|)
block|{
name|int
name|negate
init|=
name|FALSE
decl_stmt|;
name|int
name|fixed_size
init|=
name|TRUE
decl_stmt|;
name|int
name|input_no
decl_stmt|;
empty_stmt|;
if|if
condition|(
operator|*
name|buf_ptr
operator|==
literal|'+'
operator|||
operator|*
name|buf_ptr
operator|==
literal|'-'
condition|)
block|{
if|if
condition|(
operator|*
name|buf_ptr
operator|==
literal|'-'
condition|)
name|negate
operator|=
name|TRUE
expr_stmt|;
name|fixed_size
operator|=
name|FALSE
expr_stmt|;
name|buf_ptr
operator|++
expr_stmt|;
block|}
name|input_no
operator|=
name|atoi
argument_list|(
name|buf_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|input_no
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|negate
condition|)
name|input_no
operator|*=
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|fixed_size
condition|)
name|new_height
operator|=
name|input_no
expr_stmt|;
else|else
name|new_height
operator|=
name|win_info
operator|->
name|generic
operator|.
name|height
operator|+
name|input_no
expr_stmt|;
comment|/* 		         ** Now change the window's height, and adjust all 		         ** other windows around it 		       */
if|if
condition|(
name|tui_adjust_win_heights
argument_list|(
name|win_info
argument_list|,
name|new_height
argument_list|)
operator|==
name|TUI_FAILURE
condition|)
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
else|else
name|tui_update_gdb_sizes
argument_list|()
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
name|printf_filtered
argument_list|(
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|xfree
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
else|else
name|printf_filtered
argument_list|(
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Set the height of the specified window, with va_list.    */
end_comment

begin_function
specifier|static
name|void
name|tui_set_win_height_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
name|tui_set_win_height
argument_list|(
name|arg
argument_list|,
name|from_tty
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* XDB Compatibility command for setting the window height.  This will    increase or decrease the command window by the specified amount.  */
end_comment

begin_function
specifier|static
name|void
name|tui_xdb_set_win_height
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
comment|/* Make sure the curses mode is enabled.  */
name|tui_enable
argument_list|()
expr_stmt|;
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|int
name|input_no
init|=
name|atoi
argument_list|(
name|arg
argument_list|)
decl_stmt|;
if|if
condition|(
name|input_no
operator|>
literal|0
condition|)
block|{
comment|/* Add 1 for the locator */
name|int
name|new_height
init|=
name|tui_term_height
argument_list|()
operator|-
operator|(
name|input_no
operator|+
literal|1
operator|)
decl_stmt|;
if|if
condition|(
operator|!
name|new_height_ok
argument_list|(
name|tui_win_list
index|[
name|CMD_WIN
index|]
argument_list|,
name|new_height
argument_list|)
operator|||
name|tui_adjust_win_heights
argument_list|(
name|tui_win_list
index|[
name|CMD_WIN
index|]
argument_list|,
name|new_height
argument_list|)
operator|==
name|TUI_FAILURE
condition|)
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|XDBWIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|XDBWIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|XDBWIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Set the height of the specified window, with va_list.  */
end_comment

begin_function
specifier|static
name|void
name|tui_xdb_set_win_height_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|from_tty
parameter_list|)
block|{
name|tui_xdb_set_win_height
argument_list|(
name|arg
argument_list|,
name|from_tty
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Function to adjust all window heights around the primary.   */
end_comment

begin_function
specifier|static
name|enum
name|tui_status
name|tui_adjust_win_heights
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|primary_win_info
parameter_list|,
name|int
name|new_height
parameter_list|)
block|{
name|enum
name|tui_status
name|status
init|=
name|TUI_FAILURE
decl_stmt|;
if|if
condition|(
name|new_height_ok
argument_list|(
name|primary_win_info
argument_list|,
name|new_height
argument_list|)
condition|)
block|{
name|status
operator|=
name|TUI_SUCCESS
expr_stmt|;
if|if
condition|(
name|new_height
operator|!=
name|primary_win_info
operator|->
name|generic
operator|.
name|height
condition|)
block|{
name|int
name|diff
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|win_info
decl_stmt|;
name|struct
name|tui_gen_win_info
modifier|*
name|locator
init|=
name|tui_locator_win_info_ptr
argument_list|()
decl_stmt|;
name|enum
name|tui_layout_type
name|cur_layout
init|=
name|tui_current_layout
argument_list|()
decl_stmt|;
name|diff
operator|=
operator|(
name|new_height
operator|-
name|primary_win_info
operator|->
name|generic
operator|.
name|height
operator|)
operator|*
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|cur_layout
operator|==
name|SRC_COMMAND
operator|||
name|cur_layout
operator|==
name|DISASSEM_COMMAND
condition|)
block|{
name|struct
name|tui_win_info
modifier|*
name|src_win_info
decl_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|primary_win_info
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|primary_win_info
operator|->
name|generic
operator|.
name|type
operator|==
name|CMD_WIN
condition|)
block|{
name|win_info
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
name|src_win_info
operator|=
name|win_info
expr_stmt|;
block|}
else|else
block|{
name|win_info
operator|=
name|tui_win_list
index|[
name|CMD_WIN
index|]
expr_stmt|;
name|src_win_info
operator|=
name|primary_win_info
expr_stmt|;
block|}
name|make_invisible_and_set_new_height
argument_list|(
name|win_info
argument_list|,
name|win_info
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
argument_list|)
expr_stmt|;
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|win_info
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|primary_win_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|src_win_info
operator|->
name|generic
operator|.
name|content_size
operator|<=
literal|0
condition|)
name|tui_erase_source_content
argument_list|(
name|src_win_info
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|struct
name|tui_win_info
modifier|*
name|first_win
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|second_win
decl_stmt|;
if|if
condition|(
name|cur_layout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|first_win
operator|=
name|TUI_SRC_WIN
expr_stmt|;
name|second_win
operator|=
name|TUI_DISASM_WIN
expr_stmt|;
block|}
else|else
block|{
name|first_win
operator|=
name|TUI_DATA_WIN
expr_stmt|;
name|second_win
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
block|}
if|if
condition|(
name|primary_win_info
operator|==
name|TUI_CMD_WIN
condition|)
block|{
comment|/* 				   ** Split the change in height accross the 1st& 2nd windows 				   ** adjusting them as well. 				 */
name|int
name|first_split_diff
init|=
name|diff
operator|/
literal|2
decl_stmt|;
comment|/* subtract the locator */
name|int
name|second_split_diff
init|=
name|first_split_diff
decl_stmt|;
if|if
condition|(
name|diff
operator|%
literal|2
condition|)
block|{
if|if
condition|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|>
name|second_win
operator|->
name|generic
operator|.
name|height
condition|)
if|if
condition|(
name|diff
operator|<
literal|0
condition|)
name|first_split_diff
operator|--
expr_stmt|;
else|else
name|first_split_diff
operator|++
expr_stmt|;
else|else
block|{
if|if
condition|(
name|diff
operator|<
literal|0
condition|)
name|second_split_diff
operator|--
expr_stmt|;
else|else
name|second_split_diff
operator|++
expr_stmt|;
block|}
block|}
comment|/* make sure that the minimum hieghts are honored */
while|while
condition|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|first_split_diff
operator|)
operator|<
literal|3
condition|)
block|{
name|first_split_diff
operator|++
expr_stmt|;
name|second_split_diff
operator|--
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_split_diff
operator|)
operator|<
literal|3
condition|)
block|{
name|second_split_diff
operator|++
expr_stmt|;
name|first_split_diff
operator|--
expr_stmt|;
block|}
name|make_invisible_and_set_new_height
argument_list|(
name|first_win
argument_list|,
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|first_split_diff
argument_list|)
expr_stmt|;
name|second_win
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|second_win
argument_list|,
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_split_diff
argument_list|)
expr_stmt|;
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|make_invisible_and_set_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|<
literal|1
condition|)
block|{
comment|/* 				   ** If there is no way to increase the command window 				   ** take real estate from the 1st or 2nd window. 				 */
if|if
condition|(
operator|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|<
literal|1
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
init|;
operator|(
name|i
operator|<
literal|1
operator|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|primary_win_info
operator|==
name|first_win
condition|)
name|second_win
operator|->
name|generic
operator|.
name|height
operator|--
expr_stmt|;
else|else
name|first_win
operator|->
name|generic
operator|.
name|height
operator|--
expr_stmt|;
block|}
block|}
if|if
condition|(
name|primary_win_info
operator|==
name|first_win
condition|)
name|make_invisible_and_set_new_height
argument_list|(
name|first_win
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
else|else
name|make_invisible_and_set_new_height
argument_list|(
name|first_win
argument_list|,
name|first_win
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
name|second_win
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|first_win
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|primary_win_info
operator|==
name|second_win
condition|)
name|make_invisible_and_set_new_height
argument_list|(
name|second_win
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
else|else
name|make_invisible_and_set_new_height
argument_list|(
name|second_win
argument_list|,
name|second_win
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|<
literal|1
condition|)
name|make_invisible_and_set_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|,
literal|1
argument_list|)
expr_stmt|;
else|else
name|make_invisible_and_set_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|,
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
argument_list|)
expr_stmt|;
block|}
name|make_visible_with_new_height
argument_list|(
name|TUI_CMD_WIN
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|second_win
argument_list|)
expr_stmt|;
name|make_visible_with_new_height
argument_list|(
name|first_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|first_win
operator|->
name|generic
operator|.
name|content_size
operator|<=
literal|0
condition|)
name|tui_erase_source_content
argument_list|(
name|first_win
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
if|if
condition|(
name|second_win
operator|->
name|generic
operator|.
name|content_size
operator|<=
literal|0
condition|)
name|tui_erase_source_content
argument_list|(
name|second_win
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
block|}
block|}
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* Function make the target window (and auxillary windows associated    with the targer) invisible, and set the new height and location.  */
end_comment

begin_function
specifier|static
name|void
name|make_invisible_and_set_new_height
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_info
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|struct
name|tui_gen_win_info
modifier|*
name|gen_win_info
decl_stmt|;
name|tui_make_invisible
argument_list|(
operator|&
name|win_info
operator|->
name|generic
argument_list|)
expr_stmt|;
name|win_info
operator|->
name|generic
operator|.
name|height
operator|=
name|height
expr_stmt|;
if|if
condition|(
name|height
operator|>
literal|1
condition|)
name|win_info
operator|->
name|generic
operator|.
name|viewport_height
operator|=
name|height
operator|-
literal|1
expr_stmt|;
else|else
name|win_info
operator|->
name|generic
operator|.
name|viewport_height
operator|=
name|height
expr_stmt|;
if|if
condition|(
name|win_info
operator|!=
name|TUI_CMD_WIN
condition|)
name|win_info
operator|->
name|generic
operator|.
name|viewport_height
operator|--
expr_stmt|;
comment|/* Now deal with the auxillary windows associated with win_info */
switch|switch
condition|(
name|win_info
operator|->
name|generic
operator|.
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
case|case
name|DISASSEM_WIN
case|:
name|gen_win_info
operator|=
name|win_info
operator|->
name|detail
operator|.
name|source_info
operator|.
name|execution_info
expr_stmt|;
name|tui_make_invisible
argument_list|(
name|gen_win_info
argument_list|)
expr_stmt|;
name|gen_win_info
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|gen_win_info
operator|->
name|origin
operator|.
name|y
operator|=
name|win_info
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|height
operator|>
literal|1
condition|)
name|gen_win_info
operator|->
name|viewport_height
operator|=
name|height
operator|-
literal|1
expr_stmt|;
else|else
name|gen_win_info
operator|->
name|viewport_height
operator|=
name|height
expr_stmt|;
if|if
condition|(
name|win_info
operator|!=
name|TUI_CMD_WIN
condition|)
name|gen_win_info
operator|->
name|viewport_height
operator|--
expr_stmt|;
if|if
condition|(
name|tui_win_has_locator
argument_list|(
name|win_info
argument_list|)
condition|)
block|{
name|gen_win_info
operator|=
name|tui_locator_win_info_ptr
argument_list|()
expr_stmt|;
name|tui_make_invisible
argument_list|(
name|gen_win_info
argument_list|)
expr_stmt|;
name|gen_win_info
operator|->
name|origin
operator|.
name|y
operator|=
name|win_info
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|+
name|height
expr_stmt|;
block|}
break|break;
case|case
name|DATA_WIN
case|:
comment|/* delete all data item windows */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|win_info
operator|->
name|generic
operator|.
name|content_size
condition|;
name|i
operator|++
control|)
block|{
name|gen_win_info
operator|=
operator|(
expr|struct
name|tui_gen_win_info
operator|*
operator|)
operator|&
operator|(
operator|(
expr|struct
name|tui_win_element
operator|*
operator|)
name|win_info
operator|->
name|generic
operator|.
name|content
index|[
name|i
index|]
operator|)
operator|->
name|which_element
operator|.
name|data_window
expr_stmt|;
name|tui_delete_win
argument_list|(
name|gen_win_info
operator|->
name|handle
argument_list|)
expr_stmt|;
name|gen_win_info
operator|->
name|handle
operator|=
operator|(
name|WINDOW
operator|*
operator|)
name|NULL
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_comment
comment|/* Function to make the windows with new heights visible.  This means    re-creating the windows' content since the window had to be    destroyed to be made invisible.  */
end_comment

begin_function
specifier|static
name|void
name|make_visible_with_new_height
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|win_info
parameter_list|)
block|{
name|struct
name|symtab
modifier|*
name|s
decl_stmt|;
name|tui_make_visible
argument_list|(
operator|&
name|win_info
operator|->
name|generic
argument_list|)
expr_stmt|;
name|tui_check_and_display_highlight_if_needed
argument_list|(
name|win_info
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|win_info
operator|->
name|generic
operator|.
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
case|case
name|DISASSEM_WIN
case|:
name|tui_free_win_content
argument_list|(
name|win_info
operator|->
name|detail
operator|.
name|source_info
operator|.
name|execution_info
argument_list|)
expr_stmt|;
name|tui_make_visible
argument_list|(
name|win_info
operator|->
name|detail
operator|.
name|source_info
operator|.
name|execution_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|win_info
operator|->
name|generic
operator|.
name|content
operator|!=
name|NULL
condition|)
block|{
name|union
name|tui_line_or_address
name|line_or_addr
decl_stmt|;
name|struct
name|symtab_and_line
name|cursal
init|=
name|get_current_source_symtab_and_line
argument_list|()
decl_stmt|;
if|if
condition|(
name|win_info
operator|->
name|generic
operator|.
name|type
operator|==
name|SRC_WIN
condition|)
name|line_or_addr
operator|.
name|line_no
operator|=
name|win_info
operator|->
name|detail
operator|.
name|source_info
operator|.
name|start_line_or_addr
operator|.
name|line_no
expr_stmt|;
else|else
name|line_or_addr
operator|.
name|addr
operator|=
name|win_info
operator|->
name|detail
operator|.
name|source_info
operator|.
name|start_line_or_addr
operator|.
name|addr
expr_stmt|;
name|tui_free_win_content
argument_list|(
operator|&
name|win_info
operator|->
name|generic
argument_list|)
expr_stmt|;
name|tui_update_source_window
argument_list|(
name|win_info
argument_list|,
name|cursal
operator|.
name|symtab
argument_list|,
name|line_or_addr
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|deprecated_selected_frame
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
condition|)
block|{
name|union
name|tui_line_or_address
name|line
decl_stmt|;
name|struct
name|symtab_and_line
name|cursal
init|=
name|get_current_source_symtab_and_line
argument_list|()
decl_stmt|;
name|s
operator|=
name|find_pc_symtab
argument_list|(
name|get_frame_pc
argument_list|(
name|deprecated_selected_frame
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|win_info
operator|->
name|generic
operator|.
name|type
operator|==
name|SRC_WIN
condition|)
name|line
operator|.
name|line_no
operator|=
name|cursal
operator|.
name|line
expr_stmt|;
else|else
block|{
name|find_line_pc
argument_list|(
name|s
argument_list|,
name|cursal
operator|.
name|line
argument_list|,
operator|&
name|line
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
name|tui_update_source_window
argument_list|(
name|win_info
argument_list|,
name|s
argument_list|,
name|line
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tui_win_has_locator
argument_list|(
name|win_info
argument_list|)
condition|)
block|{
name|tui_make_visible
argument_list|(
name|tui_locator_win_info_ptr
argument_list|()
argument_list|)
expr_stmt|;
name|tui_show_locator_content
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|DATA_WIN
case|:
name|tui_display_all_data
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_WIN
case|:
name|win_info
operator|->
name|detail
operator|.
name|command_info
operator|.
name|cur_line
operator|=
literal|0
expr_stmt|;
name|win_info
operator|->
name|detail
operator|.
name|command_info
operator|.
name|curch
operator|=
literal|0
expr_stmt|;
name|wmove
argument_list|(
name|win_info
operator|->
name|generic
operator|.
name|handle
argument_list|,
name|win_info
operator|->
name|detail
operator|.
name|command_info
operator|.
name|cur_line
argument_list|,
name|win_info
operator|->
name|detail
operator|.
name|command_info
operator|.
name|curch
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|new_height_ok
parameter_list|(
name|struct
name|tui_win_info
modifier|*
name|primary_win_info
parameter_list|,
name|int
name|new_height
parameter_list|)
block|{
name|int
name|ok
init|=
operator|(
name|new_height
operator|<
name|tui_term_height
argument_list|()
operator|)
decl_stmt|;
if|if
condition|(
name|ok
condition|)
block|{
name|int
name|diff
decl_stmt|;
name|enum
name|tui_layout_type
name|cur_layout
init|=
name|tui_current_layout
argument_list|()
decl_stmt|;
name|diff
operator|=
operator|(
name|new_height
operator|-
name|primary_win_info
operator|->
name|generic
operator|.
name|height
operator|)
operator|*
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|cur_layout
operator|==
name|SRC_COMMAND
operator|||
name|cur_layout
operator|==
name|DISASSEM_COMMAND
condition|)
block|{
name|ok
operator|=
operator|(
operator|(
name|primary_win_info
operator|->
name|generic
operator|.
name|type
operator|==
name|CMD_WIN
operator|&&
name|new_height
operator|<=
operator|(
name|tui_term_height
argument_list|()
operator|-
literal|4
operator|)
operator|&&
name|new_height
operator|>=
name|MIN_CMD_WIN_HEIGHT
operator|)
operator|||
operator|(
name|primary_win_info
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
operator|&&
name|new_height
operator|<=
operator|(
name|tui_term_height
argument_list|()
operator|-
literal|2
operator|)
operator|&&
name|new_height
operator|>=
name|MIN_WIN_HEIGHT
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|ok
condition|)
block|{
comment|/* check the total height */
name|struct
name|tui_win_info
modifier|*
name|win_info
decl_stmt|;
if|if
condition|(
name|primary_win_info
operator|==
name|TUI_CMD_WIN
condition|)
name|win_info
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
else|else
name|win_info
operator|=
name|TUI_CMD_WIN
expr_stmt|;
name|ok
operator|=
operator|(
operator|(
name|new_height
operator|+
operator|(
name|win_info
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|)
operator|<=
name|tui_term_height
argument_list|()
operator|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|cur_total_height
decl_stmt|,
name|total_height
decl_stmt|,
name|min_height
init|=
literal|0
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|first_win
decl_stmt|;
name|struct
name|tui_win_info
modifier|*
name|second_win
decl_stmt|;
if|if
condition|(
name|cur_layout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|first_win
operator|=
name|TUI_SRC_WIN
expr_stmt|;
name|second_win
operator|=
name|TUI_DISASM_WIN
expr_stmt|;
block|}
else|else
block|{
name|first_win
operator|=
name|TUI_DATA_WIN
expr_stmt|;
name|second_win
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
block|}
comment|/* 	     ** We could simply add all the heights to obtain the same result 	     ** but below is more explicit since we subtract 1 for the 	     ** line that the first and second windows share, and add one 	     ** for the locator. 	   */
name|total_height
operator|=
name|cur_total_height
operator|=
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_win
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
operator|)
operator|+
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
literal|1
comment|/*locator */
expr_stmt|;
if|if
condition|(
name|primary_win_info
operator|==
name|TUI_CMD_WIN
condition|)
block|{
comment|/* locator included since first& second win share a line */
name|ok
operator|=
operator|(
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>=
operator|(
name|MIN_WIN_HEIGHT
operator|*
literal|2
operator|)
operator|&&
name|new_height
operator|>=
name|MIN_CMD_WIN_HEIGHT
operator|)
expr_stmt|;
if|if
condition|(
name|ok
condition|)
block|{
name|total_height
operator|=
name|new_height
operator|+
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
expr_stmt|;
name|min_height
operator|=
name|MIN_CMD_WIN_HEIGHT
expr_stmt|;
block|}
block|}
else|else
block|{
name|min_height
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
comment|/* 	         ** First see if we can increase/decrease the command 	         ** window.  And make sure that the command window is 	         ** at least 1 line 	       */
name|ok
operator|=
operator|(
operator|(
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>
literal|0
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|ok
condition|)
block|{
comment|/* 				   ** Looks like we have to increase/decrease one of 				   ** the other windows 				 */
if|if
condition|(
name|primary_win_info
operator|==
name|first_win
condition|)
name|ok
operator|=
operator|(
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>=
name|min_height
expr_stmt|;
else|else
name|ok
operator|=
operator|(
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>=
name|min_height
expr_stmt|;
block|}
if|if
condition|(
name|ok
condition|)
block|{
if|if
condition|(
name|primary_win_info
operator|==
name|first_win
condition|)
name|total_height
operator|=
name|new_height
operator|+
name|second_win
operator|->
name|generic
operator|.
name|height
operator|+
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
expr_stmt|;
else|else
name|total_height
operator|=
name|new_height
operator|+
name|first_win
operator|->
name|generic
operator|.
name|height
operator|+
name|TUI_CMD_WIN
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
expr_stmt|;
block|}
block|}
comment|/* 	     ** Now make sure that the proposed total height doesn't exceed 	     ** the old total height. 	   */
if|if
condition|(
name|ok
condition|)
name|ok
operator|=
operator|(
name|new_height
operator|>=
name|min_height
operator|&&
name|total_height
operator|<=
name|cur_total_height
operator|)
expr_stmt|;
block|}
block|}
return|return
name|ok
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|parse_scrolling_args
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|struct
name|tui_win_info
modifier|*
modifier|*
name|win_to_scroll
parameter_list|,
name|int
modifier|*
name|num_to_scroll
parameter_list|)
block|{
if|if
condition|(
name|num_to_scroll
condition|)
operator|*
name|num_to_scroll
operator|=
literal|0
expr_stmt|;
operator|*
name|win_to_scroll
operator|=
name|tui_win_with_focus
argument_list|()
expr_stmt|;
comment|/*      ** First set up the default window to scroll, in case there is no      ** window name arg    */
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|buf_ptr
decl_stmt|;
comment|/* process the number of lines to scroll */
name|buf
operator|=
name|buf_ptr
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|isdigit
argument_list|(
operator|*
name|buf_ptr
argument_list|)
condition|)
block|{
name|char
modifier|*
name|num_str
decl_stmt|;
name|num_str
operator|=
name|buf_ptr
expr_stmt|;
name|buf_ptr
operator|=
name|strchr
argument_list|(
name|buf_ptr
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_ptr
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
operator|*
name|buf_ptr
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
if|if
condition|(
name|num_to_scroll
condition|)
operator|*
name|num_to_scroll
operator|=
name|atoi
argument_list|(
name|num_str
argument_list|)
expr_stmt|;
name|buf_ptr
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|num_to_scroll
condition|)
operator|*
name|num_to_scroll
operator|=
name|atoi
argument_list|(
name|num_str
argument_list|)
expr_stmt|;
block|}
comment|/* process the window name if one is specified */
if|if
condition|(
name|buf_ptr
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|wname
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|*
name|buf_ptr
operator|==
literal|' '
condition|)
while|while
condition|(
operator|*
operator|(
operator|++
name|buf_ptr
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
if|if
condition|(
operator|*
name|buf_ptr
operator|!=
operator|(
name|char
operator|)
literal|0
condition|)
name|wname
operator|=
name|buf_ptr
expr_stmt|;
else|else
name|wname
operator|=
literal|"?"
expr_stmt|;
comment|/* Validate the window name */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|wname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
operator|*
name|win_to_scroll
operator|=
name|tui_partial_win_by_name
argument_list|(
name|wname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|win_to_scroll
operator|==
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
name|NULL
operator|||
operator|!
operator|(
operator|*
name|win_to_scroll
operator|)
operator|->
name|generic
operator|.
name|is_visible
condition|)
name|warning
argument_list|(
literal|"Invalid window specified. \n\ The window name specified must be valid and visible.\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|win_to_scroll
operator|==
name|TUI_CMD_WIN
condition|)
operator|*
name|win_to_scroll
operator|=
operator|(
expr|struct
name|tui_win_info
operator|*
operator|)
operator|(
name|tui_source_windows
argument_list|()
operator|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
block|}
name|xfree
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

