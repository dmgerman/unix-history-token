begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$Id: mdoc_man.c,v 1.9 2011/10/24 21:47:59 schwarze Exp $ */
end_comment

begin_comment
comment|/*  * Copyright (c) 2011 Ingo Schwarze<schwarze@openbsd.org>  *  * Permission to use, copy, modify, and distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"mandoc.h"
end_include

begin_include
include|#
directive|include
file|"man.h"
end_include

begin_include
include|#
directive|include
file|"mdoc.h"
end_include

begin_include
include|#
directive|include
file|"main.h"
end_include

begin_define
define|#
directive|define
name|DECL_ARGS
value|const struct mdoc_meta *m, \ 		  const struct mdoc_node *n, \ 		  struct mman *mm
end_define

begin_struct
struct|struct
name|mman
block|{
name|int
name|need_space
decl_stmt|;
comment|/* next word needs prior ws */
name|int
name|need_nl
decl_stmt|;
comment|/* next word needs prior nl */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|manact
block|{
name|int
function_decl|(
modifier|*
name|cond
function_decl|)
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
comment|/* DON'T run actions */
name|int
function_decl|(
modifier|*
name|pre
function_decl|)
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
comment|/* pre-node action */
name|void
function_decl|(
modifier|*
name|post
function_decl|)
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
comment|/* post-node action */
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
comment|/* pre-node string constant */
specifier|const
name|char
modifier|*
name|suffix
decl_stmt|;
comment|/* post-node string constant */
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|int
name|cond_body
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|cond_head
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_bd
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_dl
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_enc
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_nm
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_percent
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_pf
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_sect
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|post_sp
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_ap
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_bd
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_br
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_bx
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_dl
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_enc
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_it
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_nm
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_ns
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_pp
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_sp
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_sect
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_ux
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|pre_xr
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_word
parameter_list|(
name|struct
name|mman
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_node
parameter_list|(
name|DECL_ARGS
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|manact
name|manacts
index|[
name|MDOC_MAX
operator|+
literal|1
index|]
init|=
block|{
block|{
name|NULL
block|,
name|pre_ap
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ap */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dd */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dt */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Os */
block|{
name|NULL
block|,
name|pre_sect
block|,
name|post_sect
block|,
literal|".SH"
block|,
name|NULL
block|}
block|,
comment|/* Sh */
block|{
name|NULL
block|,
name|pre_sect
block|,
name|post_sect
block|,
literal|".SS"
block|,
name|NULL
block|}
block|,
comment|/* Ss */
block|{
name|NULL
block|,
name|pre_pp
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Pp */
block|{
name|cond_body
block|,
name|pre_dl
block|,
name|post_dl
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* D1 */
block|{
name|cond_body
block|,
name|pre_dl
block|,
name|post_dl
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dl */
block|{
name|cond_body
block|,
name|pre_bd
block|,
name|post_bd
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bd */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ed */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bl */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* El */
block|{
name|NULL
block|,
name|pre_it
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _It */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fI"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Ad */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _An */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fI"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Ar */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fB"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Cd */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fB"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Cm */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fR"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Dv */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fR"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Er */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fR"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Ev */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"The \\fB"
block|,
literal|"\\fP\nutility exits 0 on success, and>0 if an error occurs."
block|}
block|,
comment|/* Ex */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Fa */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Fd */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fB-"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Fl */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Fn */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Ft */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fB"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Ic */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _In */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fR"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Li */
block|{
name|cond_head
block|,
name|pre_enc
block|,
name|NULL
block|,
literal|"\\- "
block|,
name|NULL
block|}
block|,
comment|/* Nd */
block|{
name|NULL
block|,
name|pre_nm
block|,
name|post_nm
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Nm */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Op */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ot */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fI"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Pa */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"The \\fB"
block|,
literal|"\\fP\nfunction returns the value 0 if successful;\n"
literal|"otherwise the value -1 is returned and the global\n"
literal|"variable \\fIerrno\\fP is set to indicate the error."
block|}
block|,
comment|/* Rv */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* St */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Va */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Vt */
block|{
name|NULL
block|,
name|pre_xr
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Xr */
block|{
name|NULL
block|,
name|NULL
block|,
name|post_percent
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%A */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%B */
block|{
name|NULL
block|,
name|NULL
block|,
name|post_percent
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%D */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%I */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_percent
block|,
literal|"\\fI"
block|,
literal|"\\fP"
block|}
block|,
comment|/* %J */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%N */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%O */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%P */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%R */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_percent
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* %T */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%V */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ac */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"<"
block|,
literal|">"
block|}
block|,
comment|/* Ao */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"<"
block|,
literal|">"
block|}
block|,
comment|/* Aq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* At */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bc */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Bf */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Bo */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Bq */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"BSD/OS"
block|,
name|NULL
block|}
block|,
comment|/* Bsx */
block|{
name|NULL
block|,
name|pre_bx
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bx */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Db */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dc */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"``"
block|,
literal|"''"
block|}
block|,
comment|/* Do */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"``"
block|,
literal|"''"
block|}
block|,
comment|/* Dq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Ec */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Ef */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fI"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Em */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Eo */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"FreeBSD"
block|,
name|NULL
block|}
block|,
comment|/* Fx */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fB"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Ms */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* No */
block|{
name|NULL
block|,
name|pre_ns
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ns */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"NetBSD"
block|,
name|NULL
block|}
block|,
comment|/* Nx */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"OpenBSD"
block|,
name|NULL
block|}
block|,
comment|/* Ox */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Pc */
block|{
name|NULL
block|,
name|NULL
block|,
name|post_pf
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Pf */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"("
block|,
literal|")"
block|}
block|,
comment|/* Po */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"("
block|,
literal|")"
block|}
block|,
comment|/* Pq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Qc */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"`"
block|,
literal|"'"
block|}
block|,
comment|/* Ql */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* Qo */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* Qq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Re */
block|{
name|cond_body
block|,
name|pre_pp
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Rs */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Sc */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"`"
block|,
literal|"'"
block|}
block|,
comment|/* So */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"`"
block|,
literal|"'"
block|}
block|,
comment|/* Sq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Sm */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fI"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Sx */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fB"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Sy */
block|{
name|NULL
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"\\fR"
block|,
literal|"\\fP"
block|}
block|,
comment|/* Tn */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"UNIX"
block|,
name|NULL
block|}
block|,
comment|/* Ux */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Xc */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Xo */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Fo */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Fc */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Oo */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Oc */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Bk */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Ek */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"is currently in beta test."
block|,
name|NULL
block|}
block|,
comment|/* Bt */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Hf */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Fr */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"currently under development."
block|,
name|NULL
block|}
block|,
comment|/* Ud */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Lb */
block|{
name|NULL
block|,
name|pre_pp
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Lp */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Lk */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Mt */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"{"
block|,
literal|"}"
block|}
block|,
comment|/* Brq */
block|{
name|cond_body
block|,
name|pre_enc
block|,
name|post_enc
block|,
literal|"{"
block|,
literal|"}"
block|}
block|,
comment|/* Bro */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Brc */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%C */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Es */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _En */
block|{
name|NULL
block|,
name|pre_ux
block|,
name|NULL
block|,
literal|"DragonFly"
block|,
name|NULL
block|}
block|,
comment|/* Dx */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%Q */
block|{
name|NULL
block|,
name|pre_br
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* br */
block|{
name|NULL
block|,
name|pre_sp
block|,
name|post_sp
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* sp */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _%U */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* _Ta */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* ROOT */
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|print_word
parameter_list|(
name|struct
name|mman
modifier|*
name|mm
parameter_list|,
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
if|if
condition|(
name|mm
operator|->
name|need_nl
condition|)
block|{
comment|/*  		 * If we need a newline, print it now and start afresh. 		 */
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mm
operator|->
name|need_space
operator|&&
literal|'\0'
operator|!=
name|s
index|[
literal|0
index|]
condition|)
comment|/* 		 * If we need a space, only print it before 		 * (1) a nonzero length word; 		 * (2) a word that is non-punctuation; and 		 * (3) if punctuation, non-terminating puncutation. 		 */
if|if
condition|(
name|NULL
operator|==
name|strchr
argument_list|(
literal|".,:;)]?!"
argument_list|,
name|s
index|[
literal|0
index|]
argument_list|)
operator|||
literal|'\0'
operator|!=
name|s
index|[
literal|1
index|]
condition|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
comment|/* 	 * Reassign needing space if we're not following opening 	 * punctuation. 	 */
name|mm
operator|->
name|need_space
operator|=
operator|(
literal|'('
operator|!=
name|s
index|[
literal|0
index|]
operator|&&
literal|'['
operator|!=
name|s
index|[
literal|0
index|]
operator|)
operator|||
literal|'\0'
operator|!=
name|s
index|[
literal|1
index|]
expr_stmt|;
for|for
control|(
init|;
operator|*
name|s
condition|;
name|s
operator|++
control|)
block|{
switch|switch
condition|(
operator|*
name|s
condition|)
block|{
case|case
operator|(
name|ASCII_NBRSP
operator|)
case|:
name|printf
argument_list|(
literal|"\\~"
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|ASCII_HYPH
operator|)
case|:
name|putchar
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
break|break;
default|default:
name|putchar
argument_list|(
operator|(
name|unsigned
name|char
operator|)
operator|*
name|s
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
name|void
name|man_man
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|man
modifier|*
name|man
parameter_list|)
block|{
comment|/* 	 * Dump the keep buffer. 	 * We're guaranteed by now that this exists (is non-NULL). 	 * Flush stdout afterward, just in case. 	 */
name|fputs
argument_list|(
name|mparse_getkeep
argument_list|(
name|man_mparse
argument_list|(
name|man
argument_list|)
argument_list|)
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|man_mdoc
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|mdoc
modifier|*
name|mdoc
parameter_list|)
block|{
specifier|const
name|struct
name|mdoc_meta
modifier|*
name|m
decl_stmt|;
specifier|const
name|struct
name|mdoc_node
modifier|*
name|n
decl_stmt|;
name|struct
name|mman
name|mm
decl_stmt|;
name|m
operator|=
name|mdoc_meta
argument_list|(
name|mdoc
argument_list|)
expr_stmt|;
name|n
operator|=
name|mdoc_node
argument_list|(
name|mdoc
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".TH \"%s\" \"%s\" \"%s\" \"%s\" \"%s\""
argument_list|,
name|m
operator|->
name|title
argument_list|,
name|m
operator|->
name|msec
argument_list|,
name|m
operator|->
name|date
argument_list|,
name|m
operator|->
name|os
argument_list|,
name|m
operator|->
name|vol
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|mm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|mman
argument_list|)
argument_list|)
expr_stmt|;
name|mm
operator|.
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_node
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
operator|&
name|mm
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_node
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
specifier|const
name|struct
name|mdoc_node
modifier|*
name|prev
decl_stmt|,
modifier|*
name|sub
decl_stmt|;
specifier|const
name|struct
name|manact
modifier|*
name|act
decl_stmt|;
name|int
name|cond
decl_stmt|,
name|do_sub
decl_stmt|;
comment|/* 	 * Break the line if we were parsed subsequent the current node. 	 * This makes the page structure be more consistent. 	 */
name|prev
operator|=
name|n
operator|->
name|prev
condition|?
name|n
operator|->
name|prev
else|:
name|n
operator|->
name|parent
expr_stmt|;
if|if
condition|(
name|prev
operator|&&
name|prev
operator|->
name|line
operator|<
name|n
operator|->
name|line
condition|)
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|act
operator|=
name|NULL
expr_stmt|;
name|cond
operator|=
literal|0
expr_stmt|;
name|do_sub
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|MDOC_TEXT
operator|==
name|n
operator|->
name|type
condition|)
block|{
comment|/* 		 * Make sure that we don't happen to start with a 		 * control character at the start of a line. 		 */
if|if
condition|(
name|mm
operator|->
name|need_nl
operator|&&
operator|(
literal|'.'
operator|==
operator|*
name|n
operator|->
name|string
operator|||
literal|'\''
operator|==
operator|*
name|n
operator|->
name|string
operator|)
condition|)
block|{
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\\&"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
block|}
name|print_word
argument_list|(
name|mm
argument_list|,
name|n
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* 		 * Conditionally run the pre-node action handler for a 		 * node. 		 */
name|act
operator|=
name|manacts
operator|+
name|n
operator|->
name|tok
expr_stmt|;
name|cond
operator|=
name|NULL
operator|==
name|act
operator|->
name|cond
operator|||
call|(
modifier|*
name|act
operator|->
name|cond
call|)
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
name|mm
argument_list|)
expr_stmt|;
if|if
condition|(
name|cond
operator|&&
name|act
operator|->
name|pre
condition|)
name|do_sub
operator|=
call|(
modifier|*
name|act
operator|->
name|pre
call|)
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
name|mm
argument_list|)
expr_stmt|;
block|}
comment|/*  	 * Conditionally run all child nodes. 	 * Note that this iterates over children instead of using 	 * recursion.  This prevents unnecessary depth in the stack. 	 */
if|if
condition|(
name|do_sub
condition|)
for|for
control|(
name|sub
operator|=
name|n
operator|->
name|child
init|;
name|sub
condition|;
name|sub
operator|=
name|sub
operator|->
name|next
control|)
name|print_node
argument_list|(
name|m
argument_list|,
name|sub
argument_list|,
name|mm
argument_list|)
expr_stmt|;
comment|/* 	 * Lastly, conditionally run the post-node handler. 	 */
if|if
condition|(
name|cond
operator|&&
name|act
operator|->
name|post
condition|)
call|(
modifier|*
name|act
operator|->
name|post
call|)
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
name|mm
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|cond_head
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
return|return
operator|(
name|MDOC_HEAD
operator|==
name|n
operator|->
name|type
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|cond_body
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
return|return
operator|(
name|MDOC_BODY
operator|==
name|n
operator|->
name|type
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Output a font encoding before a node, e.g., \fR.  * This obviously has no trailing space.  */
end_comment

begin_function
specifier|static
name|int
name|pre_enc
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
name|prefix
operator|=
name|manacts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|prefix
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|prefix
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|print_word
argument_list|(
name|mm
argument_list|,
name|prefix
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Output a font encoding subsequent a node, e.g., \fP.  */
end_comment

begin_function
specifier|static
name|void
name|post_enc
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|suffix
decl_stmt|;
name|suffix
operator|=
name|manacts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|suffix
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|suffix
condition|)
return|return;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
name|suffix
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Used in listings (percent = %A, e.g.).  * FIXME: this is incomplete.   * It doesn't print a nice ", and" for lists.  */
end_comment

begin_function
specifier|static
name|void
name|post_percent
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|post_enc
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
name|mm
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|next
condition|)
name|print_word
argument_list|(
name|mm
argument_list|,
literal|","
argument_list|)
expr_stmt|;
else|else
block|{
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print before a section header.  */
end_comment

begin_function
specifier|static
name|int
name|pre_sect
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
if|if
condition|(
name|MDOC_HEAD
operator|!=
name|n
operator|->
name|type
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
name|manacts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|prefix
argument_list|)
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Print subsequent a section header.  */
end_comment

begin_function
specifier|static
name|void
name|post_sect
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
if|if
condition|(
name|MDOC_HEAD
operator|!=
name|n
operator|->
name|type
condition|)
return|return;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_ap
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"'"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_bd
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
if|if
condition|(
name|DISP_unfilled
operator|==
name|n
operator|->
name|norm
operator|->
name|Bd
operator|.
name|type
operator|||
name|DISP_literal
operator|==
name|n
operator|->
name|norm
operator|->
name|Bd
operator|.
name|type
condition|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".nf"
argument_list|)
expr_stmt|;
block|}
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|post_bd
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
if|if
condition|(
name|DISP_unfilled
operator|==
name|n
operator|->
name|norm
operator|->
name|Bd
operator|.
name|type
operator|||
name|DISP_literal
operator|==
name|n
operator|->
name|norm
operator|->
name|Bd
operator|.
name|type
condition|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".fi"
argument_list|)
expr_stmt|;
block|}
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_br
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".br"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_bx
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|n
operator|=
name|n
operator|->
name|child
expr_stmt|;
if|if
condition|(
name|n
condition|)
block|{
name|print_word
argument_list|(
name|mm
argument_list|,
name|n
operator|->
name|string
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|n
operator|=
name|n
operator|->
name|next
expr_stmt|;
block|}
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"BSD"
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|n
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
name|n
operator|->
name|string
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_dl
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".RS 6n"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|post_dl
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".RE"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_it
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
specifier|const
name|struct
name|mdoc_node
modifier|*
name|bln
decl_stmt|;
if|if
condition|(
name|MDOC_HEAD
operator|==
name|n
operator|->
name|type
condition|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".TP"
argument_list|)
expr_stmt|;
name|bln
operator|=
name|n
operator|->
name|parent
operator|->
name|parent
operator|->
name|prev
expr_stmt|;
switch|switch
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
condition|)
block|{
case|case
operator|(
name|LIST_bullet
operator|)
case|:
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"4n"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\\fBo\\fP"
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|width
condition|)
name|print_word
argument_list|(
name|mm
argument_list|,
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|width
argument_list|)
expr_stmt|;
break|break;
block|}
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_nm
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
if|if
condition|(
name|MDOC_ELEM
operator|!=
name|n
operator|->
name|type
operator|&&
name|MDOC_HEAD
operator|!=
name|n
operator|->
name|type
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\\fB"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|n
operator|->
name|child
condition|)
name|print_word
argument_list|(
name|mm
argument_list|,
name|m
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|post_nm
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
if|if
condition|(
name|MDOC_ELEM
operator|!=
name|n
operator|->
name|type
operator|&&
name|MDOC_HEAD
operator|!=
name|n
operator|->
name|type
condition|)
return|return;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\\fP"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_ns
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|post_pf
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_pp
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|MDOC_It
operator|==
name|n
operator|->
name|parent
operator|->
name|tok
condition|)
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".sp"
argument_list|)
expr_stmt|;
else|else
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".PP"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_sp
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|".sp"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|post_sp
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|mm
operator|->
name|need_nl
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_xr
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|n
operator|=
name|n
operator|->
name|child
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|n
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|print_node
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
name|mm
argument_list|)
expr_stmt|;
name|n
operator|=
name|n
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|n
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|print_node
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
name|mm
argument_list|)
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pre_ux
parameter_list|(
name|DECL_ARGS
parameter_list|)
block|{
name|print_word
argument_list|(
name|mm
argument_list|,
name|manacts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|prefix
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
name|n
operator|->
name|child
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
name|print_word
argument_list|(
name|mm
argument_list|,
literal|"\\~"
argument_list|)
expr_stmt|;
name|mm
operator|->
name|need_space
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

end_unit

