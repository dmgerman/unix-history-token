begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * deprecated.c:  holding file for all deprecated APIs.  *                "we can't lose 'em, but we can shun 'em!"  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* ==================================================================== */
end_comment

begin_escape
end_escape

begin_comment
comment|/*** Includes. ***/
end_comment

begin_comment
comment|/* We define this here to remove any further warnings about the usage of    deprecated functions in this file. */
end_comment

begin_define
define|#
directive|define
name|SVN_DEPRECATED
end_define

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"svn_client.h"
end_include

begin_include
include|#
directive|include
file|"svn_path.h"
end_include

begin_include
include|#
directive|include
file|"svn_compat.h"
end_include

begin_include
include|#
directive|include
file|"svn_hash.h"
end_include

begin_include
include|#
directive|include
file|"svn_props.h"
end_include

begin_include
include|#
directive|include
file|"svn_utf.h"
end_include

begin_include
include|#
directive|include
file|"svn_string.h"
end_include

begin_include
include|#
directive|include
file|"svn_pools.h"
end_include

begin_include
include|#
directive|include
file|"client.h"
end_include

begin_include
include|#
directive|include
file|"mergeinfo.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_opt_private.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_wc_private.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_escape
end_escape

begin_comment
comment|/*** Code. ***/
end_comment

begin_comment
comment|/* Baton for capture_commit_info() */
end_comment

begin_struct
struct|struct
name|capture_baton_t
block|{
name|svn_commit_info_t
modifier|*
modifier|*
name|info
decl_stmt|;
name|apr_pool_t
modifier|*
name|pool
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Callback which implements svn_commit_callback2_t for use with some    backward compat functions. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|capture_commit_info
parameter_list|(
specifier|const
name|svn_commit_info_t
modifier|*
name|commit_info
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
modifier|*
name|cb
init|=
name|baton
decl_stmt|;
operator|*
operator|(
name|cb
operator|->
name|info
operator|)
operator|=
name|svn_commit_info_dup
argument_list|(
name|commit_info
argument_list|,
name|cb
operator|->
name|pool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From add.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_add4
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|add_parents
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_add5
argument_list|(
name|path
argument_list|,
name|depth
argument_list|,
name|force
argument_list|,
name|no_ignore
argument_list|,
name|FALSE
argument_list|,
name|add_parents
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_add3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_add4
argument_list|(
name|path
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recursive
argument_list|)
argument_list|,
name|force
argument_list|,
name|no_ignore
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_add2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_add3
argument_list|(
name|path
argument_list|,
name|recursive
argument_list|,
name|force
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_add
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_add3
argument_list|(
name|path
argument_list|,
name|recursive
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_mkdir3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|make_parents
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_mkdir4
argument_list|(
name|paths
argument_list|,
name|make_parents
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_mkdir2
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_mkdir3
argument_list|(
name|commit_info_p
argument_list|,
name|paths
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_mkdir
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_info_t
modifier|*
name|commit_info
init|=
name|NULL
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_mkdir2
argument_list|(
operator|&
name|commit_info
argument_list|,
name|paths
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* These structs have the same layout for the common fields. */
operator|*
name|commit_info_p
operator|=
operator|(
name|svn_client_commit_info_t
operator|*
operator|)
name|commit_info
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From blame.c ***/
end_comment

begin_struct
struct|struct
name|blame_receiver_wrapper_baton2
block|{
name|void
modifier|*
name|baton
decl_stmt|;
name|svn_client_blame_receiver2_t
name|receiver
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|blame_wrapper_receiver2
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|svn_revnum_t
name|start_revnum
parameter_list|,
name|svn_revnum_t
name|end_revnum
parameter_list|,
name|apr_int64_t
name|line_no
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|apr_hash_t
modifier|*
name|rev_props
parameter_list|,
name|svn_revnum_t
name|merged_revision
parameter_list|,
name|apr_hash_t
modifier|*
name|merged_rev_props
parameter_list|,
specifier|const
name|char
modifier|*
name|merged_path
parameter_list|,
specifier|const
name|char
modifier|*
name|line
parameter_list|,
name|svn_boolean_t
name|local_change
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|blame_receiver_wrapper_baton2
modifier|*
name|brwb
init|=
name|baton
decl_stmt|;
specifier|const
name|char
modifier|*
name|author
init|=
name|NULL
decl_stmt|;
specifier|const
name|char
modifier|*
name|date
init|=
name|NULL
decl_stmt|;
specifier|const
name|char
modifier|*
name|merged_author
init|=
name|NULL
decl_stmt|;
specifier|const
name|char
modifier|*
name|merged_date
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|rev_props
operator|!=
name|NULL
condition|)
block|{
name|author
operator|=
name|svn_prop_get_value
argument_list|(
name|rev_props
argument_list|,
name|SVN_PROP_REVISION_AUTHOR
argument_list|)
expr_stmt|;
name|date
operator|=
name|svn_prop_get_value
argument_list|(
name|rev_props
argument_list|,
name|SVN_PROP_REVISION_DATE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|merged_rev_props
operator|!=
name|NULL
condition|)
block|{
name|merged_author
operator|=
name|svn_prop_get_value
argument_list|(
name|merged_rev_props
argument_list|,
name|SVN_PROP_REVISION_AUTHOR
argument_list|)
expr_stmt|;
name|merged_date
operator|=
name|svn_prop_get_value
argument_list|(
name|merged_rev_props
argument_list|,
name|SVN_PROP_REVISION_DATE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|brwb
operator|->
name|receiver
condition|)
return|return
name|brwb
operator|->
name|receiver
argument_list|(
name|brwb
operator|->
name|baton
argument_list|,
name|line_no
argument_list|,
name|revision
argument_list|,
name|author
argument_list|,
name|date
argument_list|,
name|merged_revision
argument_list|,
name|merged_author
argument_list|,
name|merged_date
argument_list|,
name|merged_path
argument_list|,
name|line
argument_list|,
name|pool
argument_list|)
return|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_blame4
parameter_list|(
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
specifier|const
name|svn_diff_file_options_t
modifier|*
name|diff_options
parameter_list|,
name|svn_boolean_t
name|ignore_mime_type
parameter_list|,
name|svn_boolean_t
name|include_merged_revisions
parameter_list|,
name|svn_client_blame_receiver2_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|blame_receiver_wrapper_baton2
name|baton
decl_stmt|;
name|baton
operator|.
name|receiver
operator|=
name|receiver
expr_stmt|;
name|baton
operator|.
name|baton
operator|=
name|receiver_baton
expr_stmt|;
return|return
name|svn_client_blame5
argument_list|(
name|target
argument_list|,
name|peg_revision
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|diff_options
argument_list|,
name|ignore_mime_type
argument_list|,
name|include_merged_revisions
argument_list|,
name|blame_wrapper_receiver2
argument_list|,
operator|&
name|baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Baton for use with wrap_blame_receiver */
end_comment

begin_struct
struct|struct
name|blame_receiver_wrapper_baton
block|{
name|void
modifier|*
name|baton
decl_stmt|;
name|svn_client_blame_receiver_t
name|receiver
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* This implements svn_client_blame_receiver2_t */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|blame_wrapper_receiver
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|apr_int64_t
name|line_no
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
specifier|const
name|char
modifier|*
name|date
parameter_list|,
name|svn_revnum_t
name|merged_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|merged_author
parameter_list|,
specifier|const
name|char
modifier|*
name|merged_date
parameter_list|,
specifier|const
name|char
modifier|*
name|merged_path
parameter_list|,
specifier|const
name|char
modifier|*
name|line
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|blame_receiver_wrapper_baton
modifier|*
name|brwb
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|brwb
operator|->
name|receiver
condition|)
return|return
name|brwb
operator|->
name|receiver
argument_list|(
name|brwb
operator|->
name|baton
argument_list|,
name|line_no
argument_list|,
name|revision
argument_list|,
name|author
argument_list|,
name|date
argument_list|,
name|line
argument_list|,
name|pool
argument_list|)
return|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wrap_blame_receiver
parameter_list|(
name|svn_client_blame_receiver2_t
modifier|*
name|receiver2
parameter_list|,
name|void
modifier|*
modifier|*
name|receiver2_baton
parameter_list|,
name|svn_client_blame_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|blame_receiver_wrapper_baton
modifier|*
name|brwb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|brwb
argument_list|)
argument_list|)
decl_stmt|;
comment|/* Set the user provided old format callback in the baton. */
name|brwb
operator|->
name|baton
operator|=
name|receiver_baton
expr_stmt|;
name|brwb
operator|->
name|receiver
operator|=
name|receiver
expr_stmt|;
operator|*
name|receiver2_baton
operator|=
name|brwb
expr_stmt|;
operator|*
name|receiver2
operator|=
name|blame_wrapper_receiver
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_blame3
parameter_list|(
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
specifier|const
name|svn_diff_file_options_t
modifier|*
name|diff_options
parameter_list|,
name|svn_boolean_t
name|ignore_mime_type
parameter_list|,
name|svn_client_blame_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_client_blame_receiver2_t
name|receiver2
decl_stmt|;
name|void
modifier|*
name|receiver2_baton
decl_stmt|;
name|wrap_blame_receiver
argument_list|(
operator|&
name|receiver2
argument_list|,
operator|&
name|receiver2_baton
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_blame4
argument_list|(
name|target
argument_list|,
name|peg_revision
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|diff_options
argument_list|,
name|ignore_mime_type
argument_list|,
name|FALSE
argument_list|,
name|receiver2
argument_list|,
name|receiver2_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* svn_client_blame3 guarantees 'no EOL chars' as part of the receiver    LINE argument.  Older versions depend on the fact that if a CR is    required, that CR is already part of the LINE data.     Because of this difference, we need to trap old receivers and append    a CR to LINE before passing it on to the actual receiver on platforms    which want CRLF line termination.  */
end_comment

begin_struct
struct|struct
name|wrapped_receiver_baton_s
block|{
name|svn_client_blame_receiver_t
name|orig_receiver
decl_stmt|;
name|void
modifier|*
name|orig_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrapped_receiver
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|apr_int64_t
name|line_no
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
specifier|const
name|char
modifier|*
name|date
parameter_list|,
specifier|const
name|char
modifier|*
name|line
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrapped_receiver_baton_s
modifier|*
name|b
init|=
name|baton
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|expanded_line
init|=
name|svn_stringbuf_create
argument_list|(
name|line
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_appendbyte
argument_list|(
name|expanded_line
argument_list|,
literal|'\r'
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|orig_receiver
argument_list|(
name|b
operator|->
name|orig_baton
argument_list|,
name|line_no
argument_list|,
name|revision
argument_list|,
name|author
argument_list|,
name|date
argument_list|,
name|expanded_line
operator|->
name|data
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wrap_pre_blame3_receiver
parameter_list|(
name|svn_client_blame_receiver_t
modifier|*
name|receiver
parameter_list|,
name|void
modifier|*
modifier|*
name|receiver_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
sizeof|sizeof
argument_list|(
name|APR_EOL_STR
argument_list|)
operator|==
literal|3
condition|)
block|{
name|struct
name|wrapped_receiver_baton_s
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|b
operator|->
name|orig_receiver
operator|=
operator|*
name|receiver
expr_stmt|;
name|b
operator|->
name|orig_baton
operator|=
operator|*
name|receiver_baton
expr_stmt|;
operator|*
name|receiver_baton
operator|=
name|b
expr_stmt|;
operator|*
name|receiver
operator|=
name|wrapped_receiver
expr_stmt|;
block|}
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_blame2
parameter_list|(
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
name|svn_client_blame_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|wrap_pre_blame3_receiver
argument_list|(
operator|&
name|receiver
argument_list|,
operator|&
name|receiver_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_blame3
argument_list|(
name|target
argument_list|,
name|peg_revision
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|svn_diff_file_options_create
argument_list|(
name|pool
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_blame
parameter_list|(
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
name|svn_client_blame_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|wrap_pre_blame3_receiver
argument_list|(
operator|&
name|receiver
argument_list|,
operator|&
name|receiver_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_blame2
argument_list|(
name|target
argument_list|,
name|end
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From cmdline.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_args_to_target_array
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|targets_p
parameter_list|,
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|known_targets
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_args_to_target_array2
argument_list|(
name|targets_p
argument_list|,
name|os
argument_list|,
name|known_targets
argument_list|,
name|ctx
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From commit.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_import4
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|ignore_unknown_node_types
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_commit_callback2_t
name|commit_callback
parameter_list|,
name|void
modifier|*
name|commit_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_client_import5
argument_list|(
name|path
argument_list|,
name|url
argument_list|,
name|depth
argument_list|,
name|no_ignore
argument_list|,
name|FALSE
argument_list|,
name|ignore_unknown_node_types
argument_list|,
name|revprop_table
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|commit_callback
argument_list|,
name|commit_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_import3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|ignore_unknown_node_types
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_import4
argument_list|(
name|path
argument_list|,
name|url
argument_list|,
name|depth
argument_list|,
name|no_ignore
argument_list|,
name|ignore_unknown_node_types
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_import2
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_boolean_t
name|nonrecursive
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_import3
argument_list|(
name|commit_info_p
argument_list|,
name|path
argument_list|,
name|url
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
operator|!
name|nonrecursive
argument_list|)
argument_list|,
name|no_ignore
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_import
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_boolean_t
name|nonrecursive
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_info_t
modifier|*
name|commit_info
init|=
name|NULL
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_import2
argument_list|(
operator|&
name|commit_info
argument_list|,
name|path
argument_list|,
name|url
argument_list|,
name|nonrecursive
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* These structs have the same layout for the common fields. */
operator|*
name|commit_info_p
operator|=
operator|(
name|svn_client_commit_info_t
operator|*
operator|)
name|commit_info
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Wrapper notify_func2 function and baton for downgrading    svn_wc_notify_commit_copied and svn_wc_notify_commit_copied_replaced    to svn_wc_notify_commit_added and svn_wc_notify_commit_replaced,    respectively. */
end_comment

begin_struct
struct|struct
name|downgrade_commit_copied_notify_baton
block|{
name|svn_wc_notify_func2_t
name|orig_notify_func2
decl_stmt|;
name|void
modifier|*
name|orig_notify_baton2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|downgrade_commit_copied_notify_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_wc_notify_t
modifier|*
name|notify
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|downgrade_commit_copied_notify_baton
modifier|*
name|b
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|notify
operator|->
name|action
operator|==
name|svn_wc_notify_commit_copied
condition|)
block|{
name|svn_wc_notify_t
modifier|*
name|my_notify
init|=
name|svn_wc_dup_notify
argument_list|(
name|notify
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|my_notify
operator|->
name|action
operator|=
name|svn_wc_notify_commit_added
expr_stmt|;
name|notify
operator|=
name|my_notify
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|notify
operator|->
name|action
operator|==
name|svn_wc_notify_commit_copied_replaced
condition|)
block|{
name|svn_wc_notify_t
modifier|*
name|my_notify
init|=
name|svn_wc_dup_notify
argument_list|(
name|notify
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|my_notify
operator|->
name|action
operator|=
name|svn_wc_notify_commit_replaced
expr_stmt|;
name|notify
operator|=
name|my_notify
expr_stmt|;
block|}
comment|/* Call the wrapped notification system (if any) with MY_NOTIFY,      which is either the original NOTIFY object, or a tweaked deep      copy thereof. */
if|if
condition|(
name|b
operator|->
name|orig_notify_func2
condition|)
name|b
operator|->
name|orig_notify_func2
argument_list|(
name|b
operator|->
name|orig_notify_baton2
argument_list|,
name|notify
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_commit5
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|keep_locks
parameter_list|,
name|svn_boolean_t
name|keep_changelists
parameter_list|,
name|svn_boolean_t
name|commit_as_operations
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_commit_callback2_t
name|commit_callback
parameter_list|,
name|void
modifier|*
name|commit_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_commit6
argument_list|(
name|targets
argument_list|,
name|depth
argument_list|,
name|keep_locks
argument_list|,
name|keep_changelists
argument_list|,
name|commit_as_operations
argument_list|,
name|FALSE
argument_list|,
comment|/* include_file_externals */
name|FALSE
argument_list|,
comment|/* include_dir_externals */
name|changelists
argument_list|,
name|revprop_table
argument_list|,
name|commit_callback
argument_list|,
name|commit_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_commit4
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|keep_locks
parameter_list|,
name|svn_boolean_t
name|keep_changelists
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|struct
name|downgrade_commit_copied_notify_baton
name|notify_baton
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|notify_baton
operator|.
name|orig_notify_func2
operator|=
name|ctx
operator|->
name|notify_func2
expr_stmt|;
name|notify_baton
operator|.
name|orig_notify_baton2
operator|=
name|ctx
operator|->
name|notify_baton2
expr_stmt|;
operator|*
name|commit_info_p
operator|=
name|NULL
expr_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
comment|/* Swap out the notification system (if any) with a thin filtering      wrapper. */
if|if
condition|(
name|ctx
operator|->
name|notify_func2
condition|)
block|{
name|ctx
operator|->
name|notify_func2
operator|=
name|downgrade_commit_copied_notify_func
expr_stmt|;
name|ctx
operator|->
name|notify_baton2
operator|=
operator|&
name|notify_baton
expr_stmt|;
block|}
name|err
operator|=
name|svn_client_commit5
argument_list|(
name|targets
argument_list|,
name|depth
argument_list|,
name|keep_locks
argument_list|,
name|keep_changelists
argument_list|,
name|FALSE
argument_list|,
name|changelists
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* Ensure that the original notification system is in place. */
name|ctx
operator|->
name|notify_func2
operator|=
name|notify_baton
operator|.
name|orig_notify_func2
expr_stmt|;
name|ctx
operator|->
name|notify_baton2
operator|=
name|notify_baton
operator|.
name|orig_notify_baton2
expr_stmt|;
name|SVN_ERR
argument_list|(
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|commit_info_p
condition|)
operator|*
name|commit_info_p
operator|=
name|svn_create_commit_info
argument_list|(
name|pool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_commit3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|keep_locks
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_depth_t
name|depth
init|=
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recurse
argument_list|)
decl_stmt|;
return|return
name|svn_client_commit4
argument_list|(
name|commit_info_p
argument_list|,
name|targets
argument_list|,
name|depth
argument_list|,
name|keep_locks
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_commit2
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|keep_locks
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_info_t
modifier|*
name|commit_info
init|=
name|NULL
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_commit3
argument_list|(
operator|&
name|commit_info
argument_list|,
name|targets
argument_list|,
name|recurse
argument_list|,
name|keep_locks
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* These structs have the same layout for the common fields. */
operator|*
name|commit_info_p
operator|=
operator|(
name|svn_client_commit_info_t
operator|*
operator|)
name|commit_info
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_commit
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|svn_boolean_t
name|nonrecursive
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_commit2
argument_list|(
name|commit_info_p
argument_list|,
name|targets
argument_list|,
operator|!
name|nonrecursive
argument_list|,
name|TRUE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From copy.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_copy5
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|sources
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|copy_as_child
parameter_list|,
name|svn_boolean_t
name|make_parents
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_copy6
argument_list|(
name|sources
argument_list|,
name|dst_path
argument_list|,
name|copy_as_child
argument_list|,
name|make_parents
argument_list|,
name|ignore_externals
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_copy4
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|sources
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|copy_as_child
parameter_list|,
name|svn_boolean_t
name|make_parents
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_copy5
argument_list|(
name|commit_info_p
argument_list|,
name|sources
argument_list|,
name|dst_path
argument_list|,
name|copy_as_child
argument_list|,
name|make_parents
argument_list|,
name|FALSE
argument_list|,
name|revprop_table
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_copy3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|src_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|sources
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
specifier|const
name|svn_client_copy_source_t
operator|*
argument_list|)
argument_list|)
decl_stmt|;
name|svn_client_copy_source_t
name|copy_source
decl_stmt|;
name|copy_source
operator|.
name|path
operator|=
name|src_path
expr_stmt|;
name|copy_source
operator|.
name|revision
operator|=
name|src_revision
expr_stmt|;
name|copy_source
operator|.
name|peg_revision
operator|=
name|src_revision
expr_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|sources
argument_list|,
specifier|const
name|svn_client_copy_source_t
operator|*
argument_list|)
operator|=
operator|&
name|copy_source
expr_stmt|;
return|return
name|svn_client_copy4
argument_list|(
name|commit_info_p
argument_list|,
name|sources
argument_list|,
name|dst_path
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_copy2
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|src_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_copy3
argument_list|(
name|commit_info_p
argument_list|,
name|src_path
argument_list|,
name|src_revision
argument_list|,
name|dst_path
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* If the target exists, try to copy the source as a child of the target.      This will obviously fail if target is not a directory, but that's exactly      what we want. */
if|if
condition|(
name|err
operator|&&
operator|(
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_ENTRY_EXISTS
operator|||
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_FS_ALREADY_EXISTS
operator|)
condition|)
block|{
specifier|const
name|char
modifier|*
name|src_basename
init|=
name|svn_path_basename
argument_list|(
name|src_path
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
name|svn_client_copy3
argument_list|(
name|commit_info_p
argument_list|,
name|src_path
argument_list|,
name|src_revision
argument_list|,
name|svn_path_join
argument_list|(
name|dst_path
argument_list|,
name|src_basename
argument_list|,
name|pool
argument_list|)
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_copy
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|src_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_info_t
modifier|*
name|commit_info
init|=
name|NULL
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_copy2
argument_list|(
operator|&
name|commit_info
argument_list|,
name|src_path
argument_list|,
name|src_revision
argument_list|,
name|dst_path
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* These structs have the same layout for the common fields. */
operator|*
name|commit_info_p
operator|=
operator|(
name|svn_client_commit_info_t
operator|*
operator|)
name|commit_info
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_move6
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|src_paths
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|move_as_child
parameter_list|,
name|svn_boolean_t
name|make_parents
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_commit_callback2_t
name|commit_callback
parameter_list|,
name|void
modifier|*
name|commit_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_client_move7
argument_list|(
name|src_paths
argument_list|,
name|dst_path
argument_list|,
name|move_as_child
argument_list|,
name|make_parents
argument_list|,
name|TRUE
comment|/* allow_mixed_revisions */
argument_list|,
name|FALSE
comment|/* metadata_only */
argument_list|,
name|revprop_table
argument_list|,
name|commit_callback
argument_list|,
name|commit_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_move5
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|src_paths
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|move_as_child
parameter_list|,
name|svn_boolean_t
name|make_parents
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_move6
argument_list|(
name|src_paths
argument_list|,
name|dst_path
argument_list|,
name|move_as_child
argument_list|,
name|make_parents
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_move4
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|src_paths
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
specifier|const
name|char
operator|*
argument_list|)
argument_list|)
decl_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|src_paths
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|src_path
expr_stmt|;
return|return
name|svn_client_move5
argument_list|(
name|commit_info_p
argument_list|,
name|src_paths
argument_list|,
name|dst_path
argument_list|,
name|force
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_move3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_move4
argument_list|(
name|commit_info_p
argument_list|,
name|src_path
argument_list|,
name|dst_path
argument_list|,
name|force
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* If the target exists, try to move the source as a child of the target.      This will obviously fail if target is not a directory, but that's exactly      what we want. */
if|if
condition|(
name|err
operator|&&
operator|(
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_ENTRY_EXISTS
operator|||
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_FS_ALREADY_EXISTS
operator|)
condition|)
block|{
specifier|const
name|char
modifier|*
name|src_basename
init|=
name|svn_path_basename
argument_list|(
name|src_path
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
name|svn_client_move4
argument_list|(
name|commit_info_p
argument_list|,
name|src_path
argument_list|,
name|svn_path_join
argument_list|(
name|dst_path
argument_list|,
name|src_basename
argument_list|,
name|pool
argument_list|)
argument_list|,
name|force
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_move2
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_info_t
modifier|*
name|commit_info
init|=
name|NULL
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_client_move3
argument_list|(
operator|&
name|commit_info
argument_list|,
name|src_path
argument_list|,
name|dst_path
argument_list|,
name|force
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* These structs have the same layout for the common fields. */
operator|*
name|commit_info_p
operator|=
operator|(
name|svn_client_commit_info_t
operator|*
operator|)
name|commit_info
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_move
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|src_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* It doesn't make sense to specify revisions in a move. */
comment|/* ### todo: this check could fail wrongly.  For example,      someone could pass in an svn_opt_revision_number that just      happens to be the HEAD.  It's fair enough to punt then, IMHO,      and just demand that the user not specify a revision at all;      beats mucking up this function with RA calls and such. */
if|if
condition|(
name|src_revision
operator|->
name|kind
operator|!=
name|svn_opt_revision_unspecified
operator|&&
name|src_revision
operator|->
name|kind
operator|!=
name|svn_opt_revision_head
condition|)
block|{
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_UNSUPPORTED_FEATURE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Cannot specify revisions (except HEAD) with move operations"
argument_list|)
argument_list|)
return|;
block|}
return|return
name|svn_client_move2
argument_list|(
name|commit_info_p
argument_list|,
name|src_path
argument_list|,
name|dst_path
argument_list|,
name|force
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From delete.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_delete3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|keep_local
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_delete4
argument_list|(
name|paths
argument_list|,
name|force
argument_list|,
name|keep_local
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_delete2
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_delete3
argument_list|(
name|commit_info_p
argument_list|,
name|paths
argument_list|,
name|force
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_delete
parameter_list|(
name|svn_client_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_info_t
modifier|*
name|commit_info
init|=
name|NULL
decl_stmt|;
name|svn_error_t
modifier|*
name|err
init|=
name|NULL
decl_stmt|;
name|err
operator|=
name|svn_client_delete2
argument_list|(
operator|&
name|commit_info
argument_list|,
name|paths
argument_list|,
name|force
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* These structs have the same layout for the common fields. */
operator|*
name|commit_info_p
operator|=
operator|(
name|svn_client_commit_info_t
operator|*
operator|)
name|commit_info
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From diff.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff5
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|diff_options
parameter_list|,
specifier|const
name|char
modifier|*
name|path1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|path2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|char
modifier|*
name|relative_to_dir
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|show_copies_as_adds
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
name|svn_boolean_t
name|use_git_diff_format
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_stream_t
modifier|*
name|outstream
init|=
name|svn_stream_from_aprfile2
argument_list|(
name|outfile
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_stream_t
modifier|*
name|errstream
init|=
name|svn_stream_from_aprfile2
argument_list|(
name|errfile
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_client_diff6
argument_list|(
name|diff_options
argument_list|,
name|path1
argument_list|,
name|revision1
argument_list|,
name|path2
argument_list|,
name|revision2
argument_list|,
name|relative_to_dir
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|FALSE
comment|/* no_diff_added */
argument_list|,
name|no_diff_deleted
argument_list|,
name|show_copies_as_adds
argument_list|,
name|ignore_content_type
argument_list|,
name|FALSE
comment|/* ignore_properties */
argument_list|,
name|FALSE
comment|/* properties_only */
argument_list|,
name|use_git_diff_format
argument_list|,
name|header_encoding
argument_list|,
name|outstream
argument_list|,
name|errstream
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff4
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|path2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|char
modifier|*
name|relative_to_dir
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff5
argument_list|(
name|options
argument_list|,
name|path1
argument_list|,
name|revision1
argument_list|,
name|path2
argument_list|,
name|revision2
argument_list|,
name|relative_to_dir
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|FALSE
argument_list|,
name|ignore_content_type
argument_list|,
name|FALSE
argument_list|,
name|header_encoding
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff3
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|path2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff4
argument_list|(
name|options
argument_list|,
name|path1
argument_list|,
name|revision1
argument_list|,
name|path2
argument_list|,
name|revision2
argument_list|,
name|NULL
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|ignore_content_type
argument_list|,
name|header_encoding
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff2
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|path2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff3
argument_list|(
name|options
argument_list|,
name|path1
argument_list|,
name|revision1
argument_list|,
name|path2
argument_list|,
name|revision2
argument_list|,
name|recurse
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|ignore_content_type
argument_list|,
name|SVN_APR_LOCALE_CHARSET
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|path2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff2
argument_list|(
name|options
argument_list|,
name|path1
argument_list|,
name|revision1
argument_list|,
name|path2
argument_list|,
name|revision2
argument_list|,
name|recurse
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|FALSE
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_peg5
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|diff_options
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|relative_to_dir
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|show_copies_as_adds
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
name|svn_boolean_t
name|use_git_diff_format
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_stream_t
modifier|*
name|outstream
init|=
name|svn_stream_from_aprfile2
argument_list|(
name|outfile
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_stream_t
modifier|*
name|errstream
init|=
name|svn_stream_from_aprfile2
argument_list|(
name|errfile
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_client_diff_peg6
argument_list|(
name|diff_options
argument_list|,
name|path
argument_list|,
name|peg_revision
argument_list|,
name|start_revision
argument_list|,
name|end_revision
argument_list|,
name|relative_to_dir
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|FALSE
comment|/* no_diff_added */
argument_list|,
name|no_diff_deleted
argument_list|,
name|show_copies_as_adds
argument_list|,
name|ignore_content_type
argument_list|,
name|FALSE
comment|/* ignore_properties */
argument_list|,
name|FALSE
comment|/* properties_only */
argument_list|,
name|use_git_diff_format
argument_list|,
name|header_encoding
argument_list|,
name|outstream
argument_list|,
name|errstream
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_peg4
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|relative_to_dir
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff_peg5
argument_list|(
name|options
argument_list|,
name|path
argument_list|,
name|peg_revision
argument_list|,
name|start_revision
argument_list|,
name|end_revision
argument_list|,
name|relative_to_dir
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|FALSE
argument_list|,
name|ignore_content_type
argument_list|,
name|FALSE
argument_list|,
name|header_encoding
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_peg3
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff_peg4
argument_list|(
name|options
argument_list|,
name|path
argument_list|,
name|peg_revision
argument_list|,
name|start_revision
argument_list|,
name|end_revision
argument_list|,
name|NULL
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|ignore_content_type
argument_list|,
name|header_encoding
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_peg2
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|svn_boolean_t
name|ignore_content_type
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff_peg3
argument_list|(
name|options
argument_list|,
name|path
argument_list|,
name|peg_revision
argument_list|,
name|start_revision
argument_list|,
name|end_revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|ignore_content_type
argument_list|,
name|SVN_APR_LOCALE_CHARSET
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_peg
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|no_diff_deleted
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff_peg2
argument_list|(
name|options
argument_list|,
name|path
argument_list|,
name|peg_revision
argument_list|,
name|start_revision
argument_list|,
name|end_revision
argument_list|,
name|recurse
argument_list|,
name|ignore_ancestry
argument_list|,
name|no_diff_deleted
argument_list|,
name|FALSE
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_summarize
parameter_list|(
specifier|const
name|char
modifier|*
name|path1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|path2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_client_diff_summarize_func_t
name|summarize_func
parameter_list|,
name|void
modifier|*
name|summarize_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff_summarize2
argument_list|(
name|path1
argument_list|,
name|revision1
argument_list|,
name|path2
argument_list|,
name|revision2
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|NULL
argument_list|,
name|summarize_func
argument_list|,
name|summarize_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_diff_summarize_peg
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_client_diff_summarize_func_t
name|summarize_func
parameter_list|,
name|void
modifier|*
name|summarize_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_diff_summarize_peg2
argument_list|(
name|path
argument_list|,
name|peg_revision
argument_list|,
name|start_revision
argument_list|,
name|end_revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|NULL
argument_list|,
name|summarize_func
argument_list|,
name|summarize_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From export.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_export4
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|from_path_or_url
parameter_list|,
specifier|const
name|char
modifier|*
name|to_path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|overwrite
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|char
modifier|*
name|native_eol
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_export5
argument_list|(
name|result_rev
argument_list|,
name|from_path_or_url
argument_list|,
name|to_path
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|overwrite
argument_list|,
name|ignore_externals
argument_list|,
name|FALSE
argument_list|,
name|depth
argument_list|,
name|native_eol
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_export3
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|from_path_or_url
parameter_list|,
specifier|const
name|char
modifier|*
name|to_path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|overwrite
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
specifier|const
name|char
modifier|*
name|native_eol
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_export4
argument_list|(
name|result_rev
argument_list|,
name|from_path_or_url
argument_list|,
name|to_path
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|overwrite
argument_list|,
name|ignore_externals
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|native_eol
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_export2
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|from_path_or_url
parameter_list|,
specifier|const
name|char
modifier|*
name|to_path
parameter_list|,
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
specifier|const
name|char
modifier|*
name|native_eol
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_opt_revision_t
name|peg_revision
decl_stmt|;
name|peg_revision
operator|.
name|kind
operator|=
name|svn_opt_revision_unspecified
expr_stmt|;
return|return
name|svn_client_export3
argument_list|(
name|result_rev
argument_list|,
name|from_path_or_url
argument_list|,
name|to_path
argument_list|,
operator|&
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|force
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|native_eol
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_export
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|from_path_or_url
parameter_list|,
specifier|const
name|char
modifier|*
name|to_path
parameter_list|,
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_export2
argument_list|(
name|result_rev
argument_list|,
name|from_path_or_url
argument_list|,
name|to_path
argument_list|,
name|revision
argument_list|,
name|force
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From list.c ***/
end_comment

begin_comment
comment|/* Baton for use with wrap_list_func */
end_comment

begin_struct
struct|struct
name|list_func_wrapper_baton
block|{
name|void
modifier|*
name|list_func1_baton
decl_stmt|;
name|svn_client_list_func_t
name|list_func1
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* This implements svn_client_list_func2_t */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|list_func_wrapper
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_dirent_t
modifier|*
name|dirent
parameter_list|,
specifier|const
name|svn_lock_t
modifier|*
name|lock
parameter_list|,
specifier|const
name|char
modifier|*
name|abs_path
parameter_list|,
specifier|const
name|char
modifier|*
name|external_parent_url
parameter_list|,
specifier|const
name|char
modifier|*
name|external_target
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|list_func_wrapper_baton
modifier|*
name|lfwb
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|lfwb
operator|->
name|list_func1
condition|)
return|return
name|lfwb
operator|->
name|list_func1
argument_list|(
name|lfwb
operator|->
name|list_func1_baton
argument_list|,
name|path
argument_list|,
name|dirent
argument_list|,
name|lock
argument_list|,
name|abs_path
argument_list|,
name|scratch_pool
argument_list|)
return|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* Helper function for svn_client_list2().  It wraps old format baton    and callback function in list_func_wrapper_baton and    returns new baton and callback to use with svn_client_list3(). */
end_comment

begin_function
specifier|static
name|void
name|wrap_list_func
parameter_list|(
name|svn_client_list_func2_t
modifier|*
name|list_func2
parameter_list|,
name|void
modifier|*
modifier|*
name|list_func2_baton
parameter_list|,
name|svn_client_list_func_t
name|list_func
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|)
block|{
name|struct
name|list_func_wrapper_baton
modifier|*
name|lfwb
init|=
name|apr_palloc
argument_list|(
name|result_pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|lfwb
argument_list|)
argument_list|)
decl_stmt|;
comment|/* Set the user provided old format callback in the baton. */
name|lfwb
operator|->
name|list_func1_baton
operator|=
name|baton
expr_stmt|;
name|lfwb
operator|->
name|list_func1
operator|=
name|list_func
expr_stmt|;
operator|*
name|list_func2_baton
operator|=
name|lfwb
expr_stmt|;
operator|*
name|list_func2
operator|=
name|list_func_wrapper
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_list2
parameter_list|(
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|apr_uint32_t
name|dirent_fields
parameter_list|,
name|svn_boolean_t
name|fetch_locks
parameter_list|,
name|svn_client_list_func_t
name|list_func
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_client_list_func2_t
name|list_func2
decl_stmt|;
name|void
modifier|*
name|list_func2_baton
decl_stmt|;
name|wrap_list_func
argument_list|(
operator|&
name|list_func2
argument_list|,
operator|&
name|list_func2_baton
argument_list|,
name|list_func
argument_list|,
name|baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_list3
argument_list|(
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|dirent_fields
argument_list|,
name|fetch_locks
argument_list|,
name|FALSE
comment|/* include externals */
argument_list|,
name|list_func2
argument_list|,
name|list_func2_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_list
parameter_list|(
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|apr_uint32_t
name|dirent_fields
parameter_list|,
name|svn_boolean_t
name|fetch_locks
parameter_list|,
name|svn_client_list_func_t
name|list_func
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_list2
argument_list|(
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_IMMEDIATES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|dirent_fields
argument_list|,
name|fetch_locks
argument_list|,
name|list_func
argument_list|,
name|baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Baton used by compatibility wrapper svn_client_ls3. */
end_comment

begin_struct
struct|struct
name|ls_baton
block|{
name|apr_hash_t
modifier|*
name|dirents
decl_stmt|;
name|apr_hash_t
modifier|*
name|locks
decl_stmt|;
name|apr_pool_t
modifier|*
name|pool
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* This implements svn_client_list_func_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|store_dirent
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_dirent_t
modifier|*
name|dirent
parameter_list|,
specifier|const
name|svn_lock_t
modifier|*
name|lock
parameter_list|,
specifier|const
name|char
modifier|*
name|abs_path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|ls_baton
modifier|*
name|lb
init|=
name|baton
decl_stmt|;
comment|/* The dirent is allocated in a temporary pool, so duplicate it into the      correct pool.  Note, however, that the locks are stored in the correct      pool already. */
name|dirent
operator|=
name|svn_dirent_dup
argument_list|(
name|dirent
argument_list|,
name|lb
operator|->
name|pool
argument_list|)
expr_stmt|;
comment|/* An empty path means we are called for the target of the operation.      For compatibility, we only store the target if it is a file, and we      store it under the basename of the URL.  Note that this makes it      impossible to differentiate between the target being a directory with a      child with the same basename as the target and the target being a file,      but that's how it was implemented. */
if|if
condition|(
name|path
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
block|{
if|if
condition|(
name|dirent
operator|->
name|kind
operator|==
name|svn_node_file
condition|)
block|{
specifier|const
name|char
modifier|*
name|base_name
init|=
name|svn_path_basename
argument_list|(
name|abs_path
argument_list|,
name|lb
operator|->
name|pool
argument_list|)
decl_stmt|;
name|svn_hash_sets
argument_list|(
name|lb
operator|->
name|dirents
argument_list|,
name|base_name
argument_list|,
name|dirent
argument_list|)
expr_stmt|;
if|if
condition|(
name|lock
condition|)
name|svn_hash_sets
argument_list|(
name|lb
operator|->
name|locks
argument_list|,
name|base_name
argument_list|,
name|lock
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|path
operator|=
name|apr_pstrdup
argument_list|(
name|lb
operator|->
name|pool
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|lb
operator|->
name|dirents
argument_list|,
name|path
argument_list|,
name|dirent
argument_list|)
expr_stmt|;
if|if
condition|(
name|lock
condition|)
name|svn_hash_sets
argument_list|(
name|lb
operator|->
name|locks
argument_list|,
name|path
argument_list|,
name|lock
argument_list|)
expr_stmt|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_ls3
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|dirents
parameter_list|,
name|apr_hash_t
modifier|*
modifier|*
name|locks
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|ls_baton
name|lb
decl_stmt|;
operator|*
name|dirents
operator|=
name|lb
operator|.
name|dirents
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|locks
condition|)
operator|*
name|locks
operator|=
name|lb
operator|.
name|locks
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|lb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_list
argument_list|(
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|SVN_DIRENT_ALL
argument_list|,
name|locks
operator|!=
name|NULL
argument_list|,
name|store_dirent
argument_list|,
operator|&
name|lb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_ls2
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|dirents
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_ls3
argument_list|(
name|dirents
argument_list|,
name|NULL
argument_list|,
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_ls
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|dirents
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_ls2
argument_list|(
name|dirents
argument_list|,
name|path_or_url
argument_list|,
name|revision
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From log.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_log4
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
name|int
name|limit
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_boolean_t
name|include_merged_revisions
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|revprops
parameter_list|,
name|svn_log_entry_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|revision_ranges
decl_stmt|;
name|revision_ranges
operator|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|svn_opt_revision_range_t
operator|*
argument_list|)
argument_list|)
expr_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|revision_ranges
argument_list|,
name|svn_opt_revision_range_t
operator|*
argument_list|)
operator|=
name|svn_opt__revision_range_create
argument_list|(
name|start
argument_list|,
name|end
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_log5
argument_list|(
name|targets
argument_list|,
name|peg_revision
argument_list|,
name|revision_ranges
argument_list|,
name|limit
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|include_merged_revisions
argument_list|,
name|revprops
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_log3
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
name|int
name|limit
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_log_message_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_log_entry_receiver_t
name|receiver2
decl_stmt|;
name|void
modifier|*
name|receiver2_baton
decl_stmt|;
name|svn_compat_wrap_log_receiver
argument_list|(
operator|&
name|receiver2
argument_list|,
operator|&
name|receiver2_baton
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_log4
argument_list|(
name|targets
argument_list|,
name|peg_revision
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|limit
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|FALSE
argument_list|,
name|svn_compat_log_revprops_in
argument_list|(
name|pool
argument_list|)
argument_list|,
name|receiver2
argument_list|,
name|receiver2_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_log2
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
name|int
name|limit
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_log_message_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_opt_revision_t
name|peg_revision
decl_stmt|;
name|peg_revision
operator|.
name|kind
operator|=
name|svn_opt_revision_unspecified
expr_stmt|;
return|return
name|svn_client_log3
argument_list|(
name|targets
argument_list|,
operator|&
name|peg_revision
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|limit
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_log
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|start
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|end
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_log_message_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_error_t
modifier|*
name|err
init|=
name|SVN_NO_ERROR
decl_stmt|;
name|err
operator|=
name|svn_client_log2
argument_list|(
name|targets
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
literal|0
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* Special case: If there have been no commits, we'll get an error    * for requesting log of a revision higher than 0.  But the    * default behavior of "svn log" is to give revisions HEAD through    * 1, on the assumption that HEAD>= 1.    *    * So if we got that error for that reason, and it looks like the    * user was just depending on the defaults (rather than explicitly    * requesting the log for revision 1), then we don't error.  Instead    * we just invoke the receiver manually on a hand-constructed log    * message for revision 0.    *    * See also http://subversion.tigris.org/issues/show_bug.cgi?id=692.    */
if|if
condition|(
name|err
operator|&&
operator|(
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_FS_NO_SUCH_REVISION
operator|)
operator|&&
operator|(
name|start
operator|->
name|kind
operator|==
name|svn_opt_revision_head
operator|)
operator|&&
operator|(
operator|(
name|end
operator|->
name|kind
operator|==
name|svn_opt_revision_number
operator|)
operator|&&
operator|(
name|end
operator|->
name|value
operator|.
name|number
operator|==
literal|1
operator|)
operator|)
condition|)
block|{
comment|/* We don't need to check if HEAD is 0, because that must be the case,        * by logical deduction: The revision range specified is HEAD:1.        * HEAD cannot not exist, so the revision to which "no such revision"        * applies is 1. If revision 1 does not exist, then HEAD is 0.        * Hence, we deduce the repository is empty without needing access        * to further information. */
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|err
operator|=
name|SVN_NO_ERROR
expr_stmt|;
comment|/* Log receivers are free to handle revision 0 specially... But          just in case some don't, we make up a message here. */
name|SVN_ERR
argument_list|(
name|receiver
argument_list|(
name|receiver_baton
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
name|_
argument_list|(
literal|"No commits in repository"
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From merge.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge4
parameter_list|(
specifier|const
name|char
modifier|*
name|source1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|source2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force_delete
parameter_list|,
name|svn_boolean_t
name|record_only
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|svn_boolean_t
name|allow_mixed_rev
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|SVN_ERR
argument_list|(
name|svn_client_merge5
argument_list|(
name|source1
argument_list|,
name|revision1
argument_list|,
name|source2
argument_list|,
name|revision2
argument_list|,
name|target_wcpath
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
comment|/*ignore_mergeinfo*/
argument_list|,
name|ignore_ancestry
comment|/*diff_ignore_ancestry*/
argument_list|,
name|force_delete
argument_list|,
name|record_only
argument_list|,
name|dry_run
argument_list|,
name|allow_mixed_rev
argument_list|,
name|merge_options
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge3
parameter_list|(
specifier|const
name|char
modifier|*
name|source1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|source2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|record_only
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_merge4
argument_list|(
name|source1
argument_list|,
name|revision1
argument_list|,
name|source2
argument_list|,
name|revision2
argument_list|,
name|target_wcpath
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|force
argument_list|,
name|record_only
argument_list|,
name|dry_run
argument_list|,
name|TRUE
argument_list|,
name|merge_options
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge2
parameter_list|(
specifier|const
name|char
modifier|*
name|source1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|source2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_merge3
argument_list|(
name|source1
argument_list|,
name|revision1
argument_list|,
name|source2
argument_list|,
name|revision2
argument_list|,
name|target_wcpath
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|force
argument_list|,
name|FALSE
argument_list|,
name|dry_run
argument_list|,
name|merge_options
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge
parameter_list|(
specifier|const
name|char
modifier|*
name|source1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|char
modifier|*
name|source2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_merge2
argument_list|(
name|source1
argument_list|,
name|revision1
argument_list|,
name|source2
argument_list|,
name|revision2
argument_list|,
name|target_wcpath
argument_list|,
name|recurse
argument_list|,
name|ignore_ancestry
argument_list|,
name|force
argument_list|,
name|dry_run
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge_peg4
parameter_list|(
specifier|const
name|char
modifier|*
name|source_path_or_url
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|ranges_to_merge
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|source_peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force_delete
parameter_list|,
name|svn_boolean_t
name|record_only
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|svn_boolean_t
name|allow_mixed_rev
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|SVN_ERR
argument_list|(
name|svn_client_merge_peg5
argument_list|(
name|source_path_or_url
argument_list|,
name|ranges_to_merge
argument_list|,
name|source_peg_revision
argument_list|,
name|target_wcpath
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
comment|/*ignore_mergeinfo*/
argument_list|,
name|ignore_ancestry
comment|/*diff_ignore_ancestry*/
argument_list|,
name|force_delete
argument_list|,
name|record_only
argument_list|,
name|dry_run
argument_list|,
name|allow_mixed_rev
argument_list|,
name|merge_options
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge_peg3
parameter_list|(
specifier|const
name|char
modifier|*
name|source
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|ranges_to_merge
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|record_only
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_merge_peg4
argument_list|(
name|source
argument_list|,
name|ranges_to_merge
argument_list|,
name|peg_revision
argument_list|,
name|target_wcpath
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|force
argument_list|,
name|record_only
argument_list|,
name|dry_run
argument_list|,
name|TRUE
argument_list|,
name|merge_options
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge_peg2
parameter_list|(
specifier|const
name|char
modifier|*
name|source
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|ranges_to_merge
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|svn_opt_revision_range_t
operator|*
argument_list|)
argument_list|)
decl_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|ranges_to_merge
argument_list|,
name|svn_opt_revision_range_t
operator|*
argument_list|)
operator|=
name|svn_opt__revision_range_create
argument_list|(
name|revision1
argument_list|,
name|revision2
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_client_merge_peg3
argument_list|(
name|source
argument_list|,
name|ranges_to_merge
argument_list|,
name|peg_revision
argument_list|,
name|target_wcpath
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|force
argument_list|,
name|FALSE
argument_list|,
name|dry_run
argument_list|,
name|merge_options
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_merge_peg
parameter_list|(
specifier|const
name|char
modifier|*
name|source
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision1
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision2
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|target_wcpath
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_merge_peg2
argument_list|(
name|source
argument_list|,
name|revision1
argument_list|,
name|revision2
argument_list|,
name|peg_revision
argument_list|,
name|target_wcpath
argument_list|,
name|recurse
argument_list|,
name|ignore_ancestry
argument_list|,
name|force
argument_list|,
name|dry_run
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From prop_commands.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_propset3
parameter_list|(
name|svn_commit_info_t
modifier|*
modifier|*
name|commit_info_p
parameter_list|,
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|propval
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|skip_checks
parameter_list|,
name|svn_revnum_t
name|base_revision_for_url
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
specifier|const
name|apr_hash_t
modifier|*
name|revprop_table
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|svn_path_is_url
argument_list|(
name|target
argument_list|)
condition|)
block|{
name|struct
name|capture_baton_t
name|cb
decl_stmt|;
name|cb
operator|.
name|info
operator|=
name|commit_info_p
expr_stmt|;
name|cb
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_client_propset_remote
argument_list|(
name|propname
argument_list|,
name|propval
argument_list|,
name|target
argument_list|,
name|skip_checks
argument_list|,
name|base_revision_for_url
argument_list|,
name|revprop_table
argument_list|,
name|capture_commit_info
argument_list|,
operator|&
name|cb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|apr_array_header_t
modifier|*
name|targets
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
specifier|const
name|char
operator|*
argument_list|)
argument_list|)
decl_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|targets
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|target
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_client_propset_local
argument_list|(
name|propname
argument_list|,
name|propval
argument_list|,
name|targets
argument_list|,
name|depth
argument_list|,
name|skip_checks
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_propset2
parameter_list|(
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|propval
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|skip_checks
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_propset3
argument_list|(
name|NULL
argument_list|,
name|propname
argument_list|,
name|propval
argument_list|,
name|target
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|skip_checks
argument_list|,
name|SVN_INVALID_REVNUM
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_propset
parameter_list|(
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|propval
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_client_ctx_t
modifier|*
name|ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_client_create_context
argument_list|(
operator|&
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_client_propset2
argument_list|(
name|propname
argument_list|,
name|propval
argument_list|,
name|target
argument_list|,
name|recurse
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_revprop_set
parameter_list|(
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|propval
parameter_list|,
specifier|const
name|char
modifier|*
name|URL
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_revnum_t
modifier|*
name|set_rev
parameter_list|,
name|svn_boolean_t
name|force
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_revprop_set2
argument_list|(
name|propname
argument_list|,
name|propval
argument_list|,
name|NULL
argument_list|,
name|URL
argument_list|,
name|revision
argument_list|,
name|set_rev
argument_list|,
name|force
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_propget4
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_revnum_t
modifier|*
name|actual_revnum
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_client_propget5
argument_list|(
name|props
argument_list|,
name|NULL
argument_list|,
name|propname
argument_list|,
name|target
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|actual_revnum
argument_list|,
name|depth
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_propget3
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_revnum_t
modifier|*
name|actual_revnum
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|target
decl_stmt|;
name|apr_hash_t
modifier|*
name|temp_props
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
if|if
condition|(
name|svn_path_is_url
argument_list|(
name|path_or_url
argument_list|)
condition|)
name|target
operator|=
name|path_or_url
expr_stmt|;
else|else
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|target
argument_list|,
name|path_or_url
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_client_propget4
argument_list|(
operator|&
name|temp_props
argument_list|,
name|propname
argument_list|,
name|target
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|actual_revnum
argument_list|,
name|depth
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_UNVERSIONED_RESOURCE
condition|)
block|{
name|err
operator|->
name|apr_err
operator|=
name|SVN_ERR_ENTRY_NOT_FOUND
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
else|else
name|SVN_ERR
argument_list|(
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|actual_revnum
operator|&&
operator|!
name|svn_path_is_url
argument_list|(
name|path_or_url
argument_list|)
operator|&&
operator|!
name|SVN_IS_VALID_REVNUM
argument_list|(
operator|*
name|actual_revnum
argument_list|)
condition|)
block|{
comment|/* Get the actual_revnum; added nodes have no revision yet, and old        * callers expected the mock-up revision of 0. */
name|svn_boolean_t
name|added
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__node_is_added
argument_list|(
operator|&
name|added
argument_list|,
name|ctx
operator|->
name|wc_ctx
argument_list|,
name|target
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|added
condition|)
operator|*
name|actual_revnum
operator|=
literal|0
expr_stmt|;
block|}
comment|/* We may need to fix up our hash keys for legacy callers. */
if|if
condition|(
operator|!
name|svn_path_is_url
argument_list|(
name|path_or_url
argument_list|)
operator|&&
name|strcmp
argument_list|(
name|target
argument_list|,
name|path_or_url
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|apr_hash_index_t
modifier|*
name|hi
decl_stmt|;
operator|*
name|props
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
for|for
control|(
name|hi
operator|=
name|apr_hash_first
argument_list|(
name|pool
argument_list|,
name|temp_props
argument_list|)
init|;
name|hi
condition|;
name|hi
operator|=
name|apr_hash_next
argument_list|(
name|hi
argument_list|)
control|)
block|{
specifier|const
name|char
modifier|*
name|abspath
init|=
name|svn__apr_hash_index_key
argument_list|(
name|hi
argument_list|)
decl_stmt|;
name|svn_string_t
modifier|*
name|value
init|=
name|svn__apr_hash_index_val
argument_list|(
name|hi
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|relpath
init|=
name|svn_dirent_join
argument_list|(
name|path_or_url
argument_list|,
name|svn_dirent_skip_ancestor
argument_list|(
name|target
argument_list|,
name|abspath
argument_list|)
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_hash_sets
argument_list|(
operator|*
name|props
argument_list|,
name|relpath
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
block|}
else|else
operator|*
name|props
operator|=
name|temp_props
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_propget2
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_propget3
argument_list|(
name|props
argument_list|,
name|propname
argument_list|,
name|target
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|NULL
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_propget
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|propname
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_propget2
argument_list|(
name|props
argument_list|,
name|propname
argument_list|,
name|target
argument_list|,
name|revision
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Duplicate a HASH containing (char * -> svn_string_t *) key/value    pairs using POOL. */
end_comment

begin_function
specifier|static
name|apr_hash_t
modifier|*
name|string_hash_dup
parameter_list|(
name|apr_hash_t
modifier|*
name|hash
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_index_t
modifier|*
name|hi
decl_stmt|;
name|apr_hash_t
modifier|*
name|new_hash
init|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
decl_stmt|;
for|for
control|(
name|hi
operator|=
name|apr_hash_first
argument_list|(
name|pool
argument_list|,
name|hash
argument_list|)
init|;
name|hi
condition|;
name|hi
operator|=
name|apr_hash_next
argument_list|(
name|hi
argument_list|)
control|)
block|{
specifier|const
name|char
modifier|*
name|key
init|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|svn__apr_hash_index_key
argument_list|(
name|hi
argument_list|)
argument_list|)
decl_stmt|;
name|apr_ssize_t
name|klen
init|=
name|svn__apr_hash_index_klen
argument_list|(
name|hi
argument_list|)
decl_stmt|;
name|svn_string_t
modifier|*
name|val
init|=
name|svn_string_dup
argument_list|(
name|svn__apr_hash_index_val
argument_list|(
name|hi
argument_list|)
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|apr_hash_set
argument_list|(
name|new_hash
argument_list|,
name|key
argument_list|,
name|klen
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
return|return
name|new_hash
return|;
block|}
end_function

begin_function
name|svn_client_proplist_item_t
modifier|*
name|svn_client_proplist_item_dup
parameter_list|(
specifier|const
name|svn_client_proplist_item_t
modifier|*
name|item
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_client_proplist_item_t
modifier|*
name|new_item
init|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_item
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|item
operator|->
name|node_name
condition|)
name|new_item
operator|->
name|node_name
operator|=
name|svn_stringbuf_dup
argument_list|(
name|item
operator|->
name|node_name
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
operator|->
name|prop_hash
condition|)
name|new_item
operator|->
name|prop_hash
operator|=
name|string_hash_dup
argument_list|(
name|item
operator|->
name|prop_hash
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|new_item
return|;
block|}
end_function

begin_comment
comment|/* Baton for use with wrap_proplist_receiver */
end_comment

begin_struct
struct|struct
name|proplist_receiver_wrapper_baton
block|{
name|void
modifier|*
name|baton
decl_stmt|;
name|svn_proplist_receiver_t
name|receiver
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* This implements svn_client_proplist_receiver2_t */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|proplist_wrapper_receiver
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_hash_t
modifier|*
name|prop_hash
parameter_list|,
name|apr_array_header_t
modifier|*
name|inherited_props
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|proplist_receiver_wrapper_baton
modifier|*
name|plrwb
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|plrwb
operator|->
name|receiver
condition|)
return|return
name|plrwb
operator|->
name|receiver
argument_list|(
name|plrwb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|prop_hash
argument_list|,
name|pool
argument_list|)
return|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wrap_proplist_receiver
parameter_list|(
name|svn_proplist_receiver2_t
modifier|*
name|receiver2
parameter_list|,
name|void
modifier|*
modifier|*
name|receiver2_baton
parameter_list|,
name|svn_proplist_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|proplist_receiver_wrapper_baton
modifier|*
name|plrwb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|plrwb
argument_list|)
argument_list|)
decl_stmt|;
comment|/* Set the user provided old format callback in the baton. */
name|plrwb
operator|->
name|baton
operator|=
name|receiver_baton
expr_stmt|;
name|plrwb
operator|->
name|receiver
operator|=
name|receiver
expr_stmt|;
operator|*
name|receiver2_baton
operator|=
name|plrwb
expr_stmt|;
operator|*
name|receiver2
operator|=
name|proplist_wrapper_receiver
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_proplist3
parameter_list|(
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_proplist_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_proplist_receiver2_t
name|receiver2
decl_stmt|;
name|void
modifier|*
name|receiver2_baton
decl_stmt|;
name|wrap_proplist_receiver
argument_list|(
operator|&
name|receiver2
argument_list|,
operator|&
name|receiver2_baton
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_client_proplist4
argument_list|(
name|target
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|changelists
argument_list|,
name|FALSE
argument_list|,
name|receiver2
argument_list|,
name|receiver2_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Receiver baton used by proplist2() */
end_comment

begin_struct
struct|struct
name|proplist_receiver_baton
block|{
name|apr_array_header_t
modifier|*
name|props
decl_stmt|;
name|apr_pool_t
modifier|*
name|pool
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Receiver function used by proplist2(). */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|proplist_receiver_cb
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_hash_t
modifier|*
name|prop_hash
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|proplist_receiver_baton
modifier|*
name|pl_baton
init|=
operator|(
expr|struct
name|proplist_receiver_baton
operator|*
operator|)
name|baton
decl_stmt|;
name|svn_client_proplist_item_t
modifier|*
name|tmp_item
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|tmp_item
argument_list|)
argument_list|)
decl_stmt|;
name|svn_client_proplist_item_t
modifier|*
name|item
decl_stmt|;
comment|/* Because the pool passed to the receiver function is likely to be a      temporary pool of some kind, we need to make copies of *path and      *prop_hash in the pool provided by the baton. */
name|tmp_item
operator|->
name|node_name
operator|=
name|svn_stringbuf_create
argument_list|(
name|path
argument_list|,
name|pl_baton
operator|->
name|pool
argument_list|)
expr_stmt|;
name|tmp_item
operator|->
name|prop_hash
operator|=
name|prop_hash
expr_stmt|;
name|item
operator|=
name|svn_client_proplist_item_dup
argument_list|(
name|tmp_item
argument_list|,
name|pl_baton
operator|->
name|pool
argument_list|)
expr_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|pl_baton
operator|->
name|props
argument_list|,
specifier|const
name|svn_client_proplist_item_t
operator|*
argument_list|)
operator|=
name|item
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_proplist2
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|proplist_receiver_baton
name|pl_baton
decl_stmt|;
operator|*
name|props
operator|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|5
argument_list|,
sizeof|sizeof
argument_list|(
name|svn_client_proplist_item_t
operator|*
argument_list|)
argument_list|)
expr_stmt|;
name|pl_baton
operator|.
name|props
operator|=
operator|*
name|props
expr_stmt|;
name|pl_baton
operator|.
name|pool
operator|=
name|pool
expr_stmt|;
return|return
name|svn_client_proplist3
argument_list|(
name|target
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|proplist_receiver_cb
argument_list|,
operator|&
name|pl_baton
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_proplist
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_proplist2
argument_list|(
name|props
argument_list|,
name|target
argument_list|,
name|revision
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From status.c ***/
end_comment

begin_struct
struct|struct
name|status4_wrapper_baton
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc_status_func3_t
name|old_func
decl_stmt|;
name|void
modifier|*
name|old_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Implements svn_client_status_func_t */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|status4_wrapper_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_client_status_t
modifier|*
name|status
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|status4_wrapper_baton
modifier|*
name|swb
init|=
name|baton
decl_stmt|;
name|svn_wc_status2_t
modifier|*
name|dup
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|svn_wc_status3_t
modifier|*
name|wc_status
init|=
name|status
operator|->
name|backwards_compatibility_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__status2_from_3
argument_list|(
operator|&
name|dup
argument_list|,
name|wc_status
argument_list|,
name|swb
operator|->
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|scratch_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
call|(
modifier|*
name|swb
operator|->
name|old_func
call|)
argument_list|(
name|swb
operator|->
name|old_baton
argument_list|,
name|path
argument_list|,
name|dup
argument_list|,
name|scratch_pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_status4
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_wc_status_func3_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|update
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|status4_wrapper_baton
name|swb
decl_stmt|;
name|swb
operator|.
name|wc_ctx
operator|=
name|ctx
operator|->
name|wc_ctx
expr_stmt|;
name|swb
operator|.
name|old_func
operator|=
name|status_func
expr_stmt|;
name|swb
operator|.
name|old_baton
operator|=
name|status_baton
expr_stmt|;
return|return
name|svn_client_status5
argument_list|(
name|result_rev
argument_list|,
name|ctx
argument_list|,
name|path
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|get_all
argument_list|,
name|update
argument_list|,
name|no_ignore
argument_list|,
name|ignore_externals
argument_list|,
name|TRUE
argument_list|,
name|changelists
argument_list|,
name|status4_wrapper_func
argument_list|,
operator|&
name|swb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|status3_wrapper_baton
block|{
name|svn_wc_status_func2_t
name|old_func
decl_stmt|;
name|void
modifier|*
name|old_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|status3_wrapper_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_status2_t
modifier|*
name|status
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|status3_wrapper_baton
modifier|*
name|swb
init|=
name|baton
decl_stmt|;
name|swb
operator|->
name|old_func
argument_list|(
name|swb
operator|->
name|old_baton
argument_list|,
name|path
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_status3
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_wc_status_func2_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|update
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|status3_wrapper_baton
name|swb
init|=
block|{
literal|0
block|}
decl_stmt|;
name|swb
operator|.
name|old_func
operator|=
name|status_func
expr_stmt|;
name|swb
operator|.
name|old_baton
operator|=
name|status_baton
expr_stmt|;
return|return
name|svn_client_status4
argument_list|(
name|result_rev
argument_list|,
name|path
argument_list|,
name|revision
argument_list|,
name|status3_wrapper_func
argument_list|,
operator|&
name|swb
argument_list|,
name|depth
argument_list|,
name|get_all
argument_list|,
name|update
argument_list|,
name|no_ignore
argument_list|,
name|ignore_externals
argument_list|,
name|changelists
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_status2
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_wc_status_func2_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|update
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_status3
argument_list|(
name|result_rev
argument_list|,
name|path
argument_list|,
name|revision
argument_list|,
name|status_func
argument_list|,
name|status_baton
argument_list|,
name|SVN_DEPTH_INFINITY_OR_IMMEDIATES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|get_all
argument_list|,
name|update
argument_list|,
name|no_ignore
argument_list|,
name|ignore_externals
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Baton for old_status_func_cb; does what you think it does. */
end_comment

begin_struct
struct|struct
name|old_status_func_cb_baton
block|{
name|svn_wc_status_func_t
name|original_func
decl_stmt|;
name|void
modifier|*
name|original_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Help svn_client_status() accept an old-style status func and baton,    by wrapping them before passing along to svn_client_status2().     This implements the 'svn_wc_status_func2_t' function type. */
end_comment

begin_function
specifier|static
name|void
name|old_status_func_cb
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_status2_t
modifier|*
name|status
parameter_list|)
block|{
name|struct
name|old_status_func_cb_baton
modifier|*
name|b
init|=
name|baton
decl_stmt|;
name|svn_wc_status_t
modifier|*
name|stat
init|=
operator|(
name|svn_wc_status_t
operator|*
operator|)
name|status
decl_stmt|;
name|b
operator|->
name|original_func
argument_list|(
name|b
operator|->
name|original_baton
argument_list|,
name|path
argument_list|,
name|stat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_status
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_wc_status_func_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|update
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|old_status_func_cb_baton
modifier|*
name|b
init|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|b
operator|->
name|original_func
operator|=
name|status_func
expr_stmt|;
name|b
operator|->
name|original_baton
operator|=
name|status_baton
expr_stmt|;
return|return
name|svn_client_status2
argument_list|(
name|result_rev
argument_list|,
name|path
argument_list|,
name|revision
argument_list|,
name|old_status_func_cb
argument_list|,
name|b
argument_list|,
name|recurse
argument_list|,
name|get_all
argument_list|,
name|update
argument_list|,
name|no_ignore
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From update.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_update3
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|result_revs
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_is_sticky
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_boolean_t
name|allow_unver_obstructions
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_update4
argument_list|(
name|result_revs
argument_list|,
name|paths
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|depth_is_sticky
argument_list|,
name|ignore_externals
argument_list|,
name|allow_unver_obstructions
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_update2
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|result_revs
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_update3
argument_list|(
name|result_revs
argument_list|,
name|paths
argument_list|,
name|revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|ignore_externals
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_update
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|paths
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
specifier|const
name|char
operator|*
argument_list|)
argument_list|)
decl_stmt|;
name|apr_array_header_t
modifier|*
name|result_revs
decl_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|paths
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|path
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_client_update2
argument_list|(
operator|&
name|result_revs
argument_list|,
name|paths
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|result_rev
operator|=
name|APR_ARRAY_IDX
argument_list|(
name|result_revs
argument_list|,
literal|0
argument_list|,
name|svn_revnum_t
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From switch.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_switch2
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_is_sticky
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_boolean_t
name|allow_unver_obstructions
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_switch3
argument_list|(
name|result_rev
argument_list|,
name|path
argument_list|,
name|switch_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|depth_is_sticky
argument_list|,
name|ignore_externals
argument_list|,
name|allow_unver_obstructions
argument_list|,
name|TRUE
comment|/* ignore_ancestry */
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_switch
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_opt_revision_t
name|peg_revision
decl_stmt|;
name|peg_revision
operator|.
name|kind
operator|=
name|svn_opt_revision_unspecified
expr_stmt|;
return|return
name|svn_client_switch2
argument_list|(
name|result_rev
argument_list|,
name|path
argument_list|,
name|switch_url
argument_list|,
operator|&
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From cat.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_cat
parameter_list|(
name|svn_stream_t
modifier|*
name|out
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_cat2
argument_list|(
name|out
argument_list|,
name|path_or_url
argument_list|,
name|revision
argument_list|,
name|revision
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From checkout.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_checkout2
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|URL
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_externals
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_client_checkout3
argument_list|(
name|result_rev
argument_list|,
name|URL
argument_list|,
name|path
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_externals
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_checkout
parameter_list|(
name|svn_revnum_t
modifier|*
name|result_rev
parameter_list|,
specifier|const
name|char
modifier|*
name|URL
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_opt_revision_t
name|peg_revision
decl_stmt|;
name|peg_revision
operator|.
name|kind
operator|=
name|svn_opt_revision_unspecified
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_client_checkout2
argument_list|(
name|result_rev
argument_list|,
name|URL
argument_list|,
name|path
argument_list|,
operator|&
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|recurse
argument_list|,
name|FALSE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From info.c ***/
end_comment

begin_function
name|svn_info_t
modifier|*
name|svn_info_dup
parameter_list|(
specifier|const
name|svn_info_t
modifier|*
name|info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_info_t
modifier|*
name|dupinfo
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|dupinfo
argument_list|)
argument_list|)
decl_stmt|;
comment|/* Perform a trivial copy ... */
operator|*
name|dupinfo
operator|=
operator|*
name|info
expr_stmt|;
comment|/* ...and then re-copy stuff that needs to be duped into our pool. */
if|if
condition|(
name|info
operator|->
name|URL
condition|)
name|dupinfo
operator|->
name|URL
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|URL
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|repos_root_URL
condition|)
name|dupinfo
operator|->
name|repos_root_URL
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|repos_root_URL
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|repos_UUID
condition|)
name|dupinfo
operator|->
name|repos_UUID
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|repos_UUID
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|last_changed_author
condition|)
name|dupinfo
operator|->
name|last_changed_author
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|last_changed_author
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|lock
condition|)
name|dupinfo
operator|->
name|lock
operator|=
name|svn_lock_dup
argument_list|(
name|info
operator|->
name|lock
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|copyfrom_url
condition|)
name|dupinfo
operator|->
name|copyfrom_url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|copyfrom_url
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|checksum
condition|)
name|dupinfo
operator|->
name|checksum
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|checksum
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|conflict_old
condition|)
name|dupinfo
operator|->
name|conflict_old
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|conflict_old
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|conflict_new
condition|)
name|dupinfo
operator|->
name|conflict_new
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|conflict_new
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|conflict_wrk
condition|)
name|dupinfo
operator|->
name|conflict_wrk
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|conflict_wrk
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|prejfile
condition|)
name|dupinfo
operator|->
name|prejfile
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|info
operator|->
name|prejfile
argument_list|)
expr_stmt|;
return|return
name|dupinfo
return|;
block|}
end_function

begin_comment
comment|/* Convert an svn_client_info2_t to an svn_info_t, doing shallow copies. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|info_from_info2
parameter_list|(
name|svn_info_t
modifier|*
modifier|*
name|new_info
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|svn_client_info2_t
modifier|*
name|info2
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_info_t
modifier|*
name|info
init|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|info
argument_list|)
argument_list|)
decl_stmt|;
name|info
operator|->
name|URL
operator|=
name|info2
operator|->
name|URL
expr_stmt|;
comment|/* Goofy backward compat handling for added nodes. */
if|if
condition|(
name|SVN_IS_VALID_REVNUM
argument_list|(
name|info2
operator|->
name|rev
argument_list|)
condition|)
name|info
operator|->
name|rev
operator|=
name|info2
operator|->
name|rev
expr_stmt|;
else|else
name|info
operator|->
name|rev
operator|=
literal|0
expr_stmt|;
name|info
operator|->
name|kind
operator|=
name|info2
operator|->
name|kind
expr_stmt|;
name|info
operator|->
name|repos_root_URL
operator|=
name|info2
operator|->
name|repos_root_URL
expr_stmt|;
name|info
operator|->
name|repos_UUID
operator|=
name|info2
operator|->
name|repos_UUID
expr_stmt|;
name|info
operator|->
name|last_changed_rev
operator|=
name|info2
operator|->
name|last_changed_rev
expr_stmt|;
name|info
operator|->
name|last_changed_date
operator|=
name|info2
operator|->
name|last_changed_date
expr_stmt|;
name|info
operator|->
name|last_changed_author
operator|=
name|info2
operator|->
name|last_changed_author
expr_stmt|;
comment|/* Stupid old structure has a non-const LOCK member. Sigh.  */
name|info
operator|->
name|lock
operator|=
operator|(
name|svn_lock_t
operator|*
operator|)
name|info2
operator|->
name|lock
expr_stmt|;
name|info
operator|->
name|size64
operator|=
name|info2
operator|->
name|size
expr_stmt|;
if|if
condition|(
name|info2
operator|->
name|size
operator|==
name|SVN_INVALID_FILESIZE
condition|)
name|info
operator|->
name|size
operator|=
name|SVN_INFO_SIZE_UNKNOWN
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|(
name|svn_filesize_t
operator|)
operator|(
name|apr_size_t
operator|)
name|info
operator|->
name|size64
operator|)
operator|==
name|info
operator|->
name|size64
condition|)
name|info
operator|->
name|size
operator|=
operator|(
name|apr_size_t
operator|)
name|info
operator|->
name|size64
expr_stmt|;
else|else
comment|/*>= 4GB */
name|info
operator|->
name|size
operator|=
name|SVN_INFO_SIZE_UNKNOWN
expr_stmt|;
if|if
condition|(
name|info2
operator|->
name|wc_info
condition|)
block|{
name|info
operator|->
name|has_wc_info
operator|=
name|TRUE
expr_stmt|;
name|info
operator|->
name|schedule
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|schedule
expr_stmt|;
name|info
operator|->
name|copyfrom_url
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|copyfrom_url
expr_stmt|;
name|info
operator|->
name|copyfrom_rev
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|copyfrom_rev
expr_stmt|;
name|info
operator|->
name|text_time
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|recorded_time
expr_stmt|;
name|info
operator|->
name|prop_time
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|info2
operator|->
name|wc_info
operator|->
name|checksum
operator|&&
name|info2
operator|->
name|wc_info
operator|->
name|checksum
operator|->
name|kind
operator|==
name|svn_checksum_md5
condition|)
name|info
operator|->
name|checksum
operator|=
name|svn_checksum_to_cstring
argument_list|(
name|info2
operator|->
name|wc_info
operator|->
name|checksum
argument_list|,
name|pool
argument_list|)
expr_stmt|;
else|else
name|info
operator|->
name|checksum
operator|=
name|NULL
expr_stmt|;
name|info
operator|->
name|changelist
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|changelist
expr_stmt|;
name|info
operator|->
name|depth
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|depth
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|depth
operator|==
name|svn_depth_unknown
operator|&&
name|info
operator|->
name|kind
operator|==
name|svn_node_file
condition|)
name|info
operator|->
name|depth
operator|=
name|svn_depth_infinity
expr_stmt|;
name|info
operator|->
name|working_size64
operator|=
name|info2
operator|->
name|wc_info
operator|->
name|recorded_size
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|svn_filesize_t
operator|)
operator|(
name|apr_size_t
operator|)
name|info
operator|->
name|working_size64
operator|)
operator|==
name|info
operator|->
name|working_size64
condition|)
name|info
operator|->
name|working_size
operator|=
operator|(
name|apr_size_t
operator|)
name|info
operator|->
name|working_size64
expr_stmt|;
else|else
comment|/*>= 4GB */
name|info
operator|->
name|working_size
operator|=
name|SVN_INFO_SIZE_UNKNOWN
expr_stmt|;
block|}
else|else
block|{
name|info
operator|->
name|has_wc_info
operator|=
name|FALSE
expr_stmt|;
name|info
operator|->
name|working_size
operator|=
name|SVN_INFO_SIZE_UNKNOWN
expr_stmt|;
name|info
operator|->
name|working_size64
operator|=
name|SVN_INVALID_FILESIZE
expr_stmt|;
name|info
operator|->
name|depth
operator|=
name|svn_depth_unknown
expr_stmt|;
block|}
comment|/* Populate conflict fields. */
if|if
condition|(
name|info2
operator|->
name|wc_info
operator|&&
name|info2
operator|->
name|wc_info
operator|->
name|conflicts
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|info2
operator|->
name|wc_info
operator|->
name|conflicts
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|svn_wc_conflict_description2_t
modifier|*
name|conflict
init|=
name|APR_ARRAY_IDX
argument_list|(
name|info2
operator|->
name|wc_info
operator|->
name|conflicts
argument_list|,
name|i
argument_list|,
specifier|const
name|svn_wc_conflict_description2_t
operator|*
argument_list|)
decl_stmt|;
comment|/* ### Not really sure what we should do if we get multiple              ### conflicts of the same type. */
switch|switch
condition|(
name|conflict
operator|->
name|kind
condition|)
block|{
case|case
name|svn_wc_conflict_kind_tree
case|:
name|info
operator|->
name|tree_conflict
operator|=
name|svn_wc__cd2_to_cd
argument_list|(
name|conflict
argument_list|,
name|pool
argument_list|)
expr_stmt|;
break|break;
case|case
name|svn_wc_conflict_kind_text
case|:
name|info
operator|->
name|conflict_old
operator|=
name|conflict
operator|->
name|base_abspath
expr_stmt|;
name|info
operator|->
name|conflict_new
operator|=
name|conflict
operator|->
name|my_abspath
expr_stmt|;
name|info
operator|->
name|conflict_wrk
operator|=
name|conflict
operator|->
name|their_abspath
expr_stmt|;
break|break;
case|case
name|svn_wc_conflict_kind_property
case|:
name|info
operator|->
name|prejfile
operator|=
name|conflict
operator|->
name|their_abspath
expr_stmt|;
break|break;
block|}
block|}
block|}
if|if
condition|(
name|info2
operator|->
name|wc_info
operator|&&
name|info2
operator|->
name|wc_info
operator|->
name|checksum
condition|)
block|{
specifier|const
name|svn_checksum_t
modifier|*
name|md5_checksum
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__node_get_md5_from_sha1
argument_list|(
operator|&
name|md5_checksum
argument_list|,
name|wc_ctx
argument_list|,
name|info2
operator|->
name|wc_info
operator|->
name|wcroot_abspath
argument_list|,
name|info2
operator|->
name|wc_info
operator|->
name|checksum
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|info
operator|->
name|checksum
operator|=
name|svn_checksum_to_cstring
argument_list|(
name|md5_checksum
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
operator|*
name|new_info
operator|=
name|info
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_struct
struct|struct
name|info_to_relpath_baton
block|{
specifier|const
name|char
modifier|*
name|anchor_abspath
decl_stmt|;
specifier|const
name|char
modifier|*
name|anchor_relpath
decl_stmt|;
name|svn_info_receiver_t
name|info_receiver
decl_stmt|;
name|void
modifier|*
name|info_baton
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|info_receiver_relpath_wrapper
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|abspath_or_url
parameter_list|,
specifier|const
name|svn_client_info2_t
modifier|*
name|info2
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|info_to_relpath_baton
modifier|*
name|rb
init|=
name|baton
decl_stmt|;
specifier|const
name|char
modifier|*
name|path
init|=
name|abspath_or_url
decl_stmt|;
name|svn_info_t
modifier|*
name|info
decl_stmt|;
if|if
condition|(
name|rb
operator|->
name|anchor_relpath
operator|&&
name|svn_dirent_is_ancestor
argument_list|(
name|rb
operator|->
name|anchor_abspath
argument_list|,
name|abspath_or_url
argument_list|)
condition|)
block|{
name|path
operator|=
name|svn_dirent_join
argument_list|(
name|rb
operator|->
name|anchor_relpath
argument_list|,
name|svn_dirent_skip_ancestor
argument_list|(
name|rb
operator|->
name|anchor_abspath
argument_list|,
name|abspath_or_url
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
block|}
name|SVN_ERR
argument_list|(
name|info_from_info2
argument_list|(
operator|&
name|info
argument_list|,
name|rb
operator|->
name|wc_ctx
argument_list|,
name|info2
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|rb
operator|->
name|info_receiver
argument_list|(
name|rb
operator|->
name|info_baton
argument_list|,
name|path
argument_list|,
name|info
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_info2
parameter_list|(
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_info_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelists
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|info_to_relpath_baton
name|rb
decl_stmt|;
specifier|const
name|char
modifier|*
name|abspath_or_url
init|=
name|path_or_url
decl_stmt|;
name|rb
operator|.
name|anchor_relpath
operator|=
name|NULL
expr_stmt|;
name|rb
operator|.
name|info_receiver
operator|=
name|receiver
expr_stmt|;
name|rb
operator|.
name|info_baton
operator|=
name|receiver_baton
expr_stmt|;
name|rb
operator|.
name|wc_ctx
operator|=
name|ctx
operator|->
name|wc_ctx
expr_stmt|;
if|if
condition|(
operator|!
name|svn_path_is_url
argument_list|(
name|path_or_url
argument_list|)
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|abspath_or_url
argument_list|,
name|path_or_url
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|rb
operator|.
name|anchor_abspath
operator|=
name|abspath_or_url
expr_stmt|;
name|rb
operator|.
name|anchor_relpath
operator|=
name|path_or_url
expr_stmt|;
block|}
name|SVN_ERR
argument_list|(
name|svn_client_info3
argument_list|(
name|abspath_or_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|changelists
argument_list|,
name|info_receiver_relpath_wrapper
argument_list|,
operator|&
name|rb
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_info
parameter_list|(
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|revision
parameter_list|,
name|svn_info_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_info2
argument_list|(
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|revision
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From resolved.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_resolved
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_depth_t
name|depth
init|=
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recursive
argument_list|)
decl_stmt|;
return|return
name|svn_client_resolve
argument_list|(
name|path
argument_list|,
name|depth
argument_list|,
name|svn_wc_conflict_choose_merged
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From revert.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_revert
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_revert2
argument_list|(
name|paths
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recursive
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From ra.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_open_ra_session
parameter_list|(
name|svn_ra_session_t
modifier|*
modifier|*
name|session
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_client_open_ra_session2
argument_list|(
name|session
argument_list|,
name|url
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_uuid_from_url
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|apr_pool_t
modifier|*
name|subpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|err
operator|=
name|svn_client_get_repos_root
argument_list|(
name|NULL
argument_list|,
name|uuid
argument_list|,
name|url
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|,
name|subpool
argument_list|)
expr_stmt|;
comment|/* destroy the RA session */
name|svn_pool_destroy
argument_list|(
name|subpool
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
empty_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_uuid_from_path2
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|local_abspath
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_client_get_repos_root
argument_list|(
name|NULL
argument_list|,
name|uuid
argument_list|,
name|local_abspath
argument_list|,
name|ctx
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_uuid_from_path
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_client_uuid_from_path2
argument_list|(
name|uuid
argument_list|,
name|local_abspath
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From url.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_root_url_from_path
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_pool_t
modifier|*
name|subpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
if|if
condition|(
operator|!
name|svn_path_is_url
argument_list|(
name|path_or_url
argument_list|)
condition|)
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|path_or_url
argument_list|,
name|path_or_url
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_client_get_repos_root
argument_list|(
name|url
argument_list|,
name|NULL
argument_list|,
name|path_or_url
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|,
name|subpool
argument_list|)
expr_stmt|;
comment|/* close ra session */
name|svn_pool_destroy
argument_list|(
name|subpool
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_url_from_path
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_client_ctx_t
modifier|*
name|ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_client_create_context
argument_list|(
operator|&
name|ctx
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_client_url_from_path2
argument_list|(
name|url
argument_list|,
name|path_or_url
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From mergeinfo.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_mergeinfo_log
parameter_list|(
name|svn_boolean_t
name|finding_merged
parameter_list|,
specifier|const
name|char
modifier|*
name|target_path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|target_peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|source_path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|source_peg_revision
parameter_list|,
name|svn_log_entry_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|revprops
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|svn_opt_revision_t
name|start_revision
decl_stmt|,
name|end_revision
decl_stmt|;
name|start_revision
operator|.
name|kind
operator|=
name|svn_opt_revision_unspecified
expr_stmt|;
name|end_revision
operator|.
name|kind
operator|=
name|svn_opt_revision_unspecified
expr_stmt|;
return|return
name|svn_client_mergeinfo_log2
argument_list|(
name|finding_merged
argument_list|,
name|target_path_or_url
argument_list|,
name|target_peg_revision
argument_list|,
name|source_path_or_url
argument_list|,
name|source_peg_revision
argument_list|,
operator|&
name|start_revision
argument_list|,
operator|&
name|end_revision
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|discover_changed_paths
argument_list|,
name|depth
argument_list|,
name|revprops
argument_list|,
name|ctx
argument_list|,
name|scratch_pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_mergeinfo_log_merged
parameter_list|(
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|merge_source_path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|src_peg_revision
parameter_list|,
name|svn_log_entry_receiver_t
name|log_receiver
parameter_list|,
name|void
modifier|*
name|log_receiver_baton
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|revprops
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_mergeinfo_log
argument_list|(
name|TRUE
argument_list|,
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|merge_source_path_or_url
argument_list|,
name|src_peg_revision
argument_list|,
name|log_receiver
argument_list|,
name|log_receiver_baton
argument_list|,
name|discover_changed_paths
argument_list|,
name|svn_depth_empty
argument_list|,
name|revprops
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_client_mergeinfo_log_eligible
parameter_list|(
specifier|const
name|char
modifier|*
name|path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|peg_revision
parameter_list|,
specifier|const
name|char
modifier|*
name|merge_source_path_or_url
parameter_list|,
specifier|const
name|svn_opt_revision_t
modifier|*
name|src_peg_revision
parameter_list|,
name|svn_log_entry_receiver_t
name|log_receiver
parameter_list|,
name|void
modifier|*
name|log_receiver_baton
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|revprops
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_client_mergeinfo_log
argument_list|(
name|FALSE
argument_list|,
name|path_or_url
argument_list|,
name|peg_revision
argument_list|,
name|merge_source_path_or_url
argument_list|,
name|src_peg_revision
argument_list|,
name|log_receiver
argument_list|,
name|log_receiver_baton
argument_list|,
name|discover_changed_paths
argument_list|,
name|svn_depth_empty
argument_list|,
name|revprops
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From relocate.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_relocate
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|from_prefix
parameter_list|,
specifier|const
name|char
modifier|*
name|to_prefix
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_client_ctx_t
modifier|*
name|ctx
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
operator|!
name|recurse
condition|)
name|SVN_ERR
argument_list|(
name|svn_error_create
argument_list|(
name|SVN_ERR_UNSUPPORTED_FEATURE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Non-recursive relocation not supported"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_client_relocate2
argument_list|(
name|path
argument_list|,
name|from_prefix
argument_list|,
name|to_prefix
argument_list|,
name|TRUE
argument_list|,
name|ctx
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From util.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_client_commit_item_create
parameter_list|(
specifier|const
name|svn_client_commit_item3_t
modifier|*
modifier|*
name|item
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
operator|*
name|item
operator|=
name|svn_client_commit_item3_create
argument_list|(
name|pool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_client_commit_item2_t
modifier|*
name|svn_client_commit_item2_dup
parameter_list|(
specifier|const
name|svn_client_commit_item2_t
modifier|*
name|item
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_client_commit_item2_t
modifier|*
name|new_item
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_item
argument_list|)
argument_list|)
decl_stmt|;
operator|*
name|new_item
operator|=
operator|*
name|item
expr_stmt|;
if|if
condition|(
name|new_item
operator|->
name|path
condition|)
name|new_item
operator|->
name|path
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|new_item
operator|->
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|new_item
operator|->
name|url
condition|)
name|new_item
operator|->
name|url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|new_item
operator|->
name|url
argument_list|)
expr_stmt|;
if|if
condition|(
name|new_item
operator|->
name|copyfrom_url
condition|)
name|new_item
operator|->
name|copyfrom_url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|new_item
operator|->
name|copyfrom_url
argument_list|)
expr_stmt|;
if|if
condition|(
name|new_item
operator|->
name|wcprop_changes
condition|)
name|new_item
operator|->
name|wcprop_changes
operator|=
name|svn_prop_array_dup
argument_list|(
name|new_item
operator|->
name|wcprop_changes
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|new_item
return|;
block|}
end_function

end_unit

