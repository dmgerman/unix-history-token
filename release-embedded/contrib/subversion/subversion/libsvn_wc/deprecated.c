begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * deprecated.c:  holding file for all deprecated APIs.  *                "we can't lose 'em, but we can shun 'em!"  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* We define this here to remove any further warnings about the usage of    deprecated functions in this file. */
end_comment

begin_define
define|#
directive|define
name|SVN_DEPRECATED
end_define

begin_include
include|#
directive|include
file|<apr_md5.h>
end_include

begin_include
include|#
directive|include
file|"svn_wc.h"
end_include

begin_include
include|#
directive|include
file|"svn_subst.h"
end_include

begin_include
include|#
directive|include
file|"svn_pools.h"
end_include

begin_include
include|#
directive|include
file|"svn_props.h"
end_include

begin_include
include|#
directive|include
file|"svn_hash.h"
end_include

begin_include
include|#
directive|include
file|"svn_time.h"
end_include

begin_include
include|#
directive|include
file|"svn_dirent_uri.h"
end_include

begin_include
include|#
directive|include
file|"svn_path.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_subr_private.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_wc_private.h"
end_include

begin_include
include|#
directive|include
file|"wc.h"
end_include

begin_include
include|#
directive|include
file|"entries.h"
end_include

begin_include
include|#
directive|include
file|"lock.h"
end_include

begin_include
include|#
directive|include
file|"props.h"
end_include

begin_include
include|#
directive|include
file|"translate.h"
end_include

begin_include
include|#
directive|include
file|"workqueue.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_comment
comment|/* baton for traversal_info_update */
end_comment

begin_struct
struct|struct
name|traversal_info_update_baton
block|{
name|struct
name|svn_wc_traversal_info_t
modifier|*
name|traversal
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Helper for updating svn_wc_traversal_info_t structures  * Implements svn_wc_external_update_t */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|traversal_info_update
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|local_abspath
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|old_val
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|new_val
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|dup_path
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
name|struct
name|traversal_info_update_baton
modifier|*
name|ub
init|=
name|baton
decl_stmt|;
name|apr_pool_t
modifier|*
name|dup_pool
init|=
name|ub
operator|->
name|traversal
operator|->
name|pool
decl_stmt|;
specifier|const
name|char
modifier|*
name|dup_val
init|=
name|NULL
decl_stmt|;
comment|/* We make the abspath relative by retrieving the access baton      for the specific directory */
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|ub
operator|->
name|db
argument_list|,
name|local_abspath
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|adm_access
condition|)
name|dup_path
operator|=
name|apr_pstrdup
argument_list|(
name|dup_pool
argument_list|,
name|svn_wc_adm_access_path
argument_list|(
name|adm_access
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|dup_path
operator|=
name|apr_pstrdup
argument_list|(
name|dup_pool
argument_list|,
name|local_abspath
argument_list|)
expr_stmt|;
if|if
condition|(
name|old_val
condition|)
block|{
name|dup_val
operator|=
name|apr_pstrmemdup
argument_list|(
name|dup_pool
argument_list|,
name|old_val
operator|->
name|data
argument_list|,
name|old_val
operator|->
name|len
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|ub
operator|->
name|traversal
operator|->
name|externals_old
argument_list|,
name|dup_path
argument_list|,
name|dup_val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|new_val
condition|)
block|{
comment|/* In most cases the value is identical */
if|if
condition|(
name|old_val
operator|!=
name|new_val
condition|)
name|dup_val
operator|=
name|apr_pstrmemdup
argument_list|(
name|dup_pool
argument_list|,
name|new_val
operator|->
name|data
argument_list|,
name|new_val
operator|->
name|len
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|ub
operator|->
name|traversal
operator|->
name|externals_new
argument_list|,
name|dup_path
argument_list|,
name|dup_val
argument_list|)
expr_stmt|;
block|}
name|svn_hash_sets
argument_list|(
name|ub
operator|->
name|traversal
operator|->
name|depths
argument_list|,
name|dup_path
argument_list|,
name|svn_depth_to_word
argument_list|(
name|depth
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* Helper for functions that used to gather traversal_info */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|gather_traversal_info
parameter_list|(
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|local_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|struct
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|svn_boolean_t
name|gather_as_old
parameter_list|,
name|svn_boolean_t
name|gather_as_new
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|externals
decl_stmt|;
name|apr_hash_t
modifier|*
name|ambient_depths
decl_stmt|;
name|apr_hash_index_t
modifier|*
name|hi
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__externals_gather_definitions
argument_list|(
operator|&
name|externals
argument_list|,
operator|&
name|ambient_depths
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|depth
argument_list|,
name|scratch_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|hi
operator|=
name|apr_hash_first
argument_list|(
name|scratch_pool
argument_list|,
name|externals
argument_list|)
init|;
name|hi
condition|;
name|hi
operator|=
name|apr_hash_next
argument_list|(
name|hi
argument_list|)
control|)
block|{
specifier|const
name|char
modifier|*
name|node_abspath
init|=
name|svn__apr_hash_index_key
argument_list|(
name|hi
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|relpath
decl_stmt|;
name|relpath
operator|=
name|svn_dirent_join
argument_list|(
name|path
argument_list|,
name|svn_dirent_skip_ancestor
argument_list|(
name|local_abspath
argument_list|,
name|node_abspath
argument_list|)
argument_list|,
name|traversal_info
operator|->
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|gather_as_old
condition|)
name|svn_hash_sets
argument_list|(
name|traversal_info
operator|->
name|externals_old
argument_list|,
name|relpath
argument_list|,
name|svn__apr_hash_index_val
argument_list|(
name|hi
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gather_as_new
condition|)
name|svn_hash_sets
argument_list|(
name|traversal_info
operator|->
name|externals_new
argument_list|,
name|relpath
argument_list|,
name|svn__apr_hash_index_val
argument_list|(
name|hi
argument_list|)
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|traversal_info
operator|->
name|depths
argument_list|,
name|relpath
argument_list|,
name|svn_hash_gets
argument_list|(
name|ambient_depths
argument_list|,
name|node_abspath
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/*** From adm_crawler.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_crawl_revisions4
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_ra_reporter3_t
modifier|*
name|reporter
parameter_list|,
name|void
modifier|*
name|report_baton
parameter_list|,
name|svn_boolean_t
name|restore_files
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|honor_depth_exclude
parameter_list|,
name|svn_boolean_t
name|depth_compatibility_trick
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_crawl_revisions5
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|reporter
argument_list|,
name|report_baton
argument_list|,
name|restore_files
argument_list|,
name|depth
argument_list|,
name|honor_depth_exclude
argument_list|,
name|depth_compatibility_trick
argument_list|,
name|use_commit_times
argument_list|,
name|NULL
comment|/* cancel_func */
argument_list|,
name|NULL
comment|/* cancel_baton */
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|traversal_info
condition|)
name|SVN_ERR
argument_list|(
name|gather_traversal_info
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|path
argument_list|,
name|depth
argument_list|,
name|traversal_info
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** Compatibility wrapper: turns an svn_ra_reporter2_t into an      svn_ra_reporter3_t.       This code looks like it duplicates code in libsvn_ra/ra_loader.c,      but it does not.  That code makes an new thing look like an old      thing; this code makes an old thing look like a new thing. ***/
end_comment

begin_struct
struct|struct
name|wrap_3to2_report_baton
block|{
specifier|const
name|svn_ra_reporter2_t
modifier|*
name|reporter
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_set_path
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_3to2_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|set_path
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|revision
argument_list|,
name|start_empty
argument_list|,
name|lock_token
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_delete_path
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_3to2_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|delete_path
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_link_path
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_3to2_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|link_path
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|url
argument_list|,
name|revision
argument_list|,
name|start_empty
argument_list|,
name|lock_token
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_finish_report
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_3to2_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|finish_report
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_abort_report
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_3to2_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|abort_report
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|svn_ra_reporter3_t
name|wrap_3to2_reporter
init|=
block|{
name|wrap_3to2_set_path
block|,
name|wrap_3to2_delete_path
block|,
name|wrap_3to2_link_path
block|,
name|wrap_3to2_finish_report
block|,
name|wrap_3to2_abort_report
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|svn_error_t
modifier|*
name|svn_wc_crawl_revisions3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_ra_reporter3_t
modifier|*
name|reporter
parameter_list|,
name|void
modifier|*
name|report_baton
parameter_list|,
name|svn_boolean_t
name|restore_files
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_compatibility_trick
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_crawl_revisions4
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|reporter
argument_list|,
name|report_baton
argument_list|,
name|restore_files
argument_list|,
name|depth
argument_list|,
name|FALSE
argument_list|,
name|depth_compatibility_trick
argument_list|,
name|use_commit_times
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_crawl_revisions2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_ra_reporter2_t
modifier|*
name|reporter
parameter_list|,
name|void
modifier|*
name|report_baton
parameter_list|,
name|svn_boolean_t
name|restore_files
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_3to2_report_baton
name|wrb
decl_stmt|;
name|wrb
operator|.
name|reporter
operator|=
name|reporter
expr_stmt|;
name|wrb
operator|.
name|baton
operator|=
name|report_baton
expr_stmt|;
return|return
name|svn_wc_crawl_revisions3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
operator|&
name|wrap_3to2_reporter
argument_list|,
operator|&
name|wrb
argument_list|,
name|restore_files
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|use_commit_times
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Baton for compat_call_notify_func below.  */
end_comment

begin_struct
struct|struct
name|compat_notify_baton_t
block|{
comment|/* Wrapped func/baton. */
name|svn_wc_notify_func_t
name|func
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Implements svn_wc_notify_func2_t.  Call BATON->func (BATON is of type    svn_wc__compat_notify_baton_t), passing BATON->baton and the appropriate    arguments from NOTIFY.  */
end_comment

begin_function
specifier|static
name|void
name|compat_call_notify_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_wc_notify_t
modifier|*
name|n
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_notify_baton_t
modifier|*
name|nb
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|nb
operator|->
name|func
condition|)
call|(
modifier|*
name|nb
operator|->
name|func
call|)
argument_list|(
name|nb
operator|->
name|baton
argument_list|,
name|n
operator|->
name|path
argument_list|,
name|n
operator|->
name|action
argument_list|,
name|n
operator|->
name|kind
argument_list|,
name|n
operator|->
name|mime_type
argument_list|,
name|n
operator|->
name|content_state
argument_list|,
name|n
operator|->
name|prop_state
argument_list|,
name|n
operator|->
name|revision
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*** Compatibility wrapper: turns an svn_ra_reporter_t into an      svn_ra_reporter2_t.       This code looks like it duplicates code in libsvn_ra/ra_loader.c,      but it does not.  That code makes an new thing look like an old      thing; this code makes an old thing look like a new thing. ***/
end_comment

begin_struct
struct|struct
name|wrap_2to1_report_baton
block|{
specifier|const
name|svn_ra_reporter_t
modifier|*
name|reporter
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_2to1_set_path
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_2to1_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|set_path
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|revision
argument_list|,
name|start_empty
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_2to1_delete_path
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_2to1_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|delete_path
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_2to1_link_path
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_2to1_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|link_path
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|path
argument_list|,
name|url
argument_list|,
name|revision
argument_list|,
name|start_empty
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_2to1_finish_report
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_2to1_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|finish_report
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_2to1_abort_report
parameter_list|(
name|void
modifier|*
name|report_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_2to1_report_baton
modifier|*
name|wrb
init|=
name|report_baton
decl_stmt|;
return|return
name|wrb
operator|->
name|reporter
operator|->
name|abort_report
argument_list|(
name|wrb
operator|->
name|baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|svn_ra_reporter2_t
name|wrap_2to1_reporter
init|=
block|{
name|wrap_2to1_set_path
block|,
name|wrap_2to1_delete_path
block|,
name|wrap_2to1_link_path
block|,
name|wrap_2to1_finish_report
block|,
name|wrap_2to1_abort_report
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|svn_error_t
modifier|*
name|svn_wc_crawl_revisions
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_ra_reporter_t
modifier|*
name|reporter
parameter_list|,
name|void
modifier|*
name|report_baton
parameter_list|,
name|svn_boolean_t
name|restore_files
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|wrap_2to1_report_baton
name|wrb
decl_stmt|;
name|struct
name|compat_notify_baton_t
name|nb
decl_stmt|;
name|wrb
operator|.
name|reporter
operator|=
name|reporter
expr_stmt|;
name|wrb
operator|.
name|baton
operator|=
name|report_baton
expr_stmt|;
name|nb
operator|.
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|.
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_crawl_revisions2
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
operator|&
name|wrap_2to1_reporter
argument_list|,
operator|&
name|wrb
argument_list|,
name|restore_files
argument_list|,
name|recurse
argument_list|,
name|use_commit_times
argument_list|,
name|compat_call_notify_func
argument_list|,
operator|&
name|nb
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_transmit_text_deltas2
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|tempfile
parameter_list|,
name|unsigned
name|char
name|digest
index|[]
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|fulltext
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|file_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|svn_checksum_t
modifier|*
name|new_text_base_md5_checksum
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__internal_transmit_text_deltas
argument_list|(
name|tempfile
argument_list|,
operator|(
name|digest
condition|?
operator|&
name|new_text_base_md5_checksum
else|:
name|NULL
operator|)
argument_list|,
name|NULL
argument_list|,
name|wc_ctx
operator|->
name|db
argument_list|,
name|local_abspath
argument_list|,
name|fulltext
argument_list|,
name|editor
argument_list|,
name|file_baton
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|digest
condition|)
name|memcpy
argument_list|(
name|digest
argument_list|,
name|new_text_base_md5_checksum
operator|->
name|digest
argument_list|,
name|APR_MD5_DIGESTSIZE
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_transmit_text_deltas
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|fulltext
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|file_baton
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|tempfile
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_transmit_text_deltas2
argument_list|(
name|tempfile
argument_list|,
name|NULL
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|fulltext
argument_list|,
name|editor
argument_list|,
name|file_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_transmit_prop_deltas
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_wc_entry_t
modifier|*
name|entry
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|tempfile
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
if|if
condition|(
name|tempfile
condition|)
operator|*
name|tempfile
operator|=
name|NULL
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_transmit_prop_deltas2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|editor
argument_list|,
name|baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From adm_files.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_ensure_adm3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|repos
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
if|if
condition|(
name|uuid
operator|==
name|NULL
condition|)
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_BAD_UUID
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
return|;
if|if
condition|(
name|repos
operator|==
name|NULL
condition|)
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_BAD_URL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
return|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_ensure_adm4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|url
argument_list|,
name|repos
argument_list|,
name|uuid
argument_list|,
name|revision
argument_list|,
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_ensure_adm2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|repos
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_ensure_adm3
argument_list|(
name|path
argument_list|,
name|uuid
argument_list|,
name|url
argument_list|,
name|repos
argument_list|,
name|revision
argument_list|,
name|svn_depth_infinity
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_ensure_adm
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|svn_revnum_t
name|revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_ensure_adm2
argument_list|(
name|path
argument_list|,
name|uuid
argument_list|,
name|url
argument_list|,
name|NULL
argument_list|,
name|revision
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_create_tmp_file
parameter_list|(
name|apr_file_t
modifier|*
modifier|*
name|fp
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|delete_on_close
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_create_tmp_file2
argument_list|(
name|fp
argument_list|,
name|NULL
argument_list|,
name|path
argument_list|,
name|delete_on_close
condition|?
name|svn_io_file_del_on_close
else|:
name|svn_io_file_del_none
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_create_tmp_file2
parameter_list|(
name|apr_file_t
modifier|*
modifier|*
name|fp
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|new_name
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_io_file_del_t
name|delete_when
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|char
modifier|*
name|temp_dir
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR_ASSERT
argument_list|(
name|fp
operator|||
name|new_name
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc__get_tmpdir
argument_list|(
operator|&
name|temp_dir
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_error_compose_create
argument_list|(
name|err
argument_list|,
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
name|SVN_ERR
argument_list|(
name|svn_io_open_unique_file3
argument_list|(
name|fp
argument_list|,
name|new_name
argument_list|,
name|temp_dir
argument_list|,
name|delete_when
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From adm_ops.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_pristine_contents
parameter_list|(
name|svn_stream_t
modifier|*
modifier|*
name|contents
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|scratch_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_pristine_contents2
argument_list|(
name|contents
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_queue_committed2
parameter_list|(
name|svn_wc_committed_queue_t
modifier|*
name|queue
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|wcprop_changes
parameter_list|,
name|svn_boolean_t
name|remove_lock
parameter_list|,
name|svn_boolean_t
name|remove_changelist
parameter_list|,
specifier|const
name|svn_checksum_t
modifier|*
name|md5_checksum
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|svn_checksum_t
modifier|*
name|sha1_checksum
init|=
name|NULL
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|scratch_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|md5_checksum
operator|!=
name|NULL
condition|)
block|{
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_wc__db_pristine_get_sha1
argument_list|(
operator|&
name|sha1_checksum
argument_list|,
name|wc_ctx
operator|->
name|db
argument_list|,
name|local_abspath
argument_list|,
name|md5_checksum
argument_list|,
name|svn_wc__get_committed_queue_pool
argument_list|(
name|queue
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
comment|/* Don't fail on SHA1 not found */
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_DB_ERROR
condition|)
block|{
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|sha1_checksum
operator|=
name|NULL
expr_stmt|;
block|}
else|else
name|SVN_ERR
argument_list|(
name|err
argument_list|)
expr_stmt|;
block|}
name|SVN_ERR
argument_list|(
name|svn_wc_queue_committed3
argument_list|(
name|queue
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|recurse
argument_list|,
name|wcprop_changes
argument_list|,
name|remove_lock
argument_list|,
name|remove_changelist
argument_list|,
name|sha1_checksum
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_queue_committed
parameter_list|(
name|svn_wc_committed_queue_t
modifier|*
modifier|*
name|queue
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|wcprop_changes
parameter_list|,
name|svn_boolean_t
name|remove_lock
parameter_list|,
name|svn_boolean_t
name|remove_changelist
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|svn_checksum_t
modifier|*
name|md5_checksum
decl_stmt|;
if|if
condition|(
name|digest
condition|)
name|md5_checksum
operator|=
name|svn_checksum__from_digest_md5
argument_list|(
name|digest
argument_list|,
name|svn_wc__get_committed_queue_pool
argument_list|(
operator|*
name|queue
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|md5_checksum
operator|=
name|NULL
expr_stmt|;
return|return
name|svn_wc_queue_committed2
argument_list|(
operator|*
name|queue
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|recurse
argument_list|,
name|wcprop_changes
argument_list|,
name|remove_lock
argument_list|,
name|remove_changelist
argument_list|,
name|md5_checksum
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_process_committed_queue
parameter_list|(
name|svn_wc_committed_queue_t
modifier|*
name|queue
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_revnum_t
name|new_revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_date
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_author
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_process_committed_queue2
argument_list|(
name|queue
argument_list|,
name|wc_ctx
argument_list|,
name|new_revnum
argument_list|,
name|rev_date
argument_list|,
name|rev_author
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_process_committed4
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_revnum_t
name|new_revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_date
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_author
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|wcprop_changes
parameter_list|,
name|svn_boolean_t
name|remove_lock
parameter_list|,
name|svn_boolean_t
name|remove_changelist
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|svn_checksum_t
modifier|*
name|md5_checksum
decl_stmt|;
specifier|const
name|svn_checksum_t
modifier|*
name|sha1_checksum
init|=
name|NULL
decl_stmt|;
name|apr_time_t
name|new_date
decl_stmt|;
name|apr_hash_t
modifier|*
name|wcprop_changes_hash
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rev_date
condition|)
name|SVN_ERR
argument_list|(
name|svn_time_from_cstring
argument_list|(
operator|&
name|new_date
argument_list|,
name|rev_date
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|new_date
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|digest
condition|)
name|md5_checksum
operator|=
name|svn_checksum__from_digest_md5
argument_list|(
name|digest
argument_list|,
name|pool
argument_list|)
expr_stmt|;
else|else
name|md5_checksum
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|md5_checksum
operator|!=
name|NULL
condition|)
block|{
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|err
operator|=
name|svn_wc__db_pristine_get_sha1
argument_list|(
operator|&
name|sha1_checksum
argument_list|,
name|db
argument_list|,
name|local_abspath
argument_list|,
name|md5_checksum
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_DB_ERROR
condition|)
block|{
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|sha1_checksum
operator|=
name|NULL
expr_stmt|;
block|}
else|else
name|SVN_ERR
argument_list|(
name|err
argument_list|)
expr_stmt|;
block|}
name|wcprop_changes_hash
operator|=
name|svn_wc__prop_array_to_hash
argument_list|(
name|wcprop_changes
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__process_committed_internal
argument_list|(
name|db
argument_list|,
name|local_abspath
argument_list|,
name|recurse
argument_list|,
name|TRUE
argument_list|,
name|new_revnum
argument_list|,
name|new_date
argument_list|,
name|rev_author
argument_list|,
name|wcprop_changes_hash
argument_list|,
operator|!
name|remove_lock
argument_list|,
operator|!
name|remove_changelist
argument_list|,
name|sha1_checksum
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Run the log file(s) we just created. */
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__wq_run
argument_list|(
name|db
argument_list|,
name|local_abspath
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_process_committed3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_revnum_t
name|new_revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_date
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_author
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|wcprop_changes
parameter_list|,
name|svn_boolean_t
name|remove_lock
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_process_committed4
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|recurse
argument_list|,
name|new_revnum
argument_list|,
name|rev_date
argument_list|,
name|rev_author
argument_list|,
name|wcprop_changes
argument_list|,
name|remove_lock
argument_list|,
name|FALSE
argument_list|,
name|digest
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_process_committed2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_revnum_t
name|new_revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_date
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_author
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|wcprop_changes
parameter_list|,
name|svn_boolean_t
name|remove_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_process_committed3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|recurse
argument_list|,
name|new_revnum
argument_list|,
name|rev_date
argument_list|,
name|rev_author
argument_list|,
name|wcprop_changes
argument_list|,
name|remove_lock
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_process_committed
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_revnum_t
name|new_revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_date
parameter_list|,
specifier|const
name|char
modifier|*
name|rev_author
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|wcprop_changes
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_process_committed2
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|recurse
argument_list|,
name|new_revnum
argument_list|,
name|rev_date
argument_list|,
name|rev_author
argument_list|,
name|wcprop_changes
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_maybe_set_repos_root
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|repos
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_delete3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_boolean_t
name|keep_local
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|dir_access
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Open access batons for everything below path, because we used to open      these before. */
name|SVN_ERR
argument_list|(
name|svn_wc_adm_probe_try3
argument_list|(
operator|&
name|dir_access
argument_list|,
name|adm_access
argument_list|,
name|path
argument_list|,
name|TRUE
argument_list|,
operator|-
literal|1
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_delete4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|keep_local
argument_list|,
name|TRUE
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_delete2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_delete3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_delete
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_notify_baton_t
name|nb
decl_stmt|;
name|nb
operator|.
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|.
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_delete2
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|compat_call_notify_func
argument_list|,
operator|&
name|nb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add_from_disk
parameter_list|(
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|local_abspath
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|SVN_ERR
argument_list|(
name|svn_wc_add_from_disk2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|NULL
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent_access
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_url
parameter_list|,
name|svn_revnum_t
name|copyfrom_rev
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|parent_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_add4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|depth
argument_list|,
name|copyfrom_url
argument_list|,
name|copyfrom_rev
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Make sure the caller gets the new access baton in the set. */
if|if
condition|(
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|wc_db
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|svn_node_kind_t
name|kind
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__db_read_kind
argument_list|(
operator|&
name|kind
argument_list|,
name|wc_db
argument_list|,
name|local_abspath
argument_list|,
name|FALSE
comment|/* allow_missing */
argument_list|,
name|TRUE
comment|/* show_deleted */
argument_list|,
name|FALSE
comment|/* show_hidden */
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|kind
operator|==
name|svn_node_dir
condition|)
block|{
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
comment|/* Open the access baton in adm_access' pool to give it the same              lifetime */
name|SVN_ERR
argument_list|(
name|svn_wc_adm_open3
argument_list|(
operator|&
name|adm_access
argument_list|,
name|parent_access
argument_list|,
name|path
argument_list|,
name|TRUE
argument_list|,
name|copyfrom_url
condition|?
operator|-
literal|1
else|:
literal|0
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|svn_wc_adm_access_pool
argument_list|(
name|parent_access
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent_access
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_url
parameter_list|,
name|svn_revnum_t
name|copyfrom_rev
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_add3
argument_list|(
name|path
argument_list|,
name|parent_access
argument_list|,
name|svn_depth_infinity
argument_list|,
name|copyfrom_url
argument_list|,
name|copyfrom_rev
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent_access
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_url
parameter_list|,
name|svn_revnum_t
name|copyfrom_rev
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_notify_baton_t
name|nb
decl_stmt|;
name|nb
operator|.
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|.
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_add2
argument_list|(
name|path
argument_list|,
name|parent_access
argument_list|,
name|copyfrom_url
argument_list|,
name|copyfrom_rev
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|compat_call_notify_func
argument_list|,
operator|&
name|nb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_revert3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent_access
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelist_filter
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|parent_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_revert4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|depth
argument_list|,
name|use_commit_times
argument_list|,
name|changelist_filter
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_revert2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent_access
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_revert3
argument_list|(
name|path
argument_list|,
name|parent_access
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recursive
argument_list|)
argument_list|,
name|use_commit_times
argument_list|,
name|NULL
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_revert
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent_access
parameter_list|,
name|svn_boolean_t
name|recursive
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_notify_baton_t
name|nb
decl_stmt|;
name|nb
operator|.
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|.
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_revert2
argument_list|(
name|path
argument_list|,
name|parent_access
argument_list|,
name|recursive
argument_list|,
name|use_commit_times
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|compat_call_notify_func
argument_list|,
operator|&
name|nb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_remove_from_revision_control
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|svn_boolean_t
name|destroy_wf
parameter_list|,
name|svn_boolean_t
name|instant_error
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
init|=
name|svn_dirent_join
argument_list|(
name|svn_wc__adm_access_abspath
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|name
argument_list|,
name|pool
argument_list|)
decl_stmt|;
comment|/* name must be an entry in adm_access, fail if not */
name|SVN_ERR_ASSERT
argument_list|(
name|strcmp
argument_list|(
name|svn_dirent_basename
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
argument_list|,
name|name
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_remove_from_revision_control2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|destroy_wf
argument_list|,
name|instant_error
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_resolved_conflict4
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|resolve_text
parameter_list|,
name|svn_boolean_t
name|resolve_props
parameter_list|,
name|svn_boolean_t
name|resolve_tree
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_wc_conflict_choice_t
name|conflict_choice
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_resolved_conflict5
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|depth
argument_list|,
name|resolve_text
argument_list|,
name|resolve_props
condition|?
literal|""
else|:
name|NULL
argument_list|,
name|resolve_tree
argument_list|,
name|conflict_choice
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_resolved_conflict
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|resolve_text
parameter_list|,
name|svn_boolean_t
name|resolve_props
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_notify_baton_t
name|nb
decl_stmt|;
name|nb
operator|.
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|.
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_resolved_conflict2
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|resolve_text
argument_list|,
name|resolve_props
argument_list|,
name|recurse
argument_list|,
name|compat_call_notify_func
argument_list|,
operator|&
name|nb
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_resolved_conflict2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|resolve_text
parameter_list|,
name|svn_boolean_t
name|resolve_props
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_resolved_conflict3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|resolve_text
argument_list|,
name|resolve_props
argument_list|,
name|SVN_DEPTH_INFINITY_OR_EMPTY
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|svn_wc_conflict_choose_merged
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_resolved_conflict3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|resolve_text
parameter_list|,
name|svn_boolean_t
name|resolve_props
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_wc_conflict_choice_t
name|conflict_choice
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_resolved_conflict4
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|resolve_text
argument_list|,
name|resolve_props
argument_list|,
name|FALSE
argument_list|,
name|depth
argument_list|,
name|svn_wc_conflict_choose_merged
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add_lock
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|svn_lock_t
modifier|*
name|lock
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_add_lock2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|lock
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_remove_lock
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_remove_lock2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_ancestry
parameter_list|(
name|char
modifier|*
modifier|*
name|url
parameter_list|,
name|svn_revnum_t
modifier|*
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|svn_wc_entry_t
modifier|*
name|entry
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__get_entry
argument_list|(
operator|&
name|entry
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|local_abspath
argument_list|,
name|FALSE
argument_list|,
name|svn_node_unknown
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|url
condition|)
operator|*
name|url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|entry
operator|->
name|url
argument_list|)
expr_stmt|;
if|if
condition|(
name|rev
condition|)
operator|*
name|rev
operator|=
name|entry
operator|->
name|revision
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_set_changelist
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|changelist
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_set_changelist2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|changelist
argument_list|,
name|svn_depth_empty
argument_list|,
name|NULL
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From diff.c ***/
end_comment

begin_comment
comment|/* Used to wrap svn_wc_diff_callbacks_t. */
end_comment

begin_struct
struct|struct
name|diff_callbacks_wrapper_baton
block|{
specifier|const
name|svn_wc_diff_callbacks_t
modifier|*
name|callbacks
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1_file_changed
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
name|svn_revnum_t
name|rev1
parameter_list|,
name|svn_revnum_t
name|rev2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|tmpfile2
operator|!=
name|NULL
condition|)
name|SVN_ERR
argument_list|(
name|b
operator|->
name|callbacks
operator|->
name|file_changed
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|path
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|b
operator|->
name|baton
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|propchanges
operator|->
name|nelts
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|b
operator|->
name|callbacks
operator|->
name|props_changed
argument_list|(
name|adm_access
argument_list|,
name|propstate
argument_list|,
name|path
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1_file_added
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
name|svn_revnum_t
name|rev1
parameter_list|,
name|svn_revnum_t
name|rev2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
name|SVN_ERR
argument_list|(
name|b
operator|->
name|callbacks
operator|->
name|file_added
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|path
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|b
operator|->
name|baton
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|propchanges
operator|->
name|nelts
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|b
operator|->
name|callbacks
operator|->
name|props_changed
argument_list|(
name|adm_access
argument_list|,
name|propstate
argument_list|,
name|path
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1_file_deleted
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
name|SVN_ERR_ASSERT
argument_list|(
name|originalprops
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks
operator|->
name|file_deleted
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1_dir_added
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks
operator|->
name|dir_added
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|rev
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1_dir_deleted
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks
operator|->
name|dir_deleted
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1_dir_props_changed
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks
operator|->
name|props_changed
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t    and svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1or2_dir_opened
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
comment|/* Do nothing. */
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping svn_wc_diff_callbacks_t    and svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to1or2_dir_closed
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
if|if
condition|(
name|contentstate
condition|)
operator|*
name|contentstate
operator|=
name|svn_wc_notify_state_unknown
expr_stmt|;
if|if
condition|(
name|propstate
condition|)
operator|*
name|propstate
operator|=
name|svn_wc_notify_state_unknown
expr_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
comment|/* Do nothing. */
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* Used to wrap svn_diff_callbacks_t as an svn_wc_diff_callbacks3_t. */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|svn_wc_diff_callbacks3_t
name|diff_callbacks_wrapper
init|=
block|{
name|wrap_3to1_file_changed
block|,
name|wrap_3to1_file_added
block|,
name|wrap_3to1_file_deleted
block|,
name|wrap_3to1_dir_added
block|,
name|wrap_3to1_dir_deleted
block|,
name|wrap_3to1_dir_props_changed
block|,
name|wrap_3to1or2_dir_opened
block|,
name|wrap_3to1or2_dir_closed
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Used to wrap svn_wc_diff_callbacks2_t. */
end_comment

begin_struct
struct|struct
name|diff_callbacks2_wrapper_baton
block|{
specifier|const
name|svn_wc_diff_callbacks2_t
modifier|*
name|callbacks2
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping  * svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_file_changed
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
name|svn_revnum_t
name|rev1
parameter_list|,
name|svn_revnum_t
name|rev2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks2
operator|->
name|file_changed
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|propstate
argument_list|,
name|path
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping  * svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_file_added
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
name|svn_revnum_t
name|rev1
parameter_list|,
name|svn_revnum_t
name|rev2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks2
operator|->
name|file_added
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|propstate
argument_list|,
name|path
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping  * svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_file_deleted
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks2
operator|->
name|file_deleted
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping  * svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_dir_added
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks2
operator|->
name|dir_added
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|rev
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping  * svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_dir_deleted
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks2
operator|->
name|dir_deleted
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks3_t function for wrapping  * svn_wc_diff_callbacks2_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_3to2_dir_props_changed
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
if|if
condition|(
name|tree_conflicted
condition|)
operator|*
name|tree_conflicted
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks2
operator|->
name|dir_props_changed
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|path
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Used to wrap svn_diff_callbacks2_t as an svn_wc_diff_callbacks3_t. */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|svn_wc_diff_callbacks3_t
name|diff_callbacks2_wrapper
init|=
block|{
name|wrap_3to2_file_changed
block|,
name|wrap_3to2_file_added
block|,
name|wrap_3to2_file_deleted
block|,
name|wrap_3to2_dir_added
block|,
name|wrap_3to2_dir_deleted
block|,
name|wrap_3to2_dir_props_changed
block|,
name|wrap_3to1or2_dir_opened
block|,
name|wrap_3to1or2_dir_closed
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Used to wrap svn_wc_diff_callbacks3_t. */
end_comment

begin_struct
struct|struct
name|diff_callbacks3_wrapper_baton
block|{
specifier|const
name|svn_wc_diff_callbacks3_t
modifier|*
name|callbacks3
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
specifier|const
name|char
modifier|*
name|anchor
decl_stmt|;
specifier|const
name|char
modifier|*
name|anchor_abspath
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_file_opened
parameter_list|(
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
name|svn_boolean_t
modifier|*
name|skip
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_file_changed
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
name|svn_revnum_t
name|rev1
parameter_list|,
name|svn_revnum_t
name|rev2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
specifier|const
name|char
modifier|*
name|dir
init|=
name|svn_relpath_dirname
argument_list|(
name|path
argument_list|,
name|scratch_pool
argument_list|)
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|dir
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|file_changed
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|propstate
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_file_added
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
name|svn_revnum_t
name|rev1
parameter_list|,
name|svn_revnum_t
name|rev2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_path
parameter_list|,
name|svn_revnum_t
name|copyfrom_revision
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
specifier|const
name|char
modifier|*
name|dir
init|=
name|svn_relpath_dirname
argument_list|(
name|path
argument_list|,
name|scratch_pool
argument_list|)
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|dir
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|file_added
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|propstate
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|propchanges
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_file_deleted
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile1
parameter_list|,
specifier|const
name|char
modifier|*
name|tmpfile2
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype1
parameter_list|,
specifier|const
name|char
modifier|*
name|mimetype2
parameter_list|,
name|apr_hash_t
modifier|*
name|originalprops
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
specifier|const
name|char
modifier|*
name|dir
init|=
name|svn_relpath_dirname
argument_list|(
name|path
argument_list|,
name|scratch_pool
argument_list|)
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|dir
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|file_deleted
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|tmpfile1
argument_list|,
name|tmpfile2
argument_list|,
name|mimetype1
argument_list|,
name|mimetype2
argument_list|,
name|originalprops
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_dir_added
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
name|svn_boolean_t
modifier|*
name|skip
parameter_list|,
name|svn_boolean_t
modifier|*
name|skip_children
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_path
parameter_list|,
name|svn_revnum_t
name|copyfrom_revision
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|dir_added
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_dir_deleted
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|dir_deleted
argument_list|(
name|adm_access
argument_list|,
name|state
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_dir_props_changed
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|dir_was_added
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
name|original_props
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|dir_props_changed
argument_list|(
name|adm_access
argument_list|,
name|propstate
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|propchanges
argument_list|,
name|original_props
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_dir_opened
parameter_list|(
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
name|svn_boolean_t
modifier|*
name|skip
parameter_list|,
name|svn_boolean_t
modifier|*
name|skip_children
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|skip_children
condition|)
operator|*
name|skip_children
operator|=
name|FALSE
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|dir_opened
argument_list|(
name|adm_access
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* An svn_wc_diff_callbacks4_t function for wrapping  * svn_wc_diff_callbacks3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|wrap_4to3_dir_closed
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|contentstate
parameter_list|,
name|svn_wc_notify_state_t
modifier|*
name|propstate
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|dir_was_added
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|diff_baton
decl_stmt|;
name|svn_wc_adm_access_t
modifier|*
name|adm_access
decl_stmt|;
name|adm_access
operator|=
name|svn_wc__adm_retrieve_internal2
argument_list|(
name|b
operator|->
name|db
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
return|return
name|b
operator|->
name|callbacks3
operator|->
name|dir_closed
argument_list|(
name|adm_access
argument_list|,
name|contentstate
argument_list|,
name|propstate
argument_list|,
name|tree_conflicted
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|b
operator|->
name|baton
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Used to wrap svn_diff_callbacks3_t as an svn_wc_diff_callbacks4_t. */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|svn_wc_diff_callbacks4_t
name|diff_callbacks3_wrapper
init|=
block|{
name|wrap_4to3_file_opened
block|,
name|wrap_4to3_file_changed
block|,
name|wrap_4to3_file_added
block|,
name|wrap_4to3_file_deleted
block|,
name|wrap_4to3_dir_deleted
block|,
name|wrap_4to3_dir_opened
block|,
name|wrap_4to3_dir_added
block|,
name|wrap_4to3_dir_props_changed
block|,
name|wrap_4to3_dir_closed
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_diff_editor6
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|anchor_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|show_copies_as_adds
parameter_list|,
name|svn_boolean_t
name|use_git_diff_format
parameter_list|,
name|svn_boolean_t
name|use_text_base
parameter_list|,
name|svn_boolean_t
name|reverse_order
parameter_list|,
name|svn_boolean_t
name|server_performs_filtering
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelist_filter
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks4_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__get_diff_editor
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|wc_ctx
argument_list|,
name|anchor_abspath
argument_list|,
name|target
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|show_copies_as_adds
argument_list|,
name|use_git_diff_format
argument_list|,
name|use_text_base
argument_list|,
name|reverse_order
argument_list|,
name|server_performs_filtering
argument_list|,
name|changelist_filter
argument_list|,
name|callbacks
argument_list|,
name|callback_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_diff_editor5
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks3_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|use_text_base
parameter_list|,
name|svn_boolean_t
name|reverse_order
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelist_filter
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|anchor
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|->
name|callbacks3
operator|=
name|callbacks
expr_stmt|;
name|b
operator|->
name|baton
operator|=
name|callback_baton
expr_stmt|;
name|b
operator|->
name|db
operator|=
name|db
expr_stmt|;
name|b
operator|->
name|anchor
operator|=
name|svn_wc_adm_access_path
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
name|b
operator|->
name|anchor_abspath
operator|=
name|svn_wc__adm_access_abspath
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_diff_editor6
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|wc_ctx
argument_list|,
name|b
operator|->
name|anchor_abspath
argument_list|,
name|target
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|use_text_base
argument_list|,
name|reverse_order
argument_list|,
name|FALSE
argument_list|,
name|changelist_filter
argument_list|,
operator|&
name|diff_callbacks3_wrapper
argument_list|,
name|b
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Can't destroy wc_ctx. It is used by the diff editor */
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_diff_editor4
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks2_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|use_text_base
parameter_list|,
name|svn_boolean_t
name|reverse_order
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelist_filter
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|b
operator|->
name|callbacks2
operator|=
name|callbacks
expr_stmt|;
name|b
operator|->
name|baton
operator|=
name|callback_baton
expr_stmt|;
return|return
name|svn_wc_get_diff_editor5
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
operator|&
name|diff_callbacks2_wrapper
argument_list|,
name|b
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|use_text_base
argument_list|,
name|reverse_order
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|changelist_filter
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_diff_editor3
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks2_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|use_text_base
parameter_list|,
name|svn_boolean_t
name|reverse_order
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_get_diff_editor4
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
name|callbacks
argument_list|,
name|callback_baton
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|use_text_base
argument_list|,
name|reverse_order
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|NULL
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_diff_editor2
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|use_text_base
parameter_list|,
name|svn_boolean_t
name|reverse_order
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|b
operator|->
name|callbacks
operator|=
name|callbacks
expr_stmt|;
name|b
operator|->
name|baton
operator|=
name|callback_baton
expr_stmt|;
return|return
name|svn_wc_get_diff_editor5
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
operator|&
name|diff_callbacks_wrapper
argument_list|,
name|b
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|use_text_base
argument_list|,
name|reverse_order
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|NULL
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_diff_editor
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|use_text_base
parameter_list|,
name|svn_boolean_t
name|reverse_order
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_get_diff_editor2
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
name|callbacks
argument_list|,
name|callback_baton
argument_list|,
name|recurse
argument_list|,
name|FALSE
argument_list|,
name|use_text_base
argument_list|,
name|reverse_order
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_diff5
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks3_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelist_filter
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|diff_callbacks3_wrapper_baton
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|anchor
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|->
name|callbacks3
operator|=
name|callbacks
expr_stmt|;
name|b
operator|->
name|baton
operator|=
name|callback_baton
expr_stmt|;
name|b
operator|->
name|anchor
operator|=
name|svn_wc_adm_access_path
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
name|b
operator|->
name|anchor_abspath
operator|=
name|svn_wc__adm_access_abspath
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_diff6
argument_list|(
name|wc_ctx
argument_list|,
name|svn_dirent_join
argument_list|(
name|b
operator|->
name|anchor_abspath
argument_list|,
name|target
argument_list|,
name|pool
argument_list|)
argument_list|,
operator|&
name|diff_callbacks3_wrapper
argument_list|,
name|b
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|changelist_filter
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_diff4
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks2_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|changelist_filter
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|diff_callbacks2_wrapper_baton
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|b
operator|->
name|callbacks2
operator|=
name|callbacks
expr_stmt|;
name|b
operator|->
name|baton
operator|=
name|callback_baton
expr_stmt|;
return|return
name|svn_wc_diff5
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
operator|&
name|diff_callbacks2_wrapper
argument_list|,
name|b
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|changelist_filter
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_diff3
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks2_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_diff4
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
name|callbacks
argument_list|,
name|callback_baton
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_diff2
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|diff_callbacks_wrapper_baton
modifier|*
name|b
init|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|b
operator|->
name|callbacks
operator|=
name|callbacks
expr_stmt|;
name|b
operator|->
name|baton
operator|=
name|callback_baton
expr_stmt|;
return|return
name|svn_wc_diff5
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
operator|&
name|diff_callbacks_wrapper
argument_list|,
name|b
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_diff
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|svn_wc_diff_callbacks_t
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_diff2
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
name|callbacks
argument_list|,
name|callback_baton
argument_list|,
name|recurse
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From entries.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_walk_entries2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_wc_entry_callbacks_t
modifier|*
name|walk_callbacks
parameter_list|,
name|void
modifier|*
name|walk_baton
parameter_list|,
name|svn_boolean_t
name|show_hidden
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_entry_callbacks2_t
name|walk_cb2
init|=
block|{
literal|0
block|}
decl_stmt|;
name|walk_cb2
operator|.
name|found_entry
operator|=
name|walk_callbacks
operator|->
name|found_entry
expr_stmt|;
name|walk_cb2
operator|.
name|handle_error
operator|=
name|svn_wc__walker_default_error_handler
expr_stmt|;
return|return
name|svn_wc_walk_entries3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
operator|&
name|walk_cb2
argument_list|,
name|walk_baton
argument_list|,
name|svn_depth_infinity
argument_list|,
name|show_hidden
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_walk_entries
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|svn_wc_entry_callbacks_t
modifier|*
name|walk_callbacks
parameter_list|,
name|void
modifier|*
name|walk_baton
parameter_list|,
name|svn_boolean_t
name|show_hidden
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_walk_entries2
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|walk_callbacks
argument_list|,
name|walk_baton
argument_list|,
name|show_hidden
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_mark_missing_deleted
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|parent
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* With a single DB a node will never be missing */
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_WC_PATH_FOUND
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Unexpectedly found '%s': "
literal|"path is marked 'missing'"
argument_list|)
argument_list|,
name|svn_dirent_local_style
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From props.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_parse_externals_description2
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|externals_p
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_directory
parameter_list|,
specifier|const
name|char
modifier|*
name|desc
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|list
decl_stmt|;
name|apr_pool_t
modifier|*
name|subpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_parse_externals_description3
argument_list|(
name|externals_p
condition|?
operator|&
name|list
else|:
name|NULL
argument_list|,
name|parent_directory
argument_list|,
name|desc
argument_list|,
name|TRUE
argument_list|,
name|subpool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|externals_p
condition|)
block|{
name|int
name|i
decl_stmt|;
operator|*
name|externals_p
operator|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
name|list
operator|->
name|nelts
argument_list|,
sizeof|sizeof
argument_list|(
name|svn_wc_external_item_t
operator|*
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|list
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
name|svn_wc_external_item2_t
modifier|*
name|item2
init|=
name|APR_ARRAY_IDX
argument_list|(
name|list
argument_list|,
name|i
argument_list|,
name|svn_wc_external_item2_t
operator|*
argument_list|)
decl_stmt|;
name|svn_wc_external_item_t
modifier|*
name|item
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|item
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|item2
operator|->
name|target_dir
condition|)
name|item
operator|->
name|target_dir
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|item2
operator|->
name|target_dir
argument_list|)
expr_stmt|;
if|if
condition|(
name|item2
operator|->
name|url
condition|)
name|item
operator|->
name|url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|item2
operator|->
name|url
argument_list|)
expr_stmt|;
name|item
operator|->
name|revision
operator|=
name|item2
operator|->
name|revision
expr_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
operator|*
name|externals_p
argument_list|,
name|svn_wc_external_item_t
operator|*
argument_list|)
operator|=
name|item
expr_stmt|;
block|}
block|}
name|svn_pool_destroy
argument_list|(
name|subpool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_parse_externals_description
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|externals_p
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_directory
parameter_list|,
specifier|const
name|char
modifier|*
name|desc
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|list
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_parse_externals_description2
argument_list|(
name|externals_p
condition|?
operator|&
name|list
else|:
name|NULL
argument_list|,
name|parent_directory
argument_list|,
name|desc
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Store all of the items into the hash if that was requested. */
if|if
condition|(
name|externals_p
condition|)
block|{
name|int
name|i
decl_stmt|;
operator|*
name|externals_p
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|list
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
name|svn_wc_external_item_t
modifier|*
name|item
decl_stmt|;
name|item
operator|=
name|APR_ARRAY_IDX
argument_list|(
name|list
argument_list|,
name|i
argument_list|,
name|svn_wc_external_item_t
operator|*
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
operator|*
name|externals_p
argument_list|,
name|item
operator|->
name|target_dir
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_prop_set3
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|value
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|skip_checks
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_prop_set4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|name
argument_list|,
name|value
argument_list|,
name|svn_depth_empty
argument_list|,
name|skip_checks
argument_list|,
name|NULL
comment|/* changelist_filter */
argument_list|,
name|NULL
argument_list|,
name|NULL
comment|/* cancellation */
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_INVALID_SCHEDULE
condition|)
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
else|else
name|SVN_ERR
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_prop_set2
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|value
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|skip_checks
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_prop_set3
argument_list|(
name|name
argument_list|,
name|value
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|skip_checks
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_prop_set
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|value
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_prop_set2
argument_list|(
name|name
argument_list|,
name|value
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_prop_list
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|props
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_prop_list2
argument_list|(
name|props
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_PATH_NOT_FOUND
condition|)
block|{
operator|*
name|props
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|err
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|svn_error_compose_create
argument_list|(
name|err
argument_list|,
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_prop_get
parameter_list|(
specifier|const
name|svn_string_t
modifier|*
modifier|*
name|value
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_prop_get2
argument_list|(
name|value
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|name
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_PATH_NOT_FOUND
condition|)
block|{
operator|*
name|value
operator|=
name|NULL
expr_stmt|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|err
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|svn_error_compose_create
argument_list|(
name|err
argument_list|,
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* baton for conflict_func_1to2_wrapper */
end_comment

begin_struct
struct|struct
name|conflict_func_1to2_baton
block|{
name|svn_wc_conflict_resolver_func_t
name|inner_func
decl_stmt|;
name|void
modifier|*
name|inner_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Implements svn_wc_conflict_resolver_func2_t */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|conflict_func_1to2_wrapper
parameter_list|(
name|svn_wc_conflict_result_t
modifier|*
modifier|*
name|result
parameter_list|,
specifier|const
name|svn_wc_conflict_description2_t
modifier|*
name|conflict
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|conflict_func_1to2_baton
modifier|*
name|btn
init|=
name|baton
decl_stmt|;
name|svn_wc_conflict_description_t
modifier|*
name|cd
init|=
name|svn_wc__cd2_to_cd
argument_list|(
name|conflict
argument_list|,
name|scratch_pool
argument_list|)
decl_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|btn
operator|->
name|inner_func
argument_list|(
name|result
argument_list|,
name|cd
argument_list|,
name|btn
operator|->
name|inner_baton
argument_list|,
name|result_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge_props2
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_hash_t
modifier|*
name|baseprops
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|svn_boolean_t
name|base_merge
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|svn_wc_conflict_resolver_func_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|struct
name|conflict_func_1to2_baton
name|conflict_wrapper
decl_stmt|;
if|if
condition|(
name|base_merge
operator|&&
operator|!
name|dry_run
condition|)
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_UNSUPPORTED_FEATURE
argument_list|,
name|NULL
argument_list|,
name|U_
argument_list|(
literal|"base_merge=TRUE is no longer supported; "
literal|"see notes/api-errata/1.7/wc006.txt"
argument_list|)
argument_list|)
return|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|conflict_wrapper
operator|.
name|inner_func
operator|=
name|conflict_func
expr_stmt|;
name|conflict_wrapper
operator|.
name|inner_baton
operator|=
name|conflict_baton
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_merge_props3
argument_list|(
name|state
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|NULL
comment|/* left_version */
argument_list|,
name|NULL
comment|/* right_version */
argument_list|,
name|baseprops
argument_list|,
name|propchanges
argument_list|,
name|dry_run
argument_list|,
name|conflict_func
condition|?
name|conflict_func_1to2_wrapper
else|:
name|NULL
argument_list|,
operator|&
name|conflict_wrapper
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
switch|switch
condition|(
name|err
operator|->
name|apr_err
condition|)
block|{
case|case
name|SVN_ERR_WC_PATH_NOT_FOUND
case|:
case|case
name|SVN_ERR_WC_PATH_UNEXPECTED_STATUS
case|:
name|err
operator|->
name|apr_err
operator|=
name|SVN_ERR_UNVERSIONED_RESOURCE
expr_stmt|;
break|break;
block|}
return|return
name|svn_error_trace
argument_list|(
name|svn_error_compose_create
argument_list|(
name|err
argument_list|,
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge_props
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_hash_t
modifier|*
name|baseprops
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|svn_boolean_t
name|base_merge
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_merge_props2
argument_list|(
name|state
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|baseprops
argument_list|,
name|propchanges
argument_list|,
name|base_merge
argument_list|,
name|dry_run
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge_prop_diffs
parameter_list|(
name|svn_wc_notify_state_t
modifier|*
name|state
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|propchanges
parameter_list|,
name|svn_boolean_t
name|base_merge
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* NOTE: Here, we use implementation knowledge.  The public      svn_wc_merge_props2 doesn't allow NULL as baseprops argument, but we know      that it works. */
return|return
name|svn_wc_merge_props2
argument_list|(
name|state
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|NULL
argument_list|,
name|propchanges
argument_list|,
name|base_merge
argument_list|,
name|dry_run
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_prop_diffs
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|propchanges
parameter_list|,
name|apr_hash_t
modifier|*
modifier|*
name|original_props
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_prop_diffs2
argument_list|(
name|propchanges
argument_list|,
name|original_props
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_props_modified_p
parameter_list|(
name|svn_boolean_t
modifier|*
name|modified_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_props_modified_p2
argument_list|(
name|modified_p
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
if|if
condition|(
name|err
operator|->
name|apr_err
operator|!=
name|SVN_ERR_WC_PATH_NOT_FOUND
condition|)
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
operator|*
name|modified_p
operator|=
name|FALSE
expr_stmt|;
block|}
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From status.c ***/
end_comment

begin_struct
struct|struct
name|status4_wrapper_baton
block|{
name|svn_wc_status_func3_t
name|old_func
decl_stmt|;
name|void
modifier|*
name|old_baton
decl_stmt|;
specifier|const
name|char
modifier|*
name|anchor_abspath
decl_stmt|;
specifier|const
name|char
modifier|*
name|anchor_relpath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|status4_wrapper_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|local_abspath
parameter_list|,
specifier|const
name|svn_wc_status3_t
modifier|*
name|status
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|status4_wrapper_baton
modifier|*
name|swb
init|=
name|baton
decl_stmt|;
name|svn_wc_status2_t
modifier|*
name|dup
decl_stmt|;
specifier|const
name|char
modifier|*
name|path
init|=
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__status2_from_3
argument_list|(
operator|&
name|dup
argument_list|,
name|status
argument_list|,
name|swb
operator|->
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|scratch_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|swb
operator|->
name|anchor_abspath
operator|!=
name|NULL
condition|)
block|{
name|path
operator|=
name|svn_dirent_join
argument_list|(
name|swb
operator|->
name|anchor_relpath
argument_list|,
name|svn_dirent_skip_ancestor
argument_list|(
name|swb
operator|->
name|anchor_abspath
argument_list|,
name|local_abspath
argument_list|)
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
block|}
return|return
call|(
modifier|*
name|swb
operator|->
name|old_func
call|)
argument_list|(
name|swb
operator|->
name|old_baton
argument_list|,
name|path
argument_list|,
name|dup
argument_list|,
name|scratch_pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_status_editor5
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|void
modifier|*
modifier|*
name|set_locks_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|edit_revision
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|anchor_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|target_basename
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_boolean_t
name|depth_as_sticky
parameter_list|,
name|svn_boolean_t
name|server_performs_filtering
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|ignore_patterns
parameter_list|,
name|svn_wc_status_func4_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__get_status_editor
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|set_locks_baton
argument_list|,
name|edit_revision
argument_list|,
name|wc_ctx
argument_list|,
name|anchor_abspath
argument_list|,
name|target_basename
argument_list|,
name|depth
argument_list|,
name|get_all
argument_list|,
name|no_ignore
argument_list|,
name|depth_as_sticky
argument_list|,
name|server_performs_filtering
argument_list|,
name|ignore_patterns
argument_list|,
name|status_func
argument_list|,
name|status_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_status_editor4
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|void
modifier|*
modifier|*
name|set_locks_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|edit_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|ignore_patterns
parameter_list|,
name|svn_wc_status_func3_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|status4_wrapper_baton
modifier|*
name|swb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|swb
argument_list|)
argument_list|)
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|anchor_abspath
decl_stmt|;
name|swb
operator|->
name|old_func
operator|=
name|status_func
expr_stmt|;
name|swb
operator|->
name|old_baton
operator|=
name|status_baton
expr_stmt|;
name|wc_db
operator|=
name|svn_wc__adm_get_db
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|swb
operator|->
name|wc_ctx
operator|=
name|wc_ctx
expr_stmt|;
name|anchor_abspath
operator|=
name|svn_wc__adm_access_abspath
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|svn_dirent_is_absolute
argument_list|(
name|svn_wc_adm_access_path
argument_list|(
name|anchor
argument_list|)
argument_list|)
condition|)
block|{
name|swb
operator|->
name|anchor_abspath
operator|=
name|anchor_abspath
expr_stmt|;
name|swb
operator|->
name|anchor_relpath
operator|=
name|svn_wc_adm_access_path
argument_list|(
name|anchor
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|swb
operator|->
name|anchor_abspath
operator|=
name|NULL
expr_stmt|;
name|swb
operator|->
name|anchor_relpath
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* Before subversion 1.7 status always handled depth as sticky. 1.7 made      the output of svn status by default match the result of what would be      updated by a similar svn update. (Following the documentation) */
name|SVN_ERR
argument_list|(
name|svn_wc_get_status_editor5
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|set_locks_baton
argument_list|,
name|edit_revision
argument_list|,
name|wc_ctx
argument_list|,
name|anchor_abspath
argument_list|,
name|target
argument_list|,
name|depth
argument_list|,
name|get_all
argument_list|,
name|no_ignore
argument_list|,
operator|(
name|depth
operator|!=
name|svn_depth_unknown
operator|)
comment|/*as_sticky*/
argument_list|,
name|FALSE
comment|/* server_performs_filtering */
argument_list|,
name|ignore_patterns
argument_list|,
name|status4_wrapper_func
argument_list|,
name|swb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|traversal_info
condition|)
block|{
specifier|const
name|char
modifier|*
name|local_path
init|=
name|svn_wc_adm_access_path
argument_list|(
name|anchor
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
init|=
name|anchor_abspath
decl_stmt|;
if|if
condition|(
operator|*
name|target
condition|)
block|{
name|local_path
operator|=
name|svn_dirent_join
argument_list|(
name|local_path
argument_list|,
name|target
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|local_abspath
operator|=
name|svn_dirent_join
argument_list|(
name|local_abspath
argument_list|,
name|target
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
name|SVN_ERR
argument_list|(
name|gather_traversal_info
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|local_path
argument_list|,
name|depth
argument_list|,
name|traversal_info
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* We can't destroy wc_ctx here, because the editor needs it while it's      driven. */
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_struct
struct|struct
name|status_editor3_compat_baton
block|{
name|svn_wc_status_func2_t
name|old_func
decl_stmt|;
name|void
modifier|*
name|old_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|status_editor3_compat_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_status2_t
modifier|*
name|status
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|status_editor3_compat_baton
modifier|*
name|secb
init|=
name|baton
decl_stmt|;
name|secb
operator|->
name|old_func
argument_list|(
name|secb
operator|->
name|old_baton
argument_list|,
name|path
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_status_editor3
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|void
modifier|*
modifier|*
name|set_locks_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|edit_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|ignore_patterns
parameter_list|,
name|svn_wc_status_func2_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* This baton must live beyond this function. Alloc on heap.  */
name|struct
name|status_editor3_compat_baton
modifier|*
name|secb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|secb
argument_list|)
argument_list|)
decl_stmt|;
name|secb
operator|->
name|old_func
operator|=
name|status_func
expr_stmt|;
name|secb
operator|->
name|old_baton
operator|=
name|status_baton
expr_stmt|;
return|return
name|svn_wc_get_status_editor4
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|set_locks_baton
argument_list|,
name|edit_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|depth
argument_list|,
name|get_all
argument_list|,
name|no_ignore
argument_list|,
name|ignore_patterns
argument_list|,
name|status_editor3_compat_func
argument_list|,
name|secb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_status_editor2
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|void
modifier|*
modifier|*
name|set_locks_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|edit_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|apr_hash_t
modifier|*
name|config
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_wc_status_func2_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|ignores
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_default_ignores
argument_list|(
operator|&
name|ignores
argument_list|,
name|config
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_wc_get_status_editor3
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|set_locks_baton
argument_list|,
name|edit_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|SVN_DEPTH_INFINITY_OR_IMMEDIATES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|get_all
argument_list|,
name|no_ignore
argument_list|,
name|ignores
argument_list|,
name|status_func
argument_list|,
name|status_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Helpers for deprecated svn_wc_status_editor(), of type    svn_wc_status_func2_t. */
end_comment

begin_struct
struct|struct
name|old_status_func_cb_baton
block|{
name|svn_wc_status_func_t
name|original_func
decl_stmt|;
name|void
modifier|*
name|original_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* */
end_comment

begin_function
specifier|static
name|void
name|old_status_func_cb
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_status2_t
modifier|*
name|status
parameter_list|)
block|{
name|struct
name|old_status_func_cb_baton
modifier|*
name|b
init|=
name|baton
decl_stmt|;
name|svn_wc_status_t
modifier|*
name|stat
init|=
operator|(
name|svn_wc_status_t
operator|*
operator|)
name|status
decl_stmt|;
name|b
operator|->
name|original_func
argument_list|(
name|b
operator|->
name|original_baton
argument_list|,
name|path
argument_list|,
name|stat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_status_editor
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|edit_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|apr_hash_t
modifier|*
name|config
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|get_all
parameter_list|,
name|svn_boolean_t
name|no_ignore
parameter_list|,
name|svn_wc_status_func_t
name|status_func
parameter_list|,
name|void
modifier|*
name|status_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|old_status_func_cb_baton
modifier|*
name|b
init|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|apr_array_header_t
modifier|*
name|ignores
decl_stmt|;
name|b
operator|->
name|original_func
operator|=
name|status_func
expr_stmt|;
name|b
operator|->
name|original_baton
operator|=
name|status_baton
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_default_ignores
argument_list|(
operator|&
name|ignores
argument_list|,
name|config
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_wc_get_status_editor3
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|NULL
argument_list|,
name|edit_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|SVN_DEPTH_INFINITY_OR_IMMEDIATES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|get_all
argument_list|,
name|no_ignore
argument_list|,
name|ignores
argument_list|,
name|old_status_func_cb
argument_list|,
name|b
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_status
parameter_list|(
name|svn_wc_status_t
modifier|*
modifier|*
name|status
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_status2_t
modifier|*
name|stat2
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_status2
argument_list|(
operator|&
name|stat2
argument_list|,
name|path
argument_list|,
name|adm_access
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|status
operator|=
operator|(
name|svn_wc_status_t
operator|*
operator|)
name|stat2
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_wc_conflict_description_t
modifier|*
name|conflict_description_dup
parameter_list|(
specifier|const
name|svn_wc_conflict_description_t
modifier|*
name|conflict
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_conflict_description_t
modifier|*
name|new_conflict
decl_stmt|;
name|new_conflict
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_conflict
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Shallow copy all members. */
operator|*
name|new_conflict
operator|=
operator|*
name|conflict
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|path
condition|)
name|new_conflict
operator|->
name|path
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|property_name
condition|)
name|new_conflict
operator|->
name|property_name
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|property_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|mime_type
condition|)
name|new_conflict
operator|->
name|mime_type
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|mime_type
argument_list|)
expr_stmt|;
comment|/* NOTE: We cannot make a deep copy of adm_access. */
if|if
condition|(
name|conflict
operator|->
name|base_file
condition|)
name|new_conflict
operator|->
name|base_file
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|base_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|their_file
condition|)
name|new_conflict
operator|->
name|their_file
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|their_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|my_file
condition|)
name|new_conflict
operator|->
name|my_file
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|my_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|merged_file
condition|)
name|new_conflict
operator|->
name|merged_file
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|conflict
operator|->
name|merged_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|src_left_version
condition|)
name|new_conflict
operator|->
name|src_left_version
operator|=
name|svn_wc_conflict_version_dup
argument_list|(
name|conflict
operator|->
name|src_left_version
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|conflict
operator|->
name|src_right_version
condition|)
name|new_conflict
operator|->
name|src_right_version
operator|=
name|svn_wc_conflict_version_dup
argument_list|(
name|conflict
operator|->
name|src_right_version
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|new_conflict
return|;
block|}
end_function

begin_function
name|svn_wc_status2_t
modifier|*
name|svn_wc_dup_status2
parameter_list|(
specifier|const
name|svn_wc_status2_t
modifier|*
name|orig_stat
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_status2_t
modifier|*
name|new_stat
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_stat
argument_list|)
argument_list|)
decl_stmt|;
comment|/* Shallow copy all members. */
operator|*
name|new_stat
operator|=
operator|*
name|orig_stat
expr_stmt|;
comment|/* Now go back and dup the deep items into this pool. */
if|if
condition|(
name|orig_stat
operator|->
name|entry
condition|)
name|new_stat
operator|->
name|entry
operator|=
name|svn_wc_entry_dup
argument_list|(
name|orig_stat
operator|->
name|entry
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|orig_stat
operator|->
name|repos_lock
condition|)
name|new_stat
operator|->
name|repos_lock
operator|=
name|svn_lock_dup
argument_list|(
name|orig_stat
operator|->
name|repos_lock
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|orig_stat
operator|->
name|url
condition|)
name|new_stat
operator|->
name|url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|orig_stat
operator|->
name|url
argument_list|)
expr_stmt|;
if|if
condition|(
name|orig_stat
operator|->
name|ood_last_cmt_author
condition|)
name|new_stat
operator|->
name|ood_last_cmt_author
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|orig_stat
operator|->
name|ood_last_cmt_author
argument_list|)
expr_stmt|;
if|if
condition|(
name|orig_stat
operator|->
name|tree_conflict
condition|)
name|new_stat
operator|->
name|tree_conflict
operator|=
name|conflict_description_dup
argument_list|(
name|orig_stat
operator|->
name|tree_conflict
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* Return the new hotness. */
return|return
name|new_stat
return|;
block|}
end_function

begin_function
name|svn_wc_status_t
modifier|*
name|svn_wc_dup_status
parameter_list|(
specifier|const
name|svn_wc_status_t
modifier|*
name|orig_stat
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_status_t
modifier|*
name|new_stat
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_stat
argument_list|)
argument_list|)
decl_stmt|;
comment|/* Shallow copy all members. */
operator|*
name|new_stat
operator|=
operator|*
name|orig_stat
expr_stmt|;
comment|/* Now go back and dup the deep item into this pool. */
if|if
condition|(
name|orig_stat
operator|->
name|entry
condition|)
name|new_stat
operator|->
name|entry
operator|=
name|svn_wc_entry_dup
argument_list|(
name|orig_stat
operator|->
name|entry
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* Return the new hotness. */
return|return
name|new_stat
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_ignores
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|patterns
parameter_list|,
name|apr_hash_t
modifier|*
name|config
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|svn_wc_adm_access_path
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_ignores2
argument_list|(
name|patterns
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|config
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_status2
parameter_list|(
name|svn_wc_status2_t
modifier|*
modifier|*
name|status
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc_status3_t
modifier|*
name|stat3
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_status3
argument_list|(
operator|&
name|stat3
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__status2_from_3
argument_list|(
name|status
argument_list|,
name|stat3
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From update_editor.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add_repos_file3
parameter_list|(
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_stream_t
modifier|*
name|new_base_contents
parameter_list|,
name|svn_stream_t
modifier|*
name|new_contents
parameter_list|,
name|apr_hash_t
modifier|*
name|new_base_props
parameter_list|,
name|apr_hash_t
modifier|*
name|new_props
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_url
parameter_list|,
name|svn_revnum_t
name|copyfrom_rev
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|dst_path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_add_repos_file4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|new_base_contents
argument_list|,
name|new_contents
argument_list|,
name|new_base_props
argument_list|,
name|new_props
argument_list|,
name|copyfrom_url
argument_list|,
name|copyfrom_rev
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add_repos_file2
parameter_list|(
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|new_text_base_path
parameter_list|,
specifier|const
name|char
modifier|*
name|new_text_path
parameter_list|,
name|apr_hash_t
modifier|*
name|new_base_props
parameter_list|,
name|apr_hash_t
modifier|*
name|new_props
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_url
parameter_list|,
name|svn_revnum_t
name|copyfrom_rev
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_stream_t
modifier|*
name|new_base_contents
decl_stmt|;
name|svn_stream_t
modifier|*
name|new_contents
init|=
name|NULL
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_open_readonly
argument_list|(
operator|&
name|new_base_contents
argument_list|,
name|new_text_base_path
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|new_text_path
condition|)
block|{
comment|/* NOTE: the specified path may *not* be under version control.          It is most likely sitting in .svn/tmp/. Thus, we cannot use the          typical WC functions to access "special", "keywords" or "EOL"          information. We need to look at the properties given to us. */
comment|/* If the new file is special, then we can simply open the given          contents since it is already in normal form. */
if|if
condition|(
name|svn_hash_gets
argument_list|(
name|new_props
argument_list|,
name|SVN_PROP_SPECIAL
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_stream_open_readonly
argument_list|(
operator|&
name|new_contents
argument_list|,
name|new_text_path
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* The new text contents need to be detrans'd into normal form. */
name|svn_subst_eol_style_t
name|eol_style
decl_stmt|;
specifier|const
name|char
modifier|*
name|eol_str
decl_stmt|;
name|apr_hash_t
modifier|*
name|keywords
init|=
name|NULL
decl_stmt|;
name|svn_string_t
modifier|*
name|list
decl_stmt|;
name|list
operator|=
name|svn_hash_gets
argument_list|(
name|new_props
argument_list|,
name|SVN_PROP_KEYWORDS
argument_list|)
expr_stmt|;
if|if
condition|(
name|list
operator|!=
name|NULL
condition|)
block|{
comment|/* Since we are detranslating, all of the keyword values                  can be "". */
name|SVN_ERR
argument_list|(
name|svn_subst_build_keywords2
argument_list|(
operator|&
name|keywords
argument_list|,
name|list
operator|->
name|data
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|apr_hash_count
argument_list|(
name|keywords
argument_list|)
operator|==
literal|0
condition|)
name|keywords
operator|=
name|NULL
expr_stmt|;
block|}
name|svn_subst_eol_style_from_value
argument_list|(
operator|&
name|eol_style
argument_list|,
operator|&
name|eol_str
argument_list|,
name|svn_hash_gets
argument_list|(
name|new_props
argument_list|,
name|SVN_PROP_EOL_STYLE
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|svn_subst_translation_required
argument_list|(
name|eol_style
argument_list|,
name|eol_str
argument_list|,
name|keywords
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_subst_stream_detranslated
argument_list|(
operator|&
name|new_contents
argument_list|,
name|new_text_path
argument_list|,
name|eol_style
argument_list|,
name|eol_str
argument_list|,
name|FALSE
argument_list|,
name|keywords
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SVN_ERR
argument_list|(
name|svn_stream_open_readonly
argument_list|(
operator|&
name|new_contents
argument_list|,
name|new_text_path
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|SVN_ERR
argument_list|(
name|svn_wc_add_repos_file3
argument_list|(
name|dst_path
argument_list|,
name|adm_access
argument_list|,
name|new_base_contents
argument_list|,
name|new_contents
argument_list|,
name|new_base_props
argument_list|,
name|new_props
argument_list|,
name|copyfrom_url
argument_list|,
name|copyfrom_rev
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* The API contract states that the text files will be removed upon      successful completion. add_repos_file3() does not remove the files      since it only has streams on them. Toss 'em now. */
name|svn_error_clear
argument_list|(
name|svn_io_remove_file
argument_list|(
name|new_text_base_path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|new_text_path
condition|)
name|svn_error_clear
argument_list|(
name|svn_io_remove_file
argument_list|(
name|new_text_path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_add_repos_file
parameter_list|(
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|new_text_path
parameter_list|,
name|apr_hash_t
modifier|*
name|new_props
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_url
parameter_list|,
name|svn_revnum_t
name|copyfrom_rev
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_add_repos_file2
argument_list|(
name|dst_path
argument_list|,
name|adm_access
argument_list|,
name|new_text_path
argument_list|,
name|NULL
argument_list|,
name|new_props
argument_list|,
name|NULL
argument_list|,
name|copyfrom_url
argument_list|,
name|copyfrom_rev
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_actual_target
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|target
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_actual_target2
argument_list|(
name|anchor
argument_list|,
name|target
argument_list|,
name|wc_ctx
argument_list|,
name|path
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* This function has no internal variant as its behavior on switched    non-directories is not what you would expect. But this happens to    be the legacy behavior of this function. */
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_is_wc_root2
parameter_list|(
name|svn_boolean_t
modifier|*
name|wc_root
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|local_abspath
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|svn_boolean_t
name|is_root
decl_stmt|;
name|svn_boolean_t
name|is_switched
decl_stmt|;
name|svn_node_kind_t
name|kind
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR_ASSERT
argument_list|(
name|svn_dirent_is_absolute
argument_list|(
name|local_abspath
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc__db_is_switched
argument_list|(
operator|&
name|is_root
argument_list|,
operator|&
name|is_switched
argument_list|,
operator|&
name|kind
argument_list|,
name|wc_ctx
operator|->
name|db
argument_list|,
name|local_abspath
argument_list|,
name|scratch_pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
if|if
condition|(
name|err
operator|->
name|apr_err
operator|!=
name|SVN_ERR_WC_PATH_NOT_FOUND
operator|&&
name|err
operator|->
name|apr_err
operator|!=
name|SVN_ERR_WC_NOT_WORKING_COPY
condition|)
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_ENTRY_NOT_FOUND
argument_list|,
name|err
argument_list|,
name|err
operator|->
name|message
argument_list|)
return|;
block|}
operator|*
name|wc_root
operator|=
name|is_root
operator|||
operator|(
name|kind
operator|==
name|svn_node_dir
operator|&&
name|is_switched
operator|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_is_wc_root
parameter_list|(
name|svn_boolean_t
modifier|*
name|wc_root
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
comment|/* Subversion<= 1.6 said that '.' or a drive root is a WC root. */
if|if
condition|(
name|svn_path_is_empty
argument_list|(
name|path
argument_list|)
operator|||
name|svn_dirent_is_root
argument_list|(
name|path
argument_list|,
name|strlen
argument_list|(
name|path
argument_list|)
argument_list|)
condition|)
block|{
operator|*
name|wc_root
operator|=
name|TRUE
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_is_wc_root2
argument_list|(
name|wc_root
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
operator|(
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_NOT_WORKING_COPY
operator|||
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_PATH_NOT_FOUND
operator|)
condition|)
block|{
comment|/* Subversion<= 1.6 said that an unversioned path is a WC root. */
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
operator|*
name|wc_root
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
name|SVN_ERR
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_update_editor4
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|anchor_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|target_basename
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_is_sticky
parameter_list|,
name|svn_boolean_t
name|allow_unver_obstructions
parameter_list|,
name|svn_boolean_t
name|adds_as_modification
parameter_list|,
name|svn_boolean_t
name|server_performs_filtering
parameter_list|,
name|svn_boolean_t
name|clean_checkout
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|preserved_exts
parameter_list|,
name|svn_wc_dirents_func_t
name|fetch_dirents_func
parameter_list|,
name|void
modifier|*
name|fetch_dirents_baton
parameter_list|,
name|svn_wc_conflict_resolver_func2_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
name|svn_wc_external_update_t
name|external_func
parameter_list|,
name|void
modifier|*
name|external_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__get_update_editor
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|target_revision
argument_list|,
name|wc_ctx
argument_list|,
name|anchor_abspath
argument_list|,
name|target_basename
argument_list|,
name|NULL
argument_list|,
name|use_commit_times
argument_list|,
name|depth
argument_list|,
name|depth_is_sticky
argument_list|,
name|allow_unver_obstructions
argument_list|,
name|adds_as_modification
argument_list|,
name|server_performs_filtering
argument_list|,
name|clean_checkout
argument_list|,
name|diff3_cmd
argument_list|,
name|preserved_exts
argument_list|,
name|fetch_dirents_func
argument_list|,
name|fetch_dirents_baton
argument_list|,
name|conflict_func
argument_list|,
name|conflict_baton
argument_list|,
name|external_func
argument_list|,
name|external_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_update_editor3
parameter_list|(
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_is_sticky
parameter_list|,
name|svn_boolean_t
name|allow_unver_obstructions
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_conflict_resolver_func_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
name|svn_wc_get_file_t
name|fetch_func
parameter_list|,
name|void
modifier|*
name|fetch_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|preserved_exts
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|anchor
argument_list|)
decl_stmt|;
name|svn_wc_external_update_t
name|external_func
init|=
name|NULL
decl_stmt|;
name|struct
name|traversal_info_update_baton
modifier|*
name|eb
init|=
name|NULL
decl_stmt|;
name|struct
name|conflict_func_1to2_baton
modifier|*
name|cfw
init|=
name|NULL
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|traversal_info
condition|)
block|{
name|eb
operator|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|eb
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|db
operator|=
name|db
expr_stmt|;
name|eb
operator|->
name|traversal
operator|=
name|traversal_info
expr_stmt|;
name|external_func
operator|=
name|traversal_info_update
expr_stmt|;
block|}
if|if
condition|(
name|conflict_func
condition|)
block|{
name|cfw
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|cfw
argument_list|)
argument_list|)
expr_stmt|;
name|cfw
operator|->
name|inner_func
operator|=
name|conflict_func
expr_stmt|;
name|cfw
operator|->
name|inner_baton
operator|=
name|conflict_baton
expr_stmt|;
block|}
if|if
condition|(
name|diff3_cmd
condition|)
name|SVN_ERR
argument_list|(
name|svn_path_cstring_to_utf8
argument_list|(
operator|&
name|diff3_cmd
argument_list|,
name|diff3_cmd
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_update_editor4
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|target_revision
argument_list|,
name|wc_ctx
argument_list|,
name|svn_wc__adm_access_abspath
argument_list|(
name|anchor
argument_list|)
argument_list|,
name|target
argument_list|,
name|use_commit_times
argument_list|,
name|depth
argument_list|,
name|depth_is_sticky
argument_list|,
name|allow_unver_obstructions
argument_list|,
name|TRUE
comment|/* adds_as_modification */
argument_list|,
name|FALSE
comment|/* server_performs_filtering */
argument_list|,
name|FALSE
comment|/* clean_checkout */
argument_list|,
name|diff3_cmd
argument_list|,
name|preserved_exts
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
comment|/* fetch_dirents_func, baton */
name|conflict_func
condition|?
name|conflict_func_1to2_wrapper
else|:
name|NULL
argument_list|,
name|cfw
argument_list|,
name|external_func
argument_list|,
name|eb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* We can't destroy wc_ctx here, because the editor needs it while it's      driven. */
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_update_editor2
parameter_list|(
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_get_update_editor3
argument_list|(
name|target_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|use_commit_times
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|diff3_cmd
argument_list|,
name|NULL
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_update_editor
parameter_list|(
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* This baton must live beyond this function. Alloc on heap.  */
name|struct
name|compat_notify_baton_t
modifier|*
name|nb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nb
argument_list|)
argument_list|)
decl_stmt|;
name|nb
operator|->
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|->
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_get_update_editor3
argument_list|(
name|target_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|use_commit_times
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|compat_call_notify_func
argument_list|,
name|nb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|diff3_cmd
argument_list|,
name|NULL
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_switch_editor4
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|anchor_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|target_basename
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_url
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_is_sticky
parameter_list|,
name|svn_boolean_t
name|allow_unver_obstructions
parameter_list|,
name|svn_boolean_t
name|server_performs_filtering
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|preserved_exts
parameter_list|,
name|svn_wc_dirents_func_t
name|fetch_dirents_func
parameter_list|,
name|void
modifier|*
name|fetch_dirents_baton
parameter_list|,
name|svn_wc_conflict_resolver_func2_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
name|svn_wc_external_update_t
name|external_func
parameter_list|,
name|void
modifier|*
name|external_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__get_switch_editor
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|target_revision
argument_list|,
name|wc_ctx
argument_list|,
name|anchor_abspath
argument_list|,
name|target_basename
argument_list|,
name|switch_url
argument_list|,
name|NULL
argument_list|,
name|use_commit_times
argument_list|,
name|depth
argument_list|,
name|depth_is_sticky
argument_list|,
name|allow_unver_obstructions
argument_list|,
name|server_performs_filtering
argument_list|,
name|diff3_cmd
argument_list|,
name|preserved_exts
argument_list|,
name|fetch_dirents_func
argument_list|,
name|fetch_dirents_baton
argument_list|,
name|conflict_func
argument_list|,
name|conflict_baton
argument_list|,
name|external_func
argument_list|,
name|external_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_switch_editor3
parameter_list|(
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_url
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|depth_is_sticky
parameter_list|,
name|svn_boolean_t
name|allow_unver_obstructions
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_conflict_resolver_func_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|preserved_exts
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|anchor
argument_list|)
decl_stmt|;
name|svn_wc_external_update_t
name|external_func
init|=
name|NULL
decl_stmt|;
name|struct
name|traversal_info_update_baton
modifier|*
name|eb
init|=
name|NULL
decl_stmt|;
name|struct
name|conflict_func_1to2_baton
modifier|*
name|cfw
init|=
name|NULL
decl_stmt|;
name|SVN_ERR_ASSERT
argument_list|(
name|switch_url
operator|&&
name|svn_uri_is_canonical
argument_list|(
name|switch_url
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|traversal_info
condition|)
block|{
name|eb
operator|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|eb
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|db
operator|=
name|db
expr_stmt|;
name|eb
operator|->
name|traversal
operator|=
name|traversal_info
expr_stmt|;
name|external_func
operator|=
name|traversal_info_update
expr_stmt|;
block|}
if|if
condition|(
name|conflict_func
condition|)
block|{
name|cfw
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|cfw
argument_list|)
argument_list|)
expr_stmt|;
name|cfw
operator|->
name|inner_func
operator|=
name|conflict_func
expr_stmt|;
name|cfw
operator|->
name|inner_baton
operator|=
name|conflict_baton
expr_stmt|;
block|}
if|if
condition|(
name|diff3_cmd
condition|)
name|SVN_ERR
argument_list|(
name|svn_path_cstring_to_utf8
argument_list|(
operator|&
name|diff3_cmd
argument_list|,
name|diff3_cmd
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_get_switch_editor4
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|target_revision
argument_list|,
name|wc_ctx
argument_list|,
name|svn_wc__adm_access_abspath
argument_list|(
name|anchor
argument_list|)
argument_list|,
name|target
argument_list|,
name|switch_url
argument_list|,
name|use_commit_times
argument_list|,
name|depth
argument_list|,
name|depth_is_sticky
argument_list|,
name|allow_unver_obstructions
argument_list|,
name|FALSE
comment|/* server_performs_filtering */
argument_list|,
name|diff3_cmd
argument_list|,
name|preserved_exts
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
comment|/* fetch_dirents_func, baton */
name|conflict_func
condition|?
name|conflict_func_1to2_wrapper
else|:
name|NULL
argument_list|,
name|cfw
argument_list|,
name|external_func
argument_list|,
name|eb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* We can't destroy wc_ctx here, because the editor needs it while it's      driven. */
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_switch_editor2
parameter_list|(
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_url
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|SVN_ERR_ASSERT
argument_list|(
name|switch_url
argument_list|)
expr_stmt|;
return|return
name|svn_wc_get_switch_editor3
argument_list|(
name|target_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|switch_url
argument_list|,
name|use_commit_times
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|diff3_cmd
argument_list|,
name|NULL
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_get_switch_editor
parameter_list|(
name|svn_revnum_t
modifier|*
name|target_revision
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_url
parameter_list|,
name|svn_boolean_t
name|use_commit_times
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* This baton must live beyond this function. Alloc on heap.  */
name|struct
name|compat_notify_baton_t
modifier|*
name|nb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nb
argument_list|)
argument_list|)
decl_stmt|;
name|nb
operator|->
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|->
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_get_switch_editor3
argument_list|(
name|target_revision
argument_list|,
name|anchor
argument_list|,
name|target
argument_list|,
name|switch_url
argument_list|,
name|use_commit_times
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|compat_call_notify_func
argument_list|,
name|nb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|diff3_cmd
argument_list|,
name|NULL
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|traversal_info
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_external_item_create
parameter_list|(
specifier|const
name|svn_wc_external_item2_t
modifier|*
modifier|*
name|item
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
operator|*
name|item
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
name|svn_wc_external_item2_t
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_wc_external_item_t
modifier|*
name|svn_wc_external_item_dup
parameter_list|(
specifier|const
name|svn_wc_external_item_t
modifier|*
name|item
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_external_item_t
modifier|*
name|new_item
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_item
argument_list|)
argument_list|)
decl_stmt|;
operator|*
name|new_item
operator|=
operator|*
name|item
expr_stmt|;
if|if
condition|(
name|new_item
operator|->
name|target_dir
condition|)
name|new_item
operator|->
name|target_dir
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|new_item
operator|->
name|target_dir
argument_list|)
expr_stmt|;
if|if
condition|(
name|new_item
operator|->
name|url
condition|)
name|new_item
operator|->
name|url
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|new_item
operator|->
name|url
argument_list|)
expr_stmt|;
return|return
name|new_item
return|;
block|}
end_function

begin_function
name|svn_wc_traversal_info_t
modifier|*
name|svn_wc_init_traversal_info
parameter_list|(
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_traversal_info_t
modifier|*
name|ti
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ti
argument_list|)
argument_list|)
decl_stmt|;
name|ti
operator|->
name|pool
operator|=
name|pool
expr_stmt|;
name|ti
operator|->
name|externals_old
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|ti
operator|->
name|externals_new
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|ti
operator|->
name|depths
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
return|return
name|ti
return|;
block|}
end_function

begin_function
name|void
name|svn_wc_edited_externals
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|externals_old
parameter_list|,
name|apr_hash_t
modifier|*
modifier|*
name|externals_new
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|)
block|{
operator|*
name|externals_old
operator|=
name|traversal_info
operator|->
name|externals_old
expr_stmt|;
operator|*
name|externals_new
operator|=
name|traversal_info
operator|->
name|externals_new
expr_stmt|;
block|}
end_function

begin_function
name|void
name|svn_wc_traversed_depths
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|depths
parameter_list|,
name|svn_wc_traversal_info_t
modifier|*
name|traversal_info
parameter_list|)
block|{
operator|*
name|depths
operator|=
name|traversal_info
operator|->
name|depths
expr_stmt|;
block|}
end_function

begin_comment
comment|/*** From lock.c ***/
end_comment

begin_comment
comment|/* To preserve API compatibility with Subversion 1.0.0 */
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_open
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|associated
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|write_lock
parameter_list|,
name|svn_boolean_t
name|tree_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_adm_open3
argument_list|(
name|adm_access
argument_list|,
name|associated
argument_list|,
name|path
argument_list|,
name|write_lock
argument_list|,
operator|(
name|tree_lock
condition|?
operator|-
literal|1
else|:
literal|0
operator|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_open2
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|associated
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|write_lock
parameter_list|,
name|int
name|levels_to_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_adm_open3
argument_list|(
name|adm_access
argument_list|,
name|associated
argument_list|,
name|path
argument_list|,
name|write_lock
argument_list|,
name|levels_to_lock
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_probe_open
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|associated
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|write_lock
parameter_list|,
name|svn_boolean_t
name|tree_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_adm_probe_open3
argument_list|(
name|adm_access
argument_list|,
name|associated
argument_list|,
name|path
argument_list|,
name|write_lock
argument_list|,
operator|(
name|tree_lock
condition|?
operator|-
literal|1
else|:
literal|0
operator|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_probe_open2
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|associated
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|write_lock
parameter_list|,
name|int
name|levels_to_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_adm_probe_open3
argument_list|(
name|adm_access
argument_list|,
name|associated
argument_list|,
name|path
argument_list|,
name|write_lock
argument_list|,
name|levels_to_lock
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_probe_try2
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|associated
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|write_lock
parameter_list|,
name|int
name|levels_to_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_adm_probe_try3
argument_list|(
name|adm_access
argument_list|,
name|associated
argument_list|,
name|path
argument_list|,
name|write_lock
argument_list|,
name|levels_to_lock
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_probe_try
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
modifier|*
name|adm_access
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|associated
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|write_lock
parameter_list|,
name|svn_boolean_t
name|tree_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_adm_probe_try3
argument_list|(
name|adm_access
argument_list|,
name|associated
argument_list|,
name|path
argument_list|,
name|write_lock
argument_list|,
operator|(
name|tree_lock
condition|?
operator|-
literal|1
else|:
literal|0
operator|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_adm_close
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|)
block|{
comment|/* This is the only pool we have access to. */
name|apr_pool_t
modifier|*
name|scratch_pool
init|=
name|svn_wc_adm_access_pool
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
return|return
name|svn_wc_adm_close2
argument_list|(
name|adm_access
argument_list|,
name|scratch_pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_locked
parameter_list|(
name|svn_boolean_t
modifier|*
name|locked
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_locked2
argument_list|(
name|NULL
argument_list|,
name|locked
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_check_wc
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|int
modifier|*
name|wc_format
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_check_wc2
argument_list|(
name|wc_format
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From translate.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_translated_file
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|xlated_p
parameter_list|,
specifier|const
name|char
modifier|*
name|vfile
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_boolean_t
name|force_repair
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_translated_file2
argument_list|(
name|xlated_p
argument_list|,
name|vfile
argument_list|,
name|vfile
argument_list|,
name|adm_access
argument_list|,
name|SVN_WC_TRANSLATE_TO_NF
operator||
operator|(
name|force_repair
condition|?
name|SVN_WC_TRANSLATE_FORCE_EOL_REPAIR
else|:
literal|0
operator|)
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_translated_stream
parameter_list|(
name|svn_stream_t
modifier|*
modifier|*
name|stream
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|versioned_file
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_uint32_t
name|flags
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|char
modifier|*
name|versioned_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|versioned_abspath
argument_list|,
name|versioned_file
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__internal_translated_stream
argument_list|(
name|stream
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|local_abspath
argument_list|,
name|versioned_abspath
argument_list|,
name|flags
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_translated_file2
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|xlated_path
parameter_list|,
specifier|const
name|char
modifier|*
name|src
parameter_list|,
specifier|const
name|char
modifier|*
name|versioned_file
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_uint32_t
name|flags
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|versioned_abspath
decl_stmt|;
specifier|const
name|char
modifier|*
name|root
decl_stmt|;
specifier|const
name|char
modifier|*
name|tmp_root
decl_stmt|;
specifier|const
name|char
modifier|*
name|src_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|versioned_abspath
argument_list|,
name|versioned_file
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|src_abspath
argument_list|,
name|src
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__internal_translated_file
argument_list|(
name|xlated_path
argument_list|,
name|src_abspath
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|versioned_abspath
argument_list|,
name|flags
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
operator|*
name|xlated_path
argument_list|,
name|src_abspath
argument_list|)
operator|==
literal|0
condition|)
operator|*
name|xlated_path
operator|=
name|src
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|svn_dirent_is_absolute
argument_list|(
name|versioned_file
argument_list|)
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_io_temp_dir
argument_list|(
operator|&
name|tmp_root
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|svn_dirent_is_child
argument_list|(
name|tmp_root
argument_list|,
operator|*
name|xlated_path
argument_list|,
name|pool
argument_list|)
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|root
argument_list|,
literal|""
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|svn_dirent_is_child
argument_list|(
name|root
argument_list|,
operator|*
name|xlated_path
argument_list|,
name|pool
argument_list|)
condition|)
operator|*
name|xlated_path
operator|=
name|svn_dirent_is_child
argument_list|(
name|root
argument_list|,
operator|*
name|xlated_path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From relocate.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_relocate3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|from
parameter_list|,
specifier|const
name|char
modifier|*
name|to
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_relocation_validator3_t
name|validator
parameter_list|,
name|void
modifier|*
name|validator_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
if|if
condition|(
operator|!
name|recurse
condition|)
name|SVN_ERR
argument_list|(
name|svn_error_create
argument_list|(
name|SVN_ERR_UNSUPPORTED_FEATURE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Non-recursive relocation not supported"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_relocate4
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|from
argument_list|,
name|to
argument_list|,
name|validator
argument_list|,
name|validator_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Compatibility baton and wrapper. */
end_comment

begin_struct
struct|struct
name|compat2_baton
block|{
name|svn_wc_relocation_validator2_t
name|validator
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Compatibility baton and wrapper. */
end_comment

begin_struct
struct|struct
name|compat_baton
block|{
name|svn_wc_relocation_validator_t
name|validator
decl_stmt|;
name|void
modifier|*
name|baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* This implements svn_wc_relocate_validator3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|compat2_validator
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|root_url
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat2_baton
modifier|*
name|cb
init|=
name|baton
decl_stmt|;
comment|/* The old callback type doesn't set root_url. */
return|return
name|cb
operator|->
name|validator
argument_list|(
name|cb
operator|->
name|baton
argument_list|,
name|uuid
argument_list|,
operator|(
name|root_url
condition|?
name|root_url
else|:
name|url
operator|)
argument_list|,
operator|(
name|root_url
operator|!=
name|NULL
operator|)
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* This implements svn_wc_relocate_validator3_t. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|compat_validator
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|uuid
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|root_url
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_baton
modifier|*
name|cb
init|=
name|baton
decl_stmt|;
comment|/* The old callback type doesn't allow uuid to be NULL. */
if|if
condition|(
name|uuid
condition|)
return|return
name|cb
operator|->
name|validator
argument_list|(
name|cb
operator|->
name|baton
argument_list|,
name|uuid
argument_list|,
name|url
argument_list|)
return|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_relocate2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|from
parameter_list|,
specifier|const
name|char
modifier|*
name|to
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_relocation_validator2_t
name|validator
parameter_list|,
name|void
modifier|*
name|validator_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat2_baton
name|cb
decl_stmt|;
name|cb
operator|.
name|validator
operator|=
name|validator
expr_stmt|;
name|cb
operator|.
name|baton
operator|=
name|validator_baton
expr_stmt|;
return|return
name|svn_wc_relocate3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|from
argument_list|,
name|to
argument_list|,
name|recurse
argument_list|,
name|compat2_validator
argument_list|,
operator|&
name|cb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_relocate
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|from
parameter_list|,
specifier|const
name|char
modifier|*
name|to
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_wc_relocation_validator_t
name|validator
parameter_list|,
name|void
modifier|*
name|validator_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_baton
name|cb
decl_stmt|;
name|cb
operator|.
name|validator
operator|=
name|validator
expr_stmt|;
name|cb
operator|.
name|baton
operator|=
name|validator_baton
expr_stmt|;
return|return
name|svn_wc_relocate3
argument_list|(
name|path
argument_list|,
name|adm_access
argument_list|,
name|from
argument_list|,
name|to
argument_list|,
name|recurse
argument_list|,
name|compat_validator
argument_list|,
operator|&
name|cb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From log.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_cleanup2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_cleanup3
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_cleanup
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|optional_adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_cleanup2
argument_list|(
name|path
argument_list|,
name|diff3_cmd
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From questions.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_has_binary_prop
parameter_list|(
name|svn_boolean_t
modifier|*
name|has_binary_prop
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
specifier|const
name|svn_string_t
modifier|*
name|value
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__internal_propget
argument_list|(
operator|&
name|value
argument_list|,
name|db
argument_list|,
name|local_abspath
argument_list|,
name|SVN_PROP_MIME_TYPE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|&&
operator|(
name|svn_mime_type_is_binary
argument_list|(
name|value
operator|->
name|data
argument_list|)
operator|)
condition|)
operator|*
name|has_binary_prop
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|has_binary_prop
operator|=
name|FALSE
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_conflicted_p2
parameter_list|(
name|svn_boolean_t
modifier|*
name|text_conflicted_p
parameter_list|,
name|svn_boolean_t
modifier|*
name|prop_conflicted_p
parameter_list|,
name|svn_boolean_t
modifier|*
name|tree_conflicted_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_wc_conflicted_p3
argument_list|(
name|text_conflicted_p
argument_list|,
name|prop_conflicted_p
argument_list|,
name|tree_conflicted_p
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_WC_PATH_NOT_FOUND
condition|)
block|{
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|text_conflicted_p
condition|)
operator|*
name|text_conflicted_p
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|prop_conflicted_p
condition|)
operator|*
name|prop_conflicted_p
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|tree_conflicted_p
condition|)
operator|*
name|tree_conflicted_p
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_conflicted_p
parameter_list|(
name|svn_boolean_t
modifier|*
name|text_conflicted_p
parameter_list|,
name|svn_boolean_t
modifier|*
name|prop_conflicted_p
parameter_list|,
specifier|const
name|char
modifier|*
name|dir_path
parameter_list|,
specifier|const
name|svn_wc_entry_t
modifier|*
name|entry
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_node_kind_t
name|kind
decl_stmt|;
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
operator|*
name|text_conflicted_p
operator|=
name|FALSE
expr_stmt|;
operator|*
name|prop_conflicted_p
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|entry
operator|->
name|conflict_old
condition|)
block|{
name|path
operator|=
name|svn_dirent_join
argument_list|(
name|dir_path
argument_list|,
name|entry
operator|->
name|conflict_old
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_io_check_path
argument_list|(
name|path
argument_list|,
operator|&
name|kind
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|text_conflicted_p
operator|=
operator|(
name|kind
operator|==
name|svn_node_file
operator|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|!
operator|*
name|text_conflicted_p
operator|)
operator|&&
operator|(
name|entry
operator|->
name|conflict_new
operator|)
condition|)
block|{
name|path
operator|=
name|svn_dirent_join
argument_list|(
name|dir_path
argument_list|,
name|entry
operator|->
name|conflict_new
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_io_check_path
argument_list|(
name|path
argument_list|,
operator|&
name|kind
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|text_conflicted_p
operator|=
operator|(
name|kind
operator|==
name|svn_node_file
operator|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|!
operator|*
name|text_conflicted_p
operator|)
operator|&&
operator|(
name|entry
operator|->
name|conflict_wrk
operator|)
condition|)
block|{
name|path
operator|=
name|svn_dirent_join
argument_list|(
name|dir_path
argument_list|,
name|entry
operator|->
name|conflict_wrk
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_io_check_path
argument_list|(
name|path
argument_list|,
operator|&
name|kind
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|text_conflicted_p
operator|=
operator|(
name|kind
operator|==
name|svn_node_file
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|entry
operator|->
name|prejfile
condition|)
block|{
name|path
operator|=
name|svn_dirent_join
argument_list|(
name|dir_path
argument_list|,
name|entry
operator|->
name|prejfile
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_io_check_path
argument_list|(
name|path
argument_list|,
operator|&
name|kind
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|prop_conflicted_p
operator|=
operator|(
name|kind
operator|==
name|svn_node_file
operator|)
expr_stmt|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_text_modified_p
parameter_list|(
name|svn_boolean_t
modifier|*
name|modified_p
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|svn_boolean_t
name|force_comparison
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|filename
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_text_modified_p2
argument_list|(
name|modified_p
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|force_comparison
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From copy.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_copy2
parameter_list|(
specifier|const
name|char
modifier|*
name|src
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|dst_parent
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_basename
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|wc_db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|dst_parent
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|src_abspath
decl_stmt|;
specifier|const
name|char
modifier|*
name|dst_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|wc_db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|src_abspath
argument_list|,
name|src
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|dst_abspath
operator|=
name|svn_dirent_join
argument_list|(
name|svn_wc__adm_access_abspath
argument_list|(
name|dst_parent
argument_list|)
argument_list|,
name|dst_basename
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_copy3
argument_list|(
name|wc_ctx
argument_list|,
name|src_abspath
argument_list|,
name|dst_abspath
argument_list|,
name|FALSE
comment|/* metadata_only */
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_copy
parameter_list|(
specifier|const
name|char
modifier|*
name|src_path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|dst_parent
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_basename
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|compat_notify_baton_t
name|nb
decl_stmt|;
name|nb
operator|.
name|func
operator|=
name|notify_func
expr_stmt|;
name|nb
operator|.
name|baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_wc_copy2
argument_list|(
name|src_path
argument_list|,
name|dst_parent
argument_list|,
name|dst_basename
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|compat_call_notify_func
argument_list|,
operator|&
name|nb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From merge.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge4
parameter_list|(
name|enum
name|svn_wc_merge_outcome_t
modifier|*
name|merge_outcome
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|left_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|right_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|target_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|left_label
parameter_list|,
specifier|const
name|char
modifier|*
name|right_label
parameter_list|,
specifier|const
name|char
modifier|*
name|target_label
parameter_list|,
specifier|const
name|svn_wc_conflict_version_t
modifier|*
name|left_version
parameter_list|,
specifier|const
name|svn_wc_conflict_version_t
modifier|*
name|right_version
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|prop_diff
parameter_list|,
name|svn_wc_conflict_resolver_func2_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_merge5
argument_list|(
name|merge_outcome
argument_list|,
name|NULL
comment|/* merge_props_outcome */
argument_list|,
name|wc_ctx
argument_list|,
name|left_abspath
argument_list|,
name|right_abspath
argument_list|,
name|target_abspath
argument_list|,
name|left_label
argument_list|,
name|right_label
argument_list|,
name|target_label
argument_list|,
name|left_version
argument_list|,
name|right_version
argument_list|,
name|dry_run
argument_list|,
name|diff3_cmd
argument_list|,
name|merge_options
argument_list|,
name|NULL
comment|/* original_props */
argument_list|,
name|prop_diff
argument_list|,
name|conflict_func
argument_list|,
name|conflict_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge3
parameter_list|(
name|enum
name|svn_wc_merge_outcome_t
modifier|*
name|merge_outcome
parameter_list|,
specifier|const
name|char
modifier|*
name|left
parameter_list|,
specifier|const
name|char
modifier|*
name|right
parameter_list|,
specifier|const
name|char
modifier|*
name|merge_target
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|left_label
parameter_list|,
specifier|const
name|char
modifier|*
name|right_label
parameter_list|,
specifier|const
name|char
modifier|*
name|target_label
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|prop_diff
parameter_list|,
name|svn_wc_conflict_resolver_func_t
name|conflict_func
parameter_list|,
name|void
modifier|*
name|conflict_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|adm_access
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|left_abspath
decl_stmt|,
modifier|*
name|right_abspath
decl_stmt|,
modifier|*
name|target_abspath
decl_stmt|;
name|struct
name|conflict_func_1to2_baton
name|cfw
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|left_abspath
argument_list|,
name|left
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|right_abspath
argument_list|,
name|right
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|target_abspath
argument_list|,
name|merge_target
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|cfw
operator|.
name|inner_func
operator|=
name|conflict_func
expr_stmt|;
name|cfw
operator|.
name|inner_baton
operator|=
name|conflict_baton
expr_stmt|;
if|if
condition|(
name|diff3_cmd
condition|)
name|SVN_ERR
argument_list|(
name|svn_path_cstring_to_utf8
argument_list|(
operator|&
name|diff3_cmd
argument_list|,
name|diff3_cmd
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_merge4
argument_list|(
name|merge_outcome
argument_list|,
name|wc_ctx
argument_list|,
name|left_abspath
argument_list|,
name|right_abspath
argument_list|,
name|target_abspath
argument_list|,
name|left_label
argument_list|,
name|right_label
argument_list|,
name|target_label
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|dry_run
argument_list|,
name|diff3_cmd
argument_list|,
name|merge_options
argument_list|,
name|prop_diff
argument_list|,
name|conflict_func
condition|?
name|conflict_func_1to2_wrapper
else|:
name|NULL
argument_list|,
operator|&
name|cfw
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge2
parameter_list|(
name|enum
name|svn_wc_merge_outcome_t
modifier|*
name|merge_outcome
parameter_list|,
specifier|const
name|char
modifier|*
name|left
parameter_list|,
specifier|const
name|char
modifier|*
name|right
parameter_list|,
specifier|const
name|char
modifier|*
name|merge_target
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|left_label
parameter_list|,
specifier|const
name|char
modifier|*
name|right_label
parameter_list|,
specifier|const
name|char
modifier|*
name|target_label
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|merge_options
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_merge3
argument_list|(
name|merge_outcome
argument_list|,
name|left
argument_list|,
name|right
argument_list|,
name|merge_target
argument_list|,
name|adm_access
argument_list|,
name|left_label
argument_list|,
name|right_label
argument_list|,
name|target_label
argument_list|,
name|dry_run
argument_list|,
name|diff3_cmd
argument_list|,
name|merge_options
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_merge
parameter_list|(
specifier|const
name|char
modifier|*
name|left
parameter_list|,
specifier|const
name|char
modifier|*
name|right
parameter_list|,
specifier|const
name|char
modifier|*
name|merge_target
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
specifier|const
name|char
modifier|*
name|left_label
parameter_list|,
specifier|const
name|char
modifier|*
name|right_label
parameter_list|,
specifier|const
name|char
modifier|*
name|target_label
parameter_list|,
name|svn_boolean_t
name|dry_run
parameter_list|,
name|enum
name|svn_wc_merge_outcome_t
modifier|*
name|merge_outcome
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_merge3
argument_list|(
name|merge_outcome
argument_list|,
name|left
argument_list|,
name|right
argument_list|,
name|merge_target
argument_list|,
name|adm_access
argument_list|,
name|left_label
argument_list|,
name|right_label
argument_list|,
name|target_label
argument_list|,
name|dry_run
argument_list|,
name|diff3_cmd
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From util.c ***/
end_comment

begin_function
name|svn_wc_conflict_version_t
modifier|*
name|svn_wc_conflict_version_create
parameter_list|(
specifier|const
name|char
modifier|*
name|repos_url
parameter_list|,
specifier|const
name|char
modifier|*
name|path_in_repos
parameter_list|,
name|svn_revnum_t
name|peg_rev
parameter_list|,
name|svn_node_kind_t
name|node_kind
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_wc_conflict_version_create2
argument_list|(
name|repos_url
argument_list|,
name|NULL
argument_list|,
name|path_in_repos
argument_list|,
name|peg_rev
argument_list|,
name|node_kind
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_wc_conflict_description_t
modifier|*
name|svn_wc_conflict_description_create_text
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_conflict_description_t
modifier|*
name|conflict
decl_stmt|;
name|conflict
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|conflict
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|->
name|path
operator|=
name|path
expr_stmt|;
name|conflict
operator|->
name|node_kind
operator|=
name|svn_node_file
expr_stmt|;
name|conflict
operator|->
name|kind
operator|=
name|svn_wc_conflict_kind_text
expr_stmt|;
name|conflict
operator|->
name|access
operator|=
name|adm_access
expr_stmt|;
name|conflict
operator|->
name|action
operator|=
name|svn_wc_conflict_action_edit
expr_stmt|;
name|conflict
operator|->
name|reason
operator|=
name|svn_wc_conflict_reason_edited
expr_stmt|;
return|return
name|conflict
return|;
block|}
end_function

begin_function
name|svn_wc_conflict_description_t
modifier|*
name|svn_wc_conflict_description_create_prop
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_node_kind_t
name|node_kind
parameter_list|,
specifier|const
name|char
modifier|*
name|property_name
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_conflict_description_t
modifier|*
name|conflict
decl_stmt|;
name|conflict
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|conflict
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|->
name|path
operator|=
name|path
expr_stmt|;
name|conflict
operator|->
name|node_kind
operator|=
name|node_kind
expr_stmt|;
name|conflict
operator|->
name|kind
operator|=
name|svn_wc_conflict_kind_property
expr_stmt|;
name|conflict
operator|->
name|access
operator|=
name|adm_access
expr_stmt|;
name|conflict
operator|->
name|property_name
operator|=
name|property_name
expr_stmt|;
return|return
name|conflict
return|;
block|}
end_function

begin_function
name|svn_wc_conflict_description_t
modifier|*
name|svn_wc_conflict_description_create_tree
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_wc_adm_access_t
modifier|*
name|adm_access
parameter_list|,
name|svn_node_kind_t
name|node_kind
parameter_list|,
name|svn_wc_operation_t
name|operation
parameter_list|,
name|svn_wc_conflict_version_t
modifier|*
name|src_left_version
parameter_list|,
name|svn_wc_conflict_version_t
modifier|*
name|src_right_version
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_conflict_description_t
modifier|*
name|conflict
decl_stmt|;
name|conflict
operator|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|conflict
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|->
name|path
operator|=
name|path
expr_stmt|;
name|conflict
operator|->
name|node_kind
operator|=
name|node_kind
expr_stmt|;
name|conflict
operator|->
name|kind
operator|=
name|svn_wc_conflict_kind_tree
expr_stmt|;
name|conflict
operator|->
name|access
operator|=
name|adm_access
expr_stmt|;
name|conflict
operator|->
name|operation
operator|=
name|operation
expr_stmt|;
name|conflict
operator|->
name|src_left_version
operator|=
name|src_left_version
expr_stmt|;
name|conflict
operator|->
name|src_right_version
operator|=
name|src_right_version
expr_stmt|;
return|return
name|conflict
return|;
block|}
end_function

begin_comment
comment|/*** From revision_status.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_revision_status
parameter_list|(
name|svn_wc_revision_status_t
modifier|*
modifier|*
name|result_p
parameter_list|,
specifier|const
name|char
modifier|*
name|wc_path
parameter_list|,
specifier|const
name|char
modifier|*
name|trail_url
parameter_list|,
name|svn_boolean_t
name|committed
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|local_abspath
argument_list|,
name|wc_path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_context_create
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
comment|/* config */
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc_revision_status2
argument_list|(
name|result_p
argument_list|,
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|trail_url
argument_list|,
name|committed
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From crop.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_wc_crop_tree
parameter_list|(
name|svn_wc_adm_access_t
modifier|*
name|anchor
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_wc_context_t
modifier|*
name|wc_ctx
decl_stmt|;
name|svn_wc__db_t
modifier|*
name|db
init|=
name|svn_wc__adm_get_db
argument_list|(
name|anchor
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|local_abspath
decl_stmt|;
name|local_abspath
operator|=
name|svn_dirent_join
argument_list|(
name|svn_wc__adm_access_abspath
argument_list|(
name|anchor
argument_list|)
argument_list|,
name|target
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_wc__context_create_with_db
argument_list|(
operator|&
name|wc_ctx
argument_list|,
name|NULL
argument_list|,
name|db
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|depth
operator|==
name|svn_depth_exclude
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_wc_exclude
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SVN_ERR
argument_list|(
name|svn_wc_crop_tree2
argument_list|(
name|wc_ctx
argument_list|,
name|local_abspath
argument_list|,
name|depth
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_context_destroy
argument_list|(
name|wc_ctx
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_move
parameter_list|(
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|src_abspath
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_abspath
parameter_list|,
name|svn_boolean_t
name|metadata_only
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|svn_wc_notify_func2_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc__move2
argument_list|(
name|wc_ctx
argument_list|,
name|src_abspath
argument_list|,
name|dst_abspath
argument_list|,
name|metadata_only
argument_list|,
name|TRUE
argument_list|,
comment|/* allow_mixed_revisions */
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_wc_read_kind
parameter_list|(
name|svn_node_kind_t
modifier|*
name|kind
parameter_list|,
name|svn_wc_context_t
modifier|*
name|wc_ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|abspath
parameter_list|,
name|svn_boolean_t
name|show_hidden
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_wc_read_kind2
argument_list|(
name|kind
argument_list|,
name|wc_ctx
argument_list|,
name|abspath
argument_list|,
name|TRUE
comment|/* show_deleted */
argument_list|,
name|show_hidden
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
comment|/*if (db_kind == svn_node_dir)     *kind = svn_node_dir;   else if (db_kind == svn_node_file || db_kind == svn_node_symlink)     *kind = svn_node_file;   else     *kind = svn_node_none;*/
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

end_unit

