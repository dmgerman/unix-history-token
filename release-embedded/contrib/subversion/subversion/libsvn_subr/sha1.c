begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * sha1.c: SHA1 checksum routines  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_include
include|#
directive|include
file|<apr_sha1.h>
end_include

begin_include
include|#
directive|include
file|"sha1.h"
end_include

begin_escape
end_escape

begin_comment
comment|/* The SHA1 digest for the empty string. */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|unsigned
name|char
name|svn_sha1__empty_string_digest_array
index|[]
init|=
block|{
literal|0xda
block|,
literal|0x39
block|,
literal|0xa3
block|,
literal|0xee
block|,
literal|0x5e
block|,
literal|0x6b
block|,
literal|0x4b
block|,
literal|0x0d
block|,
literal|0x32
block|,
literal|0x55
block|,
literal|0xbf
block|,
literal|0xef
block|,
literal|0x95
block|,
literal|0x60
block|,
literal|0x18
block|,
literal|0x90
block|,
literal|0xaf
block|,
literal|0xd8
block|,
literal|0x07
block|,
literal|0x09
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|const
name|unsigned
name|char
modifier|*
name|svn_sha1__empty_string_digest
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|svn_sha1__empty_string_digest_array
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_sha1__digest_to_cstring_display
parameter_list|(
specifier|const
name|unsigned
name|char
name|digest
index|[]
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|hex
init|=
literal|"0123456789abcdef"
decl_stmt|;
name|char
modifier|*
name|str
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
operator|(
name|APR_SHA1_DIGESTSIZE
operator|*
literal|2
operator|)
operator|+
literal|1
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|APR_SHA1_DIGESTSIZE
condition|;
name|i
operator|++
control|)
block|{
name|str
index|[
name|i
operator|*
literal|2
index|]
operator|=
name|hex
index|[
name|digest
index|[
name|i
index|]
operator|>>
literal|4
index|]
expr_stmt|;
name|str
index|[
name|i
operator|*
literal|2
operator|+
literal|1
index|]
operator|=
name|hex
index|[
name|digest
index|[
name|i
index|]
operator|&
literal|0x0f
index|]
expr_stmt|;
block|}
name|str
index|[
name|i
operator|*
literal|2
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_sha1__digest_to_cstring
parameter_list|(
specifier|const
name|unsigned
name|char
name|digest
index|[]
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|static
specifier|const
name|unsigned
name|char
name|zeros_digest
index|[
name|APR_SHA1_DIGESTSIZE
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|digest
argument_list|,
name|zeros_digest
argument_list|,
name|APR_SHA1_DIGESTSIZE
argument_list|)
operator|!=
literal|0
condition|)
return|return
name|svn_sha1__digest_to_cstring_display
argument_list|(
name|digest
argument_list|,
name|pool
argument_list|)
return|;
else|else
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|svn_boolean_t
name|svn_sha1__digests_match
parameter_list|(
specifier|const
name|unsigned
name|char
name|d1
index|[]
parameter_list|,
specifier|const
name|unsigned
name|char
name|d2
index|[]
parameter_list|)
block|{
specifier|static
specifier|const
name|unsigned
name|char
name|zeros
index|[
name|APR_SHA1_DIGESTSIZE
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
return|return
operator|(
operator|(
name|memcmp
argument_list|(
name|d1
argument_list|,
name|zeros
argument_list|,
name|APR_SHA1_DIGESTSIZE
argument_list|)
operator|==
literal|0
operator|)
operator|||
operator|(
name|memcmp
argument_list|(
name|d2
argument_list|,
name|zeros
argument_list|,
name|APR_SHA1_DIGESTSIZE
argument_list|)
operator|==
literal|0
operator|)
operator|||
operator|(
name|memcmp
argument_list|(
name|d1
argument_list|,
name|d2
argument_list|,
name|APR_SHA1_DIGESTSIZE
argument_list|)
operator|==
literal|0
operator|)
operator|)
return|;
block|}
end_function

end_unit

