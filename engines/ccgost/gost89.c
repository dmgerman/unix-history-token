begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**********************************************************************  *                        gost89.c                                    *  *             Copyright (c) 2005-2006 Cryptocom LTD                  *  *         This file is distributed under the same license as OpenSSL *  *                                                                    *  *          Implementation of GOST 28147-89 encryption algorithm      *  *            No OpenSSL libraries required to compile and use        *  *                              this code                             *  **********************************************************************/
end_comment

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"gost89.h"
end_include

begin_comment
comment|/* Substitution blocks from RFC 4357         Note: our implementation of gost 28147-89 algorithm     uses S-box matrix rotated 90 degrees counterclockwise, relative to     examples given in RFC.     */
end_comment

begin_comment
comment|/* Substitution blocks from test examples for GOST R 34.11-94*/
end_comment

begin_decl_stmt
name|gost_subst_block
name|GostR3411_94_TestParamSet
init|=
block|{
block|{
literal|0X1
block|,
literal|0XF
block|,
literal|0XD
block|,
literal|0X0
block|,
literal|0X5
block|,
literal|0X7
block|,
literal|0XA
block|,
literal|0X4
block|,
literal|0X9
block|,
literal|0X2
block|,
literal|0X3
block|,
literal|0XE
block|,
literal|0X6
block|,
literal|0XB
block|,
literal|0X8
block|,
literal|0XC
block|}
block|,
block|{
literal|0XD
block|,
literal|0XB
block|,
literal|0X4
block|,
literal|0X1
block|,
literal|0X3
block|,
literal|0XF
block|,
literal|0X5
block|,
literal|0X9
block|,
literal|0X0
block|,
literal|0XA
block|,
literal|0XE
block|,
literal|0X7
block|,
literal|0X6
block|,
literal|0X8
block|,
literal|0X2
block|,
literal|0XC
block|}
block|,
block|{
literal|0X4
block|,
literal|0XB
block|,
literal|0XA
block|,
literal|0X0
block|,
literal|0X7
block|,
literal|0X2
block|,
literal|0X1
block|,
literal|0XD
block|,
literal|0X3
block|,
literal|0X6
block|,
literal|0X8
block|,
literal|0X5
block|,
literal|0X9
block|,
literal|0XC
block|,
literal|0XF
block|,
literal|0XE
block|}
block|,
block|{
literal|0X6
block|,
literal|0XC
block|,
literal|0X7
block|,
literal|0X1
block|,
literal|0X5
block|,
literal|0XF
block|,
literal|0XD
block|,
literal|0X8
block|,
literal|0X4
block|,
literal|0XA
block|,
literal|0X9
block|,
literal|0XE
block|,
literal|0X0
block|,
literal|0X3
block|,
literal|0XB
block|,
literal|0X2
block|}
block|,
block|{
literal|0X7
block|,
literal|0XD
block|,
literal|0XA
block|,
literal|0X1
block|,
literal|0X0
block|,
literal|0X8
block|,
literal|0X9
block|,
literal|0XF
block|,
literal|0XE
block|,
literal|0X4
block|,
literal|0X6
block|,
literal|0XC
block|,
literal|0XB
block|,
literal|0X2
block|,
literal|0X5
block|,
literal|0X3
block|}
block|,
block|{
literal|0X5
block|,
literal|0X8
block|,
literal|0X1
block|,
literal|0XD
block|,
literal|0XA
block|,
literal|0X3
block|,
literal|0X4
block|,
literal|0X2
block|,
literal|0XE
block|,
literal|0XF
block|,
literal|0XC
block|,
literal|0X7
block|,
literal|0X6
block|,
literal|0X0
block|,
literal|0X9
block|,
literal|0XB
block|}
block|,
block|{
literal|0XE
block|,
literal|0XB
block|,
literal|0X4
block|,
literal|0XC
block|,
literal|0X6
block|,
literal|0XD
block|,
literal|0XF
block|,
literal|0XA
block|,
literal|0X2
block|,
literal|0X3
block|,
literal|0X8
block|,
literal|0X1
block|,
literal|0X0
block|,
literal|0X7
block|,
literal|0X5
block|,
literal|0X9
block|}
block|,
block|{
literal|0X4
block|,
literal|0XA
block|,
literal|0X9
block|,
literal|0X2
block|,
literal|0XD
block|,
literal|0X8
block|,
literal|0X0
block|,
literal|0XE
block|,
literal|0X6
block|,
literal|0XB
block|,
literal|0X1
block|,
literal|0XC
block|,
literal|0X7
block|,
literal|0XF
block|,
literal|0X5
block|,
literal|0X3
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Substitution blocks for hash function 1.2.643.2.9.1.6.1  */
end_comment

begin_decl_stmt
name|gost_subst_block
name|GostR3411_94_CryptoProParamSet
init|=
block|{
block|{
literal|0x1
block|,
literal|0x3
block|,
literal|0xA
block|,
literal|0x9
block|,
literal|0x5
block|,
literal|0xB
block|,
literal|0x4
block|,
literal|0xF
block|,
literal|0x8
block|,
literal|0x6
block|,
literal|0x7
block|,
literal|0xE
block|,
literal|0xD
block|,
literal|0x0
block|,
literal|0x2
block|,
literal|0xC
block|}
block|,
block|{
literal|0xD
block|,
literal|0xE
block|,
literal|0x4
block|,
literal|0x1
block|,
literal|0x7
block|,
literal|0x0
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0x3
block|,
literal|0xC
block|,
literal|0x8
block|,
literal|0xF
block|,
literal|0x6
block|,
literal|0x2
block|,
literal|0x9
block|,
literal|0xB
block|}
block|,
block|{
literal|0x7
block|,
literal|0x6
block|,
literal|0x2
block|,
literal|0x4
block|,
literal|0xD
block|,
literal|0x9
block|,
literal|0xF
block|,
literal|0x0
block|,
literal|0xA
block|,
literal|0x1
block|,
literal|0x5
block|,
literal|0xB
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0xC
block|,
literal|0x3
block|}
block|,
block|{
literal|0x7
block|,
literal|0x6
block|,
literal|0x4
block|,
literal|0xB
block|,
literal|0x9
block|,
literal|0xC
block|,
literal|0x2
block|,
literal|0xA
block|,
literal|0x1
block|,
literal|0x8
block|,
literal|0x0
block|,
literal|0xE
block|,
literal|0xF
block|,
literal|0xD
block|,
literal|0x3
block|,
literal|0x5
block|}
block|,
block|{
literal|0x4
block|,
literal|0xA
block|,
literal|0x7
block|,
literal|0xC
block|,
literal|0x0
block|,
literal|0xF
block|,
literal|0x2
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0x1
block|,
literal|0x6
block|,
literal|0x5
block|,
literal|0xD
block|,
literal|0xB
block|,
literal|0x9
block|,
literal|0x3
block|}
block|,
block|{
literal|0x7
block|,
literal|0xF
block|,
literal|0xC
block|,
literal|0xE
block|,
literal|0x9
block|,
literal|0x4
block|,
literal|0x1
block|,
literal|0x0
block|,
literal|0x3
block|,
literal|0xB
block|,
literal|0x5
block|,
literal|0x2
block|,
literal|0x6
block|,
literal|0xA
block|,
literal|0x8
block|,
literal|0xD
block|}
block|,
block|{
literal|0x5
block|,
literal|0xF
block|,
literal|0x4
block|,
literal|0x0
block|,
literal|0x2
block|,
literal|0xD
block|,
literal|0xB
block|,
literal|0x9
block|,
literal|0x1
block|,
literal|0x7
block|,
literal|0x6
block|,
literal|0x3
block|,
literal|0xC
block|,
literal|0xE
block|,
literal|0xA
block|,
literal|0x8
block|}
block|,
block|{
literal|0xA
block|,
literal|0x4
block|,
literal|0x5
block|,
literal|0x6
block|,
literal|0x8
block|,
literal|0x1
block|,
literal|0x3
block|,
literal|0x7
block|,
literal|0xD
block|,
literal|0xC
block|,
literal|0xE
block|,
literal|0x0
block|,
literal|0x9
block|,
literal|0x2
block|,
literal|0xB
block|,
literal|0xF
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Test paramset from GOST 28147 */
end_comment

begin_decl_stmt
name|gost_subst_block
name|Gost28147_TestParamSet
init|=
block|{
block|{
literal|0xC
block|,
literal|0x6
block|,
literal|0x5
block|,
literal|0x2
block|,
literal|0xB
block|,
literal|0x0
block|,
literal|0x9
block|,
literal|0xD
block|,
literal|0x3
block|,
literal|0xE
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0xF
block|,
literal|0x4
block|,
literal|0x1
block|,
literal|0x8
block|}
block|,
block|{
literal|0x9
block|,
literal|0xB
block|,
literal|0xC
block|,
literal|0x0
block|,
literal|0x3
block|,
literal|0x6
block|,
literal|0x7
block|,
literal|0x5
block|,
literal|0x4
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0xF
block|,
literal|0x1
block|,
literal|0xA
block|,
literal|0x2
block|,
literal|0xD
block|}
block|,
block|{
literal|0x8
block|,
literal|0xF
block|,
literal|0x6
block|,
literal|0xB
block|,
literal|0x1
block|,
literal|0x9
block|,
literal|0xC
block|,
literal|0x5
block|,
literal|0xD
block|,
literal|0x3
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0x0
block|,
literal|0xE
block|,
literal|0x2
block|,
literal|0x4
block|}
block|,
block|{
literal|0x3
block|,
literal|0xE
block|,
literal|0x5
block|,
literal|0x9
block|,
literal|0x6
block|,
literal|0x8
block|,
literal|0x0
block|,
literal|0xD
block|,
literal|0xA
block|,
literal|0xB
block|,
literal|0x7
block|,
literal|0xC
block|,
literal|0x2
block|,
literal|0x1
block|,
literal|0xF
block|,
literal|0x4
block|}
block|,
block|{
literal|0xE
block|,
literal|0x9
block|,
literal|0xB
block|,
literal|0x2
block|,
literal|0x5
block|,
literal|0xF
block|,
literal|0x7
block|,
literal|0x1
block|,
literal|0x0
block|,
literal|0xD
block|,
literal|0xC
block|,
literal|0x6
block|,
literal|0xA
block|,
literal|0x4
block|,
literal|0x3
block|,
literal|0x8
block|}
block|,
block|{
literal|0xD
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0xC
block|,
literal|0x7
block|,
literal|0x3
block|,
literal|0x9
block|,
literal|0xA
block|,
literal|0x1
block|,
literal|0x5
block|,
literal|0x2
block|,
literal|0x4
block|,
literal|0x6
block|,
literal|0xF
block|,
literal|0x0
block|,
literal|0xB
block|}
block|,
block|{
literal|0xC
block|,
literal|0x9
block|,
literal|0xF
block|,
literal|0xE
block|,
literal|0x8
block|,
literal|0x1
block|,
literal|0x3
block|,
literal|0xA
block|,
literal|0x2
block|,
literal|0x7
block|,
literal|0x4
block|,
literal|0xD
block|,
literal|0x6
block|,
literal|0x0
block|,
literal|0xB
block|,
literal|0x5
block|}
block|,
block|{
literal|0x4
block|,
literal|0x2
block|,
literal|0xF
block|,
literal|0x5
block|,
literal|0x9
block|,
literal|0x1
block|,
literal|0x0
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0x3
block|,
literal|0xB
block|,
literal|0xC
block|,
literal|0xD
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0x6
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 1.2.643.2.2.31.1 */
end_comment

begin_decl_stmt
name|gost_subst_block
name|Gost28147_CryptoProParamSetA
init|=
block|{
block|{
literal|0xB
block|,
literal|0xA
block|,
literal|0xF
block|,
literal|0x5
block|,
literal|0x0
block|,
literal|0xC
block|,
literal|0xE
block|,
literal|0x8
block|,
literal|0x6
block|,
literal|0x2
block|,
literal|0x3
block|,
literal|0x9
block|,
literal|0x1
block|,
literal|0x7
block|,
literal|0xD
block|,
literal|0x4
block|}
block|,
block|{
literal|0x1
block|,
literal|0xD
block|,
literal|0x2
block|,
literal|0x9
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0x6
block|,
literal|0x0
block|,
literal|0x8
block|,
literal|0xC
block|,
literal|0x4
block|,
literal|0x5
block|,
literal|0xF
block|,
literal|0x3
block|,
literal|0xB
block|,
literal|0xE
block|}
block|,
block|{
literal|0x3
block|,
literal|0xA
block|,
literal|0xD
block|,
literal|0xC
block|,
literal|0x1
block|,
literal|0x2
block|,
literal|0x0
block|,
literal|0xB
block|,
literal|0x7
block|,
literal|0x5
block|,
literal|0x9
block|,
literal|0x4
block|,
literal|0x8
block|,
literal|0xF
block|,
literal|0xE
block|,
literal|0x6
block|}
block|,
block|{
literal|0xB
block|,
literal|0x5
block|,
literal|0x1
block|,
literal|0x9
block|,
literal|0x8
block|,
literal|0xD
block|,
literal|0xF
block|,
literal|0x0
block|,
literal|0xE
block|,
literal|0x4
block|,
literal|0x2
block|,
literal|0x3
block|,
literal|0xC
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0x6
block|}
block|,
block|{
literal|0xE
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0xC
block|,
literal|0xD
block|,
literal|0x1
block|,
literal|0x3
block|,
literal|0x9
block|,
literal|0x0
block|,
literal|0x2
block|,
literal|0xB
block|,
literal|0x4
block|,
literal|0xF
block|,
literal|0x8
block|,
literal|0x5
block|,
literal|0x6
block|}
block|,
block|{
literal|0xE
block|,
literal|0x4
block|,
literal|0x6
block|,
literal|0x2
block|,
literal|0xB
block|,
literal|0x3
block|,
literal|0xD
block|,
literal|0x8
block|,
literal|0xC
block|,
literal|0xF
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0x0
block|,
literal|0x7
block|,
literal|0x1
block|,
literal|0x9
block|}
block|,
block|{
literal|0x3
block|,
literal|0x7
block|,
literal|0xE
block|,
literal|0x9
block|,
literal|0x8
block|,
literal|0xA
block|,
literal|0xF
block|,
literal|0x0
block|,
literal|0x5
block|,
literal|0x2
block|,
literal|0x6
block|,
literal|0xC
block|,
literal|0xB
block|,
literal|0x4
block|,
literal|0xD
block|,
literal|0x1
block|}
block|,
block|{
literal|0x9
block|,
literal|0x6
block|,
literal|0x3
block|,
literal|0x2
block|,
literal|0x8
block|,
literal|0xB
block|,
literal|0x1
block|,
literal|0x7
block|,
literal|0xA
block|,
literal|0x4
block|,
literal|0xE
block|,
literal|0xF
block|,
literal|0xC
block|,
literal|0x0
block|,
literal|0xD
block|,
literal|0x5
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 1.2.643.2.2.31.2 */
end_comment

begin_decl_stmt
name|gost_subst_block
name|Gost28147_CryptoProParamSetB
init|=
block|{
block|{
literal|0x0
block|,
literal|0x4
block|,
literal|0xB
block|,
literal|0xE
block|,
literal|0x8
block|,
literal|0x3
block|,
literal|0x7
block|,
literal|0x1
block|,
literal|0xA
block|,
literal|0x2
block|,
literal|0x9
block|,
literal|0x6
block|,
literal|0xF
block|,
literal|0xD
block|,
literal|0x5
block|,
literal|0xC
block|}
block|,
block|{
literal|0x5
block|,
literal|0x2
block|,
literal|0xA
block|,
literal|0xB
block|,
literal|0x9
block|,
literal|0x1
block|,
literal|0xC
block|,
literal|0x3
block|,
literal|0x7
block|,
literal|0x4
block|,
literal|0xD
block|,
literal|0x0
block|,
literal|0x6
block|,
literal|0xF
block|,
literal|0x8
block|,
literal|0xE
block|}
block|,
block|{
literal|0x8
block|,
literal|0x3
block|,
literal|0x2
block|,
literal|0x6
block|,
literal|0x4
block|,
literal|0xD
block|,
literal|0xE
block|,
literal|0xB
block|,
literal|0xC
block|,
literal|0x1
block|,
literal|0x7
block|,
literal|0xF
block|,
literal|0xA
block|,
literal|0x0
block|,
literal|0x9
block|,
literal|0x5
block|}
block|,
block|{
literal|0x2
block|,
literal|0x7
block|,
literal|0xC
block|,
literal|0xF
block|,
literal|0x9
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0xB
block|,
literal|0x1
block|,
literal|0x4
block|,
literal|0x0
block|,
literal|0xD
block|,
literal|0x6
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0x3
block|}
block|,
block|{
literal|0x7
block|,
literal|0x5
block|,
literal|0x0
block|,
literal|0xD
block|,
literal|0xB
block|,
literal|0x6
block|,
literal|0x1
block|,
literal|0x2
block|,
literal|0x3
block|,
literal|0xA
block|,
literal|0xC
block|,
literal|0xF
block|,
literal|0x4
block|,
literal|0xE
block|,
literal|0x9
block|,
literal|0x8
block|}
block|,
block|{
literal|0xE
block|,
literal|0xC
block|,
literal|0x0
block|,
literal|0xA
block|,
literal|0x9
block|,
literal|0x2
block|,
literal|0xD
block|,
literal|0xB
block|,
literal|0x7
block|,
literal|0x5
block|,
literal|0x8
block|,
literal|0xF
block|,
literal|0x3
block|,
literal|0x6
block|,
literal|0x1
block|,
literal|0x4
block|}
block|,
block|{
literal|0x0
block|,
literal|0x1
block|,
literal|0x2
block|,
literal|0xA
block|,
literal|0x4
block|,
literal|0xD
block|,
literal|0x5
block|,
literal|0xC
block|,
literal|0x9
block|,
literal|0x7
block|,
literal|0x3
block|,
literal|0xF
block|,
literal|0xB
block|,
literal|0x8
block|,
literal|0x6
block|,
literal|0xE
block|}
block|,
block|{
literal|0x8
block|,
literal|0x4
block|,
literal|0xB
block|,
literal|0x1
block|,
literal|0x3
block|,
literal|0x5
block|,
literal|0x0
block|,
literal|0x9
block|,
literal|0x2
block|,
literal|0xE
block|,
literal|0xA
block|,
literal|0xC
block|,
literal|0xD
block|,
literal|0x6
block|,
literal|0x7
block|,
literal|0xF
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 1.2.643.2.2.31.3 */
end_comment

begin_decl_stmt
name|gost_subst_block
name|Gost28147_CryptoProParamSetC
init|=
block|{
block|{
literal|0x7
block|,
literal|0x4
block|,
literal|0x0
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0x2
block|,
literal|0xF
block|,
literal|0xE
block|,
literal|0xC
block|,
literal|0x6
block|,
literal|0x1
block|,
literal|0xB
block|,
literal|0xD
block|,
literal|0x9
block|,
literal|0x3
block|,
literal|0x8
block|}
block|,
block|{
literal|0xA
block|,
literal|0x9
block|,
literal|0x6
block|,
literal|0x8
block|,
literal|0xD
block|,
literal|0xE
block|,
literal|0x2
block|,
literal|0x0
block|,
literal|0xF
block|,
literal|0x3
block|,
literal|0x5
block|,
literal|0xB
block|,
literal|0x4
block|,
literal|0x1
block|,
literal|0xC
block|,
literal|0x7
block|}
block|,
block|{
literal|0xC
block|,
literal|0x9
block|,
literal|0xB
block|,
literal|0x1
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0x2
block|,
literal|0x4
block|,
literal|0x7
block|,
literal|0x3
block|,
literal|0x6
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0x0
block|,
literal|0xF
block|,
literal|0xD
block|}
block|,
block|{
literal|0x8
block|,
literal|0xD
block|,
literal|0xB
block|,
literal|0x0
block|,
literal|0x4
block|,
literal|0x5
block|,
literal|0x1
block|,
literal|0x2
block|,
literal|0x9
block|,
literal|0x3
block|,
literal|0xC
block|,
literal|0xE
block|,
literal|0x6
block|,
literal|0xF
block|,
literal|0xA
block|,
literal|0x7
block|}
block|,
block|{
literal|0x3
block|,
literal|0x6
block|,
literal|0x0
block|,
literal|0x1
block|,
literal|0x5
block|,
literal|0xD
block|,
literal|0xA
block|,
literal|0x8
block|,
literal|0xB
block|,
literal|0x2
block|,
literal|0x9
block|,
literal|0x7
block|,
literal|0xE
block|,
literal|0xF
block|,
literal|0xC
block|,
literal|0x4
block|}
block|,
block|{
literal|0x8
block|,
literal|0x2
block|,
literal|0x5
block|,
literal|0x0
block|,
literal|0x4
block|,
literal|0x9
block|,
literal|0xF
block|,
literal|0xA
block|,
literal|0x3
block|,
literal|0x7
block|,
literal|0xC
block|,
literal|0xD
block|,
literal|0x6
block|,
literal|0xE
block|,
literal|0x1
block|,
literal|0xB
block|}
block|,
block|{
literal|0x0
block|,
literal|0x1
block|,
literal|0x7
block|,
literal|0xD
block|,
literal|0xB
block|,
literal|0x4
block|,
literal|0x5
block|,
literal|0x2
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0xF
block|,
literal|0xC
block|,
literal|0x9
block|,
literal|0xA
block|,
literal|0x6
block|,
literal|0x3
block|}
block|,
block|{
literal|0x1
block|,
literal|0xB
block|,
literal|0xC
block|,
literal|0x2
block|,
literal|0x9
block|,
literal|0xD
block|,
literal|0x0
block|,
literal|0xF
block|,
literal|0x4
block|,
literal|0x5
block|,
literal|0x8
block|,
literal|0xE
block|,
literal|0xA
block|,
literal|0x7
block|,
literal|0x6
block|,
literal|0x3
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 1.2.643.2.2.31.4 */
end_comment

begin_decl_stmt
name|gost_subst_block
name|Gost28147_CryptoProParamSetD
init|=
block|{
block|{
literal|0x1
block|,
literal|0xA
block|,
literal|0x6
block|,
literal|0x8
block|,
literal|0xF
block|,
literal|0xB
block|,
literal|0x0
block|,
literal|0x4
block|,
literal|0xC
block|,
literal|0x3
block|,
literal|0x5
block|,
literal|0x9
block|,
literal|0x7
block|,
literal|0xD
block|,
literal|0x2
block|,
literal|0xE
block|}
block|,
block|{
literal|0x3
block|,
literal|0x0
block|,
literal|0x6
block|,
literal|0xF
block|,
literal|0x1
block|,
literal|0xE
block|,
literal|0x9
block|,
literal|0x2
block|,
literal|0xD
block|,
literal|0x8
block|,
literal|0xC
block|,
literal|0x4
block|,
literal|0xB
block|,
literal|0xA
block|,
literal|0x5
block|,
literal|0x7
block|}
block|,
block|{
literal|0x8
block|,
literal|0x0
block|,
literal|0xF
block|,
literal|0x3
block|,
literal|0x2
block|,
literal|0x5
block|,
literal|0xE
block|,
literal|0xB
block|,
literal|0x1
block|,
literal|0xA
block|,
literal|0x4
block|,
literal|0x7
block|,
literal|0xC
block|,
literal|0x9
block|,
literal|0xD
block|,
literal|0x6
block|}
block|,
block|{
literal|0x0
block|,
literal|0xC
block|,
literal|0x8
block|,
literal|0x9
block|,
literal|0xD
block|,
literal|0x2
block|,
literal|0xA
block|,
literal|0xB
block|,
literal|0x7
block|,
literal|0x3
block|,
literal|0x6
block|,
literal|0x5
block|,
literal|0x4
block|,
literal|0xE
block|,
literal|0xF
block|,
literal|0x1
block|}
block|,
block|{
literal|0x1
block|,
literal|0x5
block|,
literal|0xE
block|,
literal|0xC
block|,
literal|0xA
block|,
literal|0x7
block|,
literal|0x0
block|,
literal|0xD
block|,
literal|0x6
block|,
literal|0x2
block|,
literal|0xB
block|,
literal|0x4
block|,
literal|0x9
block|,
literal|0x3
block|,
literal|0xF
block|,
literal|0x8
block|}
block|,
block|{
literal|0x1
block|,
literal|0xC
block|,
literal|0xB
block|,
literal|0x0
block|,
literal|0xF
block|,
literal|0xE
block|,
literal|0x6
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0xD
block|,
literal|0x4
block|,
literal|0x8
block|,
literal|0x9
block|,
literal|0x3
block|,
literal|0x7
block|,
literal|0x2
block|}
block|,
block|{
literal|0xB
block|,
literal|0x6
block|,
literal|0x3
block|,
literal|0x4
block|,
literal|0xC
block|,
literal|0xF
block|,
literal|0xE
block|,
literal|0x2
block|,
literal|0x7
block|,
literal|0xD
block|,
literal|0x8
block|,
literal|0x0
block|,
literal|0x5
block|,
literal|0xA
block|,
literal|0x9
block|,
literal|0x1
block|}
block|,
block|{
literal|0xF
block|,
literal|0xC
block|,
literal|0x2
block|,
literal|0xA
block|,
literal|0x6
block|,
literal|0x4
block|,
literal|0x5
block|,
literal|0x0
block|,
literal|0x7
block|,
literal|0x9
block|,
literal|0xE
block|,
literal|0xD
block|,
literal|0x1
block|,
literal|0xB
block|,
literal|0x8
block|,
literal|0x3
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|byte
name|CryptoProKeyMeshingKey
index|[]
init|=
block|{
literal|0x69
block|,
literal|0x00
block|,
literal|0x72
block|,
literal|0x22
block|,
literal|0x64
block|,
literal|0xC9
block|,
literal|0x04
block|,
literal|0x23
block|,
literal|0x8D
block|,
literal|0x3A
block|,
literal|0xDB
block|,
literal|0x96
block|,
literal|0x46
block|,
literal|0xE9
block|,
literal|0x2A
block|,
literal|0xC4
block|,
literal|0x18
block|,
literal|0xFE
block|,
literal|0xAC
block|,
literal|0x94
block|,
literal|0x00
block|,
literal|0xED
block|,
literal|0x07
block|,
literal|0x12
block|,
literal|0xC0
block|,
literal|0x86
block|,
literal|0xDC
block|,
literal|0xC2
block|,
literal|0xEF
block|,
literal|0x4C
block|,
literal|0xA9
block|,
literal|0x2B
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Initialization of gost_ctx subst blocks*/
end_comment

begin_function
specifier|static
name|void
name|kboxinit
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|gost_subst_block
modifier|*
name|b
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|->
name|k87
index|[
name|i
index|]
operator|=
operator|(
name|b
operator|->
name|k8
index|[
name|i
operator|>>
literal|4
index|]
operator|<<
literal|4
operator||
name|b
operator|->
name|k7
index|[
name|i
operator|&
literal|15
index|]
operator|)
operator|<<
literal|24
expr_stmt|;
name|c
operator|->
name|k65
index|[
name|i
index|]
operator|=
operator|(
name|b
operator|->
name|k6
index|[
name|i
operator|>>
literal|4
index|]
operator|<<
literal|4
operator||
name|b
operator|->
name|k5
index|[
name|i
operator|&
literal|15
index|]
operator|)
operator|<<
literal|16
expr_stmt|;
name|c
operator|->
name|k43
index|[
name|i
index|]
operator|=
operator|(
name|b
operator|->
name|k4
index|[
name|i
operator|>>
literal|4
index|]
operator|<<
literal|4
operator||
name|b
operator|->
name|k3
index|[
name|i
operator|&
literal|15
index|]
operator|)
operator|<<
literal|8
expr_stmt|;
name|c
operator|->
name|k21
index|[
name|i
index|]
operator|=
name|b
operator|->
name|k2
index|[
name|i
operator|>>
literal|4
index|]
operator|<<
literal|4
operator||
name|b
operator|->
name|k1
index|[
name|i
operator|&
literal|15
index|]
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Part of GOST 28147 algorithm moved into separate function */
end_comment

begin_function
specifier|static
name|word32
name|f
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
name|word32
name|x
parameter_list|)
block|{
name|x
operator|=
name|c
operator|->
name|k87
index|[
name|x
operator|>>
literal|24
operator|&
literal|255
index|]
operator||
name|c
operator|->
name|k65
index|[
name|x
operator|>>
literal|16
operator|&
literal|255
index|]
operator||
name|c
operator|->
name|k43
index|[
name|x
operator|>>
literal|8
operator|&
literal|255
index|]
operator||
name|c
operator|->
name|k21
index|[
name|x
operator|&
literal|255
index|]
expr_stmt|;
comment|/* Rotate left 11 bits */
return|return
name|x
operator|<<
literal|11
operator||
name|x
operator|>>
operator|(
literal|32
operator|-
literal|11
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Low-level encryption routine - encrypts one 64 bit block*/
end_comment

begin_function
name|void
name|gostcrypt
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|byte
modifier|*
name|in
parameter_list|,
name|byte
modifier|*
name|out
parameter_list|)
block|{
specifier|register
name|word32
name|n1
decl_stmt|,
name|n2
decl_stmt|;
comment|/* As named in the GOST */
name|n1
operator|=
name|in
index|[
literal|0
index|]
operator||
operator|(
name|in
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|in
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|in
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
name|n2
operator|=
name|in
index|[
literal|4
index|]
operator||
operator|(
name|in
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|in
index|[
literal|6
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|in
index|[
literal|7
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
comment|/* Instead of swapping halves, swap names each round */
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|out
index|[
literal|0
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n2
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|1
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n2
operator|>>
literal|8
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|2
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n2
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|3
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n2
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|out
index|[
literal|4
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n1
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|5
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n1
operator|>>
literal|8
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|6
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n1
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|7
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n1
operator|>>
literal|24
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Low-level decryption routine. Decrypts one 64-bit block */
end_comment

begin_function
name|void
name|gostdecrypt
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|byte
modifier|*
name|in
parameter_list|,
name|byte
modifier|*
name|out
parameter_list|)
block|{
specifier|register
name|word32
name|n1
decl_stmt|,
name|n2
decl_stmt|;
comment|/* As named in the GOST */
name|n1
operator|=
name|in
index|[
literal|0
index|]
operator||
operator|(
name|in
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|in
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|in
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
name|n2
operator|=
name|in
index|[
literal|4
index|]
operator||
operator|(
name|in
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|in
index|[
literal|6
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|in
index|[
literal|7
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|out
index|[
literal|0
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n2
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|1
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n2
operator|>>
literal|8
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|2
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n2
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|3
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n2
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|out
index|[
literal|4
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n1
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|5
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n1
operator|>>
literal|8
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|6
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n1
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|out
index|[
literal|7
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n1
operator|>>
literal|24
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Encrypts several blocks in ECB mode */
end_comment

begin_function
name|void
name|gost_enc
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|byte
modifier|*
name|clear
parameter_list|,
name|byte
modifier|*
name|cipher
parameter_list|,
name|int
name|blocks
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|blocks
condition|;
name|i
operator|++
control|)
block|{
name|gostcrypt
argument_list|(
name|c
argument_list|,
name|clear
argument_list|,
name|cipher
argument_list|)
expr_stmt|;
name|clear
operator|+=
literal|8
expr_stmt|;
name|cipher
operator|+=
literal|8
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Decrypts several blocks in ECB mode */
end_comment

begin_function
name|void
name|gost_dec
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|byte
modifier|*
name|cipher
parameter_list|,
name|byte
modifier|*
name|clear
parameter_list|,
name|int
name|blocks
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|blocks
condition|;
name|i
operator|++
control|)
block|{
name|gostdecrypt
argument_list|(
name|c
argument_list|,
name|cipher
argument_list|,
name|clear
argument_list|)
expr_stmt|;
name|clear
operator|+=
literal|8
expr_stmt|;
name|cipher
operator|+=
literal|8
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Encrypts several full blocks in CFB mode using 8byte IV */
end_comment

begin_function
name|void
name|gost_enc_cfb
parameter_list|(
name|gost_ctx
modifier|*
name|ctx
parameter_list|,
specifier|const
name|byte
modifier|*
name|iv
parameter_list|,
specifier|const
name|byte
modifier|*
name|clear
parameter_list|,
name|byte
modifier|*
name|cipher
parameter_list|,
name|int
name|blocks
parameter_list|)
block|{
name|byte
name|cur_iv
index|[
literal|8
index|]
decl_stmt|;
name|byte
name|gamma
index|[
literal|8
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|byte
modifier|*
name|in
decl_stmt|;
name|byte
modifier|*
name|out
decl_stmt|;
name|memcpy
argument_list|(
name|cur_iv
argument_list|,
name|iv
argument_list|,
literal|8
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|in
operator|=
name|clear
operator|,
name|out
operator|=
name|cipher
init|;
name|i
operator|<
name|blocks
condition|;
name|i
operator|++
operator|,
name|in
operator|+=
literal|8
operator|,
name|out
operator|+=
literal|8
control|)
block|{
name|gostcrypt
argument_list|(
name|ctx
argument_list|,
name|cur_iv
argument_list|,
name|gamma
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
name|j
operator|++
control|)
block|{
name|cur_iv
index|[
name|j
index|]
operator|=
name|out
index|[
name|j
index|]
operator|=
name|in
index|[
name|j
index|]
operator|^
name|gamma
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/* Decrypts several full blocks in CFB mode using 8byte IV */
end_comment

begin_function
name|void
name|gost_dec_cfb
parameter_list|(
name|gost_ctx
modifier|*
name|ctx
parameter_list|,
specifier|const
name|byte
modifier|*
name|iv
parameter_list|,
specifier|const
name|byte
modifier|*
name|cipher
parameter_list|,
name|byte
modifier|*
name|clear
parameter_list|,
name|int
name|blocks
parameter_list|)
block|{
name|byte
name|cur_iv
index|[
literal|8
index|]
decl_stmt|;
name|byte
name|gamma
index|[
literal|8
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|byte
modifier|*
name|in
decl_stmt|;
name|byte
modifier|*
name|out
decl_stmt|;
name|memcpy
argument_list|(
name|cur_iv
argument_list|,
name|iv
argument_list|,
literal|8
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|in
operator|=
name|cipher
operator|,
name|out
operator|=
name|clear
init|;
name|i
operator|<
name|blocks
condition|;
name|i
operator|++
operator|,
name|in
operator|+=
literal|8
operator|,
name|out
operator|+=
literal|8
control|)
block|{
name|gostcrypt
argument_list|(
name|ctx
argument_list|,
name|cur_iv
argument_list|,
name|gamma
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
name|j
operator|++
control|)
block|{
name|out
index|[
name|j
index|]
operator|=
operator|(
name|cur_iv
index|[
name|j
index|]
operator|=
name|in
index|[
name|j
index|]
operator|)
operator|^
name|gamma
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/* Encrypts one block using specified key */
end_comment

begin_function
name|void
name|gost_enc_with_key
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
name|byte
modifier|*
name|key
parameter_list|,
name|byte
modifier|*
name|inblock
parameter_list|,
name|byte
modifier|*
name|outblock
parameter_list|)
block|{
name|gost_key
argument_list|(
name|c
argument_list|,
name|key
argument_list|)
expr_stmt|;
name|gostcrypt
argument_list|(
name|c
argument_list|,
name|inblock
argument_list|,
name|outblock
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Set 256 bit  key into context */
end_comment

begin_function
name|void
name|gost_key
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|byte
modifier|*
name|k
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
operator|,
name|j
operator|+=
literal|4
control|)
block|{
name|c
operator|->
name|k
index|[
name|i
index|]
operator|=
name|k
index|[
name|j
index|]
operator||
operator|(
name|k
index|[
name|j
operator|+
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|k
index|[
name|j
operator|+
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|k
index|[
name|j
operator|+
literal|3
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Retrieve 256-bit key from context */
end_comment

begin_function
name|void
name|gost_get_key
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
name|byte
modifier|*
name|k
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
operator|,
name|j
operator|+=
literal|4
control|)
block|{
name|k
index|[
name|j
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|c
operator|->
name|k
index|[
name|i
index|]
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|k
index|[
name|j
operator|+
literal|1
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|c
operator|->
name|k
index|[
name|i
index|]
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|k
index|[
name|j
operator|+
literal|2
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|c
operator|->
name|k
index|[
name|i
index|]
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|k
index|[
name|j
operator|+
literal|3
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|c
operator|->
name|k
index|[
name|i
index|]
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Initalize context. Provides default value for subst_block */
end_comment

begin_function
name|void
name|gost_init
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
specifier|const
name|gost_subst_block
modifier|*
name|b
parameter_list|)
block|{
if|if
condition|(
operator|!
name|b
condition|)
block|{
name|b
operator|=
operator|&
name|GostR3411_94_TestParamSet
expr_stmt|;
block|}
name|kboxinit
argument_list|(
name|c
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Cleans up key from context */
end_comment

begin_function
name|void
name|gost_destroy
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|c
operator|->
name|k
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Compute GOST 28147 mac block   *   * Parameters  *   gost_ctx *c - context initalized with substitution blocks and key  *   buffer - 8-byte mac state buffer  *   block 8-byte block to process.  * */
end_comment

begin_function
name|void
name|mac_block
parameter_list|(
name|gost_ctx
modifier|*
name|c
parameter_list|,
name|byte
modifier|*
name|buffer
parameter_list|,
specifier|const
name|byte
modifier|*
name|block
parameter_list|)
block|{
specifier|register
name|word32
name|n1
decl_stmt|,
name|n2
decl_stmt|;
comment|/* As named in the GOST */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|buffer
index|[
name|i
index|]
operator|^=
name|block
index|[
name|i
index|]
expr_stmt|;
block|}
name|n1
operator|=
name|buffer
index|[
literal|0
index|]
operator||
operator|(
name|buffer
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|buffer
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|buffer
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
name|n2
operator|=
name|buffer
index|[
literal|4
index|]
operator||
operator|(
name|buffer
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|buffer
index|[
literal|6
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|buffer
index|[
literal|7
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
comment|/* Instead of swapping halves, swap names each round */
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|n2
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n1
operator|+
name|c
operator|->
name|k
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|n1
operator|^=
name|f
argument_list|(
name|c
argument_list|,
name|n2
operator|+
name|c
operator|->
name|k
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|0
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n1
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|1
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n1
operator|>>
literal|8
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|2
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n1
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|3
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n1
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|4
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n2
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|5
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n2
operator|>>
literal|8
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|6
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
operator|(
name|n2
operator|>>
literal|16
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|7
index|]
operator|=
call|(
name|byte
call|)
argument_list|(
name|n2
operator|>>
literal|24
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Get mac with specified number of bits from MAC state buffer */
end_comment

begin_function
name|void
name|get_mac
parameter_list|(
name|byte
modifier|*
name|buffer
parameter_list|,
name|int
name|nbits
parameter_list|,
name|byte
modifier|*
name|out
parameter_list|)
block|{
name|int
name|nbytes
init|=
name|nbits
operator|>>
literal|3
decl_stmt|;
name|int
name|rembits
init|=
name|nbits
operator|&
literal|7
decl_stmt|;
name|int
name|mask
init|=
name|rembits
condition|?
operator|(
operator|(
literal|1
operator|<
name|rembits
operator|)
operator|-
literal|1
operator|)
else|:
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nbytes
condition|;
name|i
operator|++
control|)
name|out
index|[
name|i
index|]
operator|=
name|buffer
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|rembits
condition|)
name|out
index|[
name|i
index|]
operator|=
name|buffer
index|[
name|i
index|]
operator|&
name|mask
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Compute mac of specified length (in bits) from data.   * Context should be initialized with key and subst blocks */
end_comment

begin_function
name|int
name|gost_mac
parameter_list|(
name|gost_ctx
modifier|*
name|ctx
parameter_list|,
name|int
name|mac_len
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|int
name|data_len
parameter_list|,
name|unsigned
name|char
modifier|*
name|mac
parameter_list|)
block|{
name|byte
name|buffer
index|[
literal|8
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|byte
name|buf2
index|[
literal|8
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|+
literal|8
operator|<=
name|data_len
condition|;
name|i
operator|+=
literal|8
control|)
name|mac_block
argument_list|(
name|ctx
argument_list|,
name|buffer
argument_list|,
name|data
operator|+
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|data_len
condition|)
block|{
name|memset
argument_list|(
name|buf2
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|buf2
argument_list|,
name|data
operator|+
name|i
argument_list|,
name|data_len
operator|-
name|i
argument_list|)
expr_stmt|;
name|mac_block
argument_list|(
name|ctx
argument_list|,
name|buffer
argument_list|,
name|buf2
argument_list|)
expr_stmt|;
block|}
name|get_mac
argument_list|(
name|buffer
argument_list|,
name|mac_len
argument_list|,
name|mac
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* Compute MAC with non-zero IV. Used in some RFC 4357 algorithms */
end_comment

begin_function
name|int
name|gost_mac_iv
parameter_list|(
name|gost_ctx
modifier|*
name|ctx
parameter_list|,
name|int
name|mac_len
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|int
name|data_len
parameter_list|,
name|unsigned
name|char
modifier|*
name|mac
parameter_list|)
block|{
name|byte
name|buffer
index|[
literal|8
index|]
decl_stmt|;
name|byte
name|buf2
index|[
literal|8
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|memcpy
argument_list|(
name|buffer
argument_list|,
name|iv
argument_list|,
literal|8
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|+
literal|8
operator|<=
name|data_len
condition|;
name|i
operator|+=
literal|8
control|)
name|mac_block
argument_list|(
name|ctx
argument_list|,
name|buffer
argument_list|,
name|data
operator|+
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|data_len
condition|)
block|{
name|memset
argument_list|(
name|buf2
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|buf2
argument_list|,
name|data
operator|+
name|i
argument_list|,
name|data_len
operator|-
name|i
argument_list|)
expr_stmt|;
name|mac_block
argument_list|(
name|ctx
argument_list|,
name|buffer
argument_list|,
name|buf2
argument_list|)
expr_stmt|;
block|}
name|get_mac
argument_list|(
name|buffer
argument_list|,
name|mac_len
argument_list|,
name|mac
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* Implements key meshing algorithm by modifing ctx and IV in place */
end_comment

begin_function
name|void
name|cryptopro_key_meshing
parameter_list|(
name|gost_ctx
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|iv
parameter_list|)
block|{
name|unsigned
name|char
name|newkey
index|[
literal|32
index|]
decl_stmt|,
name|newiv
index|[
literal|8
index|]
decl_stmt|;
comment|/* Set static keymeshing key */
comment|/* "Decrypt" key with keymeshing key */
name|gost_dec
argument_list|(
name|ctx
argument_list|,
name|CryptoProKeyMeshingKey
argument_list|,
name|newkey
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|/* set new key */
name|gost_key
argument_list|(
name|ctx
argument_list|,
name|newkey
argument_list|)
expr_stmt|;
comment|/* Encrypt iv with new key */
name|gostcrypt
argument_list|(
name|ctx
argument_list|,
name|iv
argument_list|,
name|newiv
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|iv
argument_list|,
name|newiv
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

