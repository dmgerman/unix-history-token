begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<atf-c.h>
end_include

begin_include
include|#
directive|include
file|<geom/eli/pkcs5v2.h>
end_include

begin_struct
specifier|const
struct|struct
block|{
name|char
modifier|*
name|salt
decl_stmt|;
name|size_t
name|saltlen
decl_stmt|;
name|char
modifier|*
name|passwd
decl_stmt|;
name|int
name|iterations
decl_stmt|;
name|char
modifier|*
name|hmacout
decl_stmt|;
name|size_t
name|hmaclen
decl_stmt|;
block|}
name|testdata
index|[]
init|=
block|{
include|#
directive|include
file|"testvect.h"
block|}
struct|;
end_struct

begin_expr_stmt
name|ATF_TC_WITHOUT_HEAD
argument_list|(
name|hmactest
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|ATF_TC_BODY
argument_list|(
argument|hmactest
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|size_t
name|i
decl_stmt|;
name|uint8_t
name|hmacout
index|[
literal|64
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nitems
argument_list|(
name|testdata
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|pkcs5v2_genkey
argument_list|(
name|hmacout
argument_list|,
name|testdata
index|[
name|i
index|]
operator|.
name|hmaclen
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
name|testdata
index|[
name|i
index|]
operator|.
name|salt
argument_list|,
name|testdata
index|[
name|i
index|]
operator|.
name|saltlen
argument_list|,
name|testdata
index|[
name|i
index|]
operator|.
name|passwd
argument_list|,
name|testdata
index|[
name|i
index|]
operator|.
name|iterations
argument_list|)
expr_stmt|;
name|ATF_REQUIRE
argument_list|(
name|bcmp
argument_list|(
name|hmacout
argument_list|,
name|testdata
index|[
name|i
index|]
operator|.
name|hmacout
argument_list|,
name|testdata
index|[
name|i
index|]
operator|.
name|hmaclen
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|ATF_TP_ADD_TCS
argument_list|(
argument|tp
argument_list|)
end_macro

begin_block
block|{
name|ATF_TP_ADD_TC
argument_list|(
name|tp
argument_list|,
name|hmactest
argument_list|)
expr_stmt|;
return|return
operator|(
name|atf_no_error
argument_list|()
operator|)
return|;
block|}
end_block

end_unit

