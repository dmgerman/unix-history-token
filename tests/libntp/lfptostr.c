begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*   * This file contains test for both mfptoa and mfptoms (which uses dolfptoa),  * since all these functions are very similar. It also tests ulfptoa, which is  * a macro.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"ntp_calendar.h"
end_include

begin_include
include|#
directive|include
file|"ntp_fp.h"
end_include

begin_include
include|#
directive|include
file|"unity.h"
end_include

begin_decl_stmt
specifier|static
specifier|const
name|int
name|LFP_MAX_PRECISION
init|=
literal|10
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|int
name|LFP_MAX_PRECISION_MS
init|=
literal|7
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|int
name|ONE_FOURTH
init|=
literal|1073741824
decl_stmt|;
end_decl_stmt

begin_comment
comment|// (1<< 30)
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|int
name|HALF
init|=
operator|(
literal|1
operator|<<
literal|31
operator|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|int
name|THREE_FOURTH
init|=
operator|-
literal|1073741824
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|int
name|HALF_PROMILLE_UP
init|=
literal|2147484
decl_stmt|;
end_decl_stmt

begin_comment
comment|// slightly more than 0.0005
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|int
name|HALF_PROMILLE_DOWN
init|=
literal|2147483
decl_stmt|;
end_decl_stmt

begin_comment
comment|// slightly less than 0.0005
end_comment

begin_function
name|void
name|test_PositiveInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|200
block|,
literal|0
block|}
decl_stmt|;
comment|// exact 200.0000000000
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"200.0000000000"
argument_list|,
name|mfptoa
argument_list|(
name|test
operator|.
name|l_ui
argument_list|,
name|test
operator|.
name|l_uf
argument_list|,
name|LFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"200000.0000000"
argument_list|,
name|mfptoms
argument_list|(
name|test
operator|.
name|l_ui
argument_list|,
name|test
operator|.
name|l_uf
argument_list|,
name|LFP_MAX_PRECISION_MS
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_NegativeInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
operator|-
literal|100
block|,
literal|0
block|}
decl_stmt|;
comment|// -100
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-100.0000000000"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
name|LFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-100000.0000000"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
name|LFP_MAX_PRECISION_MS
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_PositiveIntegerWithFraction
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|200
block|,
name|ONE_FOURTH
block|}
decl_stmt|;
comment|// 200.25
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"200.2500000000"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
name|LFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"200250.0000000"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
name|LFP_MAX_PRECISION_MS
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_NegativeIntegerWithFraction
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
operator|-
literal|100
block|,
name|ONE_FOURTH
block|}
decl_stmt|;
comment|// -99.75
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-99.7500000000"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
name|LFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-99750.0000000"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
name|LFP_MAX_PRECISION_MS
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_RoundingDownToInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|10
block|,
name|ONE_FOURTH
block|}
decl_stmt|;
comment|// 10.25
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"10"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"10250"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_RoundingMiddleToInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|10
block|,
name|HALF
block|}
decl_stmt|;
comment|// 10.5
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"11"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"10500"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_RoundingUpToInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|5
block|,
name|THREE_FOURTH
block|}
decl_stmt|;
comment|// 5.75
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"6"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"5750"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_SingleDecimal
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|8
block|,
name|ONE_FOURTH
block|}
decl_stmt|;
comment|// 8.25
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"8.3"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"8250.0"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_MillisecondsRoundingUp
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|1
block|,
name|HALF_PROMILLE_UP
block|}
decl_stmt|;
comment|//slightly more than 1.0005
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"1.0"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"1000.5"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"1001"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_MillisecondsRoundingDown
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|1
block|,
name|HALF_PROMILLE_DOWN
block|}
decl_stmt|;
comment|// slightly less than 1.0005
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"1.0"
argument_list|,
name|lfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"1000.5"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"1000"
argument_list|,
name|lfptoms
argument_list|(
operator|&
name|test
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_UnsignedInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|l_fp
name|test
init|=
block|{
literal|3000000000UL
block|,
literal|0
block|}
decl_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"3000000000.0"
argument_list|,
name|ulfptoa
argument_list|(
operator|&
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

