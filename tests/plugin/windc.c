begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<krb5.h>
end_include

begin_include
include|#
directive|include
file|<hdb.h>
end_include

begin_include
include|#
directive|include
file|<kdc.h>
end_include

begin_include
include|#
directive|include
file|<windc_plugin.h>
end_include

begin_function
specifier|static
name|krb5_error_code
name|windc_init
parameter_list|(
name|krb5_context
name|context
parameter_list|,
name|void
modifier|*
modifier|*
name|ctx
parameter_list|)
block|{
name|krb5_warnx
argument_list|(
name|context
argument_list|,
literal|"windc init"
argument_list|)
expr_stmt|;
operator|*
name|ctx
operator|=
name|NULL
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|windc_fini
parameter_list|(
name|void
modifier|*
name|ctx
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|krb5_error_code
name|pac_generate
parameter_list|(
name|void
modifier|*
name|ctx
parameter_list|,
name|krb5_context
name|context
parameter_list|,
name|struct
name|hdb_entry_ex
modifier|*
name|client
parameter_list|,
name|krb5_pac
modifier|*
name|pac
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|krb5_data
name|data
decl_stmt|;
name|krb5_warnx
argument_list|(
name|context
argument_list|,
literal|"pac generate"
argument_list|)
expr_stmt|;
name|data
operator|.
name|data
operator|=
literal|"\x00\x01"
expr_stmt|;
name|data
operator|.
name|length
operator|=
literal|2
expr_stmt|;
name|ret
operator|=
name|krb5_pac_init
argument_list|(
name|context
argument_list|,
name|pac
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
name|ret
operator|=
name|krb5_pac_add_buffer
argument_list|(
name|context
argument_list|,
operator|*
name|pac
argument_list|,
literal|1
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|krb5_error_code
name|pac_verify
parameter_list|(
name|void
modifier|*
name|ctx
parameter_list|,
name|krb5_context
name|context
parameter_list|,
specifier|const
name|krb5_principal
name|new_ticket_client
parameter_list|,
specifier|const
name|krb5_principal
name|delegation_proxy
parameter_list|,
name|struct
name|hdb_entry_ex
modifier|*
name|client
parameter_list|,
name|struct
name|hdb_entry_ex
modifier|*
name|server
parameter_list|,
name|struct
name|hdb_entry_ex
modifier|*
name|krbtgt
parameter_list|,
name|krb5_pac
modifier|*
name|pac
parameter_list|)
block|{
name|krb5_error_code
name|ret
decl_stmt|;
name|krb5_data
name|data
decl_stmt|;
name|krb5_warnx
argument_list|(
name|context
argument_list|,
literal|"pac_verify"
argument_list|)
expr_stmt|;
name|ret
operator|=
name|krb5_pac_get_buffer
argument_list|(
name|context
argument_list|,
operator|*
name|pac
argument_list|,
literal|1
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
name|ret
return|;
name|krb5_data_free
argument_list|(
operator|&
name|data
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|krb5_error_code
name|client_access
parameter_list|(
name|void
modifier|*
name|ctx
parameter_list|,
name|krb5_context
name|context
parameter_list|,
name|krb5_kdc_configuration
modifier|*
name|config
parameter_list|,
name|hdb_entry_ex
modifier|*
name|client
parameter_list|,
specifier|const
name|char
modifier|*
name|client_name
parameter_list|,
name|hdb_entry_ex
modifier|*
name|server
parameter_list|,
specifier|const
name|char
modifier|*
name|server_name
parameter_list|,
name|KDC_REQ
modifier|*
name|req
parameter_list|,
name|krb5_data
modifier|*
name|e_data
parameter_list|)
block|{
name|krb5_warnx
argument_list|(
name|context
argument_list|,
literal|"client_access"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
name|krb5plugin_windc_ftable
name|windc
init|=
block|{
name|KRB5_WINDC_PLUGING_MINOR
block|,
name|windc_init
block|,
name|windc_fini
block|,
name|pac_generate
block|,
name|pac_verify
block|,
name|client_access
block|}
decl_stmt|;
end_decl_stmt

end_unit

