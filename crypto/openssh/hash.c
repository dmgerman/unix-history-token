begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $OpenBSD: hash.c,v 1.3 2013/12/09 11:03:45 markus Exp $ */
end_comment

begin_comment
comment|/* Copied from nacl-20110221/crypto_hash/sha512/ref/hash.c */
end_comment

begin_comment
comment|/* 20080913 D. J. Bernstein Public domain. */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"crypto_api.h"
end_include

begin_define
define|#
directive|define
name|blocks
value|crypto_hashblocks_sha512
end_define

begin_decl_stmt
specifier|static
specifier|const
name|unsigned
name|char
name|iv
index|[
literal|64
index|]
init|=
block|{
literal|0x6a
block|,
literal|0x09
block|,
literal|0xe6
block|,
literal|0x67
block|,
literal|0xf3
block|,
literal|0xbc
block|,
literal|0xc9
block|,
literal|0x08
block|,
literal|0xbb
block|,
literal|0x67
block|,
literal|0xae
block|,
literal|0x85
block|,
literal|0x84
block|,
literal|0xca
block|,
literal|0xa7
block|,
literal|0x3b
block|,
literal|0x3c
block|,
literal|0x6e
block|,
literal|0xf3
block|,
literal|0x72
block|,
literal|0xfe
block|,
literal|0x94
block|,
literal|0xf8
block|,
literal|0x2b
block|,
literal|0xa5
block|,
literal|0x4f
block|,
literal|0xf5
block|,
literal|0x3a
block|,
literal|0x5f
block|,
literal|0x1d
block|,
literal|0x36
block|,
literal|0xf1
block|,
literal|0x51
block|,
literal|0x0e
block|,
literal|0x52
block|,
literal|0x7f
block|,
literal|0xad
block|,
literal|0xe6
block|,
literal|0x82
block|,
literal|0xd1
block|,
literal|0x9b
block|,
literal|0x05
block|,
literal|0x68
block|,
literal|0x8c
block|,
literal|0x2b
block|,
literal|0x3e
block|,
literal|0x6c
block|,
literal|0x1f
block|,
literal|0x1f
block|,
literal|0x83
block|,
literal|0xd9
block|,
literal|0xab
block|,
literal|0xfb
block|,
literal|0x41
block|,
literal|0xbd
block|,
literal|0x6b
block|,
literal|0x5b
block|,
literal|0xe0
block|,
literal|0xcd
block|,
literal|0x19
block|,
literal|0x13
block|,
literal|0x7e
block|,
literal|0x21
block|,
literal|0x79
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
name|unsigned
name|long
name|long
name|uint64
typedef|;
end_typedef

begin_function
name|int
name|crypto_hash_sha512
parameter_list|(
name|unsigned
name|char
modifier|*
name|out
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|in
parameter_list|,
name|unsigned
name|long
name|long
name|inlen
parameter_list|)
block|{
name|unsigned
name|char
name|h
index|[
literal|64
index|]
decl_stmt|;
name|unsigned
name|char
name|padded
index|[
literal|256
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|unsigned
name|long
name|long
name|bytes
init|=
name|inlen
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
operator|++
name|i
control|)
name|h
index|[
name|i
index|]
operator|=
name|iv
index|[
name|i
index|]
expr_stmt|;
name|blocks
argument_list|(
name|h
argument_list|,
name|in
argument_list|,
name|inlen
argument_list|)
expr_stmt|;
name|in
operator|+=
name|inlen
expr_stmt|;
name|inlen
operator|&=
literal|127
expr_stmt|;
name|in
operator|-=
name|inlen
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|inlen
condition|;
operator|++
name|i
control|)
name|padded
index|[
name|i
index|]
operator|=
name|in
index|[
name|i
index|]
expr_stmt|;
name|padded
index|[
name|inlen
index|]
operator|=
literal|0x80
expr_stmt|;
if|if
condition|(
name|inlen
operator|<
literal|112
condition|)
block|{
for|for
control|(
name|i
operator|=
name|inlen
operator|+
literal|1
init|;
name|i
operator|<
literal|119
condition|;
operator|++
name|i
control|)
name|padded
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|padded
index|[
literal|119
index|]
operator|=
name|bytes
operator|>>
literal|61
expr_stmt|;
name|padded
index|[
literal|120
index|]
operator|=
name|bytes
operator|>>
literal|53
expr_stmt|;
name|padded
index|[
literal|121
index|]
operator|=
name|bytes
operator|>>
literal|45
expr_stmt|;
name|padded
index|[
literal|122
index|]
operator|=
name|bytes
operator|>>
literal|37
expr_stmt|;
name|padded
index|[
literal|123
index|]
operator|=
name|bytes
operator|>>
literal|29
expr_stmt|;
name|padded
index|[
literal|124
index|]
operator|=
name|bytes
operator|>>
literal|21
expr_stmt|;
name|padded
index|[
literal|125
index|]
operator|=
name|bytes
operator|>>
literal|13
expr_stmt|;
name|padded
index|[
literal|126
index|]
operator|=
name|bytes
operator|>>
literal|5
expr_stmt|;
name|padded
index|[
literal|127
index|]
operator|=
name|bytes
operator|<<
literal|3
expr_stmt|;
name|blocks
argument_list|(
name|h
argument_list|,
name|padded
argument_list|,
literal|128
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
name|inlen
operator|+
literal|1
init|;
name|i
operator|<
literal|247
condition|;
operator|++
name|i
control|)
name|padded
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|padded
index|[
literal|247
index|]
operator|=
name|bytes
operator|>>
literal|61
expr_stmt|;
name|padded
index|[
literal|248
index|]
operator|=
name|bytes
operator|>>
literal|53
expr_stmt|;
name|padded
index|[
literal|249
index|]
operator|=
name|bytes
operator|>>
literal|45
expr_stmt|;
name|padded
index|[
literal|250
index|]
operator|=
name|bytes
operator|>>
literal|37
expr_stmt|;
name|padded
index|[
literal|251
index|]
operator|=
name|bytes
operator|>>
literal|29
expr_stmt|;
name|padded
index|[
literal|252
index|]
operator|=
name|bytes
operator|>>
literal|21
expr_stmt|;
name|padded
index|[
literal|253
index|]
operator|=
name|bytes
operator|>>
literal|13
expr_stmt|;
name|padded
index|[
literal|254
index|]
operator|=
name|bytes
operator|>>
literal|5
expr_stmt|;
name|padded
index|[
literal|255
index|]
operator|=
name|bytes
operator|<<
literal|3
expr_stmt|;
name|blocks
argument_list|(
name|h
argument_list|,
name|padded
argument_list|,
literal|256
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
operator|++
name|i
control|)
name|out
index|[
name|i
index|]
operator|=
name|h
index|[
name|i
index|]
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

