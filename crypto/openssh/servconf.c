begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $OpenBSD: servconf.c,v 1.292 2016/06/23 05:17:51 djm Exp $ */
end_comment

begin_comment
comment|/*  * Copyright (c) 1995 Tatu Ylonen<ylo@cs.hut.fi>, Espoo, Finland  *                    All rights reserved  *  * As far as I am concerned, the code I have written for this software  * can be used freely for any purpose.  Any derived versions of this  * software must be clearly marked as such, and if the derived work is  * incompatible with the protocol description in the RFC file, it must be  * called by a name other than "ssh" or "Secure Shell".  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_expr_stmt
name|__RCSID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in_systm.h>
end_include

begin_include
include|#
directive|include
file|<netinet/ip.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_include
include|#
directive|include
file|<pwd.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UTIL_H
end_ifdef

begin_include
include|#
directive|include
file|<util.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"openbsd-compat/sys-queue.h"
end_include

begin_include
include|#
directive|include
file|"xmalloc.h"
end_include

begin_include
include|#
directive|include
file|"ssh.h"
end_include

begin_include
include|#
directive|include
file|"log.h"
end_include

begin_include
include|#
directive|include
file|"buffer.h"
end_include

begin_include
include|#
directive|include
file|"misc.h"
end_include

begin_include
include|#
directive|include
file|"servconf.h"
end_include

begin_include
include|#
directive|include
file|"compat.h"
end_include

begin_include
include|#
directive|include
file|"pathnames.h"
end_include

begin_include
include|#
directive|include
file|"cipher.h"
end_include

begin_include
include|#
directive|include
file|"key.h"
end_include

begin_include
include|#
directive|include
file|"kex.h"
end_include

begin_include
include|#
directive|include
file|"mac.h"
end_include

begin_include
include|#
directive|include
file|"match.h"
end_include

begin_include
include|#
directive|include
file|"channels.h"
end_include

begin_include
include|#
directive|include
file|"groupaccess.h"
end_include

begin_include
include|#
directive|include
file|"canohost.h"
end_include

begin_include
include|#
directive|include
file|"packet.h"
end_include

begin_include
include|#
directive|include
file|"hostfile.h"
end_include

begin_include
include|#
directive|include
file|"auth.h"
end_include

begin_include
include|#
directive|include
file|"myproposal.h"
end_include

begin_include
include|#
directive|include
file|"digest.h"
end_include

begin_include
include|#
directive|include
file|"version.h"
end_include

begin_function_decl
specifier|static
name|void
name|add_listen_addr
parameter_list|(
name|ServerOptions
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|add_one_listen_addr
parameter_list|(
name|ServerOptions
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Use of privilege separation or not */
end_comment

begin_decl_stmt
specifier|extern
name|int
name|use_privsep
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Buffer
name|cfg
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Initializes the server options to their default values. */
end_comment

begin_function
name|void
name|initialize_server_options
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|)
block|{
name|memset
argument_list|(
name|options
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|options
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Portable-specific options */
name|options
operator|->
name|use_pam
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* Standard Options */
name|options
operator|->
name|num_ports
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|ports_from_cmdline
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|queued_listen_addrs
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|num_queued_listens
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|listen_addrs
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|address_family
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|num_host_key_files
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|num_host_cert_files
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|host_key_agent
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|pid_file
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|server_key_bits
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|login_grace_time
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|key_regeneration_time
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|permit_root_login
operator|=
name|PERMIT_NOT_SET
expr_stmt|;
name|options
operator|->
name|ignore_rhosts
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|ignore_user_known_hosts
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|print_motd
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|print_lastlog
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|x11_forwarding
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|x11_display_offset
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|x11_use_localhost
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|permit_tty
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|permit_user_rc
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|xauth_location
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|strict_modes
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|tcp_keep_alive
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|log_facility
operator|=
name|SYSLOG_FACILITY_NOT_SET
expr_stmt|;
name|options
operator|->
name|log_level
operator|=
name|SYSLOG_LEVEL_NOT_SET
expr_stmt|;
name|options
operator|->
name|rhosts_rsa_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|hostbased_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|hostbased_uses_name_from_packet_only
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|hostbased_key_types
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|hostkeyalgorithms
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|rsa_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|pubkey_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|pubkey_key_types
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|kerberos_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|kerberos_or_local_passwd
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|kerberos_ticket_cleanup
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|kerberos_get_afs_token
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|gss_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|gss_cleanup_creds
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|gss_strict_acceptor
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|password_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|kbd_interactive_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|challenge_response_authentication
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|permit_empty_passwd
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|permit_user_env
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|use_login
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|compression
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|rekey_limit
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|rekey_interval
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|allow_tcp_forwarding
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|allow_streamlocal_forwarding
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|allow_agent_forwarding
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|num_allow_users
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|num_deny_users
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|num_allow_groups
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|num_deny_groups
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|ciphers
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|macs
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|kex_algorithms
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|protocol
operator|=
name|SSH_PROTO_UNKNOWN
expr_stmt|;
name|options
operator|->
name|fwd_opts
operator|.
name|gateway_ports
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
operator|=
operator|(
name|mode_t
operator|)
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_unlink
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|num_subsystems
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|max_startups_begin
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|max_startups_rate
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|max_startups
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|max_authtries
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|max_sessions
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|banner
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|use_dns
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|client_alive_interval
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|client_alive_count_max
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|num_authkeys_files
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|num_accept_env
operator|=
literal|0
expr_stmt|;
name|options
operator|->
name|permit_tun
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|num_permitted_opens
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|adm_forced_command
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|chroot_directory
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|authorized_keys_command
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|authorized_keys_command_user
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|revoked_keys_file
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|trusted_user_ca_keys
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|authorized_principals_file
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|authorized_principals_command
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|authorized_principals_command_user
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|ip_qos_interactive
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|ip_qos_bulk
operator|=
operator|-
literal|1
expr_stmt|;
name|options
operator|->
name|version_addendum
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|fingerprint_hash
operator|=
operator|-
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Returns 1 if a string option is unset or set to "none" or 0 otherwise. */
end_comment

begin_function
specifier|static
name|int
name|option_clear_or_none
parameter_list|(
specifier|const
name|char
modifier|*
name|o
parameter_list|)
block|{
return|return
name|o
operator|==
name|NULL
operator|||
name|strcasecmp
argument_list|(
name|o
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|assemble_algorithms
parameter_list|(
name|ServerOptions
modifier|*
name|o
parameter_list|)
block|{
if|if
condition|(
name|kex_assemble_names
argument_list|(
name|KEX_SERVER_ENCRYPT
argument_list|,
operator|&
name|o
operator|->
name|ciphers
argument_list|)
operator|!=
literal|0
operator|||
name|kex_assemble_names
argument_list|(
name|KEX_SERVER_MAC
argument_list|,
operator|&
name|o
operator|->
name|macs
argument_list|)
operator|!=
literal|0
operator|||
name|kex_assemble_names
argument_list|(
name|KEX_SERVER_KEX
argument_list|,
operator|&
name|o
operator|->
name|kex_algorithms
argument_list|)
operator|!=
literal|0
operator|||
name|kex_assemble_names
argument_list|(
name|KEX_DEFAULT_PK_ALG
argument_list|,
operator|&
name|o
operator|->
name|hostkeyalgorithms
argument_list|)
operator|!=
literal|0
operator|||
name|kex_assemble_names
argument_list|(
name|KEX_DEFAULT_PK_ALG
argument_list|,
operator|&
name|o
operator|->
name|hostbased_key_types
argument_list|)
operator|!=
literal|0
operator|||
name|kex_assemble_names
argument_list|(
name|KEX_DEFAULT_PK_ALG
argument_list|,
operator|&
name|o
operator|->
name|pubkey_key_types
argument_list|)
operator|!=
literal|0
condition|)
name|fatal
argument_list|(
literal|"kex_assemble_names failed"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fill_default_server_options
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
comment|/* Portable-specific options */
if|if
condition|(
name|options
operator|->
name|use_pam
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|use_pam
operator|=
literal|1
expr_stmt|;
comment|/* Standard Options */
if|if
condition|(
name|options
operator|->
name|protocol
operator|==
name|SSH_PROTO_UNKNOWN
condition|)
name|options
operator|->
name|protocol
operator|=
name|SSH_PROTO_2
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|protocol
operator|&
name|SSH_PROTO_1
condition|)
name|error
argument_list|(
literal|"WARNING: SSH protocol version 1 enabled"
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|num_host_key_files
operator|==
literal|0
condition|)
block|{
comment|/* fill default hostkeys for protocols */
if|if
condition|(
name|options
operator|->
name|protocol
operator|&
name|SSH_PROTO_1
condition|)
name|options
operator|->
name|host_key_files
index|[
name|options
operator|->
name|num_host_key_files
operator|++
index|]
operator|=
name|_PATH_HOST_KEY_FILE
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|protocol
operator|&
name|SSH_PROTO_2
condition|)
block|{
name|options
operator|->
name|host_key_files
index|[
name|options
operator|->
name|num_host_key_files
operator|++
index|]
operator|=
name|_PATH_HOST_RSA_KEY_FILE
expr_stmt|;
name|options
operator|->
name|host_key_files
index|[
name|options
operator|->
name|num_host_key_files
operator|++
index|]
operator|=
name|_PATH_HOST_DSA_KEY_FILE
expr_stmt|;
ifdef|#
directive|ifdef
name|OPENSSL_HAS_ECC
name|options
operator|->
name|host_key_files
index|[
name|options
operator|->
name|num_host_key_files
operator|++
index|]
operator|=
name|_PATH_HOST_ECDSA_KEY_FILE
expr_stmt|;
endif|#
directive|endif
name|options
operator|->
name|host_key_files
index|[
name|options
operator|->
name|num_host_key_files
operator|++
index|]
operator|=
name|_PATH_HOST_ED25519_KEY_FILE
expr_stmt|;
block|}
block|}
comment|/* No certificates by default */
if|if
condition|(
name|options
operator|->
name|num_ports
operator|==
literal|0
condition|)
name|options
operator|->
name|ports
index|[
name|options
operator|->
name|num_ports
operator|++
index|]
operator|=
name|SSH_DEFAULT_PORT
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|address_family
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|address_family
operator|=
name|AF_UNSPEC
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|listen_addrs
operator|==
name|NULL
condition|)
name|add_listen_addr
argument_list|(
name|options
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|pid_file
operator|==
name|NULL
condition|)
name|options
operator|->
name|pid_file
operator|=
name|xstrdup
argument_list|(
name|_PATH_SSH_DAEMON_PID_FILE
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|server_key_bits
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|server_key_bits
operator|=
literal|1024
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|login_grace_time
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|login_grace_time
operator|=
literal|120
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|key_regeneration_time
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|key_regeneration_time
operator|=
literal|3600
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|permit_root_login
operator|==
name|PERMIT_NOT_SET
condition|)
name|options
operator|->
name|permit_root_login
operator|=
name|PERMIT_NO
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|ignore_rhosts
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|ignore_rhosts
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|ignore_user_known_hosts
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|ignore_user_known_hosts
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|print_motd
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|print_motd
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|print_lastlog
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|print_lastlog
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|x11_forwarding
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|x11_forwarding
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|x11_display_offset
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|x11_display_offset
operator|=
literal|10
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|x11_use_localhost
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|x11_use_localhost
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|xauth_location
operator|==
name|NULL
condition|)
name|options
operator|->
name|xauth_location
operator|=
name|xstrdup
argument_list|(
name|_PATH_XAUTH
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|permit_tty
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|permit_tty
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|permit_user_rc
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|permit_user_rc
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|strict_modes
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|strict_modes
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|tcp_keep_alive
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|tcp_keep_alive
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|log_facility
operator|==
name|SYSLOG_FACILITY_NOT_SET
condition|)
name|options
operator|->
name|log_facility
operator|=
name|SYSLOG_FACILITY_AUTH
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|log_level
operator|==
name|SYSLOG_LEVEL_NOT_SET
condition|)
name|options
operator|->
name|log_level
operator|=
name|SYSLOG_LEVEL_INFO
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|rhosts_rsa_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|rhosts_rsa_authentication
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|hostbased_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|hostbased_authentication
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|hostbased_uses_name_from_packet_only
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|hostbased_uses_name_from_packet_only
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|rsa_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|rsa_authentication
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|pubkey_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|pubkey_authentication
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|kerberos_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|kerberos_authentication
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|kerberos_or_local_passwd
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|kerberos_or_local_passwd
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|kerberos_ticket_cleanup
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|kerberos_ticket_cleanup
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|kerberos_get_afs_token
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|kerberos_get_afs_token
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|gss_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|gss_authentication
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|gss_cleanup_creds
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|gss_cleanup_creds
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|gss_strict_acceptor
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|gss_strict_acceptor
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|password_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|password_authentication
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|kbd_interactive_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|kbd_interactive_authentication
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|challenge_response_authentication
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|challenge_response_authentication
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|permit_empty_passwd
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|permit_empty_passwd
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|permit_user_env
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|permit_user_env
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|use_login
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|use_login
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|compression
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|compression
operator|=
name|COMP_DELAYED
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|rekey_limit
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|rekey_limit
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|rekey_interval
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|rekey_interval
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|allow_tcp_forwarding
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|allow_tcp_forwarding
operator|=
name|FORWARD_ALLOW
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|allow_streamlocal_forwarding
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|allow_streamlocal_forwarding
operator|=
name|FORWARD_ALLOW
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|allow_agent_forwarding
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|allow_agent_forwarding
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|fwd_opts
operator|.
name|gateway_ports
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|fwd_opts
operator|.
name|gateway_ports
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|max_startups
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|max_startups
operator|=
literal|100
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|max_startups_rate
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|max_startups_rate
operator|=
literal|30
expr_stmt|;
comment|/* 30% */
if|if
condition|(
name|options
operator|->
name|max_startups_begin
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|max_startups_begin
operator|=
literal|10
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|max_authtries
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|max_authtries
operator|=
name|DEFAULT_AUTH_FAIL_MAX
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|max_sessions
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|max_sessions
operator|=
name|DEFAULT_SESSIONS_MAX
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|use_dns
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|use_dns
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|client_alive_interval
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|client_alive_interval
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|client_alive_count_max
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|client_alive_count_max
operator|=
literal|3
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|num_authkeys_files
operator|==
literal|0
condition|)
block|{
name|options
operator|->
name|authorized_keys_files
index|[
name|options
operator|->
name|num_authkeys_files
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|_PATH_SSH_USER_PERMITTED_KEYS
argument_list|)
expr_stmt|;
name|options
operator|->
name|authorized_keys_files
index|[
name|options
operator|->
name|num_authkeys_files
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|_PATH_SSH_USER_PERMITTED_KEYS2
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|options
operator|->
name|permit_tun
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|permit_tun
operator|=
name|SSH_TUNMODE_NO
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|ip_qos_interactive
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|ip_qos_interactive
operator|=
name|IPTOS_LOWDELAY
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|ip_qos_bulk
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|ip_qos_bulk
operator|=
name|IPTOS_THROUGHPUT
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|version_addendum
operator|==
name|NULL
condition|)
name|options
operator|->
name|version_addendum
operator|=
name|xstrdup
argument_list|(
name|SSH_VERSION_FREEBSD
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
operator|==
operator|(
name|mode_t
operator|)
operator|-
literal|1
condition|)
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
operator|=
literal|0177
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_unlink
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_unlink
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|fingerprint_hash
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|fingerprint_hash
operator|=
name|SSH_FP_HASH_DEFAULT
expr_stmt|;
name|assemble_algorithms
argument_list|(
name|options
argument_list|)
expr_stmt|;
comment|/* Turn privilege separation and sandboxing on by default */
if|if
condition|(
name|use_privsep
operator|==
operator|-
literal|1
condition|)
name|use_privsep
operator|=
name|PRIVSEP_ON
expr_stmt|;
define|#
directive|define
name|CLEAR_ON_NONE
parameter_list|(
name|v
parameter_list|)
define|\
value|do { \ 		if (option_clear_or_none(v)) { \ 			free(v); \ 			v = NULL; \ 		} \ 	} while(0)
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|pid_file
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|xauth_location
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|banner
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|trusted_user_ca_keys
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|revoked_keys_file
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|authorized_principals_file
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|adm_forced_command
argument_list|)
expr_stmt|;
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|chroot_directory
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|options
operator|->
name|num_host_key_files
condition|;
name|i
operator|++
control|)
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|host_key_files
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|options
operator|->
name|num_host_cert_files
condition|;
name|i
operator|++
control|)
name|CLEAR_ON_NONE
argument_list|(
name|options
operator|->
name|host_cert_files
index|[
name|i
index|]
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|CLEAR_ON_NONE
comment|/* Similar handling for AuthenticationMethods=any */
if|if
condition|(
name|options
operator|->
name|num_auth_methods
operator|==
literal|1
operator|&&
name|strcmp
argument_list|(
name|options
operator|->
name|auth_methods
index|[
literal|0
index|]
argument_list|,
literal|"any"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|options
operator|->
name|auth_methods
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|options
operator|->
name|auth_methods
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|num_auth_methods
operator|=
literal|0
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|HAVE_MMAP
if|if
condition|(
name|use_privsep
operator|&&
name|options
operator|->
name|compression
operator|==
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"This platform does not support both privilege "
literal|"separation and compression"
argument_list|)
expr_stmt|;
name|error
argument_list|(
literal|"Compression disabled"
argument_list|)
expr_stmt|;
name|options
operator|->
name|compression
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Keyword tokens. */
end_comment

begin_typedef
typedef|typedef
enum|enum
block|{
name|sBadOption
block|,
comment|/* == unknown option */
comment|/* Portable-specific options */
name|sUsePAM
block|,
comment|/* Standard Options */
name|sPort
block|,
name|sHostKeyFile
block|,
name|sServerKeyBits
block|,
name|sLoginGraceTime
block|,
name|sKeyRegenerationTime
block|,
name|sPermitRootLogin
block|,
name|sLogFacility
block|,
name|sLogLevel
block|,
name|sRhostsRSAAuthentication
block|,
name|sRSAAuthentication
block|,
name|sKerberosAuthentication
block|,
name|sKerberosOrLocalPasswd
block|,
name|sKerberosTicketCleanup
block|,
name|sKerberosGetAFSToken
block|,
name|sKerberosTgtPassing
block|,
name|sChallengeResponseAuthentication
block|,
name|sPasswordAuthentication
block|,
name|sKbdInteractiveAuthentication
block|,
name|sListenAddress
block|,
name|sAddressFamily
block|,
name|sPrintMotd
block|,
name|sPrintLastLog
block|,
name|sIgnoreRhosts
block|,
name|sX11Forwarding
block|,
name|sX11DisplayOffset
block|,
name|sX11UseLocalhost
block|,
name|sPermitTTY
block|,
name|sStrictModes
block|,
name|sEmptyPasswd
block|,
name|sTCPKeepAlive
block|,
name|sPermitUserEnvironment
block|,
name|sUseLogin
block|,
name|sAllowTcpForwarding
block|,
name|sCompression
block|,
name|sRekeyLimit
block|,
name|sAllowUsers
block|,
name|sDenyUsers
block|,
name|sAllowGroups
block|,
name|sDenyGroups
block|,
name|sIgnoreUserKnownHosts
block|,
name|sCiphers
block|,
name|sMacs
block|,
name|sProtocol
block|,
name|sPidFile
block|,
name|sGatewayPorts
block|,
name|sPubkeyAuthentication
block|,
name|sPubkeyAcceptedKeyTypes
block|,
name|sXAuthLocation
block|,
name|sSubsystem
block|,
name|sMaxStartups
block|,
name|sMaxAuthTries
block|,
name|sMaxSessions
block|,
name|sBanner
block|,
name|sUseDNS
block|,
name|sHostbasedAuthentication
block|,
name|sHostbasedUsesNameFromPacketOnly
block|,
name|sHostbasedAcceptedKeyTypes
block|,
name|sHostKeyAlgorithms
block|,
name|sClientAliveInterval
block|,
name|sClientAliveCountMax
block|,
name|sAuthorizedKeysFile
block|,
name|sGssAuthentication
block|,
name|sGssCleanupCreds
block|,
name|sGssStrictAcceptor
block|,
name|sAcceptEnv
block|,
name|sPermitTunnel
block|,
name|sMatch
block|,
name|sPermitOpen
block|,
name|sForceCommand
block|,
name|sChrootDirectory
block|,
name|sUsePrivilegeSeparation
block|,
name|sAllowAgentForwarding
block|,
name|sHostCertificate
block|,
name|sRevokedKeys
block|,
name|sTrustedUserCAKeys
block|,
name|sAuthorizedPrincipalsFile
block|,
name|sAuthorizedPrincipalsCommand
block|,
name|sAuthorizedPrincipalsCommandUser
block|,
name|sKexAlgorithms
block|,
name|sIPQoS
block|,
name|sVersionAddendum
block|,
name|sAuthorizedKeysCommand
block|,
name|sAuthorizedKeysCommandUser
block|,
name|sAuthenticationMethods
block|,
name|sHostKeyAgent
block|,
name|sPermitUserRC
block|,
name|sStreamLocalBindMask
block|,
name|sStreamLocalBindUnlink
block|,
name|sAllowStreamLocalForwarding
block|,
name|sFingerprintHash
block|,
name|sDeprecated
block|,
name|sUnsupported
block|}
name|ServerOpCodes
typedef|;
end_typedef

begin_define
define|#
directive|define
name|SSHCFG_GLOBAL
value|0x01
end_define

begin_comment
comment|/* allowed in main section of sshd_config */
end_comment

begin_define
define|#
directive|define
name|SSHCFG_MATCH
value|0x02
end_define

begin_comment
comment|/* allowed inside a Match section */
end_comment

begin_define
define|#
directive|define
name|SSHCFG_ALL
value|(SSHCFG_GLOBAL|SSHCFG_MATCH)
end_define

begin_comment
comment|/* Textual representation of the tokens. */
end_comment

begin_struct
specifier|static
struct|struct
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|ServerOpCodes
name|opcode
decl_stmt|;
name|u_int
name|flags
decl_stmt|;
block|}
name|keywords
index|[]
init|=
block|{
comment|/* Portable-specific options */
ifdef|#
directive|ifdef
name|USE_PAM
block|{
literal|"usepam"
block|,
name|sUsePAM
block|,
name|SSHCFG_GLOBAL
block|}
block|,
else|#
directive|else
block|{
literal|"usepam"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
endif|#
directive|endif
block|{
literal|"pamauthenticationviakbdint"
block|,
name|sDeprecated
block|,
name|SSHCFG_GLOBAL
block|}
block|,
comment|/* Standard Options */
block|{
literal|"port"
block|,
name|sPort
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"hostkey"
block|,
name|sHostKeyFile
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"hostdsakey"
block|,
name|sHostKeyFile
block|,
name|SSHCFG_GLOBAL
block|}
block|,
comment|/* alias */
block|{
literal|"hostkeyagent"
block|,
name|sHostKeyAgent
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"pidfile"
block|,
name|sPidFile
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"serverkeybits"
block|,
name|sServerKeyBits
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"logingracetime"
block|,
name|sLoginGraceTime
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"keyregenerationinterval"
block|,
name|sKeyRegenerationTime
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"permitrootlogin"
block|,
name|sPermitRootLogin
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"syslogfacility"
block|,
name|sLogFacility
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"loglevel"
block|,
name|sLogLevel
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"rhostsauthentication"
block|,
name|sDeprecated
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"rhostsrsaauthentication"
block|,
name|sRhostsRSAAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hostbasedauthentication"
block|,
name|sHostbasedAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hostbasedusesnamefrompacketonly"
block|,
name|sHostbasedUsesNameFromPacketOnly
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hostbasedacceptedkeytypes"
block|,
name|sHostbasedAcceptedKeyTypes
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hostkeyalgorithms"
block|,
name|sHostKeyAlgorithms
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"rsaauthentication"
block|,
name|sRSAAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"pubkeyauthentication"
block|,
name|sPubkeyAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"pubkeyacceptedkeytypes"
block|,
name|sPubkeyAcceptedKeyTypes
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"dsaauthentication"
block|,
name|sPubkeyAuthentication
block|,
name|SSHCFG_GLOBAL
block|}
block|,
comment|/* alias */
ifdef|#
directive|ifdef
name|KRB5
block|{
literal|"kerberosauthentication"
block|,
name|sKerberosAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"kerberosorlocalpasswd"
block|,
name|sKerberosOrLocalPasswd
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"kerberosticketcleanup"
block|,
name|sKerberosTicketCleanup
block|,
name|SSHCFG_GLOBAL
block|}
block|,
ifdef|#
directive|ifdef
name|USE_AFS
block|{
literal|"kerberosgetafstoken"
block|,
name|sKerberosGetAFSToken
block|,
name|SSHCFG_GLOBAL
block|}
block|,
else|#
directive|else
block|{
literal|"kerberosgetafstoken"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
endif|#
directive|endif
else|#
directive|else
block|{
literal|"kerberosauthentication"
block|,
name|sUnsupported
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"kerberosorlocalpasswd"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"kerberosticketcleanup"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"kerberosgetafstoken"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
endif|#
directive|endif
block|{
literal|"kerberostgtpassing"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"afstokenpassing"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
ifdef|#
directive|ifdef
name|GSSAPI
block|{
literal|"gssapiauthentication"
block|,
name|sGssAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"gssapicleanupcredentials"
block|,
name|sGssCleanupCreds
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"gssapistrictacceptorcheck"
block|,
name|sGssStrictAcceptor
block|,
name|SSHCFG_GLOBAL
block|}
block|,
else|#
directive|else
block|{
literal|"gssapiauthentication"
block|,
name|sUnsupported
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"gssapicleanupcredentials"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"gssapistrictacceptorcheck"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
endif|#
directive|endif
block|{
literal|"passwordauthentication"
block|,
name|sPasswordAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"kbdinteractiveauthentication"
block|,
name|sKbdInteractiveAuthentication
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"challengeresponseauthentication"
block|,
name|sChallengeResponseAuthentication
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"skeyauthentication"
block|,
name|sChallengeResponseAuthentication
block|,
name|SSHCFG_GLOBAL
block|}
block|,
comment|/* alias */
block|{
literal|"checkmail"
block|,
name|sDeprecated
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"listenaddress"
block|,
name|sListenAddress
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"addressfamily"
block|,
name|sAddressFamily
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"printmotd"
block|,
name|sPrintMotd
block|,
name|SSHCFG_GLOBAL
block|}
block|,
ifdef|#
directive|ifdef
name|DISABLE_LASTLOG
block|{
literal|"printlastlog"
block|,
name|sUnsupported
block|,
name|SSHCFG_GLOBAL
block|}
block|,
else|#
directive|else
block|{
literal|"printlastlog"
block|,
name|sPrintLastLog
block|,
name|SSHCFG_GLOBAL
block|}
block|,
endif|#
directive|endif
block|{
literal|"ignorerhosts"
block|,
name|sIgnoreRhosts
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"ignoreuserknownhosts"
block|,
name|sIgnoreUserKnownHosts
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"x11forwarding"
block|,
name|sX11Forwarding
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"x11displayoffset"
block|,
name|sX11DisplayOffset
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"x11uselocalhost"
block|,
name|sX11UseLocalhost
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"xauthlocation"
block|,
name|sXAuthLocation
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"strictmodes"
block|,
name|sStrictModes
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"permitemptypasswords"
block|,
name|sEmptyPasswd
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"permituserenvironment"
block|,
name|sPermitUserEnvironment
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"uselogin"
block|,
name|sUseLogin
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"compression"
block|,
name|sCompression
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"rekeylimit"
block|,
name|sRekeyLimit
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"tcpkeepalive"
block|,
name|sTCPKeepAlive
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"keepalive"
block|,
name|sTCPKeepAlive
block|,
name|SSHCFG_GLOBAL
block|}
block|,
comment|/* obsolete alias */
block|{
literal|"allowtcpforwarding"
block|,
name|sAllowTcpForwarding
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"allowagentforwarding"
block|,
name|sAllowAgentForwarding
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"allowusers"
block|,
name|sAllowUsers
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"denyusers"
block|,
name|sDenyUsers
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"allowgroups"
block|,
name|sAllowGroups
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"denygroups"
block|,
name|sDenyGroups
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"ciphers"
block|,
name|sCiphers
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"macs"
block|,
name|sMacs
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"protocol"
block|,
name|sProtocol
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"gatewayports"
block|,
name|sGatewayPorts
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"subsystem"
block|,
name|sSubsystem
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"maxstartups"
block|,
name|sMaxStartups
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"maxauthtries"
block|,
name|sMaxAuthTries
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"maxsessions"
block|,
name|sMaxSessions
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"banner"
block|,
name|sBanner
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"usedns"
block|,
name|sUseDNS
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"verifyreversemapping"
block|,
name|sDeprecated
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"reversemappingcheck"
block|,
name|sDeprecated
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"clientaliveinterval"
block|,
name|sClientAliveInterval
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"clientalivecountmax"
block|,
name|sClientAliveCountMax
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"authorizedkeysfile"
block|,
name|sAuthorizedKeysFile
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"authorizedkeysfile2"
block|,
name|sDeprecated
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"useprivilegeseparation"
block|,
name|sUsePrivilegeSeparation
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"acceptenv"
block|,
name|sAcceptEnv
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"permittunnel"
block|,
name|sPermitTunnel
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"permittty"
block|,
name|sPermitTTY
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"permituserrc"
block|,
name|sPermitUserRC
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"match"
block|,
name|sMatch
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"permitopen"
block|,
name|sPermitOpen
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"forcecommand"
block|,
name|sForceCommand
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"chrootdirectory"
block|,
name|sChrootDirectory
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hostcertificate"
block|,
name|sHostCertificate
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"revokedkeys"
block|,
name|sRevokedKeys
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"trustedusercakeys"
block|,
name|sTrustedUserCAKeys
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"authorizedprincipalsfile"
block|,
name|sAuthorizedPrincipalsFile
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"kexalgorithms"
block|,
name|sKexAlgorithms
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"ipqos"
block|,
name|sIPQoS
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"authorizedkeyscommand"
block|,
name|sAuthorizedKeysCommand
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"authorizedkeyscommanduser"
block|,
name|sAuthorizedKeysCommandUser
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"authorizedprincipalscommand"
block|,
name|sAuthorizedPrincipalsCommand
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"authorizedprincipalscommanduser"
block|,
name|sAuthorizedPrincipalsCommandUser
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"versionaddendum"
block|,
name|sVersionAddendum
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"authenticationmethods"
block|,
name|sAuthenticationMethods
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"streamlocalbindmask"
block|,
name|sStreamLocalBindMask
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"streamlocalbindunlink"
block|,
name|sStreamLocalBindUnlink
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"allowstreamlocalforwarding"
block|,
name|sAllowStreamLocalForwarding
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"fingerprinthash"
block|,
name|sFingerprintHash
block|,
name|SSHCFG_GLOBAL
block|}
block|,
block|{
literal|"noneenabled"
block|,
name|sUnsupported
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hpndisabled"
block|,
name|sDeprecated
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"hpnbuffersize"
block|,
name|sDeprecated
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
literal|"tcprcvbufpoll"
block|,
name|sDeprecated
block|,
name|SSHCFG_ALL
block|}
block|,
block|{
name|NULL
block|,
name|sBadOption
block|,
literal|0
block|}
block|}
struct|;
end_struct

begin_struct
specifier|static
struct|struct
block|{
name|int
name|val
decl_stmt|;
name|char
modifier|*
name|text
decl_stmt|;
block|}
name|tunmode_desc
index|[]
init|=
block|{
block|{
name|SSH_TUNMODE_NO
block|,
literal|"no"
block|}
block|,
block|{
name|SSH_TUNMODE_POINTOPOINT
block|,
literal|"point-to-point"
block|}
block|,
block|{
name|SSH_TUNMODE_ETHERNET
block|,
literal|"ethernet"
block|}
block|,
block|{
name|SSH_TUNMODE_YES
block|,
literal|"yes"
block|}
block|,
block|{
operator|-
literal|1
block|,
name|NULL
block|}
block|}
struct|;
end_struct

begin_comment
comment|/*  * Returns the number of the token pointed to by cp or sBadOption.  */
end_comment

begin_function
specifier|static
name|ServerOpCodes
name|parse_token
parameter_list|(
specifier|const
name|char
modifier|*
name|cp
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|int
name|linenum
parameter_list|,
name|u_int
modifier|*
name|flags
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|keywords
index|[
name|i
index|]
operator|.
name|name
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcasecmp
argument_list|(
name|cp
argument_list|,
name|keywords
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|flags
operator|=
name|keywords
index|[
name|i
index|]
operator|.
name|flags
expr_stmt|;
return|return
name|keywords
index|[
name|i
index|]
operator|.
name|opcode
return|;
block|}
name|error
argument_list|(
literal|"%s: line %d: Bad configuration option: %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|cp
argument_list|)
expr_stmt|;
return|return
name|sBadOption
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|derelativise_path
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|)
block|{
name|char
modifier|*
name|expanded
decl_stmt|,
modifier|*
name|ret
decl_stmt|,
name|cwd
index|[
name|PATH_MAX
index|]
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|path
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|xstrdup
argument_list|(
literal|"none"
argument_list|)
return|;
name|expanded
operator|=
name|tilde_expand_filename
argument_list|(
name|path
argument_list|,
name|getuid
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|expanded
operator|==
literal|'/'
condition|)
return|return
name|expanded
return|;
if|if
condition|(
name|getcwd
argument_list|(
name|cwd
argument_list|,
sizeof|sizeof
argument_list|(
name|cwd
argument_list|)
argument_list|)
operator|==
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%s: getcwd: %s"
argument_list|,
name|__func__
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|xasprintf
argument_list|(
operator|&
name|ret
argument_list|,
literal|"%s/%s"
argument_list|,
name|cwd
argument_list|,
name|expanded
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|expanded
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|add_listen_addr
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|,
name|char
modifier|*
name|addr
parameter_list|,
name|int
name|port
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|port
operator|==
literal|0
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|options
operator|->
name|num_ports
condition|;
name|i
operator|++
control|)
name|add_one_listen_addr
argument_list|(
name|options
argument_list|,
name|addr
argument_list|,
name|options
operator|->
name|ports
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|add_one_listen_addr
argument_list|(
name|options
argument_list|,
name|addr
argument_list|,
name|port
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|add_one_listen_addr
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|,
name|char
modifier|*
name|addr
parameter_list|,
name|int
name|port
parameter_list|)
block|{
name|struct
name|addrinfo
name|hints
decl_stmt|,
modifier|*
name|ai
decl_stmt|,
modifier|*
name|aitop
decl_stmt|;
name|char
name|strport
index|[
name|NI_MAXSERV
index|]
decl_stmt|;
name|int
name|gaierr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|hints
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|hints
argument_list|)
argument_list|)
expr_stmt|;
name|hints
operator|.
name|ai_family
operator|=
name|options
operator|->
name|address_family
expr_stmt|;
name|hints
operator|.
name|ai_socktype
operator|=
name|SOCK_STREAM
expr_stmt|;
name|hints
operator|.
name|ai_flags
operator|=
operator|(
name|addr
operator|==
name|NULL
operator|)
condition|?
name|AI_PASSIVE
else|:
literal|0
expr_stmt|;
name|snprintf
argument_list|(
name|strport
argument_list|,
sizeof|sizeof
name|strport
argument_list|,
literal|"%d"
argument_list|,
name|port
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|gaierr
operator|=
name|getaddrinfo
argument_list|(
name|addr
argument_list|,
name|strport
argument_list|,
operator|&
name|hints
argument_list|,
operator|&
name|aitop
argument_list|)
operator|)
operator|!=
literal|0
condition|)
name|fatal
argument_list|(
literal|"bad addr or host: %s (%s)"
argument_list|,
name|addr
condition|?
name|addr
else|:
literal|"<NULL>"
argument_list|,
name|ssh_gai_strerror
argument_list|(
name|gaierr
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|ai
operator|=
name|aitop
init|;
name|ai
operator|->
name|ai_next
condition|;
name|ai
operator|=
name|ai
operator|->
name|ai_next
control|)
empty_stmt|;
name|ai
operator|->
name|ai_next
operator|=
name|options
operator|->
name|listen_addrs
expr_stmt|;
name|options
operator|->
name|listen_addrs
operator|=
name|aitop
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Queue a ListenAddress to be processed once we have all of the Ports  * and AddressFamily options.  */
end_comment

begin_function
specifier|static
name|void
name|queue_listen_addr
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|,
name|char
modifier|*
name|addr
parameter_list|,
name|int
name|port
parameter_list|)
block|{
name|options
operator|->
name|queued_listen_addrs
operator|=
name|xreallocarray
argument_list|(
name|options
operator|->
name|queued_listen_addrs
argument_list|,
name|options
operator|->
name|num_queued_listens
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|addr
argument_list|)
argument_list|)
expr_stmt|;
name|options
operator|->
name|queued_listen_ports
operator|=
name|xreallocarray
argument_list|(
name|options
operator|->
name|queued_listen_ports
argument_list|,
name|options
operator|->
name|num_queued_listens
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|port
argument_list|)
argument_list|)
expr_stmt|;
name|options
operator|->
name|queued_listen_addrs
index|[
name|options
operator|->
name|num_queued_listens
index|]
operator|=
name|xstrdup
argument_list|(
name|addr
argument_list|)
expr_stmt|;
name|options
operator|->
name|queued_listen_ports
index|[
name|options
operator|->
name|num_queued_listens
index|]
operator|=
name|port
expr_stmt|;
name|options
operator|->
name|num_queued_listens
operator|++
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Process queued (text) ListenAddress entries.  */
end_comment

begin_function
specifier|static
name|void
name|process_queued_listen_addrs
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|options
operator|->
name|num_ports
operator|==
literal|0
condition|)
name|options
operator|->
name|ports
index|[
name|options
operator|->
name|num_ports
operator|++
index|]
operator|=
name|SSH_DEFAULT_PORT
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|address_family
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|address_family
operator|=
name|AF_UNSPEC
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|options
operator|->
name|num_queued_listens
condition|;
name|i
operator|++
control|)
block|{
name|add_listen_addr
argument_list|(
name|options
argument_list|,
name|options
operator|->
name|queued_listen_addrs
index|[
name|i
index|]
argument_list|,
name|options
operator|->
name|queued_listen_ports
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|options
operator|->
name|queued_listen_addrs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|options
operator|->
name|queued_listen_addrs
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
name|free
argument_list|(
name|options
operator|->
name|queued_listen_addrs
argument_list|)
expr_stmt|;
name|options
operator|->
name|queued_listen_addrs
operator|=
name|NULL
expr_stmt|;
name|free
argument_list|(
name|options
operator|->
name|queued_listen_ports
argument_list|)
expr_stmt|;
name|options
operator|->
name|queued_listen_ports
operator|=
name|NULL
expr_stmt|;
name|options
operator|->
name|num_queued_listens
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|struct
name|connection_info
modifier|*
name|get_connection_info
parameter_list|(
name|int
name|populate
parameter_list|,
name|int
name|use_dns
parameter_list|)
block|{
name|struct
name|ssh
modifier|*
name|ssh
init|=
name|active_state
decl_stmt|;
comment|/* XXX */
specifier|static
name|struct
name|connection_info
name|ci
decl_stmt|;
if|if
condition|(
operator|!
name|populate
condition|)
return|return
operator|&
name|ci
return|;
name|ci
operator|.
name|host
operator|=
name|auth_get_canonical_hostname
argument_list|(
name|ssh
argument_list|,
name|use_dns
argument_list|)
expr_stmt|;
name|ci
operator|.
name|address
operator|=
name|ssh_remote_ipaddr
argument_list|(
name|ssh
argument_list|)
expr_stmt|;
name|ci
operator|.
name|laddress
operator|=
name|ssh_local_ipaddr
argument_list|(
name|ssh
argument_list|)
expr_stmt|;
name|ci
operator|.
name|lport
operator|=
name|ssh_local_port
argument_list|(
name|ssh
argument_list|)
expr_stmt|;
return|return
operator|&
name|ci
return|;
block|}
end_function

begin_comment
comment|/*  * The strategy for the Match blocks is that the config file is parsed twice.  *  * The first time is at startup.  activep is initialized to 1 and the  * directives in the global context are processed and acted on.  Hitting a  * Match directive unsets activep and the directives inside the block are  * checked for syntax only.  *  * The second time is after a connection has been established but before  * authentication.  activep is initialized to 2 and global config directives  * are ignored since they have already been processed.  If the criteria in a  * Match block is met, activep is set and the subsequent directives  * processed and actioned until EOF or another Match block unsets it.  Any  * options set are copied into the main server config.  *  * Potential additions/improvements:  *  - Add Match support for pre-kex directives, eg Protocol, Ciphers.  *  *  - Add a Tag directive (idea from David Leonard) ala pf, eg:  *	Match Address 192.168.0.*  *		Tag trusted  *	Match Group wheel  *		Tag trusted  *	Match Tag trusted  *		AllowTcpForwarding yes  *		GatewayPorts clientspecified  *		[...]  *  *  - Add a PermittedChannelRequests directive  *	Match Group shell  *		PermittedChannelRequests session,forwarded-tcpip  */
end_comment

begin_function
specifier|static
name|int
name|match_cfg_line_group
parameter_list|(
specifier|const
name|char
modifier|*
name|grps
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|user
parameter_list|)
block|{
name|int
name|result
init|=
literal|0
decl_stmt|;
name|struct
name|passwd
modifier|*
name|pw
decl_stmt|;
if|if
condition|(
name|user
operator|==
name|NULL
condition|)
goto|goto
name|out
goto|;
if|if
condition|(
operator|(
name|pw
operator|=
name|getpwnam
argument_list|(
name|user
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|debug
argument_list|(
literal|"Can't match group at line %d because user %.100s does "
literal|"not exist"
argument_list|,
name|line
argument_list|,
name|user
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ga_init
argument_list|(
name|pw
operator|->
name|pw_name
argument_list|,
name|pw
operator|->
name|pw_gid
argument_list|)
operator|==
literal|0
condition|)
block|{
name|debug
argument_list|(
literal|"Can't Match group because user %.100s not in any group "
literal|"at line %d"
argument_list|,
name|user
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ga_match_pattern_list
argument_list|(
name|grps
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|debug
argument_list|(
literal|"user %.100s does not match group list %.100s at line %d"
argument_list|,
name|user
argument_list|,
name|grps
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|debug
argument_list|(
literal|"user %.100s matched group list %.100s at line %d"
argument_list|,
name|user
argument_list|,
name|grps
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|result
operator|=
literal|1
expr_stmt|;
block|}
name|out
label|:
name|ga_free
argument_list|()
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_comment
comment|/*  * All of the attributes on a single Match line are ANDed together, so we need  * to check every attribute and set the result to zero if any attribute does  * not match.  */
end_comment

begin_function
specifier|static
name|int
name|match_cfg_line
parameter_list|(
name|char
modifier|*
modifier|*
name|condition
parameter_list|,
name|int
name|line
parameter_list|,
name|struct
name|connection_info
modifier|*
name|ci
parameter_list|)
block|{
name|int
name|result
init|=
literal|1
decl_stmt|,
name|attributes
init|=
literal|0
decl_stmt|,
name|port
decl_stmt|;
name|char
modifier|*
name|arg
decl_stmt|,
modifier|*
name|attrib
decl_stmt|,
modifier|*
name|cp
init|=
operator|*
name|condition
decl_stmt|;
if|if
condition|(
name|ci
operator|==
name|NULL
condition|)
name|debug3
argument_list|(
literal|"checking syntax for 'Match %s'"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
else|else
name|debug3
argument_list|(
literal|"checking match for '%s' user %s host %s addr %s "
literal|"laddr %s lport %d"
argument_list|,
name|cp
argument_list|,
name|ci
operator|->
name|user
condition|?
name|ci
operator|->
name|user
else|:
literal|"(null)"
argument_list|,
name|ci
operator|->
name|host
condition|?
name|ci
operator|->
name|host
else|:
literal|"(null)"
argument_list|,
name|ci
operator|->
name|address
condition|?
name|ci
operator|->
name|address
else|:
literal|"(null)"
argument_list|,
name|ci
operator|->
name|laddress
condition|?
name|ci
operator|->
name|laddress
else|:
literal|"(null)"
argument_list|,
name|ci
operator|->
name|lport
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|attrib
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|attrib
operator|!=
literal|'\0'
condition|)
block|{
name|attributes
operator|++
expr_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"all"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|attributes
operator|!=
literal|1
operator|||
operator|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
operator|)
condition|)
block|{
name|error
argument_list|(
literal|"'all' cannot be combined with other "
literal|"Match attributes"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|condition
operator|=
name|cp
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
block|{
name|error
argument_list|(
literal|"Missing Match criteria for %s"
argument_list|,
name|attrib
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"user"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ci
operator|==
name|NULL
operator|||
name|ci
operator|->
name|user
operator|==
name|NULL
condition|)
block|{
name|result
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|match_pattern_list
argument_list|(
name|ci
operator|->
name|user
argument_list|,
name|arg
argument_list|,
literal|0
argument_list|)
operator|!=
literal|1
condition|)
name|result
operator|=
literal|0
expr_stmt|;
else|else
name|debug
argument_list|(
literal|"user %.100s matched 'User %.100s' at "
literal|"line %d"
argument_list|,
name|ci
operator|->
name|user
argument_list|,
name|arg
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"group"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ci
operator|==
name|NULL
operator|||
name|ci
operator|->
name|user
operator|==
name|NULL
condition|)
block|{
name|result
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
switch|switch
condition|(
name|match_cfg_line_group
argument_list|(
name|arg
argument_list|,
name|line
argument_list|,
name|ci
operator|->
name|user
argument_list|)
condition|)
block|{
case|case
operator|-
literal|1
case|:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
name|result
operator|=
literal|0
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"host"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ci
operator|==
name|NULL
operator|||
name|ci
operator|->
name|host
operator|==
name|NULL
condition|)
block|{
name|result
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|match_hostname
argument_list|(
name|ci
operator|->
name|host
argument_list|,
name|arg
argument_list|)
operator|!=
literal|1
condition|)
name|result
operator|=
literal|0
expr_stmt|;
else|else
name|debug
argument_list|(
literal|"connection from %.100s matched 'Host "
literal|"%.100s' at line %d"
argument_list|,
name|ci
operator|->
name|host
argument_list|,
name|arg
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"address"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ci
operator|==
name|NULL
operator|||
name|ci
operator|->
name|address
operator|==
name|NULL
condition|)
block|{
name|result
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
switch|switch
condition|(
name|addr_match_list
argument_list|(
name|ci
operator|->
name|address
argument_list|,
name|arg
argument_list|)
condition|)
block|{
case|case
literal|1
case|:
name|debug
argument_list|(
literal|"connection from %.100s matched 'Address "
literal|"%.100s' at line %d"
argument_list|,
name|ci
operator|->
name|address
argument_list|,
name|arg
argument_list|,
name|line
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
case|case
operator|-
literal|1
case|:
name|result
operator|=
literal|0
expr_stmt|;
break|break;
case|case
operator|-
literal|2
case|:
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"localaddress"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ci
operator|==
name|NULL
operator|||
name|ci
operator|->
name|laddress
operator|==
name|NULL
condition|)
block|{
name|result
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
switch|switch
condition|(
name|addr_match_list
argument_list|(
name|ci
operator|->
name|laddress
argument_list|,
name|arg
argument_list|)
condition|)
block|{
case|case
literal|1
case|:
name|debug
argument_list|(
literal|"connection from %.100s matched "
literal|"'LocalAddress %.100s' at line %d"
argument_list|,
name|ci
operator|->
name|laddress
argument_list|,
name|arg
argument_list|,
name|line
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
case|case
operator|-
literal|1
case|:
name|result
operator|=
literal|0
expr_stmt|;
break|break;
case|case
operator|-
literal|2
case|:
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|attrib
argument_list|,
literal|"localport"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|port
operator|=
name|a2port
argument_list|(
name|arg
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"Invalid LocalPort '%s' on Match line"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ci
operator|==
name|NULL
operator|||
name|ci
operator|->
name|lport
operator|==
literal|0
condition|)
block|{
name|result
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
comment|/* TODO support port lists */
if|if
condition|(
name|port
operator|==
name|ci
operator|->
name|lport
condition|)
name|debug
argument_list|(
literal|"connection from %.100s matched "
literal|"'LocalPort %d' at line %d"
argument_list|,
name|ci
operator|->
name|laddress
argument_list|,
name|port
argument_list|,
name|line
argument_list|)
expr_stmt|;
else|else
name|result
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|error
argument_list|(
literal|"Unsupported Match attribute %s"
argument_list|,
name|attrib
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|attributes
operator|==
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"One or more attributes required for Match"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ci
operator|!=
name|NULL
condition|)
name|debug3
argument_list|(
literal|"match %sfound"
argument_list|,
name|result
condition|?
literal|""
else|:
literal|"not "
argument_list|)
expr_stmt|;
operator|*
name|condition
operator|=
name|cp
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_define
define|#
directive|define
name|WHITESPACE
value|" \t\r\n"
end_define

begin_comment
comment|/* Multistate option parsing */
end_comment

begin_struct
struct|struct
name|multistate
block|{
name|char
modifier|*
name|key
decl_stmt|;
name|int
name|value
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|multistate
name|multistate_addressfamily
index|[]
init|=
block|{
block|{
literal|"inet"
block|,
name|AF_INET
block|}
block|,
block|{
literal|"inet6"
block|,
name|AF_INET6
block|}
block|,
block|{
literal|"any"
block|,
name|AF_UNSPEC
block|}
block|,
block|{
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|multistate
name|multistate_permitrootlogin
index|[]
init|=
block|{
block|{
literal|"without-password"
block|,
name|PERMIT_NO_PASSWD
block|}
block|,
block|{
literal|"prohibit-password"
block|,
name|PERMIT_NO_PASSWD
block|}
block|,
block|{
literal|"forced-commands-only"
block|,
name|PERMIT_FORCED_ONLY
block|}
block|,
block|{
literal|"yes"
block|,
name|PERMIT_YES
block|}
block|,
block|{
literal|"no"
block|,
name|PERMIT_NO
block|}
block|,
block|{
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|multistate
name|multistate_compression
index|[]
init|=
block|{
block|{
literal|"delayed"
block|,
name|COMP_DELAYED
block|}
block|,
block|{
literal|"yes"
block|,
name|COMP_ZLIB
block|}
block|,
block|{
literal|"no"
block|,
name|COMP_NONE
block|}
block|,
block|{
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|multistate
name|multistate_gatewayports
index|[]
init|=
block|{
block|{
literal|"clientspecified"
block|,
literal|2
block|}
block|,
block|{
literal|"yes"
block|,
literal|1
block|}
block|,
block|{
literal|"no"
block|,
literal|0
block|}
block|,
block|{
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|multistate
name|multistate_privsep
index|[]
init|=
block|{
block|{
literal|"yes"
block|,
name|PRIVSEP_NOSANDBOX
block|}
block|,
block|{
literal|"sandbox"
block|,
name|PRIVSEP_ON
block|}
block|,
block|{
literal|"nosandbox"
block|,
name|PRIVSEP_NOSANDBOX
block|}
block|,
block|{
literal|"no"
block|,
name|PRIVSEP_OFF
block|}
block|,
block|{
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|multistate
name|multistate_tcpfwd
index|[]
init|=
block|{
block|{
literal|"yes"
block|,
name|FORWARD_ALLOW
block|}
block|,
block|{
literal|"all"
block|,
name|FORWARD_ALLOW
block|}
block|,
block|{
literal|"no"
block|,
name|FORWARD_DENY
block|}
block|,
block|{
literal|"remote"
block|,
name|FORWARD_REMOTE
block|}
block|,
block|{
literal|"local"
block|,
name|FORWARD_LOCAL
block|}
block|,
block|{
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|process_server_config_line
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|,
name|char
modifier|*
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|int
name|linenum
parameter_list|,
name|int
modifier|*
name|activep
parameter_list|,
name|struct
name|connection_info
modifier|*
name|connectinfo
parameter_list|)
block|{
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
modifier|*
name|charptr
decl_stmt|,
modifier|*
name|arg
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|int
name|cmdline
init|=
literal|0
decl_stmt|,
modifier|*
name|intptr
decl_stmt|,
name|value
decl_stmt|,
name|value2
decl_stmt|,
name|n
decl_stmt|,
name|port
decl_stmt|;
name|SyslogFacility
modifier|*
name|log_facility_ptr
decl_stmt|;
name|LogLevel
modifier|*
name|log_level_ptr
decl_stmt|;
name|ServerOpCodes
name|opcode
decl_stmt|;
name|u_int
name|i
decl_stmt|,
name|flags
init|=
literal|0
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|long
name|long
name|val64
decl_stmt|;
specifier|const
name|struct
name|multistate
modifier|*
name|multistate_ptr
decl_stmt|;
name|cp
operator|=
name|line
expr_stmt|;
if|if
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
comment|/* Ignore leading whitespace */
if|if
condition|(
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|!
operator|*
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'#'
condition|)
return|return
literal|0
return|;
name|intptr
operator|=
name|NULL
expr_stmt|;
name|charptr
operator|=
name|NULL
expr_stmt|;
name|opcode
operator|=
name|parse_token
argument_list|(
name|arg
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
operator|&
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|activep
operator|==
name|NULL
condition|)
block|{
comment|/* We are processing a command line directive */
name|cmdline
operator|=
literal|1
expr_stmt|;
name|activep
operator|=
operator|&
name|cmdline
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|activep
operator|&&
name|opcode
operator|!=
name|sMatch
condition|)
name|debug3
argument_list|(
literal|"%s:%d setting %s %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|,
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|==
literal|0
operator|&&
operator|!
operator|(
name|flags
operator|&
name|SSHCFG_MATCH
operator|)
condition|)
block|{
if|if
condition|(
name|connectinfo
operator|==
name|NULL
condition|)
block|{
name|fatal
argument_list|(
literal|"%s line %d: Directive '%s' is not allowed "
literal|"within a Match block"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* this is a directive we have already processed */
while|while
condition|(
name|arg
condition|)
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
switch|switch
condition|(
name|opcode
condition|)
block|{
comment|/* Portable-specific options */
case|case
name|sUsePAM
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|use_pam
expr_stmt|;
goto|goto
name|parse_flag
goto|;
comment|/* Standard Options */
case|case
name|sBadOption
case|:
return|return
operator|-
literal|1
return|;
case|case
name|sPort
case|:
comment|/* ignore ports from configfile if cmdline specifies ports */
if|if
condition|(
name|options
operator|->
name|ports_from_cmdline
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|options
operator|->
name|num_ports
operator|>=
name|MAX_PORTS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many ports."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing port number."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|options
operator|->
name|ports
index|[
name|options
operator|->
name|num_ports
operator|++
index|]
operator|=
name|a2port
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|ports
index|[
name|options
operator|->
name|num_ports
operator|-
literal|1
index|]
operator|<=
literal|0
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Badly formatted port number."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
break|break;
case|case
name|sServerKeyBits
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|server_key_bits
expr_stmt|;
name|parse_int
label|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing integer value."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|value
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|intptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|intptr
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sLoginGraceTime
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|login_grace_time
expr_stmt|;
name|parse_time
label|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing time value."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|=
name|convtime
argument_list|(
name|arg
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: invalid time value."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|intptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|intptr
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sKeyRegenerationTime
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|key_regeneration_time
expr_stmt|;
goto|goto
name|parse_time
goto|;
case|case
name|sListenAddress
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|==
name|NULL
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing address"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
comment|/* check for bare IPv6 address: no "[]" and 2 or more ":" */
if|if
condition|(
name|strchr
argument_list|(
name|arg
argument_list|,
literal|'['
argument_list|)
operator|==
name|NULL
operator|&&
operator|(
name|p
operator|=
name|strchr
argument_list|(
name|arg
argument_list|,
literal|':'
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
name|strchr
argument_list|(
name|p
operator|+
literal|1
argument_list|,
literal|':'
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|queue_listen_addr
argument_list|(
name|options
argument_list|,
name|arg
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
name|p
operator|=
name|hpdelim
argument_list|(
operator|&
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%s line %d: bad address:port usage"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|p
operator|=
name|cleanhostname
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|==
name|NULL
condition|)
name|port
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|port
operator|=
name|a2port
argument_list|(
name|arg
argument_list|)
operator|)
operator|<=
literal|0
condition|)
name|fatal
argument_list|(
literal|"%s line %d: bad port number"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|queue_listen_addr
argument_list|(
name|options
argument_list|,
name|p
argument_list|,
name|port
argument_list|)
expr_stmt|;
break|break;
case|case
name|sAddressFamily
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|address_family
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_addressfamily
expr_stmt|;
name|parse_multistate
label|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|value
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|multistate_ptr
index|[
name|i
index|]
operator|.
name|key
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcasecmp
argument_list|(
name|arg
argument_list|,
name|multistate_ptr
index|[
name|i
index|]
operator|.
name|key
argument_list|)
operator|==
literal|0
condition|)
block|{
name|value
operator|=
name|multistate_ptr
index|[
name|i
index|]
operator|.
name|value
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|value
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: unsupported option \"%s\"."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|intptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|intptr
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sHostKeyFile
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|num_host_key_files
expr_stmt|;
if|if
condition|(
operator|*
name|intptr
operator|>=
name|MAX_HOSTKEYS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many host keys specified (max %d)."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|MAX_HOSTKEYS
argument_list|)
expr_stmt|;
name|charptr
operator|=
operator|&
name|options
operator|->
name|host_key_files
index|[
operator|*
name|intptr
index|]
expr_stmt|;
name|parse_filename
label|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing file name."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
block|{
operator|*
name|charptr
operator|=
name|derelativise_path
argument_list|(
name|arg
argument_list|)
expr_stmt|;
comment|/* increase optional counter */
if|if
condition|(
name|intptr
operator|!=
name|NULL
condition|)
operator|*
name|intptr
operator|=
operator|*
name|intptr
operator|+
literal|1
expr_stmt|;
block|}
break|break;
case|case
name|sHostKeyAgent
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|host_key_agent
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing socket name."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
operator|*
name|charptr
operator|=
operator|!
name|strcmp
argument_list|(
name|arg
argument_list|,
name|SSH_AUTHSOCKET_ENV_NAME
argument_list|)
condition|?
name|xstrdup
argument_list|(
name|arg
argument_list|)
else|:
name|derelativise_path
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sHostCertificate
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|num_host_cert_files
expr_stmt|;
if|if
condition|(
operator|*
name|intptr
operator|>=
name|MAX_HOSTKEYS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many host certificates "
literal|"specified (max %d)."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|MAX_HOSTCERTS
argument_list|)
expr_stmt|;
name|charptr
operator|=
operator|&
name|options
operator|->
name|host_cert_files
index|[
operator|*
name|intptr
index|]
expr_stmt|;
goto|goto
name|parse_filename
goto|;
break|break;
case|case
name|sPidFile
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|pid_file
expr_stmt|;
goto|goto
name|parse_filename
goto|;
case|case
name|sPermitRootLogin
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|permit_root_login
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_permitrootlogin
expr_stmt|;
goto|goto
name|parse_multistate
goto|;
case|case
name|sIgnoreRhosts
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|ignore_rhosts
expr_stmt|;
name|parse_flag
label|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing yes/no argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|value
operator|=
literal|0
expr_stmt|;
comment|/* silence compiler */
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"yes"
argument_list|)
operator|==
literal|0
condition|)
name|value
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"no"
argument_list|)
operator|==
literal|0
condition|)
name|value
operator|=
literal|0
expr_stmt|;
else|else
name|fatal
argument_list|(
literal|"%s line %d: Bad yes/no argument: %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|intptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|intptr
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sIgnoreUserKnownHosts
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|ignore_user_known_hosts
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sRhostsRSAAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|rhosts_rsa_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sHostbasedAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|hostbased_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sHostbasedUsesNameFromPacketOnly
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|hostbased_uses_name_from_packet_only
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sHostbasedAcceptedKeyTypes
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|hostbased_key_types
expr_stmt|;
name|parse_keytypes
label|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|sshkey_names_valid2
argument_list|(
operator|*
name|arg
operator|==
literal|'+'
condition|?
name|arg
operator|+
literal|1
else|:
name|arg
argument_list|,
literal|1
argument_list|)
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad key types '%s'."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
operator|*
name|charptr
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sHostKeyAlgorithms
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|hostkeyalgorithms
expr_stmt|;
goto|goto
name|parse_keytypes
goto|;
case|case
name|sRSAAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|rsa_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPubkeyAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|pubkey_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPubkeyAcceptedKeyTypes
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|pubkey_key_types
expr_stmt|;
goto|goto
name|parse_keytypes
goto|;
case|case
name|sKerberosAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|kerberos_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sKerberosOrLocalPasswd
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|kerberos_or_local_passwd
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sKerberosTicketCleanup
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|kerberos_ticket_cleanup
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sKerberosGetAFSToken
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|kerberos_get_afs_token
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sGssAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|gss_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sGssCleanupCreds
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|gss_cleanup_creds
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sGssStrictAcceptor
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|gss_strict_acceptor
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPasswordAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|password_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sKbdInteractiveAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|kbd_interactive_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sChallengeResponseAuthentication
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|challenge_response_authentication
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPrintMotd
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|print_motd
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPrintLastLog
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|print_lastlog
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sX11Forwarding
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|x11_forwarding
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sX11DisplayOffset
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|x11_display_offset
expr_stmt|;
goto|goto
name|parse_int
goto|;
case|case
name|sX11UseLocalhost
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|x11_use_localhost
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sXAuthLocation
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|xauth_location
expr_stmt|;
goto|goto
name|parse_filename
goto|;
case|case
name|sPermitTTY
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|permit_tty
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPermitUserRC
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|permit_user_rc
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sStrictModes
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|strict_modes
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sTCPKeepAlive
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|tcp_keep_alive
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sEmptyPasswd
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|permit_empty_passwd
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sPermitUserEnvironment
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|permit_user_env
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sUseLogin
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|use_login
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sCompression
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|compression
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_compression
expr_stmt|;
goto|goto
name|parse_multistate
goto|;
case|case
name|sRekeyLimit
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"default"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|val64
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|scan_scaled
argument_list|(
name|arg
argument_list|,
operator|&
name|val64
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Bad number '%s': %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|val64
operator|!=
literal|0
operator|&&
name|val64
operator|<
literal|16
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: RekeyLimit too small"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|activep
operator|&&
name|options
operator|->
name|rekey_limit
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|rekey_limit
operator|=
name|val64
expr_stmt|;
if|if
condition|(
name|cp
operator|!=
name|NULL
condition|)
block|{
comment|/* optional rekey interval present */
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
comment|/* discard */
break|break;
block|}
name|intptr
operator|=
operator|&
name|options
operator|->
name|rekey_interval
expr_stmt|;
goto|goto
name|parse_time
goto|;
block|}
break|break;
case|case
name|sGatewayPorts
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|fwd_opts
operator|.
name|gateway_ports
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_gatewayports
expr_stmt|;
goto|goto
name|parse_multistate
goto|;
case|case
name|sUseDNS
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|use_dns
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sLogFacility
case|:
name|log_facility_ptr
operator|=
operator|&
name|options
operator|->
name|log_facility
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
name|value
operator|=
name|log_facility_number
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|SYSLOG_FACILITY_NOT_SET
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: unsupported log facility '%s'"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|log_facility_ptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|log_facility_ptr
operator|=
operator|(
name|SyslogFacility
operator|)
name|value
expr_stmt|;
break|break;
case|case
name|sLogLevel
case|:
name|log_level_ptr
operator|=
operator|&
name|options
operator|->
name|log_level
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
name|value
operator|=
name|log_level_number
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|SYSLOG_LEVEL_NOT_SET
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: unsupported log level '%s'"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|log_level_ptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|log_level_ptr
operator|=
operator|(
name|LogLevel
operator|)
name|value
expr_stmt|;
break|break;
case|case
name|sAllowTcpForwarding
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|allow_tcp_forwarding
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_tcpfwd
expr_stmt|;
goto|goto
name|parse_multistate
goto|;
case|case
name|sAllowStreamLocalForwarding
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|allow_streamlocal_forwarding
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_tcpfwd
expr_stmt|;
goto|goto
name|parse_multistate
goto|;
case|case
name|sAllowAgentForwarding
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|allow_agent_forwarding
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sUsePrivilegeSeparation
case|:
name|intptr
operator|=
operator|&
name|use_privsep
expr_stmt|;
name|multistate_ptr
operator|=
name|multistate_privsep
expr_stmt|;
goto|goto
name|parse_multistate
goto|;
case|case
name|sAllowUsers
case|:
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_allow_users
operator|>=
name|MAX_ALLOW_USERS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many allow users."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
continue|continue;
name|options
operator|->
name|allow_users
index|[
name|options
operator|->
name|num_allow_users
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|sDenyUsers
case|:
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_deny_users
operator|>=
name|MAX_DENY_USERS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many deny users."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
continue|continue;
name|options
operator|->
name|deny_users
index|[
name|options
operator|->
name|num_deny_users
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|sAllowGroups
case|:
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_allow_groups
operator|>=
name|MAX_ALLOW_GROUPS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many allow groups."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
continue|continue;
name|options
operator|->
name|allow_groups
index|[
name|options
operator|->
name|num_allow_groups
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|sDenyGroups
case|:
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_deny_groups
operator|>=
name|MAX_DENY_GROUPS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many deny groups."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
continue|continue;
name|options
operator|->
name|deny_groups
index|[
name|options
operator|->
name|num_deny_groups
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|sCiphers
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ciphers_valid
argument_list|(
operator|*
name|arg
operator|==
literal|'+'
condition|?
name|arg
operator|+
literal|1
else|:
name|arg
argument_list|)
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad SSH2 cipher spec '%s'."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|ciphers
operator|==
name|NULL
condition|)
name|options
operator|->
name|ciphers
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sMacs
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|mac_valid
argument_list|(
operator|*
name|arg
operator|==
literal|'+'
condition|?
name|arg
operator|+
literal|1
else|:
name|arg
argument_list|)
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad SSH2 mac spec '%s'."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|macs
operator|==
name|NULL
condition|)
name|options
operator|->
name|macs
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sKexAlgorithms
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|kex_names_valid
argument_list|(
operator|*
name|arg
operator|==
literal|'+'
condition|?
name|arg
operator|+
literal|1
else|:
name|arg
argument_list|)
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad SSH2 KexAlgorithms '%s'."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|kex_algorithms
operator|==
name|NULL
condition|)
name|options
operator|->
name|kex_algorithms
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sProtocol
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|protocol
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|value
operator|=
name|proto_spec
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|SSH_PROTO_UNKNOWN
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad protocol spec '%s'."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
condition|?
name|arg
else|:
literal|"<NONE>"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|intptr
operator|==
name|SSH_PROTO_UNKNOWN
condition|)
operator|*
name|intptr
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sSubsystem
case|:
if|if
condition|(
name|options
operator|->
name|num_subsystems
operator|>=
name|MAX_SUBSYSTEMS
condition|)
block|{
name|fatal
argument_list|(
literal|"%s line %d: too many subsystems defined."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing subsystem name."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
block|{
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|options
operator|->
name|num_subsystems
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
name|options
operator|->
name|subsystem_name
index|[
name|i
index|]
argument_list|)
operator|==
literal|0
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Subsystem '%s' already defined."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|options
operator|->
name|subsystem_name
index|[
name|options
operator|->
name|num_subsystems
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing subsystem command."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|options
operator|->
name|subsystem_command
index|[
name|options
operator|->
name|num_subsystems
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
comment|/* Collect arguments (separate to executable) */
name|p
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|p
argument_list|)
operator|+
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
name|len
operator|+=
literal|1
operator|+
name|strlen
argument_list|(
name|arg
argument_list|)
expr_stmt|;
name|p
operator|=
name|xreallocarray
argument_list|(
name|p
argument_list|,
literal|1
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|strlcat
argument_list|(
name|p
argument_list|,
literal|" "
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|strlcat
argument_list|(
name|p
argument_list|,
name|arg
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
name|options
operator|->
name|subsystem_args
index|[
name|options
operator|->
name|num_subsystems
index|]
operator|=
name|p
expr_stmt|;
name|options
operator|->
name|num_subsystems
operator|++
expr_stmt|;
break|break;
case|case
name|sMaxStartups
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing MaxStartups spec."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|=
name|sscanf
argument_list|(
name|arg
argument_list|,
literal|"%d:%d:%d"
argument_list|,
operator|&
name|options
operator|->
name|max_startups_begin
argument_list|,
operator|&
name|options
operator|->
name|max_startups_rate
argument_list|,
operator|&
name|options
operator|->
name|max_startups
argument_list|)
operator|)
operator|==
literal|3
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|max_startups_begin
operator|>
name|options
operator|->
name|max_startups
operator|||
name|options
operator|->
name|max_startups_rate
operator|>
literal|100
operator|||
name|options
operator|->
name|max_startups_rate
operator|<
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Illegal MaxStartups spec."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|!=
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Illegal MaxStartups spec."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
else|else
name|options
operator|->
name|max_startups
operator|=
name|options
operator|->
name|max_startups_begin
expr_stmt|;
break|break;
case|case
name|sMaxAuthTries
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|max_authtries
expr_stmt|;
goto|goto
name|parse_int
goto|;
case|case
name|sMaxSessions
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|max_sessions
expr_stmt|;
goto|goto
name|parse_int
goto|;
case|case
name|sBanner
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|banner
expr_stmt|;
goto|goto
name|parse_filename
goto|;
comment|/* 	 * These options can contain %X options expanded at 	 * connect time, so that you can specify paths like: 	 * 	 * AuthorizedKeysFile	/etc/ssh_keys/%u 	 */
case|case
name|sAuthorizedKeysFile
case|:
if|if
condition|(
operator|*
name|activep
operator|&&
name|options
operator|->
name|num_authkeys_files
operator|==
literal|0
condition|)
block|{
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_authkeys_files
operator|>=
name|MAX_AUTHKEYS_FILES
condition|)
name|fatal
argument_list|(
literal|"%s line %d: "
literal|"too many authorized keys files."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|options
operator|->
name|authorized_keys_files
index|[
name|options
operator|->
name|num_authkeys_files
operator|++
index|]
operator|=
name|tilde_expand_filename
argument_list|(
name|arg
argument_list|,
name|getuid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|0
return|;
case|case
name|sAuthorizedPrincipalsFile
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|authorized_principals_file
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing file name."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
block|{
operator|*
name|charptr
operator|=
name|tilde_expand_filename
argument_list|(
name|arg
argument_list|,
name|getuid
argument_list|()
argument_list|)
expr_stmt|;
comment|/* increase optional counter */
if|if
condition|(
name|intptr
operator|!=
name|NULL
condition|)
operator|*
name|intptr
operator|=
operator|*
name|intptr
operator|+
literal|1
expr_stmt|;
block|}
break|break;
case|case
name|sClientAliveInterval
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|client_alive_interval
expr_stmt|;
goto|goto
name|parse_time
goto|;
case|case
name|sClientAliveCountMax
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|client_alive_count_max
expr_stmt|;
goto|goto
name|parse_int
goto|;
case|case
name|sAcceptEnv
case|:
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|strchr
argument_list|(
name|arg
argument_list|,
literal|'='
argument_list|)
operator|!=
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Invalid environment name."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|num_accept_env
operator|>=
name|MAX_ACCEPT_ENV
condition|)
name|fatal
argument_list|(
literal|"%s line %d: too many allow env."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
continue|continue;
name|options
operator|->
name|accept_env
index|[
name|options
operator|->
name|num_accept_env
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|sPermitTunnel
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|permit_tun
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Missing yes/point-to-point/"
literal|"ethernet/no argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|value
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|tunmode_desc
index|[
name|i
index|]
operator|.
name|val
operator|!=
operator|-
literal|1
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|tunmode_desc
index|[
name|i
index|]
operator|.
name|text
argument_list|,
name|arg
argument_list|)
operator|==
literal|0
condition|)
block|{
name|value
operator|=
name|tunmode_desc
index|[
name|i
index|]
operator|.
name|val
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|value
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad yes/point-to-point/ethernet/"
literal|"no argument: %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|intptr
operator|==
operator|-
literal|1
condition|)
operator|*
name|intptr
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sMatch
case|:
if|if
condition|(
name|cmdline
condition|)
name|fatal
argument_list|(
literal|"Match directive not supported as a command-line "
literal|"option"
argument_list|)
expr_stmt|;
name|value
operator|=
name|match_cfg_line
argument_list|(
operator|&
name|cp
argument_list|,
name|linenum
argument_list|,
name|connectinfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad Match condition"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
operator|*
name|activep
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sPermitOpen
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing PermitOpen specification"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|n
operator|=
name|options
operator|->
name|num_permitted_opens
expr_stmt|;
comment|/* modified later */
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"any"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|*
name|activep
operator|&&
name|n
operator|==
operator|-
literal|1
condition|)
block|{
name|channel_clear_adm_permitted_opens
argument_list|()
expr_stmt|;
name|options
operator|->
name|num_permitted_opens
operator|=
literal|0
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|*
name|activep
operator|&&
name|n
operator|==
operator|-
literal|1
condition|)
block|{
name|options
operator|->
name|num_permitted_opens
operator|=
literal|1
expr_stmt|;
name|channel_disable_adm_local_opens
argument_list|()
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
operator|*
name|activep
operator|&&
name|n
operator|==
operator|-
literal|1
condition|)
name|channel_clear_adm_permitted_opens
argument_list|()
expr_stmt|;
for|for
control|(
init|;
name|arg
operator|!=
name|NULL
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
control|)
block|{
name|p
operator|=
name|hpdelim
argument_list|(
operator|&
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing host in PermitOpen"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|p
operator|=
name|cleanhostname
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|==
name|NULL
operator|||
operator|(
operator|(
name|port
operator|=
name|permitopen_port
argument_list|(
name|arg
argument_list|)
operator|)
operator|<
literal|0
operator|)
condition|)
name|fatal
argument_list|(
literal|"%s line %d: bad port number in "
literal|"PermitOpen"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
name|n
operator|==
operator|-
literal|1
condition|)
name|options
operator|->
name|num_permitted_opens
operator|=
name|channel_add_adm_permitted_opens
argument_list|(
name|p
argument_list|,
name|port
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|sForceCommand
case|:
if|if
condition|(
name|cp
operator|==
name|NULL
operator|||
operator|*
name|cp
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|len
operator|=
name|strspn
argument_list|(
name|cp
argument_list|,
name|WHITESPACE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
name|options
operator|->
name|adm_forced_command
operator|==
name|NULL
condition|)
name|options
operator|->
name|adm_forced_command
operator|=
name|xstrdup
argument_list|(
name|cp
operator|+
name|len
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
case|case
name|sChrootDirectory
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|chroot_directory
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing file name."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
operator|*
name|charptr
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sTrustedUserCAKeys
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|trusted_user_ca_keys
expr_stmt|;
goto|goto
name|parse_filename
goto|;
case|case
name|sRevokedKeys
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|revoked_keys_file
expr_stmt|;
goto|goto
name|parse_filename
goto|;
case|case
name|sIPQoS
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|=
name|parse_ipqos
argument_list|(
name|arg
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad IPQoS value: %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|==
name|NULL
condition|)
name|value2
operator|=
name|value
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|value2
operator|=
name|parse_ipqos
argument_list|(
name|arg
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad IPQoS value: %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
condition|)
block|{
name|options
operator|->
name|ip_qos_interactive
operator|=
name|value
expr_stmt|;
name|options
operator|->
name|ip_qos_bulk
operator|=
name|value2
expr_stmt|;
block|}
break|break;
case|case
name|sVersionAddendum
case|:
if|if
condition|(
name|cp
operator|==
name|NULL
operator|||
operator|*
name|cp
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|len
operator|=
name|strspn
argument_list|(
name|cp
argument_list|,
name|WHITESPACE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
name|options
operator|->
name|version_addendum
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|strcasecmp
argument_list|(
name|cp
operator|+
name|len
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
name|options
operator|->
name|version_addendum
operator|=
name|xstrdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strchr
argument_list|(
name|cp
operator|+
name|len
argument_list|,
literal|'\r'
argument_list|)
operator|!=
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Invalid argument"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
else|else
name|options
operator|->
name|version_addendum
operator|=
name|xstrdup
argument_list|(
name|cp
operator|+
name|len
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
case|case
name|sAuthorizedKeysCommand
case|:
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|len
operator|=
name|strspn
argument_list|(
name|cp
argument_list|,
name|WHITESPACE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
name|options
operator|->
name|authorized_keys_command
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|cp
index|[
name|len
index|]
operator|!=
literal|'/'
operator|&&
name|strcasecmp
argument_list|(
name|cp
operator|+
name|len
argument_list|,
literal|"none"
argument_list|)
operator|!=
literal|0
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: AuthorizedKeysCommand "
literal|"must be an absolute path"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|options
operator|->
name|authorized_keys_command
operator|=
name|xstrdup
argument_list|(
name|cp
operator|+
name|len
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
case|case
name|sAuthorizedKeysCommandUser
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|authorized_keys_command_user
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing AuthorizedKeysCommandUser "
literal|"argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
operator|*
name|charptr
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sAuthorizedPrincipalsCommand
case|:
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|len
operator|=
name|strspn
argument_list|(
name|cp
argument_list|,
name|WHITESPACE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
name|options
operator|->
name|authorized_principals_command
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|cp
index|[
name|len
index|]
operator|!=
literal|'/'
operator|&&
name|strcasecmp
argument_list|(
name|cp
operator|+
name|len
argument_list|,
literal|"none"
argument_list|)
operator|!=
literal|0
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: "
literal|"AuthorizedPrincipalsCommand must be "
literal|"an absolute path"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
name|options
operator|->
name|authorized_principals_command
operator|=
name|xstrdup
argument_list|(
name|cp
operator|+
name|len
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
case|case
name|sAuthorizedPrincipalsCommandUser
case|:
name|charptr
operator|=
operator|&
name|options
operator|->
name|authorized_principals_command_user
expr_stmt|;
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing "
literal|"AuthorizedPrincipalsCommandUser argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
operator|&&
operator|*
name|charptr
operator|==
name|NULL
condition|)
operator|*
name|charptr
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|sAuthenticationMethods
case|:
if|if
condition|(
name|options
operator|->
name|num_auth_methods
operator|==
literal|0
condition|)
block|{
name|value
operator|=
literal|0
expr_stmt|;
comment|/* seen "any" pseudo-method */
name|value2
operator|=
literal|0
expr_stmt|;
comment|/* sucessfully parsed any method */
while|while
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_auth_methods
operator|>=
name|MAX_AUTH_METHODS
condition|)
name|fatal
argument_list|(
literal|"%s line %d: "
literal|"too many authentication methods."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"any"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|options
operator|->
name|num_auth_methods
operator|>
literal|0
condition|)
block|{
name|fatal
argument_list|(
literal|"%s line %d: \"any\" "
literal|"must appear alone in "
literal|"AuthenticationMethods"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
name|value
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|value
condition|)
block|{
name|fatal
argument_list|(
literal|"%s line %d: \"any\" must appear "
literal|"alone in AuthenticationMethods"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|auth2_methods_valid
argument_list|(
name|arg
argument_list|,
literal|0
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fatal
argument_list|(
literal|"%s line %d: invalid "
literal|"authentication method list."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
name|value2
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|activep
condition|)
continue|continue;
name|options
operator|->
name|auth_methods
index|[
name|options
operator|->
name|num_auth_methods
operator|++
index|]
operator|=
name|xstrdup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|value2
operator|==
literal|0
condition|)
block|{
name|fatal
argument_list|(
literal|"%s line %d: no AuthenticationMethods "
literal|"specified"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|0
return|;
case|case
name|sStreamLocalBindMask
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: missing StreamLocalBindMask "
literal|"argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
comment|/* Parse mode in octal format */
name|value
operator|=
name|strtol
argument_list|(
name|arg
argument_list|,
operator|&
name|p
argument_list|,
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|==
name|p
operator|||
name|value
operator|<
literal|0
operator|||
name|value
operator|>
literal|0777
condition|)
name|fatal
argument_list|(
literal|"%s line %d: Bad mask."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
condition|)
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
operator|=
operator|(
name|mode_t
operator|)
name|value
expr_stmt|;
break|break;
case|case
name|sStreamLocalBindUnlink
case|:
name|intptr
operator|=
operator|&
name|options
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_unlink
expr_stmt|;
goto|goto
name|parse_flag
goto|;
case|case
name|sFingerprintHash
case|:
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|arg
operator|||
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Missing argument."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|=
name|ssh_digest_alg_by_name
argument_list|(
name|arg
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%.200s line %d: Invalid hash algorithm \"%s\"."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|activep
condition|)
name|options
operator|->
name|fingerprint_hash
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|sDeprecated
case|:
name|logit
argument_list|(
literal|"%s line %d: Deprecated option %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
while|while
condition|(
name|arg
condition|)
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
break|break;
case|case
name|sUnsupported
case|:
name|logit
argument_list|(
literal|"%s line %d: Unsupported option %s"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
while|while
condition|(
name|arg
condition|)
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fatal
argument_list|(
literal|"%s line %d: Missing handler for opcode %s (%d)"
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|arg
operator|=
name|strdelim
argument_list|(
operator|&
name|cp
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
operator|*
name|arg
operator|!=
literal|'\0'
condition|)
name|fatal
argument_list|(
literal|"%s line %d: garbage at end of line; \"%.200s\"."
argument_list|,
name|filename
argument_list|,
name|linenum
argument_list|,
name|arg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Reads the server configuration file. */
end_comment

begin_function
name|void
name|load_server_config
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|Buffer
modifier|*
name|conf
parameter_list|)
block|{
name|char
name|line
index|[
literal|4096
index|]
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|;
name|int
name|lineno
init|=
literal|0
decl_stmt|;
name|debug2
argument_list|(
literal|"%s: filename %s"
argument_list|,
name|__func__
argument_list|,
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|f
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|buffer_clear
argument_list|(
name|conf
argument_list|)
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|line
argument_list|,
sizeof|sizeof
argument_list|(
name|line
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|lineno
operator|++
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|line
argument_list|)
operator|==
sizeof|sizeof
argument_list|(
name|line
argument_list|)
operator|-
literal|1
condition|)
name|fatal
argument_list|(
literal|"%s line %d too long"
argument_list|,
name|filename
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
comment|/* 		 * Trim out comments and strip whitespace 		 * NB - preserve newlines, they are needed to reproduce 		 * line numbers later for error messages 		 */
if|if
condition|(
operator|(
name|cp
operator|=
name|strchr
argument_list|(
name|line
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|memcpy
argument_list|(
name|cp
argument_list|,
literal|"\n"
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|cp
operator|=
name|line
operator|+
name|strspn
argument_list|(
name|line
argument_list|,
literal|" \t\r"
argument_list|)
expr_stmt|;
name|buffer_append
argument_list|(
name|conf
argument_list|,
name|cp
argument_list|,
name|strlen
argument_list|(
name|cp
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|buffer_append
argument_list|(
name|conf
argument_list|,
literal|"\0"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|debug2
argument_list|(
literal|"%s: done config len = %d"
argument_list|,
name|__func__
argument_list|,
name|buffer_len
argument_list|(
name|conf
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|parse_server_match_config
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|,
name|struct
name|connection_info
modifier|*
name|connectinfo
parameter_list|)
block|{
name|ServerOptions
name|mo
decl_stmt|;
name|initialize_server_options
argument_list|(
operator|&
name|mo
argument_list|)
expr_stmt|;
name|parse_server_config
argument_list|(
operator|&
name|mo
argument_list|,
literal|"reprocess config"
argument_list|,
operator|&
name|cfg
argument_list|,
name|connectinfo
argument_list|)
expr_stmt|;
name|copy_set_server_options
argument_list|(
name|options
argument_list|,
operator|&
name|mo
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|parse_server_match_testspec
parameter_list|(
name|struct
name|connection_info
modifier|*
name|ci
parameter_list|,
name|char
modifier|*
name|spec
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
while|while
condition|(
operator|(
name|p
operator|=
name|strsep
argument_list|(
operator|&
name|spec
argument_list|,
literal|","
argument_list|)
operator|)
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|p
argument_list|,
literal|"addr="
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ci
operator|->
name|address
operator|=
name|xstrdup
argument_list|(
name|p
operator|+
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|p
argument_list|,
literal|"host="
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ci
operator|->
name|host
operator|=
name|xstrdup
argument_list|(
name|p
operator|+
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|p
argument_list|,
literal|"user="
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ci
operator|->
name|user
operator|=
name|xstrdup
argument_list|(
name|p
operator|+
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|p
argument_list|,
literal|"laddr="
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ci
operator|->
name|laddress
operator|=
name|xstrdup
argument_list|(
name|p
operator|+
literal|6
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|p
argument_list|,
literal|"lport="
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ci
operator|->
name|lport
operator|=
name|a2port
argument_list|(
name|p
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|ci
operator|->
name|lport
operator|==
operator|-
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Invalid port '%s' in test mode"
literal|" specification %s\n"
argument_list|,
name|p
operator|+
literal|6
argument_list|,
name|p
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Invalid test mode specification %s\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * returns 1 for a complete spec, 0 for partial spec and -1 for an  * empty spec.  */
end_comment

begin_function
name|int
name|server_match_spec_complete
parameter_list|(
name|struct
name|connection_info
modifier|*
name|ci
parameter_list|)
block|{
if|if
condition|(
name|ci
operator|->
name|user
operator|&&
name|ci
operator|->
name|host
operator|&&
name|ci
operator|->
name|address
condition|)
return|return
literal|1
return|;
comment|/* complete */
if|if
condition|(
operator|!
name|ci
operator|->
name|user
operator|&&
operator|!
name|ci
operator|->
name|host
operator|&&
operator|!
name|ci
operator|->
name|address
condition|)
return|return
operator|-
literal|1
return|;
comment|/* empty */
return|return
literal|0
return|;
comment|/* partial */
block|}
end_function

begin_comment
comment|/*  * Copy any supported values that are set.  *  * If the preauth flag is set, we do not bother copying the string or  * array values that are not used pre-authentication, because any that we  * do use must be explictly sent in mm_getpwnamallow().  */
end_comment

begin_function
name|void
name|copy_set_server_options
parameter_list|(
name|ServerOptions
modifier|*
name|dst
parameter_list|,
name|ServerOptions
modifier|*
name|src
parameter_list|,
name|int
name|preauth
parameter_list|)
block|{
define|#
directive|define
name|M_CP_INTOPT
parameter_list|(
name|n
parameter_list|)
value|do {\ 	if (src->n != -1) \ 		dst->n = src->n; \ } while (0)
name|M_CP_INTOPT
argument_list|(
name|password_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|gss_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|rsa_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|pubkey_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|kerberos_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|hostbased_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|hostbased_uses_name_from_packet_only
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|kbd_interactive_authentication
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|permit_root_login
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|permit_empty_passwd
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|allow_tcp_forwarding
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|allow_streamlocal_forwarding
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|allow_agent_forwarding
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|permit_tun
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|fwd_opts
operator|.
name|gateway_ports
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|fwd_opts
operator|.
name|streamlocal_bind_unlink
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|x11_display_offset
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|x11_forwarding
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|x11_use_localhost
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|permit_tty
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|permit_user_rc
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|max_sessions
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|max_authtries
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|ip_qos_interactive
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|ip_qos_bulk
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|rekey_limit
argument_list|)
expr_stmt|;
name|M_CP_INTOPT
argument_list|(
name|rekey_interval
argument_list|)
expr_stmt|;
comment|/* 	 * The bind_mask is a mode_t that may be unsigned, so we can't use 	 * M_CP_INTOPT - it does a signed comparison that causes compiler 	 * warnings. 	 */
if|if
condition|(
name|src
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
operator|!=
operator|(
name|mode_t
operator|)
operator|-
literal|1
condition|)
block|{
name|dst
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
operator|=
name|src
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
expr_stmt|;
block|}
comment|/* M_CP_STROPT and M_CP_STRARRAYOPT should not appear before here */
define|#
directive|define
name|M_CP_STROPT
parameter_list|(
name|n
parameter_list|)
value|do {\ 	if (src->n != NULL&& dst->n != src->n) { \ 		free(dst->n); \ 		dst->n = src->n; \ 	} \ } while(0)
define|#
directive|define
name|M_CP_STRARRAYOPT
parameter_list|(
name|n
parameter_list|,
name|num_n
parameter_list|)
value|do {\ 	if (src->num_n != 0) { \ 		for (dst->num_n = 0; dst->num_n< src->num_n; dst->num_n++) \ 			dst->n[dst->num_n] = xstrdup(src->n[dst->num_n]); \ 	} \ } while(0)
comment|/* See comment in servconf.h */
name|COPY_MATCH_STRING_OPTS
argument_list|()
expr_stmt|;
comment|/* Arguments that accept '+...' need to be expanded */
name|assemble_algorithms
argument_list|(
name|dst
argument_list|)
expr_stmt|;
comment|/* 	 * The only things that should be below this point are string options 	 * which are only used after authentication. 	 */
if|if
condition|(
name|preauth
condition|)
return|return;
comment|/* These options may be "none" to clear a global setting */
name|M_CP_STROPT
argument_list|(
name|adm_forced_command
argument_list|)
expr_stmt|;
if|if
condition|(
name|option_clear_or_none
argument_list|(
name|dst
operator|->
name|adm_forced_command
argument_list|)
condition|)
block|{
name|free
argument_list|(
name|dst
operator|->
name|adm_forced_command
argument_list|)
expr_stmt|;
name|dst
operator|->
name|adm_forced_command
operator|=
name|NULL
expr_stmt|;
block|}
name|M_CP_STROPT
argument_list|(
name|chroot_directory
argument_list|)
expr_stmt|;
if|if
condition|(
name|option_clear_or_none
argument_list|(
name|dst
operator|->
name|chroot_directory
argument_list|)
condition|)
block|{
name|free
argument_list|(
name|dst
operator|->
name|chroot_directory
argument_list|)
expr_stmt|;
name|dst
operator|->
name|chroot_directory
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_undef
undef|#
directive|undef
name|M_CP_INTOPT
end_undef

begin_undef
undef|#
directive|undef
name|M_CP_STROPT
end_undef

begin_undef
undef|#
directive|undef
name|M_CP_STRARRAYOPT
end_undef

begin_function
name|void
name|parse_server_config
parameter_list|(
name|ServerOptions
modifier|*
name|options
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|Buffer
modifier|*
name|conf
parameter_list|,
name|struct
name|connection_info
modifier|*
name|connectinfo
parameter_list|)
block|{
name|int
name|active
decl_stmt|,
name|linenum
decl_stmt|,
name|bad_options
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|obuf
decl_stmt|,
modifier|*
name|cbuf
decl_stmt|;
name|debug2
argument_list|(
literal|"%s: config %s len %d"
argument_list|,
name|__func__
argument_list|,
name|filename
argument_list|,
name|buffer_len
argument_list|(
name|conf
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|obuf
operator|=
name|cbuf
operator|=
name|sshbuf_dup_string
argument_list|(
name|conf
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|fatal
argument_list|(
literal|"%s: sshbuf_dup_string failed"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|active
operator|=
name|connectinfo
condition|?
literal|0
else|:
literal|1
expr_stmt|;
name|linenum
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|cp
operator|=
name|strsep
argument_list|(
operator|&
name|cbuf
argument_list|,
literal|"\n"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|process_server_config_line
argument_list|(
name|options
argument_list|,
name|cp
argument_list|,
name|filename
argument_list|,
name|linenum
operator|++
argument_list|,
operator|&
name|active
argument_list|,
name|connectinfo
argument_list|)
operator|!=
literal|0
condition|)
name|bad_options
operator|++
expr_stmt|;
block|}
name|free
argument_list|(
name|obuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|bad_options
operator|>
literal|0
condition|)
name|fatal
argument_list|(
literal|"%s: terminating, %d bad configuration options"
argument_list|,
name|filename
argument_list|,
name|bad_options
argument_list|)
expr_stmt|;
name|process_queued_listen_addrs
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|fmt_multistate_int
parameter_list|(
name|int
name|val
parameter_list|,
specifier|const
name|struct
name|multistate
modifier|*
name|m
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|m
index|[
name|i
index|]
operator|.
name|key
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|m
index|[
name|i
index|]
operator|.
name|value
operator|==
name|val
condition|)
return|return
name|m
index|[
name|i
index|]
operator|.
name|key
return|;
block|}
return|return
literal|"UNKNOWN"
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|fmt_intarg
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
name|int
name|val
parameter_list|)
block|{
if|if
condition|(
name|val
operator|==
operator|-
literal|1
condition|)
return|return
literal|"unset"
return|;
switch|switch
condition|(
name|code
condition|)
block|{
case|case
name|sAddressFamily
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_addressfamily
argument_list|)
return|;
case|case
name|sPermitRootLogin
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_permitrootlogin
argument_list|)
return|;
case|case
name|sGatewayPorts
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_gatewayports
argument_list|)
return|;
case|case
name|sCompression
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_compression
argument_list|)
return|;
case|case
name|sUsePrivilegeSeparation
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_privsep
argument_list|)
return|;
case|case
name|sAllowTcpForwarding
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_tcpfwd
argument_list|)
return|;
case|case
name|sAllowStreamLocalForwarding
case|:
return|return
name|fmt_multistate_int
argument_list|(
name|val
argument_list|,
name|multistate_tcpfwd
argument_list|)
return|;
case|case
name|sFingerprintHash
case|:
return|return
name|ssh_digest_alg_name
argument_list|(
name|val
argument_list|)
return|;
case|case
name|sProtocol
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|SSH_PROTO_1
case|:
return|return
literal|"1"
return|;
case|case
name|SSH_PROTO_2
case|:
return|return
literal|"2"
return|;
case|case
operator|(
name|SSH_PROTO_1
operator||
name|SSH_PROTO_2
operator|)
case|:
return|return
literal|"2,1"
return|;
default|default:
return|return
literal|"UNKNOWN"
return|;
block|}
default|default:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
literal|0
case|:
return|return
literal|"no"
return|;
case|case
literal|1
case|:
return|return
literal|"yes"
return|;
default|default:
return|return
literal|"UNKNOWN"
return|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|lookup_opcode_name
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|keywords
index|[
name|i
index|]
operator|.
name|name
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|keywords
index|[
name|i
index|]
operator|.
name|opcode
operator|==
name|code
condition|)
return|return
operator|(
name|keywords
index|[
name|i
index|]
operator|.
name|name
operator|)
return|;
return|return
literal|"UNKNOWN"
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_cfg_int
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
name|int
name|val
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s %d\n"
argument_list|,
name|lookup_opcode_name
argument_list|(
name|code
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_cfg_oct
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
name|int
name|val
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s 0%o\n"
argument_list|,
name|lookup_opcode_name
argument_list|(
name|code
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_cfg_fmtint
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
name|int
name|val
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s %s\n"
argument_list|,
name|lookup_opcode_name
argument_list|(
name|code
argument_list|)
argument_list|,
name|fmt_intarg
argument_list|(
name|code
argument_list|,
name|val
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_cfg_string
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
specifier|const
name|char
modifier|*
name|val
parameter_list|)
block|{
if|if
condition|(
name|val
operator|==
name|NULL
condition|)
return|return;
name|printf
argument_list|(
literal|"%s %s\n"
argument_list|,
name|lookup_opcode_name
argument_list|(
name|code
argument_list|)
argument_list|,
name|val
operator|==
name|NULL
condition|?
literal|"none"
else|:
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_cfg_strarray
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
name|u_int
name|count
parameter_list|,
name|char
modifier|*
modifier|*
name|vals
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%s %s\n"
argument_list|,
name|lookup_opcode_name
argument_list|(
name|code
argument_list|)
argument_list|,
name|vals
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_cfg_strarray_oneline
parameter_list|(
name|ServerOpCodes
name|code
parameter_list|,
name|u_int
name|count
parameter_list|,
name|char
modifier|*
modifier|*
name|vals
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|count
operator|<=
literal|0
operator|&&
name|code
operator|!=
name|sAuthenticationMethods
condition|)
return|return;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|lookup_opcode_name
argument_list|(
name|code
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|" %s"
argument_list|,
name|vals
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|code
operator|==
name|sAuthenticationMethods
operator|&&
name|count
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|" any"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|dump_config
parameter_list|(
name|ServerOptions
modifier|*
name|o
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|struct
name|addrinfo
modifier|*
name|ai
decl_stmt|;
name|char
name|addr
index|[
name|NI_MAXHOST
index|]
decl_stmt|,
name|port
index|[
name|NI_MAXSERV
index|]
decl_stmt|,
modifier|*
name|s
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|laddr1
init|=
name|xstrdup
argument_list|(
literal|""
argument_list|)
decl_stmt|,
modifier|*
name|laddr2
init|=
name|NULL
decl_stmt|;
comment|/* these are usually at the top of the config */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|o
operator|->
name|num_ports
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"port %d\n"
argument_list|,
name|o
operator|->
name|ports
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sProtocol
argument_list|,
name|o
operator|->
name|protocol
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sAddressFamily
argument_list|,
name|o
operator|->
name|address_family
argument_list|)
expr_stmt|;
comment|/* 	 * ListenAddress must be after Port.  add_one_listen_addr pushes 	 * addresses onto a stack, so to maintain ordering we need to 	 * print these in reverse order. 	 */
for|for
control|(
name|ai
operator|=
name|o
operator|->
name|listen_addrs
init|;
name|ai
condition|;
name|ai
operator|=
name|ai
operator|->
name|ai_next
control|)
block|{
if|if
condition|(
operator|(
name|ret
operator|=
name|getnameinfo
argument_list|(
name|ai
operator|->
name|ai_addr
argument_list|,
name|ai
operator|->
name|ai_addrlen
argument_list|,
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|addr
argument_list|)
argument_list|,
name|port
argument_list|,
sizeof|sizeof
argument_list|(
name|port
argument_list|)
argument_list|,
name|NI_NUMERICHOST
operator||
name|NI_NUMERICSERV
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"getnameinfo failed: %.100s"
argument_list|,
operator|(
name|ret
operator|!=
name|EAI_SYSTEM
operator|)
condition|?
name|gai_strerror
argument_list|(
name|ret
argument_list|)
else|:
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|laddr2
operator|=
name|laddr1
expr_stmt|;
if|if
condition|(
name|ai
operator|->
name|ai_family
operator|==
name|AF_INET6
condition|)
name|xasprintf
argument_list|(
operator|&
name|laddr1
argument_list|,
literal|"listenaddress [%s]:%s\n%s"
argument_list|,
name|addr
argument_list|,
name|port
argument_list|,
name|laddr2
argument_list|)
expr_stmt|;
else|else
name|xasprintf
argument_list|(
operator|&
name|laddr1
argument_list|,
literal|"listenaddress %s:%s\n%s"
argument_list|,
name|addr
argument_list|,
name|port
argument_list|,
name|laddr2
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|laddr2
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|laddr1
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|laddr1
argument_list|)
expr_stmt|;
comment|/* integer arguments */
ifdef|#
directive|ifdef
name|USE_PAM
name|dump_cfg_fmtint
argument_list|(
name|sUsePAM
argument_list|,
name|o
operator|->
name|use_pam
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|dump_cfg_int
argument_list|(
name|sServerKeyBits
argument_list|,
name|o
operator|->
name|server_key_bits
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sLoginGraceTime
argument_list|,
name|o
operator|->
name|login_grace_time
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sKeyRegenerationTime
argument_list|,
name|o
operator|->
name|key_regeneration_time
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sX11DisplayOffset
argument_list|,
name|o
operator|->
name|x11_display_offset
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sMaxAuthTries
argument_list|,
name|o
operator|->
name|max_authtries
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sMaxSessions
argument_list|,
name|o
operator|->
name|max_sessions
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sClientAliveInterval
argument_list|,
name|o
operator|->
name|client_alive_interval
argument_list|)
expr_stmt|;
name|dump_cfg_int
argument_list|(
name|sClientAliveCountMax
argument_list|,
name|o
operator|->
name|client_alive_count_max
argument_list|)
expr_stmt|;
name|dump_cfg_oct
argument_list|(
name|sStreamLocalBindMask
argument_list|,
name|o
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_mask
argument_list|)
expr_stmt|;
comment|/* formatted integer arguments */
name|dump_cfg_fmtint
argument_list|(
name|sPermitRootLogin
argument_list|,
name|o
operator|->
name|permit_root_login
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sIgnoreRhosts
argument_list|,
name|o
operator|->
name|ignore_rhosts
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sIgnoreUserKnownHosts
argument_list|,
name|o
operator|->
name|ignore_user_known_hosts
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sRhostsRSAAuthentication
argument_list|,
name|o
operator|->
name|rhosts_rsa_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sHostbasedAuthentication
argument_list|,
name|o
operator|->
name|hostbased_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sHostbasedUsesNameFromPacketOnly
argument_list|,
name|o
operator|->
name|hostbased_uses_name_from_packet_only
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sRSAAuthentication
argument_list|,
name|o
operator|->
name|rsa_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sPubkeyAuthentication
argument_list|,
name|o
operator|->
name|pubkey_authentication
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|KRB5
name|dump_cfg_fmtint
argument_list|(
name|sKerberosAuthentication
argument_list|,
name|o
operator|->
name|kerberos_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sKerberosOrLocalPasswd
argument_list|,
name|o
operator|->
name|kerberos_or_local_passwd
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sKerberosTicketCleanup
argument_list|,
name|o
operator|->
name|kerberos_ticket_cleanup
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|USE_AFS
name|dump_cfg_fmtint
argument_list|(
name|sKerberosGetAFSToken
argument_list|,
name|o
operator|->
name|kerberos_get_afs_token
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
ifdef|#
directive|ifdef
name|GSSAPI
name|dump_cfg_fmtint
argument_list|(
name|sGssAuthentication
argument_list|,
name|o
operator|->
name|gss_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sGssCleanupCreds
argument_list|,
name|o
operator|->
name|gss_cleanup_creds
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|dump_cfg_fmtint
argument_list|(
name|sPasswordAuthentication
argument_list|,
name|o
operator|->
name|password_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sKbdInteractiveAuthentication
argument_list|,
name|o
operator|->
name|kbd_interactive_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sChallengeResponseAuthentication
argument_list|,
name|o
operator|->
name|challenge_response_authentication
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sPrintMotd
argument_list|,
name|o
operator|->
name|print_motd
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|DISABLE_LASTLOG
name|dump_cfg_fmtint
argument_list|(
name|sPrintLastLog
argument_list|,
name|o
operator|->
name|print_lastlog
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|dump_cfg_fmtint
argument_list|(
name|sX11Forwarding
argument_list|,
name|o
operator|->
name|x11_forwarding
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sX11UseLocalhost
argument_list|,
name|o
operator|->
name|x11_use_localhost
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sPermitTTY
argument_list|,
name|o
operator|->
name|permit_tty
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sPermitUserRC
argument_list|,
name|o
operator|->
name|permit_user_rc
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sStrictModes
argument_list|,
name|o
operator|->
name|strict_modes
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sTCPKeepAlive
argument_list|,
name|o
operator|->
name|tcp_keep_alive
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sEmptyPasswd
argument_list|,
name|o
operator|->
name|permit_empty_passwd
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sPermitUserEnvironment
argument_list|,
name|o
operator|->
name|permit_user_env
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sUseLogin
argument_list|,
name|o
operator|->
name|use_login
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sCompression
argument_list|,
name|o
operator|->
name|compression
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sGatewayPorts
argument_list|,
name|o
operator|->
name|fwd_opts
operator|.
name|gateway_ports
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sUseDNS
argument_list|,
name|o
operator|->
name|use_dns
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sAllowTcpForwarding
argument_list|,
name|o
operator|->
name|allow_tcp_forwarding
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sAllowAgentForwarding
argument_list|,
name|o
operator|->
name|allow_agent_forwarding
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sAllowStreamLocalForwarding
argument_list|,
name|o
operator|->
name|allow_streamlocal_forwarding
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sStreamLocalBindUnlink
argument_list|,
name|o
operator|->
name|fwd_opts
operator|.
name|streamlocal_bind_unlink
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sUsePrivilegeSeparation
argument_list|,
name|use_privsep
argument_list|)
expr_stmt|;
name|dump_cfg_fmtint
argument_list|(
name|sFingerprintHash
argument_list|,
name|o
operator|->
name|fingerprint_hash
argument_list|)
expr_stmt|;
comment|/* string arguments */
name|dump_cfg_string
argument_list|(
name|sPidFile
argument_list|,
name|o
operator|->
name|pid_file
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sXAuthLocation
argument_list|,
name|o
operator|->
name|xauth_location
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sCiphers
argument_list|,
name|o
operator|->
name|ciphers
condition|?
name|o
operator|->
name|ciphers
else|:
name|KEX_SERVER_ENCRYPT
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sMacs
argument_list|,
name|o
operator|->
name|macs
condition|?
name|o
operator|->
name|macs
else|:
name|KEX_SERVER_MAC
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sBanner
argument_list|,
name|o
operator|->
name|banner
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sForceCommand
argument_list|,
name|o
operator|->
name|adm_forced_command
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sChrootDirectory
argument_list|,
name|o
operator|->
name|chroot_directory
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sTrustedUserCAKeys
argument_list|,
name|o
operator|->
name|trusted_user_ca_keys
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sRevokedKeys
argument_list|,
name|o
operator|->
name|revoked_keys_file
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sAuthorizedPrincipalsFile
argument_list|,
name|o
operator|->
name|authorized_principals_file
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sVersionAddendum
argument_list|,
operator|*
name|o
operator|->
name|version_addendum
operator|==
literal|'\0'
condition|?
literal|"none"
else|:
name|o
operator|->
name|version_addendum
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sAuthorizedKeysCommand
argument_list|,
name|o
operator|->
name|authorized_keys_command
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sAuthorizedKeysCommandUser
argument_list|,
name|o
operator|->
name|authorized_keys_command_user
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sAuthorizedPrincipalsCommand
argument_list|,
name|o
operator|->
name|authorized_principals_command
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sAuthorizedPrincipalsCommandUser
argument_list|,
name|o
operator|->
name|authorized_principals_command_user
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sHostKeyAgent
argument_list|,
name|o
operator|->
name|host_key_agent
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sKexAlgorithms
argument_list|,
name|o
operator|->
name|kex_algorithms
condition|?
name|o
operator|->
name|kex_algorithms
else|:
name|KEX_SERVER_KEX
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sHostbasedAcceptedKeyTypes
argument_list|,
name|o
operator|->
name|hostbased_key_types
condition|?
name|o
operator|->
name|hostbased_key_types
else|:
name|KEX_DEFAULT_PK_ALG
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sHostKeyAlgorithms
argument_list|,
name|o
operator|->
name|hostkeyalgorithms
condition|?
name|o
operator|->
name|hostkeyalgorithms
else|:
name|KEX_DEFAULT_PK_ALG
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sPubkeyAcceptedKeyTypes
argument_list|,
name|o
operator|->
name|pubkey_key_types
condition|?
name|o
operator|->
name|pubkey_key_types
else|:
name|KEX_DEFAULT_PK_ALG
argument_list|)
expr_stmt|;
comment|/* string arguments requiring a lookup */
name|dump_cfg_string
argument_list|(
name|sLogLevel
argument_list|,
name|log_level_name
argument_list|(
name|o
operator|->
name|log_level
argument_list|)
argument_list|)
expr_stmt|;
name|dump_cfg_string
argument_list|(
name|sLogFacility
argument_list|,
name|log_facility_name
argument_list|(
name|o
operator|->
name|log_facility
argument_list|)
argument_list|)
expr_stmt|;
comment|/* string array arguments */
name|dump_cfg_strarray_oneline
argument_list|(
name|sAuthorizedKeysFile
argument_list|,
name|o
operator|->
name|num_authkeys_files
argument_list|,
name|o
operator|->
name|authorized_keys_files
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sHostKeyFile
argument_list|,
name|o
operator|->
name|num_host_key_files
argument_list|,
name|o
operator|->
name|host_key_files
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sHostCertificate
argument_list|,
name|o
operator|->
name|num_host_cert_files
argument_list|,
name|o
operator|->
name|host_cert_files
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sAllowUsers
argument_list|,
name|o
operator|->
name|num_allow_users
argument_list|,
name|o
operator|->
name|allow_users
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sDenyUsers
argument_list|,
name|o
operator|->
name|num_deny_users
argument_list|,
name|o
operator|->
name|deny_users
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sAllowGroups
argument_list|,
name|o
operator|->
name|num_allow_groups
argument_list|,
name|o
operator|->
name|allow_groups
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sDenyGroups
argument_list|,
name|o
operator|->
name|num_deny_groups
argument_list|,
name|o
operator|->
name|deny_groups
argument_list|)
expr_stmt|;
name|dump_cfg_strarray
argument_list|(
name|sAcceptEnv
argument_list|,
name|o
operator|->
name|num_accept_env
argument_list|,
name|o
operator|->
name|accept_env
argument_list|)
expr_stmt|;
name|dump_cfg_strarray_oneline
argument_list|(
name|sAuthenticationMethods
argument_list|,
name|o
operator|->
name|num_auth_methods
argument_list|,
name|o
operator|->
name|auth_methods
argument_list|)
expr_stmt|;
comment|/* other arguments */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|o
operator|->
name|num_subsystems
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"subsystem %s %s\n"
argument_list|,
name|o
operator|->
name|subsystem_name
index|[
name|i
index|]
argument_list|,
name|o
operator|->
name|subsystem_args
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"maxstartups %d:%d:%d\n"
argument_list|,
name|o
operator|->
name|max_startups_begin
argument_list|,
name|o
operator|->
name|max_startups_rate
argument_list|,
name|o
operator|->
name|max_startups
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|tunmode_desc
index|[
name|i
index|]
operator|.
name|val
operator|!=
operator|-
literal|1
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|tunmode_desc
index|[
name|i
index|]
operator|.
name|val
operator|==
name|o
operator|->
name|permit_tun
condition|)
block|{
name|s
operator|=
name|tunmode_desc
index|[
name|i
index|]
operator|.
name|text
expr_stmt|;
break|break;
block|}
name|dump_cfg_string
argument_list|(
name|sPermitTunnel
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ipqos %s "
argument_list|,
name|iptos2str
argument_list|(
name|o
operator|->
name|ip_qos_interactive
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|iptos2str
argument_list|(
name|o
operator|->
name|ip_qos_bulk
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rekeylimit %llu %d\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|o
operator|->
name|rekey_limit
argument_list|,
name|o
operator|->
name|rekey_interval
argument_list|)
expr_stmt|;
name|channel_print_adm_permitted_opens
argument_list|()
expr_stmt|;
block|}
end_function

end_unit

