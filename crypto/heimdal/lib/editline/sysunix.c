begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  Copyright 1992 Simmule Turner and Rich Salz.  All rights reserved.   *  *  This software is not subject to any license of the American Telephone   *  and Telegraph Company or of the Regents of the University of California.   *  *  Permission is granted to anyone to use this software for any purpose on  *  any computer system, and to alter it and redistribute it freely, subject  *  to the following restrictions:  *  1. The authors are not responsible for the consequences of use of this  *     software, no matter how awful, even if they arise from flaws in it.  *  2. The origin of this software must not be misrepresented, either by  *     explicit claim or by omission.  Since few users ever read sources,  *     credits must appear in the documentation.  *  3. Altered versions must be plainly marked as such, and must not be  *     misrepresented as being the original software.  Since few users  *     ever read sources, credits must appear in the documentation.  *  4. This notice may not be removed or altered.  */
end_comment

begin_comment
comment|/* **  Unix system-dependant routines for editline library. */
end_comment

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_include
include|#
directive|include
file|"editline.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_TERMIOS_H
end_ifdef

begin_include
include|#
directive|include
file|<termios.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_expr_stmt
name|RCSID
argument_list|(
literal|"$Id: sysunix.c,v 1.4 1999/04/08 13:08:24 joda Exp $"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_TERMIOS_H
end_ifdef

begin_function
name|void
name|rl_ttyset
parameter_list|(
name|int
name|Reset
parameter_list|)
block|{
specifier|static
name|struct
name|termios
name|old
decl_stmt|;
name|struct
name|termios
name|new
decl_stmt|;
if|if
condition|(
name|Reset
operator|==
literal|0
condition|)
block|{
name|tcgetattr
argument_list|(
literal|0
argument_list|,
operator|&
name|old
argument_list|)
expr_stmt|;
name|rl_erase
operator|=
name|old
operator|.
name|c_cc
index|[
name|VERASE
index|]
expr_stmt|;
name|rl_kill
operator|=
name|old
operator|.
name|c_cc
index|[
name|VKILL
index|]
expr_stmt|;
name|rl_eof
operator|=
name|old
operator|.
name|c_cc
index|[
name|VEOF
index|]
expr_stmt|;
name|rl_intr
operator|=
name|old
operator|.
name|c_cc
index|[
name|VINTR
index|]
expr_stmt|;
name|rl_quit
operator|=
name|old
operator|.
name|c_cc
index|[
name|VQUIT
index|]
expr_stmt|;
name|new
operator|=
name|old
expr_stmt|;
name|new
operator|.
name|c_cc
index|[
name|VINTR
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|new
operator|.
name|c_cc
index|[
name|VQUIT
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|new
operator|.
name|c_lflag
operator|&=
operator|~
operator|(
name|ECHO
operator||
name|ICANON
operator|)
expr_stmt|;
name|new
operator|.
name|c_iflag
operator|&=
operator|~
operator|(
name|ISTRIP
operator||
name|INPCK
operator|)
expr_stmt|;
name|new
operator|.
name|c_cc
index|[
name|VMIN
index|]
operator|=
literal|1
expr_stmt|;
name|new
operator|.
name|c_cc
index|[
name|VTIME
index|]
operator|=
literal|0
expr_stmt|;
name|tcsetattr
argument_list|(
literal|0
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|new
argument_list|)
expr_stmt|;
block|}
else|else
name|tcsetattr
argument_list|(
literal|0
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|old
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !HAVE_TERMIOS_H */
end_comment

begin_function
name|void
name|rl_ttyset
parameter_list|(
name|int
name|Reset
parameter_list|)
block|{
specifier|static
name|struct
name|sgttyb
name|old
decl_stmt|;
name|struct
name|sgttyb
name|new
decl_stmt|;
if|if
condition|(
name|Reset
operator|==
literal|0
condition|)
block|{
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|old
argument_list|)
expr_stmt|;
name|rl_erase
operator|=
name|old
operator|.
name|sg_erase
expr_stmt|;
name|rl_kill
operator|=
name|old
operator|.
name|sg_kill
expr_stmt|;
name|new
operator|=
name|old
expr_stmt|;
name|new
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|ECHO
operator||
name|ICANON
operator|)
expr_stmt|;
name|new
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|ISTRIP
operator||
name|INPCK
operator|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|new
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|old
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_TERMIOS_H */
end_comment

begin_function
name|void
name|rl_add_slash
parameter_list|(
name|char
modifier|*
name|path
parameter_list|,
name|char
modifier|*
name|p
parameter_list|)
block|{
name|struct
name|stat
name|Sb
decl_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|path
argument_list|,
operator|&
name|Sb
argument_list|)
operator|>=
literal|0
condition|)
name|strcat
argument_list|(
name|p
argument_list|,
name|S_ISDIR
argument_list|(
name|Sb
operator|.
name|st_mode
argument_list|)
condition|?
literal|"/"
else|:
literal|" "
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

