begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    Copyright (C) 1989 by the Massachusetts Institute of Technology     Export of this software from the United States of America is assumed    to require a specific license from the United States Government.    It is the responsibility of any person or organization contemplating    export to obtain such a license before exporting.  WITHIN THAT CONSTRAINT, permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty.    */
end_comment

begin_include
include|#
directive|include
file|"krb_locl.h"
end_include

begin_expr_stmt
name|RCSID
argument_list|(
literal|"$Id: k_gethostname.c,v 1.10 1997/03/23 03:53:12 joda Exp $"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_UTSNAME_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/utsname.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Return the local host's name in "name", up to "namelen" characters.  * "name" will be null-terminated if "namelen" is big enough.  * The return code is 0 on success, -1 on failure.  (The calling  * interface is identical to gethostname(2).)  */
end_comment

begin_function
name|int
name|k_gethostname
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|namelen
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|HAVE_GETHOSTNAME
argument_list|)
return|return
name|gethostname
argument_list|(
name|name
argument_list|,
name|namelen
argument_list|)
return|;
elif|#
directive|elif
name|defined
argument_list|(
name|HAVE_UNAME
argument_list|)
block|{
name|struct
name|utsname
name|utsname
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|ret
operator|=
name|uname
argument_list|(
operator|&
name|utsname
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
return|return
name|ret
return|;
name|strncpy
argument_list|(
name|name
argument_list|,
name|utsname
operator|.
name|nodename
argument_list|,
name|namelen
argument_list|)
expr_stmt|;
name|name
index|[
name|namelen
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
literal|0
return|;
block|}
else|#
directive|else
name|strncpy
argument_list|(
name|name
argument_list|,
literal|"some.random.host"
argument_list|,
name|namelen
argument_list|)
expr_stmt|;
name|name
index|[
name|namelen
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

end_unit

