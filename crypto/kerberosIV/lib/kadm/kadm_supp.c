begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    Copyright (C) 1989 by the Massachusetts Institute of Technology     Export of this software from the United States of America is assumed    to require a specific license from the United States Government.    It is the responsibility of any person or organization contemplating    export to obtain such a license before exporting.  WITHIN THAT CONSTRAINT, permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty.    */
end_comment

begin_comment
comment|/*  * Support functions for Kerberos administration server& clients  */
end_comment

begin_comment
comment|/*   kadm_supp.c   this holds the support routines for the kerberos administration server      error: prints out a kadm error message, returns     fatal: prints out a kadm fatal error message, exits     prin_vals: prints out data associated with a Principal in the vals            structure */
end_comment

begin_include
include|#
directive|include
file|"kadm_locl.h"
end_include

begin_expr_stmt
name|RCSID
argument_list|(
literal|"$Id: kadm_supp.c,v 1.8 1997/05/02 10:27:58 joda Exp $"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* prin_vals:   recieves    : a vals structure */
end_comment

begin_function
name|void
name|prin_vals
parameter_list|(
name|Kadm_vals
modifier|*
name|vals
parameter_list|)
block|{
name|printf
argument_list|(
literal|"Info in Database for %s.%s:\n"
argument_list|,
name|vals
operator|->
name|name
argument_list|,
name|vals
operator|->
name|instance
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"   Max Life: %d (%s)   Exp Date: %s\n"
argument_list|,
name|vals
operator|->
name|max_life
argument_list|,
name|krb_life_to_atime
argument_list|(
name|vals
operator|->
name|max_life
argument_list|)
argument_list|,
name|asctime
argument_list|(
name|k_localtime
argument_list|(
operator|&
name|vals
operator|->
name|exp_date
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"   Attribs: %.2x  key: %#lx %#lx\n"
argument_list|,
name|vals
operator|->
name|attributes
argument_list|,
operator|(
name|long
operator|)
name|vals
operator|->
name|key_low
argument_list|,
operator|(
name|long
operator|)
name|vals
operator|->
name|key_high
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* kadm_prin_to_vals takes a fields arguments, a Kadm_vals and a Principal,    it copies the fields in Principal specified by fields into Kadm_vals,     i.e from old to new */
end_comment

begin_function
name|void
name|kadm_prin_to_vals
parameter_list|(
name|u_char
modifier|*
name|fields
parameter_list|,
name|Kadm_vals
modifier|*
name|new
parameter_list|,
name|Principal
modifier|*
name|old
parameter_list|)
block|{
name|memset
argument_list|(
name|new
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_NAME
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|strncpy
argument_list|(
name|new
operator|->
name|name
argument_list|,
name|old
operator|->
name|name
argument_list|,
name|ANAME_SZ
argument_list|)
expr_stmt|;
name|SET_FIELD
argument_list|(
name|KADM_NAME
argument_list|,
name|new
operator|->
name|fields
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_INST
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|strncpy
argument_list|(
name|new
operator|->
name|instance
argument_list|,
name|old
operator|->
name|instance
argument_list|,
name|INST_SZ
argument_list|)
expr_stmt|;
name|SET_FIELD
argument_list|(
name|KADM_INST
argument_list|,
name|new
operator|->
name|fields
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_EXPDATE
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|new
operator|->
name|exp_date
operator|=
name|old
operator|->
name|exp_date
expr_stmt|;
name|SET_FIELD
argument_list|(
name|KADM_EXPDATE
argument_list|,
name|new
operator|->
name|fields
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_ATTR
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|new
operator|->
name|attributes
operator|=
name|old
operator|->
name|attributes
expr_stmt|;
name|SET_FIELD
argument_list|(
name|KADM_ATTR
argument_list|,
name|new
operator|->
name|fields
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_MAXLIFE
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|new
operator|->
name|max_life
operator|=
name|old
operator|->
name|max_life
expr_stmt|;
name|SET_FIELD
argument_list|(
name|KADM_MAXLIFE
argument_list|,
name|new
operator|->
name|fields
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_DESKEY
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|new
operator|->
name|key_low
operator|=
name|old
operator|->
name|key_low
expr_stmt|;
name|new
operator|->
name|key_high
operator|=
name|old
operator|->
name|key_high
expr_stmt|;
name|SET_FIELD
argument_list|(
name|KADM_DESKEY
argument_list|,
name|new
operator|->
name|fields
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|kadm_vals_to_prin
parameter_list|(
name|u_char
modifier|*
name|fields
parameter_list|,
name|Principal
modifier|*
name|new
parameter_list|,
name|Kadm_vals
modifier|*
name|old
parameter_list|)
block|{
name|memset
argument_list|(
name|new
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_NAME
argument_list|,
name|fields
argument_list|)
condition|)
name|strncpy
argument_list|(
name|new
operator|->
name|name
argument_list|,
name|old
operator|->
name|name
argument_list|,
name|ANAME_SZ
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_INST
argument_list|,
name|fields
argument_list|)
condition|)
name|strncpy
argument_list|(
name|new
operator|->
name|instance
argument_list|,
name|old
operator|->
name|instance
argument_list|,
name|INST_SZ
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_EXPDATE
argument_list|,
name|fields
argument_list|)
condition|)
name|new
operator|->
name|exp_date
operator|=
name|old
operator|->
name|exp_date
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_ATTR
argument_list|,
name|fields
argument_list|)
condition|)
name|new
operator|->
name|attributes
operator|=
name|old
operator|->
name|attributes
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_MAXLIFE
argument_list|,
name|fields
argument_list|)
condition|)
name|new
operator|->
name|max_life
operator|=
name|old
operator|->
name|max_life
expr_stmt|;
if|if
condition|(
name|IS_FIELD
argument_list|(
name|KADM_DESKEY
argument_list|,
name|fields
argument_list|)
condition|)
block|{
name|new
operator|->
name|key_low
operator|=
name|old
operator|->
name|key_low
expr_stmt|;
name|new
operator|->
name|key_high
operator|=
name|old
operator|->
name|key_high
expr_stmt|;
block|}
block|}
end_function

end_unit

