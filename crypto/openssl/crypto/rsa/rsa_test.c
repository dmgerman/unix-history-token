begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* test vectors from p1ovect1.txt */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"e_os.h"
end_include

begin_include
include|#
directive|include
file|<openssl/crypto.h>
end_include

begin_include
include|#
directive|include
file|<openssl/err.h>
end_include

begin_include
include|#
directive|include
file|<openssl/rand.h>
end_include

begin_include
include|#
directive|include
file|<openssl/bn.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|OPENSSL_NO_RSA
end_ifdef

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|printf
argument_list|(
literal|"No RSA support\n"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<openssl/rsa.h>
end_include

begin_define
define|#
directive|define
name|SetKey
define|\
value|key->n = BN_bin2bn(n, sizeof(n)-1, key->n); \   key->e = BN_bin2bn(e, sizeof(e)-1, key->e); \   key->d = BN_bin2bn(d, sizeof(d)-1, key->d); \   key->p = BN_bin2bn(p, sizeof(p)-1, key->p); \   key->q = BN_bin2bn(q, sizeof(q)-1, key->q); \   key->dmp1 = BN_bin2bn(dmp1, sizeof(dmp1)-1, key->dmp1); \   key->dmq1 = BN_bin2bn(dmq1, sizeof(dmq1)-1, key->dmq1); \   key->iqmp = BN_bin2bn(iqmp, sizeof(iqmp)-1, key->iqmp); \   memcpy(c, ctext_ex, sizeof(ctext_ex) - 1); \   return (sizeof(ctext_ex) - 1);
end_define

begin_function
specifier|static
name|int
name|key1
parameter_list|(
name|RSA
modifier|*
name|key
parameter_list|,
name|unsigned
name|char
modifier|*
name|c
parameter_list|)
block|{
specifier|static
name|unsigned
name|char
name|n
index|[]
init|=
literal|"\x00\xAA\x36\xAB\xCE\x88\xAC\xFD\xFF\x55\x52\x3C\x7F\xC4\x52\x3F"
literal|"\x90\xEF\xA0\x0D\xF3\x77\x4A\x25\x9F\x2E\x62\xB4\xC5\xD9\x9C\xB5"
literal|"\xAD\xB3\x00\xA0\x28\x5E\x53\x01\x93\x0E\x0C\x70\xFB\x68\x76\x93"
literal|"\x9C\xE6\x16\xCE\x62\x4A\x11\xE0\x08\x6D\x34\x1E\xBC\xAC\xA0\xA1"
literal|"\xF5"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|e
index|[]
init|=
literal|"\x11"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|d
index|[]
init|=
literal|"\x0A\x03\x37\x48\x62\x64\x87\x69\x5F\x5F\x30\xBC\x38\xB9\x8B\x44"
literal|"\xC2\xCD\x2D\xFF\x43\x40\x98\xCD\x20\xD8\xA1\x38\xD0\x90\xBF\x64"
literal|"\x79\x7C\x3F\xA7\xA2\xCD\xCB\x3C\xD1\xE0\xBD\xBA\x26\x54\xB4\xF9"
literal|"\xDF\x8E\x8A\xE5\x9D\x73\x3D\x9F\x33\xB3\x01\x62\x4A\xFD\x1D\x51"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|p
index|[]
init|=
literal|"\x00\xD8\x40\xB4\x16\x66\xB4\x2E\x92\xEA\x0D\xA3\xB4\x32\x04\xB5"
literal|"\xCF\xCE\x33\x52\x52\x4D\x04\x16\xA5\xA4\x41\xE7\x00\xAF\x46\x12"
literal|"\x0D"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|q
index|[]
init|=
literal|"\x00\xC9\x7F\xB1\xF0\x27\xF4\x53\xF6\x34\x12\x33\xEA\xAA\xD1\xD9"
literal|"\x35\x3F\x6C\x42\xD0\x88\x66\xB1\xD0\x5A\x0F\x20\x35\x02\x8B\x9D"
literal|"\x89"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|dmp1
index|[]
init|=
literal|"\x59\x0B\x95\x72\xA2\xC2\xA9\xC4\x06\x05\x9D\xC2\xAB\x2F\x1D\xAF"
literal|"\xEB\x7E\x8B\x4F\x10\xA7\x54\x9E\x8E\xED\xF5\xB4\xFC\xE0\x9E\x05"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|dmq1
index|[]
init|=
literal|"\x00\x8E\x3C\x05\x21\xFE\x15\xE0\xEA\x06\xA3\x6F\xF0\xF1\x0C\x99"
literal|"\x52\xC3\x5B\x7A\x75\x14\xFD\x32\x38\xB8\x0A\xAD\x52\x98\x62\x8D"
literal|"\x51"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|iqmp
index|[]
init|=
literal|"\x36\x3F\xF7\x18\x9D\xA8\xE9\x0B\x1D\x34\x1F\x71\xD0\x9B\x76\xA8"
literal|"\xA9\x43\xE1\x1D\x10\xB2\x4D\x24\x9F\x2D\xEA\xFE\xF8\x0C\x18\x26"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|ctext_ex
index|[]
init|=
literal|"\x1b\x8f\x05\xf9\xca\x1a\x79\x52\x6e\x53\xf3\xcc\x51\x4f\xdb\x89"
literal|"\x2b\xfb\x91\x93\x23\x1e\x78\xb9\x92\xe6\x8d\x50\xa4\x80\xcb\x52"
literal|"\x33\x89\x5c\x74\x95\x8d\x5d\x02\xab\x8c\x0f\xd0\x40\xeb\x58\x44"
literal|"\xb0\x05\xc3\x9e\xd8\x27\x4a\x9d\xbf\xa8\x06\x71\x40\x94\x39\xd2"
decl_stmt|;
name|SetKey
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|key2
parameter_list|(
name|RSA
modifier|*
name|key
parameter_list|,
name|unsigned
name|char
modifier|*
name|c
parameter_list|)
block|{
specifier|static
name|unsigned
name|char
name|n
index|[]
init|=
literal|"\x00\xA3\x07\x9A\x90\xDF\x0D\xFD\x72\xAC\x09\x0C\xCC\x2A\x78\xB8"
literal|"\x74\x13\x13\x3E\x40\x75\x9C\x98\xFA\xF8\x20\x4F\x35\x8A\x0B\x26"
literal|"\x3C\x67\x70\xE7\x83\xA9\x3B\x69\x71\xB7\x37\x79\xD2\x71\x7B\xE8"
literal|"\x34\x77\xCF"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|e
index|[]
init|=
literal|"\x3"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|d
index|[]
init|=
literal|"\x6C\xAF\xBC\x60\x94\xB3\xFE\x4C\x72\xB0\xB3\x32\xC6\xFB\x25\xA2"
literal|"\xB7\x62\x29\x80\x4E\x68\x65\xFC\xA4\x5A\x74\xDF\x0F\x8F\xB8\x41"
literal|"\x3B\x52\xC0\xD0\xE5\x3D\x9B\x59\x0F\xF1\x9B\xE7\x9F\x49\xDD\x21"
literal|"\xE5\xEB"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|p
index|[]
init|=
literal|"\x00\xCF\x20\x35\x02\x8B\x9D\x86\x98\x40\xB4\x16\x66\xB4\x2E\x92"
literal|"\xEA\x0D\xA3\xB4\x32\x04\xB5\xCF\xCE\x91"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|q
index|[]
init|=
literal|"\x00\xC9\x7F\xB1\xF0\x27\xF4\x53\xF6\x34\x12\x33\xEA\xAA\xD1\xD9"
literal|"\x35\x3F\x6C\x42\xD0\x88\x66\xB1\xD0\x5F"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|dmp1
index|[]
init|=
literal|"\x00\x8A\x15\x78\xAC\x5D\x13\xAF\x10\x2B\x22\xB9\x99\xCD\x74\x61"
literal|"\xF1\x5E\x6D\x22\xCC\x03\x23\xDF\xDF\x0B"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|dmq1
index|[]
init|=
literal|"\x00\x86\x55\x21\x4A\xC5\x4D\x8D\x4E\xCD\x61\x77\xF1\xC7\x36\x90"
literal|"\xCE\x2A\x48\x2C\x8B\x05\x99\xCB\xE0\x3F"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|iqmp
index|[]
init|=
literal|"\x00\x83\xEF\xEF\xB8\xA9\xA4\x0D\x1D\xB6\xED\x98\xAD\x84\xED\x13"
literal|"\x35\xDC\xC1\x08\xF3\x22\xD0\x57\xCF\x8D"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|ctext_ex
index|[]
init|=
literal|"\x14\xbd\xdd\x28\xc9\x83\x35\x19\x23\x80\xe8\xe5\x49\xb1\x58\x2a"
literal|"\x8b\x40\xb4\x48\x6d\x03\xa6\xa5\x31\x1f\x1f\xd5\xf0\xa1\x80\xe4"
literal|"\x17\x53\x03\x29\xa9\x34\x90\x74\xb1\x52\x13\x54\x29\x08\x24\x52"
literal|"\x62\x51"
decl_stmt|;
name|SetKey
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|key3
parameter_list|(
name|RSA
modifier|*
name|key
parameter_list|,
name|unsigned
name|char
modifier|*
name|c
parameter_list|)
block|{
specifier|static
name|unsigned
name|char
name|n
index|[]
init|=
literal|"\x00\xBB\xF8\x2F\x09\x06\x82\xCE\x9C\x23\x38\xAC\x2B\x9D\xA8\x71"
literal|"\xF7\x36\x8D\x07\xEE\xD4\x10\x43\xA4\x40\xD6\xB6\xF0\x74\x54\xF5"
literal|"\x1F\xB8\xDF\xBA\xAF\x03\x5C\x02\xAB\x61\xEA\x48\xCE\xEB\x6F\xCD"
literal|"\x48\x76\xED\x52\x0D\x60\xE1\xEC\x46\x19\x71\x9D\x8A\x5B\x8B\x80"
literal|"\x7F\xAF\xB8\xE0\xA3\xDF\xC7\x37\x72\x3E\xE6\xB4\xB7\xD9\x3A\x25"
literal|"\x84\xEE\x6A\x64\x9D\x06\x09\x53\x74\x88\x34\xB2\x45\x45\x98\x39"
literal|"\x4E\xE0\xAA\xB1\x2D\x7B\x61\xA5\x1F\x52\x7A\x9A\x41\xF6\xC1\x68"
literal|"\x7F\xE2\x53\x72\x98\xCA\x2A\x8F\x59\x46\xF8\xE5\xFD\x09\x1D\xBD"
literal|"\xCB"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|e
index|[]
init|=
literal|"\x11"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|d
index|[]
init|=
literal|"\x00\xA5\xDA\xFC\x53\x41\xFA\xF2\x89\xC4\xB9\x88\xDB\x30\xC1\xCD"
literal|"\xF8\x3F\x31\x25\x1E\x06\x68\xB4\x27\x84\x81\x38\x01\x57\x96\x41"
literal|"\xB2\x94\x10\xB3\xC7\x99\x8D\x6B\xC4\x65\x74\x5E\x5C\x39\x26\x69"
literal|"\xD6\x87\x0D\xA2\xC0\x82\xA9\x39\xE3\x7F\xDC\xB8\x2E\xC9\x3E\xDA"
literal|"\xC9\x7F\xF3\xAD\x59\x50\xAC\xCF\xBC\x11\x1C\x76\xF1\xA9\x52\x94"
literal|"\x44\xE5\x6A\xAF\x68\xC5\x6C\x09\x2C\xD3\x8D\xC3\xBE\xF5\xD2\x0A"
literal|"\x93\x99\x26\xED\x4F\x74\xA1\x3E\xDD\xFB\xE1\xA1\xCE\xCC\x48\x94"
literal|"\xAF\x94\x28\xC2\xB7\xB8\x88\x3F\xE4\x46\x3A\x4B\xC8\x5B\x1C\xB3"
literal|"\xC1"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|p
index|[]
init|=
literal|"\x00\xEE\xCF\xAE\x81\xB1\xB9\xB3\xC9\x08\x81\x0B\x10\xA1\xB5\x60"
literal|"\x01\x99\xEB\x9F\x44\xAE\xF4\xFD\xA4\x93\xB8\x1A\x9E\x3D\x84\xF6"
literal|"\x32\x12\x4E\xF0\x23\x6E\x5D\x1E\x3B\x7E\x28\xFA\xE7\xAA\x04\x0A"
literal|"\x2D\x5B\x25\x21\x76\x45\x9D\x1F\x39\x75\x41\xBA\x2A\x58\xFB\x65"
literal|"\x99"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|q
index|[]
init|=
literal|"\x00\xC9\x7F\xB1\xF0\x27\xF4\x53\xF6\x34\x12\x33\xEA\xAA\xD1\xD9"
literal|"\x35\x3F\x6C\x42\xD0\x88\x66\xB1\xD0\x5A\x0F\x20\x35\x02\x8B\x9D"
literal|"\x86\x98\x40\xB4\x16\x66\xB4\x2E\x92\xEA\x0D\xA3\xB4\x32\x04\xB5"
literal|"\xCF\xCE\x33\x52\x52\x4D\x04\x16\xA5\xA4\x41\xE7\x00\xAF\x46\x15"
literal|"\x03"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|dmp1
index|[]
init|=
literal|"\x54\x49\x4C\xA6\x3E\xBA\x03\x37\xE4\xE2\x40\x23\xFC\xD6\x9A\x5A"
literal|"\xEB\x07\xDD\xDC\x01\x83\xA4\xD0\xAC\x9B\x54\xB0\x51\xF2\xB1\x3E"
literal|"\xD9\x49\x09\x75\xEA\xB7\x74\x14\xFF\x59\xC1\xF7\x69\x2E\x9A\x2E"
literal|"\x20\x2B\x38\xFC\x91\x0A\x47\x41\x74\xAD\xC9\x3C\x1F\x67\xC9\x81"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|dmq1
index|[]
init|=
literal|"\x47\x1E\x02\x90\xFF\x0A\xF0\x75\x03\x51\xB7\xF8\x78\x86\x4C\xA9"
literal|"\x61\xAD\xBD\x3A\x8A\x7E\x99\x1C\x5C\x05\x56\xA9\x4C\x31\x46\xA7"
literal|"\xF9\x80\x3F\x8F\x6F\x8A\xE3\x42\xE9\x31\xFD\x8A\xE4\x7A\x22\x0D"
literal|"\x1B\x99\xA4\x95\x84\x98\x07\xFE\x39\xF9\x24\x5A\x98\x36\xDA\x3D"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|iqmp
index|[]
init|=
literal|"\x00\xB0\x6C\x4F\xDA\xBB\x63\x01\x19\x8D\x26\x5B\xDB\xAE\x94\x23"
literal|"\xB3\x80\xF2\x71\xF7\x34\x53\x88\x50\x93\x07\x7F\xCD\x39\xE2\x11"
literal|"\x9F\xC9\x86\x32\x15\x4F\x58\x83\xB1\x67\xA9\x67\xBF\x40\x2B\x4E"
literal|"\x9E\x2E\x0F\x96\x56\xE6\x98\xEA\x36\x66\xED\xFB\x25\x79\x80\x39"
literal|"\xF7"
decl_stmt|;
specifier|static
name|unsigned
name|char
name|ctext_ex
index|[]
init|=
literal|"\xb8\x24\x6b\x56\xa6\xed\x58\x81\xae\xb5\x85\xd9\xa2\x5b\x2a\xd7"
literal|"\x90\xc4\x17\xe0\x80\x68\x1b\xf1\xac\x2b\xc3\xde\xb6\x9d\x8b\xce"
literal|"\xf0\xc4\x36\x6f\xec\x40\x0a\xf0\x52\xa7\x2e\x9b\x0e\xff\xb5\xb3"
literal|"\xf2\xf1\x92\xdb\xea\xca\x03\xc1\x27\x40\x05\x71\x13\xbf\x1f\x06"
literal|"\x69\xac\x22\xe9\xf3\xa7\x85\x2e\x3c\x15\xd9\x13\xca\xb0\xb8\x86"
literal|"\x3a\x95\xc9\x92\x94\xce\x86\x74\x21\x49\x54\x61\x03\x46\xf4\xd4"
literal|"\x74\xb2\x6f\x7c\x48\xb4\x2e\xe6\x8e\x1f\x57\x2a\x1f\xc4\x02\x6a"
literal|"\xc4\x56\xb4\xf5\x9f\x7b\x62\x1e\xa1\xb9\xd8\x8f\x64\x20\x2f\xb1"
decl_stmt|;
name|SetKey
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pad_unknown
parameter_list|(
name|void
parameter_list|)
block|{
name|unsigned
name|long
name|l
decl_stmt|;
while|while
condition|(
operator|(
name|l
operator|=
name|ERR_get_error
argument_list|()
operator|)
operator|!=
literal|0
condition|)
if|if
condition|(
name|ERR_GET_REASON
argument_list|(
name|l
argument_list|)
operator|==
name|RSA_R_UNKNOWN_PADDING_TYPE
condition|)
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rnd_seed
index|[]
init|=
literal|"string to make the random number generator think it has entropy"
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|int
name|v
decl_stmt|;
name|RSA
modifier|*
name|key
decl_stmt|;
name|unsigned
name|char
name|ptext
index|[
literal|256
index|]
decl_stmt|;
name|unsigned
name|char
name|ctext
index|[
literal|256
index|]
decl_stmt|;
specifier|static
name|unsigned
name|char
name|ptext_ex
index|[]
init|=
literal|"\x54\x85\x9b\x34\x2c\x49\xea\x2a"
decl_stmt|;
name|unsigned
name|char
name|ctext_ex
index|[
literal|256
index|]
decl_stmt|;
name|int
name|plen
decl_stmt|;
name|int
name|clen
init|=
literal|0
decl_stmt|;
name|int
name|num
decl_stmt|;
name|int
name|n
decl_stmt|;
name|CRYPTO_malloc_debug_init
argument_list|()
expr_stmt|;
name|CRYPTO_dbg_set_options
argument_list|(
name|V_CRYPTO_MDEBUG_ALL
argument_list|)
expr_stmt|;
name|CRYPTO_mem_ctrl
argument_list|(
name|CRYPTO_MEM_CHECK_ON
argument_list|)
expr_stmt|;
name|RAND_seed
argument_list|(
name|rnd_seed
argument_list|,
sizeof|sizeof
name|rnd_seed
argument_list|)
expr_stmt|;
comment|/* or OAEP may fail */
name|plen
operator|=
sizeof|sizeof
argument_list|(
name|ptext_ex
argument_list|)
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|v
operator|=
literal|0
init|;
name|v
operator|<
literal|6
condition|;
name|v
operator|++
control|)
block|{
name|key
operator|=
name|RSA_new
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|v
operator|%
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|clen
operator|=
name|key1
argument_list|(
name|key
argument_list|,
name|ctext_ex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|clen
operator|=
name|key2
argument_list|(
name|key
argument_list|,
name|ctext_ex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|clen
operator|=
name|key3
argument_list|(
name|key
argument_list|,
name|ctext_ex
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|v
operator|/
literal|3
operator|>=
literal|1
condition|)
name|key
operator|->
name|flags
operator||=
name|RSA_FLAG_NO_CONSTTIME
expr_stmt|;
name|num
operator|=
name|RSA_public_encrypt
argument_list|(
name|plen
argument_list|,
name|ptext_ex
argument_list|,
name|ctext
argument_list|,
name|key
argument_list|,
name|RSA_PKCS1_PADDING
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
name|clen
condition|)
block|{
name|printf
argument_list|(
literal|"PKCS#1 v1.5 encryption failed!\n"
argument_list|)
expr_stmt|;
name|err
operator|=
literal|1
expr_stmt|;
goto|goto
name|oaep
goto|;
block|}
name|num
operator|=
name|RSA_private_decrypt
argument_list|(
name|num
argument_list|,
name|ctext
argument_list|,
name|ptext
argument_list|,
name|key
argument_list|,
name|RSA_PKCS1_PADDING
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
name|plen
operator|||
name|memcmp
argument_list|(
name|ptext
argument_list|,
name|ptext_ex
argument_list|,
name|num
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"PKCS#1 v1.5 decryption failed!\n"
argument_list|)
expr_stmt|;
name|err
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"PKCS #1 v1.5 encryption/decryption ok\n"
argument_list|)
expr_stmt|;
name|oaep
label|:
name|ERR_clear_error
argument_list|()
expr_stmt|;
name|num
operator|=
name|RSA_public_encrypt
argument_list|(
name|plen
argument_list|,
name|ptext_ex
argument_list|,
name|ctext
argument_list|,
name|key
argument_list|,
name|RSA_PKCS1_OAEP_PADDING
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
operator|-
literal|1
operator|&&
name|pad_unknown
argument_list|()
condition|)
block|{
name|printf
argument_list|(
literal|"No OAEP support\n"
argument_list|)
expr_stmt|;
goto|goto
name|next
goto|;
block|}
if|if
condition|(
name|num
operator|!=
name|clen
condition|)
block|{
name|printf
argument_list|(
literal|"OAEP encryption failed!\n"
argument_list|)
expr_stmt|;
name|err
operator|=
literal|1
expr_stmt|;
goto|goto
name|next
goto|;
block|}
name|num
operator|=
name|RSA_private_decrypt
argument_list|(
name|num
argument_list|,
name|ctext
argument_list|,
name|ptext
argument_list|,
name|key
argument_list|,
name|RSA_PKCS1_OAEP_PADDING
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
name|plen
operator|||
name|memcmp
argument_list|(
name|ptext
argument_list|,
name|ptext_ex
argument_list|,
name|num
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"OAEP decryption (encrypted data) failed!\n"
argument_list|)
expr_stmt|;
name|err
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|memcmp
argument_list|(
name|ctext
argument_list|,
name|ctext_ex
argument_list|,
name|num
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"OAEP test vector %d passed!\n"
argument_list|,
name|v
argument_list|)
expr_stmt|;
comment|/*          * Different ciphertexts (rsa_oaep.c without -DPKCS_TESTVECT). Try          * decrypting ctext_ex          */
name|num
operator|=
name|RSA_private_decrypt
argument_list|(
name|clen
argument_list|,
name|ctext_ex
argument_list|,
name|ptext
argument_list|,
name|key
argument_list|,
name|RSA_PKCS1_OAEP_PADDING
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
name|plen
operator|||
name|memcmp
argument_list|(
name|ptext
argument_list|,
name|ptext_ex
argument_list|,
name|num
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"OAEP decryption (test vector data) failed!\n"
argument_list|)
expr_stmt|;
name|err
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"OAEP encryption/decryption ok\n"
argument_list|)
expr_stmt|;
comment|/* Try decrypting corrupted ciphertexts */
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|clen
condition|;
operator|++
name|n
control|)
block|{
name|int
name|b
decl_stmt|;
name|unsigned
name|char
name|saved
init|=
name|ctext
index|[
name|n
index|]
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|256
condition|;
operator|++
name|b
control|)
block|{
if|if
condition|(
name|b
operator|==
name|saved
condition|)
continue|continue;
name|ctext
index|[
name|n
index|]
operator|=
name|b
expr_stmt|;
name|num
operator|=
name|RSA_private_decrypt
argument_list|(
name|num
argument_list|,
name|ctext
argument_list|,
name|ptext
argument_list|,
name|key
argument_list|,
name|RSA_PKCS1_OAEP_PADDING
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|>
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Corrupt data decrypted!\n"
argument_list|)
expr_stmt|;
name|err
operator|=
literal|1
expr_stmt|;
block|}
block|}
block|}
name|next
label|:
name|RSA_free
argument_list|(
name|key
argument_list|)
expr_stmt|;
block|}
name|CRYPTO_cleanup_all_ex_data
argument_list|()
expr_stmt|;
name|ERR_remove_state
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|CRYPTO_mem_leaks_fp
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|OPENSSL_SYS_NETWARE
if|if
condition|(
name|err
condition|)
name|printf
argument_list|(
literal|"ERROR: %d\n"
argument_list|,
name|err
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|err
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

