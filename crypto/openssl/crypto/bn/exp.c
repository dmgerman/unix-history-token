begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<openssl/tmdiff.h>
end_include

begin_include
include|#
directive|include
file|"bn_lcl.h"
end_include

begin_define
define|#
directive|define
name|SIZE
value|256
end_define

begin_define
define|#
directive|define
name|NUM
value|(8*8*8)
end_define

begin_define
define|#
directive|define
name|MOD
value|(8*8*8*8*8)
end_define

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|BN_CTX
name|ctx
decl_stmt|;
name|BIGNUM
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|r
decl_stmt|,
name|rr
decl_stmt|,
name|t
decl_stmt|,
name|l
decl_stmt|;
name|int
name|j
decl_stmt|,
name|i
decl_stmt|,
name|size
init|=
name|SIZE
decl_stmt|,
name|num
init|=
name|NUM
decl_stmt|,
name|mod
init|=
name|MOD
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|;
name|BN_MONT_CTX
name|mont
decl_stmt|;
name|double
name|d
decl_stmt|,
name|md
decl_stmt|;
name|BN_MONT_CTX_init
argument_list|(
operator|&
name|mont
argument_list|)
expr_stmt|;
name|BN_CTX_init
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
name|BN_init
argument_list|(
operator|&
name|a
argument_list|)
expr_stmt|;
name|BN_init
argument_list|(
operator|&
name|b
argument_list|)
expr_stmt|;
name|BN_init
argument_list|(
operator|&
name|c
argument_list|)
expr_stmt|;
name|BN_init
argument_list|(
operator|&
name|r
argument_list|)
expr_stmt|;
name|start
operator|=
name|ms_time_new
argument_list|()
expr_stmt|;
name|end
operator|=
name|ms_time_new
argument_list|()
expr_stmt|;
while|while
condition|(
name|size
operator|<=
literal|1024
operator|*
literal|8
condition|)
block|{
name|BN_rand
argument_list|(
operator|&
name|a
argument_list|,
name|size
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|BN_rand
argument_list|(
operator|&
name|b
argument_list|,
name|size
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|BN_rand
argument_list|(
operator|&
name|c
argument_list|,
name|size
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|BN_mod
argument_list|(
operator|&
name|a
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|ctx
argument_list|)
expr_stmt|;
name|ms_time_get
argument_list|(
name|start
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
name|BN_MONT_CTX_set
argument_list|(
operator|&
name|mont
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|ctx
argument_list|)
expr_stmt|;
name|ms_time_get
argument_list|(
name|end
argument_list|)
expr_stmt|;
name|md
operator|=
name|ms_time_diff
argument_list|(
name|start
argument_list|,
name|end
argument_list|)
expr_stmt|;
name|ms_time_get
argument_list|(
name|start
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
comment|/* bn_mull(&r,&a,&b,&ctx); */
comment|/* BN_sqr(&r,&a,&ctx); */
name|BN_mod_exp_mont
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|ctx
argument_list|,
operator|&
name|mont
argument_list|)
expr_stmt|;
block|}
name|ms_time_get
argument_list|(
name|end
argument_list|)
expr_stmt|;
name|d
operator|=
name|ms_time_diff
argument_list|(
name|start
argument_list|,
name|end
argument_list|)
comment|/* *50/33 */
expr_stmt|;
name|printf
argument_list|(
literal|"%5d bit:%6.2f %6d %6.4f %4d m_set(%5.4f)\n"
argument_list|,
name|size
argument_list|,
name|d
argument_list|,
name|num
argument_list|,
name|d
operator|/
name|num
argument_list|,
call|(
name|int
call|)
argument_list|(
operator|(
name|d
operator|/
name|num
operator|)
operator|*
name|mod
argument_list|)
argument_list|,
name|md
operator|/
literal|10.0
argument_list|)
expr_stmt|;
name|num
operator|/=
literal|8
expr_stmt|;
name|mod
operator|/=
literal|8
expr_stmt|;
if|if
condition|(
name|num
operator|<=
literal|0
condition|)
name|num
operator|=
literal|1
expr_stmt|;
name|size
operator|*=
literal|2
expr_stmt|;
block|}
block|}
end_function

end_unit

