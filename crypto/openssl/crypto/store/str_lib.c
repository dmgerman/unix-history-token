begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* crypto/store/str_lib.c */
end_comment

begin_comment
comment|/*  * Written by Richard Levitte (richard@levitte.org) for the OpenSSL project  * 2003.  */
end_comment

begin_comment
comment|/* ====================================================================  * Copyright (c) 2003 The OpenSSL Project.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  *  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in  *    the documentation and/or other materials provided with the  *    distribution.  *  * 3. All advertising materials mentioning features or use of this  *    software must display the following acknowledgment:  *    "This product includes software developed by the OpenSSL Project  *    for use in the OpenSSL Toolkit. (http://www.openssl.org/)"  *  * 4. The names "OpenSSL Toolkit" and "OpenSSL Project" must not be used to  *    endorse or promote products derived from this software without  *    prior written permission. For written permission, please contact  *    openssl-core@openssl.org.  *  * 5. Products derived from this software may not be called "OpenSSL"  *    nor may "OpenSSL" appear in their names without prior written  *    permission of the OpenSSL Project.  *  * 6. Redistributions of any form whatsoever must retain the following  *    acknowledgment:  *    "This product includes software developed by the OpenSSL Project  *    for use in the OpenSSL Toolkit (http://www.openssl.org/)"  *  * THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS'' AND ANY  * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OpenSSL PROJECT OR  * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED  * OF THE POSSIBILITY OF SUCH DAMAGE.  * ====================================================================  *  * This product includes cryptographic software written by Eric Young  * (eay@cryptsoft.com).  This product includes software written by Tim  * Hudson (tjh@cryptsoft.com).  *  */
end_comment

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<openssl/bn.h>
end_include

begin_include
include|#
directive|include
file|<openssl/err.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|OPENSSL_NO_ENGINE
end_ifndef

begin_include
include|#
directive|include
file|<openssl/engine.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<openssl/sha.h>
end_include

begin_include
include|#
directive|include
file|<openssl/x509.h>
end_include

begin_include
include|#
directive|include
file|"str_locl.h"
end_include

begin_decl_stmt
specifier|const
name|char
modifier|*
specifier|const
name|STORE_object_type_string
index|[
name|STORE_OBJECT_TYPE_NUM
operator|+
literal|1
index|]
init|=
block|{
literal|0
block|,
literal|"X.509 Certificate"
block|,
literal|"X.509 CRL"
block|,
literal|"Private Key"
block|,
literal|"Public Key"
block|,
literal|"Number"
block|,
literal|"Arbitrary Data"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|int
name|STORE_param_sizes
index|[
name|STORE_PARAM_TYPE_NUM
operator|+
literal|1
index|]
init|=
block|{
literal|0
block|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
block|,
comment|/* EVP_TYPE */
sizeof|sizeof
argument_list|(
name|size_t
argument_list|)
block|,
comment|/* BITS */
operator|-
literal|1
block|,
comment|/* KEY_PARAMETERS */
literal|0
comment|/* KEY_NO_PARAMETERS */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|int
name|STORE_attr_sizes
index|[
name|STORE_ATTR_TYPE_NUM
operator|+
literal|1
index|]
init|=
block|{
literal|0
block|,
operator|-
literal|1
block|,
comment|/* FRIENDLYNAME: C string */
name|SHA_DIGEST_LENGTH
block|,
comment|/* KEYID: SHA1 digest, 160 bits */
name|SHA_DIGEST_LENGTH
block|,
comment|/* ISSUERKEYID: SHA1 digest, 160 bits */
name|SHA_DIGEST_LENGTH
block|,
comment|/* SUBJECTKEYID: SHA1 digest, 160 bits */
name|SHA_DIGEST_LENGTH
block|,
comment|/* ISSUERSERIALHASH: SHA1 digest, 160 bits */
sizeof|sizeof
argument_list|(
name|X509_NAME
operator|*
argument_list|)
block|,
comment|/* ISSUER: X509_NAME * */
sizeof|sizeof
argument_list|(
name|BIGNUM
operator|*
argument_list|)
block|,
comment|/* SERIAL: BIGNUM * */
sizeof|sizeof
argument_list|(
name|X509_NAME
operator|*
argument_list|)
block|,
comment|/* SUBJECT: X509_NAME * */
name|SHA_DIGEST_LENGTH
block|,
comment|/* CERTHASH: SHA1 digest, 160 bits */
operator|-
literal|1
block|,
comment|/* EMAIL: C string */
operator|-
literal|1
block|,
comment|/* FILENAME: C string */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|STORE
modifier|*
name|STORE_new_method
parameter_list|(
specifier|const
name|STORE_METHOD
modifier|*
name|method
parameter_list|)
block|{
name|STORE
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|method
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_NEW_METHOD
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|ret
operator|=
operator|(
name|STORE
operator|*
operator|)
name|OPENSSL_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|STORE
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_NEW_METHOD
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|ret
operator|->
name|meth
operator|=
name|method
expr_stmt|;
name|CRYPTO_new_ex_data
argument_list|(
name|CRYPTO_EX_INDEX_STORE
argument_list|,
name|ret
argument_list|,
operator|&
name|ret
operator|->
name|ex_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|->
name|meth
operator|->
name|init
operator|&&
operator|!
name|ret
operator|->
name|meth
operator|->
name|init
argument_list|(
name|ret
argument_list|)
condition|)
block|{
name|STORE_free
argument_list|(
name|ret
argument_list|)
expr_stmt|;
name|ret
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|STORE
modifier|*
name|STORE_new_engine
parameter_list|(
name|ENGINE
modifier|*
name|engine
parameter_list|)
block|{
name|STORE
modifier|*
name|ret
init|=
name|NULL
decl_stmt|;
name|ENGINE
modifier|*
name|e
init|=
name|engine
decl_stmt|;
specifier|const
name|STORE_METHOD
modifier|*
name|meth
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|OPENSSL_NO_ENGINE
name|e
operator|=
name|NULL
expr_stmt|;
else|#
directive|else
if|if
condition|(
name|engine
condition|)
block|{
if|if
condition|(
operator|!
name|ENGINE_init
argument_list|(
name|engine
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_NEW_ENGINE
argument_list|,
name|ERR_R_ENGINE_LIB
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|e
operator|=
name|engine
expr_stmt|;
block|}
else|else
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_NEW_ENGINE
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|e
condition|)
block|{
name|meth
operator|=
name|ENGINE_get_STORE
argument_list|(
name|e
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|meth
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_NEW_ENGINE
argument_list|,
name|ERR_R_ENGINE_LIB
argument_list|)
expr_stmt|;
name|ENGINE_finish
argument_list|(
name|e
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
endif|#
directive|endif
name|ret
operator|=
name|STORE_new_method
argument_list|(
name|meth
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_NEW_ENGINE
argument_list|,
name|ERR_R_STORE_LIB
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|ret
operator|->
name|engine
operator|=
name|e
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|void
name|STORE_free
parameter_list|(
name|STORE
modifier|*
name|store
parameter_list|)
block|{
if|if
condition|(
name|store
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|store
operator|->
name|meth
operator|->
name|clean
condition|)
name|store
operator|->
name|meth
operator|->
name|clean
argument_list|(
name|store
argument_list|)
expr_stmt|;
name|CRYPTO_free_ex_data
argument_list|(
name|CRYPTO_EX_INDEX_STORE
argument_list|,
name|store
argument_list|,
operator|&
name|store
operator|->
name|ex_data
argument_list|)
expr_stmt|;
name|OPENSSL_free
argument_list|(
name|store
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|STORE_ctrl
parameter_list|(
name|STORE
modifier|*
name|store
parameter_list|,
name|int
name|cmd
parameter_list|,
name|long
name|i
parameter_list|,
name|void
modifier|*
name|p
parameter_list|,
name|void
function_decl|(
modifier|*
name|f
function_decl|)
parameter_list|(
name|void
parameter_list|)
parameter_list|)
block|{
if|if
condition|(
name|store
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_CTRL
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|store
operator|->
name|meth
operator|->
name|ctrl
condition|)
return|return
name|store
operator|->
name|meth
operator|->
name|ctrl
argument_list|(
name|store
argument_list|,
name|cmd
argument_list|,
name|i
argument_list|,
name|p
argument_list|,
name|f
argument_list|)
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_CTRL
argument_list|,
name|STORE_R_NO_CONTROL_FUNCTION
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_get_ex_new_index
parameter_list|(
name|long
name|argl
parameter_list|,
name|void
modifier|*
name|argp
parameter_list|,
name|CRYPTO_EX_new
modifier|*
name|new_func
parameter_list|,
name|CRYPTO_EX_dup
modifier|*
name|dup_func
parameter_list|,
name|CRYPTO_EX_free
modifier|*
name|free_func
parameter_list|)
block|{
return|return
name|CRYPTO_get_ex_new_index
argument_list|(
name|CRYPTO_EX_INDEX_STORE
argument_list|,
name|argl
argument_list|,
name|argp
argument_list|,
name|new_func
argument_list|,
name|dup_func
argument_list|,
name|free_func
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|STORE_set_ex_data
parameter_list|(
name|STORE
modifier|*
name|r
parameter_list|,
name|int
name|idx
parameter_list|,
name|void
modifier|*
name|arg
parameter_list|)
block|{
return|return
operator|(
name|CRYPTO_set_ex_data
argument_list|(
operator|&
name|r
operator|->
name|ex_data
argument_list|,
name|idx
argument_list|,
name|arg
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|STORE_get_ex_data
parameter_list|(
name|STORE
modifier|*
name|r
parameter_list|,
name|int
name|idx
parameter_list|)
block|{
return|return
operator|(
name|CRYPTO_get_ex_data
argument_list|(
operator|&
name|r
operator|->
name|ex_data
argument_list|,
name|idx
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|const
name|STORE_METHOD
modifier|*
name|STORE_get_method
parameter_list|(
name|STORE
modifier|*
name|store
parameter_list|)
block|{
return|return
name|store
operator|->
name|meth
return|;
block|}
end_function

begin_function
specifier|const
name|STORE_METHOD
modifier|*
name|STORE_set_method
parameter_list|(
name|STORE
modifier|*
name|store
parameter_list|,
specifier|const
name|STORE_METHOD
modifier|*
name|meth
parameter_list|)
block|{
name|store
operator|->
name|meth
operator|=
name|meth
expr_stmt|;
return|return
name|store
operator|->
name|meth
return|;
block|}
end_function

begin_comment
comment|/* API helpers */
end_comment

begin_define
define|#
directive|define
name|check_store
parameter_list|(
name|s
parameter_list|,
name|fncode
parameter_list|,
name|fnname
parameter_list|,
name|fnerrcode
parameter_list|)
define|\
value|do \                 { \                 if ((s) == NULL || (s)->meth == NULL) \                         { \                         STOREerr((fncode), ERR_R_PASSED_NULL_PARAMETER); \                         return 0; \                         } \                 if ((s)->meth->fnname == NULL) \                         { \                         STOREerr((fncode), (fnerrcode)); \                         return 0; \                         } \                 } \         while(0)
end_define

begin_comment
comment|/* API functions */
end_comment

begin_function
name|X509
modifier|*
name|STORE_get_certificate
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|X509
modifier|*
name|x
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GET_CERTIFICATE
argument_list|,
name|get_object
argument_list|,
name|STORE_R_NO_GET_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|get_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GET_CERTIFICATE
argument_list|,
name|STORE_R_FAILED_GETTING_CERTIFICATE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|x
operator|=
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|x
return|;
block|}
end_function

begin_function
name|int
name|STORE_store_certificate
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|X509
modifier|*
name|data
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_CERTIFICATE
argument_list|,
name|store_object
argument_list|,
name|STORE_R_NO_STORE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|STORE_OBJECT_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_CERTIFICATE
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|data
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
operator|=
name|data
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|store_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
argument_list|,
name|object
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_CERTIFICATE
argument_list|,
name|STORE_R_FAILED_STORING_CERTIFICATE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_modify_certificate
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|search_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|add_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|modify_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|delete_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_MODIFY_CERTIFICATE
argument_list|,
name|modify_object
argument_list|,
name|STORE_R_NO_MODIFY_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|modify_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
argument_list|,
name|search_attributes
argument_list|,
name|add_attributes
argument_list|,
name|modify_attributes
argument_list|,
name|delete_attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_MODIFY_CERTIFICATE
argument_list|,
name|STORE_R_FAILED_MODIFYING_CERTIFICATE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_revoke_certificate
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_REVOKE_CERTIFICATE
argument_list|,
name|revoke_object
argument_list|,
name|STORE_R_NO_REVOKE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|revoke_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_REVOKE_CERTIFICATE
argument_list|,
name|STORE_R_FAILED_REVOKING_CERTIFICATE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_delete_certificate
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_DELETE_CERTIFICATE
argument_list|,
name|delete_object
argument_list|,
name|STORE_R_NO_DELETE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|delete_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_DELETE_CERTIFICATE
argument_list|,
name|STORE_R_FAILED_DELETING_CERTIFICATE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|STORE_list_certificate_start
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|void
modifier|*
name|handle
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CERTIFICATE_START
argument_list|,
name|list_object_start
argument_list|,
name|STORE_R_NO_LIST_OBJECT_START_FUNCTION
argument_list|)
expr_stmt|;
name|handle
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_start
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|handle
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CERTIFICATE_START
argument_list|,
name|STORE_R_FAILED_LISTING_CERTIFICATES
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|handle
return|;
block|}
end_function

begin_function
name|X509
modifier|*
name|STORE_list_certificate_next
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|X509
modifier|*
name|x
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CERTIFICATE_NEXT
argument_list|,
name|list_object_next
argument_list|,
name|STORE_R_NO_LIST_OBJECT_NEXT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_next
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CERTIFICATE_NEXT
argument_list|,
name|STORE_R_FAILED_LISTING_CERTIFICATES
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|x
operator|=
name|object
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|x
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_certificate_end
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CERTIFICATE_END
argument_list|,
name|list_object_end
argument_list|,
name|STORE_R_NO_LIST_OBJECT_END_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_end
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CERTIFICATE_END
argument_list|,
name|STORE_R_FAILED_LISTING_CERTIFICATES
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_certificate_endp
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CERTIFICATE_ENDP
argument_list|,
name|list_object_endp
argument_list|,
name|STORE_R_NO_LIST_OBJECT_ENDP_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_endp
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CERTIFICATE_ENDP
argument_list|,
name|STORE_R_FAILED_LISTING_CERTIFICATES
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|EVP_PKEY
modifier|*
name|STORE_generate_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|EVP_PKEY
modifier|*
name|pkey
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GENERATE_KEY
argument_list|,
name|generate_object
argument_list|,
name|STORE_R_NO_GENERATE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|generate_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GENERATE_KEY
argument_list|,
name|STORE_R_FAILED_GENERATING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|key
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pkey
operator|=
name|object
operator|->
name|data
operator|.
name|key
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|pkey
return|;
block|}
end_function

begin_function
name|EVP_PKEY
modifier|*
name|STORE_get_private_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|EVP_PKEY
modifier|*
name|pkey
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GET_PRIVATE_KEY
argument_list|,
name|get_object
argument_list|,
name|STORE_R_NO_GET_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|get_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GET_PRIVATE_KEY
argument_list|,
name|STORE_R_FAILED_GETTING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|key
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pkey
operator|=
name|object
operator|->
name|data
operator|.
name|key
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|pkey
return|;
block|}
end_function

begin_function
name|int
name|STORE_store_private_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|EVP_PKEY
modifier|*
name|data
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_STORE_PRIVATE_KEY
argument_list|,
name|store_object
argument_list|,
name|STORE_R_NO_STORE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|STORE_OBJECT_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_PRIVATE_KEY
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|object
operator|->
name|data
operator|.
name|key
operator|=
name|EVP_PKEY_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_PRIVATE_KEY
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|data
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|object
operator|->
name|data
operator|.
name|key
operator|=
name|data
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|store_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|object
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_PRIVATE_KEY
argument_list|,
name|STORE_R_FAILED_STORING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_function
name|int
name|STORE_modify_private_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|search_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|add_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|modify_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|delete_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_MODIFY_PRIVATE_KEY
argument_list|,
name|modify_object
argument_list|,
name|STORE_R_NO_MODIFY_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|modify_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|search_attributes
argument_list|,
name|add_attributes
argument_list|,
name|modify_attributes
argument_list|,
name|delete_attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_MODIFY_PRIVATE_KEY
argument_list|,
name|STORE_R_FAILED_MODIFYING_PRIVATE_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_revoke_private_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_REVOKE_PRIVATE_KEY
argument_list|,
name|revoke_object
argument_list|,
name|STORE_R_NO_REVOKE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|revoke_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_REVOKE_PRIVATE_KEY
argument_list|,
name|STORE_R_FAILED_REVOKING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_function
name|int
name|STORE_delete_private_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_DELETE_PRIVATE_KEY
argument_list|,
name|delete_object
argument_list|,
name|STORE_R_NO_DELETE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|delete_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_DELETE_PRIVATE_KEY
argument_list|,
name|STORE_R_FAILED_DELETING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|STORE_list_private_key_start
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|void
modifier|*
name|handle
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PRIVATE_KEY_START
argument_list|,
name|list_object_start
argument_list|,
name|STORE_R_NO_LIST_OBJECT_START_FUNCTION
argument_list|)
expr_stmt|;
name|handle
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_start
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PRIVATE_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|handle
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PRIVATE_KEY_START
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|handle
return|;
block|}
end_function

begin_function
name|EVP_PKEY
modifier|*
name|STORE_list_private_key_next
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|EVP_PKEY
modifier|*
name|pkey
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PRIVATE_KEY_NEXT
argument_list|,
name|list_object_next
argument_list|,
name|STORE_R_NO_LIST_OBJECT_NEXT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_next
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PRIVATE_KEY_NEXT
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|key
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pkey
operator|=
name|object
operator|->
name|data
operator|.
name|key
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|pkey
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_private_key_end
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PRIVATE_KEY_END
argument_list|,
name|list_object_end
argument_list|,
name|STORE_R_NO_LIST_OBJECT_END_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_end
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PRIVATE_KEY_END
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_private_key_endp
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PRIVATE_KEY_ENDP
argument_list|,
name|list_object_endp
argument_list|,
name|STORE_R_NO_LIST_OBJECT_ENDP_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_endp
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PRIVATE_KEY_ENDP
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|EVP_PKEY
modifier|*
name|STORE_get_public_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|EVP_PKEY
modifier|*
name|pkey
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GET_PUBLIC_KEY
argument_list|,
name|get_object
argument_list|,
name|STORE_R_NO_GET_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|get_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PUBLIC_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GET_PUBLIC_KEY
argument_list|,
name|STORE_R_FAILED_GETTING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|key
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pkey
operator|=
name|object
operator|->
name|data
operator|.
name|key
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|pkey
return|;
block|}
end_function

begin_function
name|int
name|STORE_store_public_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|EVP_PKEY
modifier|*
name|data
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_STORE_PUBLIC_KEY
argument_list|,
name|store_object
argument_list|,
name|STORE_R_NO_STORE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|STORE_OBJECT_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_PUBLIC_KEY
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|object
operator|->
name|data
operator|.
name|key
operator|=
name|EVP_PKEY_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_PUBLIC_KEY
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|data
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|object
operator|->
name|data
operator|.
name|key
operator|=
name|data
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|store_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PUBLIC_KEY
argument_list|,
name|object
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_PUBLIC_KEY
argument_list|,
name|STORE_R_FAILED_STORING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_function
name|int
name|STORE_modify_public_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|search_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|add_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|modify_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|delete_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_MODIFY_PUBLIC_KEY
argument_list|,
name|modify_object
argument_list|,
name|STORE_R_NO_MODIFY_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|modify_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PUBLIC_KEY
argument_list|,
name|search_attributes
argument_list|,
name|add_attributes
argument_list|,
name|modify_attributes
argument_list|,
name|delete_attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_MODIFY_PUBLIC_KEY
argument_list|,
name|STORE_R_FAILED_MODIFYING_PUBLIC_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_revoke_public_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_REVOKE_PUBLIC_KEY
argument_list|,
name|revoke_object
argument_list|,
name|STORE_R_NO_REVOKE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|revoke_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PUBLIC_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_REVOKE_PUBLIC_KEY
argument_list|,
name|STORE_R_FAILED_REVOKING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_function
name|int
name|STORE_delete_public_key
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_DELETE_PUBLIC_KEY
argument_list|,
name|delete_object
argument_list|,
name|STORE_R_NO_DELETE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|delete_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PUBLIC_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_DELETE_PUBLIC_KEY
argument_list|,
name|STORE_R_FAILED_DELETING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|STORE_list_public_key_start
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|void
modifier|*
name|handle
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PUBLIC_KEY_START
argument_list|,
name|list_object_start
argument_list|,
name|STORE_R_NO_LIST_OBJECT_START_FUNCTION
argument_list|)
expr_stmt|;
name|handle
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_start
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_PUBLIC_KEY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|handle
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PUBLIC_KEY_START
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|handle
return|;
block|}
end_function

begin_function
name|EVP_PKEY
modifier|*
name|STORE_list_public_key_next
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|EVP_PKEY
modifier|*
name|pkey
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PUBLIC_KEY_NEXT
argument_list|,
name|list_object_next
argument_list|,
name|STORE_R_NO_LIST_OBJECT_NEXT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_next
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|key
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PUBLIC_KEY_NEXT
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|key
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_EVP_PKEY
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"EVP_PKEY"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pkey
operator|=
name|object
operator|->
name|data
operator|.
name|key
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|pkey
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_public_key_end
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PUBLIC_KEY_END
argument_list|,
name|list_object_end
argument_list|,
name|STORE_R_NO_LIST_OBJECT_END_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_end
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PUBLIC_KEY_END
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_public_key_endp
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_PUBLIC_KEY_ENDP
argument_list|,
name|list_object_endp
argument_list|,
name|STORE_R_NO_LIST_OBJECT_ENDP_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_endp
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_PUBLIC_KEY_ENDP
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|X509_CRL
modifier|*
name|STORE_generate_crl
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|X509_CRL
modifier|*
name|crl
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GENERATE_CRL
argument_list|,
name|generate_object
argument_list|,
name|STORE_R_NO_GENERATE_CRL_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|generate_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CRL
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|crl
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GENERATE_CRL
argument_list|,
name|STORE_R_FAILED_GENERATING_CRL
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|crl
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509_CRL
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509_CRL"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|crl
operator|=
name|object
operator|->
name|data
operator|.
name|crl
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|crl
return|;
block|}
end_function

begin_function
name|X509_CRL
modifier|*
name|STORE_get_crl
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|X509_CRL
modifier|*
name|crl
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GET_CRL
argument_list|,
name|get_object
argument_list|,
name|STORE_R_NO_GET_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|get_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CRL
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|crl
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GET_CRL
argument_list|,
name|STORE_R_FAILED_GETTING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|crl
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509_CRL
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509_CRL"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|crl
operator|=
name|object
operator|->
name|data
operator|.
name|crl
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|crl
return|;
block|}
end_function

begin_function
name|int
name|STORE_store_crl
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|X509_CRL
modifier|*
name|data
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_STORE_CRL
argument_list|,
name|store_object
argument_list|,
name|STORE_R_NO_STORE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|STORE_OBJECT_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_CRL
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|data
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509_CRL
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509_CRL"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|object
operator|->
name|data
operator|.
name|crl
operator|=
name|data
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|store_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CRL
argument_list|,
name|object
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_CRL
argument_list|,
name|STORE_R_FAILED_STORING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_function
name|int
name|STORE_modify_crl
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|search_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|add_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|modify_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|delete_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_MODIFY_CRL
argument_list|,
name|modify_object
argument_list|,
name|STORE_R_NO_MODIFY_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|modify_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CRL
argument_list|,
name|search_attributes
argument_list|,
name|add_attributes
argument_list|,
name|modify_attributes
argument_list|,
name|delete_attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_MODIFY_CRL
argument_list|,
name|STORE_R_FAILED_MODIFYING_CRL
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_delete_crl
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_DELETE_CRL
argument_list|,
name|delete_object
argument_list|,
name|STORE_R_NO_DELETE_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|delete_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CRL
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_DELETE_CRL
argument_list|,
name|STORE_R_FAILED_DELETING_KEY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|STORE_list_crl_start
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|void
modifier|*
name|handle
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CRL_START
argument_list|,
name|list_object_start
argument_list|,
name|STORE_R_NO_LIST_OBJECT_START_FUNCTION
argument_list|)
expr_stmt|;
name|handle
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_start
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_X509_CRL
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|handle
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CRL_START
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|handle
return|;
block|}
end_function

begin_function
name|X509_CRL
modifier|*
name|STORE_list_crl_next
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|X509_CRL
modifier|*
name|crl
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CRL_NEXT
argument_list|,
name|list_object_next
argument_list|,
name|STORE_R_NO_LIST_OBJECT_NEXT_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|list_object_next
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|crl
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CRL_NEXT
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|CRYPTO_add
argument_list|(
operator|&
name|object
operator|->
name|data
operator|.
name|crl
operator|->
name|references
argument_list|,
literal|1
argument_list|,
name|CRYPTO_LOCK_X509_CRL
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REF_PRINT
name|REF_PRINT
argument_list|(
literal|"X509_CRL"
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|crl
operator|=
name|object
operator|->
name|data
operator|.
name|crl
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|crl
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_crl_end
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CRL_END
argument_list|,
name|list_object_end
argument_list|,
name|STORE_R_NO_LIST_OBJECT_END_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_end
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CRL_END
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_list_crl_endp
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_LIST_CRL_ENDP
argument_list|,
name|list_object_endp
argument_list|,
name|STORE_R_NO_LIST_OBJECT_ENDP_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|list_object_endp
argument_list|(
name|s
argument_list|,
name|handle
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_LIST_CRL_ENDP
argument_list|,
name|STORE_R_FAILED_LISTING_KEYS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_store_number
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|BIGNUM
modifier|*
name|data
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_STORE_NUMBER
argument_list|,
name|store_object
argument_list|,
name|STORE_R_NO_STORE_OBJECT_NUMBER_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|STORE_OBJECT_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_NUMBER
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|object
operator|->
name|data
operator|.
name|number
operator|=
name|data
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|store_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_NUMBER
argument_list|,
name|object
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_NUMBER
argument_list|,
name|STORE_R_FAILED_STORING_NUMBER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_modify_number
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|search_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|add_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|modify_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|delete_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_MODIFY_NUMBER
argument_list|,
name|modify_object
argument_list|,
name|STORE_R_NO_MODIFY_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|modify_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_NUMBER
argument_list|,
name|search_attributes
argument_list|,
name|add_attributes
argument_list|,
name|modify_attributes
argument_list|,
name|delete_attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_MODIFY_NUMBER
argument_list|,
name|STORE_R_FAILED_MODIFYING_NUMBER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|BIGNUM
modifier|*
name|STORE_get_number
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|BIGNUM
modifier|*
name|n
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GET_NUMBER
argument_list|,
name|get_object
argument_list|,
name|STORE_R_NO_GET_OBJECT_NUMBER_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|get_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_NUMBER
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|number
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GET_NUMBER
argument_list|,
name|STORE_R_FAILED_GETTING_NUMBER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|n
operator|=
name|object
operator|->
name|data
operator|.
name|number
expr_stmt|;
name|object
operator|->
name|data
operator|.
name|number
operator|=
name|NULL
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|n
return|;
block|}
end_function

begin_function
name|int
name|STORE_delete_number
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_DELETE_NUMBER
argument_list|,
name|delete_object
argument_list|,
name|STORE_R_NO_DELETE_NUMBER_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|delete_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_NUMBER
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_DELETE_NUMBER
argument_list|,
name|STORE_R_FAILED_DELETING_NUMBER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_store_arbitrary
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|BUF_MEM
modifier|*
name|data
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|int
name|i
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_STORE_ARBITRARY
argument_list|,
name|store_object
argument_list|,
name|STORE_R_NO_STORE_OBJECT_ARBITRARY_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|STORE_OBJECT_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|object
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_ARBITRARY
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|object
operator|->
name|data
operator|.
name|arbitrary
operator|=
name|data
expr_stmt|;
name|i
operator|=
name|s
operator|->
name|meth
operator|->
name|store_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_ARBITRARY
argument_list|,
name|object
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_STORE_ARBITRARY
argument_list|,
name|STORE_R_FAILED_STORING_ARBITRARY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_modify_arbitrary
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|search_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|add_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|modify_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|delete_attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_MODIFY_ARBITRARY
argument_list|,
name|modify_object
argument_list|,
name|STORE_R_NO_MODIFY_OBJECT_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|modify_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_ARBITRARY
argument_list|,
name|search_attributes
argument_list|,
name|add_attributes
argument_list|,
name|modify_attributes
argument_list|,
name|delete_attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_MODIFY_ARBITRARY
argument_list|,
name|STORE_R_FAILED_MODIFYING_ARBITRARY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|BUF_MEM
modifier|*
name|STORE_get_arbitrary
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
decl_stmt|;
name|BUF_MEM
modifier|*
name|b
decl_stmt|;
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_GET_ARBITRARY
argument_list|,
name|get_object
argument_list|,
name|STORE_R_NO_GET_OBJECT_ARBITRARY_FUNCTION
argument_list|)
expr_stmt|;
name|object
operator|=
name|s
operator|->
name|meth
operator|->
name|get_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_ARBITRARY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|object
operator|||
operator|!
name|object
operator|->
name|data
operator|.
name|arbitrary
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_GET_ARBITRARY
argument_list|,
name|STORE_R_FAILED_GETTING_ARBITRARY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|b
operator|=
name|object
operator|->
name|data
operator|.
name|arbitrary
expr_stmt|;
name|object
operator|->
name|data
operator|.
name|arbitrary
operator|=
name|NULL
expr_stmt|;
name|STORE_OBJECT_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
return|return
name|b
return|;
block|}
end_function

begin_function
name|int
name|STORE_delete_arbitrary
parameter_list|(
name|STORE
modifier|*
name|s
parameter_list|,
name|OPENSSL_ITEM
name|attributes
index|[]
parameter_list|,
name|OPENSSL_ITEM
name|parameters
index|[]
parameter_list|)
block|{
name|check_store
argument_list|(
name|s
argument_list|,
name|STORE_F_STORE_DELETE_ARBITRARY
argument_list|,
name|delete_object
argument_list|,
name|STORE_R_NO_DELETE_ARBITRARY_FUNCTION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|->
name|meth
operator|->
name|delete_object
argument_list|(
name|s
argument_list|,
name|STORE_OBJECT_TYPE_ARBITRARY
argument_list|,
name|attributes
argument_list|,
name|parameters
argument_list|)
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_DELETE_ARBITRARY
argument_list|,
name|STORE_R_FAILED_DELETING_ARBITRARY
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|STORE_OBJECT
modifier|*
name|STORE_OBJECT_new
parameter_list|(
name|void
parameter_list|)
block|{
name|STORE_OBJECT
modifier|*
name|object
init|=
name|OPENSSL_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|STORE_OBJECT
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|object
condition|)
name|memset
argument_list|(
name|object
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|STORE_OBJECT
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|object
return|;
block|}
end_function

begin_function
name|void
name|STORE_OBJECT_free
parameter_list|(
name|STORE_OBJECT
modifier|*
name|data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|data
condition|)
return|return;
switch|switch
condition|(
name|data
operator|->
name|type
condition|)
block|{
case|case
name|STORE_OBJECT_TYPE_X509_CERTIFICATE
case|:
name|X509_free
argument_list|(
name|data
operator|->
name|data
operator|.
name|x509
operator|.
name|certificate
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_OBJECT_TYPE_X509_CRL
case|:
name|X509_CRL_free
argument_list|(
name|data
operator|->
name|data
operator|.
name|crl
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_OBJECT_TYPE_PRIVATE_KEY
case|:
case|case
name|STORE_OBJECT_TYPE_PUBLIC_KEY
case|:
name|EVP_PKEY_free
argument_list|(
name|data
operator|->
name|data
operator|.
name|key
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_OBJECT_TYPE_NUMBER
case|:
name|BN_free
argument_list|(
name|data
operator|->
name|data
operator|.
name|number
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_OBJECT_TYPE_ARBITRARY
case|:
name|BUF_MEM_free
argument_list|(
name|data
operator|->
name|data
operator|.
name|arbitrary
argument_list|)
expr_stmt|;
break|break;
block|}
name|OPENSSL_free
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|IMPLEMENT_STACK_OF
argument_list|(
argument|STORE_OBJECT*
argument_list|)
end_macro

begin_struct
struct|struct
name|STORE_attr_info_st
block|{
name|unsigned
name|char
name|set
index|[
operator|(
name|STORE_ATTR_TYPE_NUM
operator|+
literal|8
operator|)
operator|/
literal|8
index|]
decl_stmt|;
union|union
block|{
name|char
modifier|*
name|cstring
decl_stmt|;
name|unsigned
name|char
modifier|*
name|sha1string
decl_stmt|;
name|X509_NAME
modifier|*
name|dn
decl_stmt|;
name|BIGNUM
modifier|*
name|number
decl_stmt|;
name|void
modifier|*
name|any
decl_stmt|;
block|}
name|values
index|[
name|STORE_ATTR_TYPE_NUM
operator|+
literal|1
index|]
union|;
name|size_t
name|value_sizes
index|[
name|STORE_ATTR_TYPE_NUM
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ATTR_IS_SET
parameter_list|(
name|a
parameter_list|,
name|i
parameter_list|)
value|((i)> 0&& (i)< STORE_ATTR_TYPE_NUM \&& ((a)->set[(i) / 8]& (1<< ((i) % 8))))
end_define

begin_define
define|#
directive|define
name|SET_ATTRBIT
parameter_list|(
name|a
parameter_list|,
name|i
parameter_list|)
value|((a)->set[(i) / 8] |= (1<< ((i) % 8)))
end_define

begin_define
define|#
directive|define
name|CLEAR_ATTRBIT
parameter_list|(
name|a
parameter_list|,
name|i
parameter_list|)
value|((a)->set[(i) / 8]&= ~(1<< ((i) % 8)))
end_define

begin_function
name|STORE_ATTR_INFO
modifier|*
name|STORE_ATTR_INFO_new
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|(
name|STORE_ATTR_INFO
operator|*
operator|)
name|OPENSSL_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|STORE_ATTR_INFO
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|STORE_ATTR_INFO_attr_free
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|)
block|{
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|code
condition|)
block|{
case|case
name|STORE_ATTR_FRIENDLYNAME
case|:
case|case
name|STORE_ATTR_EMAIL
case|:
case|case
name|STORE_ATTR_FILENAME
case|:
name|STORE_ATTR_INFO_modify_cstr
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_ATTR_KEYID
case|:
case|case
name|STORE_ATTR_ISSUERKEYID
case|:
case|case
name|STORE_ATTR_SUBJECTKEYID
case|:
case|case
name|STORE_ATTR_ISSUERSERIALHASH
case|:
case|case
name|STORE_ATTR_CERTHASH
case|:
name|STORE_ATTR_INFO_modify_sha1str
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_ATTR_ISSUER
case|:
case|case
name|STORE_ATTR_SUBJECT
case|:
name|STORE_ATTR_INFO_modify_dn
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_ATTR_SERIAL
case|:
name|STORE_ATTR_INFO_modify_number
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_free
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|)
block|{
if|if
condition|(
name|attrs
condition|)
block|{
name|STORE_ATTR_TYPES
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|++
operator|<
name|STORE_ATTR_TYPE_NUM
condition|;
control|)
name|STORE_ATTR_INFO_attr_free
argument_list|(
name|attrs
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|OPENSSL_free
argument_list|(
name|attrs
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|STORE_ATTR_INFO_get0_cstr
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_CSTR
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
return|return
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|cstring
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_CSTR
argument_list|,
name|STORE_R_NO_VALUE
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|unsigned
name|char
modifier|*
name|STORE_ATTR_INFO_get0_sha1str
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_SHA1STR
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
return|return
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|sha1string
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_SHA1STR
argument_list|,
name|STORE_R_NO_VALUE
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|X509_NAME
modifier|*
name|STORE_ATTR_INFO_get0_dn
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_DN
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
return|return
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|dn
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_DN
argument_list|,
name|STORE_R_NO_VALUE
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|BIGNUM
modifier|*
name|STORE_ATTR_INFO_get0_number
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_NUMBER
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
return|return
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|number
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_GET0_NUMBER
argument_list|,
name|STORE_R_NO_VALUE
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_set_cstr
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|char
modifier|*
name|cstr
parameter_list|,
name|size_t
name|cstr_size
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_CSTR
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|cstring
operator|=
name|BUF_strndup
argument_list|(
name|cstr
argument_list|,
name|cstr_size
argument_list|)
operator|)
condition|)
return|return
literal|1
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_CSTR
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_CSTR
argument_list|,
name|STORE_R_ALREADY_HAS_A_VALUE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_set_sha1str
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|unsigned
name|char
modifier|*
name|sha1str
parameter_list|,
name|size_t
name|sha1str_size
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_SHA1STR
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|sha1string
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|BUF_memdup
argument_list|(
name|sha1str
argument_list|,
name|sha1str_size
argument_list|)
operator|)
condition|)
return|return
literal|1
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_SHA1STR
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_SHA1STR
argument_list|,
name|STORE_R_ALREADY_HAS_A_VALUE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_set_dn
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|X509_NAME
modifier|*
name|dn
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_DN
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|dn
operator|=
name|X509_NAME_dup
argument_list|(
name|dn
argument_list|)
operator|)
condition|)
return|return
literal|1
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_DN
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_DN
argument_list|,
name|STORE_R_ALREADY_HAS_A_VALUE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_set_number
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|BIGNUM
modifier|*
name|number
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_NUMBER
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|number
operator|=
name|BN_dup
argument_list|(
name|number
argument_list|)
operator|)
condition|)
return|return
literal|1
return|;
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_NUMBER
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_SET_NUMBER
argument_list|,
name|STORE_R_ALREADY_HAS_A_VALUE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_modify_cstr
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|char
modifier|*
name|cstr
parameter_list|,
name|size_t
name|cstr_size
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_MODIFY_CSTR
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
name|OPENSSL_free
argument_list|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|cstring
argument_list|)
expr_stmt|;
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|cstring
operator|=
name|NULL
expr_stmt|;
name|CLEAR_ATTRBIT
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
expr_stmt|;
block|}
return|return
name|STORE_ATTR_INFO_set_cstr
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|cstr
argument_list|,
name|cstr_size
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_modify_sha1str
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|unsigned
name|char
modifier|*
name|sha1str
parameter_list|,
name|size_t
name|sha1str_size
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_MODIFY_SHA1STR
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
name|OPENSSL_free
argument_list|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|sha1string
argument_list|)
expr_stmt|;
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|sha1string
operator|=
name|NULL
expr_stmt|;
name|CLEAR_ATTRBIT
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
expr_stmt|;
block|}
return|return
name|STORE_ATTR_INFO_set_sha1str
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|sha1str
argument_list|,
name|sha1str_size
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_modify_dn
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|X509_NAME
modifier|*
name|dn
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_MODIFY_DN
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
name|OPENSSL_free
argument_list|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|dn
argument_list|)
expr_stmt|;
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|dn
operator|=
name|NULL
expr_stmt|;
name|CLEAR_ATTRBIT
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
expr_stmt|;
block|}
return|return
name|STORE_ATTR_INFO_set_dn
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|dn
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_modify_number
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|attrs
parameter_list|,
name|STORE_ATTR_TYPES
name|code
parameter_list|,
name|BIGNUM
modifier|*
name|number
parameter_list|)
block|{
if|if
condition|(
operator|!
name|attrs
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_ATTR_INFO_MODIFY_NUMBER
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
condition|)
block|{
name|OPENSSL_free
argument_list|(
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|number
argument_list|)
expr_stmt|;
name|attrs
operator|->
name|values
index|[
name|code
index|]
operator|.
name|number
operator|=
name|NULL
expr_stmt|;
name|CLEAR_ATTRBIT
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|)
expr_stmt|;
block|}
return|return
name|STORE_ATTR_INFO_set_number
argument_list|(
name|attrs
argument_list|,
name|code
argument_list|,
name|number
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|attr_list_ctx_st
block|{
name|OPENSSL_ITEM
modifier|*
name|attributes
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|void
modifier|*
name|STORE_parse_attrs_start
parameter_list|(
name|OPENSSL_ITEM
modifier|*
name|attributes
parameter_list|)
block|{
if|if
condition|(
name|attributes
condition|)
block|{
name|struct
name|attr_list_ctx_st
modifier|*
name|context
init|=
operator|(
expr|struct
name|attr_list_ctx_st
operator|*
operator|)
name|OPENSSL_malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|attr_list_ctx_st
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|context
condition|)
name|context
operator|->
name|attributes
operator|=
name|attributes
expr_stmt|;
else|else
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_START
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
return|return
name|context
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_START
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|STORE_ATTR_INFO
modifier|*
name|STORE_parse_attrs_next
parameter_list|(
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|struct
name|attr_list_ctx_st
modifier|*
name|context
init|=
operator|(
expr|struct
name|attr_list_ctx_st
operator|*
operator|)
name|handle
decl_stmt|;
if|if
condition|(
name|context
operator|&&
name|context
operator|->
name|attributes
condition|)
block|{
name|STORE_ATTR_INFO
modifier|*
name|attrs
init|=
name|NULL
decl_stmt|;
while|while
condition|(
name|context
operator|->
name|attributes
operator|&&
name|context
operator|->
name|attributes
operator|->
name|code
operator|!=
name|STORE_ATTR_OR
operator|&&
name|context
operator|->
name|attributes
operator|->
name|code
operator|!=
name|STORE_ATTR_END
condition|)
block|{
switch|switch
condition|(
name|context
operator|->
name|attributes
operator|->
name|code
condition|)
block|{
case|case
name|STORE_ATTR_FRIENDLYNAME
case|:
case|case
name|STORE_ATTR_EMAIL
case|:
case|case
name|STORE_ATTR_FILENAME
case|:
if|if
condition|(
operator|!
name|attrs
condition|)
name|attrs
operator|=
name|STORE_ATTR_INFO_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|attrs
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_NEXT
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
goto|goto
name|err
goto|;
block|}
name|STORE_ATTR_INFO_set_cstr
argument_list|(
name|attrs
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|code
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|value
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|value_size
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_ATTR_KEYID
case|:
case|case
name|STORE_ATTR_ISSUERKEYID
case|:
case|case
name|STORE_ATTR_SUBJECTKEYID
case|:
case|case
name|STORE_ATTR_ISSUERSERIALHASH
case|:
case|case
name|STORE_ATTR_CERTHASH
case|:
if|if
condition|(
operator|!
name|attrs
condition|)
name|attrs
operator|=
name|STORE_ATTR_INFO_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|attrs
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_NEXT
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
goto|goto
name|err
goto|;
block|}
name|STORE_ATTR_INFO_set_sha1str
argument_list|(
name|attrs
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|code
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|value
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|value_size
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_ATTR_ISSUER
case|:
case|case
name|STORE_ATTR_SUBJECT
case|:
if|if
condition|(
operator|!
name|attrs
condition|)
name|attrs
operator|=
name|STORE_ATTR_INFO_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|attrs
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_NEXT
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
goto|goto
name|err
goto|;
block|}
name|STORE_ATTR_INFO_modify_dn
argument_list|(
name|attrs
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|code
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|STORE_ATTR_SERIAL
case|:
if|if
condition|(
operator|!
name|attrs
condition|)
name|attrs
operator|=
name|STORE_ATTR_INFO_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|attrs
operator|==
name|NULL
condition|)
block|{
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_NEXT
argument_list|,
name|ERR_R_MALLOC_FAILURE
argument_list|)
expr_stmt|;
goto|goto
name|err
goto|;
block|}
name|STORE_ATTR_INFO_modify_number
argument_list|(
name|attrs
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|code
argument_list|,
name|context
operator|->
name|attributes
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
block|}
name|context
operator|->
name|attributes
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|context
operator|->
name|attributes
operator|->
name|code
operator|==
name|STORE_ATTR_OR
condition|)
name|context
operator|->
name|attributes
operator|++
expr_stmt|;
return|return
name|attrs
return|;
name|err
label|:
while|while
condition|(
name|context
operator|->
name|attributes
operator|&&
name|context
operator|->
name|attributes
operator|->
name|code
operator|!=
name|STORE_ATTR_OR
operator|&&
name|context
operator|->
name|attributes
operator|->
name|code
operator|!=
name|STORE_ATTR_END
condition|)
name|context
operator|->
name|attributes
operator|++
expr_stmt|;
if|if
condition|(
name|context
operator|->
name|attributes
operator|->
name|code
operator|==
name|STORE_ATTR_OR
condition|)
name|context
operator|->
name|attributes
operator|++
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_NEXT
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|int
name|STORE_parse_attrs_end
parameter_list|(
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|struct
name|attr_list_ctx_st
modifier|*
name|context
init|=
operator|(
expr|struct
name|attr_list_ctx_st
operator|*
operator|)
name|handle
decl_stmt|;
if|if
condition|(
name|context
operator|&&
name|context
operator|->
name|attributes
condition|)
block|{
if|#
directive|if
literal|0
block|OPENSSL_ITEM *attributes = context->attributes;
endif|#
directive|endif
name|OPENSSL_free
argument_list|(
name|context
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_END
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_parse_attrs_endp
parameter_list|(
name|void
modifier|*
name|handle
parameter_list|)
block|{
name|struct
name|attr_list_ctx_st
modifier|*
name|context
init|=
operator|(
expr|struct
name|attr_list_ctx_st
operator|*
operator|)
name|handle
decl_stmt|;
if|if
condition|(
name|context
operator|&&
name|context
operator|->
name|attributes
condition|)
block|{
return|return
name|context
operator|->
name|attributes
operator|->
name|code
operator|==
name|STORE_ATTR_END
return|;
block|}
name|STOREerr
argument_list|(
name|STORE_F_STORE_PARSE_ATTRS_ENDP
argument_list|,
name|ERR_R_PASSED_NULL_PARAMETER
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|attr_info_compare_compute_range
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|abits
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|bbits
parameter_list|,
name|unsigned
name|int
modifier|*
name|alowp
parameter_list|,
name|unsigned
name|int
modifier|*
name|ahighp
parameter_list|,
name|unsigned
name|int
modifier|*
name|blowp
parameter_list|,
name|unsigned
name|int
modifier|*
name|bhighp
parameter_list|)
block|{
name|unsigned
name|int
name|alow
init|=
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
decl_stmt|,
name|ahigh
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|blow
init|=
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
decl_stmt|,
name|bhigh
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|,
name|res
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|STORE_ATTR_TYPE_NUM
operator|+
literal|8
operator|)
operator|/
literal|8
condition|;
name|i
operator|++
operator|,
name|abits
operator|++
operator|,
name|bbits
operator|++
control|)
block|{
if|if
condition|(
name|res
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|*
name|abits
operator|<
operator|*
name|bbits
condition|)
name|res
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|*
name|abits
operator|>
operator|*
name|bbits
condition|)
name|res
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|abits
condition|)
block|{
if|if
condition|(
name|alow
operator|==
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
condition|)
block|{
name|alow
operator|=
name|i
operator|*
literal|8
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x01
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x02
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x04
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x08
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x10
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x20
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x40
operator|)
condition|)
name|alow
operator|++
expr_stmt|;
block|}
name|ahigh
operator|=
name|i
operator|*
literal|8
operator|+
literal|7
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x80
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x40
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x20
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x10
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x08
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x04
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|abits
operator|&
literal|0x02
operator|)
condition|)
name|ahigh
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|bbits
condition|)
block|{
if|if
condition|(
name|blow
operator|==
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
condition|)
block|{
name|blow
operator|=
name|i
operator|*
literal|8
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x01
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x02
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x04
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x08
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x10
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x20
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x40
operator|)
condition|)
name|blow
operator|++
expr_stmt|;
block|}
name|bhigh
operator|=
name|i
operator|*
literal|8
operator|+
literal|7
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x80
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x40
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x20
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x10
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x08
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x04
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|bbits
operator|&
literal|0x02
operator|)
condition|)
name|bhigh
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ahigh
operator|+
name|alow
operator|<
name|bhigh
operator|+
name|blow
condition|)
name|res
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|ahigh
operator|+
name|alow
operator|>
name|bhigh
operator|+
name|blow
condition|)
name|res
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|alowp
condition|)
operator|*
name|alowp
operator|=
name|alow
expr_stmt|;
if|if
condition|(
name|ahighp
condition|)
operator|*
name|ahighp
operator|=
name|ahigh
expr_stmt|;
if|if
condition|(
name|blowp
condition|)
operator|*
name|blowp
operator|=
name|blow
expr_stmt|;
if|if
condition|(
name|bhighp
condition|)
operator|*
name|bhighp
operator|=
name|bhigh
expr_stmt|;
return|return
name|res
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_compare
parameter_list|(
specifier|const
name|STORE_ATTR_INFO
modifier|*
specifier|const
modifier|*
name|a
parameter_list|,
specifier|const
name|STORE_ATTR_INFO
modifier|*
specifier|const
modifier|*
name|b
parameter_list|)
block|{
if|if
condition|(
name|a
operator|==
name|b
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|a
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|b
condition|)
return|return
literal|1
return|;
return|return
name|attr_info_compare_compute_range
argument_list|(
operator|(
operator|*
name|a
operator|)
operator|->
name|set
argument_list|,
operator|(
operator|*
name|b
operator|)
operator|->
name|set
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_in_range
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|a
parameter_list|,
name|STORE_ATTR_INFO
modifier|*
name|b
parameter_list|)
block|{
name|unsigned
name|int
name|alow
decl_stmt|,
name|ahigh
decl_stmt|,
name|blow
decl_stmt|,
name|bhigh
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|!
name|a
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|b
condition|)
return|return
literal|0
return|;
name|attr_info_compare_compute_range
argument_list|(
name|a
operator|->
name|set
argument_list|,
name|b
operator|->
name|set
argument_list|,
operator|&
name|alow
argument_list|,
operator|&
name|ahigh
argument_list|,
operator|&
name|blow
argument_list|,
operator|&
name|bhigh
argument_list|)
expr_stmt|;
if|if
condition|(
name|alow
operator|>=
name|blow
operator|&&
name|ahigh
operator|<=
name|bhigh
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_in
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|a
parameter_list|,
name|STORE_ATTR_INFO
modifier|*
name|b
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|abits
decl_stmt|,
modifier|*
name|bbits
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|!
name|a
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|b
condition|)
return|return
literal|0
return|;
name|abits
operator|=
name|a
operator|->
name|set
expr_stmt|;
name|bbits
operator|=
name|b
operator|->
name|set
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|STORE_ATTR_TYPE_NUM
operator|+
literal|8
operator|)
operator|/
literal|8
condition|;
name|i
operator|++
operator|,
name|abits
operator|++
operator|,
name|bbits
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|abits
operator|&&
operator|(
operator|*
name|bbits
operator|&
operator|*
name|abits
operator|)
operator|!=
operator|*
name|abits
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|STORE_ATTR_INFO_in_ex
parameter_list|(
name|STORE_ATTR_INFO
modifier|*
name|a
parameter_list|,
name|STORE_ATTR_INFO
modifier|*
name|b
parameter_list|)
block|{
name|STORE_ATTR_TYPES
name|i
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|!
name|STORE_ATTR_INFO_in
argument_list|(
name|a
argument_list|,
name|b
argument_list|)
condition|)
return|return
literal|0
return|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|STORE_ATTR_TYPE_NUM
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ATTR_IS_SET
argument_list|(
name|a
argument_list|,
name|i
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|i
condition|)
block|{
case|case
name|STORE_ATTR_FRIENDLYNAME
case|:
case|case
name|STORE_ATTR_EMAIL
case|:
case|case
name|STORE_ATTR_FILENAME
case|:
if|if
condition|(
name|strcmp
argument_list|(
name|a
operator|->
name|values
index|[
name|i
index|]
operator|.
name|cstring
argument_list|,
name|b
operator|->
name|values
index|[
name|i
index|]
operator|.
name|cstring
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|STORE_ATTR_KEYID
case|:
case|case
name|STORE_ATTR_ISSUERKEYID
case|:
case|case
name|STORE_ATTR_SUBJECTKEYID
case|:
case|case
name|STORE_ATTR_ISSUERSERIALHASH
case|:
case|case
name|STORE_ATTR_CERTHASH
case|:
if|if
condition|(
name|memcmp
argument_list|(
name|a
operator|->
name|values
index|[
name|i
index|]
operator|.
name|sha1string
argument_list|,
name|b
operator|->
name|values
index|[
name|i
index|]
operator|.
name|sha1string
argument_list|,
name|a
operator|->
name|value_sizes
index|[
name|i
index|]
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|STORE_ATTR_ISSUER
case|:
case|case
name|STORE_ATTR_SUBJECT
case|:
if|if
condition|(
name|X509_NAME_cmp
argument_list|(
name|a
operator|->
name|values
index|[
name|i
index|]
operator|.
name|dn
argument_list|,
name|b
operator|->
name|values
index|[
name|i
index|]
operator|.
name|dn
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|STORE_ATTR_SERIAL
case|:
if|if
condition|(
name|BN_cmp
argument_list|(
name|a
operator|->
name|values
index|[
name|i
index|]
operator|.
name|number
argument_list|,
name|b
operator|->
name|values
index|[
name|i
index|]
operator|.
name|number
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
default|default:
break|break;
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

end_unit

