begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* crypto/sha/sha256.c */
end_comment

begin_comment
comment|/* ====================================================================  * Copyright (c) 2004 The OpenSSL Project.  All rights reserved  * according to the OpenSSL license [found in ../../LICENSE].  * ====================================================================  */
end_comment

begin_include
include|#
directive|include
file|<openssl/opensslconf.h>
end_include

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_SHA
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_SHA256
argument_list|)
end_if

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<openssl/crypto.h>
end_include

begin_include
include|#
directive|include
file|<openssl/sha.h>
end_include

begin_include
include|#
directive|include
file|<openssl/opensslv.h>
end_include

begin_decl_stmt
specifier|const
name|char
name|SHA256_version
index|[]
init|=
literal|"SHA-256"
name|OPENSSL_VERSION_PTEXT
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|SHA224_Init
parameter_list|(
name|SHA256_CTX
modifier|*
name|c
parameter_list|)
block|{
name|c
operator|->
name|h
index|[
literal|0
index|]
operator|=
literal|0xc1059ed8UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|1
index|]
operator|=
literal|0x367cd507UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|2
index|]
operator|=
literal|0x3070dd17UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|3
index|]
operator|=
literal|0xf70e5939UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|4
index|]
operator|=
literal|0xffc00b31UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|5
index|]
operator|=
literal|0x68581511UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|6
index|]
operator|=
literal|0x64f98fa7UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|7
index|]
operator|=
literal|0xbefa4fa4UL
expr_stmt|;
name|c
operator|->
name|Nl
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|Nh
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|num
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|md_len
operator|=
name|SHA224_DIGEST_LENGTH
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|SHA256_Init
parameter_list|(
name|SHA256_CTX
modifier|*
name|c
parameter_list|)
block|{
name|c
operator|->
name|h
index|[
literal|0
index|]
operator|=
literal|0x6a09e667UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|1
index|]
operator|=
literal|0xbb67ae85UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|2
index|]
operator|=
literal|0x3c6ef372UL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|3
index|]
operator|=
literal|0xa54ff53aUL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|4
index|]
operator|=
literal|0x510e527fUL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|5
index|]
operator|=
literal|0x9b05688cUL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|6
index|]
operator|=
literal|0x1f83d9abUL
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|7
index|]
operator|=
literal|0x5be0cd19UL
expr_stmt|;
name|c
operator|->
name|Nl
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|Nh
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|num
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|md_len
operator|=
name|SHA256_DIGEST_LENGTH
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|unsigned
name|char
modifier|*
name|SHA224
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|d
parameter_list|,
name|size_t
name|n
parameter_list|,
name|unsigned
name|char
modifier|*
name|md
parameter_list|)
block|{
name|SHA256_CTX
name|c
decl_stmt|;
specifier|static
name|unsigned
name|char
name|m
index|[
name|SHA224_DIGEST_LENGTH
index|]
decl_stmt|;
if|if
condition|(
name|md
operator|==
name|NULL
condition|)
name|md
operator|=
name|m
expr_stmt|;
name|SHA224_Init
argument_list|(
operator|&
name|c
argument_list|)
expr_stmt|;
name|SHA256_Update
argument_list|(
operator|&
name|c
argument_list|,
name|d
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|SHA256_Final
argument_list|(
name|md
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
name|OPENSSL_cleanse
argument_list|(
operator|&
name|c
argument_list|,
sizeof|sizeof
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|md
operator|)
return|;
block|}
end_function

begin_function
name|unsigned
name|char
modifier|*
name|SHA256
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|d
parameter_list|,
name|size_t
name|n
parameter_list|,
name|unsigned
name|char
modifier|*
name|md
parameter_list|)
block|{
name|SHA256_CTX
name|c
decl_stmt|;
specifier|static
name|unsigned
name|char
name|m
index|[
name|SHA256_DIGEST_LENGTH
index|]
decl_stmt|;
if|if
condition|(
name|md
operator|==
name|NULL
condition|)
name|md
operator|=
name|m
expr_stmt|;
name|SHA256_Init
argument_list|(
operator|&
name|c
argument_list|)
expr_stmt|;
name|SHA256_Update
argument_list|(
operator|&
name|c
argument_list|,
name|d
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|SHA256_Final
argument_list|(
name|md
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
name|OPENSSL_cleanse
argument_list|(
operator|&
name|c
argument_list|,
sizeof|sizeof
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|md
operator|)
return|;
block|}
end_function

begin_function
name|int
name|SHA224_Update
parameter_list|(
name|SHA256_CTX
modifier|*
name|c
parameter_list|,
specifier|const
name|void
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
return|return
name|SHA256_Update
argument_list|(
name|c
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|SHA224_Final
parameter_list|(
name|unsigned
name|char
modifier|*
name|md
parameter_list|,
name|SHA256_CTX
modifier|*
name|c
parameter_list|)
block|{
return|return
name|SHA256_Final
argument_list|(
name|md
argument_list|,
name|c
argument_list|)
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|SHA_LONG_LOG2
end_ifndef

begin_define
define|#
directive|define
name|SHA_LONG_LOG2
value|2
end_define

begin_comment
comment|/* default to 32 bits */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|DATA_ORDER_IS_BIG_ENDIAN
end_define

begin_define
define|#
directive|define
name|HASH_LONG
value|SHA_LONG
end_define

begin_define
define|#
directive|define
name|HASH_LONG_LOG2
value|SHA_LONG_LOG2
end_define

begin_define
define|#
directive|define
name|HASH_CTX
value|SHA256_CTX
end_define

begin_define
define|#
directive|define
name|HASH_CBLOCK
value|SHA_CBLOCK
end_define

begin_define
define|#
directive|define
name|HASH_LBLOCK
value|SHA_LBLOCK
end_define

begin_comment
comment|/*  * Note that FIPS180-2 discusses "Truncation of the Hash Function Output."  * default: case below covers for it. It's not clear however if it's  * permitted to truncate to amount of bytes not divisible by 4. I bet not,  * but if it is, then default: case shall be extended. For reference.  * Idea behind separate cases for pre-defined lenghts is to let the  * compiler decide if it's appropriate to unroll small loops.  */
end_comment

begin_define
define|#
directive|define
name|HASH_MAKE_STRING
parameter_list|(
name|c
parameter_list|,
name|s
parameter_list|)
value|do {	\ 	unsigned long ll;		\ 	unsigned int  n;		\ 	switch ((c)->md_len)		\ 	{   case SHA224_DIGEST_LENGTH:	\ 		for (n=0;n<SHA224_DIGEST_LENGTH/4;n++)	\ 		{   ll=(c)->h[n]; HOST_l2c(ll,(s));   }	\ 		break;			\ 	    case SHA256_DIGEST_LENGTH:	\ 		for (n=0;n<SHA256_DIGEST_LENGTH/4;n++)	\ 		{   ll=(c)->h[n]; HOST_l2c(ll,(s));   }	\ 		break;			\ 	    default:			\ 		if ((c)->md_len> SHA256_DIGEST_LENGTH)	\ 		    return 0;				\ 		for (n=0;n<(c)->md_len/4;n++)		\ 		{   ll=(c)->h[n]; HOST_l2c(ll,(s));   }	\ 		break;			\ 	}				\ 	} while (0)
end_define

begin_define
define|#
directive|define
name|HASH_UPDATE
value|SHA256_Update
end_define

begin_define
define|#
directive|define
name|HASH_TRANSFORM
value|SHA256_Transform
end_define

begin_define
define|#
directive|define
name|HASH_FINAL
value|SHA256_Final
end_define

begin_define
define|#
directive|define
name|HASH_BLOCK_HOST_ORDER
value|sha256_block_host_order
end_define

begin_define
define|#
directive|define
name|HASH_BLOCK_DATA_ORDER
value|sha256_block_data_order
end_define

begin_function_decl
name|void
name|sha256_block_host_order
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|sha256_block_data_order
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_include
include|#
directive|include
file|"md32_common.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|SHA256_ASM
end_ifdef

begin_function_decl
name|void
name|sha256_block
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|,
name|int
name|host
parameter_list|)
function_decl|;
end_function_decl

begin_else
else|#
directive|else
end_else

begin_decl_stmt
specifier|static
specifier|const
name|SHA_LONG
name|K256
index|[
literal|64
index|]
init|=
block|{
literal|0x428a2f98UL
block|,
literal|0x71374491UL
block|,
literal|0xb5c0fbcfUL
block|,
literal|0xe9b5dba5UL
block|,
literal|0x3956c25bUL
block|,
literal|0x59f111f1UL
block|,
literal|0x923f82a4UL
block|,
literal|0xab1c5ed5UL
block|,
literal|0xd807aa98UL
block|,
literal|0x12835b01UL
block|,
literal|0x243185beUL
block|,
literal|0x550c7dc3UL
block|,
literal|0x72be5d74UL
block|,
literal|0x80deb1feUL
block|,
literal|0x9bdc06a7UL
block|,
literal|0xc19bf174UL
block|,
literal|0xe49b69c1UL
block|,
literal|0xefbe4786UL
block|,
literal|0x0fc19dc6UL
block|,
literal|0x240ca1ccUL
block|,
literal|0x2de92c6fUL
block|,
literal|0x4a7484aaUL
block|,
literal|0x5cb0a9dcUL
block|,
literal|0x76f988daUL
block|,
literal|0x983e5152UL
block|,
literal|0xa831c66dUL
block|,
literal|0xb00327c8UL
block|,
literal|0xbf597fc7UL
block|,
literal|0xc6e00bf3UL
block|,
literal|0xd5a79147UL
block|,
literal|0x06ca6351UL
block|,
literal|0x14292967UL
block|,
literal|0x27b70a85UL
block|,
literal|0x2e1b2138UL
block|,
literal|0x4d2c6dfcUL
block|,
literal|0x53380d13UL
block|,
literal|0x650a7354UL
block|,
literal|0x766a0abbUL
block|,
literal|0x81c2c92eUL
block|,
literal|0x92722c85UL
block|,
literal|0xa2bfe8a1UL
block|,
literal|0xa81a664bUL
block|,
literal|0xc24b8b70UL
block|,
literal|0xc76c51a3UL
block|,
literal|0xd192e819UL
block|,
literal|0xd6990624UL
block|,
literal|0xf40e3585UL
block|,
literal|0x106aa070UL
block|,
literal|0x19a4c116UL
block|,
literal|0x1e376c08UL
block|,
literal|0x2748774cUL
block|,
literal|0x34b0bcb5UL
block|,
literal|0x391c0cb3UL
block|,
literal|0x4ed8aa4aUL
block|,
literal|0x5b9cca4fUL
block|,
literal|0x682e6ff3UL
block|,
literal|0x748f82eeUL
block|,
literal|0x78a5636fUL
block|,
literal|0x84c87814UL
block|,
literal|0x8cc70208UL
block|,
literal|0x90befffaUL
block|,
literal|0xa4506cebUL
block|,
literal|0xbef9a3f7UL
block|,
literal|0xc67178f2UL
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * FIPS specification refers to right rotations, while our ROTATE macro  * is left one. This is why you might notice that rotation coefficients  * differ from those observed in FIPS document by 32-N...  */
end_comment

begin_define
define|#
directive|define
name|Sigma0
parameter_list|(
name|x
parameter_list|)
value|(ROTATE((x),30) ^ ROTATE((x),19) ^ ROTATE((x),10))
end_define

begin_define
define|#
directive|define
name|Sigma1
parameter_list|(
name|x
parameter_list|)
value|(ROTATE((x),26) ^ ROTATE((x),21) ^ ROTATE((x),7))
end_define

begin_define
define|#
directive|define
name|sigma0
parameter_list|(
name|x
parameter_list|)
value|(ROTATE((x),25) ^ ROTATE((x),14) ^ ((x)>>3))
end_define

begin_define
define|#
directive|define
name|sigma1
parameter_list|(
name|x
parameter_list|)
value|(ROTATE((x),15) ^ ROTATE((x),13) ^ ((x)>>10))
end_define

begin_define
define|#
directive|define
name|Ch
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|)
value|(((x)& (y)) ^ ((~(x))& (z)))
end_define

begin_define
define|#
directive|define
name|Maj
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|)
value|(((x)& (y)) ^ ((x)& (z)) ^ ((y)& (z)))
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|OPENSSL_SMALL_FOOTPRINT
end_ifdef

begin_function
specifier|static
name|void
name|sha256_block
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|,
name|int
name|host
parameter_list|)
block|{
name|unsigned
name|MD32_REG_T
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|f
decl_stmt|,
name|g
decl_stmt|,
name|h
decl_stmt|,
name|s0
decl_stmt|,
name|s1
decl_stmt|,
name|T1
decl_stmt|,
name|T2
decl_stmt|;
name|SHA_LONG
name|X
index|[
literal|16
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|data
init|=
name|in
decl_stmt|;
while|while
condition|(
name|num
operator|--
condition|)
block|{
name|a
operator|=
name|ctx
operator|->
name|h
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|=
name|ctx
operator|->
name|h
index|[
literal|1
index|]
expr_stmt|;
name|c
operator|=
name|ctx
operator|->
name|h
index|[
literal|2
index|]
expr_stmt|;
name|d
operator|=
name|ctx
operator|->
name|h
index|[
literal|3
index|]
expr_stmt|;
name|e
operator|=
name|ctx
operator|->
name|h
index|[
literal|4
index|]
expr_stmt|;
name|f
operator|=
name|ctx
operator|->
name|h
index|[
literal|5
index|]
expr_stmt|;
name|g
operator|=
name|ctx
operator|->
name|h
index|[
literal|6
index|]
expr_stmt|;
name|h
operator|=
name|ctx
operator|->
name|h
index|[
literal|7
index|]
expr_stmt|;
if|if
condition|(
name|host
condition|)
block|{
specifier|const
name|SHA_LONG
modifier|*
name|W
init|=
operator|(
specifier|const
name|SHA_LONG
operator|*
operator|)
name|data
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|T1
operator|=
name|X
index|[
name|i
index|]
operator|=
name|W
index|[
name|i
index|]
expr_stmt|;
name|T1
operator|+=
name|h
operator|+
name|Sigma1
argument_list|(
name|e
argument_list|)
operator|+
name|Ch
argument_list|(
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
operator|+
name|K256
index|[
name|i
index|]
expr_stmt|;
name|T2
operator|=
name|Sigma0
argument_list|(
name|a
argument_list|)
operator|+
name|Maj
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|h
operator|=
name|g
expr_stmt|;
name|g
operator|=
name|f
expr_stmt|;
name|f
operator|=
name|e
expr_stmt|;
name|e
operator|=
name|d
operator|+
name|T1
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|b
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|T1
operator|+
name|T2
expr_stmt|;
block|}
name|data
operator|+=
name|SHA256_CBLOCK
expr_stmt|;
block|}
else|else
block|{
name|SHA_LONG
name|l
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
name|i
index|]
operator|=
name|l
expr_stmt|;
name|T1
operator|+=
name|h
operator|+
name|Sigma1
argument_list|(
name|e
argument_list|)
operator|+
name|Ch
argument_list|(
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
operator|+
name|K256
index|[
name|i
index|]
expr_stmt|;
name|T2
operator|=
name|Sigma0
argument_list|(
name|a
argument_list|)
operator|+
name|Maj
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|h
operator|=
name|g
expr_stmt|;
name|g
operator|=
name|f
expr_stmt|;
name|f
operator|=
name|e
expr_stmt|;
name|e
operator|=
name|d
operator|+
name|T1
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|b
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|T1
operator|+
name|T2
expr_stmt|;
block|}
block|}
for|for
control|(
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
name|s0
operator|=
name|X
index|[
operator|(
name|i
operator|+
literal|1
operator|)
operator|&
literal|0x0f
index|]
expr_stmt|;
name|s0
operator|=
name|sigma0
argument_list|(
name|s0
argument_list|)
expr_stmt|;
name|s1
operator|=
name|X
index|[
operator|(
name|i
operator|+
literal|14
operator|)
operator|&
literal|0x0f
index|]
expr_stmt|;
name|s1
operator|=
name|sigma1
argument_list|(
name|s1
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
name|i
operator|&
literal|0xf
index|]
operator|+=
name|s0
operator|+
name|s1
operator|+
name|X
index|[
operator|(
name|i
operator|+
literal|9
operator|)
operator|&
literal|0xf
index|]
expr_stmt|;
name|T1
operator|+=
name|h
operator|+
name|Sigma1
argument_list|(
name|e
argument_list|)
operator|+
name|Ch
argument_list|(
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
operator|+
name|K256
index|[
name|i
index|]
expr_stmt|;
name|T2
operator|=
name|Sigma0
argument_list|(
name|a
argument_list|)
operator|+
name|Maj
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|h
operator|=
name|g
expr_stmt|;
name|g
operator|=
name|f
expr_stmt|;
name|f
operator|=
name|e
expr_stmt|;
name|e
operator|=
name|d
operator|+
name|T1
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|b
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|T1
operator|+
name|T2
expr_stmt|;
block|}
name|ctx
operator|->
name|h
index|[
literal|0
index|]
operator|+=
name|a
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|1
index|]
operator|+=
name|b
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|2
index|]
operator|+=
name|c
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|3
index|]
operator|+=
name|d
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|4
index|]
operator|+=
name|e
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|5
index|]
operator|+=
name|f
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|6
index|]
operator|+=
name|g
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|7
index|]
operator|+=
name|h
expr_stmt|;
block|}
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|ROUND_00_15
parameter_list|(
name|i
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|,
name|e
parameter_list|,
name|f
parameter_list|,
name|g
parameter_list|,
name|h
parameter_list|)
value|do {	\ 	T1 += h + Sigma1(e) + Ch(e,f,g) + K256[i];	\ 	h = Sigma0(a) + Maj(a,b,c);			\ 	d += T1;	h += T1;		} while (0)
end_define

begin_define
define|#
directive|define
name|ROUND_16_63
parameter_list|(
name|i
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|,
name|e
parameter_list|,
name|f
parameter_list|,
name|g
parameter_list|,
name|h
parameter_list|,
name|X
parameter_list|)
value|do {	\ 	s0 = X[(i+1)&0x0f];	s0 = sigma0(s0);	\ 	s1 = X[(i+14)&0x0f];	s1 = sigma1(s1);	\ 	T1 = X[(i)&0x0f] += s0 + s1 + X[(i+9)&0x0f];	\ 	ROUND_00_15(i,a,b,c,d,e,f,g,h);		} while (0)
end_define

begin_function
specifier|static
name|void
name|sha256_block
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|,
name|int
name|host
parameter_list|)
block|{
name|unsigned
name|MD32_REG_T
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|f
decl_stmt|,
name|g
decl_stmt|,
name|h
decl_stmt|,
name|s0
decl_stmt|,
name|s1
decl_stmt|,
name|T1
decl_stmt|;
name|SHA_LONG
name|X
index|[
literal|16
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|data
init|=
name|in
decl_stmt|;
while|while
condition|(
name|num
operator|--
condition|)
block|{
name|a
operator|=
name|ctx
operator|->
name|h
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|=
name|ctx
operator|->
name|h
index|[
literal|1
index|]
expr_stmt|;
name|c
operator|=
name|ctx
operator|->
name|h
index|[
literal|2
index|]
expr_stmt|;
name|d
operator|=
name|ctx
operator|->
name|h
index|[
literal|3
index|]
expr_stmt|;
name|e
operator|=
name|ctx
operator|->
name|h
index|[
literal|4
index|]
expr_stmt|;
name|f
operator|=
name|ctx
operator|->
name|h
index|[
literal|5
index|]
expr_stmt|;
name|g
operator|=
name|ctx
operator|->
name|h
index|[
literal|6
index|]
expr_stmt|;
name|h
operator|=
name|ctx
operator|->
name|h
index|[
literal|7
index|]
expr_stmt|;
if|if
condition|(
name|host
condition|)
block|{
specifier|const
name|SHA_LONG
modifier|*
name|W
init|=
operator|(
specifier|const
name|SHA_LONG
operator|*
operator|)
name|data
decl_stmt|;
name|T1
operator|=
name|X
index|[
literal|0
index|]
operator|=
name|W
index|[
literal|0
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|0
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|1
index|]
operator|=
name|W
index|[
literal|1
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|1
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|2
index|]
operator|=
name|W
index|[
literal|2
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|2
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|3
index|]
operator|=
name|W
index|[
literal|3
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|3
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|4
index|]
operator|=
name|W
index|[
literal|4
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|4
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|5
index|]
operator|=
name|W
index|[
literal|5
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|5
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|6
index|]
operator|=
name|W
index|[
literal|6
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|6
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|7
index|]
operator|=
name|W
index|[
literal|7
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|7
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|8
index|]
operator|=
name|W
index|[
literal|8
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|8
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|9
index|]
operator|=
name|W
index|[
literal|9
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|9
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|10
index|]
operator|=
name|W
index|[
literal|10
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|10
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|11
index|]
operator|=
name|W
index|[
literal|11
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|11
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|12
index|]
operator|=
name|W
index|[
literal|12
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|12
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|13
index|]
operator|=
name|W
index|[
literal|13
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|13
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|14
index|]
operator|=
name|W
index|[
literal|14
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|14
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|15
index|]
operator|=
name|W
index|[
literal|15
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|15
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|data
operator|+=
name|SHA256_CBLOCK
expr_stmt|;
block|}
else|else
block|{
name|SHA_LONG
name|l
decl_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|0
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|0
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|1
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|1
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|2
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|2
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|3
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|3
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|4
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|4
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|5
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|5
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|6
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|6
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|7
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|7
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|8
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|8
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|9
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|9
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|10
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|10
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|11
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|11
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|12
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|12
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|13
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|13
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|14
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|14
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|HOST_c2l
argument_list|(
name|data
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|15
index|]
operator|=
name|l
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|15
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|16
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|+=
literal|8
control|)
block|{
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|0
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|1
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|2
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|3
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|4
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|5
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|6
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_63
argument_list|(
name|i
operator|+
literal|7
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|X
argument_list|)
expr_stmt|;
block|}
name|ctx
operator|->
name|h
index|[
literal|0
index|]
operator|+=
name|a
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|1
index|]
operator|+=
name|b
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|2
index|]
operator|+=
name|c
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|3
index|]
operator|+=
name|d
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|4
index|]
operator|+=
name|e
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|5
index|]
operator|+=
name|f
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|6
index|]
operator|+=
name|g
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|7
index|]
operator|+=
name|h
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SHA256_ASM */
end_comment

begin_comment
comment|/*  * Idea is to trade couple of cycles for some space. On IA-32 we save  * about 4K in "big footprint" case. In "small footprint" case any gain  * is appreciated:-)  */
end_comment

begin_function
name|void
name|HASH_BLOCK_HOST_ORDER
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
block|{
name|sha256_block
argument_list|(
name|ctx
argument_list|,
name|in
argument_list|,
name|num
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|HASH_BLOCK_DATA_ORDER
parameter_list|(
name|SHA256_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
block|{
name|sha256_block
argument_list|(
name|ctx
argument_list|,
name|in
argument_list|,
name|num
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* OPENSSL_NO_SHA256 */
end_comment

end_unit

