begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* crypto/ec/ectest.c */
end_comment

begin_comment
comment|/*  * Originally written by Bodo Moeller for the OpenSSL project.  */
end_comment

begin_comment
comment|/* ====================================================================  * Copyright (c) 1998-2001 The OpenSSL Project.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.   *  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in  *    the documentation and/or other materials provided with the  *    distribution.  *  * 3. All advertising materials mentioning features or use of this  *    software must display the following acknowledgment:  *    "This product includes software developed by the OpenSSL Project  *    for use in the OpenSSL Toolkit. (http://www.openssl.org/)"  *  * 4. The names "OpenSSL Toolkit" and "OpenSSL Project" must not be used to  *    endorse or promote products derived from this software without  *    prior written permission. For written permission, please contact  *    openssl-core@openssl.org.  *  * 5. Products derived from this software may not be called "OpenSSL"  *    nor may "OpenSSL" appear in their names without prior written  *    permission of the OpenSSL Project.  *  * 6. Redistributions of any form whatsoever must retain the following  *    acknowledgment:  *    "This product includes software developed by the OpenSSL Project  *    for use in the OpenSSL Toolkit (http://www.openssl.org/)"  *  * THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS'' AND ANY  * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OpenSSL PROJECT OR  * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED  * OF THE POSSIBILITY OF SUCH DAMAGE.  * ====================================================================  *  * This product includes cryptographic software written by Eric Young  * (eay@cryptsoft.com).  This product includes software written by Tim  * Hudson (tjh@cryptsoft.com).  *  */
end_comment

begin_comment
comment|/* ====================================================================  * Copyright 2002 Sun Microsystems, Inc. ALL RIGHTS RESERVED.  *  * Portions of the attached software ("Contribution") are developed by   * SUN MICROSYSTEMS, INC., and are contributed to the OpenSSL project.  *  * The Contribution is licensed pursuant to the OpenSSL open source  * license provided above.  *  * The elliptic curve binary polynomial software is originally written by   * Sheueling Chang Shantz and Douglas Stebila of Sun Microsystems Laboratories.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|FLAT_INC
end_ifdef

begin_include
include|#
directive|include
file|"e_os.h"
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|"../e_os.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|OPENSSL_NO_EC
end_ifdef

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|puts
argument_list|(
literal|"Elliptic curves are disabled."
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<openssl/ec.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|OPENSSL_NO_ENGINE
end_ifndef

begin_include
include|#
directive|include
file|<openssl/engine.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<openssl/err.h>
end_include

begin_include
include|#
directive|include
file|<openssl/obj_mac.h>
end_include

begin_include
include|#
directive|include
file|<openssl/objects.h>
end_include

begin_include
include|#
directive|include
file|<openssl/rand.h>
end_include

begin_include
include|#
directive|include
file|<openssl/bn.h>
end_include

begin_include
include|#
directive|include
file|<openssl/opensslconf.h>
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|_MSC_VER
argument_list|)
operator|&&
name|defined
argument_list|(
name|_MIPS_
argument_list|)
operator|&&
operator|(
name|_MSC_VER
operator|/
literal|100
operator|==
literal|12
operator|)
end_if

begin_comment
comment|/* suppress "too big too optimize" warning */
end_comment

begin_pragma
pragma|#
directive|pragma
name|warning
name|(
name|disable
name|:
name|4959
name|)
end_pragma

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|ABORT
value|do { \ 	fflush(stdout); \ 	fprintf(stderr, "%s:%d: ABORT\n", __FILE__, __LINE__); \ 	ERR_print_errors_fp(stderr); \ 	EXIT(1); \ } while (0)
end_define

begin_define
define|#
directive|define
name|TIMING_BASE_PT
value|0
end_define

begin_define
define|#
directive|define
name|TIMING_RAND_PT
value|1
end_define

begin_define
define|#
directive|define
name|TIMING_SIMUL
value|2
end_define

begin_if
if|#
directive|if
literal|0
end_if

begin_ifdef
unit|static void timings(EC_GROUP *group, int type, BN_CTX *ctx) 	{ 	clock_t clck; 	int i, j; 	BIGNUM *s; 	BIGNUM *r[10], *r0[10]; 	EC_POINT *P; 		 	s = BN_new(); 	if (s == NULL) ABORT;  	fprintf(stdout, "Timings for %d-bit field, ", EC_GROUP_get_degree(group)); 	if (!EC_GROUP_get_order(group, s, ctx)) ABORT; 	fprintf(stdout, "%d-bit scalars ", (int)BN_num_bits(s)); 	fflush(stdout);  	P = EC_POINT_new(group); 	if (P == NULL) ABORT; 	EC_POINT_copy(P, EC_GROUP_get0_generator(group));  	for (i = 0; i< 10; i++) 		{ 		if ((r[i] = BN_new()) == NULL) ABORT; 		if (!BN_pseudo_rand(r[i], BN_num_bits(s), 0, 0)) ABORT; 		if (type != TIMING_BASE_PT) 			{ 			if ((r0[i] = BN_new()) == NULL) ABORT; 			if (!BN_pseudo_rand(r0[i], BN_num_bits(s), 0, 0)) ABORT; 			} 		}  	clck = clock(); 	for (i = 0; i< 10; i++) 		{ 		for (j = 0; j< 10; j++) 			{ 			if (!EC_POINT_mul(group, P, (type != TIMING_RAND_PT) ? r[i] : NULL,  				(type != TIMING_BASE_PT) ? P : NULL, (type != TIMING_BASE_PT) ? r0[i] : NULL, ctx)) ABORT; 			} 		} 	clck = clock() - clck;  	fprintf(stdout, "\n");
ifdef|#
directive|ifdef
name|CLOCKS_PER_SEC
end_ifdef

begin_comment
comment|/* "To determine the time in seconds, the value returned 	 * by the clock function should be divided by the value 	 * of the macro CLOCKS_PER_SEC." 	 *                                       -- ISO/IEC 9899 */
end_comment

begin_define
define|#
directive|define
name|UNIT
value|"s"
end_define

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* "`CLOCKS_PER_SEC' undeclared (first use this function)" 	 *                            -- cc on NeXTstep/OpenStep */
end_comment

begin_define
define|#
directive|define
name|UNIT
value|"units"
end_define

begin_define
define|#
directive|define
name|CLOCKS_PER_SEC
value|1
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
unit|if (type == TIMING_BASE_PT) { 		fprintf(stdout, "%i %s in %.2f " UNIT "\n", i*j, 			"base point multiplications", (double)clck/CLOCKS_PER_SEC); 	} else if (type == TIMING_RAND_PT) { 		fprintf(stdout, "%i %s in %.2f " UNIT "\n", i*j, 			"random point multiplications", (double)clck/CLOCKS_PER_SEC); 	} else if (type == TIMING_SIMUL) { 		fprintf(stdout, "%i %s in %.2f " UNIT "\n", i*j, 			"s*P+t*Q operations", (double)clck/CLOCKS_PER_SEC); 	} 	fprintf(stdout, "average: %.4f " UNIT "\n", (double)clck/(CLOCKS_PER_SEC*i*j));  	EC_POINT_free(P); 	BN_free(s); 	for (i = 0; i< 10; i++) 		{ 		BN_free(r[i]); 		if (type != TIMING_BASE_PT) BN_free(r0[i]); 		} 	}
endif|#
directive|endif
end_endif

begin_comment
comment|/* test multiplication with group order, long and negative scalars */
end_comment

begin_function
specifier|static
name|void
name|group_order_tests
parameter_list|(
name|EC_GROUP
modifier|*
name|group
parameter_list|)
block|{
name|BIGNUM
modifier|*
name|n1
decl_stmt|,
modifier|*
name|n2
decl_stmt|,
modifier|*
name|order
decl_stmt|;
name|EC_POINT
modifier|*
name|P
init|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
decl_stmt|;
name|EC_POINT
modifier|*
name|Q
init|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
decl_stmt|;
name|BN_CTX
modifier|*
name|ctx
init|=
name|BN_CTX_new
argument_list|()
decl_stmt|;
name|int
name|i
decl_stmt|;
name|n1
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|n2
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|order
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify group order ..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_get_order
argument_list|(
name|group
argument_list|,
name|order
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|order
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_precompute_mult
argument_list|(
name|group
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|order
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"long/negative scalar tests "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|2
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|BIGNUM
modifier|*
name|scalars
index|[
literal|6
index|]
decl_stmt|;
specifier|const
name|EC_POINT
modifier|*
name|points
index|[
literal|6
index|]
decl_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
name|i
operator|==
literal|1
condition|?
literal|"allowing precomputation ... "
else|:
literal|"without precomputation ... "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_set_word
argument_list|(
name|n1
argument_list|,
name|i
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* If i == 1, P will be the predefined generator for which 		 * EC_GROUP_precompute_mult has set up precomputation. */
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|n1
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_one
argument_list|(
name|n1
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* n1 = 1 - order */
if|if
condition|(
operator|!
name|BN_sub
argument_list|(
name|n1
argument_list|,
name|n1
argument_list|,
name|order
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|P
argument_list|,
name|n1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* n2 = 1 + order */
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|n2
argument_list|,
name|order
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|P
argument_list|,
name|n2
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* n2 = (1 - order) * (1 + order) = 1 - order^2 */
if|if
condition|(
operator|!
name|BN_mul
argument_list|(
name|n2
argument_list|,
name|n1
argument_list|,
name|n2
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|P
argument_list|,
name|n2
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* n2 = order^2 - 1 */
name|BN_set_negative
argument_list|(
name|n2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_mul
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|P
argument_list|,
name|n2
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Add P to verify the result. */
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|Q
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Exercise EC_POINTs_mul, including corner cases. */
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|n1
expr_stmt|;
name|points
index|[
literal|0
index|]
operator|=
name|Q
expr_stmt|;
comment|/* => infinity */
name|scalars
index|[
literal|1
index|]
operator|=
name|n2
expr_stmt|;
name|points
index|[
literal|1
index|]
operator|=
name|P
expr_stmt|;
comment|/* => -P */
name|scalars
index|[
literal|2
index|]
operator|=
name|n1
expr_stmt|;
name|points
index|[
literal|2
index|]
operator|=
name|Q
expr_stmt|;
comment|/* => infinity */
name|scalars
index|[
literal|3
index|]
operator|=
name|n2
expr_stmt|;
name|points
index|[
literal|3
index|]
operator|=
name|Q
expr_stmt|;
comment|/* => infinity */
name|scalars
index|[
literal|4
index|]
operator|=
name|n1
expr_stmt|;
name|points
index|[
literal|4
index|]
operator|=
name|P
expr_stmt|;
comment|/* => P */
name|scalars
index|[
literal|5
index|]
operator|=
name|n2
expr_stmt|;
name|points
index|[
literal|5
index|]
operator|=
name|Q
expr_stmt|;
comment|/* => infinity */
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|6
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ok\n"
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|n1
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|n2
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|order
argument_list|)
expr_stmt|;
name|BN_CTX_free
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|prime_field_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|BN_CTX
modifier|*
name|ctx
init|=
name|NULL
decl_stmt|;
name|BIGNUM
modifier|*
name|p
decl_stmt|,
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|EC_GROUP
modifier|*
name|group
decl_stmt|;
name|EC_GROUP
modifier|*
name|P_160
init|=
name|NULL
decl_stmt|,
modifier|*
name|P_192
init|=
name|NULL
decl_stmt|,
modifier|*
name|P_224
init|=
name|NULL
decl_stmt|,
modifier|*
name|P_256
init|=
name|NULL
decl_stmt|,
modifier|*
name|P_384
init|=
name|NULL
decl_stmt|,
modifier|*
name|P_521
init|=
name|NULL
decl_stmt|;
name|EC_POINT
modifier|*
name|P
decl_stmt|,
modifier|*
name|Q
decl_stmt|,
modifier|*
name|R
decl_stmt|;
name|BIGNUM
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|,
modifier|*
name|z
decl_stmt|;
name|unsigned
name|char
name|buf
index|[
literal|100
index|]
decl_stmt|;
name|size_t
name|i
decl_stmt|,
name|len
decl_stmt|;
name|int
name|k
decl_stmt|;
if|#
directive|if
literal|1
comment|/* optional */
name|ctx
operator|=
name|BN_CTX_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|ctx
condition|)
name|ABORT
expr_stmt|;
endif|#
directive|endif
name|p
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|a
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|b
operator|=
name|BN_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|p
operator|||
operator|!
name|a
operator|||
operator|!
name|b
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"17"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"1"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"1"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|group
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GFp_mont_method
argument_list|()
argument_list|)
expr_stmt|;
comment|/* applications should use EC_GROUP_new_curve_GFp 	                                             * so that the library gets to choose the EC_METHOD */
if|if
condition|(
operator|!
name|group
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
block|{
name|EC_GROUP
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|tmp
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|EC_GROUP_free
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|group
operator|=
name|tmp
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|EC_GROUP_get_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Curve defined by Weierstrass equation\n     y^2 = x^3 + a*x + b  (mod 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|")\n     a = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     b = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|P
operator|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|Q
operator|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|R
operator|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|P
operator|||
operator|!
name|Q
operator|||
operator|!
name|R
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_to_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|buf
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|x
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|y
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|z
operator|=
name|BN_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|x
operator|||
operator|!
name|y
operator|||
operator|!
name|z
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"D"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Point is not on curve: x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stderr
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|", y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stderr
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ABORT
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"A cyclic subgroup:\n"
argument_list|)
expr_stmt|;
name|k
operator|=
literal|100
expr_stmt|;
do|do
block|{
if|if
condition|(
name|k
operator|--
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"     point at infinity\n"
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|", y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|EC_POINT_copy
argument_list|(
name|R
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|#
directive|if
literal|0
comment|/* optional */
block|{ 			EC_POINT *points[3]; 		 			points[0] = R; 			points[1] = Q; 			points[2] = P; 			if (!EC_POINTs_make_affine(group, 2, points, ctx)) ABORT; 		}
endif|#
directive|endif
block|}
do|while
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
do|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|R
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|len
operator|=
name|EC_POINT_point2oct
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|POINT_CONVERSION_COMPRESSED
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Generator as octet string, compressed form:\n     "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02X"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|len
operator|=
name|EC_POINT_point2oct
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|POINT_CONVERSION_UNCOMPRESSED
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nGenerator as octet string, uncompressed form:\n     "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02X"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|len
operator|=
name|EC_POINT_point2oct
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|POINT_CONVERSION_HYBRID
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nGenerator as octet string, hybrid form:\n     "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02X"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_Jprojective_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|z
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nA representation of the inverse of that generator in\nJacobian projective coordinates:\n     X = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|", Y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|", Z = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|z
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_invert
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|R
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve secp160r1 (Certicom Research SEC 2 Version 1.0, section 2.4.2, 2000) 	 * -- not a NIST curve, but commonly used */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"4A96B5688EF573284664698968C38BB913CBFC82"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|y
argument_list|,
literal|"23a628553168947d59dcc912042351377ac5fb32"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"0100000000000000000001F4C8F927AED3CA752257"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nSEC2 curve secp160r1 -- Generator:\n     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* G_y value taken from the standard: */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"23a628553168947d59dcc912042351377ac5fb32"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|BN_cmp
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ..."
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|group
argument_list|)
operator|!=
literal|160
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|P_160
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
operator|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|P_160
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve P-192 (FIPS PUB 186-2, App. 6) */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nNIST curve P-192 -- Generator:\n     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* G_y value taken from the standard: */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"07192B95FFC8DA78631011ED6B24CDD573F977A11E794811"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|BN_cmp
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ..."
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|group
argument_list|)
operator|!=
literal|192
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|P_192
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
operator|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|P_192
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve P-224 (FIPS PUB 186-2, App. 6) */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
literal|0
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nNIST curve P-224 -- Generator:\n     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* G_y value taken from the standard: */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|BN_cmp
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ..."
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|group
argument_list|)
operator|!=
literal|224
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|P_224
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
operator|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|P_224
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve P-256 (FIPS PUB 186-2, App. 6) */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E"
literal|"84F3B9CAC2FC632551"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nNIST curve P-256 -- Generator:\n     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* G_y value taken from the standard: */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|BN_cmp
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ..."
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|group
argument_list|)
operator|!=
literal|256
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|P_256
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
operator|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|P_256
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve P-384 (FIPS PUB 186-2, App. 6) */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141"
literal|"120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B"
literal|"9859F741E082542A385502F25DBF55296C3A545E3872760AB7"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nNIST curve P-384 -- Generator:\n     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* G_y value taken from the standard: */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"3617DE4A96262C6F5D9E98BF9292DC29F8F41DBD289A14"
literal|"7CE9DA3113B5F0B8C00A60B1CE1D7E819D7A431D7C90EA0E5F"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|BN_cmp
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ..."
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|group
argument_list|)
operator|!=
literal|384
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|P_384
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
operator|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|P_384
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve P-521 (FIPS PUB 186-2, App. 6) */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFF"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFC"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B"
literal|"315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573"
literal|"DF883D2C34F1EF451FD46B503F00"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"C6858E06B70404E9CD9E3ECB662395B4429C648139053F"
literal|"B521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B"
literal|"3C1856A429BF97E7E31C2E5BD66"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
literal|0
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
literal|"FFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5"
literal|"C9B8899C47AEBB6FB71E91386409"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GFp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nNIST curve P-521 -- Generator:\n     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* G_y value taken from the standard: */
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|z
argument_list|,
literal|"11839296A789A3BC0045C8A5FB42C7D1BD998F54449579"
literal|"B446817AFBD17273E662C97EE72995EF42640C550B9013FAD0761353C"
literal|"7086A272C24088BE94769FD16650"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|BN_cmp
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ..."
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|group
argument_list|)
operator|!=
literal|521
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|P_521
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
operator|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|P_521
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* more tests using the last curve */
if|if
condition|(
operator|!
name|EC_POINT_copy
argument_list|(
name|Q
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_dbl
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_invert
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* P = -2Q */
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|R
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|R
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* R = P + 2Q */
block|{
specifier|const
name|EC_POINT
modifier|*
name|points
index|[
literal|4
index|]
decl_stmt|;
specifier|const
name|BIGNUM
modifier|*
name|scalars
index|[
literal|4
index|]
decl_stmt|;
name|BIGNUM
name|scalar3
decl_stmt|;
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|points
index|[
literal|0
index|]
operator|=
name|Q
expr_stmt|;
name|points
index|[
literal|1
index|]
operator|=
name|Q
expr_stmt|;
name|points
index|[
literal|2
index|]
operator|=
name|Q
expr_stmt|;
name|points
index|[
literal|3
index|]
operator|=
name|Q
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_get_order
argument_list|(
name|group
argument_list|,
name|z
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|y
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
name|BN_is_odd
argument_list|(
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_rshift1
argument_list|(
name|y
argument_list|,
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|y
expr_stmt|;
comment|/* (group order + 1)/2,  so  y*Q + y*Q = Q */
name|scalars
index|[
literal|1
index|]
operator|=
name|y
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"combined multiplication ..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
comment|/* z is still the group order */
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|z
argument_list|,
literal|2
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|R
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_pseudo_rand
argument_list|(
name|y
argument_list|,
name|BN_num_bits
argument_list|(
name|y
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|z
argument_list|,
name|z
argument_list|,
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|BN_set_negative
argument_list|(
name|z
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|y
expr_stmt|;
name|scalars
index|[
literal|1
index|]
operator|=
name|z
expr_stmt|;
comment|/* z = -(order + y) */
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_pseudo_rand
argument_list|(
name|x
argument_list|,
name|BN_num_bits
argument_list|(
name|y
argument_list|)
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|z
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|BN_set_negative
argument_list|(
name|z
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|x
expr_stmt|;
name|scalars
index|[
literal|1
index|]
operator|=
name|y
expr_stmt|;
name|scalars
index|[
literal|2
index|]
operator|=
name|z
expr_stmt|;
comment|/* z = -(x+y) */
name|BN_init
argument_list|(
operator|&
name|scalar3
argument_list|)
expr_stmt|;
name|BN_zero
argument_list|(
operator|&
name|scalar3
argument_list|)
expr_stmt|;
name|scalars
index|[
literal|3
index|]
operator|=
operator|&
name|scalar3
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|4
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n\n"
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
operator|&
name|scalar3
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
literal|0
block|timings(P_160, TIMING_BASE_PT, ctx); 	timings(P_160, TIMING_RAND_PT, ctx); 	timings(P_160, TIMING_SIMUL, ctx); 	timings(P_192, TIMING_BASE_PT, ctx); 	timings(P_192, TIMING_RAND_PT, ctx); 	timings(P_192, TIMING_SIMUL, ctx); 	timings(P_224, TIMING_BASE_PT, ctx); 	timings(P_224, TIMING_RAND_PT, ctx); 	timings(P_224, TIMING_SIMUL, ctx); 	timings(P_256, TIMING_BASE_PT, ctx); 	timings(P_256, TIMING_RAND_PT, ctx); 	timings(P_256, TIMING_SIMUL, ctx); 	timings(P_384, TIMING_BASE_PT, ctx); 	timings(P_384, TIMING_RAND_PT, ctx); 	timings(P_384, TIMING_SIMUL, ctx); 	timings(P_521, TIMING_BASE_PT, ctx); 	timings(P_521, TIMING_RAND_PT, ctx); 	timings(P_521, TIMING_SIMUL, ctx);
endif|#
directive|endif
if|if
condition|(
name|ctx
condition|)
name|BN_CTX_free
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|EC_GROUP_free
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|R
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|P_160
condition|)
name|EC_GROUP_free
argument_list|(
name|P_160
argument_list|)
expr_stmt|;
if|if
condition|(
name|P_192
condition|)
name|EC_GROUP_free
argument_list|(
name|P_192
argument_list|)
expr_stmt|;
if|if
condition|(
name|P_224
condition|)
name|EC_GROUP_free
argument_list|(
name|P_224
argument_list|)
expr_stmt|;
if|if
condition|(
name|P_256
condition|)
name|EC_GROUP_free
argument_list|(
name|P_256
argument_list|)
expr_stmt|;
if|if
condition|(
name|P_384
condition|)
name|EC_GROUP_free
argument_list|(
name|P_384
argument_list|)
expr_stmt|;
if|if
condition|(
name|P_521
condition|)
name|EC_GROUP_free
argument_list|(
name|P_521
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Change test based on whether binary point compression is enabled or not. */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|OPENSSL_EC_BIN_PT_COMP
end_ifdef

begin_define
define|#
directive|define
name|CHAR2_CURVE_TEST_INTERNAL
parameter_list|(
name|_name
parameter_list|,
name|_p
parameter_list|,
name|_a
parameter_list|,
name|_b
parameter_list|,
name|_x
parameter_list|,
name|_y
parameter_list|,
name|_y_bit
parameter_list|,
name|_order
parameter_list|,
name|_cof
parameter_list|,
name|_degree
parameter_list|,
name|_variable
parameter_list|)
define|\
value|if (!BN_hex2bn(&x, _x)) ABORT; \ 	if (!EC_POINT_set_compressed_coordinates_GF2m(group, P, x, _y_bit, ctx)) ABORT; \ 	if (!EC_POINT_is_on_curve(group, P, ctx)) ABORT; \ 	if (!BN_hex2bn(&z, _order)) ABORT; \ 	if (!BN_hex2bn(&cof, _cof)) ABORT; \ 	if (!EC_GROUP_set_generator(group, P, z, cof)) ABORT; \ 	if (!EC_POINT_get_affine_coordinates_GF2m(group, P, x, y, ctx)) ABORT; \ 	fprintf(stdout, "\n%s -- Generator:\n     x = 0x", _name); \ 	BN_print_fp(stdout, x); \ 	fprintf(stdout, "\n     y = 0x"); \ 	BN_print_fp(stdout, y); \ 	fprintf(stdout, "\n"); \
comment|/* G_y value taken from the standard: */
value|\ 	if (!BN_hex2bn(&z, _y)) ABORT; \ 	if (0 != BN_cmp(y, z)) ABORT;
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|CHAR2_CURVE_TEST_INTERNAL
parameter_list|(
name|_name
parameter_list|,
name|_p
parameter_list|,
name|_a
parameter_list|,
name|_b
parameter_list|,
name|_x
parameter_list|,
name|_y
parameter_list|,
name|_y_bit
parameter_list|,
name|_order
parameter_list|,
name|_cof
parameter_list|,
name|_degree
parameter_list|,
name|_variable
parameter_list|)
define|\
value|if (!BN_hex2bn(&x, _x)) ABORT; \ 	if (!BN_hex2bn(&y, _y)) ABORT; \ 	if (!EC_POINT_set_affine_coordinates_GF2m(group, P, x, y, ctx)) ABORT; \ 	if (!EC_POINT_is_on_curve(group, P, ctx)) ABORT; \ 	if (!BN_hex2bn(&z, _order)) ABORT; \ 	if (!BN_hex2bn(&cof, _cof)) ABORT; \ 	if (!EC_GROUP_set_generator(group, P, z, cof)) ABORT; \ 	fprintf(stdout, "\n%s -- Generator:\n     x = 0x", _name); \ 	BN_print_fp(stdout, x); \ 	fprintf(stdout, "\n     y = 0x"); \ 	BN_print_fp(stdout, y); \ 	fprintf(stdout, "\n");
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|CHAR2_CURVE_TEST
parameter_list|(
name|_name
parameter_list|,
name|_p
parameter_list|,
name|_a
parameter_list|,
name|_b
parameter_list|,
name|_x
parameter_list|,
name|_y
parameter_list|,
name|_y_bit
parameter_list|,
name|_order
parameter_list|,
name|_cof
parameter_list|,
name|_degree
parameter_list|,
name|_variable
parameter_list|)
define|\
value|if (!BN_hex2bn(&p, _p)) ABORT; \ 	if (!BN_hex2bn(&a, _a)) ABORT; \ 	if (!BN_hex2bn(&b, _b)) ABORT; \ 	if (!EC_GROUP_set_curve_GF2m(group, p, a, b, ctx)) ABORT; \ 	CHAR2_CURVE_TEST_INTERNAL(_name, _p, _a, _b, _x, _y, _y_bit, _order, _cof, _degree, _variable) \ 	fprintf(stdout, "verify degree ..."); \ 	if (EC_GROUP_get_degree(group) != _degree) ABORT; \ 	fprintf(stdout, " ok\n"); \ 	group_order_tests(group); \ 	if (!(_variable = EC_GROUP_new(EC_GROUP_method_of(group)))) ABORT; \ 	if (!EC_GROUP_copy(_variable, group)) ABORT; \  #ifndef OPENSSL_NO_EC2M
end_define

begin_function
specifier|static
name|void
name|char2_field_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|BN_CTX
modifier|*
name|ctx
init|=
name|NULL
decl_stmt|;
name|BIGNUM
modifier|*
name|p
decl_stmt|,
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|EC_GROUP
modifier|*
name|group
decl_stmt|;
name|EC_GROUP
modifier|*
name|C2_K163
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_K233
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_K283
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_K409
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_K571
init|=
name|NULL
decl_stmt|;
name|EC_GROUP
modifier|*
name|C2_B163
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_B233
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_B283
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_B409
init|=
name|NULL
decl_stmt|,
modifier|*
name|C2_B571
init|=
name|NULL
decl_stmt|;
name|EC_POINT
modifier|*
name|P
decl_stmt|,
modifier|*
name|Q
decl_stmt|,
modifier|*
name|R
decl_stmt|;
name|BIGNUM
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|,
modifier|*
name|z
decl_stmt|,
modifier|*
name|cof
decl_stmt|;
name|unsigned
name|char
name|buf
index|[
literal|100
index|]
decl_stmt|;
name|size_t
name|i
decl_stmt|,
name|len
decl_stmt|;
name|int
name|k
decl_stmt|;
if|#
directive|if
literal|1
comment|/* optional */
name|ctx
operator|=
name|BN_CTX_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|ctx
condition|)
name|ABORT
expr_stmt|;
endif|#
directive|endif
name|p
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|a
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|b
operator|=
name|BN_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|p
operator|||
operator|!
name|a
operator|||
operator|!
name|b
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
literal|"13"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
literal|"3"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
literal|"1"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|group
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GF2m_simple_method
argument_list|()
argument_list|)
expr_stmt|;
comment|/* applications should use EC_GROUP_new_curve_GF2m 	                                                * so that the library gets to choose the EC_METHOD */
if|if
condition|(
operator|!
name|group
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GF2m
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
block|{
name|EC_GROUP
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|EC_GROUP_new
argument_list|(
name|EC_GROUP_method_of
argument_list|(
name|group
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_copy
argument_list|(
name|tmp
argument_list|,
name|group
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|EC_GROUP_free
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|group
operator|=
name|tmp
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|EC_GROUP_get_curve_GF2m
argument_list|(
name|group
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Curve defined by Weierstrass equation\n     y^2 + x*y = x^3 + a*x^2 + b  (mod 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|")\n     a = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n     b = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n(0x... means binary polynomial)\n"
argument_list|)
expr_stmt|;
name|P
operator|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|Q
operator|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|R
operator|=
name|EC_POINT_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|P
operator|||
operator|!
name|Q
operator|||
operator|!
name|R
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_to_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|buf
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|x
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|y
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|z
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|cof
operator|=
name|BN_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|x
operator|||
operator|!
name|y
operator|||
operator|!
name|z
operator|||
operator|!
name|cof
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
literal|"6"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Change test based on whether binary point compression is enabled or not. */
ifdef|#
directive|ifdef
name|OPENSSL_EC_BIN_PT_COMP
if|if
condition|(
operator|!
name|EC_POINT_set_compressed_coordinates_GF2m
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
else|#
directive|else
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|y
argument_list|,
literal|"8"
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_affine_coordinates_GF2m
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
block|{
comment|/* Change test based on whether binary point compression is enabled or not. */
ifdef|#
directive|ifdef
name|OPENSSL_EC_BIN_PT_COMP
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GF2m
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
endif|#
directive|endif
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Point is not on curve: x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stderr
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|", y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stderr
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ABORT
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"A cyclic subgroup:\n"
argument_list|)
expr_stmt|;
name|k
operator|=
literal|100
expr_stmt|;
do|do
block|{
if|if
condition|(
name|k
operator|--
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"     point at infinity\n"
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|!
name|EC_POINT_get_affine_coordinates_GF2m
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"     x = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|", y = 0x"
argument_list|)
expr_stmt|;
name|BN_print_fp
argument_list|(
name|stdout
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|EC_POINT_copy
argument_list|(
name|R
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
block|}
do|while
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
do|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|R
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Change test based on whether binary point compression is enabled or not. */
ifdef|#
directive|ifdef
name|OPENSSL_EC_BIN_PT_COMP
name|len
operator|=
name|EC_POINT_point2oct
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|POINT_CONVERSION_COMPRESSED
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Generator as octet string, compressed form:\n     "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02X"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|len
operator|=
name|EC_POINT_point2oct
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|POINT_CONVERSION_UNCOMPRESSED
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nGenerator as octet string, uncompressed form:\n     "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02X"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* Change test based on whether binary point compression is enabled or not. */
ifdef|#
directive|ifdef
name|OPENSSL_EC_BIN_PT_COMP
name|len
operator|=
name|EC_POINT_point2oct
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|POINT_CONVERSION_HYBRID
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_oct2point
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nGenerator as octet string, hybrid form:\n     "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02X"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_invert
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|R
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* Curve K-163 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve K-163"
argument_list|,
literal|"0800000000000000000000000000000000000000C9"
argument_list|,
literal|"1"
argument_list|,
literal|"1"
argument_list|,
literal|"02FE13C0537BBC11ACAA07D793DE4E6D5E5C94EEE8"
argument_list|,
literal|"0289070FB05D38FF58321F2E800536D538CCDAA3D9"
argument_list|,
literal|1
argument_list|,
literal|"04000000000000000000020108A2E0CC0D99F8A5EF"
argument_list|,
literal|"2"
argument_list|,
literal|163
argument_list|,
name|C2_K163
argument_list|)
expr_stmt|;
comment|/* Curve B-163 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve B-163"
argument_list|,
literal|"0800000000000000000000000000000000000000C9"
argument_list|,
literal|"1"
argument_list|,
literal|"020A601907B8C953CA1481EB10512F78744A3205FD"
argument_list|,
literal|"03F0EBA16286A2D57EA0991168D4994637E8343E36"
argument_list|,
literal|"00D51FBC6C71A0094FA2CDD545B11C5C0C797324F1"
argument_list|,
literal|1
argument_list|,
literal|"040000000000000000000292FE77E70C12A4234C33"
argument_list|,
literal|"2"
argument_list|,
literal|163
argument_list|,
name|C2_B163
argument_list|)
expr_stmt|;
comment|/* Curve K-233 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve K-233"
argument_list|,
literal|"020000000000000000000000000000000000000004000000000000000001"
argument_list|,
literal|"0"
argument_list|,
literal|"1"
argument_list|,
literal|"017232BA853A7E731AF129F22FF4149563A419C26BF50A4C9D6EEFAD6126"
argument_list|,
literal|"01DB537DECE819B7F70F555A67C427A8CD9BF18AEB9B56E0C11056FAE6A3"
argument_list|,
literal|0
argument_list|,
literal|"008000000000000000000000000000069D5BB915BCD46EFB1AD5F173ABDF"
argument_list|,
literal|"4"
argument_list|,
literal|233
argument_list|,
name|C2_K233
argument_list|)
expr_stmt|;
comment|/* Curve B-233 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve B-233"
argument_list|,
literal|"020000000000000000000000000000000000000004000000000000000001"
argument_list|,
literal|"000000000000000000000000000000000000000000000000000000000001"
argument_list|,
literal|"0066647EDE6C332C7F8C0923BB58213B333B20E9CE4281FE115F7D8F90AD"
argument_list|,
literal|"00FAC9DFCBAC8313BB2139F1BB755FEF65BC391F8B36F8F8EB7371FD558B"
argument_list|,
literal|"01006A08A41903350678E58528BEBF8A0BEFF867A7CA36716F7E01F81052"
argument_list|,
literal|1
argument_list|,
literal|"01000000000000000000000000000013E974E72F8A6922031D2603CFE0D7"
argument_list|,
literal|"2"
argument_list|,
literal|233
argument_list|,
name|C2_B233
argument_list|)
expr_stmt|;
comment|/* Curve K-283 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve K-283"
argument_list|,
literal|"0800000000000000000000000000000000000000000000000000000000000000000010A1"
argument_list|,
literal|"0"
argument_list|,
literal|"1"
argument_list|,
literal|"0503213F78CA44883F1A3B8162F188E553CD265F23C1567A16876913B0C2AC2458492836"
argument_list|,
literal|"01CCDA380F1C9E318D90F95D07E5426FE87E45C0E8184698E45962364E34116177DD2259"
argument_list|,
literal|0
argument_list|,
literal|"01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE9AE2ED07577265DFF7F94451E061E163C61"
argument_list|,
literal|"4"
argument_list|,
literal|283
argument_list|,
name|C2_K283
argument_list|)
expr_stmt|;
comment|/* Curve B-283 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve B-283"
argument_list|,
literal|"0800000000000000000000000000000000000000000000000000000000000000000010A1"
argument_list|,
literal|"000000000000000000000000000000000000000000000000000000000000000000000001"
argument_list|,
literal|"027B680AC8B8596DA5A4AF8A19A0303FCA97FD7645309FA2A581485AF6263E313B79A2F5"
argument_list|,
literal|"05F939258DB7DD90E1934F8C70B0DFEC2EED25B8557EAC9C80E2E198F8CDBECD86B12053"
argument_list|,
literal|"03676854FE24141CB98FE6D4B20D02B4516FF702350EDDB0826779C813F0DF45BE8112F4"
argument_list|,
literal|1
argument_list|,
literal|"03FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEF90399660FC938A90165B042A7CEFADB307"
argument_list|,
literal|"2"
argument_list|,
literal|283
argument_list|,
name|C2_B283
argument_list|)
expr_stmt|;
comment|/* Curve K-409 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve K-409"
argument_list|,
literal|"02000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000001"
argument_list|,
literal|"0"
argument_list|,
literal|"1"
argument_list|,
literal|"0060F05F658F49C1AD3AB1890F7184210EFD0987E307C84C27ACCFB8F9F67CC2C460189EB5AAAA62EE222EB1B35540CFE9023746"
argument_list|,
literal|"01E369050B7C4E42ACBA1DACBF04299C3460782F918EA427E6325165E9EA10E3DA5F6C42E9C55215AA9CA27A5863EC48D8E0286B"
argument_list|,
literal|1
argument_list|,
literal|"007FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE5F83B2D4EA20400EC4557D5ED3E3E7CA5B4B5C83B8E01E5FCF"
argument_list|,
literal|"4"
argument_list|,
literal|409
argument_list|,
name|C2_K409
argument_list|)
expr_stmt|;
comment|/* Curve B-409 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve B-409"
argument_list|,
literal|"02000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000001"
argument_list|,
literal|"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"
argument_list|,
literal|"0021A5C2C8EE9FEB5C4B9A753B7B476B7FD6422EF1F3DD674761FA99D6AC27C8A9A197B272822F6CD57A55AA4F50AE317B13545F"
argument_list|,
literal|"015D4860D088DDB3496B0C6064756260441CDE4AF1771D4DB01FFE5B34E59703DC255A868A1180515603AEAB60794E54BB7996A7"
argument_list|,
literal|"0061B1CFAB6BE5F32BBFA78324ED106A7636B9C5A7BD198D0158AA4F5488D08F38514F1FDF4B4F40D2181B3681C364BA0273C706"
argument_list|,
literal|1
argument_list|,
literal|"010000000000000000000000000000000000000000000000000001E2AAD6A612F33307BE5FA47C3C9E052F838164CD37D9A21173"
argument_list|,
literal|"2"
argument_list|,
literal|409
argument_list|,
name|C2_B409
argument_list|)
expr_stmt|;
comment|/* Curve K-571 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve K-571"
argument_list|,
literal|"80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000425"
argument_list|,
literal|"0"
argument_list|,
literal|"1"
argument_list|,
literal|"026EB7A859923FBC82189631F8103FE4AC9CA2970012D5D46024804801841CA44370958493B205E647DA304DB4CEB08CBBD1BA39494776FB988B47174DCA88C7E2945283A01C8972"
argument_list|,
literal|"0349DC807F4FBF374F4AEADE3BCA95314DD58CEC9F307A54FFC61EFC006D8A2C9D4979C0AC44AEA74FBEBBB9F772AEDCB620B01A7BA7AF1B320430C8591984F601CD4C143EF1C7A3"
argument_list|,
literal|0
argument_list|,
literal|"020000000000000000000000000000000000000000000000000000000000000000000000131850E1F19A63E4B391A8DB917F4138B630D84BE5D639381E91DEB45CFE778F637C1001"
argument_list|,
literal|"4"
argument_list|,
literal|571
argument_list|,
name|C2_K571
argument_list|)
expr_stmt|;
comment|/* Curve B-571 (FIPS PUB 186-2, App. 6) */
name|CHAR2_CURVE_TEST
argument_list|(
literal|"NIST curve B-571"
argument_list|,
literal|"80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000425"
argument_list|,
literal|"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"
argument_list|,
literal|"02F40E7E2221F295DE297117B7F3D62F5C6A97FFCB8CEFF1CD6BA8CE4A9A18AD84FFABBD8EFA59332BE7AD6756A66E294AFD185A78FF12AA520E4DE739BACA0C7FFEFF7F2955727A"
argument_list|,
literal|"0303001D34B856296C16C0D40D3CD7750A93D1D2955FA80AA5F40FC8DB7B2ABDBDE53950F4C0D293CDD711A35B67FB1499AE60038614F1394ABFA3B4C850D927E1E7769C8EEC2D19"
argument_list|,
literal|"037BF27342DA639B6DCCFFFEB73D69D78C6C27A6009CBBCA1980F8533921E8A684423E43BAB08A576291AF8F461BB2A8B3531D2F0485C19B16E2F1516E23DD3C1A4827AF1B8AC15B"
argument_list|,
literal|1
argument_list|,
literal|"03FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE661CE18FF55987308059B186823851EC7DD9CA1161DE93D5174D66E8382E9BB2FE84E47"
argument_list|,
literal|"2"
argument_list|,
literal|571
argument_list|,
name|C2_B571
argument_list|)
expr_stmt|;
comment|/* more tests using the last curve */
if|if
condition|(
operator|!
name|EC_POINT_copy
argument_list|(
name|Q
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_dbl
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_on_curve
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_invert
argument_list|(
name|group
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* P = -2Q */
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|P
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_add
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|R
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|R
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* R = P + 2Q */
block|{
specifier|const
name|EC_POINT
modifier|*
name|points
index|[
literal|3
index|]
decl_stmt|;
specifier|const
name|BIGNUM
modifier|*
name|scalars
index|[
literal|3
index|]
decl_stmt|;
if|if
condition|(
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|Q
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|points
index|[
literal|0
index|]
operator|=
name|Q
expr_stmt|;
name|points
index|[
literal|1
index|]
operator|=
name|Q
expr_stmt|;
name|points
index|[
literal|2
index|]
operator|=
name|Q
expr_stmt|;
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|y
argument_list|,
name|z
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
name|BN_is_odd
argument_list|(
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_rshift1
argument_list|(
name|y
argument_list|,
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|y
expr_stmt|;
comment|/* (group order + 1)/2,  so  y*Q + y*Q = Q */
name|scalars
index|[
literal|1
index|]
operator|=
name|y
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"combined multiplication ..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
comment|/* z is still the group order */
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|z
argument_list|,
literal|2
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|R
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|group
argument_list|,
name|R
argument_list|,
name|Q
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_pseudo_rand
argument_list|(
name|y
argument_list|,
name|BN_num_bits
argument_list|(
name|y
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|z
argument_list|,
name|z
argument_list|,
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|BN_set_negative
argument_list|(
name|z
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|y
expr_stmt|;
name|scalars
index|[
literal|1
index|]
operator|=
name|z
expr_stmt|;
comment|/* z = -(order + y) */
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_pseudo_rand
argument_list|(
name|x
argument_list|,
name|BN_num_bits
argument_list|(
name|y
argument_list|)
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_add
argument_list|(
name|z
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|BN_set_negative
argument_list|(
name|z
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scalars
index|[
literal|0
index|]
operator|=
name|x
expr_stmt|;
name|scalars
index|[
literal|1
index|]
operator|=
name|y
expr_stmt|;
name|scalars
index|[
literal|2
index|]
operator|=
name|z
expr_stmt|;
comment|/* z = -(x+y) */
if|if
condition|(
operator|!
name|EC_POINTs_mul
argument_list|(
name|group
argument_list|,
name|P
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|points
argument_list|,
name|scalars
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_is_at_infinity
argument_list|(
name|group
argument_list|,
name|P
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n\n"
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
literal|0
block|timings(C2_K163, TIMING_BASE_PT, ctx); 	timings(C2_K163, TIMING_RAND_PT, ctx); 	timings(C2_K163, TIMING_SIMUL, ctx); 	timings(C2_B163, TIMING_BASE_PT, ctx); 	timings(C2_B163, TIMING_RAND_PT, ctx); 	timings(C2_B163, TIMING_SIMUL, ctx); 	timings(C2_K233, TIMING_BASE_PT, ctx); 	timings(C2_K233, TIMING_RAND_PT, ctx); 	timings(C2_K233, TIMING_SIMUL, ctx); 	timings(C2_B233, TIMING_BASE_PT, ctx); 	timings(C2_B233, TIMING_RAND_PT, ctx); 	timings(C2_B233, TIMING_SIMUL, ctx); 	timings(C2_K283, TIMING_BASE_PT, ctx); 	timings(C2_K283, TIMING_RAND_PT, ctx); 	timings(C2_K283, TIMING_SIMUL, ctx); 	timings(C2_B283, TIMING_BASE_PT, ctx); 	timings(C2_B283, TIMING_RAND_PT, ctx); 	timings(C2_B283, TIMING_SIMUL, ctx); 	timings(C2_K409, TIMING_BASE_PT, ctx); 	timings(C2_K409, TIMING_RAND_PT, ctx); 	timings(C2_K409, TIMING_SIMUL, ctx); 	timings(C2_B409, TIMING_BASE_PT, ctx); 	timings(C2_B409, TIMING_RAND_PT, ctx); 	timings(C2_B409, TIMING_SIMUL, ctx); 	timings(C2_K571, TIMING_BASE_PT, ctx); 	timings(C2_K571, TIMING_RAND_PT, ctx); 	timings(C2_K571, TIMING_SIMUL, ctx); 	timings(C2_B571, TIMING_BASE_PT, ctx); 	timings(C2_B571, TIMING_RAND_PT, ctx); 	timings(C2_B571, TIMING_SIMUL, ctx);
endif|#
directive|endif
if|if
condition|(
name|ctx
condition|)
name|BN_CTX_free
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|EC_GROUP_free
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|R
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|z
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|cof
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_K163
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_K163
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_B163
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_B163
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_K233
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_K233
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_B233
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_B233
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_K283
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_K283
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_B283
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_B283
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_K409
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_K409
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_B409
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_B409
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_K571
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_K571
argument_list|)
expr_stmt|;
if|if
condition|(
name|C2_B571
condition|)
name|EC_GROUP_free
argument_list|(
name|C2_B571
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|internal_curve_test
parameter_list|(
name|void
parameter_list|)
block|{
name|EC_builtin_curve
modifier|*
name|curves
init|=
name|NULL
decl_stmt|;
name|size_t
name|crv_len
init|=
literal|0
decl_stmt|,
name|n
init|=
literal|0
decl_stmt|;
name|int
name|ok
init|=
literal|1
decl_stmt|;
name|crv_len
operator|=
name|EC_get_builtin_curves
argument_list|(
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curves
operator|=
name|OPENSSL_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|EC_builtin_curve
argument_list|)
operator|*
name|crv_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|curves
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
operator|!
name|EC_get_builtin_curves
argument_list|(
name|curves
argument_list|,
name|crv_len
argument_list|)
condition|)
block|{
name|OPENSSL_free
argument_list|(
name|curves
argument_list|)
expr_stmt|;
return|return;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"testing internal curves: "
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|crv_len
condition|;
name|n
operator|++
control|)
block|{
name|EC_GROUP
modifier|*
name|group
init|=
name|NULL
decl_stmt|;
name|int
name|nid
init|=
name|curves
index|[
name|n
index|]
operator|.
name|nid
decl_stmt|;
if|if
condition|(
operator|(
name|group
operator|=
name|EC_GROUP_new_by_curve_name
argument_list|(
name|nid
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|ok
operator|=
literal|0
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nEC_GROUP_new_curve_name() failed with"
literal|" curve %s\n"
argument_list|,
name|OBJ_nid2sn
argument_list|(
name|nid
argument_list|)
argument_list|)
expr_stmt|;
comment|/* try next curve */
continue|continue;
block|}
if|if
condition|(
operator|!
name|EC_GROUP_check
argument_list|(
name|group
argument_list|,
name|NULL
argument_list|)
condition|)
block|{
name|ok
operator|=
literal|0
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nEC_GROUP_check() failed with"
literal|" curve %s\n"
argument_list|,
name|OBJ_nid2sn
argument_list|(
name|nid
argument_list|)
argument_list|)
expr_stmt|;
name|EC_GROUP_free
argument_list|(
name|group
argument_list|)
expr_stmt|;
comment|/* try the next curve */
continue|continue;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|EC_GROUP_free
argument_list|(
name|group
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ok
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" ok\n\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" failed\n\n"
argument_list|)
expr_stmt|;
name|ABORT
expr_stmt|;
block|}
name|OPENSSL_free
argument_list|(
name|curves
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|OPENSSL_NO_EC_NISTP_64_GCC_128
end_ifndef

begin_comment
comment|/* nistp_test_params contains magic numbers for testing our optimized  * implementations of several NIST curves with characteristic> 3. */
end_comment

begin_struct
struct|struct
name|nistp_test_params
block|{
specifier|const
name|EC_METHOD
modifier|*
function_decl|(
modifier|*
name|meth
function_decl|)
parameter_list|()
function_decl|;
name|int
name|degree
decl_stmt|;
comment|/* Qx, Qy and D are taken from 	 * http://csrc.nist.gov/groups/ST/toolkit/documents/Examples/ECDSA_Prime.pdf 	 * Otherwise, values are standard curve parameters from FIPS 180-3 */
specifier|const
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|,
modifier|*
name|Qx
decl_stmt|,
modifier|*
name|Qy
decl_stmt|,
modifier|*
name|Gx
decl_stmt|,
modifier|*
name|Gy
decl_stmt|,
modifier|*
name|order
decl_stmt|,
modifier|*
name|d
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|nistp_test_params
name|nistp_tests_params
index|[]
init|=
block|{
block|{
comment|/* P-224 */
name|EC_GFp_nistp224_method
block|,
literal|224
block|,
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001"
block|,
comment|/* p */
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE"
block|,
comment|/* a */
literal|"B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4"
block|,
comment|/* b */
literal|"E84FB0B8E7000CB657D7973CF6B42ED78B301674276DF744AF130B3E"
block|,
comment|/* Qx */
literal|"4376675C6FC5612C21A0FF2D2A89D2987DF7A2BC52183B5982298555"
block|,
comment|/* Qy */
literal|"B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21"
block|,
comment|/* Gx */
literal|"BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34"
block|,
comment|/* Gy */
literal|"FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D"
block|,
comment|/* order */
literal|"3F0C488E987C80BE0FEE521F8D90BE6034EC69AE11CA72AA777481E8"
block|,
comment|/* d */
block|}
block|,
block|{
comment|/* P-256 */
name|EC_GFp_nistp256_method
block|,
literal|256
block|,
literal|"ffffffff00000001000000000000000000000000ffffffffffffffffffffffff"
block|,
comment|/* p */
literal|"ffffffff00000001000000000000000000000000fffffffffffffffffffffffc"
block|,
comment|/* a */
literal|"5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"
block|,
comment|/* b */
literal|"b7e08afdfe94bad3f1dc8c734798ba1c62b3a0ad1e9ea2a38201cd0889bc7a19"
block|,
comment|/* Qx */
literal|"3603f747959dbf7a4bb226e41928729063adc7ae43529e61b563bbc606cc5e09"
block|,
comment|/* Qy */
literal|"6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"
block|,
comment|/* Gx */
literal|"4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"
block|,
comment|/* Gy */
literal|"ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"
block|,
comment|/* order */
literal|"c477f9f65c22cce20657faa5b2d1d8122336f851a508a1ed04e479c34985bf96"
block|,
comment|/* d */
block|}
block|,
block|{
comment|/* P-521 */
name|EC_GFp_nistp521_method
block|,
literal|521
block|,
literal|"1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"
block|,
comment|/* p */
literal|"1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"
block|,
comment|/* a */
literal|"051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"
block|,
comment|/* b */
literal|"0098e91eef9a68452822309c52fab453f5f117c1da8ed796b255e9ab8f6410cca16e59df403a6bdc6ca467a37056b1e54b3005d8ac030decfeb68df18b171885d5c4"
block|,
comment|/* Qx */
literal|"0164350c321aecfc1cca1ba4364c9b15656150b4b78d6a48d7d28e7f31985ef17be8554376b72900712c4b83ad668327231526e313f5f092999a4632fd50d946bc2e"
block|,
comment|/* Qy */
literal|"c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"
block|,
comment|/* Gx */
literal|"11839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"
block|,
comment|/* Gy */
literal|"1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"
block|,
comment|/* order */
literal|"0100085f47b8e1b8b11b7eb33028c0b2888e304bfc98501955b45bba1478dc184eeedf09b86a5f7c21994406072787205e69a63709fe35aa93ba333514b24f961722"
block|,
comment|/* d */
block|}
block|, 	}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|nistp_single_test
parameter_list|(
specifier|const
name|struct
name|nistp_test_params
modifier|*
name|test
parameter_list|)
block|{
name|BN_CTX
modifier|*
name|ctx
decl_stmt|;
name|BIGNUM
modifier|*
name|p
decl_stmt|,
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|,
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|,
modifier|*
name|n
decl_stmt|,
modifier|*
name|m
decl_stmt|,
modifier|*
name|order
decl_stmt|;
name|EC_GROUP
modifier|*
name|NISTP
decl_stmt|;
name|EC_POINT
modifier|*
name|G
decl_stmt|,
modifier|*
name|P
decl_stmt|,
modifier|*
name|Q
decl_stmt|,
modifier|*
name|Q_CHECK
decl_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\nNIST curve P-%d (optimised implementation):\n"
argument_list|,
name|test
operator|->
name|degree
argument_list|)
expr_stmt|;
name|ctx
operator|=
name|BN_CTX_new
argument_list|()
expr_stmt|;
name|p
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|a
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|b
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|x
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|y
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|m
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|n
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|order
operator|=
name|BN_new
argument_list|()
expr_stmt|;
name|NISTP
operator|=
name|EC_GROUP_new
argument_list|(
name|test
operator|->
name|meth
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|NISTP
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|p
argument_list|,
name|test
operator|->
name|p
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|BN_is_prime_ex
argument_list|(
name|p
argument_list|,
name|BN_prime_checks
argument_list|,
name|ctx
argument_list|,
name|NULL
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|a
argument_list|,
name|test
operator|->
name|a
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|b
argument_list|,
name|test
operator|->
name|b
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_curve_GFp
argument_list|(
name|NISTP
argument_list|,
name|p
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|G
operator|=
name|EC_POINT_new
argument_list|(
name|NISTP
argument_list|)
expr_stmt|;
name|P
operator|=
name|EC_POINT_new
argument_list|(
name|NISTP
argument_list|)
expr_stmt|;
name|Q
operator|=
name|EC_POINT_new
argument_list|(
name|NISTP
argument_list|)
expr_stmt|;
name|Q_CHECK
operator|=
name|EC_POINT_new
argument_list|(
name|NISTP
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
name|test
operator|->
name|Qx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|y
argument_list|,
name|test
operator|->
name|Qy
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_affine_coordinates_GFp
argument_list|(
name|NISTP
argument_list|,
name|Q_CHECK
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|x
argument_list|,
name|test
operator|->
name|Gx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|y
argument_list|,
name|test
operator|->
name|Gy
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_POINT_set_affine_coordinates_GFp
argument_list|(
name|NISTP
argument_list|,
name|G
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|order
argument_list|,
name|test
operator|->
name|order
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|NISTP
argument_list|,
name|G
argument_list|,
name|order
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"verify degree ... "
argument_list|)
expr_stmt|;
if|if
condition|(
name|EC_GROUP_get_degree
argument_list|(
name|NISTP
argument_list|)
operator|!=
name|test
operator|->
name|degree
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ok\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"NIST test vectors ... "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|BN_hex2bn
argument_list|(
operator|&
name|n
argument_list|,
name|test
operator|->
name|d
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* fixed point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|n
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* random point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|G
argument_list|,
name|n
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* set generator to P = 2*G, where G is the standard generator */
if|if
condition|(
operator|!
name|EC_POINT_dbl
argument_list|(
name|NISTP
argument_list|,
name|P
argument_list|,
name|G
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|NISTP
argument_list|,
name|P
argument_list|,
name|order
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* set the scalar to m=n/2, where n is the NIST test scalar */
if|if
condition|(
operator|!
name|BN_rshift
argument_list|(
name|m
argument_list|,
name|n
argument_list|,
literal|1
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* test the non-standard generator */
comment|/* fixed point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|m
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* random point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|P
argument_list|,
name|m
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* now repeat all tests with precomputation */
if|if
condition|(
operator|!
name|EC_GROUP_precompute_mult
argument_list|(
name|NISTP
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* fixed point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|m
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* random point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|P
argument_list|,
name|m
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* reset generator */
if|if
condition|(
operator|!
name|EC_GROUP_set_generator
argument_list|(
name|NISTP
argument_list|,
name|G
argument_list|,
name|order
argument_list|,
name|BN_value_one
argument_list|()
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* fixed point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|n
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
comment|/* random point multiplication */
name|EC_POINT_mul
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|NULL
argument_list|,
name|G
argument_list|,
name|n
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|!=
name|EC_POINT_cmp
argument_list|(
name|NISTP
argument_list|,
name|Q
argument_list|,
name|Q_CHECK
argument_list|,
name|ctx
argument_list|)
condition|)
name|ABORT
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ok\n"
argument_list|)
expr_stmt|;
name|group_order_tests
argument_list|(
name|NISTP
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|timings(NISTP, TIMING_BASE_PT, ctx); 	timings(NISTP, TIMING_RAND_PT, ctx);
endif|#
directive|endif
name|EC_GROUP_free
argument_list|(
name|NISTP
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|G
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|EC_POINT_free
argument_list|(
name|Q_CHECK
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|BN_free
argument_list|(
name|order
argument_list|)
expr_stmt|;
name|BN_CTX_free
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|nistp_tests
parameter_list|()
block|{
name|unsigned
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|nistp_tests_params
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|nistp_test_params
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|nistp_single_test
argument_list|(
operator|&
name|nistp_tests_params
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rnd_seed
index|[]
init|=
literal|"string to make the random number generator think it has entropy"
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
comment|/* enable memory leak checking unless explicitly disabled */
if|if
condition|(
operator|!
operator|(
operator|(
name|getenv
argument_list|(
literal|"OPENSSL_DEBUG_MEMORY"
argument_list|)
operator|!=
name|NULL
operator|)
operator|&&
operator|(
literal|0
operator|==
name|strcmp
argument_list|(
name|getenv
argument_list|(
literal|"OPENSSL_DEBUG_MEMORY"
argument_list|)
argument_list|,
literal|"off"
argument_list|)
operator|)
operator|)
condition|)
block|{
name|CRYPTO_malloc_debug_init
argument_list|()
expr_stmt|;
name|CRYPTO_set_mem_debug_options
argument_list|(
name|V_CRYPTO_MDEBUG_ALL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* OPENSSL_DEBUG_MEMORY=off */
name|CRYPTO_set_mem_debug_functions
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|CRYPTO_mem_ctrl
argument_list|(
name|CRYPTO_MEM_CHECK_ON
argument_list|)
expr_stmt|;
name|ERR_load_crypto_strings
argument_list|()
expr_stmt|;
name|RAND_seed
argument_list|(
name|rnd_seed
argument_list|,
sizeof|sizeof
name|rnd_seed
argument_list|)
expr_stmt|;
comment|/* or BN_generate_prime may fail */
name|prime_field_tests
argument_list|()
expr_stmt|;
name|puts
argument_list|(
literal|""
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|OPENSSL_NO_EC2M
name|char2_field_tests
argument_list|()
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|OPENSSL_NO_EC_NISTP_64_GCC_128
name|nistp_tests
argument_list|()
expr_stmt|;
endif|#
directive|endif
comment|/* test the internal curves */
name|internal_curve_test
argument_list|()
expr_stmt|;
ifndef|#
directive|ifndef
name|OPENSSL_NO_ENGINE
name|ENGINE_cleanup
argument_list|()
expr_stmt|;
endif|#
directive|endif
name|CRYPTO_cleanup_all_ex_data
argument_list|()
expr_stmt|;
name|ERR_free_strings
argument_list|()
expr_stmt|;
name|ERR_remove_thread_state
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|CRYPTO_mem_leaks_fp
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

