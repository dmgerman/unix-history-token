begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* crypto/des/set_key.c */
end_comment

begin_comment
comment|/* Copyright (C) 1995-1998 Eric Young (eay@cryptsoft.com)  * All rights reserved.  *  * This package is an SSL implementation written  * by Eric Young (eay@cryptsoft.com).  * The implementation was written so as to conform with Netscapes SSL.  *   * This library is free for commercial and non-commercial use as long as  * the following conditions are aheared to.  The following conditions  * apply to all code found in this distribution, be it the RC4, RSA,  * lhash, DES, etc., code; not just the SSL code.  The SSL documentation  * included with this distribution is covered by the same copyright terms  * except that the holder is Tim Hudson (tjh@cryptsoft.com).  *   * Copyright remains Eric Young's, and as such any Copyright notices in  * the code are not to be removed.  * If this package is used in a product, Eric Young should be given attribution  * as the author of the parts of the library used.  * This can be in the form of a textual message at program startup or  * in documentation (online or textual) provided with the package.  *   * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *    "This product includes cryptographic software written by  *     Eric Young (eay@cryptsoft.com)"  *    The word 'cryptographic' can be left out if the rouines from the library  *    being used are not cryptographic related :-).  * 4. If you include any Windows specific code (or a derivative thereof) from   *    the apps directory (application code) you must include an acknowledgement:  *    "This product includes software written by Tim Hudson (tjh@cryptsoft.com)"  *   * THIS SOFTWARE IS PROVIDED BY ERIC YOUNG ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *   * The licence and distribution terms for any publically available version or  * derivative of this code cannot be changed.  i.e. this code cannot simply be  * copied and put under another distribution licence  * [including the GNU Public Licence.]  */
end_comment

begin_comment
comment|/* set_key.c v 1.4 eay 24/9/91  * 1.4 Speed up by 400% :-)  * 1.3 added register declarations.  * 1.2 unrolled make_key_sched a bit more  * 1.1 added norm_expand_bits  * 1.0 First working version  */
end_comment

begin_include
include|#
directive|include
file|"des_locl.h"
end_include

begin_decl_stmt
name|OPENSSL_GLOBAL
name|int
name|des_check_key
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|unsigned
name|char
name|odd_parity
index|[
literal|256
index|]
init|=
block|{
literal|1
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|4
block|,
literal|4
block|,
literal|7
block|,
literal|7
block|,
literal|8
block|,
literal|8
block|,
literal|11
block|,
literal|11
block|,
literal|13
block|,
literal|13
block|,
literal|14
block|,
literal|14
block|,
literal|16
block|,
literal|16
block|,
literal|19
block|,
literal|19
block|,
literal|21
block|,
literal|21
block|,
literal|22
block|,
literal|22
block|,
literal|25
block|,
literal|25
block|,
literal|26
block|,
literal|26
block|,
literal|28
block|,
literal|28
block|,
literal|31
block|,
literal|31
block|,
literal|32
block|,
literal|32
block|,
literal|35
block|,
literal|35
block|,
literal|37
block|,
literal|37
block|,
literal|38
block|,
literal|38
block|,
literal|41
block|,
literal|41
block|,
literal|42
block|,
literal|42
block|,
literal|44
block|,
literal|44
block|,
literal|47
block|,
literal|47
block|,
literal|49
block|,
literal|49
block|,
literal|50
block|,
literal|50
block|,
literal|52
block|,
literal|52
block|,
literal|55
block|,
literal|55
block|,
literal|56
block|,
literal|56
block|,
literal|59
block|,
literal|59
block|,
literal|61
block|,
literal|61
block|,
literal|62
block|,
literal|62
block|,
literal|64
block|,
literal|64
block|,
literal|67
block|,
literal|67
block|,
literal|69
block|,
literal|69
block|,
literal|70
block|,
literal|70
block|,
literal|73
block|,
literal|73
block|,
literal|74
block|,
literal|74
block|,
literal|76
block|,
literal|76
block|,
literal|79
block|,
literal|79
block|,
literal|81
block|,
literal|81
block|,
literal|82
block|,
literal|82
block|,
literal|84
block|,
literal|84
block|,
literal|87
block|,
literal|87
block|,
literal|88
block|,
literal|88
block|,
literal|91
block|,
literal|91
block|,
literal|93
block|,
literal|93
block|,
literal|94
block|,
literal|94
block|,
literal|97
block|,
literal|97
block|,
literal|98
block|,
literal|98
block|,
literal|100
block|,
literal|100
block|,
literal|103
block|,
literal|103
block|,
literal|104
block|,
literal|104
block|,
literal|107
block|,
literal|107
block|,
literal|109
block|,
literal|109
block|,
literal|110
block|,
literal|110
block|,
literal|112
block|,
literal|112
block|,
literal|115
block|,
literal|115
block|,
literal|117
block|,
literal|117
block|,
literal|118
block|,
literal|118
block|,
literal|121
block|,
literal|121
block|,
literal|122
block|,
literal|122
block|,
literal|124
block|,
literal|124
block|,
literal|127
block|,
literal|127
block|,
literal|128
block|,
literal|128
block|,
literal|131
block|,
literal|131
block|,
literal|133
block|,
literal|133
block|,
literal|134
block|,
literal|134
block|,
literal|137
block|,
literal|137
block|,
literal|138
block|,
literal|138
block|,
literal|140
block|,
literal|140
block|,
literal|143
block|,
literal|143
block|,
literal|145
block|,
literal|145
block|,
literal|146
block|,
literal|146
block|,
literal|148
block|,
literal|148
block|,
literal|151
block|,
literal|151
block|,
literal|152
block|,
literal|152
block|,
literal|155
block|,
literal|155
block|,
literal|157
block|,
literal|157
block|,
literal|158
block|,
literal|158
block|,
literal|161
block|,
literal|161
block|,
literal|162
block|,
literal|162
block|,
literal|164
block|,
literal|164
block|,
literal|167
block|,
literal|167
block|,
literal|168
block|,
literal|168
block|,
literal|171
block|,
literal|171
block|,
literal|173
block|,
literal|173
block|,
literal|174
block|,
literal|174
block|,
literal|176
block|,
literal|176
block|,
literal|179
block|,
literal|179
block|,
literal|181
block|,
literal|181
block|,
literal|182
block|,
literal|182
block|,
literal|185
block|,
literal|185
block|,
literal|186
block|,
literal|186
block|,
literal|188
block|,
literal|188
block|,
literal|191
block|,
literal|191
block|,
literal|193
block|,
literal|193
block|,
literal|194
block|,
literal|194
block|,
literal|196
block|,
literal|196
block|,
literal|199
block|,
literal|199
block|,
literal|200
block|,
literal|200
block|,
literal|203
block|,
literal|203
block|,
literal|205
block|,
literal|205
block|,
literal|206
block|,
literal|206
block|,
literal|208
block|,
literal|208
block|,
literal|211
block|,
literal|211
block|,
literal|213
block|,
literal|213
block|,
literal|214
block|,
literal|214
block|,
literal|217
block|,
literal|217
block|,
literal|218
block|,
literal|218
block|,
literal|220
block|,
literal|220
block|,
literal|223
block|,
literal|223
block|,
literal|224
block|,
literal|224
block|,
literal|227
block|,
literal|227
block|,
literal|229
block|,
literal|229
block|,
literal|230
block|,
literal|230
block|,
literal|233
block|,
literal|233
block|,
literal|234
block|,
literal|234
block|,
literal|236
block|,
literal|236
block|,
literal|239
block|,
literal|239
block|,
literal|241
block|,
literal|241
block|,
literal|242
block|,
literal|242
block|,
literal|244
block|,
literal|244
block|,
literal|247
block|,
literal|247
block|,
literal|248
block|,
literal|248
block|,
literal|251
block|,
literal|251
block|,
literal|253
block|,
literal|253
block|,
literal|254
block|,
literal|254
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|des_set_odd_parity
parameter_list|(
name|des_cblock
modifier|*
name|key
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DES_KEY_SZ
condition|;
name|i
operator|++
control|)
operator|(
operator|*
name|key
operator|)
index|[
name|i
index|]
operator|=
name|odd_parity
index|[
operator|(
operator|*
name|key
operator|)
index|[
name|i
index|]
index|]
expr_stmt|;
block|}
end_function

begin_function
name|int
name|des_check_key_parity
parameter_list|(
name|const_des_cblock
modifier|*
name|key
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DES_KEY_SZ
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|key
operator|)
index|[
name|i
index|]
operator|!=
name|odd_parity
index|[
operator|(
operator|*
name|key
operator|)
index|[
name|i
index|]
index|]
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Weak and semi week keys as take from  * %A D.W. Davies  * %A W.L. Price  * %T Security for Computer Networks  * %I John Wiley& Sons  * %D 1984  * Many thanks to smb@ulysses.att.com (Steven Bellovin) for the reference  * (and actual cblock values).  */
end_comment

begin_define
define|#
directive|define
name|NUM_WEAK_KEY
value|16
end_define

begin_decl_stmt
specifier|static
name|des_cblock
name|weak_keys
index|[
name|NUM_WEAK_KEY
index|]
init|=
block|{
comment|/* weak keys */
block|{
literal|0x01
block|,
literal|0x01
block|,
literal|0x01
block|,
literal|0x01
block|,
literal|0x01
block|,
literal|0x01
block|,
literal|0x01
block|,
literal|0x01
block|}
block|,
block|{
literal|0xFE
block|,
literal|0xFE
block|,
literal|0xFE
block|,
literal|0xFE
block|,
literal|0xFE
block|,
literal|0xFE
block|,
literal|0xFE
block|,
literal|0xFE
block|}
block|,
block|{
literal|0x1F
block|,
literal|0x1F
block|,
literal|0x1F
block|,
literal|0x1F
block|,
literal|0x0E
block|,
literal|0x0E
block|,
literal|0x0E
block|,
literal|0x0E
block|}
block|,
block|{
literal|0xE0
block|,
literal|0xE0
block|,
literal|0xE0
block|,
literal|0xE0
block|,
literal|0xF1
block|,
literal|0xF1
block|,
literal|0xF1
block|,
literal|0xF1
block|}
block|,
comment|/* semi-weak keys */
block|{
literal|0x01
block|,
literal|0xFE
block|,
literal|0x01
block|,
literal|0xFE
block|,
literal|0x01
block|,
literal|0xFE
block|,
literal|0x01
block|,
literal|0xFE
block|}
block|,
block|{
literal|0xFE
block|,
literal|0x01
block|,
literal|0xFE
block|,
literal|0x01
block|,
literal|0xFE
block|,
literal|0x01
block|,
literal|0xFE
block|,
literal|0x01
block|}
block|,
block|{
literal|0x1F
block|,
literal|0xE0
block|,
literal|0x1F
block|,
literal|0xE0
block|,
literal|0x0E
block|,
literal|0xF1
block|,
literal|0x0E
block|,
literal|0xF1
block|}
block|,
block|{
literal|0xE0
block|,
literal|0x1F
block|,
literal|0xE0
block|,
literal|0x1F
block|,
literal|0xF1
block|,
literal|0x0E
block|,
literal|0xF1
block|,
literal|0x0E
block|}
block|,
block|{
literal|0x01
block|,
literal|0xE0
block|,
literal|0x01
block|,
literal|0xE0
block|,
literal|0x01
block|,
literal|0xF1
block|,
literal|0x01
block|,
literal|0xF1
block|}
block|,
block|{
literal|0xE0
block|,
literal|0x01
block|,
literal|0xE0
block|,
literal|0x01
block|,
literal|0xF1
block|,
literal|0x01
block|,
literal|0xF1
block|,
literal|0x01
block|}
block|,
block|{
literal|0x1F
block|,
literal|0xFE
block|,
literal|0x1F
block|,
literal|0xFE
block|,
literal|0x0E
block|,
literal|0xFE
block|,
literal|0x0E
block|,
literal|0xFE
block|}
block|,
block|{
literal|0xFE
block|,
literal|0x1F
block|,
literal|0xFE
block|,
literal|0x1F
block|,
literal|0xFE
block|,
literal|0x0E
block|,
literal|0xFE
block|,
literal|0x0E
block|}
block|,
block|{
literal|0x01
block|,
literal|0x1F
block|,
literal|0x01
block|,
literal|0x1F
block|,
literal|0x01
block|,
literal|0x0E
block|,
literal|0x01
block|,
literal|0x0E
block|}
block|,
block|{
literal|0x1F
block|,
literal|0x01
block|,
literal|0x1F
block|,
literal|0x01
block|,
literal|0x0E
block|,
literal|0x01
block|,
literal|0x0E
block|,
literal|0x01
block|}
block|,
block|{
literal|0xE0
block|,
literal|0xFE
block|,
literal|0xE0
block|,
literal|0xFE
block|,
literal|0xF1
block|,
literal|0xFE
block|,
literal|0xF1
block|,
literal|0xFE
block|}
block|,
block|{
literal|0xFE
block|,
literal|0xE0
block|,
literal|0xFE
block|,
literal|0xE0
block|,
literal|0xFE
block|,
literal|0xF1
block|,
literal|0xFE
block|,
literal|0xF1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|des_is_weak_key
parameter_list|(
name|const_des_cblock
modifier|*
name|key
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_WEAK_KEY
condition|;
name|i
operator|++
control|)
comment|/* Added == 0 to comparison, I obviously don't run 		 * this section very often :-(, thanks to 		 * engineering@MorningStar.Com for the fix 		 * eay 93/06/29 		 * Another problem, I was comparing only the first 4 		 * bytes, 97/03/18 */
if|if
condition|(
name|memcmp
argument_list|(
name|weak_keys
index|[
name|i
index|]
argument_list|,
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|des_cblock
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* NOW DEFINED IN des_local.h  * See ecb_encrypt.c for a pseudo description of these macros.   * #define PERM_OP(a,b,t,n,m) ((t)=((((a)>>(n))^(b))&(m)),\  * 	(b)^=(t),\  * 	(a)=((a)^((t)<<(n))))  */
end_comment

begin_define
define|#
directive|define
name|HPERM_OP
parameter_list|(
name|a
parameter_list|,
name|t
parameter_list|,
name|n
parameter_list|,
name|m
parameter_list|)
value|((t)=((((a)<<(16-(n)))^(a))&(m)),\ 	(a)=(a)^(t)^(t>>(16-(n))))
end_define

begin_decl_stmt
specifier|static
specifier|const
name|DES_LONG
name|des_skb
index|[
literal|8
index|]
index|[
literal|64
index|]
init|=
block|{
block|{
comment|/* for C bits (numbered as per FIPS 46) 1 2 3 4 5 6 */
literal|0x00000000L
block|,
literal|0x00000010L
block|,
literal|0x20000000L
block|,
literal|0x20000010L
block|,
literal|0x00010000L
block|,
literal|0x00010010L
block|,
literal|0x20010000L
block|,
literal|0x20010010L
block|,
literal|0x00000800L
block|,
literal|0x00000810L
block|,
literal|0x20000800L
block|,
literal|0x20000810L
block|,
literal|0x00010800L
block|,
literal|0x00010810L
block|,
literal|0x20010800L
block|,
literal|0x20010810L
block|,
literal|0x00000020L
block|,
literal|0x00000030L
block|,
literal|0x20000020L
block|,
literal|0x20000030L
block|,
literal|0x00010020L
block|,
literal|0x00010030L
block|,
literal|0x20010020L
block|,
literal|0x20010030L
block|,
literal|0x00000820L
block|,
literal|0x00000830L
block|,
literal|0x20000820L
block|,
literal|0x20000830L
block|,
literal|0x00010820L
block|,
literal|0x00010830L
block|,
literal|0x20010820L
block|,
literal|0x20010830L
block|,
literal|0x00080000L
block|,
literal|0x00080010L
block|,
literal|0x20080000L
block|,
literal|0x20080010L
block|,
literal|0x00090000L
block|,
literal|0x00090010L
block|,
literal|0x20090000L
block|,
literal|0x20090010L
block|,
literal|0x00080800L
block|,
literal|0x00080810L
block|,
literal|0x20080800L
block|,
literal|0x20080810L
block|,
literal|0x00090800L
block|,
literal|0x00090810L
block|,
literal|0x20090800L
block|,
literal|0x20090810L
block|,
literal|0x00080020L
block|,
literal|0x00080030L
block|,
literal|0x20080020L
block|,
literal|0x20080030L
block|,
literal|0x00090020L
block|,
literal|0x00090030L
block|,
literal|0x20090020L
block|,
literal|0x20090030L
block|,
literal|0x00080820L
block|,
literal|0x00080830L
block|,
literal|0x20080820L
block|,
literal|0x20080830L
block|,
literal|0x00090820L
block|,
literal|0x00090830L
block|,
literal|0x20090820L
block|,
literal|0x20090830L
block|, 	}
block|,
block|{
comment|/* for C bits (numbered as per FIPS 46) 7 8 10 11 12 13 */
literal|0x00000000L
block|,
literal|0x02000000L
block|,
literal|0x00002000L
block|,
literal|0x02002000L
block|,
literal|0x00200000L
block|,
literal|0x02200000L
block|,
literal|0x00202000L
block|,
literal|0x02202000L
block|,
literal|0x00000004L
block|,
literal|0x02000004L
block|,
literal|0x00002004L
block|,
literal|0x02002004L
block|,
literal|0x00200004L
block|,
literal|0x02200004L
block|,
literal|0x00202004L
block|,
literal|0x02202004L
block|,
literal|0x00000400L
block|,
literal|0x02000400L
block|,
literal|0x00002400L
block|,
literal|0x02002400L
block|,
literal|0x00200400L
block|,
literal|0x02200400L
block|,
literal|0x00202400L
block|,
literal|0x02202400L
block|,
literal|0x00000404L
block|,
literal|0x02000404L
block|,
literal|0x00002404L
block|,
literal|0x02002404L
block|,
literal|0x00200404L
block|,
literal|0x02200404L
block|,
literal|0x00202404L
block|,
literal|0x02202404L
block|,
literal|0x10000000L
block|,
literal|0x12000000L
block|,
literal|0x10002000L
block|,
literal|0x12002000L
block|,
literal|0x10200000L
block|,
literal|0x12200000L
block|,
literal|0x10202000L
block|,
literal|0x12202000L
block|,
literal|0x10000004L
block|,
literal|0x12000004L
block|,
literal|0x10002004L
block|,
literal|0x12002004L
block|,
literal|0x10200004L
block|,
literal|0x12200004L
block|,
literal|0x10202004L
block|,
literal|0x12202004L
block|,
literal|0x10000400L
block|,
literal|0x12000400L
block|,
literal|0x10002400L
block|,
literal|0x12002400L
block|,
literal|0x10200400L
block|,
literal|0x12200400L
block|,
literal|0x10202400L
block|,
literal|0x12202400L
block|,
literal|0x10000404L
block|,
literal|0x12000404L
block|,
literal|0x10002404L
block|,
literal|0x12002404L
block|,
literal|0x10200404L
block|,
literal|0x12200404L
block|,
literal|0x10202404L
block|,
literal|0x12202404L
block|, 	}
block|,
block|{
comment|/* for C bits (numbered as per FIPS 46) 14 15 16 17 19 20 */
literal|0x00000000L
block|,
literal|0x00000001L
block|,
literal|0x00040000L
block|,
literal|0x00040001L
block|,
literal|0x01000000L
block|,
literal|0x01000001L
block|,
literal|0x01040000L
block|,
literal|0x01040001L
block|,
literal|0x00000002L
block|,
literal|0x00000003L
block|,
literal|0x00040002L
block|,
literal|0x00040003L
block|,
literal|0x01000002L
block|,
literal|0x01000003L
block|,
literal|0x01040002L
block|,
literal|0x01040003L
block|,
literal|0x00000200L
block|,
literal|0x00000201L
block|,
literal|0x00040200L
block|,
literal|0x00040201L
block|,
literal|0x01000200L
block|,
literal|0x01000201L
block|,
literal|0x01040200L
block|,
literal|0x01040201L
block|,
literal|0x00000202L
block|,
literal|0x00000203L
block|,
literal|0x00040202L
block|,
literal|0x00040203L
block|,
literal|0x01000202L
block|,
literal|0x01000203L
block|,
literal|0x01040202L
block|,
literal|0x01040203L
block|,
literal|0x08000000L
block|,
literal|0x08000001L
block|,
literal|0x08040000L
block|,
literal|0x08040001L
block|,
literal|0x09000000L
block|,
literal|0x09000001L
block|,
literal|0x09040000L
block|,
literal|0x09040001L
block|,
literal|0x08000002L
block|,
literal|0x08000003L
block|,
literal|0x08040002L
block|,
literal|0x08040003L
block|,
literal|0x09000002L
block|,
literal|0x09000003L
block|,
literal|0x09040002L
block|,
literal|0x09040003L
block|,
literal|0x08000200L
block|,
literal|0x08000201L
block|,
literal|0x08040200L
block|,
literal|0x08040201L
block|,
literal|0x09000200L
block|,
literal|0x09000201L
block|,
literal|0x09040200L
block|,
literal|0x09040201L
block|,
literal|0x08000202L
block|,
literal|0x08000203L
block|,
literal|0x08040202L
block|,
literal|0x08040203L
block|,
literal|0x09000202L
block|,
literal|0x09000203L
block|,
literal|0x09040202L
block|,
literal|0x09040203L
block|, 	}
block|,
block|{
comment|/* for C bits (numbered as per FIPS 46) 21 23 24 26 27 28 */
literal|0x00000000L
block|,
literal|0x00100000L
block|,
literal|0x00000100L
block|,
literal|0x00100100L
block|,
literal|0x00000008L
block|,
literal|0x00100008L
block|,
literal|0x00000108L
block|,
literal|0x00100108L
block|,
literal|0x00001000L
block|,
literal|0x00101000L
block|,
literal|0x00001100L
block|,
literal|0x00101100L
block|,
literal|0x00001008L
block|,
literal|0x00101008L
block|,
literal|0x00001108L
block|,
literal|0x00101108L
block|,
literal|0x04000000L
block|,
literal|0x04100000L
block|,
literal|0x04000100L
block|,
literal|0x04100100L
block|,
literal|0x04000008L
block|,
literal|0x04100008L
block|,
literal|0x04000108L
block|,
literal|0x04100108L
block|,
literal|0x04001000L
block|,
literal|0x04101000L
block|,
literal|0x04001100L
block|,
literal|0x04101100L
block|,
literal|0x04001008L
block|,
literal|0x04101008L
block|,
literal|0x04001108L
block|,
literal|0x04101108L
block|,
literal|0x00020000L
block|,
literal|0x00120000L
block|,
literal|0x00020100L
block|,
literal|0x00120100L
block|,
literal|0x00020008L
block|,
literal|0x00120008L
block|,
literal|0x00020108L
block|,
literal|0x00120108L
block|,
literal|0x00021000L
block|,
literal|0x00121000L
block|,
literal|0x00021100L
block|,
literal|0x00121100L
block|,
literal|0x00021008L
block|,
literal|0x00121008L
block|,
literal|0x00021108L
block|,
literal|0x00121108L
block|,
literal|0x04020000L
block|,
literal|0x04120000L
block|,
literal|0x04020100L
block|,
literal|0x04120100L
block|,
literal|0x04020008L
block|,
literal|0x04120008L
block|,
literal|0x04020108L
block|,
literal|0x04120108L
block|,
literal|0x04021000L
block|,
literal|0x04121000L
block|,
literal|0x04021100L
block|,
literal|0x04121100L
block|,
literal|0x04021008L
block|,
literal|0x04121008L
block|,
literal|0x04021108L
block|,
literal|0x04121108L
block|, 	}
block|,
block|{
comment|/* for D bits (numbered as per FIPS 46) 1 2 3 4 5 6 */
literal|0x00000000L
block|,
literal|0x10000000L
block|,
literal|0x00010000L
block|,
literal|0x10010000L
block|,
literal|0x00000004L
block|,
literal|0x10000004L
block|,
literal|0x00010004L
block|,
literal|0x10010004L
block|,
literal|0x20000000L
block|,
literal|0x30000000L
block|,
literal|0x20010000L
block|,
literal|0x30010000L
block|,
literal|0x20000004L
block|,
literal|0x30000004L
block|,
literal|0x20010004L
block|,
literal|0x30010004L
block|,
literal|0x00100000L
block|,
literal|0x10100000L
block|,
literal|0x00110000L
block|,
literal|0x10110000L
block|,
literal|0x00100004L
block|,
literal|0x10100004L
block|,
literal|0x00110004L
block|,
literal|0x10110004L
block|,
literal|0x20100000L
block|,
literal|0x30100000L
block|,
literal|0x20110000L
block|,
literal|0x30110000L
block|,
literal|0x20100004L
block|,
literal|0x30100004L
block|,
literal|0x20110004L
block|,
literal|0x30110004L
block|,
literal|0x00001000L
block|,
literal|0x10001000L
block|,
literal|0x00011000L
block|,
literal|0x10011000L
block|,
literal|0x00001004L
block|,
literal|0x10001004L
block|,
literal|0x00011004L
block|,
literal|0x10011004L
block|,
literal|0x20001000L
block|,
literal|0x30001000L
block|,
literal|0x20011000L
block|,
literal|0x30011000L
block|,
literal|0x20001004L
block|,
literal|0x30001004L
block|,
literal|0x20011004L
block|,
literal|0x30011004L
block|,
literal|0x00101000L
block|,
literal|0x10101000L
block|,
literal|0x00111000L
block|,
literal|0x10111000L
block|,
literal|0x00101004L
block|,
literal|0x10101004L
block|,
literal|0x00111004L
block|,
literal|0x10111004L
block|,
literal|0x20101000L
block|,
literal|0x30101000L
block|,
literal|0x20111000L
block|,
literal|0x30111000L
block|,
literal|0x20101004L
block|,
literal|0x30101004L
block|,
literal|0x20111004L
block|,
literal|0x30111004L
block|, 	}
block|,
block|{
comment|/* for D bits (numbered as per FIPS 46) 8 9 11 12 13 14 */
literal|0x00000000L
block|,
literal|0x08000000L
block|,
literal|0x00000008L
block|,
literal|0x08000008L
block|,
literal|0x00000400L
block|,
literal|0x08000400L
block|,
literal|0x00000408L
block|,
literal|0x08000408L
block|,
literal|0x00020000L
block|,
literal|0x08020000L
block|,
literal|0x00020008L
block|,
literal|0x08020008L
block|,
literal|0x00020400L
block|,
literal|0x08020400L
block|,
literal|0x00020408L
block|,
literal|0x08020408L
block|,
literal|0x00000001L
block|,
literal|0x08000001L
block|,
literal|0x00000009L
block|,
literal|0x08000009L
block|,
literal|0x00000401L
block|,
literal|0x08000401L
block|,
literal|0x00000409L
block|,
literal|0x08000409L
block|,
literal|0x00020001L
block|,
literal|0x08020001L
block|,
literal|0x00020009L
block|,
literal|0x08020009L
block|,
literal|0x00020401L
block|,
literal|0x08020401L
block|,
literal|0x00020409L
block|,
literal|0x08020409L
block|,
literal|0x02000000L
block|,
literal|0x0A000000L
block|,
literal|0x02000008L
block|,
literal|0x0A000008L
block|,
literal|0x02000400L
block|,
literal|0x0A000400L
block|,
literal|0x02000408L
block|,
literal|0x0A000408L
block|,
literal|0x02020000L
block|,
literal|0x0A020000L
block|,
literal|0x02020008L
block|,
literal|0x0A020008L
block|,
literal|0x02020400L
block|,
literal|0x0A020400L
block|,
literal|0x02020408L
block|,
literal|0x0A020408L
block|,
literal|0x02000001L
block|,
literal|0x0A000001L
block|,
literal|0x02000009L
block|,
literal|0x0A000009L
block|,
literal|0x02000401L
block|,
literal|0x0A000401L
block|,
literal|0x02000409L
block|,
literal|0x0A000409L
block|,
literal|0x02020001L
block|,
literal|0x0A020001L
block|,
literal|0x02020009L
block|,
literal|0x0A020009L
block|,
literal|0x02020401L
block|,
literal|0x0A020401L
block|,
literal|0x02020409L
block|,
literal|0x0A020409L
block|, 	}
block|,
block|{
comment|/* for D bits (numbered as per FIPS 46) 16 17 18 19 20 21 */
literal|0x00000000L
block|,
literal|0x00000100L
block|,
literal|0x00080000L
block|,
literal|0x00080100L
block|,
literal|0x01000000L
block|,
literal|0x01000100L
block|,
literal|0x01080000L
block|,
literal|0x01080100L
block|,
literal|0x00000010L
block|,
literal|0x00000110L
block|,
literal|0x00080010L
block|,
literal|0x00080110L
block|,
literal|0x01000010L
block|,
literal|0x01000110L
block|,
literal|0x01080010L
block|,
literal|0x01080110L
block|,
literal|0x00200000L
block|,
literal|0x00200100L
block|,
literal|0x00280000L
block|,
literal|0x00280100L
block|,
literal|0x01200000L
block|,
literal|0x01200100L
block|,
literal|0x01280000L
block|,
literal|0x01280100L
block|,
literal|0x00200010L
block|,
literal|0x00200110L
block|,
literal|0x00280010L
block|,
literal|0x00280110L
block|,
literal|0x01200010L
block|,
literal|0x01200110L
block|,
literal|0x01280010L
block|,
literal|0x01280110L
block|,
literal|0x00000200L
block|,
literal|0x00000300L
block|,
literal|0x00080200L
block|,
literal|0x00080300L
block|,
literal|0x01000200L
block|,
literal|0x01000300L
block|,
literal|0x01080200L
block|,
literal|0x01080300L
block|,
literal|0x00000210L
block|,
literal|0x00000310L
block|,
literal|0x00080210L
block|,
literal|0x00080310L
block|,
literal|0x01000210L
block|,
literal|0x01000310L
block|,
literal|0x01080210L
block|,
literal|0x01080310L
block|,
literal|0x00200200L
block|,
literal|0x00200300L
block|,
literal|0x00280200L
block|,
literal|0x00280300L
block|,
literal|0x01200200L
block|,
literal|0x01200300L
block|,
literal|0x01280200L
block|,
literal|0x01280300L
block|,
literal|0x00200210L
block|,
literal|0x00200310L
block|,
literal|0x00280210L
block|,
literal|0x00280310L
block|,
literal|0x01200210L
block|,
literal|0x01200310L
block|,
literal|0x01280210L
block|,
literal|0x01280310L
block|, 	}
block|,
block|{
comment|/* for D bits (numbered as per FIPS 46) 22 23 24 25 27 28 */
literal|0x00000000L
block|,
literal|0x04000000L
block|,
literal|0x00040000L
block|,
literal|0x04040000L
block|,
literal|0x00000002L
block|,
literal|0x04000002L
block|,
literal|0x00040002L
block|,
literal|0x04040002L
block|,
literal|0x00002000L
block|,
literal|0x04002000L
block|,
literal|0x00042000L
block|,
literal|0x04042000L
block|,
literal|0x00002002L
block|,
literal|0x04002002L
block|,
literal|0x00042002L
block|,
literal|0x04042002L
block|,
literal|0x00000020L
block|,
literal|0x04000020L
block|,
literal|0x00040020L
block|,
literal|0x04040020L
block|,
literal|0x00000022L
block|,
literal|0x04000022L
block|,
literal|0x00040022L
block|,
literal|0x04040022L
block|,
literal|0x00002020L
block|,
literal|0x04002020L
block|,
literal|0x00042020L
block|,
literal|0x04042020L
block|,
literal|0x00002022L
block|,
literal|0x04002022L
block|,
literal|0x00042022L
block|,
literal|0x04042022L
block|,
literal|0x00000800L
block|,
literal|0x04000800L
block|,
literal|0x00040800L
block|,
literal|0x04040800L
block|,
literal|0x00000802L
block|,
literal|0x04000802L
block|,
literal|0x00040802L
block|,
literal|0x04040802L
block|,
literal|0x00002800L
block|,
literal|0x04002800L
block|,
literal|0x00042800L
block|,
literal|0x04042800L
block|,
literal|0x00002802L
block|,
literal|0x04002802L
block|,
literal|0x00042802L
block|,
literal|0x04042802L
block|,
literal|0x00000820L
block|,
literal|0x04000820L
block|,
literal|0x00040820L
block|,
literal|0x04040820L
block|,
literal|0x00000822L
block|,
literal|0x04000822L
block|,
literal|0x00040822L
block|,
literal|0x04040822L
block|,
literal|0x00002820L
block|,
literal|0x04002820L
block|,
literal|0x00042820L
block|,
literal|0x04042820L
block|,
literal|0x00002822L
block|,
literal|0x04002822L
block|,
literal|0x00042822L
block|,
literal|0x04042822L
block|, 	}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|des_set_key
parameter_list|(
name|const_des_cblock
modifier|*
name|key
parameter_list|,
name|des_key_schedule
name|schedule
parameter_list|)
block|{
if|if
condition|(
name|des_check_key
condition|)
block|{
return|return
name|des_set_key_checked
argument_list|(
name|key
argument_list|,
name|schedule
argument_list|)
return|;
block|}
else|else
block|{
name|des_set_key_unchecked
argument_list|(
name|key
argument_list|,
name|schedule
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
end_function

begin_comment
comment|/* return 0 if key parity is odd (correct),  * return -1 if key parity error,  * return -2 if illegal weak key.  */
end_comment

begin_function
name|int
name|des_set_key_checked
parameter_list|(
name|const_des_cblock
modifier|*
name|key
parameter_list|,
name|des_key_schedule
name|schedule
parameter_list|)
block|{
if|if
condition|(
operator|!
name|des_check_key_parity
argument_list|(
name|key
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|des_is_weak_key
argument_list|(
name|key
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|2
operator|)
return|;
name|des_set_key_unchecked
argument_list|(
name|key
argument_list|,
name|schedule
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|des_set_key_unchecked
parameter_list|(
name|const_des_cblock
modifier|*
name|key
parameter_list|,
name|des_key_schedule
name|schedule
parameter_list|)
block|{
specifier|static
name|int
name|shifts2
index|[
literal|16
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|}
decl_stmt|;
specifier|register
name|DES_LONG
name|c
decl_stmt|,
name|d
decl_stmt|,
name|t
decl_stmt|,
name|s
decl_stmt|,
name|t2
decl_stmt|;
specifier|register
specifier|const
name|unsigned
name|char
modifier|*
name|in
decl_stmt|;
specifier|register
name|DES_LONG
modifier|*
name|k
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|k
operator|=
operator|&
name|schedule
operator|->
name|ks
operator|.
name|deslong
index|[
literal|0
index|]
expr_stmt|;
name|in
operator|=
operator|&
operator|(
operator|*
name|key
operator|)
index|[
literal|0
index|]
expr_stmt|;
name|c2l
argument_list|(
name|in
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|c2l
argument_list|(
name|in
argument_list|,
name|d
argument_list|)
expr_stmt|;
comment|/* do PC1 in 47 simple operations :-) 	 * Thanks to John Fletcher (john_fletcher@lccmail.ocf.llnl.gov) 	 * for the inspiration. :-) */
name|PERM_OP
argument_list|(
name|d
argument_list|,
name|c
argument_list|,
name|t
argument_list|,
literal|4
argument_list|,
literal|0x0f0f0f0fL
argument_list|)
expr_stmt|;
name|HPERM_OP
argument_list|(
name|c
argument_list|,
name|t
argument_list|,
operator|-
literal|2
argument_list|,
literal|0xcccc0000L
argument_list|)
expr_stmt|;
name|HPERM_OP
argument_list|(
name|d
argument_list|,
name|t
argument_list|,
operator|-
literal|2
argument_list|,
literal|0xcccc0000L
argument_list|)
expr_stmt|;
name|PERM_OP
argument_list|(
name|d
argument_list|,
name|c
argument_list|,
name|t
argument_list|,
literal|1
argument_list|,
literal|0x55555555L
argument_list|)
expr_stmt|;
name|PERM_OP
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|t
argument_list|,
literal|8
argument_list|,
literal|0x00ff00ffL
argument_list|)
expr_stmt|;
name|PERM_OP
argument_list|(
name|d
argument_list|,
name|c
argument_list|,
name|t
argument_list|,
literal|1
argument_list|,
literal|0x55555555L
argument_list|)
expr_stmt|;
name|d
operator|=
operator|(
operator|(
operator|(
name|d
operator|&
literal|0x000000ffL
operator|)
operator|<<
literal|16L
operator|)
operator||
operator|(
name|d
operator|&
literal|0x0000ff00L
operator|)
operator||
operator|(
operator|(
name|d
operator|&
literal|0x00ff0000L
operator|)
operator|>>
literal|16L
operator|)
operator||
operator|(
operator|(
name|c
operator|&
literal|0xf0000000L
operator|)
operator|>>
literal|4L
operator|)
operator|)
expr_stmt|;
name|c
operator|&=
literal|0x0fffffffL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ITERATIONS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|shifts2
index|[
name|i
index|]
condition|)
block|{
name|c
operator|=
operator|(
operator|(
name|c
operator|>>
literal|2L
operator|)
operator||
operator|(
name|c
operator|<<
literal|26L
operator|)
operator|)
expr_stmt|;
name|d
operator|=
operator|(
operator|(
name|d
operator|>>
literal|2L
operator|)
operator||
operator|(
name|d
operator|<<
literal|26L
operator|)
operator|)
expr_stmt|;
block|}
else|else
block|{
name|c
operator|=
operator|(
operator|(
name|c
operator|>>
literal|1L
operator|)
operator||
operator|(
name|c
operator|<<
literal|27L
operator|)
operator|)
expr_stmt|;
name|d
operator|=
operator|(
operator|(
name|d
operator|>>
literal|1L
operator|)
operator||
operator|(
name|d
operator|<<
literal|27L
operator|)
operator|)
expr_stmt|;
block|}
name|c
operator|&=
literal|0x0fffffffL
expr_stmt|;
name|d
operator|&=
literal|0x0fffffffL
expr_stmt|;
comment|/* could be a few less shifts but I am to lazy at this 		 * point in time to investigate */
name|s
operator|=
name|des_skb
index|[
literal|0
index|]
index|[
operator|(
name|c
operator|)
operator|&
literal|0x3f
index|]
operator||
name|des_skb
index|[
literal|1
index|]
index|[
operator|(
operator|(
name|c
operator|>>
literal|6L
operator|)
operator|&
literal|0x03
operator|)
operator||
operator|(
operator|(
name|c
operator|>>
literal|7L
operator|)
operator|&
literal|0x3c
operator|)
index|]
operator||
name|des_skb
index|[
literal|2
index|]
index|[
operator|(
operator|(
name|c
operator|>>
literal|13L
operator|)
operator|&
literal|0x0f
operator|)
operator||
operator|(
operator|(
name|c
operator|>>
literal|14L
operator|)
operator|&
literal|0x30
operator|)
index|]
operator||
name|des_skb
index|[
literal|3
index|]
index|[
operator|(
operator|(
name|c
operator|>>
literal|20L
operator|)
operator|&
literal|0x01
operator|)
operator||
operator|(
operator|(
name|c
operator|>>
literal|21L
operator|)
operator|&
literal|0x06
operator|)
operator||
operator|(
operator|(
name|c
operator|>>
literal|22L
operator|)
operator|&
literal|0x38
operator|)
index|]
expr_stmt|;
name|t
operator|=
name|des_skb
index|[
literal|4
index|]
index|[
operator|(
name|d
operator|)
operator|&
literal|0x3f
index|]
operator||
name|des_skb
index|[
literal|5
index|]
index|[
operator|(
operator|(
name|d
operator|>>
literal|7L
operator|)
operator|&
literal|0x03
operator|)
operator||
operator|(
operator|(
name|d
operator|>>
literal|8L
operator|)
operator|&
literal|0x3c
operator|)
index|]
operator||
name|des_skb
index|[
literal|6
index|]
index|[
operator|(
name|d
operator|>>
literal|15L
operator|)
operator|&
literal|0x3f
index|]
operator||
name|des_skb
index|[
literal|7
index|]
index|[
operator|(
operator|(
name|d
operator|>>
literal|21L
operator|)
operator|&
literal|0x0f
operator|)
operator||
operator|(
operator|(
name|d
operator|>>
literal|22L
operator|)
operator|&
literal|0x30
operator|)
index|]
expr_stmt|;
comment|/* table contained 0213 4657 */
name|t2
operator|=
operator|(
operator|(
name|t
operator|<<
literal|16L
operator|)
operator||
operator|(
name|s
operator|&
literal|0x0000ffffL
operator|)
operator|)
operator|&
literal|0xffffffffL
expr_stmt|;
operator|*
operator|(
name|k
operator|++
operator|)
operator|=
name|ROTATE
argument_list|(
name|t2
argument_list|,
literal|30
argument_list|)
operator|&
literal|0xffffffffL
expr_stmt|;
name|t2
operator|=
operator|(
operator|(
name|s
operator|>>
literal|16L
operator|)
operator||
operator|(
name|t
operator|&
literal|0xffff0000L
operator|)
operator|)
expr_stmt|;
operator|*
operator|(
name|k
operator|++
operator|)
operator|=
name|ROTATE
argument_list|(
name|t2
argument_list|,
literal|26
argument_list|)
operator|&
literal|0xffffffffL
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|des_key_sched
parameter_list|(
name|const_des_cblock
modifier|*
name|key
parameter_list|,
name|des_key_schedule
name|schedule
parameter_list|)
block|{
return|return
operator|(
name|des_set_key
argument_list|(
name|key
argument_list|,
name|schedule
argument_list|)
operator|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|des_fixup_key_parity
end_undef

begin_function
name|void
name|des_fixup_key_parity
parameter_list|(
name|des_cblock
modifier|*
name|key
parameter_list|)
block|{
name|des_set_odd_parity
argument_list|(
name|key
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

