begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ====================================================================  * Copyright (c) 2003 The OpenSSL Project.  All rights reserved.  *  *  * This command is intended as a test driver for the FIPS-140 testing  * lab performing FIPS-140 validation.  It demonstrates the use of the  * OpenSSL library ito perform a variety of common cryptographic  * functions.  A power-up self test is demonstrated by deliberately  * pointing to an invalid executable hash  *  * Contributed by Steve Marquess.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<openssl/aes.h>
end_include

begin_include
include|#
directive|include
file|<openssl/des.h>
end_include

begin_include
include|#
directive|include
file|<openssl/hmac.h>
end_include

begin_include
include|#
directive|include
file|<openssl/err.h>
end_include

begin_include
include|#
directive|include
file|<openssl/bn.h>
end_include

begin_include
include|#
directive|include
file|<openssl/rand.h>
end_include

begin_include
include|#
directive|include
file|<openssl/sha.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|OPENSSL_FIPS
end_ifndef

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|printf
argument_list|(
literal|"No FIPS support\n"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<openssl/rsa.h>
end_include

begin_include
include|#
directive|include
file|<openssl/dsa.h>
end_include

begin_include
include|#
directive|include
file|<openssl/dh.h>
end_include

begin_include
include|#
directive|include
file|<openssl/fips.h>
end_include

begin_include
include|#
directive|include
file|"fips_utl.h"
end_include

begin_comment
comment|/* AES: encrypt and decrypt known plaintext, verify result matches original plaintext */
end_comment

begin_function
specifier|static
name|int
name|FIPS_aes_test
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
name|pltmp
index|[
literal|16
index|]
decl_stmt|;
name|unsigned
name|char
name|citmp
index|[
literal|16
index|]
decl_stmt|;
name|unsigned
name|char
name|key
index|[
literal|16
index|]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|7
block|,
literal|8
block|,
literal|9
block|,
literal|10
block|,
literal|11
block|,
literal|12
block|,
literal|13
block|,
literal|14
block|,
literal|15
block|,
literal|16
block|}
decl_stmt|;
name|unsigned
name|char
name|plaintext
index|[
literal|16
index|]
init|=
literal|"etaonrishdlcu"
decl_stmt|;
name|EVP_CIPHER_CTX
name|ctx
decl_stmt|;
name|EVP_CIPHER_CTX_init
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|EVP_CipherInit_ex
argument_list|(
operator|&
name|ctx
argument_list|,
name|EVP_aes_128_ecb
argument_list|()
argument_list|,
name|NULL
argument_list|,
name|key
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
operator|<=
literal|0
condition|)
goto|goto
name|err
goto|;
name|EVP_Cipher
argument_list|(
operator|&
name|ctx
argument_list|,
name|citmp
argument_list|,
name|plaintext
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|EVP_CipherInit_ex
argument_list|(
operator|&
name|ctx
argument_list|,
name|EVP_aes_128_ecb
argument_list|()
argument_list|,
name|NULL
argument_list|,
name|key
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|<=
literal|0
condition|)
goto|goto
name|err
goto|;
name|EVP_Cipher
argument_list|(
operator|&
name|ctx
argument_list|,
name|pltmp
argument_list|,
name|citmp
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|pltmp
argument_list|,
name|plaintext
argument_list|,
literal|16
argument_list|)
condition|)
goto|goto
name|err
goto|;
name|ret
operator|=
literal|1
expr_stmt|;
name|err
label|:
name|EVP_CIPHER_CTX_cleanup
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|FIPS_des3_test
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
name|pltmp
index|[
literal|8
index|]
decl_stmt|;
name|unsigned
name|char
name|citmp
index|[
literal|8
index|]
decl_stmt|;
name|unsigned
name|char
name|key
index|[]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|7
block|,
literal|8
block|,
literal|9
block|,
literal|10
block|,
literal|11
block|,
literal|12
block|,
literal|13
block|,
literal|14
block|,
literal|15
block|,
literal|16
block|,
literal|17
block|,
literal|18
block|,
literal|19
block|,
literal|20
block|,
literal|21
block|,
literal|22
block|,
literal|23
block|,
literal|24
block|}
decl_stmt|;
name|unsigned
name|char
name|plaintext
index|[]
init|=
block|{
literal|'e'
block|,
literal|'t'
block|,
literal|'a'
block|,
literal|'o'
block|,
literal|'n'
block|,
literal|'r'
block|,
literal|'i'
block|,
literal|'s'
block|}
decl_stmt|;
name|EVP_CIPHER_CTX
name|ctx
decl_stmt|;
name|EVP_CIPHER_CTX_init
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|EVP_CipherInit_ex
argument_list|(
operator|&
name|ctx
argument_list|,
name|EVP_des_ede3_ecb
argument_list|()
argument_list|,
name|NULL
argument_list|,
name|key
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
operator|<=
literal|0
condition|)
goto|goto
name|err
goto|;
name|EVP_Cipher
argument_list|(
operator|&
name|ctx
argument_list|,
name|citmp
argument_list|,
name|plaintext
argument_list|,
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|EVP_CipherInit_ex
argument_list|(
operator|&
name|ctx
argument_list|,
name|EVP_des_ede3_ecb
argument_list|()
argument_list|,
name|NULL
argument_list|,
name|key
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|<=
literal|0
condition|)
goto|goto
name|err
goto|;
name|EVP_Cipher
argument_list|(
operator|&
name|ctx
argument_list|,
name|pltmp
argument_list|,
name|citmp
argument_list|,
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|pltmp
argument_list|,
name|plaintext
argument_list|,
literal|8
argument_list|)
condition|)
goto|goto
name|err
goto|;
name|ret
operator|=
literal|1
expr_stmt|;
name|err
label|:
name|EVP_CIPHER_CTX_cleanup
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/*  * DSA: generate keys and sign, verify input plaintext.  */
end_comment

begin_function
specifier|static
name|int
name|FIPS_dsa_test
parameter_list|(
name|int
name|bad
parameter_list|)
block|{
name|DSA
modifier|*
name|dsa
init|=
name|NULL
decl_stmt|;
name|EVP_PKEY
name|pk
decl_stmt|;
name|unsigned
name|char
name|dgst
index|[]
init|=
literal|"etaonrishdlc"
decl_stmt|;
name|unsigned
name|char
name|buf
index|[
literal|60
index|]
decl_stmt|;
name|unsigned
name|int
name|slen
decl_stmt|;
name|int
name|r
init|=
literal|0
decl_stmt|;
name|EVP_MD_CTX
name|mctx
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
name|EVP_MD_CTX_init
argument_list|(
operator|&
name|mctx
argument_list|)
expr_stmt|;
name|dsa
operator|=
name|FIPS_dsa_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|dsa
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|DSA_generate_parameters_ex
argument_list|(
name|dsa
argument_list|,
literal|1024
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|DSA_generate_key
argument_list|(
name|dsa
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
name|bad
condition|)
name|BN_add_word
argument_list|(
name|dsa
operator|->
name|pub_key
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pk
operator|.
name|type
operator|=
name|EVP_PKEY_DSA
expr_stmt|;
name|pk
operator|.
name|pkey
operator|.
name|dsa
operator|=
name|dsa
expr_stmt|;
if|if
condition|(
operator|!
name|EVP_SignInit_ex
argument_list|(
operator|&
name|mctx
argument_list|,
name|EVP_dss1
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_SignUpdate
argument_list|(
operator|&
name|mctx
argument_list|,
name|dgst
argument_list|,
sizeof|sizeof
argument_list|(
name|dgst
argument_list|)
operator|-
literal|1
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_SignFinal
argument_list|(
operator|&
name|mctx
argument_list|,
name|buf
argument_list|,
operator|&
name|slen
argument_list|,
operator|&
name|pk
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_VerifyInit_ex
argument_list|(
operator|&
name|mctx
argument_list|,
name|EVP_dss1
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_VerifyUpdate
argument_list|(
operator|&
name|mctx
argument_list|,
name|dgst
argument_list|,
sizeof|sizeof
argument_list|(
name|dgst
argument_list|)
operator|-
literal|1
argument_list|)
condition|)
goto|goto
name|end
goto|;
name|r
operator|=
name|EVP_VerifyFinal
argument_list|(
operator|&
name|mctx
argument_list|,
name|buf
argument_list|,
name|slen
argument_list|,
operator|&
name|pk
argument_list|)
expr_stmt|;
name|end
label|:
name|EVP_MD_CTX_cleanup
argument_list|(
operator|&
name|mctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|dsa
condition|)
name|FIPS_dsa_free
argument_list|(
name|dsa
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|!=
literal|1
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * RSA: generate keys and sign, verify input plaintext.  */
end_comment

begin_function
specifier|static
name|int
name|FIPS_rsa_test
parameter_list|(
name|int
name|bad
parameter_list|)
block|{
name|RSA
modifier|*
name|key
decl_stmt|;
name|unsigned
name|char
name|input_ptext
index|[]
init|=
literal|"etaonrishdlc"
decl_stmt|;
name|unsigned
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|unsigned
name|int
name|slen
decl_stmt|;
name|BIGNUM
modifier|*
name|bn
decl_stmt|;
name|EVP_MD_CTX
name|mctx
decl_stmt|;
name|EVP_PKEY
name|pk
decl_stmt|;
name|int
name|r
init|=
literal|0
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
name|EVP_MD_CTX_init
argument_list|(
operator|&
name|mctx
argument_list|)
expr_stmt|;
name|key
operator|=
name|FIPS_rsa_new
argument_list|()
expr_stmt|;
name|bn
operator|=
name|BN_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|key
operator|||
operator|!
name|bn
condition|)
return|return
literal|0
return|;
name|BN_set_word
argument_list|(
name|bn
argument_list|,
literal|65537
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|RSA_generate_key_ex
argument_list|(
name|key
argument_list|,
literal|1024
argument_list|,
name|bn
argument_list|,
name|NULL
argument_list|)
condition|)
return|return
literal|0
return|;
name|BN_free
argument_list|(
name|bn
argument_list|)
expr_stmt|;
if|if
condition|(
name|bad
condition|)
name|BN_add_word
argument_list|(
name|key
operator|->
name|n
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pk
operator|.
name|type
operator|=
name|EVP_PKEY_RSA
expr_stmt|;
name|pk
operator|.
name|pkey
operator|.
name|rsa
operator|=
name|key
expr_stmt|;
if|if
condition|(
operator|!
name|EVP_SignInit_ex
argument_list|(
operator|&
name|mctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_SignUpdate
argument_list|(
operator|&
name|mctx
argument_list|,
name|input_ptext
argument_list|,
sizeof|sizeof
argument_list|(
name|input_ptext
argument_list|)
operator|-
literal|1
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_SignFinal
argument_list|(
operator|&
name|mctx
argument_list|,
name|buf
argument_list|,
operator|&
name|slen
argument_list|,
operator|&
name|pk
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_VerifyInit_ex
argument_list|(
operator|&
name|mctx
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
operator|!
name|EVP_VerifyUpdate
argument_list|(
operator|&
name|mctx
argument_list|,
name|input_ptext
argument_list|,
sizeof|sizeof
argument_list|(
name|input_ptext
argument_list|)
operator|-
literal|1
argument_list|)
condition|)
goto|goto
name|end
goto|;
name|r
operator|=
name|EVP_VerifyFinal
argument_list|(
operator|&
name|mctx
argument_list|,
name|buf
argument_list|,
name|slen
argument_list|,
operator|&
name|pk
argument_list|)
expr_stmt|;
name|end
label|:
name|EVP_MD_CTX_cleanup
argument_list|(
operator|&
name|mctx
argument_list|)
expr_stmt|;
if|if
condition|(
name|key
condition|)
name|FIPS_rsa_free
argument_list|(
name|key
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|!=
literal|1
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* SHA1: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_sha1_test
parameter_list|()
block|{
name|unsigned
name|char
name|digest
index|[
name|SHA_DIGEST_LENGTH
index|]
init|=
block|{
literal|0x11
block|,
literal|0xf1
block|,
literal|0x9a
block|,
literal|0x3a
block|,
literal|0xec
block|,
literal|0x1a
block|,
literal|0x1e
block|,
literal|0x8e
block|,
literal|0x65
block|,
literal|0xd4
block|,
literal|0x9a
block|,
literal|0x38
block|,
literal|0x0c
block|,
literal|0x8b
block|,
literal|0x1e
block|,
literal|0x2c
block|,
literal|0xe8
block|,
literal|0xb3
block|,
literal|0xc5
block|,
literal|0x18
block|}
decl_stmt|;
name|unsigned
name|char
name|str
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|md
index|[
name|SHA_DIGEST_LENGTH
index|]
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|EVP_Digest
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
operator|-
literal|1
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|md
argument_list|,
name|digest
argument_list|,
sizeof|sizeof
argument_list|(
name|md
argument_list|)
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* SHA256: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_sha256_test
parameter_list|()
block|{
name|unsigned
name|char
name|digest
index|[
name|SHA256_DIGEST_LENGTH
index|]
init|=
block|{
literal|0xf5
block|,
literal|0x53
block|,
literal|0xcd
block|,
literal|0xb8
block|,
literal|0xcf
block|,
literal|0x1
block|,
literal|0xee
block|,
literal|0x17
block|,
literal|0x9b
block|,
literal|0x93
block|,
literal|0xc9
block|,
literal|0x68
block|,
literal|0xc0
block|,
literal|0xea
block|,
literal|0x40
block|,
literal|0x91
block|,
literal|0x6
block|,
literal|0xec
block|,
literal|0x8e
block|,
literal|0x11
block|,
literal|0x96
block|,
literal|0xc8
block|,
literal|0x5d
block|,
literal|0x1c
block|,
literal|0xaf
block|,
literal|0x64
block|,
literal|0x22
block|,
literal|0xe6
block|,
literal|0x50
block|,
literal|0x4f
block|,
literal|0x47
block|,
literal|0x57
block|}
decl_stmt|;
name|unsigned
name|char
name|str
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|md
index|[
name|SHA256_DIGEST_LENGTH
index|]
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|EVP_Digest
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
operator|-
literal|1
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|,
name|EVP_sha256
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|md
argument_list|,
name|digest
argument_list|,
sizeof|sizeof
argument_list|(
name|md
argument_list|)
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* SHA512: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_sha512_test
parameter_list|()
block|{
name|unsigned
name|char
name|digest
index|[
name|SHA512_DIGEST_LENGTH
index|]
init|=
block|{
literal|0x99
block|,
literal|0xc9
block|,
literal|0xe9
block|,
literal|0x5b
block|,
literal|0x88
block|,
literal|0xd4
block|,
literal|0x78
block|,
literal|0x88
block|,
literal|0xdf
block|,
literal|0x88
block|,
literal|0x5f
block|,
literal|0x94
block|,
literal|0x71
block|,
literal|0x64
block|,
literal|0x28
block|,
literal|0xca
block|,
literal|0x16
block|,
literal|0x1f
block|,
literal|0x3d
block|,
literal|0xf4
block|,
literal|0x1f
block|,
literal|0xf3
block|,
literal|0x0f
block|,
literal|0xc5
block|,
literal|0x03
block|,
literal|0x99
block|,
literal|0xb2
block|,
literal|0xd0
block|,
literal|0xe7
block|,
literal|0x0b
block|,
literal|0x94
block|,
literal|0x4a
block|,
literal|0x45
block|,
literal|0xd2
block|,
literal|0x6c
block|,
literal|0x4f
block|,
literal|0x20
block|,
literal|0x06
block|,
literal|0xef
block|,
literal|0x71
block|,
literal|0xa9
block|,
literal|0x25
block|,
literal|0x7f
block|,
literal|0x24
block|,
literal|0xb1
block|,
literal|0xd9
block|,
literal|0x40
block|,
literal|0x22
block|,
literal|0x49
block|,
literal|0x54
block|,
literal|0x10
block|,
literal|0xc2
block|,
literal|0x22
block|,
literal|0x9d
block|,
literal|0x27
block|,
literal|0xfe
block|,
literal|0xbd
block|,
literal|0xd6
block|,
literal|0xd6
block|,
literal|0xeb
block|,
literal|0x2d
block|,
literal|0x42
block|,
literal|0x1d
block|,
literal|0xa3
block|}
decl_stmt|;
name|unsigned
name|char
name|str
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|md
index|[
name|SHA512_DIGEST_LENGTH
index|]
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|EVP_Digest
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
operator|-
literal|1
argument_list|,
name|md
argument_list|,
name|NULL
argument_list|,
name|EVP_sha512
argument_list|()
argument_list|,
name|NULL
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|md
argument_list|,
name|digest
argument_list|,
sizeof|sizeof
argument_list|(
name|md
argument_list|)
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* HMAC-SHA1: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_hmac_sha1_test
parameter_list|()
block|{
name|unsigned
name|char
name|key
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|iv
index|[]
init|=
literal|"Sample text"
decl_stmt|;
name|unsigned
name|char
name|kaval
index|[
name|EVP_MAX_MD_SIZE
index|]
init|=
block|{
literal|0x73
block|,
literal|0xf7
block|,
literal|0xa0
block|,
literal|0x48
block|,
literal|0xf8
block|,
literal|0x94
block|,
literal|0xed
block|,
literal|0xdd
block|,
literal|0x0a
block|,
literal|0xea
block|,
literal|0xea
block|,
literal|0x56
block|,
literal|0x1b
block|,
literal|0x61
block|,
literal|0x2e
block|,
literal|0x70
block|,
literal|0xb2
block|,
literal|0xfb
block|,
literal|0xec
block|,
literal|0xc6
block|}
decl_stmt|;
name|unsigned
name|char
name|out
index|[
name|EVP_MAX_MD_SIZE
index|]
decl_stmt|;
name|unsigned
name|int
name|outlen
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|HMAC
argument_list|(
name|EVP_sha1
argument_list|()
argument_list|,
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|key
argument_list|)
operator|-
literal|1
argument_list|,
name|iv
argument_list|,
sizeof|sizeof
argument_list|(
name|iv
argument_list|)
operator|-
literal|1
argument_list|,
name|out
argument_list|,
operator|&
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|out
argument_list|,
name|kaval
argument_list|,
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* HMAC-SHA224: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_hmac_sha224_test
parameter_list|()
block|{
name|unsigned
name|char
name|key
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|iv
index|[]
init|=
literal|"Sample text"
decl_stmt|;
name|unsigned
name|char
name|kaval
index|[
name|EVP_MAX_MD_SIZE
index|]
init|=
block|{
literal|0x75
block|,
literal|0x58
block|,
literal|0xd5
block|,
literal|0xbd
block|,
literal|0x55
block|,
literal|0x6d
block|,
literal|0x87
block|,
literal|0x0f
block|,
literal|0x75
block|,
literal|0xff
block|,
literal|0xbe
block|,
literal|0x1c
block|,
literal|0xb2
block|,
literal|0xf0
block|,
literal|0x20
block|,
literal|0x35
block|,
literal|0xe5
block|,
literal|0x62
block|,
literal|0x49
block|,
literal|0xb6
block|,
literal|0x94
block|,
literal|0xb9
block|,
literal|0xfc
block|,
literal|0x65
block|,
literal|0x34
block|,
literal|0x33
block|,
literal|0x3a
block|,
literal|0x19
block|}
decl_stmt|;
name|unsigned
name|char
name|out
index|[
name|EVP_MAX_MD_SIZE
index|]
decl_stmt|;
name|unsigned
name|int
name|outlen
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|HMAC
argument_list|(
name|EVP_sha224
argument_list|()
argument_list|,
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|key
argument_list|)
operator|-
literal|1
argument_list|,
name|iv
argument_list|,
sizeof|sizeof
argument_list|(
name|iv
argument_list|)
operator|-
literal|1
argument_list|,
name|out
argument_list|,
operator|&
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|out
argument_list|,
name|kaval
argument_list|,
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* HMAC-SHA256: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_hmac_sha256_test
parameter_list|()
block|{
name|unsigned
name|char
name|key
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|iv
index|[]
init|=
literal|"Sample text"
decl_stmt|;
name|unsigned
name|char
name|kaval
index|[
name|EVP_MAX_MD_SIZE
index|]
init|=
block|{
literal|0xe9
block|,
literal|0x17
block|,
literal|0xc1
block|,
literal|0x7b
block|,
literal|0x4c
block|,
literal|0x6b
block|,
literal|0x77
block|,
literal|0xda
block|,
literal|0xd2
block|,
literal|0x30
block|,
literal|0x36
block|,
literal|0x02
block|,
literal|0xf5
block|,
literal|0x72
block|,
literal|0x33
block|,
literal|0x87
block|,
literal|0x9f
block|,
literal|0xc6
block|,
literal|0x6e
block|,
literal|0x7b
block|,
literal|0x7e
block|,
literal|0xa8
block|,
literal|0xea
block|,
literal|0xaa
block|,
literal|0x9f
block|,
literal|0xba
block|,
literal|0xee
block|,
literal|0x51
block|,
literal|0xff
block|,
literal|0xda
block|,
literal|0x24
block|,
literal|0xf4
block|}
decl_stmt|;
name|unsigned
name|char
name|out
index|[
name|EVP_MAX_MD_SIZE
index|]
decl_stmt|;
name|unsigned
name|int
name|outlen
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|HMAC
argument_list|(
name|EVP_sha256
argument_list|()
argument_list|,
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|key
argument_list|)
operator|-
literal|1
argument_list|,
name|iv
argument_list|,
sizeof|sizeof
argument_list|(
name|iv
argument_list|)
operator|-
literal|1
argument_list|,
name|out
argument_list|,
operator|&
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|out
argument_list|,
name|kaval
argument_list|,
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* HMAC-SHA384: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_hmac_sha384_test
parameter_list|()
block|{
name|unsigned
name|char
name|key
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|iv
index|[]
init|=
literal|"Sample text"
decl_stmt|;
name|unsigned
name|char
name|kaval
index|[
name|EVP_MAX_MD_SIZE
index|]
init|=
block|{
literal|0xb2
block|,
literal|0x9d
block|,
literal|0x40
block|,
literal|0x58
block|,
literal|0x32
block|,
literal|0xc4
block|,
literal|0xe3
block|,
literal|0x31
block|,
literal|0xb6
block|,
literal|0x63
block|,
literal|0x08
block|,
literal|0x26
block|,
literal|0x99
block|,
literal|0xef
block|,
literal|0x3b
block|,
literal|0x10
block|,
literal|0xe2
block|,
literal|0xdf
block|,
literal|0xf8
block|,
literal|0xff
block|,
literal|0xc6
block|,
literal|0xe1
block|,
literal|0x03
block|,
literal|0x29
block|,
literal|0x81
block|,
literal|0x2a
block|,
literal|0x1b
block|,
literal|0xac
block|,
literal|0xb0
block|,
literal|0x07
block|,
literal|0x39
block|,
literal|0x08
block|,
literal|0xf3
block|,
literal|0x91
block|,
literal|0x35
block|,
literal|0x11
block|,
literal|0x76
block|,
literal|0xd6
block|,
literal|0x4c
block|,
literal|0x20
block|,
literal|0xfb
block|,
literal|0x4d
block|,
literal|0xc3
block|,
literal|0xf3
block|,
literal|0xb8
block|,
literal|0x9b
block|,
literal|0x88
block|,
literal|0x1c
block|}
decl_stmt|;
name|unsigned
name|char
name|out
index|[
name|EVP_MAX_MD_SIZE
index|]
decl_stmt|;
name|unsigned
name|int
name|outlen
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|HMAC
argument_list|(
name|EVP_sha384
argument_list|()
argument_list|,
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|key
argument_list|)
operator|-
literal|1
argument_list|,
name|iv
argument_list|,
sizeof|sizeof
argument_list|(
name|iv
argument_list|)
operator|-
literal|1
argument_list|,
name|out
argument_list|,
operator|&
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|out
argument_list|,
name|kaval
argument_list|,
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* HMAC-SHA512: generate hash of known digest value and compare to known    precomputed correct hash */
end_comment

begin_function
specifier|static
name|int
name|FIPS_hmac_sha512_test
parameter_list|()
block|{
name|unsigned
name|char
name|key
index|[]
init|=
literal|"etaonrishd"
decl_stmt|;
name|unsigned
name|char
name|iv
index|[]
init|=
literal|"Sample text"
decl_stmt|;
name|unsigned
name|char
name|kaval
index|[
name|EVP_MAX_MD_SIZE
index|]
init|=
block|{
literal|0xcd
block|,
literal|0x3e
block|,
literal|0xb9
block|,
literal|0x51
block|,
literal|0xb8
block|,
literal|0xbc
block|,
literal|0x7f
block|,
literal|0x9a
block|,
literal|0x23
block|,
literal|0xaf
block|,
literal|0xf3
block|,
literal|0x77
block|,
literal|0x59
block|,
literal|0x85
block|,
literal|0xa9
block|,
literal|0xe6
block|,
literal|0xf7
block|,
literal|0xd1
block|,
literal|0x51
block|,
literal|0x96
block|,
literal|0x17
block|,
literal|0xe0
block|,
literal|0x92
block|,
literal|0xd8
block|,
literal|0xa6
block|,
literal|0x3b
block|,
literal|0xc1
block|,
literal|0xad
block|,
literal|0x7e
block|,
literal|0x24
block|,
literal|0xca
block|,
literal|0xb1
block|,
literal|0xd7
block|,
literal|0x79
block|,
literal|0x0a
block|,
literal|0xa5
block|,
literal|0xea
block|,
literal|0x2c
block|,
literal|0x02
block|,
literal|0x58
block|,
literal|0x0b
block|,
literal|0xa6
block|,
literal|0x52
block|,
literal|0x6b
block|,
literal|0x61
block|,
literal|0x7f
block|,
literal|0xeb
block|,
literal|0x9c
block|,
literal|0x47
block|,
literal|0x86
block|,
literal|0x5d
block|,
literal|0x74
block|,
literal|0x2b
block|,
literal|0x88
block|,
literal|0xdf
block|,
literal|0xee
block|,
literal|0x46
block|,
literal|0x69
block|,
literal|0x96
block|,
literal|0x3d
block|,
literal|0xa6
block|,
literal|0xd9
block|,
literal|0x2a
block|,
literal|0x53
block|}
decl_stmt|;
name|unsigned
name|char
name|out
index|[
name|EVP_MAX_MD_SIZE
index|]
decl_stmt|;
name|unsigned
name|int
name|outlen
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|HMAC
argument_list|(
name|EVP_sha512
argument_list|()
argument_list|,
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|key
argument_list|)
operator|-
literal|1
argument_list|,
name|iv
argument_list|,
sizeof|sizeof
argument_list|(
name|iv
argument_list|)
operator|-
literal|1
argument_list|,
name|out
argument_list|,
operator|&
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|memcmp
argument_list|(
name|out
argument_list|,
name|kaval
argument_list|,
name|outlen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* DH: generate shared parameters */
end_comment

begin_function
specifier|static
name|int
name|dh_test
parameter_list|()
block|{
name|DH
modifier|*
name|dh
decl_stmt|;
name|ERR_clear_error
argument_list|()
expr_stmt|;
name|dh
operator|=
name|FIPS_dh_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|dh
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|DH_generate_parameters_ex
argument_list|(
name|dh
argument_list|,
literal|1024
argument_list|,
literal|2
argument_list|,
name|NULL
argument_list|)
condition|)
return|return
literal|0
return|;
name|FIPS_dh_free
argument_list|(
name|dh
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* Zeroize */
end_comment

begin_function
specifier|static
name|int
name|Zeroize
parameter_list|()
block|{
name|RSA
modifier|*
name|key
decl_stmt|;
name|BIGNUM
modifier|*
name|bn
decl_stmt|;
name|unsigned
name|char
name|userkey
index|[
literal|16
index|]
init|=
block|{
literal|0x48
block|,
literal|0x50
block|,
literal|0xf0
block|,
literal|0xa3
block|,
literal|0x3a
block|,
literal|0xed
block|,
literal|0xd3
block|,
literal|0xaf
block|,
literal|0x6e
block|,
literal|0x47
block|,
literal|0x7f
block|,
literal|0x83
block|,
literal|0x02
block|,
literal|0xb1
block|,
literal|0x09
block|,
literal|0x68
block|}
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|int
name|n
decl_stmt|;
name|key
operator|=
name|FIPS_rsa_new
argument_list|()
expr_stmt|;
name|bn
operator|=
name|BN_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|key
operator|||
operator|!
name|bn
condition|)
return|return
literal|0
return|;
name|BN_set_word
argument_list|(
name|bn
argument_list|,
literal|65537
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|RSA_generate_key_ex
argument_list|(
name|key
argument_list|,
literal|1024
argument_list|,
name|bn
argument_list|,
name|NULL
argument_list|)
condition|)
return|return
literal|0
return|;
name|BN_free
argument_list|(
name|bn
argument_list|)
expr_stmt|;
name|n
operator|=
name|BN_num_bytes
argument_list|(
name|key
operator|->
name|d
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" Generated %d byte RSA private key\n"
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tBN key before overwriting:\n"
argument_list|)
expr_stmt|;
name|do_bn_print
argument_list|(
name|stdout
argument_list|,
name|key
operator|->
name|d
argument_list|)
expr_stmt|;
name|BN_rand
argument_list|(
name|key
operator|->
name|d
argument_list|,
name|n
operator|*
literal|8
argument_list|,
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tBN key after overwriting:\n"
argument_list|)
expr_stmt|;
name|do_bn_print
argument_list|(
name|stdout
argument_list|,
name|key
operator|->
name|d
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tchar buffer key before overwriting: \n\t\t"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|userkey
argument_list|)
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
name|userkey
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|RAND_bytes
argument_list|(
name|userkey
argument_list|,
sizeof|sizeof
name|userkey
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tchar buffer key after overwriting: \n\t\t"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|userkey
argument_list|)
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
name|userkey
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|Error
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|Fail
parameter_list|(
specifier|const
name|char
modifier|*
name|msg
parameter_list|)
block|{
name|do_print_errors
argument_list|()
expr_stmt|;
name|Error
operator|++
expr_stmt|;
return|return
name|msg
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_msg
parameter_list|(
specifier|const
name|char
modifier|*
name|msg
parameter_list|,
name|int
name|result
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s...%s\n"
argument_list|,
name|msg
argument_list|,
name|result
condition|?
literal|"successful"
else|:
name|Fail
argument_list|(
literal|"Failed!"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|do_corrupt_rsa_keygen
init|=
literal|0
decl_stmt|,
name|do_corrupt_dsa_keygen
init|=
literal|0
decl_stmt|;
name|int
name|bad_rsa
init|=
literal|0
decl_stmt|,
name|bad_dsa
init|=
literal|0
decl_stmt|;
name|int
name|do_rng_stick
init|=
literal|0
decl_stmt|;
name|int
name|no_exit
init|=
literal|0
decl_stmt|;
name|printf
argument_list|(
literal|"\tFIPS-mode test application\n\n"
argument_list|)
expr_stmt|;
comment|/* Load entropy from external file, if any */
name|RAND_load_file
argument_list|(
literal|".rnd"
argument_list|,
literal|1024
argument_list|)
expr_stmt|;
if|if
condition|(
name|argv
index|[
literal|1
index|]
condition|)
block|{
comment|/* Corrupted KAT tests */
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"aes"
argument_list|)
condition|)
block|{
name|FIPS_corrupt_aes
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"AES encryption/decryption with corrupted KAT...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"des"
argument_list|)
condition|)
block|{
name|FIPS_corrupt_des
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"DES3-ECB encryption/decryption with corrupted KAT...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"dsa"
argument_list|)
condition|)
block|{
name|FIPS_corrupt_dsa
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"DSA key generation and signature validation with corrupted KAT...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rsa"
argument_list|)
condition|)
block|{
name|FIPS_corrupt_rsa
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"RSA key generation and signature validation with corrupted KAT...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rsakey"
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"RSA key generation and signature validation with corrupted key...\n"
argument_list|)
expr_stmt|;
name|bad_rsa
operator|=
literal|1
expr_stmt|;
name|no_exit
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rsakeygen"
argument_list|)
condition|)
block|{
name|do_corrupt_rsa_keygen
operator|=
literal|1
expr_stmt|;
name|no_exit
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"RSA key generation and signature validation with corrupted keygen...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"dsakey"
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"DSA key generation and signature validation with corrupted key...\n"
argument_list|)
expr_stmt|;
name|bad_dsa
operator|=
literal|1
expr_stmt|;
name|no_exit
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"dsakeygen"
argument_list|)
condition|)
block|{
name|do_corrupt_dsa_keygen
operator|=
literal|1
expr_stmt|;
name|no_exit
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"DSA key generation and signature validation with corrupted keygen...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"sha1"
argument_list|)
condition|)
block|{
name|FIPS_corrupt_sha1
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"SHA-1 hash with corrupted KAT...\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rng"
argument_list|)
condition|)
block|{
name|FIPS_corrupt_rng
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rngstick"
argument_list|)
condition|)
block|{
name|do_rng_stick
operator|=
literal|1
expr_stmt|;
name|no_exit
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"RNG test with stuck continuous test...\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"Bad argument \"%s\"\n"
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|no_exit
condition|)
block|{
if|if
condition|(
operator|!
name|FIPS_mode_set
argument_list|(
literal|1
argument_list|)
condition|)
block|{
name|do_print_errors
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"Power-up self test failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"Power-up self test successful\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Non-Approved cryptographic operation     */
name|printf
argument_list|(
literal|"1. Non-Approved cryptographic operation test...\n"
argument_list|)
expr_stmt|;
name|test_msg
argument_list|(
literal|"\ta. Included algorithm (D-H)..."
argument_list|,
name|dh_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* Power-up self test     */
name|ERR_clear_error
argument_list|()
expr_stmt|;
name|test_msg
argument_list|(
literal|"2. Automatic power-up self test"
argument_list|,
name|FIPS_mode_set
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FIPS_mode
argument_list|()
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_corrupt_dsa_keygen
condition|)
name|FIPS_corrupt_dsa_keygen
argument_list|()
expr_stmt|;
if|if
condition|(
name|do_corrupt_rsa_keygen
condition|)
name|FIPS_corrupt_rsa_keygen
argument_list|()
expr_stmt|;
if|if
condition|(
name|do_rng_stick
condition|)
name|FIPS_rng_stick
argument_list|()
expr_stmt|;
comment|/* AES encryption/decryption     */
name|test_msg
argument_list|(
literal|"3. AES encryption/decryption"
argument_list|,
name|FIPS_aes_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* RSA key generation and encryption/decryption     */
name|test_msg
argument_list|(
literal|"4. RSA key generation and encryption/decryption"
argument_list|,
name|FIPS_rsa_test
argument_list|(
name|bad_rsa
argument_list|)
argument_list|)
expr_stmt|;
comment|/* DES-CBC encryption/decryption     */
name|test_msg
argument_list|(
literal|"5. DES-ECB encryption/decryption"
argument_list|,
name|FIPS_des3_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* DSA key generation and signature validation     */
name|test_msg
argument_list|(
literal|"6. DSA key generation and signature validation"
argument_list|,
name|FIPS_dsa_test
argument_list|(
name|bad_dsa
argument_list|)
argument_list|)
expr_stmt|;
comment|/* SHA-1 hash     */
name|test_msg
argument_list|(
literal|"7a. SHA-1 hash"
argument_list|,
name|FIPS_sha1_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* SHA-256 hash     */
name|test_msg
argument_list|(
literal|"7b. SHA-256 hash"
argument_list|,
name|FIPS_sha256_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* SHA-512 hash     */
name|test_msg
argument_list|(
literal|"7c. SHA-512 hash"
argument_list|,
name|FIPS_sha512_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* HMAC-SHA-1 hash     */
name|test_msg
argument_list|(
literal|"7d. HMAC-SHA-1 hash"
argument_list|,
name|FIPS_hmac_sha1_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* HMAC-SHA-224 hash     */
name|test_msg
argument_list|(
literal|"7e. HMAC-SHA-224 hash"
argument_list|,
name|FIPS_hmac_sha224_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* HMAC-SHA-256 hash     */
name|test_msg
argument_list|(
literal|"7f. HMAC-SHA-256 hash"
argument_list|,
name|FIPS_hmac_sha256_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* HMAC-SHA-384 hash     */
name|test_msg
argument_list|(
literal|"7g. HMAC-SHA-384 hash"
argument_list|,
name|FIPS_hmac_sha384_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* HMAC-SHA-512 hash     */
name|test_msg
argument_list|(
literal|"7h. HMAC-SHA-512 hash"
argument_list|,
name|FIPS_hmac_sha512_test
argument_list|()
argument_list|)
expr_stmt|;
comment|/* Non-Approved cryptographic operation     */
name|printf
argument_list|(
literal|"8. Non-Approved cryptographic operation test...\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\ta. Included algorithm (D-H)...%s\n"
argument_list|,
name|dh_test
argument_list|()
condition|?
literal|"successful as expected"
else|:
name|Fail
argument_list|(
literal|"failed INCORRECTLY!"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Zeroization     */
name|printf
argument_list|(
literal|"9. Zero-ization...\n\t%s\n"
argument_list|,
name|Zeroize
argument_list|()
condition|?
literal|"successful as expected"
else|:
name|Fail
argument_list|(
literal|"failed INCORRECTLY!"
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAll tests completed with %d errors\n"
argument_list|,
name|Error
argument_list|)
expr_stmt|;
return|return
name|Error
condition|?
literal|1
else|:
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

