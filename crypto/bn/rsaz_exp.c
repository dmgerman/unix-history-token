begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/***************************************************************************** *                                                                            * *  Copyright (c) 2012, Intel Corporation                                     * *                                                                            * *  All rights reserved.                                                      * *                                                                            * *  Redistribution and use in source and binary forms, with or without        * *  modification, are permitted provided that the following conditions are    * *  met:                                                                      * *                                                                            * *  *  Redistributions of source code must retain the above copyright         * *     notice, this list of conditions and the following disclaimer.          * *                                                                            * *  *  Redistributions in binary form must reproduce the above copyright      * *     notice, this list of conditions and the following disclaimer in the    * *     documentation and/or other materials provided with the                 * *     distribution.                                                          * *                                                                            * *  *  Neither the name of the Intel Corporation nor the names of its         * *     contributors may be used to endorse or promote products derived from   * *     this software without specific prior written permission.               * *                                                                            * *                                                                            * *  THIS SOFTWARE IS PROVIDED BY INTEL CORPORATION ""AS IS"" AND ANY          * *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE         * *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR        * *  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL CORPORATION OR            * *  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,     * *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,       * *  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR        * *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF    * *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING      * *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS        * *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.              * *                                                                            * ****************************************************************************** * Developers and authors:                                                    * * Shay Gueron (1, 2), and Vlad Krasnov (1)                                   * * (1) Intel Corporation, Israel Development Center, Haifa, Israel            * * (2) University of Haifa, Israel                                            * *****************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"rsaz_exp.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|RSAZ_ENABLED
end_ifdef

begin_comment
comment|/*  * See crypto/bn/asm/rsaz-avx2.pl for further details.  */
end_comment

begin_function_decl
name|void
name|rsaz_1024_norm2red_avx2
parameter_list|(
name|void
modifier|*
name|red
parameter_list|,
specifier|const
name|void
modifier|*
name|norm
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_1024_mul_avx2
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_1024_sqr_avx2
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|,
name|int
name|cnt
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_1024_scatter5_avx2
parameter_list|(
name|void
modifier|*
name|tbl
parameter_list|,
specifier|const
name|void
modifier|*
name|val
parameter_list|,
name|int
name|i
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_1024_gather5_avx2
parameter_list|(
name|void
modifier|*
name|val
parameter_list|,
specifier|const
name|void
modifier|*
name|tbl
parameter_list|,
name|int
name|i
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_1024_red2norm_avx2
parameter_list|(
name|void
modifier|*
name|norm
parameter_list|,
specifier|const
name|void
modifier|*
name|red
parameter_list|)
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__GNUC__
argument_list|)
end_if

begin_define
define|#
directive|define
name|ALIGN64
value|__attribute__((aligned(64)))
end_define

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|_MSC_VER
argument_list|)
end_elif

begin_define
define|#
directive|define
name|ALIGN64
value|__declspec(align(64))
end_define

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|__SUNPRO_C
argument_list|)
end_elif

begin_define
define|#
directive|define
name|ALIGN64
end_define

begin_pragma
pragma|#
directive|pragma
name|align
name|64
name|(
name|one
name|,
name|two80
name|)
end_pragma

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* not fatal, might hurt performance a little */
end_comment

begin_define
define|#
directive|define
name|ALIGN64
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|ALIGN64
specifier|static
specifier|const
name|BN_ULONG
name|one
index|[
literal|40
index|]
init|=
block|{
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|ALIGN64
specifier|static
specifier|const
name|BN_ULONG
name|two80
index|[
literal|40
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|1
operator|<<
literal|22
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|RSAZ_1024_mod_exp_avx2
parameter_list|(
name|BN_ULONG
name|result_norm
index|[
literal|16
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|base_norm
index|[
literal|16
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|exponent
index|[
literal|16
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|m_norm
index|[
literal|16
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|RR
index|[
literal|16
index|]
parameter_list|,
name|BN_ULONG
name|k0
parameter_list|)
block|{
name|unsigned
name|char
name|storage
index|[
literal|320
operator|*
literal|3
operator|+
literal|32
operator|*
literal|9
operator|*
literal|16
operator|+
literal|64
index|]
decl_stmt|;
comment|/* 5.5KB */
name|unsigned
name|char
modifier|*
name|p_str
init|=
name|storage
operator|+
operator|(
literal|64
operator|-
operator|(
operator|(
name|size_t
operator|)
name|storage
operator|%
literal|64
operator|)
operator|)
decl_stmt|;
name|unsigned
name|char
modifier|*
name|a_inv
decl_stmt|,
modifier|*
name|m
decl_stmt|,
modifier|*
name|result
decl_stmt|;
name|unsigned
name|char
modifier|*
name|table_s
init|=
name|p_str
operator|+
literal|320
operator|*
literal|3
decl_stmt|;
name|unsigned
name|char
modifier|*
name|R2
init|=
name|table_s
decl_stmt|;
comment|/* borrow */
name|int
name|index
decl_stmt|;
name|int
name|wvalue
decl_stmt|;
if|if
condition|(
operator|(
operator|(
operator|(
name|size_t
operator|)
name|p_str
operator|&
literal|4095
operator|)
operator|+
literal|320
operator|)
operator|>>
literal|12
condition|)
block|{
name|result
operator|=
name|p_str
expr_stmt|;
name|a_inv
operator|=
name|p_str
operator|+
literal|320
expr_stmt|;
name|m
operator|=
name|p_str
operator|+
literal|320
operator|*
literal|2
expr_stmt|;
comment|/* should not cross page */
block|}
else|else
block|{
name|m
operator|=
name|p_str
expr_stmt|;
comment|/* should not cross page */
name|result
operator|=
name|p_str
operator|+
literal|320
expr_stmt|;
name|a_inv
operator|=
name|p_str
operator|+
literal|320
operator|*
literal|2
expr_stmt|;
block|}
name|rsaz_1024_norm2red_avx2
argument_list|(
name|m
argument_list|,
name|m_norm
argument_list|)
expr_stmt|;
name|rsaz_1024_norm2red_avx2
argument_list|(
name|a_inv
argument_list|,
name|base_norm
argument_list|)
expr_stmt|;
name|rsaz_1024_norm2red_avx2
argument_list|(
name|R2
argument_list|,
name|RR
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|R2
argument_list|,
name|R2
argument_list|,
name|R2
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|R2
argument_list|,
name|R2
argument_list|,
name|two80
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
comment|/* table[0] = 1 */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|R2
argument_list|,
name|one
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
comment|/* table[1] = a_inv^1 */
name|rsaz_1024_mul_avx2
argument_list|(
name|a_inv
argument_list|,
name|a_inv
argument_list|,
name|R2
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|a_inv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* table[2] = a_inv^2 */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* this is almost 2x smaller and less than 1% slower */
block|for (index = 3; index< 32; index++) {         rsaz_1024_mul_avx2(result, result, a_inv, m, k0);         rsaz_1024_scatter5_avx2(table_s, result, index);     }
else|#
directive|else
comment|/* table[4] = a_inv^4 */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|/* table[8] = a_inv^8 */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* table[16] = a_inv^16 */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|16
argument_list|)
expr_stmt|;
comment|/* table[17] = a_inv^17 */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|17
argument_list|)
expr_stmt|;
comment|/* table[3] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|/* table[6] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|6
argument_list|)
expr_stmt|;
comment|/* table[12] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|12
argument_list|)
expr_stmt|;
comment|/* table[24] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|24
argument_list|)
expr_stmt|;
comment|/* table[25] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|25
argument_list|)
expr_stmt|;
comment|/* table[5] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* table[10] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|10
argument_list|)
expr_stmt|;
comment|/* table[20] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|20
argument_list|)
expr_stmt|;
comment|/* table[21] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|21
argument_list|)
expr_stmt|;
comment|/* table[7] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|7
argument_list|)
expr_stmt|;
comment|/* table[14] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|14
argument_list|)
expr_stmt|;
comment|/* table[28] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|28
argument_list|)
expr_stmt|;
comment|/* table[29] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|29
argument_list|)
expr_stmt|;
comment|/* table[9] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|9
argument_list|)
expr_stmt|;
comment|/* table[18] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|18
argument_list|)
expr_stmt|;
comment|/* table[19] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|19
argument_list|)
expr_stmt|;
comment|/* table[11] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|11
argument_list|)
expr_stmt|;
comment|/* table[22] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|22
argument_list|)
expr_stmt|;
comment|/* table[23] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|23
argument_list|)
expr_stmt|;
comment|/* table[13] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|13
argument_list|)
expr_stmt|;
comment|/* table[26] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|26
argument_list|)
expr_stmt|;
comment|/* table[27] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|27
argument_list|)
expr_stmt|;
comment|/* table[15] */
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|15
argument_list|)
expr_stmt|;
comment|/* table[30] */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|30
argument_list|)
expr_stmt|;
comment|/* table[31] */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_scatter5_avx2
argument_list|(
name|table_s
argument_list|,
name|result
argument_list|,
literal|31
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* load first window */
name|p_str
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|exponent
expr_stmt|;
name|wvalue
operator|=
name|p_str
index|[
literal|127
index|]
operator|>>
literal|3
expr_stmt|;
name|rsaz_1024_gather5_avx2
argument_list|(
name|result
argument_list|,
name|table_s
argument_list|,
name|wvalue
argument_list|)
expr_stmt|;
name|index
operator|=
literal|1014
expr_stmt|;
while|while
condition|(
name|index
operator|>
operator|-
literal|1
condition|)
block|{
comment|/* loop for the remaining 127 windows */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|wvalue
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|short
operator|*
operator|)
operator|&
name|p_str
index|[
name|index
operator|/
literal|8
index|]
operator|)
expr_stmt|;
name|wvalue
operator|=
operator|(
name|wvalue
operator|>>
operator|(
name|index
operator|%
literal|8
operator|)
operator|)
operator|&
literal|31
expr_stmt|;
name|index
operator|-=
literal|5
expr_stmt|;
name|rsaz_1024_gather5_avx2
argument_list|(
name|a_inv
argument_list|,
name|table_s
argument_list|,
name|wvalue
argument_list|)
expr_stmt|;
comment|/* borrow a_inv */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
block|}
comment|/* square four times */
name|rsaz_1024_sqr_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|wvalue
operator|=
name|p_str
index|[
literal|0
index|]
operator|&
literal|15
expr_stmt|;
name|rsaz_1024_gather5_avx2
argument_list|(
name|a_inv
argument_list|,
name|table_s
argument_list|,
name|wvalue
argument_list|)
expr_stmt|;
comment|/* borrow a_inv */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
comment|/* from Montgomery */
name|rsaz_1024_mul_avx2
argument_list|(
name|result
argument_list|,
name|result
argument_list|,
name|one
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_1024_red2norm_avx2
argument_list|(
name|result_norm
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|OPENSSL_cleanse
argument_list|(
name|storage
argument_list|,
sizeof|sizeof
argument_list|(
name|storage
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * See crypto/bn/rsaz-x86_64.pl for further details.  */
end_comment

begin_function_decl
name|void
name|rsaz_512_mul
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_512_mul_scatter4
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|,
specifier|const
name|void
modifier|*
name|tbl
parameter_list|,
name|unsigned
name|int
name|power
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_512_mul_gather4
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|tbl
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|,
name|unsigned
name|int
name|power
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_512_mul_by_one
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_512_sqr
parameter_list|(
name|void
modifier|*
name|ret
parameter_list|,
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|n
parameter_list|,
name|BN_ULONG
name|k
parameter_list|,
name|int
name|cnt
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_512_scatter4
parameter_list|(
name|void
modifier|*
name|tbl
parameter_list|,
specifier|const
name|BN_ULONG
modifier|*
name|val
parameter_list|,
name|int
name|power
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|rsaz_512_gather4
parameter_list|(
name|BN_ULONG
modifier|*
name|val
parameter_list|,
specifier|const
name|void
modifier|*
name|tbl
parameter_list|,
name|int
name|power
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|RSAZ_512_mod_exp
parameter_list|(
name|BN_ULONG
name|result
index|[
literal|8
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|base
index|[
literal|8
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|exponent
index|[
literal|8
index|]
parameter_list|,
specifier|const
name|BN_ULONG
name|m
index|[
literal|8
index|]
parameter_list|,
name|BN_ULONG
name|k0
parameter_list|,
specifier|const
name|BN_ULONG
name|RR
index|[
literal|8
index|]
parameter_list|)
block|{
name|unsigned
name|char
name|storage
index|[
literal|16
operator|*
literal|8
operator|*
literal|8
operator|+
literal|64
operator|*
literal|2
operator|+
literal|64
index|]
decl_stmt|;
comment|/* 1.2KB */
name|unsigned
name|char
modifier|*
name|table
init|=
name|storage
operator|+
operator|(
literal|64
operator|-
operator|(
operator|(
name|size_t
operator|)
name|storage
operator|%
literal|64
operator|)
operator|)
decl_stmt|;
name|BN_ULONG
modifier|*
name|a_inv
init|=
operator|(
name|BN_ULONG
operator|*
operator|)
operator|(
name|table
operator|+
literal|16
operator|*
literal|8
operator|*
literal|8
operator|)
decl_stmt|;
name|BN_ULONG
modifier|*
name|temp
init|=
operator|(
name|BN_ULONG
operator|*
operator|)
operator|(
name|table
operator|+
literal|16
operator|*
literal|8
operator|*
literal|8
operator|+
literal|8
operator|*
literal|8
operator|)
decl_stmt|;
name|unsigned
name|char
modifier|*
name|p_str
init|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|exponent
decl_stmt|;
name|int
name|index
decl_stmt|;
name|unsigned
name|int
name|wvalue
decl_stmt|;
comment|/* table[0] = 1_inv */
name|temp
index|[
literal|0
index|]
operator|=
literal|0
operator|-
name|m
index|[
literal|0
index|]
expr_stmt|;
name|temp
index|[
literal|1
index|]
operator|=
operator|~
name|m
index|[
literal|1
index|]
expr_stmt|;
name|temp
index|[
literal|2
index|]
operator|=
operator|~
name|m
index|[
literal|2
index|]
expr_stmt|;
name|temp
index|[
literal|3
index|]
operator|=
operator|~
name|m
index|[
literal|3
index|]
expr_stmt|;
name|temp
index|[
literal|4
index|]
operator|=
operator|~
name|m
index|[
literal|4
index|]
expr_stmt|;
name|temp
index|[
literal|5
index|]
operator|=
operator|~
name|m
index|[
literal|5
index|]
expr_stmt|;
name|temp
index|[
literal|6
index|]
operator|=
operator|~
name|m
index|[
literal|6
index|]
expr_stmt|;
name|temp
index|[
literal|7
index|]
operator|=
operator|~
name|m
index|[
literal|7
index|]
expr_stmt|;
name|rsaz_512_scatter4
argument_list|(
name|table
argument_list|,
name|temp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* table [1] = a_inv^1 */
name|rsaz_512_mul
argument_list|(
name|a_inv
argument_list|,
name|base
argument_list|,
name|RR
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|rsaz_512_scatter4
argument_list|(
name|table
argument_list|,
name|a_inv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* table [2] = a_inv^2 */
name|rsaz_512_sqr
argument_list|(
name|temp
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rsaz_512_scatter4
argument_list|(
name|table
argument_list|,
name|temp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|index
operator|=
literal|3
init|;
name|index
operator|<
literal|16
condition|;
name|index
operator|++
control|)
name|rsaz_512_mul_scatter4
argument_list|(
name|temp
argument_list|,
name|a_inv
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
name|table
argument_list|,
name|index
argument_list|)
expr_stmt|;
comment|/* load first window */
name|wvalue
operator|=
name|p_str
index|[
literal|63
index|]
expr_stmt|;
name|rsaz_512_gather4
argument_list|(
name|temp
argument_list|,
name|table
argument_list|,
name|wvalue
operator|>>
literal|4
argument_list|)
expr_stmt|;
name|rsaz_512_sqr
argument_list|(
name|temp
argument_list|,
name|temp
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|rsaz_512_mul_gather4
argument_list|(
name|temp
argument_list|,
name|temp
argument_list|,
name|table
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
name|wvalue
operator|&
literal|0xf
argument_list|)
expr_stmt|;
for|for
control|(
name|index
operator|=
literal|62
init|;
name|index
operator|>=
literal|0
condition|;
name|index
operator|--
control|)
block|{
name|wvalue
operator|=
name|p_str
index|[
name|index
index|]
expr_stmt|;
name|rsaz_512_sqr
argument_list|(
name|temp
argument_list|,
name|temp
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|rsaz_512_mul_gather4
argument_list|(
name|temp
argument_list|,
name|temp
argument_list|,
name|table
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
name|wvalue
operator|>>
literal|4
argument_list|)
expr_stmt|;
name|rsaz_512_sqr
argument_list|(
name|temp
argument_list|,
name|temp
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|rsaz_512_mul_gather4
argument_list|(
name|temp
argument_list|,
name|temp
argument_list|,
name|table
argument_list|,
name|m
argument_list|,
name|k0
argument_list|,
name|wvalue
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
block|}
comment|/* from Montgomery */
name|rsaz_512_mul_by_one
argument_list|(
name|result
argument_list|,
name|temp
argument_list|,
name|m
argument_list|,
name|k0
argument_list|)
expr_stmt|;
name|OPENSSL_cleanse
argument_list|(
name|storage
argument_list|,
sizeof|sizeof
argument_list|(
name|storage
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_if
if|#
directive|if
name|defined
argument_list|(
name|PEDANTIC
argument_list|)
operator|||
name|defined
argument_list|(
name|__DECC
argument_list|)
operator|||
name|defined
argument_list|(
name|__clang__
argument_list|)
end_if

begin_decl_stmt
specifier|static
name|void
modifier|*
name|dummy
init|=
operator|&
name|dummy
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

end_unit

