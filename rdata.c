begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * rdata.c  *  * rdata implementation  *  * a Net::DNS like library for C  *  * (c) NLnet Labs, 2004-2006  *  * See the file LICENSE for the license  */
end_comment

begin_include
include|#
directive|include
file|<ldns/config.h>
end_include

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_comment
comment|/*  * Access functions   * do this as functions to get type checking  */
end_comment

begin_comment
comment|/* read */
end_comment

begin_function
name|size_t
name|ldns_rdf_size
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
name|rd
operator|->
name|_size
return|;
block|}
end_function

begin_function
name|ldns_rdf_type
name|ldns_rdf_get_type
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
name|rd
operator|->
name|_type
return|;
block|}
end_function

begin_function
name|uint8_t
modifier|*
name|ldns_rdf_data
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
name|rd
operator|->
name|_data
return|;
block|}
end_function

begin_comment
comment|/* write */
end_comment

begin_function
name|void
name|ldns_rdf_set_size
parameter_list|(
name|ldns_rdf
modifier|*
name|rd
parameter_list|,
name|size_t
name|size
parameter_list|)
block|{
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|rd
operator|->
name|_size
operator|=
name|size
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rdf_set_type
parameter_list|(
name|ldns_rdf
modifier|*
name|rd
parameter_list|,
name|ldns_rdf_type
name|type
parameter_list|)
block|{
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|rd
operator|->
name|_type
operator|=
name|type
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rdf_set_data
parameter_list|(
name|ldns_rdf
modifier|*
name|rd
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
comment|/* only copy the pointer */
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|rd
operator|->
name|_data
operator|=
name|data
expr_stmt|;
block|}
end_function

begin_comment
comment|/* for types that allow it, return  * the native/host order type */
end_comment

begin_function
name|uint8_t
name|ldns_rdf2native_int8
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|uint8_t
name|data
decl_stmt|;
comment|/* only allow 8 bit rdfs */
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_SIZE_BYTE
condition|)
block|{
return|return
literal|0
return|;
block|}
name|memcpy
argument_list|(
operator|&
name|data
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|data
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_rdf2native_int16
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|uint16_t
name|data
decl_stmt|;
comment|/* only allow 16 bit rdfs */
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_SIZE_WORD
condition|)
block|{
return|return
literal|0
return|;
block|}
name|memcpy
argument_list|(
operator|&
name|data
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ntohs
argument_list|(
name|data
argument_list|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_rdf2native_int32
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|uint32_t
name|data
decl_stmt|;
comment|/* only allow 32 bit rdfs */
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_SIZE_DOUBLEWORD
condition|)
block|{
return|return
literal|0
return|;
block|}
name|memcpy
argument_list|(
operator|&
name|data
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ntohl
argument_list|(
name|data
argument_list|)
return|;
block|}
end_function

begin_function
name|time_t
name|ldns_rdf2native_time_t
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|uint32_t
name|data
decl_stmt|;
comment|/* only allow 32 bit rdfs */
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_SIZE_DOUBLEWORD
operator|||
name|ldns_rdf_get_type
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_TYPE_TIME
condition|)
block|{
return|return
literal|0
return|;
block|}
name|memcpy
argument_list|(
operator|&
name|data
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|time_t
operator|)
name|ntohl
argument_list|(
name|data
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_native2rdf_int8
parameter_list|(
name|ldns_rdf_type
name|type
parameter_list|,
name|uint8_t
name|value
parameter_list|)
block|{
return|return
name|ldns_rdf_new_frm_data
argument_list|(
name|type
argument_list|,
name|LDNS_RDF_SIZE_BYTE
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_native2rdf_int16
parameter_list|(
name|ldns_rdf_type
name|type
parameter_list|,
name|uint16_t
name|value
parameter_list|)
block|{
name|uint16_t
modifier|*
name|rdf_data
init|=
name|LDNS_XMALLOC
argument_list|(
name|uint16_t
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ldns_rdf
modifier|*
name|rdf
decl_stmt|;
if|if
condition|(
operator|!
name|rdf_data
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ldns_write_uint16
argument_list|(
name|rdf_data
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|rdf
operator|=
name|ldns_rdf_new
argument_list|(
name|type
argument_list|,
name|LDNS_RDF_SIZE_WORD
argument_list|,
name|rdf_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rdf
condition|)
name|LDNS_FREE
argument_list|(
name|rdf_data
argument_list|)
expr_stmt|;
return|return
name|rdf
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_native2rdf_int32
parameter_list|(
name|ldns_rdf_type
name|type
parameter_list|,
name|uint32_t
name|value
parameter_list|)
block|{
name|uint32_t
modifier|*
name|rdf_data
init|=
name|LDNS_XMALLOC
argument_list|(
name|uint32_t
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ldns_rdf
modifier|*
name|rdf
decl_stmt|;
if|if
condition|(
operator|!
name|rdf_data
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ldns_write_uint32
argument_list|(
name|rdf_data
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|rdf
operator|=
name|ldns_rdf_new
argument_list|(
name|type
argument_list|,
name|LDNS_RDF_SIZE_DOUBLEWORD
argument_list|,
name|rdf_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rdf
condition|)
name|LDNS_FREE
argument_list|(
name|rdf_data
argument_list|)
expr_stmt|;
return|return
name|rdf
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_native2rdf_int16_data
parameter_list|(
name|size_t
name|size
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|)
block|{
name|uint8_t
modifier|*
name|rdf_data
init|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|size
operator|+
literal|2
argument_list|)
decl_stmt|;
name|ldns_rdf
modifier|*
name|rdf
decl_stmt|;
if|if
condition|(
operator|!
name|rdf_data
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ldns_write_uint16
argument_list|(
name|rdf_data
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|rdf_data
operator|+
literal|2
argument_list|,
name|data
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|rdf
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_INT16_DATA
argument_list|,
name|size
operator|+
literal|2
argument_list|,
name|rdf_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rdf
condition|)
name|LDNS_FREE
argument_list|(
name|rdf_data
argument_list|)
expr_stmt|;
return|return
name|rdf
return|;
block|}
end_function

begin_comment
comment|/* note: data must be allocated memory */
end_comment

begin_function
name|ldns_rdf
modifier|*
name|ldns_rdf_new
parameter_list|(
name|ldns_rdf_type
name|type
parameter_list|,
name|size_t
name|size
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
name|ldns_rdf
modifier|*
name|rd
decl_stmt|;
name|rd
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_rdf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rd
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ldns_rdf_set_size
argument_list|(
name|rd
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|ldns_rdf_set_type
argument_list|(
name|rd
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|ldns_rdf_set_data
argument_list|(
name|rd
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
name|rd
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rdf_new_frm_data
parameter_list|(
name|ldns_rdf_type
name|type
parameter_list|,
name|size_t
name|size
parameter_list|,
specifier|const
name|void
modifier|*
name|data
parameter_list|)
block|{
name|ldns_rdf
modifier|*
name|rdf
decl_stmt|;
comment|/* if the size is too big, fail */
if|if
condition|(
name|size
operator|>
name|LDNS_MAX_RDFLEN
condition|)
block|{
return|return
name|NULL
return|;
block|}
comment|/* allocate space */
name|rdf
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_rdf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rdf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|rdf
operator|->
name|_data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rdf
operator|->
name|_data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|rdf
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* set the values */
name|ldns_rdf_set_type
argument_list|(
name|rdf
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|ldns_rdf_set_size
argument_list|(
name|rdf
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|rdf
operator|->
name|_data
argument_list|,
name|data
argument_list|,
name|size
argument_list|)
expr_stmt|;
return|return
name|rdf
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rdf_clone
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|assert
argument_list|(
name|rd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
operator|(
name|ldns_rdf_new_frm_data
argument_list|(
name|ldns_rdf_get_type
argument_list|(
name|rd
argument_list|)
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rd
argument_list|)
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ldns_rdf_deep_free
parameter_list|(
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
if|if
condition|(
name|rd
condition|)
block|{
if|if
condition|(
name|rd
operator|->
name|_data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|rd
operator|->
name|_data
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|rd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|ldns_rdf_free
parameter_list|(
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
if|if
condition|(
name|rd
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|rd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rdf_new_frm_str
parameter_list|(
name|ldns_rdf_type
name|type
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|ldns_rdf
modifier|*
name|rdf
init|=
name|NULL
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|LDNS_RDF_TYPE_DNAME
case|:
name|status
operator|=
name|ldns_str2rdf_dname
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT8
case|:
name|status
operator|=
name|ldns_str2rdf_int8
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT16
case|:
name|status
operator|=
name|ldns_str2rdf_int16
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT32
case|:
name|status
operator|=
name|ldns_str2rdf_int32
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_A
case|:
name|status
operator|=
name|ldns_str2rdf_a
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_AAAA
case|:
name|status
operator|=
name|ldns_str2rdf_aaaa
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_STR
case|:
name|status
operator|=
name|ldns_str2rdf_str
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_APL
case|:
name|status
operator|=
name|ldns_str2rdf_apl
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_B64
case|:
name|status
operator|=
name|ldns_str2rdf_b64
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_B32_EXT
case|:
name|status
operator|=
name|ldns_str2rdf_b32_ext
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_HEX
case|:
name|status
operator|=
name|ldns_str2rdf_hex
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSEC
case|:
name|status
operator|=
name|ldns_str2rdf_nsec
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TYPE
case|:
name|status
operator|=
name|ldns_str2rdf_type
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_CLASS
case|:
name|status
operator|=
name|ldns_str2rdf_class
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_CERT_ALG
case|:
name|status
operator|=
name|ldns_str2rdf_cert_alg
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_ALG
case|:
name|status
operator|=
name|ldns_str2rdf_alg
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_UNKNOWN
case|:
name|status
operator|=
name|ldns_str2rdf_unknown
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TIME
case|:
name|status
operator|=
name|ldns_str2rdf_time
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_PERIOD
case|:
name|status
operator|=
name|ldns_str2rdf_period
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_HIP
case|:
name|status
operator|=
name|ldns_str2rdf_hip
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_SERVICE
case|:
name|status
operator|=
name|ldns_str2rdf_service
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_LOC
case|:
name|status
operator|=
name|ldns_str2rdf_loc
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_WKS
case|:
name|status
operator|=
name|ldns_str2rdf_wks
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSAP
case|:
name|status
operator|=
name|ldns_str2rdf_nsap
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_ATMA
case|:
name|status
operator|=
name|ldns_str2rdf_atma
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_IPSECKEY
case|:
name|status
operator|=
name|ldns_str2rdf_ipseckey
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSEC3_SALT
case|:
name|status
operator|=
name|ldns_str2rdf_nsec3_salt
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSEC3_NEXT_OWNER
case|:
name|status
operator|=
name|ldns_str2rdf_b32_ext
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_ILNP64
case|:
name|status
operator|=
name|ldns_str2rdf_ilnp64
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_EUI48
case|:
name|status
operator|=
name|ldns_str2rdf_eui48
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_EUI64
case|:
name|status
operator|=
name|ldns_str2rdf_eui64
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TAG
case|:
name|status
operator|=
name|ldns_str2rdf_tag
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_LONG_STR
case|:
name|status
operator|=
name|ldns_str2rdf_long_str
argument_list|(
operator|&
name|rdf
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NONE
case|:
default|default:
comment|/* default default ??? */
name|status
operator|=
name|LDNS_STATUS_ERR
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|LDNS_STATUS_OK
operator|==
name|status
condition|)
block|{
name|ldns_rdf_set_type
argument_list|(
name|rdf
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
name|rdf
return|;
block|}
if|if
condition|(
name|rdf
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|rdf
argument_list|)
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf_new_frm_fp
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rdf
parameter_list|,
name|ldns_rdf_type
name|type
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
return|return
name|ldns_rdf_new_frm_fp_l
argument_list|(
name|rdf
argument_list|,
name|type
argument_list|,
name|fp
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf_new_frm_fp_l
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rdf
parameter_list|,
name|ldns_rdf_type
name|type
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|,
name|int
modifier|*
name|line_nr
parameter_list|)
block|{
name|char
modifier|*
name|line
decl_stmt|;
name|ldns_rdf
modifier|*
name|r
decl_stmt|;
name|ssize_t
name|t
decl_stmt|;
name|line
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|LDNS_MAX_LINELEN
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|line
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
comment|/* read an entire line in from the file */
if|if
condition|(
operator|(
name|t
operator|=
name|ldns_fget_token_l
argument_list|(
name|fp
argument_list|,
name|line
argument_list|,
name|LDNS_PARSE_SKIP_SPACE
argument_list|,
literal|0
argument_list|,
name|line_nr
argument_list|)
operator|)
operator|==
operator|-
literal|1
operator|||
name|t
operator|==
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|line
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_SYNTAX_RDATA_ERR
return|;
block|}
name|r
operator|=
name|ldns_rdf_new_frm_str
argument_list|(
name|type
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|line
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|line
argument_list|)
expr_stmt|;
if|if
condition|(
name|rdf
condition|)
block|{
operator|*
name|rdf
operator|=
name|r
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_NULL
return|;
block|}
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rdf_address_reverse
parameter_list|(
name|ldns_rdf
modifier|*
name|rd
parameter_list|)
block|{
name|uint8_t
name|buf_4
index|[
name|LDNS_IP4ADDRLEN
index|]
decl_stmt|;
name|uint8_t
name|buf_6
index|[
name|LDNS_IP6ADDRLEN
operator|*
literal|2
index|]
decl_stmt|;
name|ldns_rdf
modifier|*
name|rev
decl_stmt|;
name|ldns_rdf
modifier|*
name|in_addr
decl_stmt|;
name|ldns_rdf
modifier|*
name|ret_dname
decl_stmt|;
name|uint8_t
name|octet
decl_stmt|;
name|uint8_t
name|nnibble
decl_stmt|;
name|uint8_t
name|nibble
decl_stmt|;
name|uint8_t
name|i
decl_stmt|,
name|j
decl_stmt|;
name|char
modifier|*
name|char_dname
decl_stmt|;
name|int
name|nbit
decl_stmt|;
if|if
condition|(
name|ldns_rdf_get_type
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_TYPE_A
operator|&&
name|ldns_rdf_get_type
argument_list|(
name|rd
argument_list|)
operator|!=
name|LDNS_RDF_TYPE_AAAA
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|in_addr
operator|=
name|NULL
expr_stmt|;
name|ret_dname
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
name|ldns_rdf_get_type
argument_list|(
name|rd
argument_list|)
condition|)
block|{
case|case
name|LDNS_RDF_TYPE_A
case|:
comment|/* the length of the buffer is 4 */
name|buf_4
index|[
literal|3
index|]
operator|=
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
index|[
literal|0
index|]
expr_stmt|;
name|buf_4
index|[
literal|2
index|]
operator|=
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
index|[
literal|1
index|]
expr_stmt|;
name|buf_4
index|[
literal|1
index|]
operator|=
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
index|[
literal|2
index|]
expr_stmt|;
name|buf_4
index|[
literal|0
index|]
operator|=
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
index|[
literal|3
index|]
expr_stmt|;
name|in_addr
operator|=
name|ldns_dname_new_frm_str
argument_list|(
literal|"in-addr.arpa."
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|in_addr
condition|)
block|{
return|return
name|NULL
return|;
block|}
comment|/* make a new rdf and convert that back  */
name|rev
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_A
argument_list|,
name|LDNS_IP4ADDRLEN
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|buf_4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rev
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|in_addr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* convert rev to a string */
name|char_dname
operator|=
name|ldns_rdf2str
argument_list|(
name|rev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|char_dname
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|in_addr
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|rev
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* transform back to rdf with type dname */
name|ret_dname
operator|=
name|ldns_dname_new_frm_str
argument_list|(
name|char_dname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret_dname
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|in_addr
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|rev
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|char_dname
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* not needed anymore */
name|ldns_rdf_deep_free
argument_list|(
name|rev
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|char_dname
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_AAAA
case|:
comment|/* some foo magic to reverse the nibbles ... */
for|for
control|(
name|nbit
operator|=
literal|127
init|;
name|nbit
operator|>=
literal|0
condition|;
name|nbit
operator|=
name|nbit
operator|-
literal|4
control|)
block|{
comment|/* calculate octett (8 bit) */
name|octet
operator|=
operator|(
operator|(
operator|(
name|unsigned
name|int
operator|)
name|nbit
operator|)
operator|&
literal|0x78
operator|)
operator|>>
literal|3
expr_stmt|;
comment|/* calculate nibble */
name|nnibble
operator|=
operator|(
operator|(
operator|(
name|unsigned
name|int
operator|)
name|nbit
operator|)
operator|&
literal|0x04
operator|)
operator|>>
literal|2
expr_stmt|;
comment|/* extract nibble */
name|nibble
operator|=
operator|(
name|ldns_rdf_data
argument_list|(
name|rd
argument_list|)
index|[
name|octet
index|]
operator|&
operator|(
literal|0xf
operator|<<
operator|(
literal|4
operator|*
operator|(
literal|1
operator|-
name|nnibble
operator|)
operator|)
operator|)
operator|)
operator|>>
operator|(
literal|4
operator|*
operator|(
literal|1
operator|-
name|nnibble
operator|)
operator|)
expr_stmt|;
name|buf_6
index|[
operator|(
name|LDNS_IP6ADDRLEN
operator|*
literal|2
operator|-
literal|1
operator|)
operator|-
operator|(
name|octet
operator|*
literal|2
operator|+
name|nnibble
operator|)
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|ldns_int_to_hexdigit
argument_list|(
operator|(
name|int
operator|)
name|nibble
argument_list|)
expr_stmt|;
block|}
name|char_dname
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
operator|(
name|LDNS_IP6ADDRLEN
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|char_dname
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|char_dname
index|[
name|LDNS_IP6ADDRLEN
operator|*
literal|4
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* closure */
comment|/* walk the string and add . 's */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|i
operator|<
name|LDNS_IP6ADDRLEN
operator|*
literal|2
condition|;
name|i
operator|++
operator|,
name|j
operator|=
name|j
operator|+
literal|2
control|)
block|{
name|char_dname
index|[
name|j
index|]
operator|=
operator|(
name|char
operator|)
name|buf_6
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|i
operator|!=
name|LDNS_IP6ADDRLEN
operator|*
literal|2
operator|-
literal|1
condition|)
block|{
name|char_dname
index|[
name|j
operator|+
literal|1
index|]
operator|=
literal|'.'
expr_stmt|;
block|}
block|}
name|in_addr
operator|=
name|ldns_dname_new_frm_str
argument_list|(
literal|"ip6.arpa."
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|in_addr
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|char_dname
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* convert rev to a string */
name|ret_dname
operator|=
name|ldns_dname_new_frm_str
argument_list|(
name|char_dname
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|char_dname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret_dname
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|in_addr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
break|break;
default|default:
break|break;
block|}
comment|/* add the suffix */
name|rev
operator|=
name|ldns_dname_cat_clone
argument_list|(
name|ret_dname
argument_list|,
name|in_addr
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|ret_dname
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|in_addr
argument_list|)
expr_stmt|;
return|return
name|rev
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf_hip_get_alg_hit_pk
parameter_list|(
name|ldns_rdf
modifier|*
name|rdf
parameter_list|,
name|uint8_t
modifier|*
name|alg
parameter_list|,
name|uint8_t
modifier|*
name|hit_size
parameter_list|,
name|uint8_t
modifier|*
modifier|*
name|hit
parameter_list|,
name|uint16_t
modifier|*
name|pk_size
parameter_list|,
name|uint8_t
modifier|*
modifier|*
name|pk
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|size_t
name|rdf_size
decl_stmt|;
if|if
condition|(
operator|!
name|rdf
operator|||
operator|!
name|alg
operator|||
operator|!
name|hit
operator|||
operator|!
name|hit_size
operator|||
operator|!
name|pk
operator|||
operator|!
name|pk_size
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_POINTER
return|;
block|}
elseif|else
if|if
condition|(
name|ldns_rdf_get_type
argument_list|(
name|rdf
argument_list|)
operator|!=
name|LDNS_RDF_TYPE_HIP
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_RDF_TYPE
return|;
block|}
elseif|else
if|if
condition|(
operator|(
name|rdf_size
operator|=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|)
operator|<
literal|6
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|data
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
expr_stmt|;
operator|*
name|hit_size
operator|=
name|data
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|alg
operator|=
name|data
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|pk_size
operator|=
name|ldns_read_uint16
argument_list|(
name|data
operator|+
literal|2
argument_list|)
expr_stmt|;
operator|*
name|hit
operator|=
name|data
operator|+
literal|4
expr_stmt|;
operator|*
name|pk
operator|=
name|data
operator|+
literal|4
operator|+
operator|*
name|hit_size
expr_stmt|;
if|if
condition|(
operator|*
name|hit_size
operator|==
literal|0
operator|||
operator|*
name|pk_size
operator|==
literal|0
operator|||
name|rdf_size
operator|<
operator|(
name|size_t
operator|)
operator|*
name|hit_size
operator|+
operator|*
name|pk_size
operator|+
literal|4
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf_hip_new_frm_alg_hit_pk
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rdf
parameter_list|,
name|uint8_t
name|alg
parameter_list|,
name|uint8_t
name|hit_size
parameter_list|,
name|uint8_t
modifier|*
name|hit
parameter_list|,
name|uint16_t
name|pk_size
parameter_list|,
name|uint8_t
modifier|*
name|pk
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
decl_stmt|;
if|if
condition|(
operator|!
name|rdf
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_POINTER
return|;
block|}
if|if
condition|(
literal|4
operator|+
name|hit_size
operator|+
name|pk_size
operator|>
name|LDNS_MAX_RDFLEN
condition|)
block|{
return|return
name|LDNS_STATUS_RDATA_OVERFLOW
return|;
block|}
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
literal|4
operator|+
name|hit_size
operator|+
name|pk_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|==
name|NULL
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|data
index|[
literal|0
index|]
operator|=
name|hit_size
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
name|alg
expr_stmt|;
name|ldns_write_uint16
argument_list|(
name|data
operator|+
literal|2
argument_list|,
name|pk_size
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|data
operator|+
literal|4
argument_list|,
name|hit
argument_list|,
name|hit_size
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|data
operator|+
literal|4
operator|+
name|hit_size
argument_list|,
name|pk
argument_list|,
name|pk_size
argument_list|)
expr_stmt|;
operator|*
name|rdf
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_HIP
argument_list|,
literal|4
operator|+
name|hit_size
operator|+
name|pk_size
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rdf
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_octet
parameter_list|(
name|char
modifier|*
name|word
parameter_list|,
name|size_t
modifier|*
name|length
parameter_list|)
block|{
name|char
modifier|*
name|s
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
operator|*
name|length
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|s
operator|=
name|p
operator|=
name|word
init|;
operator|*
name|s
operator|!=
literal|'\0'
condition|;
name|s
operator|++
operator|,
name|p
operator|++
control|)
block|{
switch|switch
condition|(
operator|*
name|s
condition|)
block|{
case|case
literal|'.'
case|:
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'.'
condition|)
block|{
return|return
name|LDNS_STATUS_EMPTY_LABEL
return|;
block|}
operator|*
name|p
operator|=
operator|*
name|s
expr_stmt|;
operator|(
operator|*
name|length
operator|)
operator|++
expr_stmt|;
break|break;
case|case
literal|'\\'
case|:
if|if
condition|(
literal|'0'
operator|<=
name|s
index|[
literal|1
index|]
operator|&&
name|s
index|[
literal|1
index|]
operator|<=
literal|'9'
operator|&&
literal|'0'
operator|<=
name|s
index|[
literal|2
index|]
operator|&&
name|s
index|[
literal|2
index|]
operator|<=
literal|'9'
operator|&&
literal|'0'
operator|<=
name|s
index|[
literal|3
index|]
operator|&&
name|s
index|[
literal|3
index|]
operator|<=
literal|'9'
condition|)
block|{
comment|/* \DDD seen */
name|int
name|val
init|=
operator|(
operator|(
name|s
index|[
literal|1
index|]
operator|-
literal|'0'
operator|)
operator|*
literal|100
operator|+
operator|(
name|s
index|[
literal|2
index|]
operator|-
literal|'0'
operator|)
operator|*
literal|10
operator|+
operator|(
name|s
index|[
literal|3
index|]
operator|-
literal|'0'
operator|)
operator|)
decl_stmt|;
if|if
condition|(
literal|0
operator|<=
name|val
operator|&&
name|val
operator|<=
literal|255
condition|)
block|{
comment|/* this also handles \0 */
name|s
operator|+=
literal|3
expr_stmt|;
operator|*
name|p
operator|=
name|val
expr_stmt|;
operator|(
operator|*
name|length
operator|)
operator|++
expr_stmt|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_DDD_OVERFLOW
return|;
block|}
block|}
else|else
block|{
comment|/* an espaced character, like \<space> ?                      * remove the '\' keep the rest */
operator|*
name|p
operator|=
operator|*
operator|++
name|s
expr_stmt|;
operator|(
operator|*
name|length
operator|)
operator|++
expr_stmt|;
block|}
break|break;
case|case
literal|'\"'
case|:
comment|/* non quoted " Is either first or the last character in                  * the string */
operator|*
name|p
operator|=
operator|*
operator|++
name|s
expr_stmt|;
comment|/* skip it */
operator|(
operator|*
name|length
operator|)
operator|++
expr_stmt|;
comment|/* I'm not sure if this is needed in libdns... MG */
if|if
condition|(
operator|*
name|s
operator|==
literal|'\0'
condition|)
block|{
comment|/* ok, it was the last one */
operator|*
name|p
operator|=
literal|'\0'
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
break|break;
default|default:
operator|*
name|p
operator|=
operator|*
name|s
expr_stmt|;
operator|(
operator|*
name|length
operator|)
operator|++
expr_stmt|;
break|break;
block|}
block|}
operator|*
name|p
operator|=
literal|'\0'
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|int
name|ldns_rdf_compare
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rd1
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rd2
parameter_list|)
block|{
name|uint16_t
name|i1
decl_stmt|,
name|i2
decl_stmt|,
name|i
decl_stmt|;
name|uint8_t
modifier|*
name|d1
decl_stmt|,
modifier|*
name|d2
decl_stmt|;
comment|/* only when both are not NULL we can say anything about them */
if|if
condition|(
operator|!
name|rd1
operator|&&
operator|!
name|rd2
condition|)
block|{
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|rd1
operator|||
operator|!
name|rd2
condition|)
block|{
return|return
operator|-
literal|1
return|;
block|}
name|i1
operator|=
name|ldns_rdf_size
argument_list|(
name|rd1
argument_list|)
expr_stmt|;
name|i2
operator|=
name|ldns_rdf_size
argument_list|(
name|rd2
argument_list|)
expr_stmt|;
if|if
condition|(
name|i1
operator|<
name|i2
condition|)
block|{
return|return
operator|-
literal|1
return|;
block|}
elseif|else
if|if
condition|(
name|i1
operator|>
name|i2
condition|)
block|{
return|return
operator|+
literal|1
return|;
block|}
else|else
block|{
name|d1
operator|=
operator|(
name|uint8_t
operator|*
operator|)
name|ldns_rdf_data
argument_list|(
name|rd1
argument_list|)
expr_stmt|;
name|d2
operator|=
operator|(
name|uint8_t
operator|*
operator|)
name|ldns_rdf_data
argument_list|(
name|rd2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|i1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|d1
index|[
name|i
index|]
operator|<
name|d2
index|[
name|i
index|]
condition|)
block|{
return|return
operator|-
literal|1
return|;
block|}
elseif|else
if|if
condition|(
name|d1
index|[
name|i
index|]
operator|>
name|d2
index|[
name|i
index|]
condition|)
block|{
return|return
operator|+
literal|1
return|;
block|}
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_str2period
parameter_list|(
specifier|const
name|char
modifier|*
name|nptr
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|endptr
parameter_list|)
block|{
name|int
name|sign
init|=
literal|0
decl_stmt|;
name|uint32_t
name|i
init|=
literal|0
decl_stmt|;
name|uint32_t
name|seconds
init|=
literal|0
decl_stmt|;
for|for
control|(
operator|*
name|endptr
operator|=
name|nptr
init|;
operator|*
operator|*
name|endptr
condition|;
operator|(
operator|*
name|endptr
operator|)
operator|++
control|)
block|{
switch|switch
condition|(
operator|*
operator|*
name|endptr
condition|)
block|{
case|case
literal|' '
case|:
case|case
literal|'\t'
case|:
break|break;
case|case
literal|'-'
case|:
if|if
condition|(
name|sign
operator|==
literal|0
condition|)
block|{
name|sign
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
return|return
name|seconds
return|;
block|}
break|break;
case|case
literal|'+'
case|:
if|if
condition|(
name|sign
operator|==
literal|0
condition|)
block|{
name|sign
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
return|return
name|seconds
return|;
block|}
break|break;
case|case
literal|'s'
case|:
case|case
literal|'S'
case|:
name|seconds
operator|+=
name|i
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
case|case
literal|'M'
case|:
name|seconds
operator|+=
name|i
operator|*
literal|60
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'h'
case|:
case|case
literal|'H'
case|:
name|seconds
operator|+=
name|i
operator|*
literal|60
operator|*
literal|60
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'d'
case|:
case|case
literal|'D'
case|:
name|seconds
operator|+=
name|i
operator|*
literal|60
operator|*
literal|60
operator|*
literal|24
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'w'
case|:
case|case
literal|'W'
case|:
name|seconds
operator|+=
name|i
operator|*
literal|60
operator|*
literal|60
operator|*
literal|24
operator|*
literal|7
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'0'
case|:
case|case
literal|'1'
case|:
case|case
literal|'2'
case|:
case|case
literal|'3'
case|:
case|case
literal|'4'
case|:
case|case
literal|'5'
case|:
case|case
literal|'6'
case|:
case|case
literal|'7'
case|:
case|case
literal|'8'
case|:
case|case
literal|'9'
case|:
name|i
operator|*=
literal|10
expr_stmt|;
name|i
operator|+=
operator|(
operator|*
operator|*
name|endptr
operator|-
literal|'0'
operator|)
expr_stmt|;
break|break;
default|default:
name|seconds
operator|+=
name|i
expr_stmt|;
comment|/* disregard signedness */
return|return
name|seconds
return|;
block|}
block|}
name|seconds
operator|+=
name|i
expr_stmt|;
comment|/* disregard signedness */
return|return
name|seconds
return|;
block|}
end_function

end_unit

